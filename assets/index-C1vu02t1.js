const __vite__fileDeps=["assets/IdentityManager-B9mpprrX.js","assets/substitute-BhxWK6n0.js","assets/statsWorker-mnDtH3LJ.js","assets/utils-CFLVAbkt.js","assets/utils-h90HxsHi.js","assets/utils-D2FxmlGT.js","assets/ClassBreaksDefinition-CAYIUOHD.js","assets/geometryEngineWorker-CSeRIS2l.js","assets/geometryEngineJSON-CWlCA2jv.js","assets/geometryEngineBase-CQNXzLBl.js","assets/json-Wa8cmqdu.js","assets/CSVSourceWorker-Bedf_K27.js","assets/date-M6n_RqpC.js","assets/FeatureStore-C5koWRpo.js","assets/BoundsStore-CliJ1nHg.js","assets/PooledRBush-C4BeL4TL.js","assets/quickselect-Dut0eCe5.js","assets/QueryEngine-Ct0GERw2.js","assets/normalizeUtils-xsdTTkzP.js","assets/normalizeUtilsCommon-m--1KWWE.js","assets/WhereClause-DrVgt2QQ.js","assets/TimeOnly-vixxhQ97.js","assets/QueryEngineCapabilities-CTDe3LlQ.js","assets/optimizedFeatureQueryEngineAdapter-C6cqzPtu.js","assets/number-DSuYSlBY.js","assets/clientSideDefaults-8kfZ6TK2.js","assets/EdgeProcessingWorker-DMQsgUHb.js","assets/workerHelper-o9RFOAGc.js","assets/ElevationSamplerWorker-DlEfPQ0J.js","assets/vertexSpaceConversion-CwGBM9Tk.js","assets/FeatureServiceSnappingSourceWorker-Dq_28Mai.js","assets/symbologySnappingCandidates-BKrTmOw2.js","assets/pbfQueryUtils-B-Utjaxe.js","assets/pbf-DjRKcrTM.js","assets/query-C14VEaxY.js","assets/GeoJSONSourceWorker-abmWBhS5.js","assets/geojson-BHYblVqh.js","assets/sourceUtils-CTQdoNQn.js","assets/MemorySourceWorker-BK5iDUoq.js","assets/objectIdUtils-4dd1rf9p.js","assets/PBFDecoderWorker-Cq5e8yg4.js","assets/FeaturePipelineWorker-CCY0dY_S.js","assets/TurboLine-lgs6APB1.js","assets/constants-D5zmR9t2.js","assets/Rect-BAnET0xx.js","assets/ogcFeatureUtils-DOb_N9Sm.js","assets/StreamFeatureManager-Cts5c6N5.js","assets/createConnection-C8dfH0pA.js","assets/PointCloudWorker-CYmFdExa.js","assets/PointCloudWorkerUtil-CmJTsKzV.js","assets/PointCloudUniqueValueRenderer-CDYd4Vn6.js","assets/RasterWorker-B4tas2fn.js","assets/dataUtils-D2BYal59.js","assets/PolynomialTransform-Dg9rtkx8.js","assets/rasterProjectionHelper-bCc_bRQO.js","assets/SceneLayerWorker-DHhcZFbm.js","assets/I3SNode-4h3fvk9i.js","assets/WFSSourceWorker-D3400A6H.js","assets/wfsUtils-QRADDBeO.js","assets/xmlUtils-CtUoQO7q.js","assets/WorkerTileHandler-DuqPLRvk.js","assets/Lyr3DWorker-CsyTb_an.js","assets/ILyr3DWasmPerSceneView-vPx4somd.js","assets/Lyr3DModule-Cw_Qdtpm.js","assets/Popup-URBzWqFF.js","assets/unitFormatUtils-CyI_j2lc.js","assets/AttachmentInfo-b_lxKvcj.js","assets/executeQueryJSON-DXZ2Iil2.js","assets/ReactiveSet-CTbyImp5.js","assets/ElevationLayer-Dyq4jKg3.js","assets/LercDecoder-BgbsObaU.js","assets/WorkerHandle-BP9hIj3n.js","assets/layersCreator-ClsCR6T7.js","assets/portalLayers-COfaAUa5.js","assets/fetchService-C_1OxwxC.js","assets/arcgisLayers-CffRUE5l.js","assets/arcadeUtils-CVVL4DyC.js","assets/ImmutableArray-BPVd6ESQ.js","assets/hash-CcEbRgUF.js","assets/TileLayerView3D-DBqd0-x9.js","assets/LayerView3D-cUd_wGym.js","assets/TiledLayerView3D-fBjUdIF-.js","assets/fetchTile-C_-d5Up4.js","assets/LayerView-CKNJj2UP.js","assets/RefreshableLayerView-XYg8ux8a.js","assets/MapServiceLayerViewHelper-u7jCQXzm.js","assets/floorFilterUtils-DZ5C6FQv.js","assets/drapedUtils-C3mYOyjJ.js","assets/sublayerUtils-MW2c7bRX.js","assets/ElevationLayerView3D-D1sLYglQ.js","assets/BaseDynamicLayerView3D-C-4MVQSg.js","assets/DynamicLayerView3D-65HITY4I.js","assets/projectExtentUtils-BILRaKJt.js","assets/ImageMaterial.glsl-ByVwqnao.js","assets/BuildingSceneLayerView3D-BTDdhoKT.js","assets/I3SMeshView3D-B0MFcnR-.js","assets/Transform-B50McosV.js","assets/RenderTexture-CGxU_edd.js","assets/I3SOverrides-Ch_YRV2s.js","assets/meshFeatureSet-wPQK9X2U.js","assets/Mesh-BivPSEYa.js","assets/MeshTransform-IczvoKP5.js","assets/External-C_Zw43S7.js","assets/infoFor3D-DsOdlPuA.js","assets/FeatureLayerView3D-hK0V7mGf.js","assets/FeatureLayerViewBase3D-Xx3ncPro.js","assets/HeatmapDensity.glsl-3ukHGS9H.js","assets/timeSupport-CN3miZvZ.js","assets/dehydratedFeatureComparison-DSGN-nzi.js","assets/queryForSymbologySnapping-NoXjQdOY.js","assets/Graphics3DObjectStates-bKOzQrLK.js","assets/EventedSet-z1QnZ2uD.js","assets/SceneModification-BAJQG_Sg.js","assets/persistable-GTozccmK.js","assets/resourceExtension-BMTCrzFt.js","assets/makeScheduleFunction-CggzEh3c.js","assets/I3SQueryFeatureStore-CIw9-R33.js","assets/TemporalSceneLayerView-DT7ToAG6.js","assets/CatalogLayerView3D-CFRcPQkn.js","assets/CatalogDynamicGroupLayerView3D-CFdpYWGY.js","assets/CatalogFootprintLayerView3D-DiHYMiCr.js","assets/CSVLayerView3D-Blz5Q_4l.js","assets/DimensionLayerView3D-Bb5y5ULe.js","assets/GeoJSONLayerView3D-D7xjLwGC.js","assets/GraphicsLayerView3D-DjhFze7h.js","assets/GraphicsProcessor-eNBV39vP.js","assets/GroupLayerView-DiVQFs5H.js","assets/ImageryLayerView3D-DfOIpxKO.js","assets/IntegratedMeshLayerView3D-CVYBtF6i.js","assets/IntegratedMesh3DTilesLayerView3D-DJMqaNYo.js","assets/LineOfSightLayerView3D-CZSeppk4.js","assets/MapImageLayerView3D-B0fIo-UV.js","assets/ExportImageParameters-BoKcrU9R.js","assets/MediaLayerView3D-CXYuSN9T.js","assets/MediaElementView-DDcqnSm1.js","assets/normalizeUtilsSync-Bu0lEclM.js","assets/keybindings-DIJ1Dioe.js","assets/SnappingManagerPool-D0W6STxa.js","assets/geodesicLengthMeasurementUtils-DrFXJPv0.js","assets/geometryEngine-DwsfMQH8.js","assets/hydrated-SVSEWf7d.js","assets/geometry2dUtils-D-9Ifi8M.js","assets/OGCFeatureLayerView3D-CoTx46dK.js","assets/PointCloudLayerView3D-B1DiLBrs.js","assets/PopupSceneLayerView-CyqVkrqU.js","assets/VoxelLayerView3D-BxZL9K1P.js","assets/RouteLayerView3D-FLlpaXZV.js","assets/Stop-DCyNt2bl.js","assets/SceneLayerView3D-B5wTXq8h.js","assets/SceneLayerView-D7wgkE6s.js","assets/SceneLayerGraphicsView3D-DlOjijEh.js","assets/StreamLayerView3D-amq9V6VX.js","assets/ImageryTileLayerView3D-DyFwKEq7.js","assets/VectorTileLayerView3D-DujxMn9p.js","assets/vec4f32-CjrfB-0a.js","assets/WFSLayerView3D-DmRh3d05.js","assets/WMSLayerView3D-pKN1l1xO.js","assets/ExportWMSImageParameters-CD8c-Tqa.js","assets/WMTSLayerView3D-DhstHW7t.js","assets/AreaMeasurementAnalysisView3D-DyhtFJfm.js","assets/interfaces-DP5Lw07k.js","assets/TextOverlayItem-CdfG9G4d.js","assets/AnalysisView3D-CBodBirY.js","assets/euclideanAreaMeasurementUtils-Mx26s2J7.js","assets/projectionUtils-BrU8sez2.js","assets/EditGeometryOperations-CgSrj-U3.js","assets/Segment-DkbmxTCf.js","assets/LineVisualElement-BVEK0JTe.js","assets/DimensionAnalysisView3D-DtuOgsNo.js","assets/LengthDimension-BXvc4tDW.js","assets/SnappingOperation-D9-YZSLl.js","assets/ExtendedLineVisualElement-Ddno6y0j.js","assets/EngineVisualElement-MBoFdcPq.js","assets/Laserlines.glsl-gvxiXMi2.js","assets/PointVisualElement-Cu28voYe.js","assets/RightAngleQuadVisualElement-DMR94GK0.js","assets/PointSnappingHint-D7h03Ex8.js","assets/ShadedColorMaterial.glsl-CVxS7_yd.js","assets/dragEventPipeline3D-BGi3gvYj.js","assets/memoize-DsJmrG76.js","assets/Factory-BuPY9QdF.js","assets/analysisViewUtils-KXmyO5OC.js","assets/ToolIntersector-BOXWMg4F.js","assets/DirectLineMeasurementAnalysisView3D-TT2ZuNJ8.js","assets/LineOfSightAnalysisView3D-BS9_AZB4.js","assets/LineOfSightAnalysisTarget-DQJv80Tl.js","assets/manipulatorUtils-Bi9_dJWP.js","assets/SliceAnalysisView3D-DyjyaonR.js","assets/SlicePlaneMaterial.glsl-CXZVt6YQ.js","assets/sliceToolConfig-BGKU514C.js","assets/ViewshedAnalysisView3D-CPogzC9K.js","assets/MoveManipulation-BbMUf9sQ.js","assets/TerrainTileTree3DDebugger-DZZADJbl.js","assets/TileTreeDebugger-AvV9cFEt.js","assets/EdgeView-DlHlhVNn.js","assets/EdgeWorkerHandle-qnRKhI1_.js","assets/Lyr3DWasmPerSceneView-mxoAUeaF.js","assets/calcite-button-DmitS5rx.js","assets/form-DwGecOq5.js","assets/dom-CHkDf_0S.js","assets/guid-6Y9utpk5.js","assets/interactive-Ct4HGBnZ.js","assets/label-B0mTINZT.js","assets/component-RjiOe4wK.js","assets/loadable-yZY5IGWj.js","assets/t9n-DRXfoH20.js","assets/key-O8wPdnVC.js","assets/observers-Dc4bxRc-.js","assets/icon-BNAhwdWD.js","assets/loader-C1f2Ud3U.js","assets/calcite-icon-BAgyF0eh.js","assets/FeatureTileTree3DDebugger-C2yV-hVh.js","assets/GraphicsView3D-i2l2AHrk.js","assets/layersLoader-CRzW61vp.js","assets/editingSupport-BheQ6ebt.js","assets/featureLayerUtils-yJceHOl4.js","assets/utils-BCT_leD9.js","assets/FeatureLayerSource-EP8K7DDn.js","assets/QueryTask-C4iAoBdg.js","assets/executeForIds-CQKIgiQ5.js","assets/executeQueryPBF-DiIh54b4.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var Fke=Object.defineProperty;var kke=(t,e,i)=>e in t?Fke(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var Vj=(t,e,i)=>kke(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();function el(){}const Nve=t=>t;function Uke(t,e){for(const i in e)t[i]=e[i];return t}function Fve(t){return t()}function Kne(){return Object.create(null)}function L3(t){t.forEach(Fve)}function RK(t){return typeof t=="function"}function D0(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let eD;function eoe(t,e){return t===e?!0:(eD||(eD=document.createElement("a")),eD.href=e,t===eD.href)}function zke(t){return Object.keys(t).length===0}function kve(t,e,i,r){if(t){const s=Uve(t,e,i,r);return t[0](s)}}function Uve(t,e,i,r){return t[1]&&r?Uke(i.ctx.slice(),t[1](r(e))):i.ctx}function zve(t,e,i,r){if(t[2]&&r){const s=t[2](r(i));if(e.dirty===void 0)return s;if(typeof s=="object"){const n=[],o=Math.max(e.dirty.length,s.length);for(let a=0;a<o;a+=1)n[a]=e.dirty[a]|s[a];return n}return e.dirty|s}return e.dirty}function Vve(t,e,i,r,s,n){if(s){const o=Uve(e,i,r,n);t.p(o,s)}}function Bve(t){if(t.ctx.length>32){const e=[],i=t.ctx.length/32;for(let r=0;r<i;r++)e[r]=-1;return e}return-1}function toe(t){return t??""}const Gve=typeof window<"u";let Vke=Gve?()=>window.performance.now():()=>Date.now(),$K=Gve?t=>requestAnimationFrame(t):el;const OC=new Set;function jve(t){OC.forEach(e=>{e.c(t)||(OC.delete(e),e.f())}),OC.size!==0&&$K(jve)}function Bke(t){let e;return OC.size===0&&$K(jve),{promise:new Promise(i=>{OC.add(e={c:t,f:i})}),abort(){OC.delete(e)}}}function Fe(t,e){t.appendChild(e)}function Hve(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function Gke(t){const e=ut("style");return e.textContent="/* empty */",jke(Hve(t),e),e.sheet}function jke(t,e){return Fe(t.head||t,e),e.sheet}function Ss(t,e,i){t.insertBefore(e,i||null)}function rs(t){t.parentNode&&t.parentNode.removeChild(t)}function D3(t,e){for(let i=0;i<t.length;i+=1)t[i]&&t[i].d(e)}function ut(t){return document.createElement(t)}function Jo(t){return document.createTextNode(t)}function Dr(){return Jo(" ")}function zV(){return Jo("")}function qve(t,e,i,r){return t.addEventListener(e,i,r),()=>t.removeEventListener(e,i,r)}function Se(t,e,i){i==null?t.removeAttribute(e):t.getAttribute(e)!==i&&t.setAttribute(e,i)}function Hke(t){return Array.from(t.childNodes)}function pu(t,e){e=""+e,t.data!==e&&(t.data=e)}function Ud(t,e,i,r){i==null?t.style.removeProperty(e):t.style.setProperty(e,i,r?"important":"")}function Wve(t,e,{bubbles:i=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:i,cancelable:r})}const Kk=new Map;let eU=0;function qke(t){let e=5381,i=t.length;for(;i--;)e=(e<<5)-e^t.charCodeAt(i);return e>>>0}function Wke(t,e){const i={stylesheet:Gke(e),rules:{}};return Kk.set(t,i),i}function Yke(t,e,i,r,s,n,o,a=0){const l=16.666/r;let c=`{
`;for(let v=0;v<=1;v+=l){const b=e+(i-e)*n(v);c+=v*100+`%{${o(b,1-b)}}
`}const u=c+`100% {${o(i,1-i)}}
}`,d=`__svelte_${qke(u)}_${a}`,p=Hve(t),{stylesheet:m,rules:g}=Kk.get(p)||Wke(p,t);g[d]||(g[d]=!0,m.insertRule(`@keyframes ${d} ${u}`,m.cssRules.length));const y=t.style.animation||"";return t.style.animation=`${y?`${y}, `:""}${d} ${r}ms linear ${s}ms 1 both`,eU+=1,d}function ioe(t,e){const i=(t.style.animation||"").split(", "),r=i.filter(e?n=>n.indexOf(e)<0:n=>n.indexOf("__svelte")===-1),s=i.length-r.length;s&&(t.style.animation=r.join(", "),eU-=s,eU||Zke())}function Zke(){$K(()=>{eU||(Kk.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&rs(e)}),Kk.clear())})}let AI;function O$(t){AI=t}function IK(){if(!AI)throw new Error("Function called outside component initialization");return AI}function _1(t){IK().$$.on_mount.push(t)}function Xke(t){IK().$$.on_destroy.push(t)}function Jke(){const t=IK();return(e,i,{cancelable:r=!1}={})=>{const s=t.$$.callbacks[e];if(s){const n=Wve(e,i,{cancelable:r});return s.slice().forEach(o=>{o.call(t,n)}),!n.defaultPrevented}return!0}}const Z2=[],v9=[];let RC=[];const roe=[],Qke=Promise.resolve();let b9=!1;function Kke(){b9||(b9=!0,Qke.then(Yve))}function wc(t){RC.push(t)}const Bj=new Set;let FT=0;function Yve(){if(FT!==0)return;const t=AI;do{try{for(;FT<Z2.length;){const e=Z2[FT];FT++,O$(e),eUe(e.$$)}}catch(e){throw Z2.length=0,FT=0,e}for(O$(null),Z2.length=0,FT=0;v9.length;)v9.pop()();for(let e=0;e<RC.length;e+=1){const i=RC[e];Bj.has(i)||(Bj.add(i),i())}RC.length=0}while(Z2.length);for(;roe.length;)roe.pop()();b9=!1,Bj.clear(),O$(t)}function eUe(t){if(t.fragment!==null){t.update(),L3(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(wc)}}function tUe(t){const e=[],i=[];RC.forEach(r=>t.indexOf(r)===-1?e.push(r):i.push(r)),i.forEach(r=>r()),RC=e}let uP;function iUe(){return uP||(uP=Promise.resolve(),uP.then(()=>{uP=null})),uP}function soe(t,e,i){t.dispatchEvent(Wve(`intro${i}`))}const x4=new Set;let Bx;function Zve(){Bx={r:0,c:[],p:Bx}}function Xve(){Bx.r||L3(Bx.c),Bx=Bx.p}function $s(t,e){t&&t.i&&(x4.delete(t),t.i(e))}function Ha(t,e,i,r){if(t&&t.o){if(x4.has(t))return;x4.add(t),Bx.c.push(()=>{x4.delete(t),r&&(i&&t.d(1),r())}),t.o(e)}else r&&r()}const rUe={duration:0};function ff(t,e,i){const r={direction:"in"};let s=e(t,i,r),n=!1,o,a,l=0;function c(){o&&ioe(t,o)}function u(){const{delay:p=0,duration:m=300,easing:g=Nve,tick:y=el,css:v}=s||rUe;v&&(o=Yke(t,0,1,m,p,g,v,l++)),y(0,1);const b=Vke()+p,w=b+m;a&&a.abort(),n=!0,wc(()=>soe(t,!0,"start")),a=Bke(x=>{if(n){if(x>=w)return y(1,0),soe(t,!0,"end"),c(),n=!1;if(x>=b){const T=g((x-b)/m);y(T,1-T)}}return n})}let d=!1;return{start(){d||(d=!0,ioe(t),RK(s)?(s=s(r),iUe().then(u)):u())},invalidate(){d=!1},end(){n&&(c(),n=!1)}}}function bg(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Yp(t){t&&t.c()}function _d(t,e,i){const{fragment:r,after_update:s}=t.$$;r&&r.m(e,i),wc(()=>{const n=t.$$.on_mount.map(Fve).filter(RK);t.$$.on_destroy?t.$$.on_destroy.push(...n):L3(n),t.$$.on_mount=[]}),s.forEach(wc)}function vd(t,e){const i=t.$$;i.fragment!==null&&(tUe(i.after_update),L3(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}function sUe(t,e){t.$$.dirty[0]===-1&&(Z2.push(t),Kke(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function N0(t,e,i,r,s,n,o=null,a=[-1]){const l=AI;O$(t);const c=t.$$={fragment:null,ctx:[],props:n,update:el,not_equal:s,bound:Kne(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Kne(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(c.root);let u=!1;if(c.ctx=i?i(t,e.props||{},(d,p,...m)=>{const g=m.length?m[0]:p;return c.ctx&&s(c.ctx[d],c.ctx[d]=g)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](g),u&&sUe(t,d)),p}):[],c.update(),u=!0,L3(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const d=Hke(e.target);c.fragment&&c.fragment.l(d),d.forEach(rs)}else c.fragment&&c.fragment.c();e.intro&&$s(t.$$.fragment),_d(t,e.target,e.anchor),Yve()}O$(l)}class F0{constructor(){Vj(this,"$$");Vj(this,"$$set")}$destroy(){vd(this,1),this.$destroy=el}$on(e,i){if(!RK(i))return el;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(i),()=>{const s=r.indexOf(i);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!zke(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const nUe="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(nUe);function noe(t,e,i){const r=t.slice();return r[7]=e[i],r}function ooe(t){let e,i,r=t[7][0]+"",s,n,o,a;return{c(){e=ut("li"),i=ut("a"),s=Jo(r),a=Dr(),Se(i,"class",n="nav-link text-"+t[4]),Se(i,"href",o=t[7][1]),Se(e,"class","nav-item")},m(l,c){Ss(l,e,c),Fe(e,i),Fe(i,s),Fe(e,a)},p(l,c){c&4&&r!==(r=l[7][0]+"")&&pu(s,r),c&16&&n!==(n="nav-link text-"+l[4])&&Se(i,"class",n),c&4&&o!==(o=l[7][1])&&Se(i,"href",o)},d(l){l&&rs(e)}}}function oUe(t){let e,i,r,s,n,o,a,l,c,u,d,p,m,g,y,v,b,w=bg(t[2]),x=[];for(let T=0;T<w.length;T+=1)x[T]=ooe(noe(t,w,T));return{c(){e=ut("div"),i=ut("nav"),r=ut("div"),s=ut("a"),n=ut("strong"),o=Jo(t[1]),a=Dr(),l=ut("button"),l.innerHTML='<i class="fas fa-bars"></i>',c=Dr(),u=ut("div"),d=ut("ul");for(let T=0;T<x.length;T+=1)x[T].c();p=Dr(),m=ut("li"),g=ut("a"),y=ut("i"),Se(s,"class","navbar-brand text-primary"),Se(s,"href","/"),Se(l,"class","navbar-toggler"),Se(l,"type","button"),Se(l,"data-mdb-toggle","collapse"),Se(l,"data-mdb-target","#navbarSupportedContent"),Se(l,"aria-controls","navbarSupportedContent"),Se(l,"aria-expanded","false"),Se(l,"aria-label","Toggle navigation"),Se(y,"class","fab fa-github"),Se(g,"class",v="nav-link text-"+t[4]),Se(g,"href",t[3]),Se(d,"class","navbar-nav ms-auto mb-2 mb-lg-0"),Se(u,"class","collapse navbar-collapse"),Se(u,"id","navbarSupportedContent"),Se(r,"class","container-fluid"),Se(i,"class",b="navbar navbar-expand-lg navbar-"+t[5]+" bg-"+t[5]+" shadow-0 fixed-top px-3 py-3"),Se(i,"id",t[0]),Se(e,"class","container")},m(T,C){Ss(T,e,C),Fe(e,i),Fe(i,r),Fe(r,s),Fe(s,n),Fe(n,o),Fe(r,a),Fe(r,l),Fe(r,c),Fe(r,u),Fe(u,d);for(let M=0;M<x.length;M+=1)x[M]&&x[M].m(d,null);Fe(d,p),Fe(d,m),Fe(m,g),Fe(g,y)},p(T,[C]){if(C&2&&pu(o,T[1]),C&20){w=bg(T[2]);let M;for(M=0;M<w.length;M+=1){const O=noe(T,w,M);x[M]?x[M].p(O,C):(x[M]=ooe(O),x[M].c(),x[M].m(d,p))}for(;M<x.length;M+=1)x[M].d(1);x.length=w.length}C&16&&v!==(v="nav-link text-"+T[4])&&Se(g,"class",v),C&8&&Se(g,"href",T[3]),C&32&&b!==(b="navbar navbar-expand-lg navbar-"+T[5]+" bg-"+T[5]+" shadow-0 fixed-top px-3 py-3")&&Se(i,"class",b),C&1&&Se(i,"id",T[0])},i:el,o:el,d(T){T&&rs(e),D3(x,T)}}}function aUe(t,e,i){let{Id:r}=e,{brand:s}=e,{nav_items:n}=e,{github:o}=e,{state:a}=e,l="dark",c="light";return a=="dark"&&(l="light",c="dark"),t.$$set=u=>{"Id"in u&&i(0,r=u.Id),"brand"in u&&i(1,s=u.brand),"nav_items"in u&&i(2,n=u.nav_items),"github"in u&&i(3,o=u.github),"state"in u&&i(6,a=u.state)},[r,s,n,o,l,c,a]}class lUe extends F0{constructor(e){super(),N0(this,e,aUe,oUe,D0,{Id:0,brand:1,nav_items:2,github:3,state:6})}}function cUe(t){let e,i,r,s=new Date().getFullYear()+"",n,o,a,l,c,u;return{c(){e=ut("footer"),i=ut("div"),r=Jo("Â© "),n=Jo(s),o=Jo(` Copyright:
        `),a=ut("a"),l=Jo(t[1]),Se(a,"class",c="text-"+t[2]),Se(a,"href","/"),Se(i,"class","text-center p-3"),Se(e,"class",u="bg-"+t[3]+" text-center text-"+t[2]),Se(e,"id",t[0])},m(d,p){Ss(d,e,p),Fe(e,i),Fe(i,r),Fe(i,n),Fe(i,o),Fe(i,a),Fe(a,l)},p(d,[p]){p&2&&pu(l,d[1]),p&4&&c!==(c="text-"+d[2])&&Se(a,"class",c),p&12&&u!==(u="bg-"+d[3]+" text-center text-"+d[2])&&Se(e,"class",u),p&1&&Se(e,"id",d[0])},i:el,o:el,d(d){d&&rs(e)}}}function uUe(t,e,i){let{Id:r}=e,{brand:s}=e,{state:n}=e,o="dark",a="light";return n=="dark"&&(o="light",a="dark"),t.$$set=l=>{"Id"in l&&i(0,r=l.Id),"brand"in l&&i(1,s=l.brand),"state"in l&&i(4,n=l.state)},[r,s,o,a,n]}class hUe extends F0{constructor(e){super(),N0(this,e,uUe,cUe,D0,{Id:0,brand:1,state:4})}}function dUe(t){const e=t-1;return e*e*e+1}function v1(t,{delay:e=0,duration:i=400,easing:r=Nve}={}){const s=+getComputedStyle(t).opacity;return{delay:e,duration:i,easing:r,css:n=>`opacity: ${n*s}`}}function LK(t,{delay:e=0,duration:i=400,easing:r=dUe,axis:s="y"}={}){const n=getComputedStyle(t),o=+n.opacity,a=s==="y"?"height":"width",l=parseFloat(n[a]),c=s==="y"?["top","bottom"]:["left","right"],u=c.map(b=>`${b[0].toUpperCase()}${b.slice(1)}`),d=parseFloat(n[`padding${u[0]}`]),p=parseFloat(n[`padding${u[1]}`]),m=parseFloat(n[`margin${u[0]}`]),g=parseFloat(n[`margin${u[1]}`]),y=parseFloat(n[`border${u[0]}Width`]),v=parseFloat(n[`border${u[1]}Width`]);return{delay:e,duration:i,easing:r,css:b=>`overflow: hidden;opacity: ${Math.min(b*20,1)*o};${a}: ${b*l}px;padding-${c[0]}: ${b*d}px;padding-${c[1]}: ${b*p}px;margin-${c[0]}: ${b*m}px;margin-${c[1]}: ${b*g}px;border-${c[0]}-width: ${b*y}px;border-${c[1]}-width: ${b*v}px;`}}function pUe(t){let e,i,r;const s=t[10].default,n=kve(s,t,t[9],null);return{c(){e=ut("div"),n&&n.c(),Se(e,"style",i="animation: "+t[1]+"; "+t[3])},m(o,a){Ss(o,e,a),n&&n.m(e,null),r=!0},p(o,a){n&&n.p&&(!r||a&512)&&Vve(n,s,o,o[9],r?zve(s,o[9],a,null):Bve(o[9]),null),(!r||a&10&&i!==(i="animation: "+o[1]+"; "+o[3]))&&Se(e,"style",i)},i(o){r||($s(n,o),r=!0)},o(o){Ha(n,o),r=!1},d(o){o&&rs(e),n&&n.d(o)}}}function fUe(t){let e,i,r;const s=t[10].default,n=kve(s,t,t[9],null);return{c(){e=ut("div"),n&&n.c(),Se(e,"style",i="animation: "+t[0]+"; "+t[3])},m(o,a){Ss(o,e,a),n&&n.m(e,null),r=!0},p(o,a){n&&n.p&&(!r||a&512)&&Vve(n,s,o,o[9],r?zve(s,o[9],a,null):Bve(o[9]),null),(!r||a&9&&i!==(i="animation: "+o[0]+"; "+o[3]))&&Se(e,"style",i)},i(o){r||($s(n,o),r=!0)},o(o){Ha(n,o),r=!1},d(o){o&&rs(e),n&&n.d(o)}}}function mUe(t){let e,i,r,s;const n=[fUe,pUe],o=[];function a(l,c){return l[4]?0:1}return i=a(t),r=o[i]=n[i](t),{c(){e=ut("div"),r.c(),Se(e,"id",t[5]),Se(e,"style",t[2])},m(l,c){Ss(l,e,c),o[i].m(e,null),s=!0},p(l,[c]){let u=i;i=a(l),i===u?o[i].p(l,c):(Zve(),Ha(o[u],1,1,()=>{o[u]=null}),Xve(),r=o[i],r?r.p(l,c):(r=o[i]=n[i](l),r.c()),$s(r,1),r.m(e,null)),(!s||c&4)&&Se(e,"style",l[2])},i(l){s||($s(r),s=!0)},o(l){Ha(r),s=!1},d(l){l&&rs(e),o[i].d()}}}function gUe(t,e,i){let{$$slots:r={},$$scope:s}=e,{animation:n="none"}=e,{animation_out:o="none; opacity: 0"}=e,{once:a=!1}=e,{top:l=0}=e,{bottom:c=0}=e,{css_observer:u=""}=e,{css_animation:d=""}=e;const p=Jke();let m=!0;const g=`__saos-${Math.random()}__`;function y(b){const w=`${-c}px 0px ${-l}px 0px`,x=new IntersectionObserver(T=>{i(4,m=T[0].isIntersecting),m&&a&&x.unobserve(b)},{rootMargin:w});return x.observe(b),()=>x.unobserve(b)}function v(b){const w=b.getBoundingClientRect();return i(4,m=w.top+l<window.innerHeight&&w.bottom-c>0),m&&a&&window.removeEventListener("scroll",verify),window.addEventListener("scroll",v),()=>window.removeEventListener("scroll",v)}return _1(()=>{const b=document.getElementById(g);return IntersectionObserver?y(b):v(b)}),t.$$set=b=>{"animation"in b&&i(0,n=b.animation),"animation_out"in b&&i(1,o=b.animation_out),"once"in b&&i(6,a=b.once),"top"in b&&i(7,l=b.top),"bottom"in b&&i(8,c=b.bottom),"css_observer"in b&&i(2,u=b.css_observer),"css_animation"in b&&i(3,d=b.css_animation),"$$scope"in b&&i(9,s=b.$$scope)},t.$$.update=()=>{t.$$.dirty&16&&p("update",{observing:m})},[n,o,u,d,m,g,a,l,c,s,r]}class VV extends F0{constructor(e){super(),N0(this,e,gUe,mUe,D0,{animation:0,animation_out:1,once:6,top:7,bottom:8,css_observer:2,css_animation:3})}}function aoe(t){let e,i,r,s,n,o,a,l,c,u;return{c(){e=ut("div"),i=ut("span"),s=Dr(),n=ut("span"),a=Dr(),l=ut("span"),Se(i,"class","fw-bold d-block display-3 text-primary"),Se(n,"class","fw-bold d-block display-1 rolling-text-2"),Se(l,"class",c="fw-bold "+t[2]+" display-5 svelte-n9nbmd"),Ud(l,"opacity","0.7"),Se(e,"class","col-md-6 mb-3 text-uppercase")},m(d,p){Ss(d,e,p),Fe(e,i),i.innerHTML=t[3],Fe(e,s),Fe(e,n),n.innerHTML=t[4],Fe(e,a),Fe(e,l),l.innerHTML=t[5]},p(d,p){p&8&&(i.innerHTML=d[3]),p&16&&(n.innerHTML=d[4]),p&32&&(l.innerHTML=d[5]),p&4&&c!==(c="fw-bold "+d[2]+" display-5 svelte-n9nbmd")&&Se(l,"class",c)},i(d){d&&(r||wc(()=>{r=ff(i,v1,{duration:500}),r.start()})),d&&(o||wc(()=>{o=ff(n,LK,{delay:250,duration:500}),o.start()})),d&&(u||wc(()=>{u=ff(l,v1,{delay:100,duration:500}),u.start()}))},o:el,d(d){d&&rs(e)}}}function yUe(t){let e,i=t[1]&&aoe(t);return{c(){i&&i.c(),e=zV()},m(r,s){i&&i.m(r,s),Ss(r,e,s)},p(r,s){r[1]?i?(i.p(r,s),s&2&&$s(i,1)):(i=aoe(r),i.c(),$s(i,1),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},d(r){r&&rs(e),i&&i.d(r)}}}function _Ue(t){let e,i,r,s,n,o,a;return r=new VV({props:{animation:"",$$slots:{default:[yUe]},$$scope:{ctx:t}}}),{c(){e=ut("div"),i=ut("div"),Yp(r.$$.fragment),s=Dr(),n=ut("div"),Se(n,"class","col-md-6 mb-3"),Se(i,"class","row container"),Se(e,"class",o="text-"+t[2]+" d-flex justify-content-center align-items-center min-vh-100 svelte-n9nbmd"),Se(e,"id",t[0]),Ud(e,"padding-top","58px"),Ud(e,"background-color","transparent",1)},m(l,c){Ss(l,e,c),Fe(e,i),_d(r,i,null),Fe(i,s),Fe(i,n),a=!0},p(l,[c]){const u={};c&1048638&&(u.$$scope={dirty:c,ctx:l}),r.$set(u),(!a||c&4&&o!==(o="text-"+l[2]+" d-flex justify-content-center align-items-center min-vh-100 svelte-n9nbmd"))&&Se(e,"class",o),(!a||c&1)&&Se(e,"id",l[0])},i(l){a||($s(r.$$.fragment,l),a=!0)},o(l){Ha(r.$$.fragment,l),a=!1},d(l){l&&rs(e),vd(r)}}}const loe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+-=[]{}|;:',.<>?/~";function tD(t){return t.replace(/{(.*?)}/g,'<span class="text-shadows" data-text="$1">$1</span>')}function iD(t,e,i=0){let r=0,s="";const n=t.replace(/<[^>]+>/g,""),o=t.match(/<[^>]+>/g)||[];let a=0;return setTimeout(()=>{const l=setInterval(()=>{if(r<n.length){n[r];const c=loe[Math.floor(Math.random()*loe.length)];s=n.slice(0,r)+c,o[a]&&s.length>=n.indexOf(o[a].replace(/<[^>]+>/g,""))&&(s+=o[a],a++),e(s),(Math.random()<.3||s.length>=r+10)&&(s=n.slice(0,r+1),o[a]&&s.length>=n.indexOf(o[a].replace(/<[^>]+>/g,""))&&(s+=o[a],a++),e(s),r++,r===n.length&&(clearInterval(l),e(t)))}else e(t),clearInterval(l)},50);return l},i)}function vUe(t,e,i){let r=!1;_1(()=>i(1,r=!0));let{Id:s}=e,{header_title_1:n}=e,{header_title_2:o}=e,{header_title_3:a}=e,{state:l}=e,c="dark";l=="dark"&&(c="light");let u="",d="",p="",m,g,y,v;function b(){m=iD(tD(n),x),g=iD(tD(o),T,500),Array.isArray(a)?w(a,C,1e3):y=iD(tD(a),C,1e3)}function w(M,O,D=0){let k=0;const U=()=>{const H=tD(M[k]);iD(H,O),k=(k+1)%M.length};v=setInterval(U,D+3e3),U()}function x(M){i(3,u=M)}function T(M){i(4,d=M)}function C(M){i(5,p=M)}return _1(()=>(b(),()=>{clearInterval(m),clearInterval(g),clearInterval(y),clearInterval(v)})),t.$$set=M=>{"Id"in M&&i(0,s=M.Id),"header_title_1"in M&&i(6,n=M.header_title_1),"header_title_2"in M&&i(7,o=M.header_title_2),"header_title_3"in M&&i(8,a=M.header_title_3),"state"in M&&i(9,l=M.state)},[s,r,c,u,d,p,n,o,a,l]}class bUe extends F0{constructor(e){super(),N0(this,e,vUe,_Ue,D0,{Id:0,header_title_1:6,header_title_2:7,header_title_3:8,state:9})}}function coe(t,e,i){const r=t.slice();return r[11]=e[i][0],r[12]=e[i][1],r}function uoe(t,e,i){const r=t.slice();return r[15]=e[i],r}function hoe(t){let e;function i(n,o){return n[8]?xUe:wUe}let r=i(t),s=r(t);return{c(){e=ut("div"),s.c(),Se(e,"class","container text-center transition-container svelte-1ygd8ce")},m(n,o){Ss(n,e,o),s.m(e,null)},p(n,o){r===(r=i(n))&&s?s.p(n,o):(s.d(1),s=r(n),s&&(s.c(),$s(s,1),s.m(e,null)))},d(n){n&&rs(e),s.d()}}}function wUe(t){let e,i,r,s,n,o,a=t[8]?"View Skills":"View About Me",l,c,u,d,p,m,g,y,v,b=bg(Object.entries(t[2])),w=[];for(let x=0;x<b.length;x+=1)w[x]=poe(coe(t,b,x));return{c(){e=ut("div"),i=ut("div"),r=ut("h1"),s=Jo(t[1]),n=Dr(),o=ut("button"),l=Jo(a),c=Dr(),u=ut("hr"),d=Dr(),p=ut("div");for(let x=0;x<w.length;x+=1)w[x].c();Se(o,"class","custom-button mb-4 svelte-1ygd8ce"),Se(r,"class","content-header fw-bold text-primary mb-5 svelte-1ygd8ce"),Se(u,"class","mb-5"),Se(p,"class","row justify-content-center"),Se(i,"class","col-12"),Se(e,"class","row")},m(x,T){Ss(x,e,T),Fe(e,i),Fe(i,r),Fe(r,s),Fe(r,n),Fe(r,o),Fe(o,l),Fe(i,c),Fe(i,u),Fe(i,d),Fe(i,p);for(let C=0;C<w.length;C+=1)w[C]&&w[C].m(p,null);y||(v=qve(o,"click",t[9]),y=!0)},p(x,T){if(T&2&&pu(s,x[1]),T&256&&a!==(a=x[8]?"View Skills":"View About Me")&&pu(l,a),T&132){b=bg(Object.entries(x[2]));let C;for(C=0;C<b.length;C+=1){const M=coe(x,b,C);w[C]?w[C].p(M,T):(w[C]=poe(M),w[C].c(),w[C].m(p,null))}for(;C<w.length;C+=1)w[C].d(1);w.length=b.length}},i(x){x&&(m||wc(()=>{m=ff(p,v1,{delay:1e3,duration:1e3}),m.start()})),x&&(g||wc(()=>{g=ff(i,v1,{duration:1e3}),g.start()}))},o:el,d(x){x&&rs(e),D3(w,x),y=!1,v()}}}function xUe(t){let e,i,r,s,n,o,a=t[8]?"View Skills":"View About Me",l,c,u,d,p,m,g,y,v,b,w,x;return{c(){e=ut("div"),i=ut("div"),r=ut("h1"),s=Jo(t[3]),n=Dr(),o=ut("button"),l=Jo(a),c=Dr(),u=ut("hr"),d=Dr(),p=ut("p"),m=Jo(t[4]),y=Dr(),v=ut("div"),v.innerHTML='<a href="../assets/Deutsch_Dark.pdf" download="" class="custom-button svelte-1ygd8ce">Download German (Dark)</a> <a href="../assets/Deutsch_Light.pdf" download="" class="custom-button svelte-1ygd8ce">Download German (Light)</a> <a href="../assets/English_Dark.pdf" download="" class="custom-button svelte-1ygd8ce">Download English (Dark)</a> <a href="../assets/English_Light.pdf" download="" class="custom-button svelte-1ygd8ce">Download English (Light)</a>',Se(o,"class","custom-button mb-4 svelte-1ygd8ce"),Se(r,"class","content-header fw-bold text-primary mb-5 svelte-1ygd8ce"),Se(u,"class","mb-5"),Se(p,"class","bio-text svelte-1ygd8ce"),Se(v,"class","flex flex-row"),Ud(v,"margin-top","50px"),Se(i,"class","col-12 mb-3"),Se(e,"class","row")},m(T,C){Ss(T,e,C),Fe(e,i),Fe(i,r),Fe(r,s),Fe(r,n),Fe(r,o),Fe(o,l),Fe(i,c),Fe(i,u),Fe(i,d),Fe(i,p),Fe(p,m),Fe(i,y),Fe(i,v),w||(x=qve(o,"click",t[9]),w=!0)},p(T,C){C&8&&pu(s,T[3]),C&256&&a!==(a=T[8]?"View Skills":"View About Me")&&pu(l,a),C&16&&pu(m,T[4])},i(T){T&&(g||wc(()=>{g=ff(p,v1,{delay:500,duration:1e3}),g.start()})),T&&(b||wc(()=>{b=ff(i,v1,{duration:1e3}),b.start()}))},o:el,d(T){T&&rs(e),w=!1,x()}}}function doe(t){let e,i,r,s,n=t[15][0]+"",o,a,l,c,u,d;return{c(){e=ut("p"),i=ut("i"),s=Dr(),o=Jo(n),a=Dr(),l=ut("div"),c=ut("div"),Se(i,"class",r=toe(t[15][1])+" svelte-1ygd8ce"),Se(e,"class","fw-bold"),Se(c,"class","progress-bar bg-primary animate svelte-1ygd8ce"),Se(c,"role","progressbar"),Ud(c,"--size",t[15][2]+"%"),Se(c,"aria-valuenow",u=t[15][2]),Se(c,"aria-valuemin","0"),Se(c,"aria-valuemax","100"),Se(l,"class",d="progress progress-bar-striped progress-bar-animated bg-"+t[7]+" mb-3 svelte-1ygd8ce")},m(p,m){Ss(p,e,m),Fe(e,i),Fe(e,s),Fe(e,o),Ss(p,a,m),Ss(p,l,m),Fe(l,c)},p(p,m){m&4&&r!==(r=toe(p[15][1])+" svelte-1ygd8ce")&&Se(i,"class",r),m&4&&n!==(n=p[15][0]+"")&&pu(o,n),m&4&&Ud(c,"--size",p[15][2]+"%"),m&4&&u!==(u=p[15][2])&&Se(c,"aria-valuenow",u),m&128&&d!==(d="progress progress-bar-striped progress-bar-animated bg-"+p[7]+" mb-3 svelte-1ygd8ce")&&Se(l,"class",d)},d(p){p&&(rs(e),rs(a),rs(l))}}}function poe(t){let e,i,r=t[11]+"",s,n,o,a=bg(t[12]),l=[];for(let c=0;c<a.length;c+=1)l[c]=doe(uoe(t,a,c));return{c(){e=ut("div"),i=ut("h3"),s=Jo(r),n=Dr();for(let c=0;c<l.length;c+=1)l[c].c();o=Dr(),Se(i,"class","text-secondary svelte-1ygd8ce"),Se(e,"class","col-12 col-md-6 col-lg-4 mb-4")},m(c,u){Ss(c,e,u),Fe(e,i),Fe(i,s),Fe(e,n);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(e,null);Fe(e,o)},p(c,u){if(u&4&&r!==(r=c[11]+"")&&pu(s,r),u&132){a=bg(c[12]);let d;for(d=0;d<a.length;d+=1){const p=uoe(c,a,d);l[d]?l[d].p(p,u):(l[d]=doe(p),l[d].c(),l[d].m(e,o))}for(;d<l.length;d+=1)l[d].d(1);l.length=a.length}},d(c){c&&rs(e),D3(l,c)}}}function SUe(t){let e,i=t[5]&&hoe(t);return{c(){i&&i.c(),e=zV()},m(r,s){i&&i.m(r,s),Ss(r,e,s)},p(r,s){r[5]?i?i.p(r,s):(i=hoe(r),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},d(r){r&&rs(e),i&&i.d(r)}}}function TUe(t){let e,i,r,s;return i=new VV({props:{animation:"",$$slots:{default:[SUe]},$$scope:{ctx:t}}}),{c(){e=ut("div"),Yp(i.$$.fragment),Se(e,"class",r="bg-"+t[7]+" text-"+t[6]+" d-flex justify-content-center align-items-center min-vh-100 svelte-1ygd8ce"),Se(e,"id",t[0]),Ud(e,"padding-top","58px"),Ud(e,"background-color","transparent",1)},m(n,o){Ss(n,e,o),_d(i,e,null),s=!0},p(n,[o]){const a={};o&262590&&(a.$$scope={dirty:o,ctx:n}),i.$set(a),(!s||o&192&&r!==(r="bg-"+n[7]+" text-"+n[6]+" d-flex justify-content-center align-items-center min-vh-100 svelte-1ygd8ce"))&&Se(e,"class",r),(!s||o&1)&&Se(e,"id",n[0])},i(n){s||($s(i.$$.fragment,n),s=!0)},o(n){Ha(i.$$.fragment,n),s=!1},d(n){n&&rs(e),vd(i)}}}function EUe(t,e,i){let r=!1;_1(()=>i(5,r=!0));let{Id:s}=e,{skills_title:n}=e,{skills:o}=e,{bio_title:a}=e,{bio:l}=e,{state:c}=e,u="dark",d="light";c=="dark"&&(u="light",d="dark");let p=!0;function m(){i(8,p=!p)}return t.$$set=g=>{"Id"in g&&i(0,s=g.Id),"skills_title"in g&&i(1,n=g.skills_title),"skills"in g&&i(2,o=g.skills),"bio_title"in g&&i(3,a=g.bio_title),"bio"in g&&i(4,l=g.bio),"state"in g&&i(10,c=g.state)},[s,n,o,a,l,r,u,d,p,m,c]}class CUe extends F0{constructor(e){super(),N0(this,e,EUe,TUe,D0,{Id:0,skills_title:1,skills:2,bio_title:3,bio:4,state:10})}}function foe(t,e,i){const r=t.slice();return r[7]=e[i],r}function moe(t){let e,i,r,s,n,o,a,l,c,u=bg(t[2]),d=[];for(let p=0;p<u.length;p+=1)d[p]=goe(foe(t,u,p));return{c(){e=ut("div"),i=ut("div"),r=ut("h1"),s=Jo(t[1]),o=Dr(),a=ut("hr"),l=Dr(),c=ut("div");for(let p=0;p<d.length;p+=1)d[p].c();Se(r,"class","fw-bold text-primary"),Se(i,"class","mb-5"),Se(a,"class","mb-5"),Se(c,"class","flex-container svelte-1ki9vdn"),Se(e,"class","container text-center")},m(p,m){Ss(p,e,m),Fe(e,i),Fe(i,r),Fe(r,s),Fe(e,o),Fe(e,a),Fe(e,l),Fe(e,c);for(let g=0;g<d.length;g+=1)d[g]&&d[g].m(c,null)},p(p,m){if(m&2&&pu(s,p[1]),m&20){u=bg(p[2]);let g;for(g=0;g<u.length;g+=1){const y=foe(p,u,g);d[g]?(d[g].p(y,m),$s(d[g],1)):(d[g]=goe(y),d[g].c(),$s(d[g],1),d[g].m(c,null))}for(;g<d.length;g+=1)d[g].d(1);d.length=u.length}},i(p){p&&(n||wc(()=>{n=ff(i,LK,{duration:1e3}),n.start()}));for(let m=0;m<u.length;m+=1)$s(d[m])},o:el,d(p){p&&rs(e),D3(d,p)}}}function goe(t){let e,i,r,s,n,o,a,l,c,u=t[7][0]+"",d,p,m,g=t[7][1]+"",y,v,b,w,x;return{c(){e=ut("div"),i=ut("a"),r=ut("div"),s=ut("img"),a=Dr(),l=ut("div"),c=ut("h5"),d=Jo(u),p=Dr(),m=ut("p"),y=Jo(g),w=Dr(),Se(s,"class","card-img-top project-image svelte-1ki9vdn"),eoe(s.src,n=t[7][2])||Se(s,"src",n),Se(s,"alt",o=t[7][0]),Se(c,"class","card-title text-primary fw-bold"),Se(m,"class","card-text"),Se(l,"class","card-body"),Se(r,"class","card svelte-1ki9vdn"),Se(i,"class",v="text-"+t[4]+" svelte-1ki9vdn"),Se(i,"href",b=t[7][3]),Se(i,"target","_blank"),Se(e,"class","project-card svelte-1ki9vdn")},m(T,C){Ss(T,e,C),Fe(e,i),Fe(i,r),Fe(r,s),Fe(r,a),Fe(r,l),Fe(l,c),Fe(c,d),Fe(l,p),Fe(l,m),Fe(m,y),Fe(e,w)},p(T,C){C&4&&!eoe(s.src,n=T[7][2])&&Se(s,"src",n),C&4&&o!==(o=T[7][0])&&Se(s,"alt",o),C&4&&u!==(u=T[7][0]+"")&&pu(d,u),C&4&&g!==(g=T[7][1]+"")&&pu(y,g),C&16&&v!==(v="text-"+T[4]+" svelte-1ki9vdn")&&Se(i,"class",v),C&4&&b!==(b=T[7][3])&&Se(i,"href",b)},i(T){T&&(x||wc(()=>{x=ff(e,v1,{delay:500,duration:1500}),x.start()}))},o:el,d(T){T&&rs(e)}}}function MUe(t){let e,i=t[3]&&moe(t);return{c(){i&&i.c(),e=zV()},m(r,s){i&&i.m(r,s),Ss(r,e,s)},p(r,s){r[3]?i?(i.p(r,s),s&8&&$s(i,1)):(i=moe(r),i.c(),$s(i,1),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},d(r){r&&rs(e),i&&i.d(r)}}}function AUe(t){let e,i,r,s;return i=new VV({props:{animation:"",$$slots:{default:[MUe]},$$scope:{ctx:t}}}),{c(){e=ut("div"),Yp(i.$$.fragment),Se(e,"class",r="text-"+t[4]+" d-flex justify-content-center align-items-center min-vh-100 svelte-1ki9vdn"),Se(e,"id",t[0]),Ud(e,"padding-top","58px"),Ud(e,"background-color","transparent",1)},m(n,o){Ss(n,e,o),_d(i,e,null),s=!0},p(n,[o]){const a={};o&1054&&(a.$$scope={dirty:o,ctx:n}),i.$set(a),(!s||o&16&&r!==(r="text-"+n[4]+" d-flex justify-content-center align-items-center min-vh-100 svelte-1ki9vdn"))&&Se(e,"class",r),(!s||o&1)&&Se(e,"id",n[0])},i(n){s||($s(i.$$.fragment,n),s=!0)},o(n){Ha(i.$$.fragment,n),s=!1},d(n){n&&rs(e),vd(i)}}}function PUe(t,e,i){let r=!1;_1(()=>i(3,r=!0));let{Id:s}=e,{projects_title:n}=e,{projects:o}=e,{state:a}=e,l="dark";return a=="dark"&&(l="light"),t.$$set=c=>{"Id"in c&&i(0,s=c.Id),"projects_title"in c&&i(1,n=c.projects_title),"projects"in c&&i(2,o=c.projects),"state"in c&&i(5,a=c.state)},[s,n,o,r,l,a]}class OUe extends F0{constructor(e){super(),N0(this,e,PUe,AUe,D0,{Id:0,projects_title:1,projects:2,state:5})}}const RUe="modulepreload",$Ue=function(t){return"/"+t},yoe={},fe=function(e,i,r){let s=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),o=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));s=Promise.all(i.map(a=>{if(a=$Ue(a),a in yoe)return;yoe[a]=!0;const l=a.endsWith(".css"),c=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${c}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":RUe,l||(u.as="script",u.crossOrigin=""),u.href=a,o&&u.setAttribute("nonce",o),document.head.appendChild(u),l)return new Promise((d,p)=>{u.addEventListener("load",d),u.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${a}`)))})}))}return s.then(()=>e()).catch(n=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n})};function h(t,e,i,r){var s,n=arguments.length,o=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,i,o):s(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o}function qUt(t,e){return function(i,r){e(i,r,t)}}function WUt(t,e,i,r){function s(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?n(u.value):s(u.value).then(a,l)}c((r=r.apply(t,[])).next())})}let Bv;function re(t){return typeof Bv[t]=="function"?Bv[t]=Bv[t](globalThis):Bv[t]}var Mve,Ave,Pve,Ove;Bv=(Mve=globalThis.dojoConfig)!=null&&Mve.has||(Ave=globalThis.esriConfig)!=null&&Ave.has?{...(Pve=globalThis.dojoConfig)==null?void 0:Pve.has,...(Ove=globalThis.esriConfig)==null?void 0:Ove.has}:{},re.add=(t,e,i,r)=>((r||Bv[t]===void 0)&&(Bv[t]=e),i&&re(t)),re.cache=Bv,re.add("big-integer-warning-enabled",!0),re.add("esri-deprecation-warnings",!0),re.add("esri-tests-disable-screenshots",!1),re.add("esri-tests-use-full-window",!1),re.add("esri-tests-post-to-influx",!0),(()=>{var e;re.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(re.add("host-browser",t),re.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),re.add("dom",t),re("host-browser")){const i=navigator,r=i.userAgent,s=i.appVersion,n=parseFloat(s);if(re.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),re.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),re.add("khtml",s.includes("Konqueror")?n:void 0),re.add("edge",parseFloat(r.split("Edge/")[1])||void 0),re.add("opr",parseFloat(r.split("OPR/")[1])||void 0),re.add("webkit",!re("wp")&&!re("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),re.add("chrome",!re("edge")&&!re("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),re.add("android",!re("wp")&&parseFloat(r.split("Android ")[1])||void 0),re.add("safari",!s.includes("Safari")||re("wp")||re("chrome")||re("android")||re("edge")||re("opr")?void 0:parseFloat(s.split("Version/")[1])),re.add("mac",s.includes("Macintosh")),!re("wp")&&/(iPhone|iPod|iPad)/.test(r)){const o=RegExp.$1.replace(/P/,"p"),a=/OS ([\d_]+)/.test(r)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replaceAll("_",""));re.add(o,l),re.add("ios",l)}re("webkit")||(!r.includes("Gecko")||re("wp")||re("khtml")||re("edge")||re.add("mozilla",n),re("mozilla")&&re.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),i=/iPhone/i.test(t);e&&re.add("esri-mobile",e),i&&re.add("esri-iPhone",i),re.add("esri-geolocation",!!navigator.geolocation)}re.add("esri-wasm","WebAssembly"in globalThis),re.add("esri-performance-mode-frames-between-render",20),re.add("esri-force-performance-mode",!1),re.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),re.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),re.add("esri-atomics","Atomics"in globalThis),re.add("esri-workers","Worker"in globalThis),re.add("web-feat:cache","caches"in globalThis),re.add("esri-workers-arraybuffer-transfer",!re("safari")||Number(re("safari"))>=12),re.add("workers-pool-size",8),re.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),re.add("featurelayer-simplify-payload-size-factors",[1,1,4]),re.add("featurelayer-fast-triangulation-enabled",!0),re.add("featurelayer-animation-enabled",!0),re.add("featurelayer-snapshot-enabled",!0),re.add("featurelayer-snapshot-point-min-threshold",8e4),re.add("featurelayer-snapshot-point-max-threshold",4e5),re.add("featurelayer-snapshot-point-coverage",.1),re.add("featurelayer-query-max-depth",4),re.add("featurelayer-query-pausing-enabled",!1),re.add("featurelayer-advanced-symbols",!1),re.add("featurelayer-pbf",!0),re.add("featurelayer-pbf-statistics",!1),re.add("feature-layers-workers",!0),re.add("feature-polyline-generalization-factor",1),re.add("mapview-transitions-duration",200),re.add("mapview-essential-goto-duration",200),re.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),re.add("mapserver-pbf-version-support",10.81),re.add("mapservice-popup-identify-max-tolerance",20),re("host-webworker")||re("host-browser")&&(re.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),re.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{re.add("esri-image-decode",!0,!0,!0)}).catch(()=>{re.add("esri-image-decode",!1,!0,!0)})}return!1}),re.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();const _oe=new WeakMap;function IUe(t,e,i=!1){const r=`ðŸ›‘ DEPRECATED - ${e}`;if(!i)return void t.warn(r);let s=_oe.get(t);s||(s=new Set,_oe.set(t,s)),s.has(e)||(s.add(e),t.warn(r))}function Jve(t,e,i={}){if(re("esri-deprecation-warnings")){const{moduleName:r}=i;b1(t,`Function: ${(r?r+"::":"")+e+"()"}`,i)}}function LUe(t,e,i={}){if(re("esri-deprecation-warnings")){const{moduleName:r}=i;b1(t,`Property: ${(r?r+"::":"")+e}`,i)}}function DUe(t,e,i={}){re("esri-deprecation-warnings")&&b1(t,`Multiple argument constructor: ${e}`,{warnOnce:!0,replacement:`new ${e}({ <your properties here> })`,...i})}function b1(t,e,i={}){if(re("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:o}=i;let a=e;r&&(a+=`
	ðŸ› ï¸ Replacement: ${r}`),s&&(a+=`
	âš™ï¸ Version: ${s}`),n&&(a+=`
	ðŸ”— See ${n} for more details.`),IUe(t,a,o)}}function YUt(t){const e=[];return function*(){yield*e;for(const i of t)e.push(i),yield i}}function NUe(t,e){for(const i of t)if(i!=null&&e(i))return i}function w9(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let Pg=class{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(i=>{e+=i.length}),e}add(e,i){if(w9(e)){const r=this._getOrCreateGroup(i);for(const s of e)boe(s)&&r.push(s)}else boe(e)&&this._getOrCreateGroup(i).push(e);return this}forEach(e,i){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&i&&r.forEach(i)}}has(e){return this._groups.has(rD(e))}remove(e){if(typeof e!="string"&&w9(e)){for(const i of e)this.remove(i);return this}return this.has(e)?(voe(this._getGroup(e)),this._groups.delete(rD(e)),this):this}removeAll(){return this._groups.forEach(voe),this._groups.clear(),this}removeReference(e){return this._groups.delete(e),this}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const i=[];return this._groups.set(rD(e),i),i}_getGroup(e){return this._groups.get(rD(e))}};function rD(t){return t||"_default_"}function voe(t){for(const e of t)e instanceof Pg?e.removeAll():e.remove()}function boe(t){return t!=null&&(!!t.remove||t instanceof Pg)}let nS=class gw{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*gw._m}getInt(){return this._seed=(gw._a*this._seed+gw._c)%gw._m,this._seed}getFloat(){return this.getInt()/(gw._m-1)}getIntRange(e,i){return Math.round(this.getFloatRange(e,i))}getFloatRange(e,i){const r=i-e;return e+this.getInt()/gw._m*r}};nS._m=2147483647,nS._a=48271,nS._c=0;const BV=1.5,FUe=1/BV,kUe=.5;function GV(t,e){return e?t.filter((i,r,s)=>s.findIndex(e.bind(null,i))===r):Array.from(new Set(t))}function w1(t,e,i){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Qve(t,e){let i=t.length!==e.length;i&&(t.length=e.length);for(let r=0;r<e.length;++r)t[r]!==e[r]&&(t[r]=e[r],i=!0);return i}function x9(t,e,i){let r,s;return i?(r=e.filter(n=>!t.some(o=>i(o,n))),s=t.filter(n=>!e.some(o=>i(o,n)))):(r=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:r,removed:s}}function UUe(t){return t&&typeof t.length=="number"}function zUe(t,e){const i=t.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=e)r.push(t.slice(s,s+e));return r}function VUe(t,e,i){const r=t.length;let s=0,n=r-1;for(;s<n;){const a=s+Math.floor((n-s)/2);e>t[a]?s=a+1:n=a}const o=t[s];return i?e>=t[r-1]?-1:o===e?s:s-1:o===e?s:-1}let Kve=class{constructor(){this.last=0}};const e1e=new Kve;function S9(t,e,i,r){r=r||e1e;const s=Math.max(0,r.last-10);for(let o=s;o<i;++o)if(t[o]===e)return r.last=o,o;const n=Math.min(s,i);for(let o=0;o<n;++o)if(t[o]===e)return r.last=o,o;return-1}function PI(t,e,i,r){const s=t.length,n=S9(t,e,s,r);if(n!==-1)return t[n]=t[s-1],t.pop(),e}const rp=new Set;function BUe(t,e,i=t.length,r=e.length,s,n){if(r===0||i===0)return i;rp.clear();for(let a=0;a<r;++a)rp.add(e[a]);s=s||e1e;const o=Math.max(0,s.last-10);for(let a=o;a<i;++a)if(rp.has(t[a])&&(n==null||n.push(t[a]),rp.delete(t[a]),t[a]=t[i-1],--i,--a,rp.size===0||i===0))return rp.clear(),i;for(let a=0;a<o;++a)if(rp.has(t[a])&&(n==null||n.push(t[a]),rp.delete(t[a]),t[a]=t[i-1],--i,--a,rp.size===0||i===0))return rp.clear(),i;return rp.clear(),i}function GUe(t,e){let i=0;for(let r=0;r<t.length;++r){const s=t[r];e(s,r)&&(t[i]=s,i++)}t.length=i}function jUe(t){return woe.seed=t,()=>woe.getFloat()}function JUt(t,e){const i=jUe(e);for(let r=t.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=t[r];t[r]=t[s],t[s]=n}return t}const woe=new nS;function t1e(t,e){const i=t.indexOf(e);return i!==-1?(t.splice(i,1),e):null}function QUt(t,e){const i=new Map,r=t.length;for(let s=0;s<r;s++){const n=t[s],o=e(n,s,t),a=i.get(o);a?a.push(n):i.set(o,[n])}return i}function K1(t,e){return t!=null}const HUe=[];function i1e(t){return 32+t.length}function DK(){return 16}function r1e(t){if(!t)return 0;let e=o1e;for(const i in t)if(t.hasOwnProperty(i)){const r=t[i];switch(typeof r){case"string":e+=i1e(r);break;case"number":e+=DK();break;case"boolean":e+=4}}return e}function s1e(t){if(!t)return 0;if(Array.isArray(t))return qUe(t);let e=o1e;for(const i in t)t.hasOwnProperty(i)&&(e+=n1e(t[i]));return e}function qUe(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let i=a1e;for(let r=0;r<e;r++)i+=n1e(t[r]);return i}function n1e(t){switch(typeof t){case"object":return s1e(t);case"string":return i1e(t);case"number":return DK();case"boolean":return 4;default:return 8}}function WUe(t,e){return a1e+t.length*e}const o1e=32,a1e=16;function JE(t){return t instanceof ArrayBuffer}function NK(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int8Array"}function Gv(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8Array"}function FK(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8ClampedArray"}function jV(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int16Array"}function HV(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint16Array"}function qV(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int32Array"}function kK(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint32Array"}function N3(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float32Array"}function F3(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float64Array"}function wg(t){return!("buffer"in t)}function b0(...t){return t.reduce((e,i)=>e+(i?wg(i)?WUe(i,DK()):i.byteLength+l1e:0),0)}const l1e=145,_u=1024;function YUe(t){return F3(t)||N3(t)||qV(t)||jV(t)||NK(t)}function ZUe(t){return F3(t)||N3(t)}function XUe(t){return F3(t)?179769e303:N3(t)?3402823e32:kK(t)?4294967295:HV(t)?65535:Gv(t)||FK(t)?255:qV(t)?2147483647:jV(t)?32767:NK(t)?127:256}function JUe(t,e){let i;for(i in t)t.hasOwnProperty(i)&&t[i]===void 0&&delete t[i];return t}function Q(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=h1e(t);if(e!=null)return e;if(tU(t))return t.clone();if(c1e(t))return t.map(Q);if(u1e(t))return t.clone();const i={};for(const r of Object.getOwnPropertyNames(t))i[r]=Q(t[r]);return i}function T9(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=h1e(t);if(e!=null)return e;if(c1e(t)){let i=!0;const r=t.map(s=>{const n=T9(s);return s!=null&&n==null&&(i=!1),n});return i?r:null}if(tU(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!u1e(t)){const i=new(Object.getPrototypeOf(t)).constructor;for(const r of Object.getOwnPropertyNames(t)){const s=t[r],n=T9(s);if(s!=null&&n==null)return null;i[r]=n}return i}return null}function tU(t){return typeof t.clone=="function"}function c1e(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function u1e(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function xoe(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function h1e(t){if(NK(t)||Gv(t)||FK(t)||jV(t)||HV(t)||qV(t)||kK(t)||N3(t)||F3(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[i,r]of t)e.set(i,Q(r));return e}if(t instanceof Set){const e=new Set;for(const i of t)e.add(Q(i));return e}return null}function UK(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t==null?void 0:t.getTime)=="function"&&typeof(e==null?void 0:e.getTime)=="function"&&t.getTime()===e.getTime()||!1}function d1e(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&w1(t,e):t instanceof Set?e instanceof Set&&KUe(t,e):t instanceof Map?e instanceof Map&&eze(t,e):!!xoe(t)&&xoe(e)&&QUe(t,e))}function QUe(t,e){if(t===null||e===null)return!1;const i=Object.keys(t);if(e===null||Object.keys(e).length!==i.length)return!1;for(const r of i)if(t[r]!==e[r]||!Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}function KUe(t,e){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function eze(t,e){if(t.size!==e.size)return!1;for(const[i,r]of t){const s=e.get(i);if(s!==r||s===void 0&&!e.has(i))return!1}return!0}function zK(t,e,i=!1){return f1e(t,e,i)}function WV(t,e){if(e!=null)return e[t]||p1e(t.split("."),!1,e)}function kl(t,e,i){const r=t.split("."),s=r.pop(),n=p1e(r,!0,i);n&&s&&(n[s]=e)}function Soe(t,e){if(t==null&&e==null)return!1;if(t==null||e==null)return!0;if(typeof t=="object"){if(Array.isArray(t)){const i=e;if(t.length!==i.length)return!0;for(let r=0;r<t.length;r++)if(Soe(t[r],i[r]))return!0;return!1}if(Object.keys(t).length!==Object.keys(e).length)return!0;for(const i in t)if(Soe(t[i],e[i]))return!0;return!1}return t!==e}function p1e(t,e,i){let r=i;for(const s of t){if(r==null)return;if(!(s in r)){if(!e)return;r[s]={}}r=r[s]}return r}function f1e(t,e,i){return e?Object.keys(e).reduce((r,s)=>{let n=r[s],o=e[s];return n===o?r:n===void 0?(r[s]=Q(o),r):(Array.isArray(o)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.concat():r[s]=[n]:r[s]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{n.includes(a)||n.push(a)}):r[s]=o.concat())):o&&typeof o=="object"?r[s]=f1e(n,o,i):r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[s]=o),r)},t||{}):t}var Rve;const lr={apiKey:void 0,applicationName:"",applicationUrl:(Rve=globalThis.location)==null?void 0:Rve.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",respectPrefersReducedMotion:!0,routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],internalInterceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(zK(lr,globalThis.esriConfig,!0),delete lr.has),!lr.assetsPath){{const t="4.30";lr.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}lr.defaultAssetsPath=lr.assetsPath}const tze=/\{([^}]+)\}/g;function Toe(t){return t??""}function VK(t,e){return e?t.replaceAll(tze,typeof e=="object"?(i,r)=>Toe(WV(r,e)):(i,r)=>Toe(e(r))):t}function KUt(t,e){return t.replaceAll(/([.$?*|{}()[\]\\/+\-^])/g,i=>e!=null&&e.includes(i)?i:`\\${i}`)}function BK(t){let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}let Eoe;function ezt(t){return Eoe??(Eoe=new DOMParser),Eoe.parseFromString(t||"","text/html").body.innerText||""}function tzt(t,e){return new RegExp(`{${e}}`,"ig").test(t)}function ize(t,...e){let i=t[0];for(let r=0;r<e.length;++r)i+=e[r]+t[r+1];return i}const Coe={info:0,warn:1,error:2,none:3};let ie=class ku{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,ku._loggers.set(this.module,this);const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=ku.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){}static get test(){}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,ku._loggers.get(e)||new ku({module:e})}_log(e,i,...r){if(this._matchLevel(e)){if(i!=="always"&&!ku._throttlingDisabled){const s=sze(r),n=this._loggedMessages[e].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=ku._tickCounter)return;this._loggedMessages[e].set(s,ku._tickCounter),ku._scheduleTickCounterIncrement()}for(const s of lr.log.interceptors)if(s(e,this.module,...r))return;this._inheritedWriter()(e,this.module,...r)}}_parentWithMember(e,i){let r=this;for(;r!=null;){const s=r[e];if(s!=null)return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",rze)}_matchLevel(e){const i=lr.log.level||"warn";return Coe[this._parentWithMember("level",i)]<=Coe[e]}static _scheduleTickCounterIncrement(){ku._tickCounterScheduled||(ku._tickCounterScheduled=!0,Promise.resolve().then(()=>{ku._tickCounter++,ku._tickCounterScheduled=!1}))}};function rze(t,e,...i){console[t](`[${e}]`,...i)}function sze(...t){return BK(JSON.stringify(t,(i,r)=>typeof r!="object"||Array.isArray(r)?r:"[Object]"))}ie._loggers=new Map,ie._tickCounter=0,ie._tickCounterScheduled=!1,ie._throttlingDisabled=!1;function YV(t,e){if(t==null)throw new Error(e??"value is None")}function Le(t){return t==null||t.destroy(),null}function It(t){return t==null||t.dispose(),null}function Or(t){return t==null||t.remove(),null}function Ul(t){return t==null||t.abort(),null}function ti(t){return t==null||t.release(),null}function nze(t,e,i){return t!=null&&e!=null?i!=null?i(t,e):t.equals(e):t===e}function Moe(t,e){return t==null?void 0:t[e]}function oze(t,e){let i;return t.some((r,s)=>(i=e(r,s),i!=null)),i??void 0}const m1e=Symbol("Accessor-beforeDestroy"),aze={remove:()=>{}};function Ni(t){return t?{remove(){t&&(t(),t=void 0)}}:aze}function lze(t){t.forEach(e=>e==null?void 0:e.remove())}function PS(t){return Ni(()=>lze(t))}function izt(t){return Ni(()=>{var e;return(e=t())==null?void 0:e.remove()})}function g1e(t){return Ni(t!=null?()=>t.destroy():void 0)}function tl(t){return t.__accessor__??null}function cze(t,e){var i;return((i=t==null?void 0:t.metadata)==null?void 0:i[e])!=null}function S4(t,e,i){return i?iU(t,e,{policy:i,path:""}):iU(t,e,null)}function iU(t,e,i){return e?Object.keys(e).reduce((r,s)=>{const n=s;let o=null,a="merge";if(i&&(o=i.path?`${i.path}.${s}`:s,a=i.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(r[n]))return r[n]=e[n],r;if(r[n]===void 0)return r[n]=Q(e[n]),r;let l=r[n],c=e[n];if(l===c)return r;if(Array.isArray(c)||Array.isArray(r))l=l?Array.isArray(l)?r[n]=l.concat():r[n]=[l]:r[n]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(u=>{l.includes(u)||l.push(u)}));else if(c&&typeof c=="object")if(i){const u=i.path;i.path=o,r[n]=iU(l,c,i),i.path=u}else r[n]=iU(l,c,null);else r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[n]=c);return r},t||{}):t}function y1e(t){return Array.isArray(t)?t:t.split(".")}function Aoe(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function uze(t){if(Array.isArray(t)){const e=[];for(const i of t)e.push(...Aoe(i));return e}return Aoe(t)}function _1e(t,e,i,r){const s=uze(e);if(s.length!==1){const n=s.map(o=>r(t,o,i));return PS(n)}return r(t,s[0],i)}function v1e(t,e){const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.at(s)}const r=tl(e);return cze(r,i)?r.get(i):e[i]}function b1e(t,e,i){if(t==null)return t;const r=v1e(e[i],t);return!r&&i<e.length-1?void 0:i===e.length-1?r:b1e(r,e,i+1)}function k3(t,e,i=0){return typeof e!="string"||e.includes(".")?b1e(t,y1e(e),i):v1e(e,t)}function mf(t,e){return k3(t,e)}function Poe(t,e){return k3(e,t)!==void 0}var tu;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED",t[t.DESTROYED=3]="DESTROYED"})(tu||(tu={}));function U3(t){let e=t.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!i){e=Object.create(e);for(const r in e)e[r]=Q(e[r]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function ZV(t,e){const i=U3(t);let r=i[e];return r||(r=i[e]={}),r}function hze(t,e){return S4(t,e,pze)}const dze=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function pze(t){return dze.test(t)?"replace":"merge"}function fze(t){return(t==null?void 0:t.release)&&typeof t.release=="function"}function mze(t){return(t==null?void 0:t.acquire)&&typeof t.acquire=="function"}let Ca=class E9{constructor(e,i,r,s=1,n=0){if(this._ctor=e,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let i;if(E9.test.disabled)i=new this._ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this._ctor}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...e):mze(i)&&i.acquire(...e),i}release(e){e&&!E9.test.disabled&&(this._releaseFunction?this._releaseFunction(e):fze(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let i=e;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};Ca.test={disabled:!1};let gze=class{constructor(e,i){this._observers=e,this._observer=i}remove(){t1e(this._observers,this._observer)}},w1e=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return yze;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,s=!1;const n=i.length;for(let o=0;o<n;++o){const a=i[o];if(a.destroyed)s=!0;else if(a===e){r=!0;break}}return r||(i.push(e),s&&this._removeDestroyedObservers()),new gze(i,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const i=e.length;let r=0;for(let s=0;s<i;++s){for(;s+r<i&&e[s+r].destroyed;)++r;if(r>0){if(!(s+r<i))break;e[s]=e[s+r]}}e.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const i of e)i.onCommitted();this._observers=null}}};const yze=Ni();var Ii;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(Ii||(Ii={}));const C9=Ii.USER+1;function jv(t){switch(t){case"defaults":return Ii.DEFAULTS;case"service":return Ii.SERVICE;case"portal-item":return Ii.PORTAL_ITEM;case"web-scene":return Ii.WEB_SCENE;case"web-map":return Ii.WEB_MAP;case"link-chart":return Ii.LINK_CHART;case"user":return Ii.USER;default:return null}}function rU(t){switch(t){case Ii.DEFAULTS:return"defaults";case Ii.SERVICE:return"service";case Ii.PORTAL_ITEM:return"portal-item";case Ii.WEB_SCENE:return"web-scene";case Ii.WEB_MAP:return"web-map";case Ii.LINK_CHART:return"link-chart";case Ii.USER:return"user"}}function _ze(t){return rU(t)}var is;(function(t){t[t.Dirty=1]="Dirty",t[t.Overridden=2]="Overridden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(is||(is={}));const sU={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},bO=[];let R$=sU;function zt(t){R$.onObservableAccessed(t)}let T4=!1,E4=!1;function w0(t,e,i){if(T4)return GK(t,e,i);x1e(t);const r=e.call(i);return S1e(),r}function vze(t,e){return w0(sU,t,e)}function GK(t,e,i){const r=T4;T4=!0,x1e(t);let s=null;try{s=e.call(i)}catch(n){E4&&ie.getLogger("esri.core.accessorSupport.tracking").error(n)}return S1e(),T4=r,s}function x1e(t){R$=t,bO.push(t)}function S1e(){const t=bO.length;if(t>1){const e=bO.pop();R$=bO[t-2],e.onTrackingEnd()}else if(t===1){const e=bO.pop();R$=sU,e.onTrackingEnd()}else R$=sU}function T1e(t,e){if(e.flags&is.DepTrackingInitialized)return;const i=E4;E4=!1,e.flags&is.AutoTracked?GK(e,e.metadata.get,t):E1e(t,e),E4=i}const bze=[];function E1e(t,e){e.flags&is.ExplicitlyTracking||(e.flags|=is.ExplicitlyTracking,GK(e,()=>{const i=e.metadata.dependsOn||bze;for(const r of i)if(typeof r!="string"||r.includes(".")){const s=y1e(r);for(let n=0,o=t;n<s.length&&o!=null&&typeof o=="object";++n)o=Ooe(o,s[n],n!==s.length-1)}else Ooe(t,r,!1)}),e.flags&=~is.ExplicitlyTracking)}function Ooe(t,e,i){const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const n=parseInt(r,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.at(n)}const s=tl(t);if(s){const n=s.propertiesByName.get(r);n&&(zt(n),T1e(t,n))}return i?t[r]:void 0}let Roe=class extends w1e{constructor(e,i){super(),this.propertyName=e,this.metadata=i,this._accessed=null,this._handles=null,this.flags=0,this.flags=is.Dirty|(i.nonNullable?is.NonNullable:0)|(i.hasOwnProperty("value")?is.HasDefaultValue:0)|(i.get===void 0?is.DepTrackingInitialized:0)|(i.dependsOn===void 0?is.AutoTracked:0)}destroy(){this.flags&is.Dirty&&this.onCommitted(),super.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){zt(this);const i=e.store,r=this.propertyName,s=this.flags,n=i.get(r);if(s&is.Computing||~s&is.Dirty&&i.has(r))return n;this.flags|=is.Computing;const o=e.host;let a;s&is.AutoTracked?a=w0(this,this.metadata.get,o):(E1e(o,this),a=this.metadata.get.call(o)),i.set(r,a,Ii.COMPUTED);const l=i.get(r);return l===n?this.flags&=~is.Dirty:vze(this.commit,this),this.flags&=~is.Computing,l}onObservableAccessed(e){e!==this&&(this._accessed??(this._accessed=new Set),this._accessed.add(e))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=is.DepTrackingInitialized,this._accessed!=null&&(this._handles??(this._handles=[]),this._accessed.forEach(e=>{this._handles.push(e.observe(this))}),this._accessed.clear())}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~is.Dirty,this.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let i=0;i<e.length;++i)e[i].remove();e.length=0}}onInvalidated(){~this.flags&is.Overridden&&(this.flags|=is.Dirty);const e=this._observers;if(e&&e.length>0)for(const i of e)i.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onCommitted()}}},wze=class C1e{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new C1e;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,Q(r))}),i}get(e){return this._values.get(e)}originOf(){return Ii.USER}keys(){return[...this._values.keys()]}set(e,i){this._values.set(e,i)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function sD(t,e,i){return t!==void 0}function $oe(t,e,i,r){return t!==void 0&&(!(i==null&&t.flags&is.NonNullable)||(r.lifecycle,tu.INITIALIZING,!1))}let xze=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=tu.INITIALIZING,this.store=new wze,this._origin=Ii.USER;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const s=new Roe(r,i[r]);this.propertiesByName.set(r,s)}this.metadata=i}initialize(){this.lifecycle=tu.CONSTRUCTING}constructed(){this.lifecycle=tu.CONSTRUCTED}destroy(){this.lifecycle=tu.DESTROYED,this.propertiesByName.forEach(e=>e.destroy())}get initialized(){return this.lifecycle!==tu.INITIALIZING}get(e){const i=this.propertiesByName.get(e);if(i.metadata.get)return i.getComputed(this);zt(i);const r=this.store;return r.has(e)?r.get(e):i.metadata.value}originOf(e){const i=this.store.originOf(e);if(i===void 0){const r=this.propertiesByName.get(e);if(r!==void 0&&r.flags&is.HasDefaultValue)return"defaults"}return rU(i)}has(e){return this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const i=this.propertiesByName.get(e);if(sD(i))return this.store.has(e)?this.store.get(e):i.metadata.value}internalSet(e,i){const r=this.propertiesByName.get(e);sD(r)&&this._internalSet(r,i)}getDependsInfo(e,i,r){const s=this.propertiesByName.get(i);if(!sD(s))return"";const n=new Set,o=w0({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(e)});let a=`${r}${e.declaredClass.split(".").pop()}.${i}: ${o}
`;if(n.size===0)return a;r+="  ";for(const l of n)l instanceof Roe&&(a+=`${r}${l.propertyName}: undefined
`);return a}setAtOrigin(e,i,r){const s=this.propertiesByName.get(e);if(sD(s))return this._setAtOrigin(s,i,r)}isOverridden(e){const i=this.propertiesByName.get(e);return i!==void 0&&!!(i.flags&is.Overridden)}clearOverride(e){const i=this.propertiesByName.get(e);i&&i.flags&is.Overridden&&(i.flags&=~is.Overridden,i.notifyChange())}override(e,i){const r=this.propertiesByName.get(e);if(!$oe(r,e,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:o,value:a}=n;if(Gj.release(n),!o)return;i=a}r.flags|=is.Overridden,this._internalSet(r,i)}set(e,i){const r=this.propertiesByName.get(e);if(!$oe(r,e,i,this))return;const s=r.metadata.cast;if(s){const o=this._cast(s,i),{valid:a,value:l}=o;if(Gj.release(o),!a)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(e){this._origin=jv(e)}getDefaultOrigin(){return rU(this._origin)}notifyChange(e){const i=this.propertiesByName.get(e);i!==void 0&&i.notifyChange()}invalidate(e){const i=this.propertiesByName.get(e);i!==void 0&&i.invalidate()}commit(e){const i=this.propertiesByName.get(e);i!==void 0&&i.commit()}_internalSet(e,i){const r=this.lifecycle!==tu.INITIALIZING?this._origin:Ii.DEFAULTS;this._setAtOrigin(e,i,r)}_setAtOrigin(e,i,r){const s=this.store,n=e.propertyName;s.has(n,r)&&UK(i,s.get(n))&&~e.flags&is.Overridden&&r===s.originOf(n)||(e.invalidate(),s.set(n,i,r),e.commit(),T1e(this.host,e))}_cast(e,i){const r=Gj.acquire();return r.valid=!0,r.value=i,e&&(r.value=e.call(this.host,i,r)),r}},Sze=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const Gj=new Ca(Sze);function Tze(t,e){return t.replaceAll(/\$\{([^\s:}]*)(?::([^\s:}]+))?\}/g,(i,r)=>r===""?"$":(WV(r,e)??"").toString())}let M1e=class{constructor(e,i,r=void 0){this.name=e,this.details=r,this.message=(i&&Tze(i,r))??""}toString(){return"["+this.name+"]: "+this.message}},V=class A1e extends M1e{constructor(e,i,r){super(e,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return Q(i)}catch{return"[object]"}}))}}catch(e){throw ie.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new A1e(e.name,e.message,e.details)}};V.prototype.type="error";function nU(t,e,i){if(t&&e)if(typeof e=="object")for(const r of Object.getOwnPropertyNames(e))nU(t,r,e[r]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(-1,1)[0];return void nU(mf(t,s),n,i)}const r=t.__accessor__;r!=null&&Eze(e,r),t[e]=i}}function Eze(t,e){if(re("esri-unknown-property-errors")&&!Cze(t,e))throw new V("set:unknown-property",Mze(t,e))}function Cze(t,e){return e.metadata[t]!=null}function Mze(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let Aze;function Pze(){return Aze}var Ioe;(function(t){t[t.Ignore=0]="Ignore",t[t.Destroy=1]="Destroy",t[t.ThrowError=2]="ThrowError"})(Ioe||(Ioe={}));function Oze(t){t.length=0}let iu=class{constructor(e=50,i=50){this._pool=new Ca(Array,void 0,Oze,i,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return jj.acquire()}static release(e){return jj.release(e)}static prune(){jj.prune()}};const jj=new iu(100);let P1e=class extends Ca{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const i=super.acquire(...e);return this._set.delete(i),i}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const nD=[];function bM(t){nD.push(t),nD.length===1&&queueMicrotask(()=>{const e=nD.slice();nD.length=0;for(const i of e)i()})}let r0=class{constructor(e,i=30){this.name=e,this._counter=0,this._samples=new Array(i)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,i)=>e-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,i)=>e+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var M9;(function(t){const e=(n,o,a,l)=>{let c=o,u=o;const d=a>>>1,p=n[c-1];for(;u<=d;){u=c<<1,u<a&&l(n[u-1],n[u])<0&&++u;const m=n[u-1];if(l(m,p)<=0)break;n[c-1]=m,c=u}n[c-1]=p},i=(n,o)=>n<o?-1:n>o?1:0;function r(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let u=a>>>1;u>o;u--)e(n,u,a,l);const c=o+1;for(let u=a-1;u>o;u--){const d=n[o];n[o]=n[u],n[u]=d,e(n,c,u,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let u=a>>>1;u>o;u--)e(n,u,a,l),yield;const c=o+1;for(let u=a-1;u>o;u--){const d=n[o];n[o]=n[u],n[u]=d,e(n,c,u,l),yield}}t.sort=r,t.iterableSort=s})(M9||(M9={}));const Loe=M9,Rze=1.5,$ze=1.1;let Zt=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new Kve,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>Doe(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];e(s)&&i.push(s)}return i}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,i){const r=this.data.indexOf(e,i);return r!==-1&&r<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let i=e;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,i=e.length){for(let r=0;r<i;r++)this.data[this._length++]=e[r]}fill(e,i){for(let r=0;r<i;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,Doe(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const i=S9(this.data,e,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(S9(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,i=e.length,r){this.length=BUe(this.data,e,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,i){if(e>=this.length||i>=this.length||e===i)return;const r=this.data[e];this.data[e]=this.data[i],this.data[i]=r}sort(e){Loe.sort(this.data,0,this.length,e)}iterableSort(e){return Loe.iterableSort(this.data,0,this.length,e)}some(e,i){for(let r=0;r<this.length;++r)if(e.call(i,this.data[r],r,this.data))return!0;return!1}find(e,i){for(let r=0;r<this.length;++r){const s=this.data[r];if(e.call(i,s,r))return s}}filterInPlace(e,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(e,i){const{data:r,length:s}=this;for(let n=0;n<s;++n)e.call(i,r[n],n,r)}forEach(e,i){this.data.slice(0,this.length).forEach(e,i)}map(e,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=e.call(i,this.data[s],s,this.data);return r}reduce(e,i){let r=i;for(let s=0;s<this.length;++s)r=e(r,this.data[s],s,this.data);return r}has(e){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===e)return!0;return!1}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.data[e]}};function Doe(t){t.data.length>Rze*t.length&&(t.data.length=Math.floor(t.length*$ze))}function Ize(t){return{setTimeout:(e,i)=>{const r=t.setTimeout(e,i);return Ni(()=>t.clearTimeout(r))}}}const z3=Ize(globalThis);function XV(t){return Lze(t)||O1e(t)}function Lze(t){return t!=null&&typeof t=="object"&&"on"in t&&typeof t.on=="function"}function O1e(t){return t!=null&&typeof t=="object"&&"addEventListener"in t&&typeof t.addEventListener=="function"}function PA(t,e,i){if(!XV(t))throw new TypeError("target is not a Evented or EventTarget object");return O1e(t)?Dze(t,e,i):t.on(e,i)}function Dze(t,e,i,r){if(Array.isArray(e)){const s=e.slice();for(const n of s)t.addEventListener(n,i,r);return Ni(()=>{for(const n of s)t.removeEventListener(n,i,r)})}return t.addEventListener(e,i,r),Ni(()=>t.removeEventListener(e,i,r))}function R1e(t,e,i){if(!XV(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,i);const r=PA(t,e,s=>{r.remove(),i.call(t,s)});return r}function Di(t="Aborted"){return new V("AbortError",t)}function Et(t,e="Aborted"){if(Yn(t))throw Di(e)}function JV(t){return t instanceof AbortSignal?t:t==null?void 0:t.signal}function Yn(t){const e=JV(t);return e!=null&&e.aborted}function Pn(t){if(ms(t))throw t}function Noe(t){if(!ms(t))throw t}function Io(t,e){const i=JV(t);if(i!=null){if(!i.aborted)return R1e(i,"abort",()=>e());e()}}function QV(t,e){const i=JV(t);if(i!=null)return Et(i),R1e(i,"abort",()=>e(Di()))}function $1e(t,e){return JV(e)==null?t:new Promise((i,r)=>{let s=Io(e,()=>r(Di()));const n=()=>{s=Or(s)};t.then(n,n),t.then(i,r)})}function ms(t){return(t==null?void 0:t.name)==="AbortError"}async function OI(t){try{return await t}catch(e){if(!ms(e))throw e;return}}async function pzt(t,e=ie.getLogger("esri")){try{return await t}catch(i){ms(i)||e.error(i)}}async function KV(t){if(!t)return;if(typeof t.forEach!="function"){const i=Object.keys(t),r=i.map(o=>t[o]),s=await KV(r),n={};return i.map((o,a)=>n[o]=s[a]),n}const e=t;return Promise.allSettled(e).then(i=>Array.from(e,(r,s)=>{const n=i[s];return n.status==="fulfilled"?{promise:r,value:n.value}:{promise:r,error:n.reason}}))}async function A9(t){return(await Promise.allSettled(t)).filter(e=>e.status==="fulfilled").map(e=>e.value)}async function Nze(t){return(await Promise.allSettled(t)).filter(e=>e.status==="rejected").map(e=>e.reason)}function RI(t,e=void 0,i){const r=new AbortController;return Io(i,()=>r.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(e)},t);Io(r,()=>{o&&(clearTimeout(o),n(Di()))})})}function Fze(t,e){const i=new AbortController,r=setTimeout(()=>i.abort(),e);return Io(t,()=>{i.abort(),clearTimeout(r)}),{...t,signal:i.signal}}function Cu(t){return t&&typeof t.then=="function"}function P9(t){return Cu(t)?t:Promise.resolve(t)}function eB(t,e=-1){let i,r,s,n,o=null;const a=(...l)=>{if(i){r=l,n&&n.reject(Di()),n=ra();const p=n.promise;if(o){const m=o;o=null,m.abort()}return p}if(s=n||ra(),n=null,e>0){const p=new AbortController;i=P9(t(...l,p.signal));const m=i;RI(e).then(()=>{i===m&&(n?p.abort():o=p)})}else i=1,i=P9(t(...l));const c=()=>{const p=r;r=s=i=o=null,p!=null&&a(...p)},u=i,d=s;return u.then(c,c),u.then(d.resolve,d.reject),d.promise};return a}function ra(){let t,e;const i=new Promise((s,n)=>{t=s,e=n}),r=s=>{t(s)};return r.resolve=s=>t(s),r.reject=s=>e(s),r.timeout=(s,n)=>z3.setTimeout(()=>r.reject(n),s),r.promise=i,r}function fzt(t,e){return t.then(e,e)}async function oU(t){await Promise.resolve(),Et(t)}function mzt(t){return t}function I1e(t){return 1e3*t}function gzt(t){return t}function jK(t){return .001*t}let kze=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},Uze=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},O9=0,R9=0;const hP={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},$9=["prepare","preRender","render","postRender","update","finish"],I9=[],OS=new Zt;let zze=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};function Vze(){oS!=null&&(cancelAnimationFrame(oS),oS=requestAnimationFrame(HK))}const aU={frameTasks:OS,willDispatch:!1,clearFrameTasks:Bze,dispatch:D1e,executeFrameTasks:jze,reschedule:Vze};function hT(t){const e=new Uze(t);return I9.push(e),aU.willDispatch||(aU.willDispatch=!0,bM(D1e)),e}function RS(t){const e=new kze(t);return OS.push(e),oS==null&&(O9=performance.now(),oS=requestAnimationFrame(HK)),new zze(e)}let oS=null;function Bze(t=!1){OS.forAll(e=>{e.removed=!0}),t&&L1e()}function Gze(t){R9=Math.max(0,t)}function HK(){const t=performance.now();oS=null,oS=OS.length>0?requestAnimationFrame(HK):null,aU.executeFrameTasks(t)}function jze(t){const e=t-O9;O9=t;const i=R9>0?R9:1e3/60,r=Math.max(0,e-i);hP.time=t,hP.frameDuration=i-r;for(let s=0;s<$9.length;s++){const n=performance.now(),o=$9[s];OS.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(hP.elapsedFrameTime=performance.now()-t,hP.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,hP)))}),qze[s].record(performance.now()-n)}L1e(),Wze.record(performance.now()-t)}const oD=new Zt;function L1e(){OS.forAll(t=>{t.removed&&oD.push(t)}),OS.removeUnorderedMany(oD.data,oD.length),oD.clear()}function D1e(){for(;I9.length;){const t=I9.shift();t.isActive&&t.callback()}aU.willDispatch=!1}function N1e(t=1,e){const i=ra(),r=()=>{Yn(e)?i.reject(Di()):t===0?i():(--t,bM(()=>r()))};return r(),i.promise}function Hze(t){return N1e(1,t)}async function bzt(){await Hze(),await new Promise(t=>requestAnimationFrame(t))}const qze=$9.map(t=>new r0(t)),Wze=new r0("total");function C4(t,e){for(const i of t.entries())if(e(i[0]))return!0;return!1}function lU(t,e){if(!e)return t;for(const i of e)i!=null&&t.add(i);return t}function Foe(t,e){return e!=null&&t.add(e),t}function F1e(t,e){const i=new Set;return lU(i,t),lU(i,e),i}function Yze(t,e){const i=new Set;for(const r of e)t.has(r)&&i.add(r);return i}function wzt(t,e){if(!t||!e)return!1;if(t===e)return!0;for(const i of t)if(!e.has(i))return!1;return!0}function xzt(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function Zze(t,e){const i=new Set(t);for(const r of e)i.delete(r);return i}function Xze(t,e){return Zze(F1e(t,e),Yze(t,e))}let Jze=0;const Qze=0;function _h(){return++Jze}let tB=class{constructor(e){this._accessed=new Set,this._handles=[],this._observerObject=new Kze(e),koe.register(this,new WeakRef(this._observerObject),this)}destroy(){var e;koe.unregister(this._observerObject),this._accessed.clear(),(e=this._observerObject)==null||e.destroy(),this.clear()}onObservableAccessed(e){this._accessed.add(e)}onTrackingEnd(){const e=this._handles,i=this._observerObject;this._accessed.forEach(r=>{e.push(r.observe(i))}),this._accessed.clear()}clear(){const e=this._handles;for(let i=0;i<e.length;++i)e[i].remove();e.length=0}},Kze=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=eVe}};const koe=new FinalizationRegistry(t=>{var e;(e=t.deref())==null||e.destroy()});function eVe(){}let $C=!1;const cU=[];function k1e(t,e){let i=new tB(n),r=null,s=!1;function n(){if(!i||s)return;if($C)return void V1e(n);const a=r;i.clear(),$C=!0,s=!0,r=w0(i,t),s=!1,$C=!1,e(r,a),B1e()}function o(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=w0(i,t),s=!1,Ni(o)}function U1e(t,e){let i=new tB(s),r=null;function s(){e(r,o)}function n(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=w0(i,t),r):null}return o(),Ni(n)}function z1e(t){let e=new tB(r),i=!1;function r(){e&&!i&&($C?V1e(r):(e.clear(),$C=!0,i=!0,w0(e,t),i=!1,$C=!1,B1e()))}function s(){e&&(e.destroy(),e=null)}return i=!0,w0(e,t),i=!1,Ni(s)}function V1e(t){cU.includes(t)||cU.unshift(t)}function B1e(){for(;cU.length;)cU.pop()()}var $$;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})($$||($$={}));let $I=class{constructor(){this.uid=_h(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,i,r,s,n){return this.pool.acquire($$.Untracked,e,i,r,s,n,UK)}static acquireTracked(e,i,r,s){return this.pool.acquire($$.Tracked,e,i,r,null,null,s)}notify(e,i){this.type===$$.Untracked?this.callback.call(this.target,e,i,this.path,this.target):this.callback.call(null,e,i,void 0,void 0)}acquire(e,i,r,s,n,o,a){this.uid=_h(),this.removed=!1,this.type=e,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=_h(),this.removed=!0}};$I.pool=new P1e($I);const M4=new iu,l0=new Set;let uU;function hU(t){l0.delete(t),l0.add(t),uU||(uU=hT(rVe))}function tVe(t){if(t.removed)return;const e=t.oldValue,i=t.getValue();t.equals(e,i)||(t.oldValue=i,t.notify(i,e))}function iVe(t){for(const e of l0.values())e.target===t&&(e.removed=!0)}function rVe(){let t=10;for(;uU&&t--;){uU=null;const e=sVe(),i=M4.acquire();for(const r of e){const s=r.uid;tVe(r),s===r.uid&&r.removed&&i.push(r)}for(const r of l0)r.removed&&(i.push(r),l0.delete(r));for(const r of i)$I.pool.release(r);M4.release(i),M4.release(e),L9.forEach(r=>r())}}function sVe(){const t=M4.acquire();t.length=l0.size;let e=0;for(const i of l0)t[e]=i,++e;return l0.clear(),t}const L9=new Set;function G1e(t){return L9.add(t),Ni(()=>L9.delete(t))}function nVe(t,e,i){let r=_1e(t,e,i,(s,n,o)=>{let a,l,c=U1e(()=>k3(s,n),(u,d)=>{var p;((p=s.__accessor__)==null?void 0:p.lifecycle)===tu.DESTROYED||a&&a.uid!==l?r.remove():(a||(a=$I.acquireUntracked(u,o,d,s,n),l=a.uid),hU(a))});return Ni(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,hU(a)),a=null),r=c=null})});return r}function oVe(t,e,i){const r=_1e(t,e,i,(s,n,o)=>{let a=!1;return k1e(()=>k3(s,n),(l,c)=>{s.__accessor__.lifecycle!==tu.DESTROYED?a||(a=!0,UK(c,l)||o.call(s,l,c,n,s),a=!1):r.remove()})});return r}function aVe(t,e,i,r=!1){return t.__accessor__&&t.__accessor__.lifecycle!==tu.DESTROYED?r?oVe(t,e,i):nVe(t,e,i):Ni()}function lVe(t,e,i){let r,s,n=U1e(t,(o,a)=>{r&&r.uid!==s?n.remove():(r||(r=$I.acquireTracked(o,e,a,i),s=r.uid),hU(r))});return Ni(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,hU(r)),r=null),n=null})}function cVe(t,e,i){let r=!1;return k1e(t,(s,n)=>{r||(r=!0,i(n,s)||e(s,n),r=!1)})}function uVe(t,e,i=!1,r=d1e){return i?cVe(t,e,r):lVe(t,e,r)}function Uoe(t){return C4(l0,e=>e.oldValue===t)}function mh(t,e){for(const[i,r]of t)if(e(r,i))return!0;return!1}function Czt(t,e){for(const[i,r]of t)if(e(r,i))return r;return null}function V3(t,e,i){const r=t.get(e);if(r!==void 0)return r;const s=i();return t.set(e,s),s}function Mzt(t){const e=new Map;return i=>(e.has(i)||e.set(i,t(i)),e.get(i))}const IC=()=>ie.getLogger("esri.core.accessorSupport.ensureTypes");function hVe(t){return t==null?t:new Date(t)}function dVe(t){return t==null?t:!!t}function B3(t){return t==null?t:t.toString()}function bd(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function qK(t){return t==null?t:Math.round(parseFloat(t))}function pVe(t){return null}function j1e(t){return(t==null?void 0:t.constructor)&&t.constructor.__accessorMetadata__!==void 0}function dU(t,e){return e!=null&&t&&!(e instanceof t)}function H1e(t){return t&&"isCollection"in t}function zoe(t){return t!=null&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function fVe(t,e){if(!(e!=null&&e.constructor)||!H1e(e.constructor))return D9(t,e)?e:new t(e);const i=zoe(t.prototype.itemType),r=zoe(e.constructor.prototype.itemType);return i?r?i===r?e:i.prototype.isPrototypeOf(r.prototype)?new t(e):(D9(t,e),e):new t(e):e}function D9(t,e){return!!j1e(e)&&(IC().error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+iB(t)+"'"),!0)}function $S(t,e){return e==null?e:H1e(t)?fVe(t,e):dU(t,e)?D9(t,e)?e:new t(e):e}function iB(t){var e;return((e=t==null?void 0:t.prototype)==null?void 0:e.declaredClass)||"unknown"}const mVe=new WeakMap;function gVe(t){switch(t){case Number:return bd;case Qr:return qK;case Boolean:return dVe;case String:return B3;case Date:return hVe;case rB:return pVe;default:return V3(mVe,t,()=>$S.bind(null,t))}}function Ln(t,e){const i=gVe(t);return arguments.length===1?i:i(e)}function II(t,e,i){return arguments.length===1?II.bind(null,t):e&&(Array.isArray(e)?e.map(r=>t(r,i)):[t(e,i)])}function yVe(t,e){return arguments.length===1?II(i=>Ln(t,i)):II(i=>Ln(t,i),e)}function q1e(t,e,i){return e!==0&&Array.isArray(i)?i.map(r=>q1e(t,e-1,r)):t(i)}function pU(t,e,i){if(arguments.length===2)return n=>pU(t,e,n);if(!i)return i;i=q1e(t,e,i);let r=e,s=i;for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function _Ve(t,e,i){return arguments.length===2?pU(r=>Ln(t,r),e):pU(r=>Ln(t,r),e,i)}function W1e(t){return!!Array.isArray(t)&&!t.some(e=>{const i=typeof e;return!(i==="string"||i==="number"||i==="function"&&t.length>1)})}function N9(t,e){if(arguments.length===2)return N9(t).call(null,e);const i=new Set,r=t.filter(a=>typeof a!="function"),s=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||i.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,u=c==="string"||c==="number";return u&&(i.has(a)||s.some(d=>c==="string"&&d===String||c==="number"&&d===Number))||c==="object"&&s.some(d=>!dU(a,d))?a:(u&&r.length?(n||(n=r.map(d=>typeof d=="string"?`'${d}'`:`${d}`).join(", ")),IC().error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(d=>iB(d)).join(", ")),IC().error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):IC().error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function xf(t,e){if(arguments.length===2)return xf(t).call(null,e);const i={},r=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];i[l]=Ln(c),r.push(iB(c)),s.push(l)}const n=()=>`'${r.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!dU(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,u=i[c];if(!u)return IC().error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!dU(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!j1e(l)){const d={};for(const p in l)p!==t.key&&(d[p]=l[p]);return u(d)}return u(l)}}let Qr=class{},rB=class{};const Ozt={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function vVe(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function Y1e(t){switch(t.type){case"native":return Ln(t.value);case"array":return II(Y1e(t.value));case"one-of":return bVe(t);default:return null}}function bVe(t){let e=null;return(i,r)=>k9(i,t)?i:(e==null&&(e=F9(t)),IC().error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),r&&(r.valid=!1),null)}function F9(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Qr:return"integer";case Date:return"date";case rB:return"null";default:return iB(t.value)}case"array":return`array of ${F9(t.value)}`;case"one-of":{const e=t.values.map(i=>F9(i));return`one of ${e.slice(0,-1)} or ${e[e.length-1]}`}}return"unknown"}function k9(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Qr:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string";case rB:return t===null}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(i=>!k9(i,e.value));case"one-of":return e.values.some(i=>k9(t,i))}}function f(t={}){return(e,i)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(e,i),s=ZV(e,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in t&&ie.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=r.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let u;s.dependsOn=[l],s.get=function(){let d=mf(this,l);if(typeof d=="function"){u||(u=l.split(".").slice(0,-1).join("."));const p=mf(this,u);p&&(d=d.bind(p))}return d},s.readOnly||(s.set=c?function(d){this._override(i,d)}:function(d){nU(this,l,d)})}const o=t.type,a=t.types;s.cast||(o?s.cast=wVe(o):a&&(Array.isArray(a)?s.cast=II(xf(a[0])):s.cast=xf(a))),hze(s,t),t.range&&(s.cast=xVe(s.cast,t.range))}}function Z1e(t,e,i){const r=ZV(t,i);r.json||(r.json={});let s=r.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function wVe(t){let e=0,i=t;if(vVe(t))return Y1e(t);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],e++;const r=i;if(W1e(r))return e===0?N9(r):pU(N9(r),e);if(e===1)return yVe(r);if(e>1)return _Ve(r,e);const s=t;return s.from?s.from:Ln(s)}function xVe(t,e){return i=>{let r=+t(i);return e.step!=null&&(r=Math.round(r/e.step)*e.step),e.min!=null&&(r=Math.max(e.min,r)),e.max!=null&&(r=Math.min(e.max,r)),r}}function SVe(t){if(t.json&&t.json.origins){const e=t.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(e[r]){const s=e[r];i[r].forEach(n=>{e[n]=s}),delete e[r]}}}let Sf=class extends M1e{constructor(e,i,r){super(e,i,r)}};Sf.prototype.type="warning";function X1e(t){var e;return!!t&&((e=t.prototype)==null?void 0:e.declaredClass)&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const U9=()=>ie.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function Voe(t,e,i){var r,s;t&&(!i&&!e.read||(r=e.read)!=null&&r.reader||((s=e.read)==null?void 0:s.enabled)===!1||CVe(t)&&kl("read.reader",OA(t),e))}function OA(t){var i,r;const e=t.ndimArray??0;if(e>1)return EVe(t);if(e===1)return Boe(t);if("type"in t&&Q1e(t.type)){const s=(r=(i=t.type.prototype)==null?void 0:i.itemType)==null?void 0:r.Type,n=Boe(typeof s=="function"?{type:s}:{types:s});return(o,a,l)=>{const c=n(o,a,l);return c&&new t.type(c)}}return WK(t)}function WK(t){return"type"in t?TVe(t.type):MVe(t.types)}function TVe(t){return t.prototype.read?(e,i,r)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void U9().error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,r),n}:t.fromJSON}function J1e(t,e,i,r){return r!==0&&Array.isArray(e)?e.map(s=>J1e(t,s,i,r-1)):t(e,void 0,i)}function EVe(t){const e=WK(t),i=J1e.bind(null,e),r=t.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=i(s,o,r);let a=r,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function Boe(t){const e=WK(t);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=e(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=e(i,void 0,s);return n!==void 0?[n]:void 0}}function Q1e(t){if(!X1e(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?YK(e.Type):K1e(e.Type))}function CVe(t){return"types"in t?K1e(t.types):YK(t.type)}function YK(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||Q1e(t))}function K1e(t){for(const e in t.typeMap)if(!YK(t.typeMap[e]))return!1;return!0}function MVe(t){let e=null;const i=t.errorContext??"type",r=t.validate;return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void U9().error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);e||(e=AVe(t));const l=t.key;if(typeof l!="string")return;const c=s[l],u=c?e[c]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!u){const p=`Type '${c||"unknown"}' is not supported`;return o!=null&&o.messages&&s&&o.messages.push(new Sf(`${i}:unsupported`,p,{definition:s,context:o})),void U9().error(p)}const d=new u;return d.read(s,o),r?r(d):d}}function AVe(t){var i,r;const e={};for(const s in t.typeMap){const n=t.typeMap[s],o=U3(n.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;if((i=a.json)!=null&&i.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"){e[a.json.type[0]]=n;continue}const l=(r=a.json)==null?void 0:r.write;if(!(l!=null&&l.writer)){e[s]=n;continue}const c=l.target,u=typeof c=="string"?c:t.key,d={};l.writer(s,d,u),d[u]&&(e[d[u]]=n)}return e}function PVe(t){if(t.json||(t.json={}),joe(t.json),Hoe(t.json),Goe(t.json),t.json.origins)for(const e in t.json.origins)joe(t.json.origins[e]),Hoe(t.json.origins[e]),Goe(t.json.origins[e]);return!0}function Goe(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function joe(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function Hoe(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function qoe(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const i=(t==null?void 0:t.ndimArray)??0;t&&(i===1||"type"in t&&X1e(t.type))?e.write.writer=$Ve:i>1?e.write.writer=IVe(i):e.types?Array.isArray(e.types)?e.write.writer=RVe(e.types[0]):e.write.writer=OVe(e.types):e.write.writer=LI}function OVe(t){return(e,i,r,s)=>e?ebe(e,t,s)?LI(e,i,r,s):void 0:LI(e,i,r,s)}function ebe(t,e,i){for(const r in e.typeMap)if(t instanceof e.typeMap[r])return!0;if(i!=null&&i.messages){const r=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&t&&i.messages.push(new V(`${r}:unsupported`,s,{definition:t,context:i})),ie.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function RVe(t){return(e,i,r,s)=>!e||!Array.isArray(e)?LI(e,i,r,s):LI(e.filter(n=>ebe(n,t,s)),i,r,s)}function LI(t,e,i,r){kl(i,fU(t,r),e)}function fU(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?mU(t):t}function mU(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function $Ve(t,e,i,r){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>fU(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[fU(t,r)],kl(i,s,e)}function tbe(t,e,i){return i!==0&&Array.isArray(t)?t.map(r=>tbe(r,e,i-1)):fU(t,e)}function IVe(t){return(e,i,r,s)=>{let n;if(e===null)n=null;else{n=tbe(e,s,t);let o=t,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}kl(r,n,i)}}function LVe(t,e){return ZK(t,"any",e==null?void 0:e.origin)}function z9(t,e){return ZK(t,"read",e==null?void 0:e.origin)}function ibe(t,e){return ZK(t,"write",e==null?void 0:e.origin)}function ZK(t,e,i){let r=t==null?void 0:t.json;if(r!=null&&r.origins&&i){let s;s=i==="link-chart"?r.origins[i]&&(e==="any"||e in r.origins[i])?r.origins[i]:r.origins["web-map"]:r.origins[i],s&&(e==="any"||e in s)&&(r=s)}return r}function DVe(t){var i;const e=NVe(t);if(t.json.origins)for(const r in t.json.origins){const s=t.json.origins[r],n=s.types?FVe(s):e;Voe(n,s,!1),s.types&&!s.write&&((i=t.json.write)!=null&&i.enabled)&&(s.write={...t.json.write}),qoe(n,s)}Voe(e,t.json,!0),qoe(e,t.json)}function NVe(t){return t.json.types?V9(t.json):t.type?rbe(t):V9(t)}function FVe(t){return t.type?rbe(t):V9(t)}function rbe(t){if(!t.type)return;let e=0,i=t.type;for(;Array.isArray(i)&&!W1e(i);)i=i[0],e++;return{type:i,ndimArray:e}}function V9(t){if(!t.types)return;let e=0,i=t.types;for(;Array.isArray(i);)i=i[0],e++;return{types:i,ndimArray:e}}function kVe(t){PVe(t)&&(SVe(t),DVe(t))}const Hj=new Set,qj=new Set;function I(t){return e=>{t??(t="esri.core.Accessor"),e.prototype.declaredClass=t,zVe(e);const i=[],r=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!Hj.has(s.initialize)&&(Hj.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!qj.has(s.destroy)&&(qj.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);Hj.clear(),qj.clear();const n=class extends e{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;const c=this[m1e];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let u=0;u<r.length;u++)r[u].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript()}}};n.__accessorMetadata__=U3(e.prototype),n.prototype.declaredClass=t;const o=(t||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(n,"name",{value:o,configurable:!0}),n}}function UVe(t,e){return e.get==null?function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r===void 0)return;zt(r);const s=i.store;return s.has(t)?s.get(t):r.metadata.value}:function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r!==void 0)return r.getComputed(i)}}function zVe(t){const e=t.prototype,i=U3(e),r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];kVe(n),r[s]={enumerable:!0,configurable:!0,get:UVe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this))return a.initialized&&n.readOnly?Woe("read-only",s):a.lifecycle===tu.CONSTRUCTED&&n.constructOnly?Woe("construct-only",s):void a.set(s,o)}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,r)}const Woe=(t,e)=>{ie.getLogger("esri.core.Accessor").error(`cannot assign to ${t} property '${e}'`)};var sbe,nbe;function VVe(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const um=Symbol("Accessor-Handles"),B9=Symbol("Accessor-Initialized");let Re=class obe{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}U3(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const u=this.inherited;let d;this.inherited=function(...p){if(n.prototype[a])return n.prototype[a].apply(this,p)};try{d=l.apply(this,c)}catch(p){throw this.inherited=u,p}return this.inherited=u,d}:e[a]}for(const a in i){const l=VVe(i[a]);f(l)(o.prototype,a)}return I(r)(o)}constructor(...e){var r;if(this[sbe]=null,this[nbe]=!1,this.constructor===obe)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const i=new xze(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:i}),e.length>0&&(i.ctorArgs=((r=this.normalizeCtorArgs)==null?void 0:r.apply(this,e))??e[0])}postscript(){const e=this.__accessor__,i=e.ctorArgs;e.initialize(),i&&(this.set(i),e.ctorArgs=null),e.constructed(),this.initialize(),this[B9]=!0}initialize(){}[m1e](){this[um]=Le(this[um])}destroy(){var e;this.destroyed||(iVe(this),this.__accessor__.destroy(),(e=Pze())==null||e.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[B9]}get destroyed(){var e;return((e=this.__accessor__)==null?void 0:e.lifecycle)===tu.DESTROYED||!1}commitProperty(e){mf(this,e)}get(e){return Jve(ie.getLogger(this),"`Accessor.get` is deprecated in favor of using optional chaining",{version:"4.28",see:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining"}),mf(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,i){return nU(this,e,i),this}watch(e,i,r){return aVe(this,e,i,r)}addHandles(e,i){if(this.destroyed){const r=Array.isArray(e)?e:[e];for(const s of r)s.remove();return}(this[um]??(this[um]=new Pg)).add(e,i)}removeHandles(e){var i;(i=this[um])==null||i.remove(e)}removeAllHandles(){var e;(e=this[um])==null||e.removeAll()}removeHandlesReference(e){var i;(i=this[um])==null||i.removeReference(e)}hasHandles(e){var i;return((i=this[um])==null?void 0:i.has(e))===!0}_override(e,i){i===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,i){i==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,i){return this.__accessor__.internalSet(e,i),this}};sbe=um,nbe=B9;const Kr=t=>{let e=class extends t{clone(){var l;const i=tl(this);YV(i,"unable to clone instance of non-accessor class");const r=i.metadata,s=i.store,n={},o=new Map;for(const c in r){const u=r[c],d=s==null?void 0:s.originOf(c),p=u.clonable;if(u.readOnly||p===!1||d!==Ii.USER&&d!==Ii.DEFAULTS&&d!==Ii.WEB_MAP&&d!==Ii.WEB_SCENE)continue;const m=this[c];let g=null;g=typeof p=="function"?p(m):p==="reference"?m:T9(m),m!=null&&g==null||(d===Ii.DEFAULTS?o.set(c,g):n[c]=g)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=tl(a))==null?void 0:l.store;if(c)for(const[u,d]of o)c.set(u,d,Ii.DEFAULTS)}return a}};return e=h([I("esri.core.Clonable")],e),e};let IS=class extends Kr(Re){};IS=h([I("esri.core.Clonable")],IS);let yw=class extends IS{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return e!=null&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};h([f({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],yw.prototype,"row",void 0),h([f({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],yw.prototype,"column",void 0),h([f({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],yw.prototype,"rows",void 0),h([f({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],yw.prototype,"columns",void 0),yw=h([I("esri.CameraLayout")],yw);const abe=yw;function E(){return[0,0,0]}function Xs(t){return[t[0],t[1],t[2]]}function $e(t,e,i){return[t,e,i]}function Ol(t,e=E()){const i=Math.min(3,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function BVe(t,e){return new Float64Array(t,e,3)}function XK(){return E()}function lbe(){return $e(1,1,1)}function cbe(){return $e(1,0,0)}function ube(){return $e(0,1,0)}function JK(){return $e(0,0,1)}const $n=XK(),s0=lbe(),QK=cbe(),KK=ube(),wM=JK();Object.freeze(Object.defineProperty({__proto__:null,ONES:s0,UNIT_X:QK,UNIT_Y:KK,UNIT_Z:wM,ZEROS:$n,clone:Xs,create:E,createView:BVe,fromArray:Ol,fromValues:$e,ones:lbe,unitX:cbe,unitY:ube,unitZ:JK,zeros:XK},Symbol.toStringTag,{value:"Module"}));let eee=1e-6;function Lo(){return eee}function GVe(t){eee=t}const G3=Math.random,jVe=Math.PI/180,HVe=180/Math.PI;function sB(t){return t*jVe}function qVe(t){return t*HVe}function WVe(t,e){return Math.abs(t-e)<=eee*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:G3,equals:WVe,getEpsilon:Lo,setEpsilon:GVe,toDegree:qVe,toRadian:sB},Symbol.toStringTag,{value:"Module"}));function Ae(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function ce(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ne(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function me(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function ve(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function nB(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function gU(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function YVe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function hbe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function xM(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function dbe(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function pbe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function fbe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function ZVe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function oe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function On(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function wr(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}function Ko(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function Za(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function ea(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function XVe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function ge(t,e){const i=e[0],r=e[1],s=e[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function pe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ot(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2];return t[0]=s*l-n*a,t[1]=n*o-r*l,t[2]=r*a-s*o,t}function yr(t,e,i,r){const s=e[0],n=e[1],o=e[2];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t}function JVe(t,e,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),u=o*(3-2*n);return t[0]=e[0]*a+i[0]*l+r[0]*c+s[0]*u,t[1]=e[1]*a+i[1]*l+r[1]*c+s[1]*u,t[2]=e[2]*a+i[2]*l+r[2]*c+s[2]*u,t}function QVe(t,e,i,r,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,u=3*n*a,d=3*l*o,p=l*n;return t[0]=e[0]*c+i[0]*u+r[0]*d+s[0]*p,t[1]=e[1]*c+i[1]*u+r[1]*d+s[1]*p,t[2]=e[2]*c+i[2]*u+r[2]*d+s[2]*p,t}function KVe(t,e){e=e||1;const i=G3,r=2*i()*Math.PI,s=2*i()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=s*e,t}function He(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12],t[1]=i[1]*r+i[5]*s+i[9]*n+i[13],t[2]=i[2]*r+i[6]*s+i[10]*n+i[14],t}function Qo(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=r*i[0]+s*i[3]+n*i[6],t[1]=r*i[1]+s*i[4]+n*i[7],t[2]=r*i[2]+s*i[5]+n*i[8],t}function Jc(t,e,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=e[0],l=e[1],c=e[2],u=s*c-n*l,d=n*a-r*c,p=r*l-s*a,m=s*p-n*d,g=n*u-r*p,y=r*d-s*u,v=2*o;return t[0]=a+u*v+2*m,t[1]=l+d*v+2*g,t[2]=c+p*v+2*y,t}function eBe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function tBe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function iBe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function mbe(t,e){ge(Yoe,t),ge(Zoe,e);const i=pe(Yoe,Zoe);return i>1?0:i<-1?Math.PI:Math.acos(i)}const Yoe=E(),Zoe=E();function rBe(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Oo(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function LS(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=e[0],o=e[1],a=e[2],l=Lo();return Math.abs(i-n)<=l*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=l*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function k0(t,e,i){const r=i[0]-e[0],s=i[1]-e[1],n=i[2]-e[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),t[0]=r*o,t[1]=s*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Ai=ve,sBe=nB,nBe=gU,e1=wr,DI=Ko,Ml=Ae,yU=Za,Xoe=Object.freeze(Object.defineProperty({__proto__:null,abs:xM,add:me,angle:mbe,bezier:QVe,ceil:YVe,copy:ce,cross:ot,direction:k0,dist:e1,distance:wr,div:nBe,divide:gU,dot:pe,equals:LS,exactEquals:Oo,floor:hbe,hermite:JVe,inverse:XVe,len:Ml,length:Ae,lerp:yr,max:fbe,min:pbe,mul:sBe,multiply:nB,negate:ea,normalize:ge,random:KVe,rotateX:eBe,rotateY:tBe,rotateZ:iBe,round:ZVe,scale:oe,scaleAndAdd:On,set:ne,sign:dbe,sqrDist:DI,sqrLen:yU,squaredDistance:Ko,squaredLength:Za,str:rBe,sub:Ai,subtract:ve,transformMat3:Qo,transformMat4:He,transformQuat:Jc},Symbol.toStringTag,{value:"Module"})),Joe=new Float32Array(1);function gbe(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function Te(t,e,i){return Math.min(Math.max(t,e),i)}function NI(t){return!(t&t-1)}function Lzt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function Dzt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function Dt(t,e,i){return t+(e-t)*i}function Nzt(t,e,i,r,s){return Dt(r,s,(t-e)/(i-e))}function Rt(t){return t*Math.PI/180}function Ma(t){return 180*t/Math.PI}function G9(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function fo(t){return Math.acos(Te(t,-1,1))}function Tf(t){return Math.asin(Te(t,-1,1))}function t1(t,e,i=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=i}const _U=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function j9(t){return _U.setFloat64(0,t),_U.getBigInt64(0)}function oBe(t){return _U.setBigInt64(0,t),_U.getFloat64(0)}const A4=BigInt("1000000"),aBe=ybe(1);function ybe(t){const e=j9(t=Math.abs(t)),i=oBe(e<=A4?A4:e-A4);return Math.abs(t-i)}function Fzt(t,e,i=aBe){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(i!=null&&ybe(Math.min(Math.abs(t),Math.abs(e)))<i)return Math.abs(t-e)<=i;const r=j9(t),s=j9(e);return r<0!=s<0?!1:!((r<s?s-r:r-s)>A4)}function lBe(t,e,i=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const r=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function cBe(t){return _be(Math.max(-H9,Math.min(t,H9)))}function _be(t){return Joe[0]=t,Joe[0]}function FI(t,e,i){const r=Te((i-t)/(e-t),0,1);return r*r*(3-2*r)}function Qoe(t,e){const i=Ae(t),r=Tf(t[2]/i),s=Math.atan2(t[1]/i,t[0]/i);return ne(e,i,r,s),e}function vU(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],r=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(t1(e,1)&&t1(i,1)&&t1(r,1))}const H9=_be(34028234663852886e22);let x1=class{constructor(e,i){this.min=e,this.max=i,this.range=i-e}normalize(e,i=0,r=!1){return Koe(this.range,this.min,this.max,e,i,r)}clamp(e,i=0){return Te(e-i,this.min,this.max)+i}monotonic(e,i,r){return e<i?i:i+q9(this.range,e-i,r)}minimalMonotonic(e,i,r){return Koe(this.range,e,e+this.range,i,r)}center(e,i,r){return i=this.monotonic(e,i,r),this.normalize((e+i)/2,r)}diff(e,i,r){return this.monotonic(e,i,r)-e}shortestSignedDiff(e,i){e=this.normalize(e);const r=(i=this.normalize(i))-e,s=i<e?this.minimalMonotonic(e,i)-e:i-this.minimalMonotonic(i,e);return Math.abs(r)<Math.abs(s)?r:s}contains(e,i,r){return i=this.minimalMonotonic(e,i),(r=this.minimalMonotonic(e,r))>e&&r<i}};function Koe(t,e,i,r,s=0,n=!1){return(r-=s)<e?r+=q9(t,e-r):r>i&&(r-=q9(t,r-i)),n&&r===i&&(r=e),r+s}function q9(t,e,i=0){return Math.ceil((e-i)/t)*t+i}const uBe=new x1(0,2*Math.PI),S1=new x1(-Math.PI,Math.PI),tee=new x1(0,360);let hBe=class vbe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new vbe;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,Q(r.value),r.origin)}),i}get(e,i){i=this._normalizeOrigin(i);const r=this._values.get(e);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(e){var i;return((i=this._values.get(e))==null?void 0:i.origin)??Ii.USER}keys(e){e=this._normalizeOrigin(e);const i=[...this._values.keys()];return e==null?i:i.filter(r=>{var s;return((s=this._values.get(r))==null?void 0:s.origin)===e})}set(e,i,r){if((r=this._normalizeOrigin(r))===Ii.DEFAULTS){const s=this._values.get(e);if((s==null?void 0:s.origin)!=null&&s.origin>r)return}this._values.set(e,new dBe(i,r))}delete(e,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(e))==null?void 0:r.origin)!==i||this._values.delete(e)}has(e,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(e))==null?void 0:r.origin)===i:this._values.has(e)}forEach(e){this._values.forEach(({value:i},r)=>e(i,r))}_normalizeOrigin(e){if(e!=null)return e===Ii.DEFAULTS?e:Ii.USER}},dBe=class{constructor(e,i){this.value=e,this.origin=i}};function bbe(t,e,i){e.keys().forEach(s=>{i.set(s,e.get(s),Ii.DEFAULTS)});const r=t.metadata;Object.keys(r).forEach(s=>{t.internalGet(s)&&i.set(s,t.internalGet(s),Ii.DEFAULTS)})}function pBe(t,e,i){if(!(t!=null&&t.read)||t.read.enabled===!1||!t.read.source)return!1;const r=t.read.source;if(typeof r=="string"){if(r===e||r.includes(".")&&r.indexOf(e)===0&&Poe(r,i))return!0}else for(const s of r)if(s===e||s.includes(".")&&s.indexOf(e)===0&&Poe(s,i))return!0;return!1}function fBe(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function mBe(t,e,i,r,s){let n=z9(e[i],s);fBe(n)&&(t[i]=!0);for(const o of Object.getOwnPropertyNames(e))n=z9(e[o],s),pBe(n,i,r)&&(t[o]=!0)}function gBe(t,e,i,r){const s=i.metadata,n=LVe(s[e],r),o=n==null?void 0:n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,r):o;a!==void 0&&i.set(e,a)}const wbe={origin:"service"};function xbe(t,e,i=wbe){if(!e||typeof e!="object")return;const r=tl(t),s=r.metadata,n={};for(const o of Object.getOwnPropertyNames(e))mBe(n,s,o,e,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(n)){const a=z9(s[o],i).read,l=a==null?void 0:a.source;let c;c=l&&typeof l=="string"?k3(e,l):e[o],a!=null&&a.reader&&(c=a.reader.call(t,c,e,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||gBe(t,o,r,i)}r.setDefaultOrigin("user")}function yBe(t,e,i,r=wbe){var n;const s={...r,messages:[]};i(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||t.loaded?r!=null&&r.messages&&r.messages.push(o):t.loadWarnings.push(o)})}function _Be(t,e,i,r,s){var o,a;const n={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,r,n,i,s),n}function Sbe(t,e,i,r,s,n){if(!(r!=null&&r.write))return!1;const o=mf(t,i);if(!s&&r.write.overridePolicy){const a=r.write.overridePolicy.call(t,o,i,n??void 0);a!==void 0&&(s=a)}if(s||(s=r.write),!s||s.enabled===!1||s.layerContainerTypes&&(n!=null&&n.layerContainerType)&&!s.layerContainerTypes.includes(n.layerContainerType))return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new V("web-document-write:property-required",`Missing value for required property '${i}' on '${t.declaredClass}'`,{propertyName:i,target:t});return a&&(n!=null&&n.messages)?n.messages.push(a):a&&!n&&ie.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||!s.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(i)===Ii.DEFAULTS)&&vBe(t,i,n,r,o)||!s.ignoreOrigin&&(n!=null&&n.origin)&&e.store.multipleOriginsSupported&&e.store.originOf(i)<jv(n.origin))}function vBe(t,e,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(t,e,i??void 0);return w1(o,s)}return!1}return n===s}function bBe(t,e,i,r){const s=tl(t),n=s.metadata,o=ibe(n[e],r);return!!o&&Sbe(t,s,e,o,i,r)}function Tbe(t,e,i){var n,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return S4(e,t.toJSON(i));const r=tl(t),s=r.metadata;for(const a in s){const l=ibe(s[a],i);if(!Sbe(t,r,a,l,void 0,i))continue;const c=mf(t,a),u=_Be(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,i);Object.keys(u).length>0&&(e=S4(e,u),(o=(n=i==null?void 0:i.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>S4(e,u,()=>"replace-arrays"))),i!=null&&i.writtenProperties&&i.writtenProperties.push({target:t,propName:a,oldOrigin:_ze(r.store.originOf(a)),newOrigin:i.origin}))}return e}const j3=t=>{let e=class extends t{constructor(...i){super(...i);const r=tl(this),s=r.store,n=new hBe;r.store=n,bbe(r,s,n)}read(i,r){xbe(this,i,r)}write(i,r){return Tbe(this,i??{},r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return wBe.call(this,i,r)}};return e=h([I("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function wBe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(t,e),i}function bU(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}let ye=class extends j3(Re){};ye=h([I("esri.core.JSONSupport")],ye);const xBe=Object.prototype.toString;function SBe(t){const e="__accessorMetadata__"in t?Ln(t):t;return function(...i){if(i.push(e),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return TBe.apply(this,i)}}function TBe(t,e,i,r){ZV(t,e).cast=r}function EBe(t){return(e,i)=>{ZV(e,t).cast=e[i]}}function Li(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&xBe.call(t[0])==="[object Function]"?SBe(t[0]):t.length===1&&typeof t[0]=="string"?EBe(t[0]):void 0}function Ce(t,e,i){let r,s;return e===void 0||Array.isArray(e)?(s=t,i=e,r=[void 0]):(s=e,r=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;r.forEach(l=>{const c=Z1e(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}function Ve(t,e,i){let r,s;return e===void 0?(s=t,r=[void 0]):typeof e!="string"?(s=t,r=[void 0],i=e):(s=e,r=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;for(const l of r){const c=Z1e(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}let qi=class{constructor(e,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=CBe(e),this.apiValues=eae(this._apiToJSON),this.jsonValues=eae(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const o=this.toJSON(r);o!==void 0&&kl(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const i=this._apiToJSON[e];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}};function CBe(t){const e={};for(const i in t)e[t[i]]=i;return e}function eae(t){const e=[];for(const i in t)e.push(i);return e.sort(),e}function Bl(){return function(t,e){return new qi(t,{ignoreUnknown:!0,...e})}}let iee=class{constructor(e,i,r,s){this.semiMajorAxis=e,this.flattening=i,this.outerAtmosphereRimWidth=r;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const ir=new iee(6378137,1/298.257223563,3e5,.006694379990137799),gf=new iee(3396190,1/169.8944472236118,23e4),x0=new iee(1737400,0,0),MBe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,ABe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function W9(t){const e=t==null?void 0:t.match(MBe);if(!e)return null;const[,i,r,s]=e;if(!i)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:u}=ABe;if(r)if(n=i,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=u);else switch(i.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=u);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function PBe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function Ebe(t){const e=atob(t),i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i.buffer}function OBe(t){const e=new Uint8Array(t);let i="";for(let r=0;r<e.length;r++)i+=String.fromCharCode(e[r]);return btoa(i)}const RBe=()=>ie.getLogger("esri.core.urlUtils"),RA=lr.request,tae="esri/config: esriConfig.request.proxyUrl is not set.",Cbe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,Mbe=/^\s*http:/i,$Be=/^\s*https:/i,IBe=/^\s*file:/i,LBe=/:\d+$/,DBe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,NBe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),FBe=new RegExp("^((([^[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^[:]*))(:([0-9]+))?$");let LC=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(NBe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(FBe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}};const aD={},kBe=new LC(lr.applicationUrl);let Il=kBe;const UBe=zBe();let ree=UBe;const see=()=>Il,Abe=()=>ree;function zBe(){const t=Il.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${Il.scheme}://${Il.host}${Il.port!=null?`:${Il.port}`:""}`}${e}`}function Ns(t){if(!t)return null;const e={path:null,query:null},i=new LC(t),r=t.indexOf("?");return i.query===null?e.path=t:(e.path=t.substring(0,r),e.query=nee(i.query)),i.fragment&&(e.hash=i.fragment,i.query===null&&(e.path=e.path.substring(0,e.path.length-(i.fragment.length+1)))),e}function nee(t){const e=t.split("&"),i={};for(const r of e){if(!r)continue;const s=r.indexOf("=");let n,o;s<0?(n=decodeURIComponent(r),o=""):(n=decodeURIComponent(r.slice(0,s)),o=decodeURIComponent(r.slice(s+1)));let a=i[n];typeof a=="string"&&(a=i[n]=[a]),Array.isArray(a)?a.push(o):i[n]=o}return i}function DS(t,e){return t?Object.keys(t).map(i=>{const r=t[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=e==null?void 0:e[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(o=>bU(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):bU(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function VBe(t=!1){let e,i=RA.proxyUrl;if(typeof t=="string"){e=qBe(t);const r=oB(t);r&&(i=r.proxyUrl)}else e=!!t;if(!i)throw RBe().warn(tae),new V("urlUtils:proxy-not-set",tae);return e&&Z9()&&(i=hee(i)),Ns(i)}function jzt(t){const e=oB(t);let i,r;if(e){const s=oee(e.proxyUrl);i=s.path,r=s.query?nee(s.query):null}if(i){const s=Ns(t);t=i+"?"+s.path;const n=DS({...r,...s.query});n&&(t=`${t}?${n}`)}return t}const dP={path:"",query:""};function oee(t){const e=t.indexOf("?");return e!==-1?(dP.path=t.slice(0,e),dP.query=t.slice(e+1)):(dP.path=t,dP.query=null),dP}function Pbe(t){return t=(t=xU(t=JBe(t=oee(t).path),!0)).toLowerCase()}function BBe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:Pbe(t.urlPrefix)},i=RA.proxyRules,r=e.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const o=i[n].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;s=n;break}o.indexOf(r)===0&&(s=n+1)}return i.splice(s,0,e),s}function oB(t){const e=RA.proxyRules,i=Pbe(t);for(let r=0;r<e.length;r++)if(i.indexOf(e[r].urlPrefix)===0)return e[r]}function GBe(t,e){if(!t||!e)return!1;t=wU(t),e=wU(e);const i=W9(t),r=W9(e);return i!=null&&r!=null?i.portalHostname===r.portalHostname:i==null&&r==null&&SM(t,e,!0)}function Obe(t,e){return t=wU(t),e=wU(e),xU(t)===xU(e)}function wU(t){const e=(t=vh(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function Y9(t,e=RA.interceptors){const i=r=>r==null||r instanceof RegExp&&r.test(t)||typeof r=="string"&&t.startsWith(r);if(e){for(const r of e)if(Array.isArray(r.urls)){if(r.urls.some(i))return r}else if(i(r.urls))return r}return null}function SM(t,e,i=!1){if(!t||!e)return!1;const r=J9(t),s=J9(e);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function aee(t){if(typeof t=="string"){if(!xc(t))return!0;t=J9(t)}if(SM(t,Il))return!0;const e=RA.trustedServers||[];for(let i=0;i<e.length;i++){const r=jBe(e[i]);for(let s=0;s<r.length;s++)if(SM(t,r[s]))return!0}return!1}function jBe(t){return aD[t]||(uee(t)||zd(t)?aD[t]=[new LC(uh(t))]:aD[t]=[new LC(`http://${t}`),new LC(`https://${t}`)]),aD[t]}function uh(t,e=ree,i){return zd(t)?i!=null&&i.preserveProtocolRelative?t:Il.scheme==="http"&&Il.authority===Dd(t).slice(2)?`http:${t}`:`https:${t}`:uee(t)?t:zl(t[0]==="/"?XBe(e):e,t)}function lee(t,e=ree,i){if(t==null||!xc(t))return t;const r=vh(t),s=r.toLowerCase(),n=vh(e).toLowerCase().replace(/\/+$/,""),o=i?vh(i).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return t;const a=(d,p,m)=>(m=d.indexOf(p,m))===-1?d.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return t;t=r.slice(c);const u=n.slice(c-1).replaceAll(/[^/]+/g,"").length;if(u>0)for(let d=0;d<u;d++)t=`../${t}`;else t=`./${t}`;return t}function vh(t){return t=eGe(t=KBe(t=QBe(t=uh(t=t.trim()))))}function zl(...t){const e=t.filter(K1);if(!(e!=null&&e.length))return;const i=[];if(xc(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),YBe(e[0])&&(i[0]+="/"),e[0]=s.slice(n+2))}else e[0][0]==="/"&&i.push("");const r=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function Dd(t,e=!1){if(t==null||TM(t)||Og(t))return null;let i=t.indexOf("://");if(i===-1&&zd(t))i=2;else{if(i===-1)return null;i+=3}const r=t.indexOf("/",i);return r!==-1&&(t=t.slice(0,r)),e&&(t=xU(t,!0)),t}function xc(t){return zd(t)||uee(t)}function TM(t){return t!=null&&t.slice(0,5)==="blob:"}function Og(t){return t!=null&&t.slice(0,5)==="data:"}function cee(t){const e=T1(t);return e!=null&&e.isBase64?Ebe(e.data):null}function Hzt(t){return OBe(t).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const HBe=/^data:(.*?)(;base64)?,(.*)$/;function T1(t){const e=t.match(HBe);if(!e)return null;const[,i,r,s]=e;return{mediaType:i,isBase64:!!r,data:s}}function Rbe(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}async function qzt(t){return(await fetch(t)).blob()}function Wzt(t){const e=cee(t);if(!e)return null;const i=T1(t);return new Blob([e],{type:i.mediaType})}function zd(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function uee(t){return t!=null&&Cbe.test(t)}function qBe(t){return t!=null&&$Be.test(t)||Il.scheme==="https"&&zd(t)}function WBe(t){return t!=null&&Mbe.test(t)||Il.scheme==="http"&&zd(t)}function YBe(t){return t!=null&&IBe.test(t)}function hee(t){return zd(t)?`https:${t}`:t.replace(Mbe,"https:")}function ZBe(){return Il.scheme==="http"}function Z9(){return Il.scheme==="https"}function xU(t,e=!1){return zd(t)?t.slice(2):(t=t.replace(Cbe,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function XBe(t){const e=t.indexOf("//"),i=t.indexOf("/",e+2);return i===-1?t:t.slice(0,i)}function aB(t){let e=0;if(xc(t)){const r=t.indexOf("//");r!==-1&&(e=r+2)}const i=t.lastIndexOf("/");return i<e?t:t.slice(0,i+1)}function Yzt(t,e){if(!t)return"";const i=Ns(t).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!(e!=null&&e.length))return r;const s=new RegExp(`\\.(${e.join("|")})$`,"i");return r.replace(s,"")}function JBe(t){return t.endsWith("/")?t:`${t}/`}function lB(t){return t.replace(/\/+$/,"")}function QBe(t){if(/^https?:\/\//i.test(t)){const e=oee(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function KBe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function eGe(t){const e=RA.httpsDomains;if(!WBe(t))return t;const i=t.indexOf("/",7);let r;if(r=i===-1?t:t.slice(0,i),r=r.toLowerCase().slice(7),LBe.test(r)){if(!r.endsWith(":80"))return t;r=r.slice(0,-3),t=t.replace(":80","")}return ZBe()&&r===Il.authority&&!DBe.test(t)||(Z9()&&r===Il.authority||e&&e.some(s=>r===s||r.endsWith(`.${s}`))||Z9()&&!oB(t))&&(t=hee(t)),t}function X9(t,e,i){if(!(e&&i&&t&&xc(t)))return t;const r=t.indexOf("//"),s=t.indexOf("/",r+2),n=t.indexOf(":",r+2),o=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(r+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,r+2)}${i}${t.slice(o)}`}function J9(t){return typeof t=="string"?new LC(uh(t)):(t.scheme||(t.scheme=Il.scheme),t)}function $be(t){return rGe.test(t)}function Ibe(t,e){const i=Ns(t),r=Object.keys(i.query||{});return r.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function tGe(t,e,i){const r=Ns(t),s=r.query||{};return s[e]=String(i),`${r.path}?${DS(s)}`}function ag(t,e){if(!e)return t;const i=Ns(t),r=i.query||{};for(const[n,o]of Object.entries(e))o!=null&&(r[n]=o);const s=DS(r);return s?`${i.path}?${s}`:i.path}function iGe(t){if(t==null)return null;const e=t.match(Lbe);return e?e[2]:null}function iae(t){if(t==null)return null;const e=t.match(Lbe);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function Zzt(t){return typeof t=="string"?T1(t)??{data:t}:new Promise((e,i)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(T1(r.result)),r.onerror=s=>i(s)})}const Lbe=/([^.]*)\.([^/]*)$/,rGe=/(^data:image\/svg|\.svg$)/i,Dbe="20240621",Nbe="96d683427103aedd3960cf342647a8857de30ca3";Symbol.dispose??(Symbol.dispose=Symbol("Symbol.dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose"));const sGe="4.30";let pi,dee=sGe;dee="4.30.0";function Xzt(t){pi=t}function Jzt(t){const e=pi==null?void 0:pi.findCredential(t);return e!=null&&e.token?tGe(t,"token",e.token):t}re("host-webworker");const nGe=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function pee(t){const e=Dd(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!nGe.has(e)&&!t.endsWith("/sharing/rest/generateToken")}function Fbe(t,e,i=!1,r){return new Promise((s,n)=>{if(Yn(r))return void n(rae());let o=()=>{c(),n(new Error(`Unable to load ${e}`))},a=()=>{const u=t;c(),s(u)},l=()=>{if(!t)return;const u=t;c(),u.src="",n(rae())};const c=()=>{re("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,r!=null&&r.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(e)};r!=null&&r.addEventListener("abort",l),re("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function rae(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const kbe="Timeout exceeded";function oGe(){return new Error(kbe)}function Qzt(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===kbe}function aGe(t){lr.request.crossOriginNoCorsDomains||(lr.request.crossOriginNoCorsDomains={});const e=lr.request.crossOriginNoCorsDomains;for(let i of t)i=i.toLowerCase(),/^https?:\/\//.test(i)?e[Dd(i)??""]=0:(e[Dd("http://"+i)??""]=0,e[Dd("https://"+i)??""]=0)}function lGe(t){const e=lr.request.crossOriginNoCorsDomains;if(e){let i=Dd(t);if(i)return i=i.toLowerCase(),!SM(i,see())&&e[i]<Date.now()-36e5}return!1}async function cGe(t){var s;const e=lr.request.crossOriginNoCorsDomains,i=Dd(t);e&&i&&(e[i.toLowerCase()]=Date.now());const r=Ns(t);t=r.path,((s=r.query)==null?void 0:s.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function Yt(t,e){var p;t instanceof URL&&(t=t.toString()),(e==null?void 0:e.query)instanceof URLSearchParams&&(e.query=nee(e.query.toString().replaceAll("+"," ")));const i=Og(t),r=TM(t);r||i||(t=vh(t));const s={url:t,requestOptions:{...e}},n=m=>({data:m,getAllHeaders:EM,getHeader:EM,httpStatus:200,requestOptions:s.requestOptions,url:s.url}),o=Y9(t,md.internalInterceptors);if(o){const m=await nae(o,s);if(m!=null)return n(m)}let a=Y9(t);if(a){const m=await nae(a,s);if(m!=null)return n(m);a.after||a.error||(a=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"&&(re("host-webworker")||re("host-node")))throw lg("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(e.method==="head"){if(e.body)throw lg("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw lg("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await fGe(),SU)return SU.execute(t,e);const l=new AbortController,c=Io(e,()=>l.abort()),u={controller:l,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:a,params:s,redoRequest:!1,useIdentity:md.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},d=await _Ge(u).finally(()=>c==null?void 0:c.remove());return(p=a==null?void 0:a.after)==null||p.call(a,d),d}let SU;const md=lr.request,Ube="FormData"in globalThis,uGe=new Set([499,498,403,401]),hGe=new Set(["COM_0056","COM_0057","SB_0008"]),dGe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],EM=()=>null,TU=Symbol();function pGe(t){const e=Dd(t);e&&!Yt._corsServers.includes(e)&&Yt._corsServers.push(e)}function sae(t){const e=Dd(t);return!e||e.endsWith(".arcgis.com")||Yt._corsServers.includes(e)||aee(e)}function lg(t,e,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getAllHeaders:EM,getHeader:EM,ssl:!1};if(e instanceof V)return e.details?(e.details=Q(e.details),e.details.url=i.url,e.details.requestOptions=i.requestOptions):e.details=n,e;if(e){const o=r&&(()=>Array.from(r.headers)),a=r&&(u=>r.headers.get(u)),l=r==null?void 0:r.status,c=e.message;c&&(s=c),o&&a&&(n.getAllHeaders=o,n.getHeader=a),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||l||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?n.messages=[e.details]:n.messages=e.details,n.raw=TU in e?e[TU]:e}return ms(e)?Di():new V(t,s,n)}async function fGe(){re("host-webworker")&&!SU&&(SU=await fe(()=>import("./request-Bcye5KPz.js"),[]))}async function Q9(){pi||await fe(()=>import("./IdentityManager-B9mpprrX.js"),__vite__mapDeps([0,1]))}async function mGe(t){var a;const e=t.params.url,i=t.params.requestOptions,r=t.controller.signal,s=i.body;let n=null,o=null;if(Ube&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),t.fetchOptions={cache:i.cacheBust?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:md.priority,redirect:"follow",signal:r},(n||o)&&(t.fetchOptions.body=n||o),i.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=i.query)!=null&&a.token||n!=null&&n.get("token")),!t.hasToken&&lr.apiKey&&pee(e)&&(i.query||(i.query={}),i.query.token=lr.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!zbe(e)&&!Yn(r)){let l;i.authMode==="immediate"?(await Q9(),l=await pi.getCredential(e,{signal:r}),t.credential=l):i.authMode==="no-prompt"?(await Q9(),l=await pi.getCredential(e,{prompt:!1,signal:r}).catch(()=>{}),t.credential=l):pi&&(l=pi.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function zbe(t){return dGe.some(e=>e.test(t))}async function gGe(t){let e=t.params.url;const i=t.params.requestOptions,r=t.fetchOptions??{},s=TM(e)||Og(e),n=i.responseType||"json",o=s?0:i.timeout!=null?i.timeout:md.timeout;let a=!1;if(!s){t.useSSL&&(e=hee(e));let p={...i.query};t.credentialToken&&(p.token=t.credentialToken);let m=DS(p);re("esri-url-encodes-apostrophe")&&(m=m.replaceAll("'","%27"));const g=e.length+1+m.length;let y;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||g>md.maxUrlLength;const v=i.useProxy||!!oB(e);if(v){const b=VBe(e);y=b.path,!a&&y.length+1+g>md.maxUrlLength&&(a=!0),b.query&&(p={...b.query,...p})}if(r.method==="HEAD"&&(a||v)){if(a)throw g>md.maxUrlLength?lg("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):lg("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw lg("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?e=ag(e,p):(r.body=DS(p),r.headers||(r.headers={}),r.headers["Content-Type"]="application/x-www-form-urlencoded")):e=ag(e,p),v&&(t.useProxy=!0,e=`${y}?${e}`),p.token&&Ube&&r.body instanceof FormData&&!PBe(e)&&r.body.set("token",p.token),i.hasOwnProperty("withCredentials"))t.withCredentials=i.withCredentials;else if(!SM(e,see())){if(aee(e))t.withCredentials=!0;else if(pi){const b=pi.findServerInfo(e);b!=null&&b.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(r.credentials="include",lGe(e)&&await cGe(a?ag(e,p):e))}let l,c,u=0,d=!1;o>0&&(u=setTimeout(()=>{d=!0,t.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=e;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||yGe(i.headers)||!s&&!t.useProxy&&md.proxyUrl&&!sae(e)){if(Yt._beforeFetch&&await Yt._beforeFetch(e,r),l=await fetch(e,r),Yt._afterFetch&&await Yt._afterFetch(l),t.useProxy||pGe(e),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(u&&(clearTimeout(u),u=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=oae(c,"application/xml");break;case"document":c=oae(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const p=l.headers.get("Content-Type");if(p&&/application\/json|text\/plain/i.test(p)&&c[n==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}n==="image"&&c instanceof Blob&&(c=await aae(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await aae(e,t)}catch(p){if(p.name==="AbortError")throw d?oGe():Di("Request canceled");if(!(!l&&p instanceof TypeError&&md.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||t.useProxy||sae(e))throw p;t.redoRequest=!0,BBe({proxyUrl:md.proxyUrl,urlPrefix:Dd(e)??""})}finally{u&&clearTimeout(u)}return[l,c]}async function nae(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let i,r;try{r=await t.before(e)}catch(s){i=lg("request:interceptor",s,e)}if((r instanceof Error||r instanceof V)&&(i=lg("request:interceptor",r,e)),i)throw t.error&&t.error(i),i;return r}}function yGe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function oae(t,e){let i;try{i=new DOMParser().parseFromString(t,e)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function _Ge(t){var n,o;let e,i;await mGe(t);try{do[e,i]=await gGe(t);while(!await vGe(t,e,i))}catch(a){const l=lg("request:server",a,t.params,e);throw l.details.ssl=t.useSSL,(n=t.interceptor)!=null&&n.error&&t.interceptor.error(l),l}const r=t.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!t.hasToken&&!t.credentialToken&&((o=i.user)!=null&&o.username)&&!aee(r)){const a=Dd(r,!0);a&&md.trustedServers.push(a)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&aGe(i.authorizedCrossOriginNoCorsDomains)}const s=t.credential;if(s&&pi){const a=pi.findServerInfo(s.server);let l=a==null?void 0:a.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");const c=pi.findCredential(l,s.userId);c&&pi._getIdenticalSvcIdx(l,c)===-1&&c.resources.unshift(l)}}return{data:i,getAllHeaders:e?()=>Array.from(e.headers):EM,getHeader:e?a=>e.headers.get(a):EM,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function vGe(t,e,i){var c;if(t.redoRequest)return t.redoRequest=!1,!1;const r=t.params.requestOptions;if(!e||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n;if(i&&(i.error&&typeof i.error=="object"?s=i.error:i.status==="error"&&Array.isArray(i.messages)&&(s={...i},s[TU]=i,s.details=i.messages)),!s&&!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[TU]=i,s;let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o==null?void 0:o.toUpperCase());const l=r.authMode;if(n===403&&(a===4||(c=s.message)!=null&&c.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&uGe.has(n)&&!zbe(t.params.url)&&(n!==403||(!o||!hGe.has(o))&&(a==null||a===2&&t.credentialToken))){await Q9();try{const u=await pi.getCredential(t.params.url,{error:lg("request:server",s,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=u,t.credentialToken=u.token,t.useSSL=t.useSSL||u.ssl,!1}catch(u){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=u}}if(s)throw s;return!0}function aae(t,e,i=!1){const r=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=md.priority,s.src=t,Fbe(s,t,i,r)}Yt._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],Yt._beforeFetch=void 0,Yt._afterFetch=void 0;function bGe(t,e){return Yt(mr(t),e)}function mr(t){if(!lr.assetsPath)throw ie.getLogger("esri.assets").errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new V("assets:path-not-set","config.assetsPath is not set");return zl(lr.assetsPath,t)}let Wj,ae=null;function Vbe(){return!!ae}function wGe(){return!!re("esri-wasm")}function Bbe(){return Wj||(Wj=fe(()=>import("./pe-wasm-DbC8G-Mz.js"),[]).then(t=>t.p).then(({default:t})=>t({locateFile:e=>mr(`esri/geometry/support/${e}`)})).then(t=>{jbe(t)}),Wj)}var K9,rn,e7;(function(t){function e(n,o,a){ae.ensureCache.prepare();const l=Sx(a),c=a===l,u=ae.ensureFloat64(l),d=ae._pe_geog_to_proj(ae.getPointer(n),o,u);return d&&Lv(a,o,u,c),d}function i(n,o,a,l){switch(l){case rn.PE_TRANSFORM_P_TO_G:return r(n,o,a);case rn.PE_TRANSFORM_G_TO_P:return e(n,o,a)}return 0}function r(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){ae.ensureCache.prepare();const c=Sx(a),u=a===c,d=ae.ensureFloat64(c),p=ae._pe_proj_to_geog_center(ae.getPointer(n),o,d,l);return p&&Lv(a,o,d,u),p}t.geogToProj=e,t.projGeog=i,t.projToGeog=r,t.projToGeogCenter=s})(K9||(K9={})),function(t){function e(){t.PE_BUFFER_MAX=ae.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=ae.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=ae.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=ae.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=ae.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=ae.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=ae.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=ae.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=ae.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=ae.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=ae.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=ae.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=ae.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=ae.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=ae.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=ae.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=ae.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=ae.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=ae.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=ae.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_STR_FMT_WKT=ae.PeDefs.prototype.PE_STR_FMT_WKT,t.PE_STR_FMT_WKT2=ae.PeDefs.prototype.PE_STR_FMT_WKT2,t.PE_PARM_X0=ae.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=ae.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=ae.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=ae.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=ae.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=ae.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=ae.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=ae.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=ae.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=ae.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(rn||(rn={})),function(t){const e={},i={},r=m=>{if(m){const g=m.getType();switch(g){case rn.PE_TYPE_GEOGCS:m=ae.castObject(m,ae.PeGeogcs);break;case rn.PE_TYPE_PROJCS:m=ae.castObject(m,ae.PeProjcs);break;case rn.PE_TYPE_GEOGTRAN:m=ae.castObject(m,ae.PeGeogtran);break;default:g&rn.PE_TYPE_UNIT&&(m=ae.castObject(m,ae.PeUnit))}}return m};function s(){ae.PeFactory.prototype.initialize(null)}function n(m){return o(rn.PE_TYPE_COORDSYS,m)}function o(m,g){let y=null,v=e[m];if(v||(v={},e[m]=v),v.hasOwnProperty(String(g)))y=v[g];else{const b=ae.PeFactory.prototype.factoryByType(m,g);ae.compare(b,ae.NULL)||(y=b,v[g]=y)}return y=r(y),y}function a(m,g){let y=null,v=i[m];if(v||(v={},i[m]=v),v.hasOwnProperty(g))y=v[g];else{const b=ae.PeFactory.prototype.fromString(m,g);ae.compare(b,ae.NULL)||(y=b,v[g]=y)}return y=r(y),y}function l(m){return o(rn.PE_TYPE_GEOGCS,m)}function c(m){return o(rn.PE_TYPE_GEOGTRAN,m)}function u(m){return ae.PeFactory.prototype.getCode(m)}function d(m){return o(rn.PE_TYPE_PROJCS,m)}function p(m){return o(rn.PE_TYPE_UNIT,m)}t.initialize=s,t.coordsys=n,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=u,t.projcs=d,t.unit=p}(e7||(e7={}));let Gbe=null;var EU,t7,i7,r7,CU,s7,MU,AU,n7;function jbe(t){function e(n,o,a){n[o]=a(n[o])}ae=t,rn.init(),EU.init(),CU.init(),MU.init(),AU.init(),Gbe=class extends ae.PeGCSExtent{destroy(){ae.destroy(this)}};const i=[ae.PeDatum,ae.PeGeogcs,ae.PeGeogtran,ae.PeObject,ae.PeParameter,ae.PePrimem,ae.PeProjcs,ae.PeSpheroid,ae.PeUnit];for(const n of i)e(n.prototype,"getName",o=>function(){return o.call(this,new Array(rn.PE_NAME_MAX))});for(const n of[ae.PeGeogtran,ae.PeProjcs])e(n.prototype,"getParameters",o=>function(){const a=new Array(rn.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const u=ae.getValue(l,"*");a[c]=u?ae.wrapPointer(u,ae.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(ae.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return Lv(a,o,n.call(this)),a}),e(ae.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=ae._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!ae.compare(l,ae.NULL)){a=[l];const c=this.getSteps();if(c>1){const u=ae.getPointer(l);for(let d=1;d<c;d++)a.push(ae.wrapPointer(u+o*d,ae.PeGTlistExtendedGTs))}}return a}});const r=ae._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!ae.compare(l,ae.NULL)){a=[l];const c=l.getNump();if(c>1){const u=ae.getPointer(l);for(let d=1;d<c;d++)a.push(ae.wrapPointer(u+r*d,ae.PeHorizon))}}return o.set(n,a),a};e(ae.PeProjcs.prototype,"horizonGcsGenerate",s),e(ae.PeProjcs.prototype,"horizonPcsGenerate",s),ae.PeObject.prototype.toString=function(n=rn.PE_STR_OPTS_NONE){ae.ensureCache.prepare();const o=ae.getPointer(this),a=ae.ensureInt8(new Array(rn.PE_BUFFER_MAX));return ae.UTF8ToString(ae._pe_object_to_string_ext(o,n,a))}}function qg(t){if(!t)return;const e=ae.getClass(t);if(!e)return;const i=ae.getCache(e);if(!i)return;const r=ae.getPointer(t);r&&delete i[r]}function lD(t,e){const i=[],r=new Array(e);for(let s=0;s<t;s++)i.push(ae.ensureInt8(r));return i}function Sx(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(i=>{e.push(i[0],i[1])})):e=t,e}function Lv(t,e,i,r=!1){if(r)for(let s=0;s<2*e;s++)t[s]=ae.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=ae.getValue(i,"double"),t[n][1]=ae.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function i(){t.PE_GTLIST_OPTS_COMMON=ae.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=ae._pe_getPeGTlistExtendedEntrySize()}function r(s,n,o,a,l,c){let u=null;const d=new ae.PeInteger(c);try{const p=ae.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,d);if((c=d.val)&&(u=[p],c>1)){const m=ae.getPointer(p);for(let g=1;g<c;g++)u.push(ae.wrapPointer(m+e*g,ae.PeGTlistExtendedEntry))}}finally{ae.destroy(d)}return u}t.init=i,t.getGTlist=r})(EU||(EU={})),function(t){function e(i){if(i!=null&&i.length){for(const r of i)qg(r),r.getEntries().forEach(s=>{qg(s);const n=s.getGeogtran();qg(n),n.getParameters().forEach(qg),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{qg(o);const a=o.getDatum();qg(a),qg(a.getSpheroid()),qg(o.getPrimem()),qg(o.getUnit())})});ae.PeGTlistExtendedEntry.prototype.Delete(i[0])}}t.destroy=e}(t7||(t7={})),function(t){function e(i,r,s,n,o){ae.ensureCache.prepare();const a=Sx(s),l=s===a,c=ae.ensureFloat64(a);let u=0;n&&(u=ae.ensureFloat64(n));const d=ae._pe_geog_to_geog(ae.getPointer(i),r,c,u,o);return d&&Lv(s,r,c,l),d}t.geogToGeog=e}(i7||(i7={})),function(t){const e=(c,u,d,p,m,g)=>{let y,v;switch(ae.ensureCache.prepare(),c){case"dd":y=ae._pe_geog_to_dd,v=rn.PE_DD_MAX;break;case"ddm":y=ae._pe_geog_to_ddm,v=rn.PE_DDM_MAX;break;case"dms":y=ae._pe_geog_to_dms,v=rn.PE_DMS_MAX}let b=0;u&&(b=ae.getPointer(u));const w=Sx(p),x=ae.ensureFloat64(w),T=lD(d,v),C=y(b,d,x,m,ae.ensureInt32(T));if(C)for(let M=0;M<d;M++)g[M]=ae.UTF8ToString(T[M]);return C},i=(c,u,d,p,m)=>{let g;switch(ae.ensureCache.prepare(),c){case"dd":g=ae._pe_dd_to_geog;break;case"ddm":g=ae._pe_ddm_to_geog;break;case"dms":g=ae._pe_dms_to_geog}let y=0;u&&(y=ae.getPointer(u));const v=p.map(T=>ae.ensureString(T)),b=ae.ensureInt32(v),w=ae.ensureFloat64(new Array(2*d)),x=g(y,d,b,w);return x&&Lv(m,d,w),x};function r(c,u,d,p,m){return e("dms",c,u,d,p,m)}function s(c,u,d,p){return i("dms",c,u,d,p)}function n(c,u,d,p,m){return e("ddm",c,u,d,p,m)}function o(c,u,d,p){return i("ddm",c,u,d,p)}function a(c,u,d,p,m){return e("dd",c,u,d,p,m)}function l(c,u,d,p){return i("dd",c,u,d,p)}t.geogToDms=r,t.dmsToGeog=s,t.geogToDdm=n,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(r7||(r7={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=ae.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=ae.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=ae.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=ae.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=ae.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,n,o,a,l,c,u){ae.ensureCache.prepare();let d=0;s&&(d=ae.getPointer(s));const p=Sx(o),m=ae.ensureFloat64(p),g=lD(n,rn.PE_MGRS_MAX),y=ae.ensureInt32(g),v=ae._pe_geog_to_mgrs_extended(d,n,m,a,l,c,y);if(v)for(let b=0;b<n;b++)u[b]=ae.UTF8ToString(g[b]);return v}function r(s,n,o,a,l){ae.ensureCache.prepare();let c=0;s&&(c=ae.getPointer(s));const u=o.map(g=>ae.ensureString(g)),d=ae.ensureInt32(u),p=ae.ensureFloat64(new Array(2*n)),m=ae._pe_mgrs_to_geog_extended(c,n,d,a,p);return m&&Lv(l,n,p),m}t.init=e,t.geogToMgrsExtended=i,t.mgrsToGeogExtended=r}(CU||(CU={})),function(t){function e(r,s,n,o,a,l,c){ae.ensureCache.prepare();let u=0;r&&(u=ae.getPointer(r));const d=Sx(n),p=ae.ensureFloat64(d),m=lD(s,rn.PE_MGRS_MAX),g=ae.ensureInt32(m),y=ae._pe_geog_to_usng(u,s,p,o,a,l,g);if(y)for(let v=0;v<s;v++)c[v]=ae.UTF8ToString(m[v]);return y}function i(r,s,n,o){ae.ensureCache.prepare();let a=0;r&&(a=ae.getPointer(r));const l=n.map(p=>ae.ensureString(p)),c=ae.ensureInt32(l),u=ae.ensureFloat64(new Array(2*s)),d=ae._pe_usng_to_geog(a,s,c,u);return d&&Lv(o,s,u),d}t.geogToUsng=e,t.usngToGeog=i}(s7||(s7={})),function(t){function e(){t.PE_UTM_OPTS_NONE=ae.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=ae.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=ae.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,n,o,a,l){ae.ensureCache.prepare();let c=0;s&&(c=ae.getPointer(s));const u=Sx(o),d=ae.ensureFloat64(u),p=lD(n,rn.PE_UTM_MAX),m=ae.ensureInt32(p),g=ae._pe_geog_to_utm(c,n,d,a,m);if(g)for(let y=0;y<n;y++)l[y]=ae.UTF8ToString(p[y]);return g}function r(s,n,o,a,l){ae.ensureCache.prepare();let c=0;s&&(c=ae.getPointer(s));const u=o.map(g=>ae.ensureString(g)),d=ae.ensureInt32(u),p=ae.ensureFloat64(new Array(2*n)),m=ae._pe_utm_to_geog(c,n,d,a,p);return m&&Lv(l,n,p),m}t.init=e,t.geogToUtm=i,t.utmToGeog=r}(MU||(MU={})),function(t){const e=new Map;function i(){t.PE_PCSINFO_OPTION_NONE=ae.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=ae.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=ae.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=ae.PePCSInfo.prototype.PE_POLE_POINT}function r(s,n=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(s)&&(a=e.get(s),a[n]&&(o=a[n])),o||(o=ae.PePCSInfo.prototype.generate(s,n),a||(a=[],e.set(s,a)),a[n]=o),o}t.init=i,t.generate=r}(AU||(AU={})),function(t){function e(){return ae.PeVersion.prototype.version_string()}t.versionString=e}(n7||(n7={}));const xGe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return K9},get PeDefs(){return rn},get PeFactory(){return e7},get PeGCSExtent(){return Gbe},get PeGTTransformations(){return i7},get PeGTlistExtended(){return EU},get PeGTlistExtendedEntry(){return t7},get PeNotationDms(){return r7},get PeNotationMgrs(){return CU},get PeNotationUsng(){return s7},get PeNotationUtm(){return MU},get PePCSInfo(){return AU},get PeVersion(){return n7},_init:jbe,get _pe(){return ae},isLoaded:Vbe,isSupported:wGe,load:Bbe},Symbol.toStringTag,{value:"Module"}));var au;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(au||(au={}));let _;const N={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,10477:0,10481:2,10516:2,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1};for(_=2e3;_<=2045;_++)N[_]=0;for(_=2056;_<=2065;_++)N[_]=0;for(_=2067;_<=2135;_++)N[_]=0;for(_=2137;_<=2154;_++)N[_]=0;for(_=2161;_<=2170;_++)N[_]=0;for(_=2172;_<=2193;_++)N[_]=0;for(_=2195;_<=2198;_++)N[_]=0;for(_=2200;_<=2203;_++)N[_]=0;for(_=2205;_<=2217;_++)N[_]=0;for(_=2222;_<=2224;_++)N[_]=1;for(_=2225;_<=2250;_++)N[_]=2;for(_=2251;_<=2253;_++)N[_]=1;for(_=2257;_<=2264;_++)N[_]=2;for(_=2274;_<=2279;_++)N[_]=2;for(_=2280;_<=2282;_++)N[_]=1;for(_=2283;_<=2289;_++)N[_]=2;for(_=2290;_<=2292;_++)N[_]=0;for(_=2308;_<=2313;_++)N[_]=0;for(_=2315;_<=2491;_++)N[_]=0;for(_=2494;_<=2866;_++)N[_]=0;for(_=2867;_<=2869;_++)N[_]=1;for(_=2870;_<=2888;_++)N[_]=2;for(_=2891;_<=2895;_++)N[_]=2;for(_=2896;_<=2898;_++)N[_]=1;for(_=2902;_<=2908;_++)N[_]=2;for(_=2915;_<=2920;_++)N[_]=2;for(_=2921;_<=2923;_++)N[_]=1;for(_=2924;_<=2930;_++)N[_]=2;for(_=2931;_<=2962;_++)N[_]=0;for(_=2964;_<=2968;_++)N[_]=2;for(_=2969;_<=2973;_++)N[_]=0;for(_=2975;_<=2991;_++)N[_]=0;for(_=2995;_<=3051;_++)N[_]=0;for(_=3054;_<=3079;_++)N[_]=0;for(_=3081;_<=3088;_++)N[_]=0;for(_=3092;_<=3101;_++)N[_]=0;for(_=3106;_<=3138;_++)N[_]=0;for(_=3146;_<=3151;_++)N[_]=0;for(_=3153;_<=3166;_++)N[_]=0;for(_=3168;_<=3172;_++)N[_]=0;for(_=3174;_<=3203;_++)N[_]=0;for(_=3294;_<=3358;_++)N[_]=0;for(_=3367;_<=3403;_++)N[_]=0;for(_=3408;_<=3416;_++)N[_]=0;for(_=3417;_<=3438;_++)N[_]=2;for(_=3441;_<=3446;_++)N[_]=2;for(_=3447;_<=3450;_++)N[_]=0;for(_=3451;_<=3459;_++)N[_]=2;for(_=3460;_<=3478;_++)N[_]=0;for(_=3554;_<=3559;_++)N[_]=0;for(_=3560;_<=3570;_++)N[_]=2;for(_=3571;_<=3581;_++)N[_]=0;for(_=3594;_<=3597;_++)N[_]=0;for(_=3601;_<=3604;_++)N[_]=0;for(_=3637;_<=3639;_++)N[_]=0;for(_=3665;_<=3667;_++)N[_]=0;for(_=3693;_<=3695;_++)N[_]=0;for(_=3701;_<=3727;_++)N[_]=0;for(_=3728;_<=3739;_++)N[_]=2;for(_=3740;_<=3751;_++)N[_]=0;for(_=3753;_<=3760;_++)N[_]=2;for(_=3761;_<=3773;_++)N[_]=0;for(_=3775;_<=3777;_++)N[_]=0;for(_=3779;_<=3781;_++)N[_]=0;for(_=3783;_<=3785;_++)N[_]=0;for(_=3788;_<=3791;_++)N[_]=0;for(_=3797;_<=3802;_++)N[_]=0;for(_=3814;_<=3816;_++)N[_]=0;for(_=3825;_<=3829;_++)N[_]=0;for(_=3832;_<=3841;_++)N[_]=0;for(_=3844;_<=3852;_++)N[_]=0;for(_=3873;_<=3885;_++)N[_]=0;for(_=3890;_<=3893;_++)N[_]=0;for(_=3907;_<=3912;_++)N[_]=0;for(_=3942;_<=3950;_++)N[_]=0;for(_=3968;_<=3970;_++)N[_]=0;for(_=3973;_<=3976;_++)N[_]=0;for(_=3986;_<=3989;_++)N[_]=0;for(_=3994;_<=3997;_++)N[_]=0;for(_=4048;_<=4051;_++)N[_]=0;for(_=4056;_<=4063;_++)N[_]=0;for(_=4093;_<=4096;_++)N[_]=0;for(_=4390;_<=4398;_++)N[_]=0;for(_=4399;_<=4413;_++)N[_]=2;for(_=4418;_<=4433;_++)N[_]=2;for(_=4455;_<=4457;_++)N[_]=2;for(_=4484;_<=4489;_++)N[_]=0;for(_=4491;_<=4554;_++)N[_]=0;for(_=4568;_<=4589;_++)N[_]=0;for(_=4652;_<=4656;_++)N[_]=0;for(_=4766;_<=4800;_++)N[_]=0;for(_=5014;_<=5016;_++)N[_]=0;for(_=5069;_<=5072;_++)N[_]=0;for(_=5105;_<=5130;_++)N[_]=0;for(_=5167;_<=5188;_++)N[_]=0;for(_=5253;_<=5259;_++)N[_]=0;for(_=5269;_<=5275;_++)N[_]=0;for(_=5292;_<=5311;_++)N[_]=0;for(_=5329;_<=5331;_++)N[_]=0;for(_=5343;_<=5349;_++)N[_]=0;for(_=5355;_<=5357;_++)N[_]=0;for(_=5387;_<=5389;_++)N[_]=0;for(_=5459;_<=5463;_++)N[_]=0;for(_=5479;_<=5482;_++)N[_]=0;for(_=5518;_<=5520;_++)N[_]=0;for(_=5530;_<=5539;_++)N[_]=0;for(_=5550;_<=5552;_++)N[_]=0;for(_=5562;_<=5583;_++)N[_]=0;for(_=5623;_<=5625;_++)N[_]=2;for(_=5631;_<=5639;_++)N[_]=0;for(_=5649;_<=5653;_++)N[_]=0;for(_=5663;_<=5680;_++)N[_]=0;for(_=5682;_<=5685;_++)N[_]=0;for(_=5875;_<=5877;_++)N[_]=0;for(_=5896;_<=5899;_++)N[_]=0;for(_=5921;_<=5940;_++)N[_]=0;for(_=6050;_<=6125;_++)N[_]=0;for(_=6244;_<=6275;_++)N[_]=0;for(_=6328;_<=6348;_++)N[_]=0;for(_=6350;_<=6356;_++)N[_]=0;for(_=6366;_<=6372;_++)N[_]=0;for(_=6381;_<=6387;_++)N[_]=0;for(_=6393;_<=6404;_++)N[_]=0;for(_=6480;_<=6483;_++)N[_]=0;for(_=6511;_<=6514;_++)N[_]=0;for(_=6579;_<=6581;_++)N[_]=0;for(_=6619;_<=6624;_++)N[_]=0;for(_=6625;_<=6627;_++)N[_]=2;for(_=6628;_<=6632;_++)N[_]=0;for(_=6634;_<=6637;_++)N[_]=0;for(_=6669;_<=6692;_++)N[_]=0;for(_=6707;_<=6709;_++)N[_]=0;for(_=6720;_<=6723;_++)N[_]=0;for(_=6732;_<=6738;_++)N[_]=0;for(_=6931;_<=6933;_++)N[_]=0;for(_=6956;_<=6959;_++)N[_]=0;for(_=7005;_<=7007;_++)N[_]=0;for(_=7057;_<=7070;_++)N[_]=2;for(_=7074;_<=7082;_++)N[_]=0;for(_=7109;_<=7118;_++)N[_]=0;for(_=7119;_<=7127;_++)N[_]=1;for(_=7374;_<=7376;_++)N[_]=0;for(_=7528;_<=7586;_++)N[_]=0;for(_=7587;_<=7645;_++)N[_]=2;for(_=7692;_<=7696;_++)N[_]=0;for(_=7755;_<=7787;_++)N[_]=0;for(_=7791;_<=7795;_++)N[_]=0;for(_=7799;_<=7801;_++)N[_]=0;for(_=7803;_<=7805;_++)N[_]=0;for(_=7825;_<=7831;_++)N[_]=0;for(_=7845;_<=7859;_++)N[_]=0;for(_=8013;_<=8032;_++)N[_]=0;for(_=8065;_<=8068;_++)N[_]=1;for(_=8518;_<=8529;_++)N[_]=2;for(_=8533;_<=8536;_++)N[_]=2;for(_=8538;_<=8540;_++)N[_]=2;for(_=8677;_<=8679;_++)N[_]=0;for(_=8836;_<=8840;_++)N[_]=0;for(_=8857;_<=8859;_++)N[_]=0;for(_=8908;_<=8910;_++)N[_]=0;for(_=9154;_<=9159;_++)N[_]=0;for(_=9205;_<=9218;_++)N[_]=0;for(_=9271;_<=9273;_++)N[_]=0;for(_=9295;_<=9297;_++)N[_]=0;for(_=9356;_<=9360;_++)N[_]=0;for(_=9404;_<=9407;_++)N[_]=0;for(_=9476;_<=9482;_++)N[_]=0;for(_=9487;_<=9494;_++)N[_]=0;for(_=9697;_<=9699;_++)N[_]=0;for(_=9821;_<=9865;_++)N[_]=0;for(_=10285;_<=10291;_++)N[_]=0;for(_=10314;_<=10317;_++)N[_]=0;for(_=10448;_<=10465;_++)N[_]=0;for(_=10731;_<=10733;_++)N[_]=0;for(_=11114;_<=11118;_++)N[_]=0;for(_=20004;_<=20032;_++)N[_]=0;for(_=20047;_<=20049;_++)N[_]=0;for(_=20062;_<=20092;_++)N[_]=0;for(_=20135;_<=20138;_++)N[_]=0;for(_=20248;_<=20258;_++)N[_]=0;for(_=20348;_<=20358;_++)N[_]=0;for(_=20436;_<=20440;_++)N[_]=0;for(_=20822;_<=20824;_++)N[_]=0;for(_=20904;_<=20932;_++)N[_]=0;for(_=20934;_<=20936;_++)N[_]=0;for(_=21004;_<=21032;_++)N[_]=0;for(_=21035;_<=21037;_++)N[_]=0;for(_=21095;_<=21097;_++)N[_]=0;for(_=21148;_<=21150;_++)N[_]=0;for(_=21207;_<=21264;_++)N[_]=0;for(_=21307;_<=21364;_++)N[_]=0;for(_=21413;_<=21423;_++)N[_]=0;for(_=21453;_<=21463;_++)N[_]=0;for(_=21473;_<=21483;_++)N[_]=0;for(_=21780;_<=21782;_++)N[_]=0;for(_=21891;_<=21894;_++)N[_]=0;for(_=21896;_<=21899;_++)N[_]=0;for(_=22171;_<=22177;_++)N[_]=0;for(_=22181;_<=22187;_++)N[_]=0;for(_=22191;_<=22197;_++)N[_]=0;for(_=22207;_<=22222;_++)N[_]=0;for(_=22229;_<=22232;_++)N[_]=0;for(_=22234;_<=22236;_++)N[_]=0;for(_=22243;_<=22250;_++)N[_]=0;for(_=22262;_<=22265;_++)N[_]=0;for(_=22307;_<=22322;_++)N[_]=0;for(_=22348;_<=22357;_++)N[_]=0;for(_=22407;_<=22422;_++)N[_]=0;for(_=22462;_<=22465;_++)N[_]=0;for(_=22521;_<=22525;_++)N[_]=0;for(_=22607;_<=22622;_++)N[_]=0;for(_=22641;_<=22646;_++)N[_]=0;for(_=22648;_<=22657;_++)N[_]=0;for(_=22707;_<=22722;_++)N[_]=0;for(_=22762;_<=22765;_++)N[_]=0;for(_=22807;_<=22822;_++)N[_]=0;for(_=22991;_<=22994;_++)N[_]=0;for(_=23028;_<=23038;_++)N[_]=0;for(_=23301;_<=23333;_++)N[_]=2;for(_=23830;_<=23853;_++)N[_]=0;for(_=23866;_<=23872;_++)N[_]=0;for(_=23877;_<=23884;_++)N[_]=0;for(_=23886;_<=23894;_++)N[_]=0;for(_=23946;_<=23948;_++)N[_]=0;for(_=24311;_<=24313;_++)N[_]=0;for(_=24342;_<=24347;_++)N[_]=0;for(_=24370;_<=24374;_++)N[_]=10;for(_=24375;_<=24381;_++)N[_]=0;for(_=24718;_<=24721;_++)N[_]=0;for(_=24817;_<=24821;_++)N[_]=0;for(_=24877;_<=24882;_++)N[_]=0;for(_=24891;_<=24893;_++)N[_]=0;for(_=25391;_<=25395;_++)N[_]=0;for(_=25828;_<=25838;_++)N[_]=0;for(_=26191;_<=26195;_++)N[_]=0;for(_=26391;_<=26393;_++)N[_]=0;for(_=26701;_<=26722;_++)N[_]=0;for(_=26729;_<=26799;_++)N[_]=2;for(_=26801;_<=26803;_++)N[_]=2;for(_=26811;_<=26813;_++)N[_]=2;for(_=26847;_<=26870;_++)N[_]=2;for(_=26891;_<=26899;_++)N[_]=0;for(_=26901;_<=26923;_++)N[_]=0;for(_=26929;_<=26946;_++)N[_]=0;for(_=26948;_<=26998;_++)N[_]=0;for(_=27037;_<=27040;_++)N[_]=0;for(_=27205;_<=27232;_++)N[_]=0;for(_=27258;_<=27260;_++)N[_]=0;for(_=27391;_<=27398;_++)N[_]=0;for(_=27561;_<=27564;_++)N[_]=0;for(_=27571;_<=27574;_++)N[_]=0;for(_=27581;_<=27584;_++)N[_]=0;for(_=27591;_<=27594;_++)N[_]=0;for(_=27700;_<=27707;_++)N[_]=0;for(_=28191;_<=28193;_++)N[_]=0;for(_=28348;_<=28358;_++)N[_]=0;for(_=28402;_<=28432;_++)N[_]=0;for(_=28462;_<=28492;_++)N[_]=0;for(_=29118;_<=29122;_++)N[_]=0;for(_=29168;_<=29172;_++)N[_]=0;for(_=29177;_<=29185;_++)N[_]=0;for(_=29187;_<=29195;_++)N[_]=0;for(_=29900;_<=29903;_++)N[_]=0;for(_=30161;_<=30179;_++)N[_]=0;for(_=30491;_<=30494;_++)N[_]=0;for(_=30729;_<=30732;_++)N[_]=0;for(_=31251;_<=31259;_++)N[_]=0;for(_=31265;_<=31268;_++)N[_]=0;for(_=31275;_<=31279;_++)N[_]=0;for(_=31281;_<=31297;_++)N[_]=0;for(_=31461;_<=31469;_++)N[_]=0;for(_=31491;_<=31495;_++)N[_]=0;for(_=31917;_<=31922;_++)N[_]=0;for(_=31965;_<=32e3;_++)N[_]=0;for(_=32001;_<=32003;_++)N[_]=2;for(_=32005;_<=32031;_++)N[_]=2;for(_=32033;_<=32060;_++)N[_]=2;for(_=32064;_<=32067;_++)N[_]=2;for(_=32074;_<=32077;_++)N[_]=2;for(_=32081;_<=32086;_++)N[_]=0;for(_=32107;_<=32130;_++)N[_]=0;for(_=32133;_<=32159;_++)N[_]=0;for(_=32164;_<=32167;_++)N[_]=2;for(_=32180;_<=32199;_++)N[_]=0;for(_=32201;_<=32260;_++)N[_]=0;for(_=32301;_<=32360;_++)N[_]=0;for(_=32401;_<=32460;_++)N[_]=0;for(_=32501;_<=32560;_++)N[_]=0;for(_=32601;_<=32662;_++)N[_]=0;for(_=32664;_<=32667;_++)N[_]=2;for(_=32701;_<=32761;_++)N[_]=0;for(_=53001;_<=53004;_++)N[_]=0;for(_=53008;_<=53019;_++)N[_]=0;for(_=53021;_<=53032;_++)N[_]=0;for(_=53034;_<=53037;_++)N[_]=0;for(_=53042;_<=53046;_++)N[_]=0;for(_=53074;_<=53080;_++)N[_]=0;for(_=54001;_<=54004;_++)N[_]=0;for(_=54008;_<=54019;_++)N[_]=0;for(_=54021;_<=54032;_++)N[_]=0;for(_=54034;_<=54037;_++)N[_]=0;for(_=54042;_<=54046;_++)N[_]=0;for(_=54048;_<=54053;_++)N[_]=0;for(_=54074;_<=54080;_++)N[_]=0;for(_=54098;_<=54101;_++)N[_]=0;for(_=102001;_<=102040;_++)N[_]=0;for(_=102042;_<=102063;_++)N[_]=0;for(_=102065;_<=102067;_++)N[_]=0;for(_=102070;_<=102117;_++)N[_]=0;for(_=102122;_<=102216;_++)N[_]=0;for(_=102221;_<=102377;_++)N[_]=0;for(_=102382;_<=102388;_++)N[_]=0;for(_=102389;_<=102398;_++)N[_]=2;for(_=102399;_<=102444;_++)N[_]=0;for(_=102445;_<=102447;_++)N[_]=2;for(_=102448;_<=102458;_++)N[_]=0;for(_=102459;_<=102468;_++)N[_]=2;for(_=102469;_<=102499;_++)N[_]=0;for(_=102500;_<=102519;_++)N[_]=1;for(_=102520;_<=102524;_++)N[_]=0;for(_=102525;_<=102529;_++)N[_]=2;for(_=102530;_<=102588;_++)N[_]=0;for(_=102590;_<=102598;_++)N[_]=0;for(_=102601;_<=102603;_++)N[_]=0;for(_=102605;_<=102628;_++)N[_]=0;for(_=102629;_<=102646;_++)N[_]=2;for(_=102648;_<=102700;_++)N[_]=2;for(_=102701;_<=102703;_++)N[_]=0;for(_=102707;_<=102730;_++)N[_]=2;for(_=102733;_<=102758;_++)N[_]=2;for(_=102767;_<=102900;_++)N[_]=0;for(_=102901;_<=102933;_++)N[_]=2;for(_=102934;_<=102950;_++)N[_]=13;for(_=102951;_<=102963;_++)N[_]=0;for(_=102965;_<=102969;_++)N[_]=0;for(_=102971;_<=102973;_++)N[_]=0;for(_=102975;_<=102989;_++)N[_]=0;for(_=102990;_<=102992;_++)N[_]=1;for(_=102997;_<=103002;_++)N[_]=0;for(_=103003;_<=103008;_++)N[_]=2;for(_=103009;_<=103011;_++)N[_]=0;for(_=103012;_<=103014;_++)N[_]=2;for(_=103019;_<=103021;_++)N[_]=0;for(_=103022;_<=103024;_++)N[_]=2;for(_=103029;_<=103031;_++)N[_]=0;for(_=103032;_<=103034;_++)N[_]=2;for(_=103065;_<=103068;_++)N[_]=0;for(_=103074;_<=103076;_++)N[_]=0;for(_=103077;_<=103079;_++)N[_]=1;for(_=103080;_<=103082;_++)N[_]=0;for(_=103083;_<=103085;_++)N[_]=2;for(_=103090;_<=103093;_++)N[_]=0;for(_=103097;_<=103099;_++)N[_]=0;for(_=103100;_<=103102;_++)N[_]=2;for(_=103107;_<=103109;_++)N[_]=0;for(_=103110;_<=103112;_++)N[_]=2;for(_=103113;_<=103116;_++)N[_]=0;for(_=103117;_<=103120;_++)N[_]=2;for(_=103153;_<=103157;_++)N[_]=0;for(_=103158;_<=103162;_++)N[_]=2;for(_=103163;_<=103165;_++)N[_]=0;for(_=103166;_<=103168;_++)N[_]=1;for(_=103169;_<=103171;_++)N[_]=2;for(_=103186;_<=103188;_++)N[_]=0;for(_=103189;_<=103191;_++)N[_]=2;for(_=103192;_<=103195;_++)N[_]=0;for(_=103196;_<=103199;_++)N[_]=2;for(_=103200;_<=103224;_++)N[_]=0;for(_=103225;_<=103227;_++)N[_]=1;for(_=103232;_<=103237;_++)N[_]=0;for(_=103238;_<=103243;_++)N[_]=2;for(_=103244;_<=103246;_++)N[_]=0;for(_=103247;_<=103249;_++)N[_]=2;for(_=103254;_<=103256;_++)N[_]=0;for(_=103257;_<=103259;_++)N[_]=2;for(_=103264;_<=103266;_++)N[_]=0;for(_=103267;_<=103269;_++)N[_]=2;for(_=103300;_<=103375;_++)N[_]=0;for(_=103381;_<=103383;_++)N[_]=0;for(_=103384;_<=103386;_++)N[_]=1;for(_=103387;_<=103389;_++)N[_]=0;for(_=103390;_<=103392;_++)N[_]=2;for(_=103397;_<=103399;_++)N[_]=0;for(_=103400;_<=103471;_++)N[_]=2;for(_=103476;_<=103478;_++)N[_]=0;for(_=103479;_<=103481;_++)N[_]=2;for(_=103486;_<=103488;_++)N[_]=0;for(_=103489;_<=103491;_++)N[_]=2;for(_=103492;_<=103495;_++)N[_]=0;for(_=103496;_<=103499;_++)N[_]=2;for(_=103528;_<=103543;_++)N[_]=0;for(_=103544;_<=103548;_++)N[_]=2;for(_=103549;_<=103551;_++)N[_]=0;for(_=103552;_<=103554;_++)N[_]=1;for(_=103555;_<=103557;_++)N[_]=2;for(_=103558;_<=103560;_++)N[_]=0;for(_=103571;_<=103573;_++)N[_]=0;for(_=103574;_<=103576;_++)N[_]=2;for(_=103577;_<=103580;_++)N[_]=0;for(_=103581;_<=103583;_++)N[_]=2;for(_=103595;_<=103694;_++)N[_]=0;for(_=103696;_<=103699;_++)N[_]=0;for(_=103700;_<=103793;_++)N[_]=2;for(_=103794;_<=103890;_++)N[_]=0;for(_=103891;_<=103896;_++)N[_]=2;for(_=103900;_<=103971;_++)N[_]=2;for(_=103972;_<=103977;_++)N[_]=0;for(_=112e3;_<=112101;_++)N[_]=0;const Hbe=[102100,102113,3857,3785],SGe=[104905,104971],TGe=[4326,...Hbe,...SGe],lae='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',cD=[-20037508342788905e-9,20037508342788905e-9],uD=[-20037508342787e-6,20037508342787e-6],qbe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:cD,origin:uD,dx:1e-5},102100:{wkTemplate:lae,valid:cD,origin:uD,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:cD,origin:uD,dx:1e-5},3857:{wkTemplate:lae,valid:cD,origin:uD,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function gs(t,e){if(t===e)return!0;if(t==null||e==null)return!1;const i=t.wkid,r=e.wkid;if(i!=null||r!=null){if(i===r||Ef(t)&&Ef(e))return!0;const o=t.latestWkid;if(o!=null&&r===o)return!0;const a=e.latestWkid;return a!=null&&i===a}let s,n;return t.wkt2&&e.wkt2?(s=t.wkt2,n=e.wkt2):t.wkt&&e.wkt&&(s=t.wkt,n=e.wkt),!(!s||!n)&&s.toUpperCase()===n.toUpperCase()}function c0(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&qbe[e]||null}function cae(t){if(!t)return;const{wkid:e,vcsWkid:i}=t;if(e)return i?JSON.stringify({wkid:e,vcsWkid:i}):String(e);const r=t.wkt||t.wkt2;return JSON.stringify(r?i?{wkt:r,vcsWkid:i}:{wkt:r}:{})}function H3(t){if(!sf(t))return!1;const{wkid:e}=t;if(e)return N[e]==null;const i=t.wkt2||t.wkt;return!!i&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(i)}function CM(t){return!(dT(t)||pT(t))}function S0(t){return(t==null?void 0:t.wkid)===4326}function Kzt(t){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(t)}function MM(t){return(t==null?void 0:t.wkid)===au.CGCS2000}function Ef(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&Hbe.includes(e)}function NS(t){return(t==null?void 0:t.wkid)===32662}function AM(t){return t===au.GCSMARS2000||t===au.GCSMARS2000_SPHERE}function dT(t){return AM(t==null?void 0:t.wkid)}function PM(t){return t===au.GCSMOON2000}function pT(t){return PM(t==null?void 0:t.wkid)}function EGe(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&TGe.includes(e)}function sf(t){if(t==null)return!1;const e=t.wkid;return e!=null&&e>=2e3||t.wkt2!=null||t.wkt!=null}const PU={wkid:4326,wkt:VK(qbe[4326].wkTemplate,{Central_Meridian:"0.0"})},OU={wkid:102100,latestWkid:3857},CGe={wkid:32662};function fee(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const Wbe=fee(ir),cB=fee(gf),uB=fee(x0),Ybe={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${ir.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`},MGe=cB.wkt.toUpperCase(),AGe=uB.wkt.toUpperCase();function ur(t){if(t!=null&&sf(t)){const e=t.wkid,i=t.wkt2??t.wkt;if(AM(e))return gf;const r=i==null?void 0:i.toUpperCase();if(i&&r===MGe)return gf;if(PM(e)||r&&r===AGe)return x0}return ir}function eVt(t){return AM(t)?gf:PM(t)?x0:ir}function kI(t){return gs(t,Wbe)}function E1(t){return kI(t)||gs(t,cB)||gs(t,uB)}const mee=39.37,PGe=ir.radius*Math.PI/200,Zbe=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,aS=N,Xbe=/UNIT\[([^\]]+)]/i,OGe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),RGe=Bl()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Vf=t=>t*t,s_=t=>t*t*t,UI={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Vf(.001)},"square-centimeters":{inBaseUnits:Vf(.01)},"square-decimeters":{inBaseUnits:Vf(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Vf(1e3)},"square-inches":{inBaseUnits:Vf(.0254)},"square-feet":{inBaseUnits:Vf(.3048)},"square-yards":{inBaseUnits:Vf(.9144)},"square-miles":{inBaseUnits:Vf(1609.344)},"square-us-feet":{inBaseUnits:Vf(1200/3937)},acres:{inBaseUnits:.0015625*Vf(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*s_(.001)},"cubic-centimeters":{inBaseUnits:1e3*s_(.01)},"cubic-decimeters":{inBaseUnits:1e3*s_(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*s_(1e3)},"cubic-inches":{inBaseUnits:1e3*s_(.0254)},"cubic-feet":{inBaseUnits:1e3*s_(.3048)},"cubic-yards":{inBaseUnits:1e3*s_(.9144)},"cubic-miles":{inBaseUnits:1e3*s_(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},$Ge=(()=>{const t={};for(const e in UI)for(const i in UI[e].units)t[i]=e;return t})();function IGe(t,e,i){return t*UI[i].units[e].inBaseUnits}function LGe(t,e,i){return t/UI[i].units[e].inBaseUnits}const Jbe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],DGe=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function FS(t){const e=$Ge[t];if(!e)throw new Error("unknown type");return e}function uae(t,e=null){return e=e||FS(t),UI[e].baseUnit===t}function ro(t,e,i){if(e===i)return t;const r=FS(e);if(r!==FS(i))throw new Error("incompatible units");const s=uae(e,r)?t:IGe(t,e,r);return uae(i,r)?s:LGe(s,i,r)}function NGe(t){switch(t){case"metric":return"meters";case"imperial":return"feet";default:return t}}function tVt(t){return NGe(t)}function iVt(t){switch(t){case"metric":return"square-meters";case"imperial":return"square-feet";default:return t}}function rVt(t,e,i){switch(i){case"metric":return FGe(t,e);case"imperial":return UGe(t,e);default:return i}}function sVt(t,e,i){switch(i){case"metric":return kGe(t,e);case"imperial":return zGe(t,e);default:return i}}function FGe(t,e){const i=ro(t,e,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function kGe(t,e){const i=ro(t,e,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function UGe(t,e){const i=ro(t,e,"feet");return Math.abs(i)<1e3?"feet":"miles"}function zGe(t,e){const i=ro(t,e,"feet");return Math.abs(i)<1e5?"feet":"miles"}function nVt(t,e){const i=ro(t,e,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function oVt(t,e){const i=ro(t,e,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function VGe(t,e,i){return ro(t,e,"meters")/(i*Math.PI/180)}function Qbe(t){return RGe.fromJSON(t.toLowerCase())||null}function kS(t){if(t!=null&&!CM(t))return 1;const e=Gl(t);return e>1e5?1:e}function Kbe(t){return Gl(t)>=ur(t).metersPerDegree?"meters":q3(t)}function Gl(t,e=ir.metersPerDegree){return BGe(t,!0)??e}function BGe(t,e=!1){const i=(t==null?void 0:t.wkid)??null,r=(t==null?void 0:t.wkt2)??(t==null?void 0:t.wkt)??null;let s=null;if(i){if(AM(i))return gf.metersPerDegree;if(PM(i))return x0.metersPerDegree;s=aS.values[aS[i]],!s&&e&&OGe.has(i)&&(s=PGe)}else r&&(swe(r)?s=dae(Zbe.exec(r),s):rwe(r)&&(s=dae(Xbe.exec(r),s)));return s}function hae(t){return H3(t)?1:Gl(t)}function dae(t,e){return t!=null&&t[1]?ewe(t[1]):e}function ewe(t){return parseFloat(t.split(",")[1])}function q3(t){const e=(t==null?void 0:t.wkid)??null,i=(t==null?void 0:t.wkt2)??(t==null?void 0:t.wkt)??null;let r=null;if(e)r=aS.units[aS[e]];else if(i){const s=swe(i)?Zbe:rwe(i)?Xbe:null;if(s){const n=s.exec(i);n!=null&&n[1]&&(r=jGe(n[1]))}}return r!=null?Qbe(r):null}function twe(t){const e=q3(t);return e!=null&&Jbe.includes(e)?e:null}function iwe(t){const e=Kbe(t);return e!=null&&Jbe.includes(e)?e:null}function aVt(t){const e=q3(t);return e==null?null:DGe.get(e)}function rwe(t){return/^GEOCCS/i.test(t)}function swe(t){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(t)}const GGe=1e-7;function jGe(t){const e=/[\\"']{1}([^\\"']+)/.exec(t);let i=e==null?void 0:e[1];if(!i||!aS.units.includes(i)){const r=ewe(t);i=null;const s=aS.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<GGe){i=aS.units[n];break}}return i}function lVt(t){const e=q3(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const HGe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},qGe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},WGe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},YGe=Bl()(HGe),ZGe=Bl()(qGe),cVt=Bl()(WGe);var hm;let Mr=hm=class extends ye{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return hm.WebMercator;if(t.wkid===4326)return hm.WGS84}const e=new hm;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return S0(this)}get isWebMercator(){return Ef(this)}get isGeographic(){return H3(this)}get isWrappable(){return EGe(this)}get metersPerUnit(){return Gl(this)}get unit(){return q3(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===hm.WGS84)return new hm(PU);if(this===hm.WebMercator)return new hm(OU);const t=new hm;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):(this.wkt!=null&&(t.wkt=this.wkt),this.wkt2!=null&&(t.wkt2=this.wkt2)),this.imageCoordinateSystem&&(t.imageCoordinateSystem=Q(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:i}=t.imageCoordinateSystem,{geodataXform:r}=t.imageCoordinateSystem,s=this.imageCoordinateSystem;return e==null||r?JSON.stringify(s)===JSON.stringify(t.imageCoordinateSystem):i?s.id===e&&s.referenceServiceName===i:s.id===e}return gs(this,t)}toJSON(t){return this.write(void 0,t)}};Mr.GCS_NAD_1927=null,Mr.WGS84=null,Mr.WebMercator=null,Mr.PlateCarree=null,h([f({readOnly:!0})],Mr.prototype,"isWGS84",null),h([f({readOnly:!0})],Mr.prototype,"isWebMercator",null),h([f({readOnly:!0})],Mr.prototype,"isGeographic",null),h([f({readOnly:!0})],Mr.prototype,"isWrappable",null),h([f({type:Qr,json:{write:!0}})],Mr.prototype,"latestWkid",void 0),h([f({readOnly:!0})],Mr.prototype,"metersPerUnit",null),h([f({readOnly:!0})],Mr.prototype,"unit",null),h([f({type:Qr,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],Mr.prototype,"wkid",void 0),h([f({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],Mr.prototype,"wkt",void 0),h([Ve("wkt"),Ve("web-scene","wkt")],Mr.prototype,"writeWkt",null),h([f({type:String,json:{write:!1}})],Mr.prototype,"wkt2",void 0),h([f({type:Qr,json:{write:!0}})],Mr.prototype,"vcsWkid",void 0),h([f({type:Qr,json:{write:!0}})],Mr.prototype,"latestVcsWkid",void 0),h([f()],Mr.prototype,"imageCoordinateSystem",void 0),Mr=hm=h([I("esri.geometry.SpatialReference")],Mr),Mr.prototype.toJSON.isDefaultToJSON=!0,Mr.GCS_NAD_1927=new Mr({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Mr.WGS84=new Mr(PU),Mr.WebMercator=new Mr(OU),Mr.PlateCarree=new Mr(CGe),Object.freeze&&(Object.freeze(Mr.GCS_NAD_1927),Object.freeze(Mr.WGS84),Object.freeze(Mr.WebMercator),Object.freeze(Mr.PlateCarree));const We=Mr;let dm=class extends ye{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=We.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,i){if(e instanceof We)return e;if(e!=null){const r=new We;return r.read(e,i),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,i){this.cache[e]=i}};h([f()],dm.prototype,"type",void 0),h([f({readOnly:!0})],dm.prototype,"cache",null),h([f({readOnly:!0})],dm.prototype,"extent",null),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],dm.prototype,"hasM",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],dm.prototype,"hasZ",void 0),h([f({type:We,json:{write:!0},value:We.WGS84})],dm.prototype,"spatialReference",void 0),h([Ce("spatialReference")],dm.prototype,"readSpatialReference",null),dm=h([I("esri.geometry.Geometry")],dm);const eb=dm,XGe=57.29577951308232,JGe=.017453292519943;function pae(t){return t*XGe}function fae(t){return t*JGe}function mae(t){return t/ir.radius}function RU(t){return Math.PI/2-2*Math.atan(Math.exp(-t/ir.radius))}function o7(t){return t.wkid!=null||t.wkt!=null}const Yj=[0,0];function $U(t,e,i,r,s){const n=t,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=e(n.x,n.y,Yj,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=e(n.xmin,n.ymin,Yj,r),[o.xmax,o.ymax]=e(n.xmax,n.ymax,Yj,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let u=0;u<a.length;u++){const d=a[u];c=[],l.push(c);for(let p=0;p<d.length;p++)c.push(e(d[p][0],d[p][1],[0,0],r)),d[p].length>2&&c[p].push(d[p][2]),d[p].length>3&&c[p].push(d[p][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function P4(t,e){const i=t&&(o7(t)?t:t.spatialReference),r=e&&(o7(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!i||!r)&&(!!gs(r,i)||Ef(r)&&S0(i)||Ef(i)&&S0(r))}function W3(t,e){if(t==null)return null;const i=t.spatialReference,r=e&&(o7(e)?e:e.spatialReference);return P4(i,r)?gs(i,r)?Q(t):Ef(r)?$U(t,QE,We.WebMercator,!1,Q(t)):S0(r)?$U(t,hB,We.WGS84,!1,Q(t)):null:null}function QE(t,e,i=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const r=fae(e);return i[0]=fae(t)*ir.radius,i[1]=ir.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function hB(t,e,i=[0,0],r=!1){const s=pae(t/ir.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=pae(Math.PI/2-2*Math.atan(Math.exp(-e/ir.radius))),i}function lS(t,e=!1,i=Q(t)){return $U(t,QE,We.WebMercator,e,i)}function wO(t,e=!1,i=Q(t)){return $U(t,hB,We.WGS84,e,i)}function QGe(t,e){const i=t.x-e.x,r=t.y-e.y,s=t.z!=null&&e.z!=null?t.z-e.z:0;return Math.sqrt(i*i+r*r+s*s)}function KGe(t){var e;return((e=nwe(t,owe))==null?void 0:e[0])??null}function eje(t){var e;return((e=nwe(t,owe))==null?void 0:e[1])??null}function nwe({x:t,y:e,spatialReference:i},r=[0,0]){if(i){if(Ef(i))return hB(t,e,r);if(H3(i))return r[0]=t,r[1]=e,r}return null}const owe=[0,0];var O4;const Zj=[0,0];function gae(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let rc=O4=class extends eb{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const i=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(i)?i:i.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,i,r,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],i=n[2],r=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new We(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)ie.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)ie.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&(s!=null&&s.isWebMercator)){const a=QE(n.longitude,n.latitude,Zj);t=a[0],e=a[1]}}}else gae(i)?(s=i,i=null):gae(r)&&(s=r,r=null);const o={x:t,y:e};return o.x==null&&o.y!=null?ie.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&ie.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){return eje(this)}set latitude(t){const{spatialReference:e,x:i}=this;t!=null&&e&&(e.isWebMercator?this._set("y",QE(i,t,Zj)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){return KGe(this)}set longitude(t){const{y:e,spatialReference:i}=this;t!=null&&i&&(i.isWebMercator?this._set("x",QE(t,e,Zj)[0]):i.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,i){e[i]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new O4;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return O4.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:i,z:r,m:s,spatialReference:n}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:u}=t;if(!n.equals(u))if(n.isWebMercator&&u.isWGS84)[l,c]=QE(l,c),u=n;else{if(!n.isWGS84||!u.isWebMercator)return!1;[l,c]=hB(l,c),u=n}return e===l&&i===c&&r===o&&s===a&&n.wkid===u.wkid}offset(t,e,i){return this.x+=t,this.y+=e,i!=null&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const t=c0(this.spatialReference);if(!t)return this;let e=this.x;const[i,r]=t.valid,s=2*r;let n;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s),this._set("x",e),this}distance(t){return QGe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};h([f({readOnly:!0})],rc.prototype,"cache",null),h([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],rc.prototype,"hasM",null),h([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],rc.prototype,"hasZ",null),h([f({type:Number})],rc.prototype,"latitude",null),h([f({type:Number})],rc.prototype,"longitude",null),h([f({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Li(t=>isNaN(t)?t:bd(t))],rc.prototype,"x",void 0),h([Ve("x")],rc.prototype,"writeX",null),h([Ce("x")],rc.prototype,"readX",null),h([f({type:Number,json:{write:!0}})],rc.prototype,"y",void 0),h([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],rc.prototype,"z",void 0),h([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],rc.prototype,"m",void 0),rc=O4=h([I("esri.geometry.Point")],rc),rc.prototype.toJSON.isDefaultToJSON=!0;const _t=rc;let pm=class extends Kr(ye){constructor(...e){super(...e),this.position=new _t([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new abe}normalizeCtorArgs(e,i,r,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return i!=null&&(n.heading=i),r!=null&&(n.tilt=r),s!=null&&(n.fov=s),n}return e}writePosition(e,i,r,s){const n=e.clone();n.x=bd(e.x||0),n.y=bd(e.y||0),n.z=e.hasZ?bd(e.z||0):e.z,i[r]=n.write({},s)}readPosition(e,i){const r=new _t;return r.read(e,i),r.x=bd(r.x||0),r.y=bd(r.y||0),r.z=r.hasZ?bd(r.z||0):r.z,r}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};h([f({type:_t,json:{write:{isRequired:!0}}})],pm.prototype,"position",void 0),h([Ve("position")],pm.prototype,"writePosition",null),h([Ce("position")],pm.prototype,"readPosition",null),h([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Li(t=>tee.normalize(bd(t)))],pm.prototype,"heading",void 0),h([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Li(t=>Te(bd(t),-180,180))],pm.prototype,"tilt",void 0),h([f({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],pm.prototype,"fov",void 0),h([f({type:abe,nonNullable:!0,json:{read:!1,write:!1}})],pm.prototype,"layout",void 0),pm=h([I("esri.Camera")],pm);const Eh=pm,Xj=[0,0];function gee(t,e){return e!=null&&Cl(t,e.x,e.y,e.z)}function dVt(t,e){if(!e.points||e.points.length)return!1;for(const i of e.points)if(!OM(t,i))return!1;return!0}function tje(t,e){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?Cl(t,i,r,s)&&Cl(t,i,o,s)&&Cl(t,n,o,s)&&Cl(t,n,r,s)&&Cl(t,i,r,a)&&Cl(t,i,o,a)&&Cl(t,n,o,a)&&Cl(t,n,r,a):Cl(t,i,r)&&Cl(t,i,o)&&Cl(t,n,o)&&Cl(t,n,r)}function OM(t,e){return Cl(t,e[0],e[1])}function ije(t,e){return Cl(t,e[0],e[1],e[2])}function Cl(t,e,i,r){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax&&(r==null||!t.hasZ||r>=t.zmin&&r<=t.zmax)}function rje(t,e){return Xj[1]=e.y,Xj[0]=e.x,sje(t,Xj)}function sje(t,e){return awe(t.rings,e)}function awe(t,e){if(!t)return!1;if(nje(t))return yae(!1,t,e);let i=!1;for(let r=0,s=t.length;r<s;r++)i=yae(i,t[r],e);return i}function nje(t){return!Array.isArray(t[0][0])}function yae(t,e,i){const[r,s]=i;let n=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,u]=e[a],[d,p]=e[o];(u<s&&p>=s||p<s&&u>=s)&&c+(s-u)/(p-u)*(d-c)<r&&(n=!n)}return n}function oje(t,e){return gee(t,e)}function aje(t,e){const i=t.hasZ&&e.hasZ;let r,s,n;if(t.xmin<=e.xmin){if(r=e.xmin,t.xmax<r)return!1}else if(r=t.xmin,e.xmax<r)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(i&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function lje(t,e){const{points:i,hasZ:r}=e,s=r?ije:OM;for(const n of i)if(s(t,n))return!0;return!1}const US=[0,0],zS=[0,0],VS=[0,0],BS=[0,0],cje=[US,zS,VS,BS],lwe=[[VS,US],[US,zS],[zS,BS],[BS,VS]];function uje(t,e){return hje(t,e.rings)}function hje(t,e){US[0]=t.xmin,US[1]=t.ymax,zS[0]=t.xmax,zS[1]=t.ymax,VS[0]=t.xmin,VS[1]=t.ymin,BS[0]=t.xmax,BS[1]=t.ymin;for(const i of cje)if(awe(e,i))return!0;for(const i of e){if(!i.length)continue;let r=i[0];if(OM(t,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(OM(t,n)||cwe(r,n,lwe))return!0;r=n}}return!1}function dje(t,e){US[0]=t.xmin,US[1]=t.ymax,zS[0]=t.xmax,zS[1]=t.ymax,VS[0]=t.xmin,VS[1]=t.ymin,BS[0]=t.xmax,BS[1]=t.ymin;const i=e.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(OM(t,s))return!0;for(let n=1;n<r.length;n++){const o=r[n];if(OM(t,o)||cwe(s,o,lwe))return!0;s=o}}return!1}const oa=[0,0];function pje(t){for(let e=0;e<t.length;e++){const i=t[e];for(let s=0;s<i.length-1;s++){const n=i[s],o=i[s+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],u=t[a][l+1];if(IU(n,o,c,u,oa)&&!(oa[0]===n[0]&&oa[1]===n[1]||oa[0]===c[0]&&oa[1]===c[1]||oa[0]===o[0]&&oa[1]===o[1]||oa[0]===u[0]&&oa[1]===u[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const o=i[s],a=i[s+1];for(let l=s+2;l<n;l++){const c=i[l],u=i[l+1];if(IU(o,a,c,u,oa)&&!(oa[0]===o[0]&&oa[1]===o[1]||oa[0]===c[0]&&oa[1]===c[1]||oa[0]===a[0]&&oa[1]===a[1]||oa[0]===u[0]&&oa[1]===u[1]))return!0}}}return!1}function cwe(t,e,i){for(let r=0;r<i.length;r++)if(IU(t,e,i[r][0],i[r][1]))return!0;return!1}function IU(t,e,i,r,s){const[n,o]=t,[a,l]=e,[c,u]=i,[d,p]=r,m=d-c,g=n-c,y=a-n,v=p-u,b=o-u,w=l-o,x=v*y-m*w;if(x===0)return!1;const T=(m*b-v*g)/x,C=(y*b-w*g)/x;return T>=0&&T<=1&&C>=0&&C<=1&&(s&&(s[0]=n+T*(a-n),s[1]=o+T*(l-o)),!0)}function fje(t){switch(t){case"esriGeometryEnvelope":case"extent":return aje;case"esriGeometryMultipoint":case"multipoint":return lje;case"esriGeometryPoint":case"point":return oje;case"esriGeometryPolygon":case"polygon":return uje;case"esriGeometryPolyline":case"polyline":return dje}}var Gh;function mje(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function n_(t,e,i){return e==null?i:i==null?e:t(e,i)}let Vo=Gh=class extends eb{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,r,s){return mje(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?We.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:r,spatialReference:s??We.WGS84}}static fromBounds(t,e){return new Gh({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new Gh({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new _t({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new Gh;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&P4(e,i)&&(t=e.isWebMercator?lS(t):wO(t,!0)),t.type==="point"?gee(this,t):t.type==="extent"&&tje(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&P4(e,i)&&(t=e.isWebMercator?lS(t):wO(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,r=this.height*e;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;return e&&i&&!gs(e,i)&&P4(e,i)&&(t=e.isWebMercator?lS(t):wO(t,!0)),fje(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=n_(Math.min,this.zmin,t.zmin),this.zmax=n_(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=n_(Math.min,this.mmin,t.mmin),this.mmax=n_(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=n_(Math.max,this.zmin,t.zmin),this.zmax=n_(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=n_(Math.max,this.mmin,t.mmin),this.mmax=n_(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=c0(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,i=this._getCM(t);if(i){const r=e.isWebMercator?wO(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(r.x=Jj(r.x,t).x),this.spatialReference=new We(VK((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(t){let e=null;const[i,r]=t.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(e=this.center),e}_normalize(t,e,i){const r=this.spatialReference;if(!r)return this;const s=i??c0(r);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const u=(l.zmax-l.zmin)/2;for(let d=0;d<c.length;d++)c[d].push(u)}if(a){const u=(l.mmax-l.mmin)/2;for(let d=0;d<c.length;d++)c[d].push(u)}return c}),hasZ:o,hasM:a,spatialReference:r}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let u;t=t||c0(o);const[d,p]=t.valid;u=Jj(this.xmin,t);const m=u.x,g=u.frameId;u=Jj(this.xmax,t);const y=u.x,v=u.frameId,b=m===y&&a>0;if(a>2*p){const w=new Gh(l<c?m:y,s,p,n,o),x=new Gh(d,s,l<c?y:m,n,o),T=new Gh(0,s,p,n,o),C=new Gh(d,s,0,n,o),M=[],O=[];w.contains(T)&&M.push(g),w.contains(C)&&O.push(g),x.contains(T)&&M.push(v),x.contains(C)&&O.push(v);for(let D=g+1;D<v;D++)M.push(D),O.push(D);e.push({extent:w,frameIds:[g]},{extent:x,frameIds:[v]},{extent:T,frameIds:M},{extent:C,frameIds:O})}else m>y||b?e.push({extent:new Gh(m,s,p,n,o),frameIds:[g]},{extent:new Gh(d,s,y,n,o),frameIds:[v]}):e.push({extent:new Gh(m,s,y,n,o),frameIds:[g]});this.cache._parts=e}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}};function Jj(t,e){const[i,r]=e.valid,s=2*r;let n,o=0;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s,o=n):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s,o=-n),{x:t,frameId:o}}h([f({readOnly:!0})],Vo.prototype,"cache",null),h([f({readOnly:!0})],Vo.prototype,"center",null),h([f({readOnly:!0})],Vo.prototype,"extent",null),h([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Vo.prototype,"hasM",null),h([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Vo.prototype,"hasZ",null),h([f({readOnly:!0})],Vo.prototype,"height",null),h([f({readOnly:!0})],Vo.prototype,"width",null),h([f({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Vo.prototype,"xmin",void 0),h([f({type:Number,json:{write:!0}})],Vo.prototype,"ymin",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Vo.prototype,"mmin",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Vo.prototype,"zmin",void 0),h([f({type:Number,json:{write:!0}})],Vo.prototype,"xmax",void 0),h([f({type:Number,json:{write:!0}})],Vo.prototype,"ymax",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Vo.prototype,"mmax",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Vo.prototype,"zmax",void 0),Vo=Gh=h([I("esri.geometry.Extent")],Vo),Vo.prototype.toJSON.isDefaultToJSON=!0;const gi=Vo;function RM(t,e,i=!1){let{hasM:r,hasZ:s}=t;Array.isArray(e)?e.length!==4||r||s?e.length===3&&i&&!r?(s=!0,r=!1):e.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&e.hasZ&&(!r||e.hasM),r=!r&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=r}var a7;function _ae(t){return(e,i)=>e==null?i:i==null?e:t(e,i)}function gje(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let z_=a7=class extends eb{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){var s;if(!t&&!e)return{};const i={};Array.isArray(t)?(i.points=t,i.spatialReference=e):gje(t)?i.spatialReference=t:(t.points&&(i.points=t.points),t.spatialReference&&(i.spatialReference=t.spatialReference),t.hasZ&&(i.hasZ=t.hasZ),t.hasM&&(i.hasM=t.hasM));const r=(s=i.points)==null?void 0:s[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new gi,i=this.hasZ,r=this.hasM,s=i?3:2,n=t[0],o=_ae(Math.min),a=_ae(Math.max);let l,c,u,d,[p,m]=n,[g,y]=n;for(let v=0,b=t.length;v<b;v++){const w=t[v],[x,T]=w;if(p=o(p,x),m=o(m,T),g=a(g,x),y=a(y,T),i&&w.length>2){const C=w[2];l=o(l,C),u=a(u,C)}if(r&&w.length>s){const C=w[s];c=o(c,C),d=a(d,C)}}return e.xmin=p,e.ymin=m,e.xmax=g,e.ymax=y,e.spatialReference=this.spatialReference,i?(e.zmin=l,e.zmax=u):(e.zmin=void 0,e.zmax=void 0),r?(e.mmin=c,e.mmax=d):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=Q(this.points)}addPoint(t){return RM(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:Q(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new a7(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],i={x:e[0],y:e[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=e[2],r=3),this.hasM&&(i.m=e[r]),new _t(i)}removePoint(t){if(!this._validateInputs(t))return null;const e=new _t(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(RM(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};h([f({readOnly:!0})],z_.prototype,"cache",null),h([f()],z_.prototype,"extent",null),h([f({type:[[Number]],json:{write:{isRequired:!0}}})],z_.prototype,"points",void 0),h([Ve("points")],z_.prototype,"writePoints",null),z_=a7=h([I("esri.geometry.Multipoint")],z_),z_.prototype.toJSON.isDefaultToJSON=!0;const $A=z_;function Y3(t){const e=[];for(t.reset();t.nextPath();){const i=[];for(;t.nextPoint();)i.push([t.x,t.y]);e.push(i)}return t.reset(),e}function i1(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}var hs;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(hs||(hs={}));function dB(t,e){const i=e[0]-t[0],r=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function uwe(t,e,i){const r=t[0]+i*(e[0]-t[0]),s=t[1]+i*(e[1]-t[1]);return t.length>2&&e.length>2?[r,s,t[2]+i*(e[2]-t[2])]:[r,s]}function yje(t,e,i,r){const[s,n]=e,[o,a]=i,[l,c]=r,u=l-o,d=c-a,p=u*u+d*d,m=(s-o)*u+(n-a)*d,g=Math.min(1,Math.max(0,m/p));return t[0]=o+u*g,t[1]=a+d*g,t}function _je(t,e,i,r,s,n){let o=i,a=r,l=s-o,c=n-a;if(l!==0||c!==0){const u=((t-o)*l+(e-a)*c)/(l*l+c*c);u>1?(o=s,a=n):u>0&&(o+=l*u,a+=c*u)}return l=t-o,c=e-a,l*l+c*c}function hwe(t,e){return uwe(t,e,.5)}function yee(t){const e=t.length;let i=0;for(let r=0;r<e-1;++r)i+=dB(t[r],t[r+1]);return i}function dwe(t,e){if(e<=0)return t[0];const i=t.length;let r=0;for(let s=0;s<i-1;++s){const n=dB(t[s],t[s+1]);if(e-r<n){const o=(e-r)/n;return uwe(t[s],t[s+1],o)}r+=n}return t[i-1]}function xO(t,e=hs.X,i=hs.Y){let r=0;const s=t.length;let n=t[0];for(let o=1;o<s;o++){const a=t[o];r+=(a[e]-n[e])*(a[i]+n[i]),n=a}if(!pwe(t)){const o=t[0];r+=(o[e]-n[e])*(o[i]+n[i])}return r>=0}function pwe(t){const e=t.length;return e<3||w1(t[0],t[e-1])}function vje(t){if(!("rings"in t))return!1;let e=!1;for(const i of t.rings)pwe(i)||(i.push(i[0].slice()),e=!0);return e}function pVt(t){return t.type!=="polygon"&&t.type!=="polyline"||bje(t.type==="polygon"?t.rings:t.paths,t.spatialReference),t}function bje(t,e){const i=c0(e);if(!i)return;const r=i.valid[0],s=i.valid[1],n=s-r;for(const o of t){let a=1/0,l=-1/0;for(const u of o){const d=wje(u[0],r,s);a=Math.min(a,d),l=Math.max(l,d),u[0]=d}const c=l-a;n-c<c&&o.forEach(u=>{u[0]<0&&(u[0]+=n)})}}function wje(t,e,i){const r=i-e;return t<e?i-(e-t)%r:t>i?e+(t-e)%r:t}function fVt(t,e){if(t===e)return!0;if(t.type!==e.type)return!1;if(t.type==="point"||t.type==="mesh"||t.type==="extent")return!0;if(t.type==="multipoint")return t.points.length===e.points.length;const[i,r]=t.type==="polyline"?[t.paths,e.paths]:[t.rings,e.rings];return i.length===r.length&&i.every((s,n)=>s.length===r[n].length)}function mVt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function fwe(t){return t?mwe(t.rings,t.hasZ??!1):null}function mwe(t,e){if(!(t!=null&&t.length))return null;const i=[],r=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=t.length;n<o;n++){const a=gwe(t[n],e,s);a&&r.push(a)}if(r.sort((n,o)=>{let a=n[2]-o[2];return a===0&&e&&(a=n[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],e&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||e&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=t[0]&&t[0].length?Sje(t[0],e):null;if(!n)return null;i[0]=n[0],i[1]=n[1],e&&n.length>2&&(i[2]=n[2])}return i}function gwe(t,e,i){let r=0,s=0,n=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,u=t.length&&e?t[0][2]:0;for(let p=0;p<t.length;p++){const m=t[p],g=t[(p+1)%t.length],[y,v,b]=m,w=y-l,x=v-c,[T,C,M]=g,O=T-l,D=C-c,k=w*D-O*x;if(o+=k,r+=(w+O)*k,s+=(x+D)*k,e&&m.length>2&&g.length>2){const U=b-u,H=M-u,z=w*H-O*U;n+=(U+H)*z,a+=z}y<i[0]&&(i[0]=y),y>i[1]&&(i[1]=y),v<i[2]&&(i[2]=v),v>i[3]&&(i[3]=v),e&&(b<i[4]&&(i[4]=b),b>i[5]&&(i[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const d=[r/(6*o)+l,s/(6*o)+c,o];return e&&(i[4]===i[5]||a===0?(d[3]=(i[4]+i[5])/2,d[4]=0):(d[3]=n/(6*a)+u,d[4]=a)),d}function xje(t,e){let i=0,r=0,s=0;t.nextPoint();const n=t.pathSize?t.x:0,o=t.pathSize?t.y:0;for(let a=0;a<t.pathSize;a++){t.seekInPath(a);const l=[t.x,t.y];t.seekInPath((a+1)%t.pathSize);const c=[t.x,t.y],[u,d]=l,p=u-n,m=d-o,[g,y]=c,v=g-n,b=y-o,w=p*b-v*m;s+=w,i+=(p+v)*w,r+=(m+b)*w,u<e[0]&&(e[0]=u),u>e[1]&&(e[1]=u),d<e[2]&&(e[2]=d),d>e[3]&&(e[3]=d)}return s>0&&(s*=-1),s?(s*=.5,[i/(6*s)+n,r/(6*s)+o,s]):null}function Sje(t,e){const i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const u=t[l],d=t[l+1];if(u&&d){i[0]=u[0],i[1]=u[1],r[0]=d[0],r[1]=d[1],e&&u.length>2&&d.length>2&&(i[2]=u[2],r[2]=d[2]);const p=dB(i,r);if(p){s+=p;const m=hwe(u,d);n+=p*m[0],o+=p*m[1],e&&m.length>2&&(a+=p*m[2])}}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.length?t[0]:null}function Tje(t){const{hasZ:e,totalSize:i}=t;if(i===0)return null;const r=[],s=[],n=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=gwe(i1(t),t.hasZ,n);o&&s.push(o)}if(s.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),s.length&&(r[0]=s[0][0],r[1]=s[0][1],e&&(r[2]=s[0][3]),(r[0]<n[0]||r[0]>n[1]||r[1]<n[2]||r[1]>n[3]||e&&(r[2]<n[4]||r[2]>n[5]))&&(r.length=0)),!r.length){t.reset(),t.nextPath();const o=t.pathSize?Eje(t):null;if(!o)return null;r[0]=o[0],r[1]=o[1],e&&o.length>2&&(r[2]=o[2])}return r}function Eje(t){const{hasZ:e}=t,i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,u=t.z;for(;t.nextPoint();){const d=t.x,p=t.y,m=t.z;i[0]=l,i[1]=c,r[0]=d,r[1]=p,e&&(i[2]=u,r[2]=m);const g=dB(i,r);if(g){s+=g;const y=hwe(i,r);n+=g*y[0],o+=g*y[1],e&&y.length>2&&(a+=g*y[2])}l=d,c=p,u=m}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.pathSize?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const Cje=1e-6;function Mje(t){let e=0;for(t.reset();t.nextPath();)e+=t.getCurrentRingArea();if(e<Cje){const s=Tje(t);return s?[s[0],s[1]]:null}const i=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const r=[t.x,t.y];for(t.reset();t.nextPath();)Pje(i,r,t);return i[0]*=1/e,i[1]*=1/e,i[0]+=r[0],i[1]+=r[1],i}const Aje=1/3;function Pje(t,e,i){if(!t||!i||i.pathSize<3)return null;i.nextPoint();const r=i.x,s=i.y;i.nextPoint();let n,o=i.x-r,a=i.y-s,l=0,c=0;for(;i.nextPoint();)l=i.x-r,c=i.y-s,n=.5*Aje*(l*a-c*o),t[0]+=n*(o+l),t[1]+=n*(a+c),o=l,a=c;const u=i.getCurrentRingArea(),d=[r,s];return d[0]-=e[0],d[1]-=e[1],d[0]*=u,d[1]*=u,t[0]+=d[0],t[1]+=d[1],t}function Ht(t=Ije){return[t[0],t[1],t[2],t[3]]}function gVt(t){return[t[0],t[1],t[2],t[3]]}function T0(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function Z3(t,e,i,r,s=Ht()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function ywe(t,e=Ht()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function pB(t,e){return new gi({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function DC(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function r1(t,e,i){if(e!=null)if("length"in e)u7(e)?(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[0]),i[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":i[0]=Math.min(t[0],e.xmin),i[1]=Math.min(t[1],e.ymin),i[2]=Math.max(t[2],e.xmax),i[3]=Math.max(t[3],e.ymax);break;case"point":i[0]=Math.min(t[0],e.x),i[1]=Math.min(t[1],e.y),i[2]=Math.max(t[2],e.x),i[3]=Math.max(t[3],e.y)}else T0(i,t)}function Qj(t,e,i=t){const r=e.length;let s=t[0],n=t[1],o=t[2],a=t[3];for(let l=0;l<r;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function l7(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function Xa(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function _c(t){return t==null||t[1]>=t[3]?0:t[3]-t[1]}function yVt(t){return Xa(t)*_c(t)}function LU(t){return Xa(t)>0&&_c(t)>0}function _ee(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function _we(t,e){return fB(t,e[0],e[1])}function vae(t,e){const i=e[3],r=.5*(t[0]+t[2]),s=Math.abs(e[0]-r),n=.5*(t[2]-t[0]);if(s>i+n)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>i+a)return!1;if(s<n||l<a)return!0;const c=s-n,u=l-a;return c*c+u*u<=i*i}function _Vt(t,e,i){const r=t[0],s=t[1],n=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:u}=i,d=(v,b)=>(u-l)*v+(a-c)*b+(c*l-a*u)<0,p=d(r,o),m=d(n,o),g=d(n,s),y=d(r,s);return!(p===m&&m===g&&g===y&&y===p||a<r&&c<r||a>n&&c>n||l>o&&u>o||l<s&&u<s)}function vVt(t,e){return fB(t,e.x,e.y)}function fB(t,e,i){return e>=t[0]&&i>=t[1]&&e<=t[2]&&i<=t[3]}function Oje(t,e,i){return e[0]>=t[0]-i&&e[1]>=t[1]-i&&e[0]<=t[2]+i&&e[1]<=t[3]+i}function X3(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function bae(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function c7(t,e,i){if(e==null)return T0(i,t);const r=e[0],s=e[1],n=e[2],o=e[3];return i[0]=Te(t[0],r,n),i[1]=Te(t[1],s,o),i[2]=Te(t[2],r,n),i[3]=Te(t[3],s,o),i}function Rje(t,e){const i=(t[0]+t[2])/2,r=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-i)-Xa(t)/2,0),n=Math.max(Math.abs(e[1]-r)-_c(t)/2,0);return Math.sqrt(s*s+n*n)}function DU(t,e,i,r=t){return r[0]=t[0]+e,r[1]=t[1]+i,r[2]=t[2]+e,r[3]=t[3]+i,r}function Mc(t){return t?T0(t,h7):Ht(h7)}function u7(t){return t!=null&&t.length===4}function $je(t){return!(Xa(t)!==0&&isFinite(t[0])||_c(t)!==0&&isFinite(t[1]))}function cS(t,e){return u7(t)&&u7(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const bVt=[-1/0,-1/0,1/0,1/0],h7=[1/0,1/0,-1/0,-1/0],Ije=[0,0,0,0];function vwe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function bwe(t){return t.points!==void 0}function wwe(t){return t.x!==void 0&&t.y!==void 0}function xwe(t){return t.paths!==void 0}function Swe(t){return t.rings!==void 0}function Twe(t){function e(i,r){return i==null?r:r==null?i:t(i,r)}return e}const Hv=Twe(Math.min),qv=Twe(Math.max);function Lje(t,e){return xwe(e)?$M(t,e.paths,!1,!1):Swe(e)?$M(t,e.rings,!1,!1):bwe(e)?vee(t,e.points,!1,!1,!1,!1):vwe(e)?Cwe(t,e):(wwe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function mB(t){let e,i,r,s;for(t.reset(),e=r=1/0,i=s=-1/0;t.nextPath();){const n=Ewe(t);e=Math.min(n[0],e),r=Math.min(n[1],r),i=Math.max(n[2],i),s=Math.max(n[3],s)}return Ht([e,r,i,s])}function Ewe(t){let e,i,r,s;for(e=r=1/0,i=s=-1/0;t.nextPoint();)e=Math.min(t.x,e),r=Math.min(t.y,r),i=Math.max(t.x,i),s=Math.max(t.y,s);return Ht([e,r,i,s])}function wVt(t,e){return xwe(e)?$M(t,e.paths,!0,!1):Swe(e)?$M(t,e.rings,!0,!1):bwe(e)?vee(t,e.points,!0,!1,!0,!1):vwe(e)?Cwe(t,e,!0,!1,!0,!1):(wwe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function $M(t,e,i,r){const s=i?3:2;if(!e.length||!e[0].length)return null;let n,o,a,l,[c,u]=e[0][0],[d,p]=e[0][0];for(let m=0;m<e.length;m++){const g=e[m];for(let y=0;y<g.length;y++){const v=g[y],[b,w]=v;if(c=Hv(c,b),u=Hv(u,w),d=qv(d,b),p=qv(p,w),i&&v.length>2){const x=v[2];n=Hv(n,x),o=qv(o,x)}if(r&&v.length>s){const x=v[s];a=Hv(n,x),l=qv(o,x)}}}return i?r?(t[0]=c,t[1]=u,t[2]=n,t[3]=a,t[4]=d,t[5]=p,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=u,t[2]=n,t[3]=d,t[4]=p,t[5]=o,t.length=6,t):r?(t[0]=c,t[1]=u,t[2]=a,t[3]=d,t[4]=p,t[5]=l,t.length=6,t):(t[0]=c,t[1]=u,t[2]=d,t[3]=p,t.length=4,t)}function Cwe(t,e,i,r,s,n){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let u=e.zmin,d=e.zmax,p=e.mmin,m=e.mmax;return s?(u=u||0,d=d||0,n?(p=p||0,m=m||0,t[0]=o,t[1]=l,t[2]=u,t[3]=p,t[4]=a,t[5]=c,t[6]=d,t[7]=m,t):(t[0]=o,t[1]=l,t[2]=u,t[3]=a,t[4]=c,t[5]=d,t)):n?(p=p||0,m=m||0,t[0]=o,t[1]=l,t[2]=p,t[3]=a,t[4]=c,t[5]=m,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function vee(t,e,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!e.length||!e[0].length)return null;let c,u,d,p,[m,g]=e[0],[y,v]=e[0];for(let b=0;b<e.length;b++){const w=e[b],[x,T]=w;if(m=Hv(m,x),g=Hv(g,T),y=qv(y,x),v=qv(v,T),l&&w.length>2){const C=w[2];c=Hv(c,C),u=qv(u,C)}if(a&&w.length>o){const C=w[o];d=Hv(c,C),p=qv(u,C)}}return s?(c=c||0,u=u||0,n?(d=d||0,p=p||0,t[0]=m,t[1]=g,t[2]=c,t[3]=d,t[4]=y,t[5]=v,t[6]=u,t[7]=p,t):(t[0]=m,t[1]=g,t[2]=c,t[3]=y,t[4]=v,t[5]=u,t)):n?(d=d||0,p=p||0,t[0]=m,t[1]=g,t[2]=d,t[3]=y,t[4]=v,t[5]=p,t):(t[0]=m,t[1]=g,t[2]=y,t[3]=v,t)}function Dje(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Nje(t){return t.points!==void 0}function Fje(t){return t.x!==void 0&&t.y!==void 0}function kje(t){return t.paths!==void 0}function Uje(t){return t.rings!==void 0}const bee=[];function Mwe(t,e,i,r){return{xmin:t,ymin:e,xmax:i,ymax:r}}function Awe(t,e,i,r,s,n){return{xmin:t,ymin:e,zmin:i,xmax:r,ymax:s,zmax:n}}function Pwe(t,e,i,r,s,n){return{xmin:t,ymin:e,mmin:i,xmax:r,ymax:s,mmax:n}}function Owe(t,e,i,r,s,n,o,a){return{xmin:t,ymin:e,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function wee(t,e=!1,i=!1){return e?i?Owe(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):Awe(t[0],t[1],t[2],t[3],t[4],t[5]):i?Pwe(t[0],t[1],t[2],t[3],t[4],t[5]):Mwe(t[0],t[1],t[2],t[3])}function xVt(t){return t?Dje(t)?t:Fje(t)?Vje(t):Uje(t)?Rwe(t):kje(t)?$we(t):Nje(t)?zje(t):null:null}function zje(t){const{hasZ:e,hasM:i,points:r}=t;return wee(vee(bee,r,e??!1,i??!1),e,i)}function Vje(t){const{x:e,y:i,z:r,m:s}=t,n=s!=null;return r!=null?n?Owe(e,i,r,s,e,i,r,s):Awe(e,i,r,e,i,r):n?Pwe(e,i,s,e,i,s):Mwe(e,i,e,i)}function Rwe(t){const{hasZ:e,hasM:i,rings:r}=t,s=$M(bee,r,e??!1,i??!1);return s?wee(s,e,i):null}function $we(t){const{hasZ:e,hasM:i,paths:r}=t,s=$M(bee,r,e??!1,i??!1);return s?wee(s,e,i):null}var R4;function wae(t){return!Array.isArray(t[0])}let fm=R4=class extends eb{static fromExtent(t){const e=t.clone().normalize(),i=t.spatialReference;let r=!1,s=!1;for(const o of e)o.hasZ&&(r=!0),o.hasM&&(s=!0);const n={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new R4(n)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){var o,a;let i,r,s=null,n=null;return t&&!Array.isArray(t)?(s=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),i=t.hasZ,r=t.hasM):s=t,s=s||[],e=e||We.WGS84,s.length&&((o=s[0])==null?void 0:o[0])!=null&&typeof s[0][0]=="number"&&(s=[s]),n=(a=s[0])==null?void 0:a[0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=n.length>3):i===void 0?i=r?n.length>3:n.length>2:r===void 0&&(r=i?n.length>3:n.length>2)),{rings:s,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=fwe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new _t;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=Rwe(this);if(!e)return null;const i=new gi(e);return i.spatialReference=t,i}get isSelfIntersecting(){return pje(this.rings)}writeRings(t,e){e.rings=Q(this.rings)}addRing(t){if(!t)return;const e=this.rings,i=e.length;if(wae(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new R4;return t.spatialReference=this.spatialReference,t.rings=Q(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;if(e!=null!=(i!=null)||e!=null&&i!=null&&!e.equals(i)||this.rings.length!==t.rings.length)return!1;const r=([s,n,o,a],[l,c,u,d])=>s===l&&n===c&&(o==null&&u==null||o===u)&&(a==null&&d==null||a===d);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=t.rings[s];if(!w1(n,o,r))return!1}return!0}contains(t){if(!t)return!1;const e=W3(t,this.spatialReference);return rje(this,e??t)}isClockwise(t){const e=wae(t)?t.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):t;return xO(e)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.rings[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new _t(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new _t(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new _t(i[0],i[1],i[2],i[3],this.spatialReference):new _t(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(RM(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t].splice(e,0,i),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new _t(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new _t(s,i));return this.notifyChange("rings"),r}setPoint(t,e,i){return this._validateInputs(t,e)?(RM(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t][e]=i,this.notifyChange("rings"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const r=this.rings[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};h([f({readOnly:!0})],fm.prototype,"cache",null),h([f({readOnly:!0})],fm.prototype,"centroid",null),h([f({readOnly:!0})],fm.prototype,"extent",null),h([f({readOnly:!0})],fm.prototype,"isSelfIntersecting",null),h([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],fm.prototype,"rings",void 0),h([Ve("rings")],fm.prototype,"writeRings",null),fm=R4=h([I("esri.geometry.Polygon")],fm),fm.prototype.toJSON.isDefaultToJSON=!0;const tb=fm;var d7;function Bje(t){return!Array.isArray(t[0])}let V_=d7=class extends eb{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){var o,a;let i,r,s=null,n=null;return t&&!Array.isArray(t)?(s=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),i=t.hasZ,r=t.hasM):s=t,s=s||[],e=e||We.WGS84,s.length&&((o=s[0])==null?void 0:o[0])!=null&&typeof s[0][0]=="number"&&(s=[s]),n=(a=s[0])==null?void 0:a[0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=!1):i===void 0?i=!r&&n.length>3:r===void 0&&(r=!i&&n.length>3)),{paths:s,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=$we(this);if(!e)return null;const i=new gi(e);return i.spatialReference=t,i}writePaths(t,e){e.paths=Q(this.paths)}addPath(t){if(!t)return;const e=this.paths,i=e.length;if(Bje(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new d7;return t.spatialReference=this.spatialReference,t.paths=Q(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.paths[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new _t(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new _t(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new _t(i[0],i[1],i[2],i[3],this.spatialReference):new _t(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(RM(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t].splice(e,0,i),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new _t(s,i));return this.notifyChange("paths"),r}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new _t(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(t,e,i){return this._validateInputs(t,e)?(RM(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t][e]=i,this.notifyChange("paths"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const r=this.paths[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};h([f({readOnly:!0})],V_.prototype,"cache",null),h([f({readOnly:!0})],V_.prototype,"extent",null),h([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],V_.prototype,"paths",void 0),h([Ve("paths")],V_.prototype,"writePaths",null),V_=d7=h([I("esri.geometry.Polyline")],V_),V_.prototype.toJSON.isDefaultToJSON=!0;const J3=V_,Iwe=Bl()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),xae=Bl()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function Qp(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function uS(t){return t.points!==void 0}function IM(t){return t.x!==void 0&&t.y!==void 0}function Kp(t){return t.paths!==void 0}function Ll(t){return t.rings!==void 0}function C1(t){return t==null?null:t instanceof eb?t:IM(t)?_t.fromJSON(t):Kp(t)?J3.fromJSON(t):Ll(t)?tb.fromJSON(t):uS(t)?$A.fromJSON(t):Qp(t)?gi.fromJSON(t):null}function xee(t){return t?IM(t)?"esriGeometryPoint":Kp(t)?"esriGeometryPolyline":Ll(t)?"esriGeometryPolygon":Qp(t)?"esriGeometryEnvelope":uS(t)?"esriGeometryMultipoint":null:null}const Gje={esriGeometryPoint:_t,esriGeometryPolyline:J3,esriGeometryPolygon:tb,esriGeometryEnvelope:gi,esriGeometryMultipoint:$A};function jje(t){return t&&Gje[t]||null}const fT={base:eb,key:"type",typeMap:{extent:gi,multipoint:$A,point:_t,polyline:J3,polygon:tb}};xf(fT);var p7;let B_=p7=class extends ye{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new p7({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};h([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Kj}}}}})],B_.prototype,"rotation",void 0),h([Li("rotation")],B_.prototype,"castRotation",null),h([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Kj}}}}})],B_.prototype,"scale",void 0),h([f({types:fT,json:{read:C1,write:!0,origins:{"web-scene":{read:C1,write:{overridePolicy:Kj}}}}})],B_.prototype,"targetGeometry",void 0),h([f({type:Eh,json:{write:!0}})],B_.prototype,"camera",void 0),B_=p7=h([I("esri.Viewpoint")],B_);const M1=B_;function Kj(){return{enabled:!this.camera}}let $4=class Lwe{constructor(){this._emitter=new Lwe.EventEmitter(this)}emit(e,i){return this._emitter.emit(e,i)}on(e,i){return this._emitter.on(e,i)}once(e,i){return this._emitter.once(e,i)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(s=null){this._target=s,this._listenersMap=null}clear(){var s;(s=this._listenersMap)==null||s.clear(),this._listenersMap=null}destroy(){this.clear()}emit(s,n){var c;let o=(c=this._listenersMap)==null?void 0:c.get(s);if(!o)return!1;const a=this._target||this;let l=!1;for(const u of o.slice()){const d="deref"in u?u.deref():u;d?d==null||d.call(a,n):l=!0}return l&&(o=o.filter(u=>!("deref"in u)||u.deref()!=null),this._listenersMap.set(s,o)),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return PS(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),Ni(()=>{var c;const a=(c=this._listenersMap)==null?void 0:c.get(s),l=(a==null?void 0:a.indexOf(n))??-1;l>=0&&a.splice(l,1)})}once(s,n){const o=this.on(s,a=>{o.remove();const l="deref"in n?n.deref():n;l==null||l.call(null,a)});return o}hasEventListener(s){var o;const n=(o=this._listenersMap)==null?void 0:o.get(s);return n!=null&&n.length>0}}t.EventEmitter=e,t.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=h([I("esri.core.Evented")],s),s};let i=class extends Re{constructor(){super(...arguments),this._emitter=new $4.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=h([I("esri.core.Evented.EventedAccessor")],i),t.EventedAccessor=i})($4||($4={}));const cn=$4;var Ar;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(Ar||(Ar={}));function See(t){return(e,i)=>{e[i]=t}}let Q3=class extends w1e{notify(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}};var Yy;let Hje=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},qje=class{constructor(e,i,r,s,n){this.target=e,this.added=i,this.removed=r,this.start=s,this.deleteCount=n}};const Rh=new Ca(Hje,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1});function Sae(t){t&&typeof t=="object"&&"destroy"in t&&typeof t.destroy=="function"&&t.destroy()}function e6(t){return t?t instanceof Vy?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function t6(t){if(t!=null&&t.length)return t[0]}function Wje(t,e,i,r){const s=Math.min(t.length-i,e.length-r);let n=0;for(;n<s&&t[i+n]===e[r+n];)n++;return n}function Dwe(t,e,i,r){e&&e.forEach((s,n,o)=>{t.push(s),Dwe(t,i.call(r,s,n,o),i,r)})}const o_=new Set,a_=new Set,l_=new Set,i6=new Map;let Yje=0,Vy=Yy=class extends cn.EventedAccessor{static isCollection(t){return t!=null&&t instanceof Yy}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new Q3,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:Yje++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof Yy?{items:t}:t:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),this._emitter.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return zt(this._observable),this._items}set items(t){this._emitBeforeChanges(Ar.ADD)||(this._splice(0,this.length,e6(t)),this._emitAfterChanges(Ar.ADD))}hasEventListener(t){return!this.destroyed&&(t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t))}on(t,e){if(this.destroyed)return Ni();if(t==="change"){const i=this._chgListeners,r={removed:!1,callback:e};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),Ni(()=>{r.removed=!0,i.splice(i.indexOf(r),1)})}return this._emitter.on(t,e)}once(t,e){const i="deref"in e?()=>e.deref():()=>e,r=this.on(t,s=>{var n;(n=i())==null||n.call(null,s),r.remove()});return r}add(t,e){if(zt(this._observable),this._emitBeforeChanges(Ar.ADD))return this;const i=this.getNextIndex(e??null);return this._splice(i,0,[t]),this._emitAfterChanges(Ar.ADD),this}addMany(t,e=this._items.length){if(zt(this._observable),!(t!=null&&t.length))return this;if(this._emitBeforeChanges(Ar.ADD))return this;const i=this.getNextIndex(e);return this._splice(i,0,e6(t)),this._emitAfterChanges(Ar.ADD),this}at(t){if(zt(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(zt(this._observable),!this.length||this._emitBeforeChanges(Ar.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(Ar.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return zt(this._observable),this._createNewInstance({items:this._items.map(Q)})}concat(...t){zt(this._observable);const e=t.map(e6);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(zt(this._observable),!this.length||this._emitBeforeChanges(Ar.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)t.call(e,i[s],s,i);this._emitAfterChanges(Ar.REMOVE)}destroyAll(){this.drain(Sae)}destroyMany(t){const e=this.removeMany(t);return e.forEach(Sae),e}every(t,e){return zt(this._observable),this._items.every(t,e)}filter(t,e){let i;return zt(this._observable),i=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:i})}find(t,e){return zt(this._observable),this._items.find(t,e)}findIndex(t,e){return zt(this._observable),this._items.findIndex(t,e)}flatten(t,e){zt(this._observable);const i=[];return Dwe(i,this,t,e),new Yy(i)}forEach(t,e){return zt(this._observable),this._items.forEach(t,e)}getItemAt(t){return zt(this._observable),this._items[t]}getNextIndex(t){zt(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return zt(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return zt(this._observable),this._items.indexOf(t,e)}join(t=","){return zt(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return zt(this._observable),this._items.lastIndexOf(t,e)}map(t,e){zt(this._observable);const i=this._items.map(t,e);return new Yy({items:i})}reorder(t,e=this.length-1){zt(this._observable);const i=this.indexOf(t);if(i!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(Ar.MOVE))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(Ar.MOVE)}return t}}pop(){if(zt(this._observable),!this.length||this._emitBeforeChanges(Ar.REMOVE))return;const t=t6(this._splice(this.length-1,1));return this._emitAfterChanges(Ar.REMOVE),t}push(...t){return zt(this._observable),this._emitBeforeChanges(Ar.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(Ar.ADD)),this.length}reduce(t,e){zt(this._observable);const i=this._items;return arguments.length===2?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){zt(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return zt(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(zt(this._observable),t<0||t>=this.length||this._emitBeforeChanges(Ar.REMOVE))return;const e=t6(this._splice(t,1));return this._emitAfterChanges(Ar.REMOVE),e}removeMany(t){if(zt(this._observable),!(t!=null&&t.length)||this._emitBeforeChanges(Ar.REMOVE))return[];const e=t instanceof Yy?t.toArray():t,i=this._items,r=[],s=e.length;for(let n=0;n<s;n++){const o=e[n],a=i.indexOf(o);if(a>-1){const l=1+Wje(e,i,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),n+=l-1}}return this._emitAfterChanges(Ar.REMOVE),r}reverse(){if(zt(this._observable),this._emitBeforeChanges(Ar.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(Ar.MOVE),this}shift(){if(zt(this._observable),!this.length||this._emitBeforeChanges(Ar.REMOVE))return;const t=t6(this._splice(0,1));return this._emitAfterChanges(Ar.REMOVE),t}slice(t=0,e=this.length){return zt(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return zt(this._observable),this._items.some(t,e)}sort(t){if(zt(this._observable),!this.length||this._emitBeforeChanges(Ar.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(Ar.MOVE),this}splice(t,e,...i){zt(this._observable);const r=(e?Ar.REMOVE:0)|(i.length?Ar.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(t,e,i)||[];return this._emitAfterChanges(r),s}toArray(){return zt(this._observable),this._items.slice()}toJSON(){return zt(this._observable),this.toArray()}toLocaleString(){return zt(this._observable),this._items.toLocaleString()}toString(){return zt(this._observable),this._items.toString()}unshift(...t){return zt(this._observable),!t.length||this._emitBeforeChanges(Ar.ADD)||(this._splice(0,0,t),this._emitAfterChanges(Ar.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=hT(()=>this._dispatchChange())),t<0&&(t+=this.length),e){if(o=r.splice(t,e),this.hasEventListener("before-remove")){const a=Rh.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(t,0,n),t+=1,l-=1,c-=1);Rh.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Rh.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Rh.release(a)}}if(i!=null&&i.length){if(s){const u=[];for(const d of i){const p=s.ensureType(d);p==null&&d!=null||u.push(p)}i=u}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const u=Rh.acquire();u.target=this,u.cancellable=!0;const d=Rh.acquire();d.target=this,d.cancellable=!1;for(const p of i)a?(u.reset(p),this.emit("before-add",u),u.defaultPrevented||(c?r.push(p):r.splice(t++,0,p),this._set("length",r.length),l&&(d.reset(p),this.emit("after-add",d)))):(c?r.push(p):r.splice(t++,0,p),this._set("length",r.length),d.reset(p),this.emit("after-add",d));Rh.release(d),Rh.release(u)}else{if(c)for(const u of i)r.push(u);else r.splice(t,0,...i);this._set("length",r.length)}}if((i!=null&&i.length||o!=null&&o.length)&&this._notifyChangeEvent(i,o),this.hasEventListener("after-splice")){const a=new qje(this,i,o,t,e);this.emit("after-splice",a)}return o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=Rh.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,Rh.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=Rh.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),Rh.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const i=e.changes;o_.clear(),a_.clear(),l_.clear();for(const{added:l,removed:c}of i){if(l)if(l_.size===0&&a_.size===0)for(const u of l)o_.add(u);else for(const u of l)a_.has(u)?(l_.add(u),a_.delete(u)):l_.has(u)||o_.add(u);if(c)if(l_.size===0&&o_.size===0)for(const u of c)a_.add(u);else for(const u of c)o_.has(u)?o_.delete(u):(l_.delete(u),a_.add(u))}const r=iu.acquire();o_.forEach(l=>{r.push(l)});const s=iu.acquire();a_.forEach(l=>{s.push(l)});const n=this._items,o=e.items,a=iu.acquire();if(l_.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),e.listeners&&(r.length||s.length||a.length)){const l={target:this,added:r,removed:s,moved:a},c=e.listeners.length;for(let u=0;u<c;u++){const d=e.listeners[u];d.removed||d.callback.call(this,l)}}iu.release(r),iu.release(s),iu.release(a)}o_.clear(),a_.clear(),l_.clear()}};Vy.ofType=t=>{if(!t)return Yy;if(i6.has(t))return i6.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const r in t.typeMap){const s=t.typeMap[r].prototype.declaredClass;e?e+=` | ${s}`:e=s}let i=class extends Yy{};return h([See({Type:t,ensureType:typeof t=="function"?Ln(t):xf(t)})],i.prototype,"itemType",void 0),i=h([I(`esri.core.Collection<${e}>`)],i),i6.set(t,i),i},h([f()],Vy.prototype,"_updating",void 0),h([f()],Vy.prototype,"length",void 0),h([f()],Vy.prototype,"items",null),h([f({readOnly:!0})],Vy.prototype,"updating",null),Vy=Yy=h([I("esri.core.Collection")],Vy);const tt=Vy;function gB(t){return typeof t=="string"?document.getElementById(t):t??null}function Nwe(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function Tae(t,e){const i=e.parentNode;i&&i.insertBefore(t,e)}function Eae(t,e){for(;;){const i=t.firstChild;if(!i)break;e.appendChild(i)}}function yB(t,e,i){return KV(t.map((r,s)=>e.apply(i,[r,s])))}async function Zje(t,e,i){return(await KV(t.map((r,s)=>e.apply(i,[r,s])))).map(r=>r.value)}function Tee(t){return{ok:!0,value:t}}function Eee(t){return{ok:!1,error:t}}function Xje(t){return t!=null&&t.ok===!0?t.value:null}function Jje(t){return t!=null&&t.ok===!1?t.error:null}async function Vd(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return Tee(await t)}catch(e){return Eee(e)}}async function Qje(t){try{return Tee(await t)}catch(e){return Pn(e),Eee(e)}}function CVt(t){if(t.ok===!0)return t.value;throw t.error}function Nf(t,e){return new G_(t,e)}let G_=class extends Re{get value(){return Xje(this._result)}get error(){return Jje(this._result)}get finished(){return this._result!=null}constructor(e,i){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=Ul(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(s=>{this._result=Tee(s),this._cleanup()},s=>{this._result=Eee(s),this._cleanup()}),this._abortHandle=Io(i,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Or(this._abortHandle),this._abortController=null}};h([f()],G_.prototype,"value",null),h([f()],G_.prototype,"error",null),h([f()],G_.prototype,"finished",null),h([f()],G_.prototype,"promise",void 0),h([f()],G_.prototype,"_result",void 0),G_=h([I("esri.core.asyncUtils.ReactiveTask")],G_);function ue(t,e,i={}){return Cee(t,e,i,Fwe)}function vu(t,e,i={}){return Cee(t,e,i,kwe)}function Cee(t,e,i={},r){let s=null;const n=i.once?(o,a)=>{r(o)&&(Or(s),e(o,a))}:(o,a)=>{r(o)&&e(o,a)};if(s=uVe(t,n,i.sync,i.equals),i.initial){const o=t();n(o,o)}return s}function Ta(t,e,i,r={}){let s=null,n=null,o=null;function a(){var u;s&&n&&(n.remove(),(u=r.onListenerRemove)==null||u.call(r,s),s=null,n=null)}function l(u){r.once&&r.once&&Or(o),i(u)}const c=ue(t,(u,d)=>{var p;a(),XV(u)&&(s=u,n=PA(u,e,l),(p=r.onListenerAdd)==null||p.call(r,u))},{sync:r.sync,initial:!0});return o=Ni(()=>{c.remove(),a()}),o}function zI(t,e){return Kje(t,kwe,e)}function Kje(t,e,i){if(Yn(i))return Promise.reject(Di());const r=t();if(e!=null&&e(r))return Promise.resolve(r);let s=null;function n(){s=Or(s)}return new Promise((o,a)=>{s=PS([Io(i,()=>{n(),a(Di())}),Cee(t,l=>{n(),o(l)},{sync:!1,once:!0},e??Fwe)])})}function Fwe(t){return!0}function kwe(t){return!!t}function e6e(t,e){const i=new tt,r=Ta(t,"after-splice",({added:s,start:n,deleteCount:o})=>{const a=i.splice(n,o);for(const l of a)l.remove();if(s!=null&&s.length){const l=s.map(e);i.addMany(l,n)}},{sync:!0,onListenerRemove:()=>i.drain(s=>s.remove()),onListenerAdd:s=>i.addMany(s.items.map(e))});return i.addHandles(r),i}function AVt(t,e){const i=new tt,r=e6e(t,a=>Nf(async l=>{const c=await e(a,l);if(Yn(l))throw c.remove(),Di();return c})),s=()=>null,n=async a=>{const l=await a.promise,c=r.indexOf(a);c<0||i.splice(c,1,l)};i.addMany(r.items.map(s));for(const a of r)OI(n(a));const o=r.on("after-splice",({added:a,start:l,deleteCount:c})=>{const u=i.splice(l,c);for(const d of u)d==null||d.remove();if(a!=null&&a.length){i.addMany(a.map(s),l);for(const d of a)OI(n(d))}});return i.addHandles([g1e(r),o]),i}const ar={sync:!0},cr={initial:!0},sr={sync:!0,initial:!0},t6e=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,i6e="screenUtils.toPt: input not recognized!",Uwe=96;function _n(t){return t?t/72*Uwe:0}function Do(t){return t?72*t/Uwe:0}function pr(t){if(typeof t=="string"){const e=t.match(t6e);if(e){const i=Number(e[1]),r=e[3]&&e[3].toLowerCase(),s=t.charAt(0)==="-",n=r==="px"?Do(i):i;return s?-n:n}return console.warn(i6e),null}return t}function Bd(t=0,e=0){return{x:t,y:e}}function vs(t=0,e=0){return[t,e]}function zwe(t=0,e=0){return[t,e]}function xa(t=0,e=0,i=0){return[t,e,i]}function PVt(t){return t}function OVt(t){return t}function RVt(t){return t}function ef(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}let NU=class{constructor(e=i=>i.values().next().value){this._peeker=e,this._observable=new Q3,this._items=new Set}get length(){return zt(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return zt(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const i=this.length;return this._items.forEach(r=>{e(r)||this._items.delete(r)}),i!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){zt(this._observable),yield*this._items}};const Vwe=new FinalizationRegistry(t=>{t.close()});function r6e(t,e){Vwe.register(t,e,e)}function s6e(t){Vwe.unregister(t)}function Bwe(t,e){return new Proxy({},{get:(i,r,s)=>(...n)=>{let o,a;const l=n[n.length-1];return n6e(l)&&(o=l.signal,a=l.transferList,n.pop()),t.apply(e?`${e}.${r.toString()}`:r.toString(),n,{transferList:a,signal:o})}})}function n6e(t){return typeof t=="object"&&!Array.isArray(t)&&t!=null&&("signal"in t||"transferList"in t||Object.keys(t).length===0)}const o6e={statsWorker:()=>fe(()=>import("./statsWorker-mnDtH3LJ.js"),__vite__mapDeps([2,3,4,5,6])),geometryEngineWorker:()=>fe(()=>import("./geometryEngineWorker-CSeRIS2l.js"),__vite__mapDeps([7,8,9,10])),CSVSourceWorker:()=>fe(()=>import("./CSVSourceWorker-Bedf_K27.js"),__vite__mapDeps([11,12,10,13,14,15,16,17,18,19,20,21,22,3,4,5,6,23,24,25])),EdgeProcessingWorker:()=>fe(()=>import("./EdgeProcessingWorker-DMQsgUHb.js"),__vite__mapDeps([26,27])),ElevationSamplerWorker:()=>fe(()=>import("./ElevationSamplerWorker-DlEfPQ0J.js"),__vite__mapDeps([28,15,16,29])),FeatureServiceSnappingSourceWorker:()=>fe(()=>import("./FeatureServiceSnappingSourceWorker-Dq_28Mai.js"),__vite__mapDeps([30,13,14,15,16,17,18,19,20,21,10,22,3,4,5,6,23,31,32,33,34])),GeoJSONSourceWorker:()=>fe(()=>import("./GeoJSONSourceWorker-abmWBhS5.js"),__vite__mapDeps([35,13,14,15,16,17,18,19,20,21,10,22,3,4,5,6,23,36,12,25,37])),LercWorker:()=>fe(()=>import("./LercWorker-DletdfbA.js"),[]),MemorySourceWorker:()=>fe(()=>import("./MemorySourceWorker-BK5iDUoq.js"),__vite__mapDeps([38,39,13,14,15,16,17,18,19,20,21,10,22,3,4,5,6,23,25,37,12])),PBFDecoderWorker:()=>fe(()=>import("./PBFDecoderWorker-Cq5e8yg4.js"),__vite__mapDeps([40,32,33])),FeaturePipelineWorker:()=>fe(()=>import("./FeaturePipelineWorker-CCY0dY_S.js"),__vite__mapDeps([41,42,43,44,17,18,19,20,21,10,22,3,4,5,6,23,16,34,32,33,45,36,12,25,37,46,47])),PointCloudWorker:()=>fe(()=>import("./PointCloudWorker-CYmFdExa.js"),__vite__mapDeps([48,49,50])),RasterWorker:()=>fe(()=>import("./RasterWorker-B4tas2fn.js"),__vite__mapDeps([51,52,53,54])),SceneLayerSnappingSourceWorker:()=>fe(()=>import("./SceneLayerSnappingSourceWorker-BfRt49X0.js"),[]),SceneLayerWorker:()=>fe(()=>import("./SceneLayerWorker-DHhcZFbm.js").then(t=>t.S),__vite__mapDeps([55,56])),WFSSourceWorker:()=>fe(()=>import("./WFSSourceWorker-D3400A6H.js"),__vite__mapDeps([57,13,14,15,16,17,18,19,20,21,10,22,3,4,5,6,23,36,12,37,58,59])),WorkerTileHandler:()=>fe(()=>import("./WorkerTileHandler-DuqPLRvk.js"),__vite__mapDeps([60,44,33,42])),Lyr3DWorker:()=>fe(()=>import("./Lyr3DWorker-CsyTb_an.js"),__vite__mapDeps([61,62,63]))},Gwe="worker:port-closed";var va;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(va||(va={}));let a6e=0;function jwe(){return a6e++}function l6e(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function VI(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function Mee(t,e,i,r){if(e.type===va.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==va.INVOKE&&e.type!==va.RESPONSE)return void t.postMessage(e);let s;if(l6e(i)?(s=Cae(i.transferList),e.data=i.result):(s=Cae(r),e.data=i),s){if(re("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case va.INVOKE:throw o;case va.RESPONSE:return void Mee(t,{type:va.RESPONSE,jobId:e.jobId,error:VI(o)})}}}t.postMessage(e,s)}else t.postMessage(e)}function BI(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function Cae(t){if(!(t!=null&&t.length))return null;if(re("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(i=>!c6e(i));return e.length?e:null}function c6e(t){var e;return t instanceof ArrayBuffer||((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="ArrayBuffer"}async function IVt(t){try{return await t}catch(e){const i=(e==null?void 0:e.name)===Gwe;if(!(ms(e)||i))throw e;return}}const{CLOSE:Mae,ABORT:Aae,INVOKE:Pae,RESPONSE:pP,OPEN_PORT:Oae,ON:u6e}=va,h6e=2;let d6e=class{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===va.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},A1=class X2{static connect(e,i){const r=new MessageChannel;let s;s=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new X2(r.port1,{channel:r,client:s,schedule:i});return typeof s=="object"&&"remoteClient"in s&&(s.remoteClient=n),X2.clients.set(n,s),r.port2}static loadWorker(e){const i=o6e[e];return i?i():Promise.resolve(null)}constructor(e,i,r){this._port=e,this._jobQueue=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new d6e(s=>this._onInvokeMessage(s)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:Mae}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const s=r==null?void 0:r.signal,n=r==null?void 0:r.transferList;if(!this._port)return Promise.reject(new V(Gwe,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:i}));const o=jwe();return new Promise((a,l)=>{if(Yn(s))return this._processWork(),void l(Di());const c=Io(s,()=>{const d=this._outJobs.get(o);d&&(this._outJobs.delete(o),this._processWork(),Or(d.abortHandle),this._post({type:Aae,jobId:o}),l(Di()))}),u={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,u),this._post({type:Pae,jobId:o,methodName:e,abortable:s!=null},i,n)})}createInvokeProxy(e){return Bwe(this,e)}on(e,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:va.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),Ni(()=>{r.port1.postMessage({type:va.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:Oae,port:e.port2}),e.port1}_processWork(){var o;if(this._outJobs.size>=h6e)return;const e=(o=this._jobQueue)==null?void 0:o.pop();if(!e)return;const{methodName:i,data:r,invokeOptions:s,resolver:n}=e;this.apply(i,r,s).then(a=>n.resolve(a)).catch(a=>n.reject(a))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Or(e.abortHandle),e.reject(Di(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e,!0)):this._processMessage(e,!1)}_processMessage(e,i){const r=BI(e);if(r)switch(r.type){case pP:this._onResponseMessage(r);break;case Pae:i?this._onInvokeMessage(r):this._invokeQueue.push(r);break;case Aae:this._onAbortMessage(r);break;case Mae:this._onCloseMessage();break;case Oae:this._onOpenPortMessage(r);break;case u6e:this._onOnMessage(r)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&X2.clients.get(this)===e&&e.destroy(),X2.clients.delete(this),e!=null&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s=[],abortable:n}=e,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,u=c[i];try{if(!u&&i&&i.includes(".")){const d=i.split(".");for(let p=0;p<d.length-1;p++)c=c[d[p]],u=c[d[p+1]]}if(typeof u!="function")throw new TypeError(`${i} is not a function`);s.push({client:this,signal:o?o.signal:null}),l=u.apply(c,s)}catch(d){return void this._post({type:pP,jobId:r,error:VI(d)})}Cu(l)?(a.set(r,{controller:o,promise:l}),l.then(d=>{a.has(r)&&(a.delete(r),this._post({type:pP,jobId:r},d))},d=>{a.has(r)&&(a.delete(r),ms(d)||this._post({type:pP,jobId:r,error:VI(d||{message:`Error encountered at method ${i}`})}))})):this._post({type:pP,jobId:r},l)}_onOpenPortMessage(e){new X2(e.port,{client:this._client})}_onOnMessage(e){const{port:i}=e,r=this._client.on(e.eventType,n=>{i.postMessage(n)}),s=PA(e.port,"message",n=>{const o=BI(n);(o==null?void 0:o.type)===va.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs;if(!n.has(i))return;const o=n.get(i);n.delete(i),this._processWork(),Or(o.abortHandle),r?o.reject(V.fromJSON(JSON.parse(r))):o.resolve(s)}_post(e,i,r){return Mee(this._port,e,i,r)}};A1.kernelInfo={buildDate:Dbe,fullVersion:dee,revision:Nbe},A1.clients=new Map;let p6e=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new NU}destroy(){this.close()}get closed(){var e;return!((e=this._clients)!=null&&e.length)}open(e,i){return new Promise((r,s)=>{let n=!0;const o=a=>{Et(i.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];Cu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new A1(c,i,this._ongoingJobsQueue),o(r),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new A1(l,i,this._ongoingJobsQueue),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(e,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a==null?void 0:a.invoke(e,i,r))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(Di(`Worker closing, aborting job calling '${e.methodName}'`));for(const i of this._clientPromises)i.then(r=>r==null?void 0:r.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,s6e(this)}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const s=ra();this._ongoingJobsQueue.push({methodName:e,data:i,invokeOptions:r,resolver:s});for(let n=0;n<this._clientPromises.length;n++){const o=this._clients[n];o?o.jobAdded():this._clientPromises[n].then(a=>a==null?void 0:a.jobAdded())}return s.promise}createInvokeProxy(e){return Bwe(this,e)}on(e,i){return Promise.all(this._clientPromises).then(()=>PS(this._clients.map(r=>r.on(e,i))))}openPorts(){return new Promise(e=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(i[s]=n.openPort()),--r==0&&e(i)})})}get test(){}};const f6e={async request(t,e){var o,a;const i=t.options,r=i.responseType;i.signal=e==null?void 0:e.signal,i.responseType=r==="native"||r==="native-request-init"?"native-request-init":r&&["blob","json","text"].includes(r)&&((o=Y9(t.url))!=null&&o.after)?r:"array-buffer";const s=await Yt(t.url,i),n={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch((a=s.requestOptions)==null?void 0:a.responseType){case"native-request-init":return delete n.data.signal,n;case"blob":n.data=await n.data.arrayBuffer();break;case"json":n.data=new TextEncoder().encode(JSON.stringify(n.data)).buffer;break;case"text":n.data=new TextEncoder().encode(n.data).buffer}return{result:n,transferList:[n.data]}}};let I$;var $ve,Ive;const m6e=(($ve=globalThis.esriConfig)==null?void 0:$ve.locale)??((Ive=globalThis.dojoConfig)==null?void 0:Ive.locale);function Hwe(){var t;return m6e??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function fu(){return I$===void 0&&(I$=Hwe()),I$}function g6e(t=fu()){const e=/^([a-zA-Z]{2,3})(?:[_-]\w+)*$/.exec(t);return e==null?void 0:e[1].toLowerCase()}const I4=[];function qwe(t){return I4.push(t),Ni(()=>I4.splice(I4.indexOf(t),1))}const L4=[];function Aee(t){return L4.push(t),Ni(()=>L4.splice(L4.indexOf(t),1))}function y6e(){const t=Hwe();I$!==t&&([...L4].forEach(e=>e(t)),I$=t,[...I4].forEach(e=>e(t)))}var Lve;(Lve=globalThis.addEventListener)==null||Lve.call(globalThis,"languagechange",y6e);const Rae=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Bishkek"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class mT extends Error{}class _6e extends mT{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class v6e extends mT{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class b6e extends mT{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class KE extends mT{}class Wwe extends mT{constructor(e){super(`Invalid unit ${e}`)}}class ru extends mT{}class c_ extends mT{constructor(){super("Zone is an abstract class")}}const ht="numeric",Cf="short",bh="long",FU={year:ht,month:ht,day:ht},Ywe={year:ht,month:Cf,day:ht},w6e={year:ht,month:Cf,day:ht,weekday:Cf},Zwe={year:ht,month:bh,day:ht},Xwe={year:ht,month:bh,day:ht,weekday:bh},Jwe={hour:ht,minute:ht},Qwe={hour:ht,minute:ht,second:ht},Kwe={hour:ht,minute:ht,second:ht,timeZoneName:Cf},exe={hour:ht,minute:ht,second:ht,timeZoneName:bh},txe={hour:ht,minute:ht,hourCycle:"h23"},ixe={hour:ht,minute:ht,second:ht,hourCycle:"h23"},rxe={hour:ht,minute:ht,second:ht,hourCycle:"h23",timeZoneName:Cf},sxe={hour:ht,minute:ht,second:ht,hourCycle:"h23",timeZoneName:bh},nxe={year:ht,month:ht,day:ht,hour:ht,minute:ht},oxe={year:ht,month:ht,day:ht,hour:ht,minute:ht,second:ht},axe={year:ht,month:Cf,day:ht,hour:ht,minute:ht},lxe={year:ht,month:Cf,day:ht,hour:ht,minute:ht,second:ht},x6e={year:ht,month:Cf,day:ht,weekday:Cf,hour:ht,minute:ht},cxe={year:ht,month:bh,day:ht,hour:ht,minute:ht,timeZoneName:Cf},uxe={year:ht,month:bh,day:ht,hour:ht,minute:ht,second:ht,timeZoneName:Cf},hxe={year:ht,month:bh,day:ht,weekday:bh,hour:ht,minute:ht,timeZoneName:bh},dxe={year:ht,month:bh,day:ht,weekday:bh,hour:ht,minute:ht,second:ht,timeZoneName:bh};class IA{get type(){throw new c_}get name(){throw new c_}get ianaName(){return this.name}get isUniversal(){throw new c_}offsetName(e,i){throw new c_}formatOffset(e,i){throw new c_}offset(e){throw new c_}equals(e){throw new c_}get isValid(){throw new c_}}let r6=null;class _B extends IA{static get instance(){return r6===null&&(r6=new _B),r6}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return wxe(e,i,r)}formatOffset(e,i){return L$(this.offset(e),i)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let D4={};function S6e(t){return D4[t]||(D4[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),D4[t]}const T6e={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function E6e(t,e){const i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,o,a,l,c,u]=r;return[o,s,n,a,l,c,u]}function C6e(t,e){const i=t.formatToParts(e),r=[];for(let s=0;s<i.length;s++){const{type:n,value:o}=i[s],a=T6e[n];n==="era"?r[a]=o:Ci(a)||(r[a]=parseInt(o,10))}return r}let hD={};class Ch extends IA{static create(e){return hD[e]||(hD[e]=new Ch(e)),hD[e]}static resetCache(){hD={},D4={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Ch.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return wxe(e,i,r,this.name)}formatOffset(e,i){return L$(this.offset(e),i)}offset(e){const i=new Date(e);if(isNaN(i))return NaN;const r=S6e(this.name);let[s,n,o,a,l,c,u]=r.formatToParts?C6e(r,i):E6e(r,i);a==="BC"&&(s=-Math.abs(s)+1);const p=bB({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:u,millisecond:0});let m=+i;const g=m%1e3;return m-=g>=0?g:1e3+g,(p-m)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let $ae={};function M6e(t,e={}){const i=JSON.stringify([t,e]);let r=$ae[i];return r||(r=new Intl.ListFormat(t,e),$ae[i]=r),r}let f7={};function m7(t,e={}){const i=JSON.stringify([t,e]);let r=f7[i];return r||(r=new Intl.DateTimeFormat(t,e),f7[i]=r),r}let g7={};function A6e(t,e={}){const i=JSON.stringify([t,e]);let r=g7[i];return r||(r=new Intl.NumberFormat(t,e),g7[i]=r),r}let y7={};function P6e(t,e={}){const{base:i,...r}=e,s=JSON.stringify([t,r]);let n=y7[s];return n||(n=new Intl.RelativeTimeFormat(t,e),y7[s]=n),n}let SO=null;function O6e(){return SO||(SO=new Intl.DateTimeFormat().resolvedOptions().locale,SO)}let Iae={};function R6e(t){let e=Iae[t];if(!e){const i=new Intl.Locale(t);e="getWeekInfo"in i?i.getWeekInfo():i.weekInfo,Iae[t]=e}return e}function $6e(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const i=t.indexOf("-u-");if(i===-1)return[t];{let r,s;try{r=m7(t).resolvedOptions(),s=t}catch{const l=t.substring(0,i);r=m7(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=r;return[s,n,o]}}function I6e(t,e,i){return(i||e)&&(t.includes("-u-")||(t+="-u"),i&&(t+=`-ca-${i}`),e&&(t+=`-nu-${e}`)),t}function L6e(t){const e=[];for(let i=1;i<=12;i++){const r=li.utc(2009,i,1);e.push(t(r))}return e}function D6e(t){const e=[];for(let i=1;i<=7;i++){const r=li.utc(2016,11,13+i);e.push(t(r))}return e}function dD(t,e,i,r){const s=t.listingMode();return s==="error"?null:s==="en"?i(e):r(e)}function N6e(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class F6e{constructor(e,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:s,floor:n,...o}=r;if(!i||Object.keys(o).length>0){const a={useGrouping:!1,...r};r.padTo>0&&(a.minimumIntegerDigits=r.padTo),this.inf=A6e(e,a)}}format(e){if(this.inf){const i=this.floor?Math.floor(e):e;return this.inf.format(i)}else{const i=this.floor?Math.floor(e):$ee(e,3);return Mo(i,this.padTo)}}}class k6e{constructor(e,i,r){this.opts=r,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&Ch.create(a).valid?(s=a,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=m7(i,n)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(i=>{if(i.type==="timeZoneName"){const r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...i,value:r}}else return i}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class U6e{constructor(e,i,r){this.opts={style:"long",...r},!i&&vxe()&&(this.rtf=P6e(e,r))}format(e,i){return this.rtf?this.rtf.format(e,i):n8e(i,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,i){return this.rtf?this.rtf.formatToParts(e,i):[]}}const z6e={firstDay:1,minimalDays:4,weekend:[6,7]};class ys{static fromOpts(e){return ys.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,i,r,s,n=!1){const o=e||no.defaultLocale,a=o||(n?"en-US":O6e()),l=i||no.defaultNumberingSystem,c=r||no.defaultOutputCalendar,u=_7(s)||no.defaultWeekSettings;return new ys(a,l,c,u,o)}static resetCache(){SO=null,f7={},g7={},y7={}}static fromObject({locale:e,numberingSystem:i,outputCalendar:r,weekSettings:s}={}){return ys.create(e,i,r,s)}constructor(e,i,r,s,n){const[o,a,l]=$6e(e);this.locale=o,this.numberingSystem=i||a||null,this.outputCalendar=r||l||null,this.weekSettings=s,this.intl=I6e(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=N6e(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&i?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:ys.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,_7(e.weekSettings)||this.weekSettings,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,i=!1){return dD(this,e,Txe,()=>{const r=i?{month:e,day:"numeric"}:{month:e},s=i?"format":"standalone";return this.monthsCache[s][e]||(this.monthsCache[s][e]=L6e(n=>this.extract(n,r,"month"))),this.monthsCache[s][e]})}weekdays(e,i=!1){return dD(this,e,Mxe,()=>{const r=i?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=i?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=D6e(n=>this.extract(n,r,"weekday"))),this.weekdaysCache[s][e]})}meridiems(){return dD(this,void 0,()=>Axe,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[li.utc(2016,11,13,9),li.utc(2016,11,13,19)].map(i=>this.extract(i,e,"dayperiod"))}return this.meridiemCache})}eras(e){return dD(this,e,Pxe,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[li.utc(-40,1,1),li.utc(2017,1,1)].map(r=>this.extract(r,i,"era"))),this.eraCache[e]})}extract(e,i,r){const s=this.dtFormatter(e,i),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(e={}){return new F6e(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,i={}){return new k6e(e,this.intl,i)}relFormatter(e={}){return new U6e(this.intl,this.isEnglish(),e)}listFormatter(e={}){return M6e(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:bxe()?R6e(this.locale):z6e}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let s6=null;class Qa extends IA{static get utcInstance(){return s6===null&&(s6=new Qa(0)),s6}static instance(e){return e===0?Qa.utcInstance:new Qa(e)}static parseSpecifier(e){if(e){const i=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new Qa(wB(i[1],i[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${L$(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${L$(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,i){return L$(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class V6e extends IA{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Dv(t,e){if(Ci(t)||t===null)return e;if(t instanceof IA)return t;if(j6e(t)){const i=t.toLowerCase();return i==="default"?e:i==="local"||i==="system"?_B.instance:i==="utc"||i==="gmt"?Qa.utcInstance:Qa.parseSpecifier(i)||Ch.create(t)}else return hS(t)?Qa.instance(t):typeof t=="object"&&"offset"in t&&typeof t.offset=="function"?t:new V6e(t)}let Lae=()=>Date.now(),Dae="system",Nae=null,Fae=null,kae=null,Uae=60,zae,Vae=null;class no{static get now(){return Lae}static set now(e){Lae=e}static set defaultZone(e){Dae=e}static get defaultZone(){return Dv(Dae,_B.instance)}static get defaultLocale(){return Nae}static set defaultLocale(e){Nae=e}static get defaultNumberingSystem(){return Fae}static set defaultNumberingSystem(e){Fae=e}static get defaultOutputCalendar(){return kae}static set defaultOutputCalendar(e){kae=e}static get defaultWeekSettings(){return Vae}static set defaultWeekSettings(e){Vae=_7(e)}static get twoDigitCutoffYear(){return Uae}static set twoDigitCutoffYear(e){Uae=e%100}static get throwOnInvalid(){return zae}static set throwOnInvalid(e){zae=e}static resetCaches(){ys.resetCache(),Ch.resetCache()}}class nf{constructor(e,i){this.reason=e,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const pxe=[0,31,59,90,120,151,181,212,243,273,304,334],fxe=[0,31,60,91,121,152,182,213,244,274,305,335];function Pd(t,e){return new nf("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function Pee(t,e,i){const r=new Date(Date.UTC(t,e-1,i));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function mxe(t,e,i){return i+(K3(t)?fxe:pxe)[e-1]}function gxe(t,e){const i=K3(t)?fxe:pxe,r=i.findIndex(n=>n<e),s=e-i[r];return{month:r+1,day:s}}function Oee(t,e){return(t-e+7)%7+1}function kU(t,e=4,i=1){const{year:r,month:s,day:n}=t,o=mxe(r,s,n),a=Oee(Pee(r,s,n),i);let l=Math.floor((o-a+14-e)/7),c;return l<1?(c=r-1,l=GI(c,e,i)):l>GI(r,e,i)?(c=r+1,l=1):c=r,{weekYear:c,weekNumber:l,weekday:a,...xB(t)}}function Bae(t,e=4,i=1){const{weekYear:r,weekNumber:s,weekday:n}=t,o=Oee(Pee(r,1,e),i),a=NC(r);let l=s*7+n-o-7+e,c;l<1?(c=r-1,l+=NC(c)):l>a?(c=r+1,l-=NC(r)):c=r;const{month:u,day:d}=gxe(c,l);return{year:c,month:u,day:d,...xB(t)}}function n6(t){const{year:e,month:i,day:r}=t,s=mxe(e,i,r);return{year:e,ordinal:s,...xB(t)}}function Gae(t){const{year:e,ordinal:i}=t,{month:r,day:s}=gxe(e,i);return{year:e,month:r,day:s,...xB(t)}}function jae(t,e){if(!Ci(t.localWeekday)||!Ci(t.localWeekNumber)||!Ci(t.localWeekYear)){if(!Ci(t.weekday)||!Ci(t.weekNumber)||!Ci(t.weekYear))throw new KE("Cannot mix locale-based week fields with ISO-based week fields");return Ci(t.localWeekday)||(t.weekday=t.localWeekday),Ci(t.localWeekNumber)||(t.weekNumber=t.localWeekNumber),Ci(t.localWeekYear)||(t.weekYear=t.localWeekYear),delete t.localWeekday,delete t.localWeekNumber,delete t.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function B6e(t,e=4,i=1){const r=vB(t.weekYear),s=Od(t.weekNumber,1,GI(t.weekYear,e,i)),n=Od(t.weekday,1,7);return r?s?n?!1:Pd("weekday",t.weekday):Pd("week",t.weekNumber):Pd("weekYear",t.weekYear)}function G6e(t){const e=vB(t.year),i=Od(t.ordinal,1,NC(t.year));return e?i?!1:Pd("ordinal",t.ordinal):Pd("year",t.year)}function yxe(t){const e=vB(t.year),i=Od(t.month,1,12),r=Od(t.day,1,UU(t.year,t.month));return e?i?r?!1:Pd("day",t.day):Pd("month",t.month):Pd("year",t.year)}function _xe(t){const{hour:e,minute:i,second:r,millisecond:s}=t,n=Od(e,0,23)||e===24&&i===0&&r===0&&s===0,o=Od(i,0,59),a=Od(r,0,59),l=Od(s,0,999);return n?o?a?l?!1:Pd("millisecond",s):Pd("second",r):Pd("minute",i):Pd("hour",e)}function Ci(t){return typeof t>"u"}function hS(t){return typeof t=="number"}function vB(t){return typeof t=="number"&&t%1===0}function j6e(t){return typeof t=="string"}function H6e(t){return Object.prototype.toString.call(t)==="[object Date]"}function vxe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function bxe(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function q6e(t){return Array.isArray(t)?t:[t]}function Hae(t,e,i){if(t.length!==0)return t.reduce((r,s)=>{const n=[e(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function W6e(t,e){return e.reduce((i,r)=>(i[r]=t[r],i),{})}function LM(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function _7(t){if(t==null)return null;if(typeof t!="object")throw new ru("Week settings must be an object");if(!Od(t.firstDay,1,7)||!Od(t.minimalDays,1,7)||!Array.isArray(t.weekend)||t.weekend.some(e=>!Od(e,1,7)))throw new ru("Invalid week settings");return{firstDay:t.firstDay,minimalDays:t.minimalDays,weekend:Array.from(t.weekend)}}function Od(t,e,i){return vB(t)&&t>=e&&t<=i}function Y6e(t,e){return t-e*Math.floor(t/e)}function Mo(t,e=2){const i=t<0;let r;return i?r="-"+(""+-t).padStart(e,"0"):r=(""+t).padStart(e,"0"),r}function xv(t){if(!(Ci(t)||t===null||t===""))return parseInt(t,10)}function Pb(t){if(!(Ci(t)||t===null||t===""))return parseFloat(t)}function Ree(t){if(!(Ci(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function $ee(t,e,i=!1){const r=10**e;return(i?Math.trunc:Math.round)(t*r)/r}function K3(t){return t%4===0&&(t%100!==0||t%400===0)}function NC(t){return K3(t)?366:365}function UU(t,e){const i=Y6e(e-1,12)+1,r=t+(e-i)/12;return i===2?K3(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function bB(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function qae(t,e,i){return-Oee(Pee(t,1,e),i)+e-1}function GI(t,e=4,i=1){const r=qae(t,e,i),s=qae(t+1,e,i);return(NC(t)-r+s)/7}function v7(t){return t>99?t:t>no.twoDigitCutoffYear?1900+t:2e3+t}function wxe(t,e,i,r=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const o={timeZoneName:e,...n},a=new Intl.DateTimeFormat(i,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function wB(t,e){let i=parseInt(t,10);Number.isNaN(i)&&(i=0);const r=parseInt(e,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function xxe(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new ru(`Invalid unit value ${t}`);return e}function zU(t,e){const i={};for(const r in t)if(LM(t,r)){const s=t[r];if(s==null)continue;i[e(r)]=xxe(s)}return i}function L$(t,e){const i=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${Mo(i,2)}:${Mo(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${Mo(i,2)}${Mo(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function xB(t){return W6e(t,["hour","minute","second","millisecond"])}const Z6e=["January","February","March","April","May","June","July","August","September","October","November","December"],Sxe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],X6e=["J","F","M","A","M","J","J","A","S","O","N","D"];function Txe(t){switch(t){case"narrow":return[...X6e];case"short":return[...Sxe];case"long":return[...Z6e];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const Exe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Cxe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],J6e=["M","T","W","T","F","S","S"];function Mxe(t){switch(t){case"narrow":return[...J6e];case"short":return[...Cxe];case"long":return[...Exe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Axe=["AM","PM"],Q6e=["Before Christ","Anno Domini"],K6e=["BC","AD"],e8e=["B","A"];function Pxe(t){switch(t){case"narrow":return[...e8e];case"short":return[...K6e];case"long":return[...Q6e];default:return null}}function t8e(t){return Axe[t.hour<12?0:1]}function i8e(t,e){return Mxe(e)[t.weekday-1]}function r8e(t,e){return Txe(e)[t.month-1]}function s8e(t,e){return Pxe(e)[t.year<0?0:1]}function n8e(t,e,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(i==="auto"&&n){const d=t==="days";switch(e){case 1:return d?"tomorrow":`next ${s[t][0]}`;case-1:return d?"yesterday":`last ${s[t][0]}`;case 0:return d?"today":`this ${s[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],u=r?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return o?`${a} ${u} ago`:`in ${a} ${u}`}function Wae(t,e){let i="";for(const r of t)r.literal?i+=r.val:i+=e(r.val);return i}const o8e={D:FU,DD:Ywe,DDD:Zwe,DDDD:Xwe,t:Jwe,tt:Qwe,ttt:Kwe,tttt:exe,T:txe,TT:ixe,TTT:rxe,TTTT:sxe,f:nxe,ff:axe,fff:cxe,ffff:hxe,F:oxe,FF:lxe,FFF:uxe,FFFF:dxe};class Dl{static create(e,i={}){return new Dl(e,i)}static parseFormat(e){let i=null,r="",s=!1;const n=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(r.length>0&&n.push({literal:s||/^\s+$/.test(r),val:r}),i=null,r="",s=!s):s||a===i?r+=a:(r.length>0&&n.push({literal:/^\s+$/.test(r),val:r}),r=a,i=a)}return r.length>0&&n.push({literal:s||/^\s+$/.test(r),val:r}),n}static macroTokenToFormatOpts(e){return o8e[e]}constructor(e,i){this.opts=i,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...i}).format()}dtFormatter(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i})}formatDateTime(e,i){return this.dtFormatter(e,i).format()}formatDateTimeParts(e,i){return this.dtFormatter(e,i).formatToParts()}formatInterval(e,i){return this.dtFormatter(e.start,i).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,i){return this.dtFormatter(e,i).resolvedOptions()}num(e,i=0){if(this.opts.forceSimple)return Mo(e,i);const r={...this.opts};return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,g)=>this.loc.extract(e,m,g),o=m=>e.isOffsetFixed&&e.offset===0&&m.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,m.format):"",a=()=>r?t8e(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,g)=>r?r8e(e,m):n(g?{month:m}:{month:m,day:"numeric"},"month"),c=(m,g)=>r?i8e(e,m):n(g?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),u=m=>{const g=Dl.macroTokenToFormatOpts(m);return g?this.formatWithSystemDefault(e,g):m},d=m=>r?s8e(e,m):n({era:m},"era"),p=m=>{switch(m){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return u(m)}};return Wae(Dl.parseFormat(i),p)}formatDurationFromString(e,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const u=r(c);return u?this.num(l.get(u),c.length):c},n=Dl.parseFormat(i),o=n.reduce((l,{literal:c,val:u})=>c?l:l.concat(u),[]),a=e.shiftTo(...o.map(r).filter(l=>l));return Wae(n,s(a))}}const Oxe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function LA(...t){const e=t.reduce((i,r)=>i+r.source,"");return RegExp(`^${e}$`)}function DA(...t){return e=>t.reduce(([i,r,s],n)=>{const[o,a,l]=n(e,s);return[{...i,...o},a||r,l]},[{},null,1]).slice(0,2)}function NA(t,...e){if(t==null)return[null,null];for(const[i,r]of e){const s=i.exec(t);if(s)return r(s)}return[null,null]}function Rxe(...t){return(e,i)=>{const r={};let s;for(s=0;s<t.length;s++)r[t[s]]=xv(e[i+s]);return[r,null,i+s]}}const $xe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,a8e=`(?:${$xe.source}?(?:\\[(${Oxe.source})\\])?)?`,Iee=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Ixe=RegExp(`${Iee.source}${a8e}`),Lee=RegExp(`(?:T${Ixe.source})?`),l8e=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,c8e=/(\d{4})-?W(\d\d)(?:-?(\d))?/,u8e=/(\d{4})-?(\d{3})/,h8e=Rxe("weekYear","weekNumber","weekDay"),d8e=Rxe("year","ordinal"),p8e=/(\d{4})-(\d\d)-(\d\d)/,Lxe=RegExp(`${Iee.source} ?(?:${$xe.source}|(${Oxe.source}))?`),f8e=RegExp(`(?: ${Lxe.source})?`);function FC(t,e,i){const r=t[e];return Ci(r)?i:xv(r)}function m8e(t,e){return[{year:FC(t,e),month:FC(t,e+1,1),day:FC(t,e+2,1)},null,e+3]}function FA(t,e){return[{hours:FC(t,e,0),minutes:FC(t,e+1,0),seconds:FC(t,e+2,0),milliseconds:Ree(t[e+3])},null,e+4]}function eL(t,e){const i=!t[e]&&!t[e+1],r=wB(t[e+1],t[e+2]),s=i?null:Qa.instance(r);return[{},s,e+3]}function tL(t,e){const i=t[e]?Ch.create(t[e]):null;return[{},i,e+1]}const g8e=RegExp(`^T?${Iee.source}$`),y8e=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function _8e(t){const[e,i,r,s,n,o,a,l,c]=t,u=e[0]==="-",d=l&&l[0]==="-",p=(m,g=!1)=>m!==void 0&&(g||m&&u)?-m:m;return[{years:p(Pb(i)),months:p(Pb(r)),weeks:p(Pb(s)),days:p(Pb(n)),hours:p(Pb(o)),minutes:p(Pb(a)),seconds:p(Pb(l),l==="-0"),milliseconds:p(Ree(c),d)}]}const v8e={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Dee(t,e,i,r,s,n,o){const a={year:e.length===2?v7(xv(e)):xv(e),month:Sxe.indexOf(i)+1,day:xv(r),hour:xv(s),minute:xv(n)};return o&&(a.second=xv(o)),t&&(a.weekday=t.length>3?Exe.indexOf(t)+1:Cxe.indexOf(t)+1),a}const b8e=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function w8e(t){const[,e,i,r,s,n,o,a,l,c,u,d]=t,p=Dee(e,s,r,i,n,o,a);let m;return l?m=v8e[l]:c?m=0:m=wB(u,d),[p,new Qa(m)]}function x8e(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const S8e=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,T8e=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,E8e=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Yae(t){const[,e,i,r,s,n,o,a]=t;return[Dee(e,s,r,i,n,o,a),Qa.utcInstance]}function C8e(t){const[,e,i,r,s,n,o,a]=t;return[Dee(e,a,i,r,s,n,o),Qa.utcInstance]}const M8e=LA(l8e,Lee),A8e=LA(c8e,Lee),P8e=LA(u8e,Lee),O8e=LA(Ixe),Dxe=DA(m8e,FA,eL,tL),R8e=DA(h8e,FA,eL,tL),$8e=DA(d8e,FA,eL,tL),I8e=DA(FA,eL,tL);function L8e(t){return NA(t,[M8e,Dxe],[A8e,R8e],[P8e,$8e],[O8e,I8e])}function D8e(t){return NA(x8e(t),[b8e,w8e])}function N8e(t){return NA(t,[S8e,Yae],[T8e,Yae],[E8e,C8e])}function F8e(t){return NA(t,[y8e,_8e])}const k8e=DA(FA);function U8e(t){return NA(t,[g8e,k8e])}const z8e=LA(p8e,f8e),V8e=LA(Lxe),B8e=DA(FA,eL,tL);function G8e(t){return NA(t,[z8e,Dxe],[V8e,B8e])}const Zae="Invalid Duration",Nxe={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},j8e={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...Nxe},$h=146097/400,kT=146097/4800,H8e={years:{quarters:4,months:12,weeks:$h/7,days:$h,hours:$h*24,minutes:$h*24*60,seconds:$h*24*60*60,milliseconds:$h*24*60*60*1e3},quarters:{months:3,weeks:$h/28,days:$h/4,hours:$h*24/4,minutes:$h*24*60/4,seconds:$h*24*60*60/4,milliseconds:$h*24*60*60*1e3/4},months:{weeks:kT/7,days:kT,hours:kT*24,minutes:kT*24*60,seconds:kT*24*60*60,milliseconds:kT*24*60*60*1e3},...Nxe},Gx=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],q8e=Gx.slice(0).reverse();function u_(t,e,i=!1){const r={values:i?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new Ir(r)}function Fxe(t,e){let i=e.milliseconds??0;for(const r of q8e.slice(1))e[r]&&(i+=e[r]*t[r].milliseconds);return i}function Xae(t,e){const i=Fxe(t,e)<0?-1:1;Gx.reduceRight((r,s)=>{if(Ci(e[s]))return r;if(r){const n=e[r]*i,o=t[s][r],a=Math.floor(n/o);e[s]+=a*i,e[r]-=a*o*i}return s},null),Gx.reduce((r,s)=>{if(Ci(e[s]))return r;if(r){const n=e[r]%1;e[r]-=n,e[s]+=n*t[r][s]}return s},null)}function W8e(t){const e={};for(const[i,r]of Object.entries(t))r!==0&&(e[i]=r);return e}class Ir{constructor(e){const i=e.conversionAccuracy==="longterm"||!1;let r=i?H8e:j8e;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||ys.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,i){return Ir.fromObject({milliseconds:e},i)}static fromObject(e,i={}){if(e==null||typeof e!="object")throw new ru(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Ir({values:zU(e,Ir.normalizeUnit),loc:ys.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(e){if(hS(e))return Ir.fromMillis(e);if(Ir.isDuration(e))return e;if(typeof e=="object")return Ir.fromObject(e);throw new ru(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,i){const[r]=F8e(e);return r?Ir.fromObject(r,i):Ir.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,i){const[r]=U8e(e);return r?Ir.fromObject(r,i):Ir.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,i=null){if(!e)throw new ru("need to specify a reason the Duration is invalid");const r=e instanceof nf?e:new nf(e,i);if(no.throwOnInvalid)throw new b6e(r);return new Ir({invalid:r})}static normalizeUnit(e){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!i)throw new Wwe(e);return i}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?Dl.create(this.loc,r).formatDurationFromString(this,e):Zae}toHuman(e={}){if(!this.isValid)return Zae;const i=Gx.map(r=>{const s=this.values[r];return Ci(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(s)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=$ee(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const i=this.toMillis();return i<0||i>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},li.fromMillis(i,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?Fxe(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const i=Ir.fromDurationLike(e),r={};for(const s of Gx)(LM(i.values,s)||LM(this.values,s))&&(r[s]=i.get(s)+this.get(s));return u_(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const i=Ir.fromDurationLike(e);return this.plus(i.negate())}mapUnits(e){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=xxe(e(this.values[r],r));return u_(this,{values:i},!0)}get(e){return this[Ir.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const i={...this.values,...zU(e,Ir.normalizeUnit)};return u_(this,{values:i})}reconfigure({locale:e,numberingSystem:i,conversionAccuracy:r,matrix:s}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:i}),matrix:s,conversionAccuracy:r};return u_(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return Xae(this.matrix,e),u_(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=W8e(this.normalize().shiftToAll().toObject());return u_(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>Ir.normalizeUnit(o));const i={},r={},s=this.toObject();let n;for(const o of Gx)if(e.indexOf(o)>=0){n=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;hS(s[o])&&(a+=s[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3}else hS(s[o])&&(r[o]=s[o]);for(const o in r)r[o]!==0&&(i[n]+=o===n?r[o]:r[o]/this.matrix[n][o]);return Xae(this.matrix,i),u_(this,{values:i},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const i of Object.keys(this.values))e[i]=this.values[i]===0?0:-this.values[i];return u_(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of Gx)if(!i(this.values[r],e.values[r]))return!1;return!0}}const UT="Invalid Interval";function Y8e(t,e){return!t||!t.isValid?zn.invalid("missing or invalid start"):!e||!e.isValid?zn.invalid("missing or invalid end"):e<t?zn.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class zn{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,i=null){if(!e)throw new ru("need to specify a reason the Interval is invalid");const r=e instanceof nf?e:new nf(e,i);if(no.throwOnInvalid)throw new v6e(r);return new zn({invalid:r})}static fromDateTimes(e,i){const r=mP(e),s=mP(i),n=Y8e(r,s);return n??new zn({start:r,end:s})}static after(e,i){const r=Ir.fromDurationLike(i),s=mP(e);return zn.fromDateTimes(s,s.plus(r))}static before(e,i){const r=Ir.fromDurationLike(i),s=mP(e);return zn.fromDateTimes(s.minus(r),s)}static fromISO(e,i){const[r,s]=(e||"").split("/",2);if(r&&s){let n,o;try{n=li.fromISO(r,i),o=n.isValid}catch{o=!1}let a,l;try{a=li.fromISO(s,i),l=a.isValid}catch{l=!1}if(o&&l)return zn.fromDateTimes(n,a);if(o){const c=Ir.fromISO(s,i);if(c.isValid)return zn.after(n,c)}else if(l){const c=Ir.fromISO(r,i);if(c.isValid)return zn.before(a,c)}}return zn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",i){if(!this.isValid)return NaN;const r=this.start.startOf(e,i);let s;return i!=null&&i.useLocaleWeeks?s=this.end.reconfigure({locale:r.locale}):s=this.end,s=s.startOf(e,i),Math.floor(s.diff(r,e).get(e))+(s.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:i}={}){return this.isValid?zn.fromDateTimes(e||this.s,i||this.e):this}splitAt(...e){if(!this.isValid)return[];const i=e.map(mP).filter(o=>this.contains(o)).sort((o,a)=>o.toMillis()-a.toMillis()),r=[];let{s}=this,n=0;for(;s<this.e;){const o=i[n]||this.e,a=+o>+this.e?this.e:o;r.push(zn.fromDateTimes(s,a)),s=a,n+=1}return r}splitBy(e){const i=Ir.fromDurationLike(e);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(zn.fromDateTimes(r,n)),r=n,s+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const i=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return i>=r?null:zn.fromDateTimes(i,r)}union(e){if(!this.isValid)return this;const i=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return zn.fromDateTimes(i,r)}static merge(e){const[i,r]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return r&&i.push(r),i}static xor(e){let i=null,r=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push(zn.fromDateTimes(i,l.time)),i=null);return zn.merge(s)}difference(...e){return zn.xor([this].concat(e)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} â€“ ${this.e.toISO()})`:UT}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=FU,i={}){return this.isValid?Dl.create(this.s.loc.clone(i),e).formatInterval(this):UT}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:UT}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:UT}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:UT}toFormat(e,{separator:i=" â€“ "}={}){return this.isValid?`${this.s.toFormat(e)}${i}${this.e.toFormat(e)}`:UT}toDuration(e,i){return this.isValid?this.e.diff(this.s,e,i):Ir.invalid(this.invalidReason)}mapEndpoints(e){return zn.fromDateTimes(e(this.s),e(this.e))}}class pD{static hasDST(e=no.defaultZone){const i=li.now().setZone(e).set({month:12});return!e.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(e){return Ch.isValidZone(e)}static normalizeZone(e){return Dv(e,no.defaultZone)}static getStartOfWeek({locale:e=null,locObj:i=null}={}){return(i||ys.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:i=null}={}){return(i||ys.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:i=null}={}){return(i||ys.create(e)).getWeekendDays().slice()}static months(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||ys.create(i,r,n)).months(e)}static monthsFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||ys.create(i,r,n)).months(e,!0)}static weekdays(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||ys.create(i,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||ys.create(i,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return ys.create(e).meridiems()}static eras(e="short",{locale:i=null}={}){return ys.create(i,null,"gregory").eras(e)}static features(){return{relative:vxe(),localeWeek:bxe()}}}function Jae(t,e){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(e)-i(t);return Math.floor(Ir.fromMillis(r).as("days"))}function Z8e(t,e,i){const r=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const u=Jae(l,c);return(u-u%7)/7}],["days",Jae]],s={},n=t;let o,a;for(const[l,c]of r)i.indexOf(l)>=0&&(o=l,s[l]=c(t,e),a=n.plus(s),a>e?(s[l]--,t=n.plus(s),t>e&&(a=t,s[l]--,t=n.plus(s))):t=a);return[t,s,a,o]}function X8e(t,e,i,r){let[s,n,o,a]=Z8e(t,e,i);const l=e-s,c=i.filter(d=>["hours","minutes","seconds","milliseconds"].indexOf(d)>=0);c.length===0&&(o<e&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const u=Ir.fromObject(n,r);return c.length>0?Ir.fromMillis(l,r).shiftTo(...c).plus(u):u}const Nee={arab:"[Ù -Ù©]",arabext:"[Û°-Û¹]",bali:"[á­-á­™]",beng:"[à§¦-à§¯]",deva:"[à¥¦-à¥¯]",fullwide:"[ï¼-ï¼™]",gujr:"[à«¦-à«¯]",hanidec:"[ã€‡|ä¸€|äºŒ|ä¸‰|å››|äº”|å…­|ä¸ƒ|å…«|ä¹]",khmr:"[áŸ -áŸ©]",knda:"[à³¦-à³¯]",laoo:"[à»-à»™]",limb:"[á¥†-á¥]",mlym:"[àµ¦-àµ¯]",mong:"[á -á ™]",mymr:"[á€-á‰]",orya:"[à­¦-à­¯]",tamldec:"[à¯¦-à¯¯]",telu:"[à±¦-à±¯]",thai:"[à¹-à¹™]",tibt:"[à¼ -à¼©]",latn:"\\d"},Qae={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},J8e=Nee.hanidec.replace(/[\[|\]]/g,"").split("");function Q8e(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(t[i].search(Nee.hanidec)!==-1)e+=J8e.indexOf(t[i]);else for(const s in Qae){const[n,o]=Qae[s];r>=n&&r<=o&&(e+=r-n)}}return parseInt(e,10)}else return e}function sp({numberingSystem:t},e=""){return new RegExp(`${Nee[t||"latn"]}${e}`)}const K8e="missing Intl.DateTimeFormat.formatToParts support";function qr(t,e=i=>i){return{regex:t,deser:([i])=>e(Q8e(i))}}const eHe="Â ",kxe=`[ ${eHe}]`,Uxe=new RegExp(kxe,"g");function tHe(t){return t.replace(/\./g,"\\.?").replace(Uxe,kxe)}function Kae(t){return t.replace(/\./g,"").replace(Uxe," ").toLowerCase()}function np(t,e){return t===null?null:{regex:RegExp(t.map(tHe).join("|")),deser:([i])=>t.findIndex(r=>Kae(i)===Kae(r))+e}}function ele(t,e){return{regex:t,deser:([,i,r])=>wB(i,r),groups:e}}function fD(t){return{regex:t,deser:([e])=>e}}function iHe(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function rHe(t,e){const i=sp(e),r=sp(e,"{2}"),s=sp(e,"{3}"),n=sp(e,"{4}"),o=sp(e,"{6}"),a=sp(e,"{1,2}"),l=sp(e,"{1,3}"),c=sp(e,"{1,6}"),u=sp(e,"{1,9}"),d=sp(e,"{2,4}"),p=sp(e,"{4,6}"),m=v=>({regex:RegExp(iHe(v.val)),deser:([b])=>b,literal:!0}),y=(v=>{if(t.literal)return m(v);switch(v.val){case"G":return np(e.eras("short"),0);case"GG":return np(e.eras("long"),0);case"y":return qr(c);case"yy":return qr(d,v7);case"yyyy":return qr(n);case"yyyyy":return qr(p);case"yyyyyy":return qr(o);case"M":return qr(a);case"MM":return qr(r);case"MMM":return np(e.months("short",!0),1);case"MMMM":return np(e.months("long",!0),1);case"L":return qr(a);case"LL":return qr(r);case"LLL":return np(e.months("short",!1),1);case"LLLL":return np(e.months("long",!1),1);case"d":return qr(a);case"dd":return qr(r);case"o":return qr(l);case"ooo":return qr(s);case"HH":return qr(r);case"H":return qr(a);case"hh":return qr(r);case"h":return qr(a);case"mm":return qr(r);case"m":return qr(a);case"q":return qr(a);case"qq":return qr(r);case"s":return qr(a);case"ss":return qr(r);case"S":return qr(l);case"SSS":return qr(s);case"u":return fD(u);case"uu":return fD(a);case"uuu":return qr(i);case"a":return np(e.meridiems(),0);case"kkkk":return qr(n);case"kk":return qr(d,v7);case"W":return qr(a);case"WW":return qr(r);case"E":case"c":return qr(i);case"EEE":return np(e.weekdays("short",!1),1);case"EEEE":return np(e.weekdays("long",!1),1);case"ccc":return np(e.weekdays("short",!0),1);case"cccc":return np(e.weekdays("long",!0),1);case"Z":case"ZZ":return ele(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return ele(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return fD(/[a-z_+-/]{1,256}?/i);case" ":return fD(/[^\S\n\r]/);default:return m(v)}})(t)||{invalidReason:K8e};return y.token=t,y}const sHe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function nHe(t,e,i){const{type:r,value:s}=t;if(r==="literal"){const l=/^\s+$/.test(s);return{literal:!l,val:l?" ":s}}const n=e[r];let o=r;r==="hour"&&(e.hour12!=null?o=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?o="hour12":o="hour24":o=i.hour12?"hour12":"hour24");let a=sHe[o];if(typeof a=="object"&&(a=a[n]),a)return{literal:!1,val:a}}function oHe(t){return[`^${t.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,t]}function aHe(t,e,i){const r=t.match(e);if(r){const s={};let n=1;for(const o in i)if(LM(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function lHe(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return Ci(t.z)||(i=Ch.create(t.z)),Ci(t.Z)||(i||(i=new Qa(t.Z)),r=t.Z),Ci(t.q)||(t.M=(t.q-1)*3+1),Ci(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),Ci(t.u)||(t.S=Ree(t.u)),[Object.keys(t).reduce((n,o)=>{const a=e(o);return a&&(n[a]=t[o]),n},{}),i,r]}let o6=null;function cHe(){return o6||(o6=li.fromMillis(1555555555555)),o6}function uHe(t,e){if(t.literal)return t;const i=Dl.macroTokenToFormatOpts(t.val),r=Bxe(i,e);return r==null||r.includes(void 0)?t:r}function zxe(t,e){return Array.prototype.concat(...t.map(i=>uHe(i,e)))}function Vxe(t,e,i){const r=zxe(Dl.parseFormat(i),t),s=r.map(o=>rHe(o,t)),n=s.find(o=>o.invalidReason);if(n)return{input:e,tokens:r,invalidReason:n.invalidReason};{const[o,a]=oHe(s),l=RegExp(o,"i"),[c,u]=aHe(e,l,a),[d,p,m]=u?lHe(u):[null,null,void 0];if(LM(u,"a")&&LM(u,"H"))throw new KE("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:r,regex:l,rawMatches:c,matches:u,result:d,zone:p,specificOffset:m}}}function hHe(t,e,i){const{result:r,zone:s,specificOffset:n,invalidReason:o}=Vxe(t,e,i);return[r,s,n,o]}function Bxe(t,e){if(!t)return null;const r=Dl.create(e,t).dtFormatter(cHe()),s=r.formatToParts(),n=r.resolvedOptions();return s.map(o=>nHe(o,t,n))}const a6="Invalid DateTime",tle=864e13;function mD(t){return new nf("unsupported zone",`the zone "${t.name}" is not supported`)}function l6(t){return t.weekData===null&&(t.weekData=kU(t.c)),t.weekData}function c6(t){return t.localWeekData===null&&(t.localWeekData=kU(t.c,t.loc.getMinDaysInFirstWeek(),t.loc.getStartOfWeek())),t.localWeekData}function Ob(t,e){const i={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new li({...i,...e,old:i})}function Gxe(t,e,i){let r=t-e*60*1e3;const s=i.offset(r);if(e===s)return[r,e];r-=(s-e)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function gD(t,e){t+=e*60*1e3;const i=new Date(t);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function N4(t,e,i){return Gxe(bB(t),e,i)}function ile(t,e){const i=t.o,r=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:r,month:s,day:Math.min(t.c.day,UU(r,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=Ir.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=bB(n);let[l,c]=Gxe(a,i,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function fP(t,e,i,r,s,n){const{setZone:o,zone:a}=i;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=li.fromObject(t,{...i,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return li.invalid(new nf("unparsable",`the input "${s}" can't be parsed as ${r}`))}function yD(t,e,i=!0){return t.isValid?Dl.create(ys.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(t,e):null}function u6(t,e){const i=t.c.year>9999||t.c.year<0;let r="";return i&&t.c.year>=0&&(r+="+"),r+=Mo(t.c.year,i?6:4),e?(r+="-",r+=Mo(t.c.month),r+="-",r+=Mo(t.c.day)):(r+=Mo(t.c.month),r+=Mo(t.c.day)),r}function rle(t,e,i,r,s,n){let o=Mo(t.c.hour);return e?(o+=":",o+=Mo(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=":")):o+=Mo(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=Mo(t.c.second),(t.c.millisecond!==0||!r)&&(o+=".",o+=Mo(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!n?o+="Z":t.o<0?(o+="-",o+=Mo(Math.trunc(-t.o/60)),o+=":",o+=Mo(Math.trunc(-t.o%60))):(o+="+",o+=Mo(Math.trunc(t.o/60)),o+=":",o+=Mo(Math.trunc(t.o%60)))),n&&(o+="["+t.zone.ianaName+"]"),o}const jxe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},dHe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},pHe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Hxe=["year","month","day","hour","minute","second","millisecond"],fHe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],mHe=["year","ordinal","hour","minute","second","millisecond"];function gHe(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new Wwe(t);return e}function sle(t){switch(t.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return gHe(t)}}function nle(t,e){const i=Dv(e.zone,no.defaultZone),r=ys.fromObject(e),s=no.now();let n,o;if(Ci(t.year))n=s;else{for(const c of Hxe)Ci(t[c])&&(t[c]=jxe[c]);const a=yxe(t)||_xe(t);if(a)return li.invalid(a);const l=i.offset(s);[n,o]=N4(t,l,i)}return new li({ts:n,zone:i,loc:r,o})}function ole(t,e,i){const r=Ci(i.round)?!0:i.round,s=(o,a)=>(o=$ee(o,r||i.calendary?0:2,!0),e.loc.clone(i).relFormatter(i).format(o,a)),n=o=>i.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(i.unit)return s(n(i.unit),i.unit);for(const o of i.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(t>e?-0:0,i.units[i.units.length-1])}function ale(t){let e={},i;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],i=Array.from(t).slice(0,t.length-1)):i=Array.from(t),[e,i]}class li{constructor(e){const i=e.zone||no.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new nf("invalid input"):null)||(i.isValid?null:mD(i));this.ts=Ci(e.ts)?no.now():e.ts;let s=null,n=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(i))[s,n]=[e.old.c,e.old.o];else{const a=i.offset(this.ts);s=gD(this.ts,a),r=Number.isNaN(s.year)?new nf("invalid input"):null,s=r?null:s,n=r?null:a}this._zone=i,this.loc=e.loc||ys.create(),this.invalid=r,this.weekData=null,this.localWeekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new li({})}static local(){const[e,i]=ale(arguments),[r,s,n,o,a,l,c]=i;return nle({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,i]=ale(arguments),[r,s,n,o,a,l,c]=i;return e.zone=Qa.utcInstance,nle({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,i={}){const r=H6e(e)?e.valueOf():NaN;if(Number.isNaN(r))return li.invalid("invalid input");const s=Dv(i.zone,no.defaultZone);return s.isValid?new li({ts:r,zone:s,loc:ys.fromObject(i)}):li.invalid(mD(s))}static fromMillis(e,i={}){if(hS(e))return e<-tle||e>tle?li.invalid("Timestamp out of range"):new li({ts:e,zone:Dv(i.zone,no.defaultZone),loc:ys.fromObject(i)});throw new ru(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,i={}){if(hS(e))return new li({ts:e*1e3,zone:Dv(i.zone,no.defaultZone),loc:ys.fromObject(i)});throw new ru("fromSeconds requires a numerical input")}static fromObject(e,i={}){e=e||{};const r=Dv(i.zone,no.defaultZone);if(!r.isValid)return li.invalid(mD(r));const s=ys.fromObject(i),n=zU(e,sle),{minDaysInFirstWeek:o,startOfWeek:a}=jae(n,s),l=no.now(),c=Ci(i.specificOffset)?r.offset(l):i.specificOffset,u=!Ci(n.ordinal),d=!Ci(n.year),p=!Ci(n.month)||!Ci(n.day),m=d||p,g=n.weekYear||n.weekNumber;if((m||u)&&g)throw new KE("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(p&&u)throw new KE("Can't mix ordinal dates with month/day");const y=g||n.weekday&&!m;let v,b,w=gD(l,c);y?(v=fHe,b=dHe,w=kU(w,o,a)):u?(v=mHe,b=pHe,w=n6(w)):(v=Hxe,b=jxe);let x=!1;for(const U of v){const H=n[U];Ci(H)?x?n[U]=b[U]:n[U]=w[U]:x=!0}const T=y?B6e(n,o,a):u?G6e(n):yxe(n),C=T||_xe(n);if(C)return li.invalid(C);const M=y?Bae(n,o,a):u?Gae(n):n,[O,D]=N4(M,c,r),k=new li({ts:O,zone:r,o:D,loc:s});return n.weekday&&m&&e.weekday!==k.weekday?li.invalid("mismatched weekday",`you can't specify both a weekday of ${n.weekday} and a date of ${k.toISO()}`):k}static fromISO(e,i={}){const[r,s]=L8e(e);return fP(r,s,i,"ISO 8601",e)}static fromRFC2822(e,i={}){const[r,s]=D8e(e);return fP(r,s,i,"RFC 2822",e)}static fromHTTP(e,i={}){const[r,s]=N8e(e);return fP(r,s,i,"HTTP",i)}static fromFormat(e,i,r={}){if(Ci(e)||Ci(i))throw new ru("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,o=ys.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,u]=hHe(o,e,i);return u?li.invalid(u):fP(a,l,r,`format ${i}`,e,c)}static fromString(e,i,r={}){return li.fromFormat(e,i,r)}static fromSQL(e,i={}){const[r,s]=G8e(e);return fP(r,s,i,"SQL",e)}static invalid(e,i=null){if(!e)throw new ru("need to specify a reason the DateTime is invalid");const r=e instanceof nf?e:new nf(e,i);if(no.throwOnInvalid)throw new _6e(r);return new li({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,i={}){const r=Bxe(e,ys.fromObject(i));return r?r.map(s=>s?s.val:null).join(""):null}static expandFormat(e,i={}){return zxe(Dl.parseFormat(e),ys.fromObject(i)).map(s=>s.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?l6(this).weekYear:NaN}get weekNumber(){return this.isValid?l6(this).weekNumber:NaN}get weekday(){return this.isValid?l6(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?c6(this).weekday:NaN}get localWeekNumber(){return this.isValid?c6(this).weekNumber:NaN}get localWeekYear(){return this.isValid?c6(this).weekYear:NaN}get ordinal(){return this.isValid?n6(this.c).ordinal:NaN}get monthShort(){return this.isValid?pD.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?pD.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?pD.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?pD.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,i=6e4,r=bB(this.c),s=this.zone.offset(r-e),n=this.zone.offset(r+e),o=this.zone.offset(r-s*i),a=this.zone.offset(r-n*i);if(o===a)return[this];const l=r-o*i,c=r-a*i,u=gD(l,o),d=gD(c,a);return u.hour===d.hour&&u.minute===d.minute&&u.second===d.second&&u.millisecond===d.millisecond?[Ob(this,{ts:l}),Ob(this,{ts:c})]:[this]}get isInLeapYear(){return K3(this.year)}get daysInMonth(){return UU(this.year,this.month)}get daysInYear(){return this.isValid?NC(this.year):NaN}get weeksInWeekYear(){return this.isValid?GI(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?GI(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:i,numberingSystem:r,calendar:s}=Dl.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(e=0,i={}){return this.setZone(Qa.instance(e),i)}toLocal(){return this.setZone(no.defaultZone)}setZone(e,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(e=Dv(e,no.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(i||r){const n=e.offset(this.ts),o=this.toObject();[s]=N4(o,n,e)}return Ob(this,{ts:s,zone:e})}else return li.invalid(mD(e))}reconfigure({locale:e,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:e,numberingSystem:i,outputCalendar:r});return Ob(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const i=zU(e,sle),{minDaysInFirstWeek:r,startOfWeek:s}=jae(i,this.loc),n=!Ci(i.weekYear)||!Ci(i.weekNumber)||!Ci(i.weekday),o=!Ci(i.ordinal),a=!Ci(i.year),l=!Ci(i.month)||!Ci(i.day),c=a||l,u=i.weekYear||i.weekNumber;if((c||o)&&u)throw new KE("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&o)throw new KE("Can't mix ordinal dates with month/day");let d;n?d=Bae({...kU(this.c,r,s),...i},r,s):Ci(i.ordinal)?(d={...this.toObject(),...i},Ci(i.day)&&(d.day=Math.min(UU(d.year,d.month),d.day))):d=Gae({...n6(this.c),...i});const[p,m]=N4(d,this.o,this.zone);return Ob(this,{ts:p,o:m})}plus(e){if(!this.isValid)return this;const i=Ir.fromDurationLike(e);return Ob(this,ile(this,i))}minus(e){if(!this.isValid)return this;const i=Ir.fromDurationLike(e).negate();return Ob(this,ile(this,i))}startOf(e,{useLocaleWeeks:i=!1}={}){if(!this.isValid)return this;const r={},s=Ir.normalizeUnit(e);switch(s){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(s==="weeks")if(i){const n=this.loc.getStartOfWeek(),{weekday:o}=this;o<n&&(r.weekNumber=this.weekNumber-1),r.weekday=n}else r.weekday=1;if(s==="quarters"){const n=Math.ceil(this.month/3);r.month=(n-1)*3+1}return this.set(r)}endOf(e,i){return this.isValid?this.plus({[e]:1}).startOf(e,i).minus(1):this}toFormat(e,i={}){return this.isValid?Dl.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,e):a6}toLocaleString(e=FU,i={}){return this.isValid?Dl.create(this.loc.clone(i),e).formatDateTime(this):a6}toLocaleParts(e={}){return this.isValid?Dl.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=u6(this,o);return a+="T",a+=rle(this,o,i,r,s,n),a}toISODate({format:e="extended"}={}){return this.isValid?u6(this,e==="extended"):null}toISOWeekDate(){return yD(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+rle(this,o==="extended",i,e,r,n):null}toRFC2822(){return yD(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return yD(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?u6(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||e)&&(r&&(s+=" "),i?s+="z":e&&(s+="ZZ")),yD(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():a6}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const i={...this.c};return e.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,i="milliseconds",r={}){if(!this.isValid||!e.isValid)return Ir.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...r},n=q6e(i).map(Ir.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=X8e(a,l,n,s);return o?c.negate():c}diffNow(e="milliseconds",i={}){return this.diff(li.now(),e,i)}until(e){return this.isValid?zn.fromDateTimes(this,e):this}hasSame(e,i,r){if(!this.isValid)return!1;const s=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(i,r)<=s&&s<=n.endOf(i,r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const i=e.base||li.fromObject({},{zone:this.zone}),r=e.padding?this<i?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),ole(i,this.plus(r),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?ole(e.base||li.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(li.isDateTime))throw new ru("min requires all arguments be DateTimes");return Hae(e,i=>i.valueOf(),Math.min)}static max(...e){if(!e.every(li.isDateTime))throw new ru("max requires all arguments be DateTimes");return Hae(e,i=>i.valueOf(),Math.max)}static fromFormatExplain(e,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,o=ys.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return Vxe(o,e,i)}static fromStringExplain(e,i,r={}){return li.fromFormatExplain(e,i,r)}static get DATE_SHORT(){return FU}static get DATE_MED(){return Ywe}static get DATE_MED_WITH_WEEKDAY(){return w6e}static get DATE_FULL(){return Zwe}static get DATE_HUGE(){return Xwe}static get TIME_SIMPLE(){return Jwe}static get TIME_WITH_SECONDS(){return Qwe}static get TIME_WITH_SHORT_OFFSET(){return Kwe}static get TIME_WITH_LONG_OFFSET(){return exe}static get TIME_24_SIMPLE(){return txe}static get TIME_24_WITH_SECONDS(){return ixe}static get TIME_24_WITH_SHORT_OFFSET(){return rxe}static get TIME_24_WITH_LONG_OFFSET(){return sxe}static get DATETIME_SHORT(){return nxe}static get DATETIME_SHORT_WITH_SECONDS(){return oxe}static get DATETIME_MED(){return axe}static get DATETIME_MED_WITH_SECONDS(){return lxe}static get DATETIME_MED_WITH_WEEKDAY(){return x6e}static get DATETIME_FULL(){return cxe}static get DATETIME_FULL_WITH_SECONDS(){return uxe}static get DATETIME_HUGE(){return hxe}static get DATETIME_HUGE_WITH_SECONDS(){return dxe}}function mP(t){if(li.isDateTime(t))return t;if(t&&t.valueOf&&hS(t.valueOf()))return li.fromJSDate(t);if(t&&typeof t=="object")return li.fromObject(t);throw new ru(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const xg="system",GS="unknown",P1="UTC",yHe=Intl.DateTimeFormat().resolvedOptions().timeZone,_He="shortOffset";function vHe(t){return"timeZoneIANA"in t}function bHe(t){return t.startsWith("UTC")}function VU(t,e=!1){return{json:{read:{source:t,reader:(i,r)=>r[t]?F4(r[t]):null},write:!!e&&{allowNull:!0,writer(i,r){r[t]=i?wHe(i):null}}}}}function F4(t,e=xg){return t?vHe(t)?t.timeZoneIANA:xHe(t,e):e}function wHe(t){return{timeZoneIANA:t}}function xHe(t,e=xg){if(!t||!Rae.has(t.timeZone))return e;const i=Rae.get(t.timeZone);return bHe(t.timeZone)||t.respectsDaylightSaving?i:SHe(i)}function SHe(t){const e=li.local().setZone(t),i=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${Qa.instance(-i).formatOffset(0,"narrow")}`}function NVt(t,e,i,r,s){if(e&&s==="date")return{timeZone:P1,timeZoneName:void 0};const n=r.timeStyle||r.hour,o=i===GS;return{timeZone:o?s==="timestamp-offset"?void 0:t??P1:i,timeZoneName:o&&n?_He:void 0}}const THe={year:void 0,month:void 0,day:void 0,weekday:void 0},EHe={hour:void 0,minute:void 0,second:void 0},qxe={timeZone:P1},Bf={year:"numeric",month:"numeric",day:"numeric"},gP={year:"numeric",month:"long",day:"numeric"},yP={year:"numeric",month:"short",day:"numeric"},_P={year:"numeric",month:"long",weekday:"long",day:"numeric"},Sv={hour:"numeric",minute:"numeric"},_w={...Sv,second:"numeric"},Wxe={hourCycle:"h23"},vP={...Sv,...Wxe},bP={..._w,...Wxe},Yxe={"short-date":Bf,"short-date-short-time":{...Bf,...Sv},"short-date-short-time-24":{...Bf,...vP},"short-date-long-time":{...Bf,..._w},"short-date-long-time-24":{...Bf,...bP},"short-date-le":Bf,"short-date-le-short-time":{...Bf,...Sv},"short-date-le-short-time-24":{...Bf,...vP},"short-date-le-long-time":{...Bf,..._w},"short-date-le-long-time-24":{...Bf,...bP},"long-month-day-year":gP,"long-month-day-year-short-time":{...gP,...Sv},"long-month-day-year-short-time-24":{...gP,...vP},"long-month-day-year-long-time":{...gP,..._w},"long-month-day-year-long-time-24":{...gP,...bP},"day-short-month-year":yP,"day-short-month-year-short-time":{...yP,...Sv},"day-short-month-year-short-time-24":{...yP,...vP},"day-short-month-year-long-time":{...yP,..._w},"day-short-month-year-long-time-24":{...yP,...bP},"long-date":_P,"long-date-short-time":{..._P,...Sv},"long-date-short-time-24":{..._P,...vP},"long-date-long-time":{..._P,..._w},"long-date-long-time-24":{..._P,...bP},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Sv,"long-time":_w},CHe=Bl()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),Zxe={ar:"ar-u-nu-latn-ca-gregory"};let b7=new WeakMap;const SB=Yxe["short-date-short-time"];function MHe(t){let e=b7.get(t);if(!e){const i=fu(),r=Zxe[i]||i,s=Fee(t.timeZone??xg),n={...t,timeZone:s};e=new Intl.DateTimeFormat(r,n),b7.set(t,e)}return e}function AHe(t){return Yxe[t]}function TB(t,e=SB){return MHe(e).format(t)}function FVt(t,e=SB){return TB(new Date(t),{...e,...qxe,...EHe})}function kVt(t,e=SB){return TB(new Date(`1970-01-01T${t}Z`),{...e,...qxe,...THe})}function UVt(t,e=SB){if(e.timeZone)return TB(new Date(t),e);const i=li.fromISO(t,{setZone:!0}),r=fu(),s=Zxe[r]??r,n=i.offset===0?P1:e.timeZone,o={...e,timeZone:n};return i.toLocaleString(o,{locale:s})}function Fee(t){switch(t){case xg:return yHe;case GS:return P1;default:return t}}Aee(()=>{b7=new WeakMap});const PHe={ar:"ar-u-nu-latn"};let k4=new WeakMap,Xxe={};function w7(t){const e=t||Xxe;if(!k4.has(e)){const i=fu(),r=PHe[fu()]||i;k4.set(e,new Intl.NumberFormat(r,t))}return k4.get(e)}function zVt(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function OHe(t,e){return Object.is(t,-0)&&(t=0),w7(e).format(t)}function VVt(t,e=fu()){var r,s;if(!t)return null;let i=lle.get(e);if(!i){const n=w7().formatToParts(12345.6),o=[...w7({useGrouping:!1}).format(9876543210)].reverse(),a=new Map(o.map((m,g)=>[m,g])),l=new RegExp(`[${(r=n.find(m=>m.type==="group"))==null?void 0:r.value}]`,"g"),c=new RegExp(`[${(s=n.find(m=>m.type==="decimal"))==null?void 0:s.value}]`),u=new RegExp(`[${o.join("")}]`,"g"),d=/[\u200E\u200F\u202A\u202B\u202C\u202D\u202E\u2066\u2067\u2068\u2069\u061C]/g,p=/[-\u2212\u2013\u2014\u2015]/g;i=m=>{if((m=m.trim().replaceAll(l,"").replace(c,".").replace(u,y=>String(a.get(y))).replaceAll(d,"").replaceAll(p,"-"))==="")return null;const g=Number(m);return isNaN(g)?null:g},lle.set(e,i)}return i(t)}Aee(()=>{k4=new WeakMap,Xxe={}});const lle=new Map,cle=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,RHe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function ule(t){return t in RHe}const TO=[],kC=new Map;function hle(t){for(const e of kC.keys())Qxe(t.pattern,e)&&kC.delete(e)}function $He(t){return TO.includes(t)||(hle(t),TO.unshift(t)),Ni(()=>{const e=TO.indexOf(t);e>-1&&(TO.splice(e,1),hle(t))})}async function Jxe(t){const e=fu();kC.has(t)||kC.set(t,LHe(t,e));const i=kC.get(t);return i&&await DHe.add(i),i}function IHe(t){if(!cle.test(t))return null;const e=cle.exec(t);if(e===null)return null;const[,i,r]=e,s=i+(r?"-"+r.toUpperCase():"");return ule(s)?s:ule(i)?i:null}async function LHe(t,e){const i=[];for(const r of TO)if(Qxe(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(s){i.push(s)}throw i.length?new V("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:i}):new V("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function Qxe(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}Aee(()=>{kC.clear()});const DHe=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=ra())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function NHe(t,e,i,r){const s=e.exec(i);if(!s)throw new V("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=IHe(r),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let u;try{u=await dle(t(c))}catch(d){if(c===l)throw new V("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:d});try{u=await dle(t(l))}catch(p){throw new V("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:p})}}return u}async function dle(t){if(ple.fetchBundleAsset!=null)return ple.fetchBundleAsset(t);const e=await Yt(t,{responseType:"text"});return JSON.parse(e.data)}let FHe=class{constructor({base:e="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)\\/)?(.*)$`)}fetchMessageBundle(e,i){return NHe(this.getAssetUrl,this.matcher,e,i)}};function kHe(t){return new FHe(t)}const ple={};$He(kHe({pattern:"esri/",location:mr}));const fle={};function UHe(t){var i;const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:((i=t.packages)==null?void 0:i.concat())||[],paths:{...fle.paths,...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=fle.baseUrl),e}let zHe=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>e[i](...r)})}},U4=class{constructor(){this._dispatcher=new zHe,this._workerPostMessage({type:va.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){bM(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,i,r){this._dispatcher.addEventListener(e,i,r)}removeEventListener(e,i,r){this._dispatcher.removeEventListener(e,i,r)}_workerPostMessage(e){bM(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const i=BI(e);if(i&&i.type===va.OPEN){const{modulePath:r,jobId:s}=i;let n=await A1.loadWorker(r);n||(n=await import(r));const o=A1.connect(n);this._workerPostMessage({type:va.OPENED,jobId:s,data:o})}}};const x7=()=>ie.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:VHe}=va,BHe='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let _D,vD;const mle="Failed to create Worker. Fallback to execute module in main thread";async function GHe(){if(!re("esri-workers"))return gle(new U4);if(!_D&&!vD)try{const e=BHe.split("{CONFIGURATION}").join(jHe());_D=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){vD=e||{}}let t;if(_D)try{t=new Worker(_D,{name:"esri-worker-"+HHe++})}catch{x7().warn(mle,vD),t=new U4}else x7().warn(mle,vD),t=new U4;return gle(t)}async function gle(t){return new Promise(e=>{function i(s){const n=BI(s);n&&n.type===VHe&&(t.removeEventListener("message",i),t.removeEventListener("error",r),e(t))}function r(s){s.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",r),x7().warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new U4).addEventListener("message",i),t.addEventListener("error",r)}t.addEventListener("message",i),t.addEventListener("error",r)})}function jHe(){let t;if(lr.default!=null){const s={...lr};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(lr));t.assetsPath=uh(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?uh(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=fu(),t.has={"esri-csp-restrictions":re("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":re("esri-2d-update-debug"),"esri-2d-log-updating":re("esri-2d-log-updating"),"featurelayer-pbf":re("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":re("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":re("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":re("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":re("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":re("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":re("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":re("featurelayer-snapshot-enabled"),"esri-atomics":re("esri-atomics"),"esri-shared-array-buffer":re("esri-shared-array-buffer"),"esri-tiles-debug":re("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":re("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":re("feature-polyline-generalization-factor"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=uh(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=uh(t.workers.workerPath):t.workers.workerPath=uh(mr("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=lr.workers.loaderConfig,i=UHe({baseUrl:e==null?void 0:e.baseUrl,locale:fu(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:i,kernelInfo:{buildDate:Dbe,fullVersion:dee,revision:Nbe}})}let HHe=0;const{ABORT:yle,INVOKE:qHe,OPEN:WHe,OPENED:YHe,RESPONSE:wP}=va;let ZHe=class Kxe{static async create(e){const i=await GHe();return new Kxe(i,e)}constructor(e,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=i,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",r=>{r.preventDefault(),ie.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(e,i={}){const{signal:r}=i,s=jwe();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:QV(r,()=>{this._outJobs.delete(s),this._post({type:yle,jobId:s})})};this._outJobs.set(s,a),this._post({type:WHe,jobId:s,modulePath:e})})}_onMessage(e){const i=BI(e);if(i)switch(i.type){case YHe:this._onOpenedMessage(i);break;case wP:this._onResponseMessage(i);break;case yle:this._onAbortMessage(i);break;case qHe:this._onInvokeMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=f6e[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(u){return void this._post({type:wP,jobId:r,error:VI(u)})}Cu(c)?(a.set(r,{controller:o,promise:c}),c.then(u=>{a.has(r)&&(a.delete(r),this._post({type:wP,jobId:r},u))},u=>{a.has(r)&&(a.delete(r),u||(u={message:"Error encountered at method"+i}),ms(u)||this._post({type:wP,jobId:r,error:VI(u||{message:`Error encountered at method ${i}`})}))})):this._post({type:wP,jobId:r},c)}_onOpenedMessage(e){const{jobId:i,data:r}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),Or(s.abortHandle),s.resolve(r))}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),Or(n.abortHandle),r?n.reject(V.fromJSON(JSON.parse(r))):n.resolve(s))}_post(e,i,r){return Mee(this.worker,e,i,r)}};const _le=re("host-browser")?Math.min(navigator.hardwareConcurrency-1,re("workers-pool-size")):0;let jx=re("esri-mobile")?Math.min(_le,3):_le;jx||(jx=re("safari")&&re("mac")?7:2);let vle=0;const z4=[];function XHe(){eSe()}async function bD(t,e){const i=new p6e,{registryTarget:r,...s}=e;return await i.open(t,s),r&&r6e(r,i),i}async function JHe(t,e={}){if(typeof t!="string")throw new V("workers:undefined-module","modulePath is missing");let i=e.strategy||"distributed";if(re("host-webworker")&&!re("esri-workers")&&(i="local"),i==="local"){let r=await A1.loadWorker(t);r||(r=await import(t)),Et(e.signal);const s=e.client||r;return bD([A1.connect(r,e.schedule)],{...e,client:s})}if(await eSe(),Et(e.signal),i==="dedicated"){const r=vle++%jx;return bD([await z4[r].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const r=Math.min(e.maxNumWorkers,jx);if(r<jx){const s=new Array(r);for(let n=0;n<r;++n){const o=vle++%jx;s[n]=z4[o].open(t,e)}return bD(s,e)}}return bD(z4.map(r=>r.open(t,e)),e)}let wD=null;async function eSe(){if(wD)return wD;new AbortController;const t=[];for(let e=0;e<jx;e++){const i=ZHe.create(e).then(r=>(z4[e]=r,r));t.push(i)}return wD=Promise.all(t),wD}function tSe(t,e){const i=tl(t),r=tl(e),s=i.store,n=r.store,o=r.metadata;for(const a in o){const l=o[a],c=s.originOf(a),u=n.originOf(a);if(!l.readOnly&&u!==Ii.DEFAULTS)if(c===Ii.DEFAULTS)t.set(a,n.get(a));else{const d=s.get(a),p=n.get(a);d&&p&&p instanceof Re&&d instanceof Re&&d instanceof p.constructor&&tSe(d,p)}}}function O1(t,e,i=tt){return e||(e=new i),e===t||(e.removeAll(),QHe(t)?e.addMany(t):t&&e.add(t)),e}function iSe(t){return t}function QHe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}let D$=class extends tt{constructor(e){super(e),this.addHandles([this.on("before-add",i=>{i.item==null&&i.preventDefault()}),this.on("after-add",i=>this._own(i.item)),this.on("after-remove",i=>this._release(i.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(tt.ofType(this.itemType.Type))(e):new tt(e)}};function BU(t,e){return{type:t,cast:iSe,set(i){const r=O1(i,this._get(e),t);r.owner=this,this._set(e,r)}}}h([f()],D$.prototype,"owner",null),D$=h([I("esri.core.support.OwningCollection")],D$);var EO;const GU=Bl()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),rSe=GU.jsonValues.slice();PI(rSe,"orthometric");const N$=Bl()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let vp=EO=class extends ye{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,i){return GU.write(t,e,i)}readHeightModel(t,e,i){return GU.read(t)||(i!=null&&i.messages&&i.messages.push(KHe(t,{context:i})),null)}readHeightUnit(t,e,i){return N$.read(t)||(i!=null&&i.messages&&i.messages.push(ble(t,{context:i})),null)}readHeightUnitService(t,e,i){return Qbe(t)||N$.read(t)||(i!=null&&i.messages&&i.messages.push(ble(t,{context:i})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new EO({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const i=Kbe(e);return new EO({heightModel:t.heightModel,heightUnit:i??void 0,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new EO;return e.read(t,{origin:"web-scene"}),e}};function ble(t,e){return new Sf("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function KHe(t,e){return new Sf("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}h([f({type:GU.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:rSe,default:"ellipsoidal"}}}})],vp.prototype,"heightModel",void 0),h([Ve("web-scene","heightModel")],vp.prototype,"writeHeightModel",null),h([Ce(["web-scene","service"],"heightModel")],vp.prototype,"readHeightModel",null),h([f({type:N$.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:N$.jsonValues,write:N$.write}}}})],vp.prototype,"heightUnit",void 0),h([Ce("web-scene","heightUnit")],vp.prototype,"readHeightUnit",null),h([Ce("service","heightUnit")],vp.prototype,"readHeightUnitService",null),h([f({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],vp.prototype,"vertCRS",void 0),h([Ce("service","vertCRS",["vertCRS","ellipsoid","geoid"])],vp.prototype,"readVertCRS",null),vp=EO=h([I("esri.geometry.HeightModelInfo")],vp);const gT=vp,qVt=Math.PI/180,WVt=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,h_=ir.radius,op=ir.eccentricitySquared,eqe={a1:h_*op,a2:h_*op*h_*op,a3:h_*op*op/2,a4:h_*op*h_*op*2.5,a5:h_*op+h_*op*op/2,a6:1-op},YVt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:ir.radius,f:ir.flattening},4490:{a:6378137,f:1/298.257222101},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:x0.radius,f:x0.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:gf.radius,f:gf.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:gf.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};var se;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.SPHERICAL_MARS_PCPF=6]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=7]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=8]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=9]="GCSMOON2000",t[t.LON_LAT=10]="LON_LAT",t[t.PLATE_CARREE=11]="PLATE_CARREE"})(se||(se={}));const CO={[se.WGS84]:{[se.CGCS2000]:Ps,[se.GCSMARS2000]:null,[se.GCSMOON2000]:null,[se.LON_LAT]:Ps,[se.SPHERICAL_ECEF]:VC,[se.SPHERICAL_MARS_PCPF]:null,[se.SPHERICAL_MOON_PCPF]:null,[se.UNKNOWN]:null,[se.WEB_MERCATOR]:dS,[se.PLATE_CARREE]:pS,[se.WGS84]:Ps,[se.WGS84_ECEF]:mS},[se.CGCS2000]:{[se.CGCS2000]:Ps,[se.GCSMARS2000]:null,[se.GCSMOON2000]:null,[se.LON_LAT]:Ps,[se.SPHERICAL_ECEF]:VC,[se.SPHERICAL_MARS_PCPF]:null,[se.SPHERICAL_MOON_PCPF]:null,[se.UNKNOWN]:null,[se.WEB_MERCATOR]:dS,[se.PLATE_CARREE]:pS,[se.WGS84]:Ps,[se.WGS84_ECEF]:mS},[se.GCSMARS2000]:{[se.CGCS2000]:null,[se.GCSMARS2000]:Ps,[se.GCSMOON2000]:null,[se.LON_LAT]:Ps,[se.SPHERICAL_ECEF]:null,[se.SPHERICAL_MARS_PCPF]:T7,[se.SPHERICAL_MOON_PCPF]:null,[se.UNKNOWN]:null,[se.WEB_MERCATOR]:null,[se.PLATE_CARREE]:null,[se.WGS84]:null,[se.WGS84_ECEF]:null},[se.GCSMOON2000]:{[se.CGCS2000]:null,[se.GCSMARS2000]:null,[se.GCSMOON2000]:Ps,[se.LON_LAT]:Ps,[se.SPHERICAL_ECEF]:null,[se.SPHERICAL_MARS_PCPF]:null,[se.SPHERICAL_MOON_PCPF]:S7,[se.UNKNOWN]:null,[se.WEB_MERCATOR]:null,[se.PLATE_CARREE]:null,[se.WGS84]:null,[se.WGS84_ECEF]:null},[se.WEB_MERCATOR]:{[se.CGCS2000]:UC,[se.GCSMARS2000]:null,[se.GCSMOON2000]:null,[se.LON_LAT]:UC,[se.SPHERICAL_ECEF]:sSe,[se.SPHERICAL_MARS_PCPF]:null,[se.SPHERICAL_MOON_PCPF]:null,[se.UNKNOWN]:null,[se.WEB_MERCATOR]:Ps,[se.PLATE_CARREE]:oSe,[se.WGS84]:UC,[se.WGS84_ECEF]:nSe},[se.WGS84_ECEF]:{[se.CGCS2000]:gS,[se.GCSMARS2000]:null,[se.GCSMOON2000]:null,[se.LON_LAT]:gS,[se.SPHERICAL_ECEF]:cSe,[se.SPHERICAL_MARS_PCPF]:null,[se.SPHERICAL_MOON_PCPF]:null,[se.UNKNOWN]:null,[se.WEB_MERCATOR]:uSe,[se.PLATE_CARREE]:tqe,[se.WGS84]:gS,[se.WGS84_ECEF]:Ps},[se.SPHERICAL_ECEF]:{[se.CGCS2000]:fS,[se.GCSMARS2000]:null,[se.GCSMOON2000]:null,[se.LON_LAT]:fS,[se.SPHERICAL_ECEF]:Ps,[se.SPHERICAL_MARS_PCPF]:null,[se.SPHERICAL_MOON_PCPF]:null,[se.UNKNOWN]:null,[se.WEB_MERCATOR]:aSe,[se.PLATE_CARREE]:iqe,[se.WGS84]:fS,[se.WGS84_ECEF]:lSe},[se.SPHERICAL_MARS_PCPF]:{[se.CGCS2000]:null,[se.GCSMARS2000]:C7,[se.GCSMOON2000]:null,[se.LON_LAT]:C7,[se.SPHERICAL_ECEF]:null,[se.SPHERICAL_MARS_PCPF]:Ps,[se.SPHERICAL_MOON_PCPF]:null,[se.UNKNOWN]:null,[se.WEB_MERCATOR]:null,[se.PLATE_CARREE]:null,[se.WGS84]:null,[se.WGS84_ECEF]:null},[se.SPHERICAL_MOON_PCPF]:{[se.CGCS2000]:null,[se.GCSMARS2000]:null,[se.GCSMOON2000]:E7,[se.LON_LAT]:E7,[se.SPHERICAL_ECEF]:null,[se.SPHERICAL_MARS_PCPF]:null,[se.SPHERICAL_MOON_PCPF]:Ps,[se.UNKNOWN]:null,[se.WEB_MERCATOR]:null,[se.PLATE_CARREE]:null,[se.WGS84]:null,[se.WGS84_ECEF]:null},[se.UNKNOWN]:{[se.CGCS2000]:null,[se.GCSMARS2000]:null,[se.GCSMOON2000]:null,[se.LON_LAT]:null,[se.SPHERICAL_ECEF]:null,[se.SPHERICAL_MARS_PCPF]:null,[se.SPHERICAL_MOON_PCPF]:null,[se.UNKNOWN]:Ps,[se.WEB_MERCATOR]:null,[se.PLATE_CARREE]:null,[se.WGS84]:null,[se.WGS84_ECEF]:null},[se.LON_LAT]:{[se.CGCS2000]:Ps,[se.GCSMARS2000]:Ps,[se.GCSMOON2000]:Ps,[se.LON_LAT]:Ps,[se.SPHERICAL_ECEF]:VC,[se.SPHERICAL_MARS_PCPF]:T7,[se.SPHERICAL_MOON_PCPF]:S7,[se.UNKNOWN]:null,[se.WEB_MERCATOR]:dS,[se.PLATE_CARREE]:pS,[se.WGS84]:Ps,[se.WGS84_ECEF]:mS},[se.PLATE_CARREE]:{[se.CGCS2000]:zC,[se.GCSMARS2000]:null,[se.GCSMOON2000]:null,[se.LON_LAT]:zC,[se.SPHERICAL_ECEF]:rqe,[se.SPHERICAL_MARS_PCPF]:null,[se.SPHERICAL_MOON_PCPF]:null,[se.UNKNOWN]:null,[se.WEB_MERCATOR]:sqe,[se.PLATE_CARREE]:Ps,[se.WGS84]:zC,[se.WGS84_ECEF]:nqe}};function R1(t,e,i=Vee()){return t==null||e==null?null:aqe(t,e,i).projector}function ZVt(t,e){switch(R1(t,e,EB)){case Ps:return"copy3";case VC:return"wgs84ToSphericalECEF";case dS:return"wgs84ToWebMercator";case pS:return"wgs84ToPlateCarree";case mS:return"wgs84ToWGS84ECEF";case UC:return"webMercatorToWGS84";case sSe:return"webMercatorToSphericalECEF";case nSe:return"webMercatorToWGS84ECEF";case oSe:return"webMercatorToPlateCarree";case gS:return"wgs84ECEFToWGS84";case cSe:return"wgs84ECEFToSphericalECEF";case uSe:return"wgs84ECEFToWebMercator";case fS:return"sphericalECEFToWGS84";case aSe:return"sphericalECEFToWebMercator";case C7:return"sphericalMarsPCPFToMars2000";case E7:return"sphericalMoonPCPFToMoon2000";case lSe:return"sphericalECEFToWGS84ECEF";case T7:return"mars2000ToSphericalPCPF";case S7:return"moon2000ToSphericalPCPF";default:return null}}function jU(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=Gl(t,1)),kI(t)?e.spatialReferenceId=se.SPHERICAL_ECEF:S0(t)?e.spatialReferenceId=se.WGS84:Ef(t)?e.spatialReferenceId=se.WEB_MERCATOR:NS(t)?e.spatialReferenceId=se.PLATE_CARREE:t.wkt===Ybe.wkt?e.spatialReferenceId=se.WGS84_ECEF:t.wkid===au.CGCS2000?e.spatialReferenceId=se.CGCS2000:t.wkt===cB.wkt?e.spatialReferenceId=se.SPHERICAL_MARS_PCPF:t.wkt===uB.wkt?e.spatialReferenceId=se.SPHERICAL_MOON_PCPF:dT(t)?e.spatialReferenceId=se.GCSMARS2000:pT(t)?e.spatialReferenceId=se.GCSMOON2000:e.spatialReferenceId=se.UNKNOWN):se.UNKNOWN}function Ps(t,e,i,r){t!==i&&(i[r++]=t[e++],i[r++]=t[e++],i[r]=t[e])}function UC(t,e,i,r){i[r]=NM*(t[e]/yS),i[r+1]=NM*(hSe-2*Math.atan(Math.exp(-t[e+1]/yS))),i[r+2]=t[e+2]}function sSe(t,e,i,r){const s=t[e]/yS,n=hSe-2*Math.atan(Math.exp(-t[e+1]/yS)),o=yS+t[e+2],a=Math.cos(n)*o;i[r]=Math.cos(s)*a,i[r+1]=Math.sin(s)*a,i[r+2]=Math.sin(n)*o}function nSe(t,e,i,r){UC(t,e,i,r),mS(i,r,i,r)}function kee(t,e,i,r,s){const n=.4999999*CB,o=Te(DM*t[e+1],-n,n),a=Math.sin(o);i[r++]=DM*t[e]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=t[e+2]}function dS(t,e,i,r){kee(t,e,i,r,ir)}function pS(t,e,i,r){i[r]=t[e]*wle,i[r+1]=t[e+1]*wle,i[r+2]=t[e+2]}function zC(t,e,i,r){i[r]=t[e]*xle,i[r+1]=t[e+1]*xle,i[r+2]=t[e+2]}function oSe(t,e,i,r){UC(t,e,i,r),pS(i,r,i,r)}function tqe(t,e,i,r){gS(t,e,i,r),pS(i,r,i,r)}function iqe(t,e,i,r){fS(t,e,i,r),pS(i,r,i,r)}function rqe(t,e,i,r){zC(t,e,i,r),VC(i,r,i,r)}function sqe(t,e,i,r){zC(t,e,i,r),dS(i,r,i,r)}function nqe(t,e,i,r){zC(t,e,i,r),mS(i,r,i,r)}function Uee(t,e,i,r,s){const n=s+t[e+2],o=DM*t[e+1],a=DM*t[e],l=Math.cos(o)*n;i[r]=Math.cos(a)*l,i[r+1]=Math.sin(a)*l,i[r+2]=Math.sin(o)*n}function S7(t,e,i,r){Uee(t,e,i,r,x0.radius)}function T7(t,e,i,r){Uee(t,e,i,r,gf.radius)}function VC(t,e,i,r){Uee(t,e,i,r,ir.radius)}function zee(t,e,i,r,s){const n=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(n*n+o*o+a*a),c=Tf(a/(l===0?1:l)),u=Math.atan2(o,n);i[r++]=NM*u,i[r++]=NM*c,i[r]=l-s}function E7(t,e,i,r){zee(t,e,i,r,x0.radius)}function C7(t,e,i,r){zee(t,e,i,r,gf.radius)}function fS(t,e,i,r){zee(t,e,i,r,ir.radius)}function aSe(t,e,i,r){fS(t,e,i,r),dS(i,r,i,r)}function lSe(t,e,i,r){fS(t,e,i,r),mS(i,r,i,r)}function oqe(t,e,i,r,s){const n=DM*t[e],o=DM*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),u=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(u+a)*c*Math.cos(n),i[r++]=(u+a)*c*Math.sin(n),i[r++]=(u*(1-s.eccentricitySquared)+a)*l}function mS(t,e,i,r){oqe(t,e,i,r,ir)}function gS(t,e,i,r){const s=eqe,n=t[e],o=t[e+1],a=t[e+2];let l,c,u,d,p,m,g,y,v,b,w,x,T,C,M,O,D,k,U,H,z;l=Math.abs(a),c=n*n+o*o,u=Math.sqrt(c),d=c+a*a,p=Math.sqrt(d),H=Math.atan2(o,n),m=a*a/d,g=c/d,C=s.a2/p,M=s.a3-s.a4/p,g>.3?(y=l/p*(1+g*(s.a1+C+m*M)/p),U=Math.asin(y),b=y*y,v=Math.sqrt(1-b)):(v=u/p*(1-m*(s.a5-C-g*M)/p),U=Math.acos(v),b=1-v*v,y=Math.sqrt(b)),w=1-ir.eccentricitySquared*b,x=ir.radius/Math.sqrt(w),T=s.a6*x,C=u-x*v,M=l-T*y,D=v*C+y*M,O=v*M-y*C,k=O/(T/w+D),U+=k,z=D+O*k/2,a<0&&(U=-U),i[r++]=NM*H,i[r++]=NM*U,i[r]=z}function cSe(t,e,i,r){gS(t,e,i,r),VC(i,r,i,r)}function uSe(t,e,i,r){gS(t,e,i,r),dS(i,r,i,r)}function aqe(t,e,i){if(t==null||e==null||i.source.spatialReference===t&&i.dest.spatialReference===e)return i;const r=jU(t,i.source),s=jU(e,i.dest);return r===se.UNKNOWN&&s===se.UNKNOWN?gs(t,e)?i.projector=Ps:i.projector=null:i.projector=CO[r][s],i}function Vee(){return{source:{spatialReference:null,spatialReferenceId:se.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:se.UNKNOWN,metersPerUnit:1},projector:Ps}}const lqe={spatialReference:null,spatialReferenceId:se.UNKNOWN},cqe={spatialReference:null,spatialReferenceId:se.UNKNOWN},EB=Vee(),DM=Rt(1),NM=Ma(1),CB=Math.PI,hSe=.5*CB,yS=ir.radius,wle=yS*CB/180,xle=180/(yS*CB);function ns(t,e,i,r,s,n,o=1){const a=R1(e,s,EB);if(a==null)return!1;if(a===Ps){if(t===r&&i===n)return!0;const c=i+3*o;for(let u=i,d=n;u<c;u++,d++)r[d]=t[u];return!0}const l=i+3*o;for(let c=i,u=n;c<l;c+=3,u+=3)a(t,c,r,u);return!0}const XVt=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:ns},Symbol.toStringTag,{value:"Module"}));function Sle(t,e,i,r,s,n){return xD[0]=t,xD[1]=e,xD[2]=i,ns(xD,r,0,s,n,0,1)}const xD=E();let SD=0,h6=class M7{static fromGE(e){const i=new M7;return i._wkt=e.wkt,i._wkid=e.wkid,i._isInverse=e.isInverse,i}constructor(e){this.uid=SD++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=SD++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=SD++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=SD++}getInverse(){const e=new M7;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},HU=class MO{static cacheKey(e,i){var r,s,n,o,a,l;return[((r=e.wkid)==null?void 0:r.toString())??"-1",((s=e.wkt)==null?void 0:s.toString())??"",((n=e.wkt2)==null?void 0:n.toString())??"",((o=i.wkid)==null?void 0:o.toString())??"-1",((a=i.wkt)==null?void 0:a.toString())??"",((l=i.wkt2)==null?void 0:l.toString())??""].join()}static fromGE(e){const i=new MO;let r="";for(const s of e.steps){const n=h6.fromGE(s);i.steps.push(n),r+=n.uid.toString()+","}return i._cachedProjection={},i._gtlistentry=null,i._chain=r,i}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e==null?void 0:e.steps)for(const i of e.steps)i instanceof h6?this.steps.push(i):this.steps.push(new h6({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}getInverse(){const e=new MO;e.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];e.steps.push(r.getInverse())}return e}getGTListEntry(){let e="";for(const i of this.steps)e+=i.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,i,r){this._cachedProjection[MO.cacheKey(e,i)]=r}getCachedGeTransformation(e,i){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=r);const s=this._cachedProjection[MO.cacheKey(e,i)];return s===void 0?null:s}};function dSe(t,e,i){if(e==null||i==null||i.vcsWkid||gs(e,i)||E1(e)||E1(i))return null;const r=kS(e)/kS(i);if(r===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>uqe(s,r);case"polyline":case"esriGeometryPolyline":return s=>dqe(s,r);case"polygon":case"esriGeometryPolygon":return s=>hqe(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>pqe(s,r);case"extent":case"esriGeometryEnvelope":return s=>fqe(s,r);default:return null}}function uqe(t,e){(t==null?void 0:t.z)!=null&&(t.z*=e)}function hqe(t,e){if(t)for(const i of t.rings)for(const r of i)r.length>2&&(r[2]*=e)}function dqe(t,e){if(t)for(const i of t.paths)for(const r of i)r.length>2&&(r[2]*=e)}function pqe(t,e){if(t)for(const i of t.points)i.length>2&&(i[2]*=e)}function fqe(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let yf=null,$1=null,F$=null,V4={};const Bee=new Q3;function kA(){return!!yf&&Vbe()}function pSe(){return!!kA()||(zt(Bee),FM(),!1)}function J2(t,e){return!t||!e||Ac(t,e)||pSe()}function fSe(t,e){return!Ac(t,e)&&!kA()}function FM(t){return F$==null&&(F$=Promise.all([Bbe(),fe(()=>import("./geometryEngineBase-CQNXzLBl.js"),[]).then(e=>e.g),fe(()=>import("./hydrated-SVSEWf7d.js"),[])])),F$.then(([,e,{hydratedAdapter:i}])=>{Et(t),$1=i,yf=e.default,yf._enableProjection(xGe),Bee.notify()})}function ib(t,e,i=null,r=null){return Array.isArray(t)?t.length===0?[]:A7($1,t,t[0].spatialReference,e,i,r):A7($1,[t],t.spatialReference,e,i,r)[0]}function A7(t,e,i,r,s=null,n=null){if(i==null||r==null)return e;if(Ac(i,r,s))return e.map(o=>k$(o,i,r));if(s==null&&kI(i))return e.map(o=>k$(o,i,We.WGS84)).map(o=>I1(o,r));if(s==null&&kI(r))return e.map(o=>I1(o,We.WGS84)).map(o=>k$(o,We.WGS84,r));if(s==null){const o=HU.cacheKey(i,r);V4[o]!==void 0?s=V4[o]:((s=gSe(i,r,void 0))==null&&(s=new HU),V4[o]=s)}if(yf==null||t==null)throw new MB;return n!=null?yf._project(t,e,i,r,s,n):yf._project(t,e,i,r,s)}function mqe(t,e){const i=mSe([t],e);return i.pending!=null?{pending:i.pending,geometry:null}:i.geometries!=null?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function mSe(t,e){if(!kA()){for(const i of t)if(i!=null&&!gs(i.spatialReference,e)&&sf(i.spatialReference)&&sf(e)&&!Ac(i.spatialReference,e))return zt(Bee),{pending:FM(),geometries:null}}return{pending:null,geometries:t.map(i=>i==null?null:gs(i.spatialReference,e)?i:sf(i.spatialReference)&&sf(e)?I1(i,e):null)}}function gSe(t,e,i=null){if(t==null||e==null)return null;if(yf==null||$1==null)throw new MB;const r=yf._getTransformation($1,t,e,i,i==null?void 0:i.spatialReference);return r!==null?HU.fromGE(r):null}function gqe(t,e,i=null){if(yf==null||$1==null)throw new MB;const r=yf._getTransformationBySuitability($1,t,e,i,i==null?void 0:i.spatialReference);if(r!==null){const s=[];for(const n of r)s.push(HU.fromGE(n));return s}return[]}let MB=class extends V{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};function yqe(){yf=null,$1=null,F$=null,V4={}}const _qe={get loadPromise(){return F$}};function I1(t,e){try{const i=ib(t,e);if(i==null)return null;"xmin"in t&&"xmin"in i&&(i.zmin=t.zmin,i.zmax=t.zmax);const r=dSe(i.type,t.spatialReference,e);return r!=null&&r(i),i}catch(i){if(!(i instanceof MB))throw i;return null}}async function L1(t,e,i){const r=t.spatialReference;return r!=null&&e!=null&&await iL(r,e,null,i),I1(t,e)}function Ac(t,e,i){return!i&&(!!gs(t,e)||sf(t)&&sf(e)&&!!R1(t,e,EB))}function vqe(t,e){if(gs(t,e))return!0;if(!sf(t)||!sf(e))return!1;const i=S0(t)||Ef(t)||MM(t),r=S0(e)||Ef(e)||MM(e);return i&&r}async function iL(t,e,i,r){if(kA())return oU(r);if(Array.isArray(t)){for(const{source:s,dest:n,geographicTransformation:o}of t)if(s&&n&&!Ac(s,n,o))return FM(r)}else if(t&&e&&!Ac(t,e,i))return FM(r);return oU(r)}function k$(t,e,i){return t?"x"in t?_Se(t,e,new _t,i,0):"xmin"in t?xSe(t,e,new gi,i,0):"rings"in t?wSe(t,e,new tb,i,0):"paths"in t?bSe(t,e,new J3,i,0):"points"in t?vSe(t,e,new $A,i,0):null:null}function ySe(t,e,i=e.spatialReference,r=0){return i!=null&&t.spatialReference!=null&&_Se(t,t.spatialReference,e,i,r)!=null}function _Se(t,e,i,r,s){Al[0]=t.x,Al[1]=t.y;const n=t.z;return Al[2]=n!==void 0?n:s,ns(Al,e,0,Al,r,0,1)?(i.x=Al[0],i.y=Al[1],i.spatialReference=r,n!==void 0||E1(r)?(i.z=Al[2],i.hasZ=!0):(i.z=void 0,i.hasZ=!1),t.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=t.m,i.hasM=!0),i):null}function bqe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&vSe(t,t.spatialReference,e,i,r)!=null}function vSe(t,e,i,r,s){const{points:n,hasZ:o,hasM:a}=t,l=[],c=n.length,u=[];for(const p of n)u.push(p[0],p[1],o?p[2]:s);if(!ns(u,e,0,u,r,0,c))return null;const d=o||E1(r);for(let p=0;p<c;++p){const m=3*p,g=u[m],y=u[m+1];d&&a?l.push([g,y,u[m+2],n[p][3]]):d?l.push([g,y,u[m+2]]):a?l.push([g,y,n[p][2]]):l.push([g,y])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function wqe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&bSe(t,t.spatialReference,e,i,r)!=null}function bSe(t,e,i,r,s){const{paths:n,hasZ:o,hasM:a}=t,l=[];if(!SSe(n,o??!1,a??!1,e,l,r,s))return null;const c=o||E1(r);return i.paths=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function xqe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&wSe(t,t.spatialReference,e,i,r)!=null}function wSe(t,e,i,r,s){const{rings:n,hasZ:o,hasM:a}=t,l=[];if(!SSe(n,o??!1,a??!1,e,l,r,s))return null;const c=o||E1(r);return i.rings=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function Sqe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&xSe(t,t.spatialReference,e,i,r)!=null}function xSe(t,e,i,r,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:u}=t,d=c?t.zmin:s;if(!Sle(n,o,d,e,Al,r))return null;const p=c||E1(r);i.xmin=Al[0],i.ymin=Al[1],p&&(i.zmin=Al[2]);const m=c?t.zmax:s;return Sle(a,l,m,e,Al,r)?(i.xmax=Al[0],i.ymax=Al[1],p&&(i.zmax=Al[2]),u&&(i.mmin=t.mmin,i.mmax=t.mmax),i.spatialReference=r,i):null}function SSe(t,e,i,r,s,n,o=0){const a=new Array;for(const u of t)for(const d of u)a.push(d[0],d[1],e?d[2]:o);if(!ns(a,r,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;const c=e||E1(n);for(const u of t){const d=new Array;for(const p of u)c&&i?d.push([a[l++],a[l++],a[l++],p[3]]):c?d.push([a[l++],a[l++],a[l++]]):i?(d.push([a[l++],a[l++],p[2]]),l++):(d.push([a[l++],a[l++]]),l++);s.push(d)}return!0}const Al=E(),QVt=Object.freeze(Object.defineProperty({__proto__:null,canProjectWithoutEngine:Ac,getTransformation:gSe,getTransformations:gqe,initializeProjection:iL,isEqualBaseGCS:vqe,isLoaded:kA,isLoadedOrLoad:pSe,isLoadedOrLoadFor:J2,load:FM,project:ib,projectExtent:Sqe,projectMany:A7,projectMultipoint:bqe,projectOrLoad:mqe,projectOrLoadMany:mSe,projectPoint:ySe,projectPolygon:xqe,projectPolyline:wqe,projectWithZConversion:L1,projectWithoutEngine:k$,requiresLoad:fSe,test:_qe,tryProjectWithZConversion:I1,unload:yqe},Symbol.toStringTag,{value:"Module"}));function AB(t,e,i,r){return t!=null&&(gs(e,r)?(T0(i,t),!0):(Rc[0]=t[0],Rc[1]=t[1],Rc[2]=0,!!ns(Rc,e,0,Rc,r,0,1)&&(i[0]=Rc[0],i[1]=Rc[1],Rc[0]=t[2],Rc[1]=t[3],Rc[2]=0,!!ns(Rc,e,0,Rc,r,0,1)&&(i[2]=Rc[0],i[3]=Rc[1],!0))))}const Rc=E();function il(t,e,i,r){if(Ac(t.spatialReference,i)){TD[0]=t.x,TD[1]=t.y;const n=t.z;return TD[2]=n??r??0,ns(TD,t.spatialReference,0,e,i,0,1)}const s=I1(t,i);return!!s&&(e[0]=s==null?void 0:s.x,e[1]=s==null?void 0:s.y,e[2]=(s==null?void 0:s.z)??r??0,!0)}async function qU(t,e,i,r,s){return await iL(t.spatialReference,i,null,s),il(t,e,i,r)}const TD=E();let U0=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&bM(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*Tle);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,Tle));e++)this._items.push(this._allocator())}};const Tle=1024;function vn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Rg(t,e,i,r,s,n,o,a,l,c,u,d,p,m,g,y,v){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=d,t[11]=p,t[12]=m,t[13]=g,t[14]=y,t[15]=v,t}function Gd(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function bu(t,e){if(t===e){const i=e[1],r=e[2],s=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function rb(t,e){return In(t,e)||Gd(t),t}function In(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],m=e[11],g=e[12],y=e[13],v=e[14],b=e[15],w=i*a-r*o,x=i*l-s*o,T=i*c-n*o,C=r*l-s*a,M=r*c-n*a,O=s*c-n*l,D=u*y-d*g,k=u*v-p*g,U=u*b-m*g,H=d*v-p*y,z=d*b-m*y,Z=p*b-m*v;let q=w*Z-x*z+T*H+C*U-M*k+O*D;return q?(q=1/q,t[0]=(a*Z-l*z+c*H)*q,t[1]=(s*z-r*Z-n*H)*q,t[2]=(y*O-v*M+b*C)*q,t[3]=(p*M-d*O-m*C)*q,t[4]=(l*U-o*Z-c*k)*q,t[5]=(i*Z-s*U+n*k)*q,t[6]=(v*T-g*O-b*x)*q,t[7]=(u*O-p*T+m*x)*q,t[8]=(o*z-a*U+c*D)*q,t[9]=(r*U-i*z-n*D)*q,t[10]=(g*M-y*T+b*w)*q,t[11]=(d*T-u*M-m*w)*q,t[12]=(a*k-o*H-l*D)*q,t[13]=(i*H-r*k+s*D)*q,t[14]=(y*x-g*C-v*w)*q,t[15]=(u*C-d*x+p*w)*q,t):null}function Tqe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],m=e[11],g=e[12],y=e[13],v=e[14],b=e[15];return t[0]=a*(p*b-m*v)-d*(l*b-c*v)+y*(l*m-c*p),t[1]=-(r*(p*b-m*v)-d*(s*b-n*v)+y*(s*m-n*p)),t[2]=r*(l*b-c*v)-a*(s*b-n*v)+y*(s*c-n*l),t[3]=-(r*(l*m-c*p)-a*(s*m-n*p)+d*(s*c-n*l)),t[4]=-(o*(p*b-m*v)-u*(l*b-c*v)+g*(l*m-c*p)),t[5]=i*(p*b-m*v)-u*(s*b-n*v)+g*(s*m-n*p),t[6]=-(i*(l*b-c*v)-o*(s*b-n*v)+g*(s*c-n*l)),t[7]=i*(l*m-c*p)-o*(s*m-n*p)+u*(s*c-n*l),t[8]=o*(d*b-m*y)-u*(a*b-c*y)+g*(a*m-c*d),t[9]=-(i*(d*b-m*y)-u*(r*b-n*y)+g*(r*m-n*d)),t[10]=i*(a*b-c*y)-o*(r*b-n*y)+g*(r*c-n*a),t[11]=-(i*(a*m-c*d)-o*(r*m-n*d)+u*(r*c-n*a)),t[12]=-(o*(d*v-p*y)-u*(a*v-l*y)+g*(a*p-l*d)),t[13]=i*(d*v-p*y)-u*(r*v-s*y)+g*(r*p-s*d),t[14]=-(i*(a*v-l*y)-o*(r*v-s*y)+g*(r*l-s*a)),t[15]=i*(a*p-l*d)-o*(r*p-s*d)+u*(r*l-s*a),t}function Eqe(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],d=t[10],p=t[11],m=t[12],g=t[13],y=t[14],v=t[15];return(e*o-i*n)*(d*v-p*y)-(e*a-r*n)*(u*v-p*g)+(e*l-s*n)*(u*y-d*g)+(i*a-r*o)*(c*v-p*m)-(i*l-s*o)*(c*y-d*m)+(r*l-s*a)*(c*g-u*m)}function dr(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=e[9],m=e[10],g=e[11],y=e[12],v=e[13],b=e[14],w=e[15];let x=i[0],T=i[1],C=i[2],M=i[3];return t[0]=x*r+T*a+C*d+M*y,t[1]=x*s+T*l+C*p+M*v,t[2]=x*n+T*c+C*m+M*b,t[3]=x*o+T*u+C*g+M*w,x=i[4],T=i[5],C=i[6],M=i[7],t[4]=x*r+T*a+C*d+M*y,t[5]=x*s+T*l+C*p+M*v,t[6]=x*n+T*c+C*m+M*b,t[7]=x*o+T*u+C*g+M*w,x=i[8],T=i[9],C=i[10],M=i[11],t[8]=x*r+T*a+C*d+M*y,t[9]=x*s+T*l+C*p+M*v,t[10]=x*n+T*c+C*m+M*b,t[11]=x*o+T*u+C*g+M*w,x=i[12],T=i[13],C=i[14],M=i[15],t[12]=x*r+T*a+C*d+M*y,t[13]=x*s+T*l+C*p+M*v,t[14]=x*n+T*c+C*m+M*b,t[15]=x*o+T*u+C*g+M*w,t}function rl(t,e,i){const r=i[0],s=i[1],n=i[2];if(e===t)t[12]=e[0]*r+e[4]*s+e[8]*n+e[12],t[13]=e[1]*r+e[5]*s+e[9]*n+e[13],t[14]=e[2]*r+e[6]*s+e[10]*n+e[14],t[15]=e[3]*r+e[7]*s+e[11]*n+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],d=e[5],p=e[6],m=e[7],g=e[8],y=e[9],v=e[10],b=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=d,t[6]=p,t[7]=m,t[8]=g,t[9]=y,t[10]=v,t[11]=b,t[12]=o*r+u*s+g*n+e[12],t[13]=a*r+d*s+y*n+e[13],t[14]=l*r+p*s+v*n+e[14],t[15]=c*r+m*s+b*n+e[15]}return t}function rL(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function uu(t,e,i,r){let s,n,o,a,l,c,u,d,p,m,g,y,v,b,w,x,T,C,M,O,D,k,U,H,z=r[0],Z=r[1],q=r[2],Y=Math.sqrt(z*z+Z*Z+q*q);return Y<Lo()?null:(Y=1/Y,z*=Y,Z*=Y,q*=Y,s=Math.sin(i),n=Math.cos(i),o=1-n,a=e[0],l=e[1],c=e[2],u=e[3],d=e[4],p=e[5],m=e[6],g=e[7],y=e[8],v=e[9],b=e[10],w=e[11],x=z*z*o+n,T=Z*z*o+q*s,C=q*z*o-Z*s,M=z*Z*o-q*s,O=Z*Z*o+n,D=q*Z*o+z*s,k=z*q*o+Z*s,U=Z*q*o-z*s,H=q*q*o+n,t[0]=a*x+d*T+y*C,t[1]=l*x+p*T+v*C,t[2]=c*x+m*T+b*C,t[3]=u*x+g*T+w*C,t[4]=a*M+d*O+y*D,t[5]=l*M+p*O+v*D,t[6]=c*M+m*O+b*D,t[7]=u*M+g*O+w*D,t[8]=a*k+d*U+y*H,t[9]=l*k+p*U+v*H,t[10]=c*k+m*U+b*H,t[11]=u*k+g*U+w*H,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function kM(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],d=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*r,t[5]=o*s+u*r,t[6]=a*s+d*r,t[7]=l*s+p*r,t[8]=c*s-n*r,t[9]=u*s-o*r,t[10]=d*s-a*r,t[11]=p*s-l*r,t}function PB(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],d=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*r,t[1]=o*s-u*r,t[2]=a*s-d*r,t[3]=l*s-p*r,t[8]=n*r+c*s,t[9]=o*r+u*s,t[10]=a*r+d*s,t[11]=l*r+p*s,t}function UM(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],d=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*r,t[1]=o*s+u*r,t[2]=a*s+d*r,t[3]=l*s+p*r,t[4]=c*s-n*r,t[5]=u*s-o*r,t[6]=d*s-a*r,t[7]=p*s-l*r,t}function yT(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function TSe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function wu(t,e,i){if(e===0)return Gd(t);let r,s,n,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<Lo()?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(e),s=Math.cos(e),n=1-s,t[0]=o*o*n+s,t[1]=a*o*n+l*r,t[2]=l*o*n-a*r,t[3]=0,t[4]=o*a*n-l*r,t[5]=a*a*n+s,t[6]=l*a*n+o*r,t[7]=0,t[8]=o*l*n+a*r,t[9]=a*l*n-o*r,t[10]=l*l*n+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function ESe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Cqe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function CSe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function MSe(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=r+r,l=s+s,c=n+n,u=r*a,d=r*l,p=r*c,m=s*l,g=s*c,y=n*c,v=o*a,b=o*l,w=o*c;return t[0]=1-(m+y),t[1]=d+w,t[2]=p-b,t[3]=0,t[4]=d-w,t[5]=1-(u+y),t[6]=g+v,t[7]=0,t[8]=p+b,t[9]=g-v,t[10]=1-(u+m),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function Mqe(t,e){const i=Aqe,r=-e[0],s=-e[1],n=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=r*r+s*s+n*n+o*o;return d>0?(i[0]=2*(a*o+u*r+l*n-c*s)/d,i[1]=2*(l*o+u*s+c*r-a*n)/d,i[2]=2*(c*o+u*n+a*s-l*r)/d):(i[0]=2*(a*o+u*r+l*n-c*s),i[1]=2*(l*o+u*s+c*r-a*n),i[2]=2*(c*o+u*n+a*s-l*r)),MSe(t,e,i),t}const Aqe=E();function WU(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function ASe(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.sqrt(i*i+r*r+s*s),t[1]=Math.sqrt(n*n+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+u*u),t}function PSe(t,e){const i=e[0]+e[5]+e[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function Pqe(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3],l=s+s,c=n+n,u=o+o,d=s*l,p=s*c,m=s*u,g=n*c,y=n*u,v=o*u,b=a*l,w=a*c,x=a*u,T=r[0],C=r[1],M=r[2];return t[0]=(1-(g+v))*T,t[1]=(p+x)*T,t[2]=(m-w)*T,t[3]=0,t[4]=(p-x)*C,t[5]=(1-(d+v))*C,t[6]=(y+b)*C,t[7]=0,t[8]=(m+w)*M,t[9]=(y-b)*M,t[10]=(1-(d+g))*M,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function Oqe(t,e,i,r,s){const n=e[0],o=e[1],a=e[2],l=e[3],c=n+n,u=o+o,d=a+a,p=n*c,m=n*u,g=n*d,y=o*u,v=o*d,b=a*d,w=l*c,x=l*u,T=l*d,C=r[0],M=r[1],O=r[2],D=s[0],k=s[1],U=s[2],H=(1-(y+b))*C,z=(m+T)*C,Z=(g-x)*C,q=(m-T)*M,Y=(1-(p+b))*M,de=(v+w)*M,L=(g+x)*O,F=(v-w)*O,j=(1-(p+y))*O;return t[0]=H,t[1]=z,t[2]=Z,t[3]=0,t[4]=q,t[5]=Y,t[6]=de,t[7]=0,t[8]=L,t[9]=F,t[10]=j,t[11]=0,t[12]=i[0]+D-(H*D+q*k+L*U),t[13]=i[1]+k-(z*D+Y*k+F*U),t[14]=i[2]+U-(Z*D+de*k+j*U),t[15]=1,t}function Rqe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i+i,a=r+r,l=s+s,c=i*o,u=r*o,d=r*a,p=s*o,m=s*a,g=s*l,y=n*o,v=n*a,b=n*l;return t[0]=1-d-g,t[1]=u+b,t[2]=p-v,t[3]=0,t[4]=u-b,t[5]=1-c-g,t[6]=m+y,t[7]=0,t[8]=p+v,t[9]=m-y,t[10]=1-c-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function OSe(t,e,i,r,s,n,o){const a=1/(i-e),l=1/(s-r),c=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(s+r)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t}function $qe(t,e,i,r,s){const n=1/Math.tan(e/2);let o;return t[0]=n/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(r-s),t[10]=(s+r)*o,t[14]=2*s*r*o):(t[10]=-1,t[14]=-2*r),t}function Iqe(t,e,i,r){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-n)*c*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}function RSe(t,e,i,r,s,n,o){const a=1/(e-i),l=1/(r-s),c=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(s+r)*l,t[14]=(o+n)*c,t[15]=1,t}function OB(t,e,i,r){const s=e[0],n=e[1],o=e[2];let a=s-i[0],l=n-i[1],c=o-i[2];const u=Lo();if(Math.abs(a)<u&&Math.abs(l)<u&&Math.abs(c)<u)return void Gd(t);let d=1/Math.sqrt(a*a+l*l+c*c);a*=d,l*=d,c*=d;const p=r[0],m=r[1],g=r[2];let y=m*c-g*l,v=g*a-p*c,b=p*l-m*a;d=Math.sqrt(y*y+v*v+b*b),d?(d=1/d,y*=d,v*=d,b*=d):(y=0,v=0,b=0);let w=l*b-c*v,x=c*y-a*b,T=a*v-l*y;d=Math.sqrt(w*w+x*x+T*T),d?(d=1/d,w*=d,x*=d,T*=d):(w=0,x=0,T=0),t[0]=y,t[1]=w,t[2]=a,t[3]=0,t[4]=v,t[5]=x,t[6]=l,t[7]=0,t[8]=b,t[9]=T,t[10]=c,t[11]=0,t[12]=-(y*s+v*n+b*o),t[13]=-(w*s+x*n+T*o),t[14]=-(a*s+l*n+c*o),t[15]=1}function $Se(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=r[0],l=r[1],c=r[2];let u=s-i[0],d=n-i[1],p=o-i[2],m=u*u+d*d+p*p;m>0&&(m=1/Math.sqrt(m),u*=m,d*=m,p*=m);let g=l*p-c*d,y=c*u-a*p,v=a*d-l*u;return m=g*g+y*y+v*v,m>0&&(m=1/Math.sqrt(m),g*=m,y*=m,v*=m),t[0]=g,t[1]=y,t[2]=v,t[3]=0,t[4]=d*v-p*y,t[5]=p*g-u*v,t[6]=u*y-d*g,t[7]=0,t[8]=u,t[9]=d,t[10]=p,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t}function Lqe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Dqe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function Nqe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function ISe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function Fqe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function kqe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t}function LSe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function RB(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],p=t[10],m=t[11],g=t[12],y=t[13],v=t[14],b=t[15],w=e[0],x=e[1],T=e[2],C=e[3],M=e[4],O=e[5],D=e[6],k=e[7],U=e[8],H=e[9],z=e[10],Z=e[11],q=e[12],Y=e[13],de=e[14],L=e[15],F=Lo();return Math.abs(i-w)<=F*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(r-x)<=F*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(s-T)<=F*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(n-C)<=F*Math.max(1,Math.abs(n),Math.abs(C))&&Math.abs(o-M)<=F*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(a-O)<=F*Math.max(1,Math.abs(a),Math.abs(O))&&Math.abs(l-D)<=F*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(c-k)<=F*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(u-U)<=F*Math.max(1,Math.abs(u),Math.abs(U))&&Math.abs(d-H)<=F*Math.max(1,Math.abs(d),Math.abs(H))&&Math.abs(p-z)<=F*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(m-Z)<=F*Math.max(1,Math.abs(m),Math.abs(Z))&&Math.abs(g-q)<=F*Math.max(1,Math.abs(g),Math.abs(q))&&Math.abs(y-Y)<=F*Math.max(1,Math.abs(y),Math.abs(Y))&&Math.abs(v-de)<=F*Math.max(1,Math.abs(v),Math.abs(de))&&Math.abs(b-L)<=F*Math.max(1,Math.abs(b),Math.abs(L))}function Gee(t){const e=Lo(),i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+u*u))<=e}function $B(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const jI=dr,Uqe=ISe;Object.freeze(Object.defineProperty({__proto__:null,add:Nqe,adjoint:Tqe,copy:vn,determinant:Eqe,equals:RB,exactEquals:LSe,frob:Dqe,fromQuat:Rqe,fromQuat2:Mqe,fromRotation:wu,fromRotationTranslation:MSe,fromRotationTranslationScale:Pqe,fromRotationTranslationScaleOrigin:Oqe,fromScaling:TSe,fromTranslation:yT,fromXRotation:ESe,fromYRotation:Cqe,fromZRotation:CSe,frustum:OSe,getRotation:PSe,getScaling:ASe,getTranslation:WU,hasIdentityRotation:$B,identity:Gd,invert:In,invertOrIdentity:rb,isOrthoNormal:Gee,lookAt:OB,mul:jI,multiply:dr,multiplyScalar:Fqe,multiplyScalarAndAdd:kqe,ortho:RSe,perspective:$qe,perspectiveFromFieldOfView:Iqe,rotate:uu,rotateX:kM,rotateY:PB,rotateZ:UM,scale:rL,set:Rg,str:Lqe,sub:Uqe,subtract:ISe,targetTo:$Se,translate:rl,transpose:bu},Symbol.toStringTag,{value:"Module"}));function Ee(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function zM(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function jee(t,e,i,r,s,n,o,a,l,c,u,d,p,m,g,y){return[t,e,i,r,s,n,o,a,l,c,u,d,p,m,g,y]}function zqe(t,e){return new Float64Array(t,e,16)}const Vr=Ee();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Vr,clone:zM,create:Ee,createView:zqe,fromValues:jee},Symbol.toStringTag,{value:"Module"}));function Gr(){return[1,0,0,0,1,0,0,0,1]}function DSe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function U$(t,e,i,r,s,n,o,a,l){return[t,e,i,r,s,n,o,a,l]}function Vqe(t,e){return new Float64Array(t,e,9)}const _T=Gr();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:_T,clone:DSe,create:Gr,createView:Vqe,fromValues:U$},Symbol.toStringTag,{value:"Module"}));function Oh(){return[0,0,0,1]}function Bqe(t){return[t[0],t[1],t[2],t[3]]}function Gqe(t,e,i,r){return[t,e,i,r]}function jqe(t,e){return new Float64Array(t,e,4)}const Hee=Oh();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Hee,clone:Bqe,create:Oh,createView:jqe,fromValues:Gqe},Symbol.toStringTag,{value:"Module"}));function lt(){return[0,0]}function AO(t){return[t[0],t[1]]}function _i(t,e){return[t,e]}function NSe(t,e=lt()){const i=Math.min(2,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function Hqe(t,e){return new Float64Array(t,e,2)}function FSe(){return lt()}function kSe(){return _i(1,1)}function USe(){return _i(1,0)}function zSe(){return _i(0,1)}const jS=FSe(),IB=kSe(),VSe=USe(),qqe=zSe();Object.freeze(Object.defineProperty({__proto__:null,ONES:IB,UNIT_X:VSe,UNIT_Y:qqe,ZEROS:jS,clone:AO,create:lt,createView:Hqe,fromArray:NSe,fromValues:_i,ones:kSe,unitX:USe,unitY:zSe,zeros:FSe},Symbol.toStringTag,{value:"Module"}));function Qt(){return[0,0,0,0]}function sL(t){return[t[0],t[1],t[2],t[3]]}function Wt(t,e,i,r){return[t,e,i,r]}function HI(t,e=Qt()){const i=Math.min(4,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function Wqe(t,e){return new Float64Array(t,e,4)}function BSe(){return Qt()}function GSe(){return Wt(1,1,1,1)}function jSe(){return Wt(1,0,0,0)}function HSe(){return Wt(0,1,0,0)}function qSe(){return Wt(0,0,1,0)}function WSe(){return Wt(0,0,0,1)}const wh=BSe(),Md=GSe(),Yqe=jSe(),Zqe=HSe(),Xqe=qSe(),Jqe=WSe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Md,UNIT_W:Jqe,UNIT_X:Yqe,UNIT_Y:Zqe,UNIT_Z:Xqe,ZEROS:wh,clone:sL,create:Qt,createView:Wqe,fromArray:HI,fromValues:Wt,ones:GSe,unitW:WSe,unitX:jSe,unitY:HSe,unitZ:qSe,zeros:BSe},Symbol.toStringTag,{value:"Module"}));let UA=class vw{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return this._itemsPtr===0&&bM(()=>this._reset()),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new vw(lt)}static createVec3f64(){return new vw(E)}static createVec4f64(){return new vw(Qt)}static createMat3f64(){return new vw(Gr)}static createMat4f64(){return new vw(Ee)}static createQuatf64(){return new vw(Oh)}get test(){}};const eBt=UA.createVec2f64(),Ye=UA.createVec3f64(),qee=UA.createVec4f64();UA.createMat3f64();const Wee=UA.createMat4f64(),Qqe=UA.createQuatf64();function Ff(t){return t?{origin:Xs(t.origin),vector:Xs(t.vector)}:{origin:E(),vector:E()}}function Kqe(t,e){const i=t9e.get();return i.origin=t,i.vector=e,i}function tBt(t,e=Ff()){return e9e(t.origin,t.vector,e)}function e9e(t,e,i=Ff()){return ce(i.origin,t),ce(i.vector,e),i}function _S(t,e,i=Ff()){return ce(i.origin,t),ve(i.vector,e,t),i}function Yee(t,e){const i=ve(Ye.get(),e,t.origin),r=pe(t.vector,i),s=pe(t.vector,t.vector),n=Te(r/s,0,1),o=ve(Ye.get(),oe(Ye.get(),t.vector,n),i);return pe(o,o)}function iBt(t,e,i){return P7(t,e,0,1,i)}function rBt(t,e,i){return me(i,t.origin,oe(i,t.vector,e))}function P7(t,e,i,r,s){const{vector:n,origin:o}=t,a=ve(Ye.get(),e,o),l=pe(n,a)/Za(n);return oe(s,n,Te(l,i,r)),me(s,s,t.origin)}function sBt(t,e){if(ZSe(t,Kqe(e.origin,e.direction),!1,YU)){const{tA:i,pB:r,distance2:s}=YU;if(i>=0&&i<=1)return s;if(i<0)return Ko(t.origin,r);if(i>1)return Ko(me(Ye.get(),t.origin,t.vector),r)}return null}function YSe(t,e,i){return!!ZSe(t,e,!0,YU)&&(ce(i,YU.pA),!0)}function ZSe(t,e,i,r){const n=t.origin,o=me(Ye.get(),n,t.vector),a=e.origin,l=me(Ye.get(),a,e.vector),c=Ye.get(),u=Ye.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],u[0]=l[0]-a[0],u[1]=l[1]-a[1],u[2]=l[2]-a[2],Math.abs(u[0])<1e-6&&Math.abs(u[1])<1e-6&&Math.abs(u[2])<1e-6)return!1;const d=Ye.get();if(d[0]=o[0]-n[0],d[1]=o[1]-n[1],d[2]=o[2]-n[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;const p=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],m=u[0]*d[0]+u[1]*d[1]+u[2]*d[2],g=c[0]*d[0]+c[1]*d[1]+c[2]*d[2],y=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],v=(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])*y-m*m;if(Math.abs(v)<1e-6)return!1;let b=(p*m-g*y)/v,w=(p+m*b)/y;i&&(b=Te(b,0,1),w=Te(w,0,1));const x=Ye.get(),T=Ye.get();return x[0]=n[0]+b*d[0],x[1]=n[1]+b*d[1],x[2]=n[2]+b*d[2],T[0]=a[0]+w*u[0],T[1]=a[1]+w*u[1],T[2]=a[2]+w*u[2],r.tA=b,r.tB=w,r.pA=x,r.pB=T,r.distance2=Ko(x,T),!0}const YU={tA:0,tB:0,pA:E(),pB:E(),distance2:0},t9e=new U0(()=>Ff());function Rd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function i9e(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ds(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function Zee(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function XSe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function JSe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function QSe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function r9e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function s9e(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function n9e(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function o9e(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function a9e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function HS(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function l9e(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}function KSe(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function ZU(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return i*i+r*r+s*s+n*n}function Xee(t){const e=t[0],i=t[1],r=t[2],s=t[3];return Math.sqrt(e*e+i*i+r*r+s*s)}function Jee(t){const e=t[0],i=t[1],r=t[2],s=t[3];return e*e+i*i+r*r+s*s}function c9e(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function u9e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function eTe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=i*o,t[1]=r*o,t[2]=s*o,t[3]=n*o),t}function tTe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function LB(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t[3]=a+r*(i[3]-a),t}function h9e(t,e){const i=G3;let r,s,n,o,a,l;e=e||1;do r=2*i()-1,s=2*i()-1,a=r*r+s*s;while(a>=1);do n=2*i()-1,o=2*i()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*r,t[1]=e*s,t[2]=e*n*c,t[3]=e*o*c,t}function hu(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,t[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,t[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,t[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,t}function d9e(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2],c=i[3],u=c*r+a*n-l*s,d=c*s+l*r-o*n,p=c*n+o*s-a*r,m=-o*r-a*s-l*n;return t[0]=u*c+m*-o+d*-l-p*-a,t[1]=d*c+m*-a+p*-o-u*-l,t[2]=p*c+m*-l+u*-a-d*-o,t[3]=e[3],t}function p9e(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function BC(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function qS(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=Lo();return Math.abs(i-o)<=u*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))}const f9e=XSe,m9e=JSe,g9e=QSe,y9e=KSe,_9e=ZU,v9e=Xee,b9e=Jee,iTe=Object.freeze(Object.defineProperty({__proto__:null,add:Zee,ceil:r9e,copy:Rd,copyVec3:i9e,dist:y9e,distance:KSe,div:g9e,divide:QSe,dot:tTe,equals:qS,exactEquals:BC,floor:s9e,inverse:u9e,len:v9e,length:Xee,lerp:LB,max:o9e,min:n9e,mul:m9e,multiply:JSe,negate:c9e,normalize:eTe,random:h9e,round:a9e,scale:HS,scaleAndAdd:l9e,set:ds,sqrDist:_9e,sqrLen:b9e,squaredDistance:ZU,squaredLength:Jee,str:p9e,sub:f9e,subtract:XSe,transformMat4:hu,transformQuat:d9e},Symbol.toStringTag,{value:"Module"}));function nBt(t,e,i){const r=pe(t,e)/pe(t,t);return oe(i,t,r)}function s1(t,e){return pe(t,e)/Ae(t)}function Qee(t,e){const i=pe(t,e)/(Ae(t)*Ae(e));return-fo(i)}function rTe(t,e,i){ge(ED,t),ge(d6,e);const r=pe(ED,d6),s=fo(r),n=ot(ED,ED,d6);return pe(n,i)<0?2*Math.PI-s:s}const ED=E(),d6=E();function VM(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],i=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],r=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}function w9e(t,e){const i=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return ne(t,i,r,s),t}function oBt(t,e,i){i=i||t;const r=pe(t,e);ne(i,t[0]-r*e[0],t[1]-r*e[1],t[2]-r*e[2]),ge(i,i)}function x9e(t,e,i){Math.abs(t[0])>Math.abs(t[1])?ne(e,0,1,0):ne(e,1,0,0),ot(i,t,e),ot(e,i,t),ge(i,i),ge(e,e)}function CD(t,e,i,r,s,n){const o=t+(e-t)*s;return o+(i+(r-i)*s-o)*n}function S9e(t,e,i,r=E()){const s=Ae(t),n=Ae(e),o=pe(t,e)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*s+i*n)/Math.sin(a),c=l/s*Math.sin((1-i)*a),u=l/n*Math.sin(i*a);return oe(Hx,t,c),oe(qx,e,u),me(r,Hx,qx)}return yr(r,t,e,i)}function aBt(t,e,i,r=E(),s=E()){const n=Ae(t),o=Ae(e),a=pe(t,e)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),u=Math.sin(i*l),d=Math.sin((1-i)*l),p=(1-i)*n+i*o;{const m=p/c,g=m/o*u;oe(Hx,t,m/n*d),oe(qx,e,g),me(r,Hx,qx)}{const m=1/n*(-Math.cos((1-i)*l)*l*p+d*(-n+o));oe(Hx,t,m);const g=1/o*(Math.cos(i*l)*l*p+u*(-n+o));oe(qx,e,g),me(s,Hx,qx),oe(s,s,1/c)}return s}return yr(r,t,e,i),ve(s,e,t),ge(s,s),s}function XU(t,e,i){t=ge(Hx,t),e=ge(qx,e);const r=fo(pe(t,e));if(i){const s=ot(T9e,t,e);if(pe(s,i)<0)return-r}return r}function B4(t){const e=t.length;return i=>{if(i<=t[0][0])return t[0][1];if(i>=t[e-1][0])return t[e-1][1];let r=1;for(;i>t[r][0];)r++;const s=t[r-1][0],n=t[r][0],o=(n-i)/(n-s);return o*t[r-1][1]+(1-o)*t[r][1]}}function lBt(t,e,i,r){ve(Ele,e,t),ve(Cle,i,t),ot(r,Ele,Cle),ge(r,r),r[3]=-pe(t,r)}function cBt(t,e){if(ne(e,0,0,0),t.length>0){for(let i=0;i<t.length;++i)me(e,e,t[i]);oe(e,e,1/t.length)}}const Ele=E(),Cle=E(),T9e=E(),Hx=E(),qx=E();function Qi(t=PO){return[t[0],t[1],t[2],t[3]]}function E9e(t=PO[0],e=PO[1],i=PO[2],r=PO[3]){return Kee(t,e,i,r,qee.get())}function DB(t,e){return Kee(e[0],e[1],e[2],e[3],t)}function uBt(t){return t}function Kee(t,e,i,r,s=Qi()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function sTe(t,e,i){return ce(i,t),i[3]=e,i}function nL(t,e,i){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function qa(t,e,i,r=Qi()){const s=i[0]-e[0],n=i[1]-e[1],o=i[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],u=n*c-o*l,d=o*a-s*c,p=s*l-n*a,m=u*u+d*d+p*p,g=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return r[0]=u*g,r[1]=d*g,r[2]=p*g,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function ete(t,e,i,r=0,s=Math.floor(i*(1/3)),n=Math.floor(i*(2/3))){if(i<3)return!1;e(xP,r);let o=s,a=!1;for(;o<i-1&&!a;)e(zT,o),o++,a=!Oo(xP,zT);if(!a)return!1;for(o=Math.max(o,n),a=!1;o<i&&!a;)e(Tx,o),o++,ve(MD,xP,zT),ge(MD,MD),ve(AD,zT,Tx),ge(AD,AD),a=!Oo(xP,Tx)&&!Oo(zT,Tx)&&Math.abs(pe(MD,AD))<M9e;return a?(qa(xP,zT,Tx,t),!0):(r!==0||s!==1||n!==2)&&ete(t,e,i,0,1,2)}function C9e(t,e,i=!0){const r=e.length/3;return ete(t,(s,n)=>ne(s,e[3*n+0],e[3*n+1],e[3*n+2]),i?r-1:r)}const M9e=.99619469809,xP=E(),zT=E(),Tx=E(),MD=E(),AD=E();function O7(t,e,i){return e!==t&&DB(t,e),t[3]=-pe(t,i),t}function R7(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function qI(t,e,i,r){return ot(Tx,e,t),nL(i,Tx,r)}function hBt(t,e,i,r){return NB(t,e,ve(Ye.get(),i,e),I9e,r)}function vT(t,e,i){return e!=null&&NB(t,e.origin,e.direction,L9e,i)}function A9e(t,e,i){return NB(t,e.origin,e.vector,cg.NONE,i)}function P9e(t,e,i){return NB(t,e.origin,e.vector,cg.CLAMP,i)}function nTe(t,e){return Er(t,e)>=0}function O9e(t,e){const i=pe(t,e.ray.direction),r=-Er(t,e.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function R9e(t,e){const i=pe(t,e.ray.direction),r=-Er(t,e.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function $9e(t,e,i){const r=oe(Ye.get(),t,-t[3]),s=$7(t,ve(Ye.get(),e,r),Ye.get());return me(i,s,r),i}function dBt(t,e,i,r){const s=t,n=Ye.get(),o=Ye.get();x9e(s,n,o);const a=ve(Ye.get(),i,e),l=s1(n,a),c=s1(o,a),u=s1(s,a);return ne(r,l,c,u)}function $7(t,e,i){const r=oe(Ye.get(),t,pe(t,e));return ve(i,e,r),i}function pBt(t,e){return Math.abs(Er(t,e))}function Er(t,e){return pe(t,e)+t[3]}function NB(t,e,i,r,s){const n=pe(t,i);if(n===0)return!1;let o=-(pe(t,e)+t[3])/n;return r&cg.CLAMP&&(o=Te(o,0,1)),!(!(r&cg.INFINITE_MIN)&&o<0||!(r&cg.INFINITE_MAX)&&o>1)&&(me(s,e,oe(s,i,o)),!0)}const PO=[0,0,1,0];var cg;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(cg||(cg={}));const I9e=cg.INFINITE_MIN|cg.INFINITE_MAX,L9e=cg.INFINITE_MAX;function uo(t){return t?Mle(Xs(t.origin),Xs(t.direction)):Mle(E(),E())}function Mle(t,e){return{origin:t,direction:e}}function fBt(t,e){return w1(t.origin,e.origin)&&w1(t.direction,e.direction)}function Mh(t,e){const i=F9e.get();return i.origin=t,i.direction=e,i}function JU(t,e=uo()){return aTe(t.origin,t.direction,e)}function oTe(t,e,i=uo()){return ce(i.origin,t),ve(i.direction,e,t),i}function aTe(t,e,i=uo()){return ce(i.origin,t),ce(i.direction,e),i}function D9e(t,e){const i=ot(Ye.get(),ge(Ye.get(),t.direction),ve(Ye.get(),e,t.origin));return pe(i,i)}function N9e(t,e,i){const r=pe(t.direction,ve(i,e,t.origin));return me(i,t.origin,oe(i,t.direction,r)),i}function mBt(t,e,i,r){const s=t.direction,n=e.direction,o=Ai(p6,e.origin,t.origin),a=pe(s,n),l=pe(n,o),c=pe(s,o),u=pe(s,s),d=pe(n,n),p=(a*l+c*d)/(u*d-a*a),m=(a*c-l*u)/(u*d-a*a);return me(i,t.origin,oe(p6,s,p)),me(r,e.origin,oe(p6,n,m)),[i,r]}const F9e=new U0(()=>uo()),p6=E(),f6=()=>ie.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let k9e=class{constructor(){this.plane=Qi(),this.origin=E(),this.basis1=E(),this.basis2=E()}};const lTe=k9e;function z0(t=vTe){return{plane:Qi(t.plane),origin:Xs(t.origin),basis1:Xs(t.basis1),basis2:Xs(t.basis2)}}function U9e(t,e,i){const r=J9e.get();return r.origin=t,r.basis1=e,r.basis2=i,r.plane=E9e(0,0,0,0),FB(r),r}function bT(t,e=z0()){return tte(t.origin,t.basis1,t.basis2,e)}function z9e(t,e){ce(e.origin,t.origin),ce(e.basis1,t.basis1),ce(e.basis2,t.basis2),DB(e.plane,t.plane)}function tte(t,e,i,r=z0()){return ce(r.origin,t),ce(r.basis1,e),ce(r.basis2,i),FB(r),Z9e(r,"fromValues()"),r}function FB(t){qI(t.basis2,t.basis1,t.origin,t.plane)}function cTe(t,e,i){t!==i&&bT(t,i);const r=oe(Ye.get(),E0(t),e);return me(i.origin,i.origin,r),i.plane[3]-=e,i}function V9e(t,e,i){return uTe(e,i),cTe(i,nte(t,t.origin),i),i}function uTe(t,e=z0()){const i=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return ne(e.origin,t[0]+i,t[1]+r,0),ne(e.basis1,i,0,0),ne(e.basis2,0,r,0),Kee(0,0,1,0,e.plane),e}function ite(t,e,i){return!!vT(t.plane,e,i)&&yTe(t,i)}function B9e(t,e,i){if(ite(t,e,i))return i;const r=hTe(t,e,Ye.get());return me(i,e.origin,oe(Ye.get(),e.direction,wr(e.origin,r)/Ae(e.direction))),i}function hTe(t,e,i){const r=QU.get();_Te(t,e,r,QU.get());let s=Number.POSITIVE_INFINITY;for(const n of ate){const o=ote(t,n,kB.get()),a=Ye.get();if(A9e(r,o,a)){const l=k0(Ye.get(),e.origin,a),c=Math.abs(fo(pe(e.direction,l)));c<s&&(s=c,ce(i,a))}}return s===Number.POSITIVE_INFINITY?dTe(t,e,i):i}function dTe(t,e,i){if(ite(t,e,i))return i;const r=QU.get(),s=QU.get();_Te(t,e,r,s);let n=Number.POSITIVE_INFINITY;for(const o of ate){const a=ote(t,o,kB.get()),l=Ye.get();if(P9e(r,a,l)){const c=D9e(e,l);if(!nTe(s,l))continue;c<n&&(n=c,ce(i,l))}}return rte(t,e.origin)<n&&pTe(t,e.origin,i),i}function pTe(t,e,i){const r=$9e(t.plane,e,Ye.get()),s=P7(Ale(t,t.basis1),r,-1,1,Ye.get()),n=P7(Ale(t,t.basis2),r,-1,1,Ye.get());return ve(i,me(Ye.get(),s,n),t.origin),i}function fTe(t,e,i){const{origin:r,basis1:s,basis2:n}=t,o=ve(Ye.get(),e,r),a=s1(s,o),l=s1(n,o),c=s1(E0(t),o);return ne(i,a,l,c)}function rte(t,e){const i=fTe(t,e,Ye.get()),{basis1:r,basis2:s}=t,n=Ae(r),o=Ae(s),a=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function G9e(t,e){return Math.sqrt(rte(t,e))}function j9e(t,e){let i=Number.NEGATIVE_INFINITY;for(const r of ate){const s=ote(t,r,kB.get()),n=Yee(s,e);n>i&&(i=n)}return Math.sqrt(i)}function ste(t,e){return nTe(t.plane,e)&&yTe(t,e)}function H9e(t,e,i,r){return Y9e(t,i,r)}function nte(t,e){const i=-t.plane[3];return s1(E0(t),e)-i}function q9e(t,e,i,r){const s=nte(t,e),n=oe(X9e,E0(t),i-s);return me(r,e,n),r}function mTe(t,e){return Oo(t.basis1,e.basis1)&&Oo(t.basis2,e.basis2)&&Oo(t.origin,e.origin)}function gTe(t,e,i){return t!==i&&bT(t,i),In(VT,e),bu(VT,VT),He(i.basis1,t.basis1,VT),He(i.basis2,t.basis2,VT),He(i.plane,t.plane,VT),He(i.origin,t.origin,e),O7(i.plane,i.plane,i.origin),i}function W9e(t,e,i,r){return t!==r&&bT(t,r),wu(m6,e,i),He(r.basis1,t.basis1,m6),He(r.basis2,t.basis2,m6),FB(r),r}function E0(t){return t.plane}function Y9e(t,e,i){switch(e){case hs.X:ce(i,t.basis1),ge(i,i);break;case hs.Y:ce(i,t.basis2),ge(i,i);break;case hs.Z:ce(i,E0(t))}return i}function yTe(t,e){const i=ve(Ye.get(),e,t.origin),r=Za(t.basis1),s=Za(t.basis2),n=pe(t.basis1,i),o=pe(t.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function Ale(t,e){const i=kB.get();return ce(i.origin,t.origin),ce(i.vector,e),i}function ote(t,e,i){const{basis1:r,basis2:s,origin:n}=t,o=oe(Ye.get(),r,e.origin[0]),a=oe(Ye.get(),s,e.origin[1]);me(i.origin,o,a),me(i.origin,i.origin,n);const l=oe(Ye.get(),r,e.direction[0]),c=oe(Ye.get(),s,e.direction[1]);return oe(i.vector,me(l,l,c),2),i}function Z9e(t,e){Math.abs(pe(t.basis1,t.basis2)/(Ae(t.basis1)*Ae(t.basis2)))>1e-6&&f6().warn(e,"Provided basis vectors are not perpendicular"),Math.abs(pe(t.basis1,E0(t)))>1e-6&&f6().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-pe(E0(t),t.origin)-t.plane[3])>1e-6&&f6().warn(e,"Plane offset is not consistent with plane origin")}function _Te(t,e,i,r){const s=E0(t);qI(s,e.direction,e.origin,i),qI(i,s,e.origin,r)}const vTe={plane:Qi(),origin:$e(0,0,0),basis1:$e(1,0,0),basis2:$e(0,1,0)},QU=new U0(Qi),kB=new U0(Ff),X9e=E(),J9e=new U0(()=>z0()),ate=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],VT=Ee(),m6=Ee(),Q9e=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:lTe,altitudeAt:nte,axisAt:H9e,closestPoint:dTe,closestPointOnSilhouette:hTe,copy:bT,copyWithoutVerify:z9e,create:z0,distance:G9e,distance2:rte,distanceToSilhouette:j9e,elevate:cTe,equals:mTe,extrusionContainsPoint:ste,fromAABoundingRect:uTe,fromValues:tte,intersectRay:ite,intersectRayClosestSilhouette:B9e,normal:E0,projectPoint:pTe,projectPointLocal:fTe,rotate:W9e,setAltitudeAt:q9e,setExtent:V9e,transform:gTe,up:vTe,updateUnboundedPlane:FB,wrap:U9e},Symbol.toStringTag,{value:"Module"})),K9e=new We(Wbe),eC=new We(cB),tC=new We(uB),e7e=new We(Ybe);function xu(t){const e=Ple.get(t);if(e)return e;let i=K9e;if(t)if(t===eC)i=eC;else if(t===tC)i=tC;else{const r=t.wkid,s=t.latestWkid;if(r!=null||s!=null)AM(r)||AM(s)?i=eC:(PM(r)||PM(s))&&(i=tC);else{const n=t.wkt2??t.wkt;if(n){const o=n.toUpperCase();o===t7e?i=eC:o===i7e&&(i=tC)}}}return Ple.set(t,i),i}const Ple=new Map,t7e=eC.wkt.toUpperCase(),i7e=tC.wkt.toUpperCase(),bTe=ln();function ln(){return Qt()}const r7e=qS,s7e=qS;function WS(t,e){return Rd(e,t)}function wTe(t,e){return Wt(t[0],t[1],t[2],e)}function n7e(t){return t}function o7e(t){t[0]=t[1]=t[2]=t[3]=0}function UB(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function n1(t){return t[3]}function a7e(t){return t}function xTe(t,e,i,r){return Wt(t,e,i,r)}function l7e(t,e,i){return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),i[3]=t[3]+e,i}function c7e(t,e,i){return t!==i&&WS(t,i),i}function sb(t,e,i){if(e==null||!STe(t,e,KU))return!1;let{t0:r,t1:s}=KU;if((r<0||s<r&&s>0)&&(r=s),r<0)return!1;if(i){const{origin:n,direction:o}=e;i[0]=n[0]+o[0]*r,i[1]=n[1]+o[1]*r,i[2]=n[2]+o[2]*r}return!0}function u7e(t,e,i){const r=oTe(e,i);if(!STe(t,r,KU))return[];const{origin:s,direction:n}=r,{t0:o,t1:a}=KU,l=c=>{const u=E();return On(u,s,n,c),lte(t,u,u)};return Math.abs(o-a)<Lo()?[l(o)]:[l(o),l(a)]}const KU={t0:0,t1:0};function STe(t,e,i){const{origin:r,direction:s}=e,n=h7e;n[0]=r[0]-t[0],n[1]=r[1]-t[1],n[2]=r[2]-t[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);return i.t0=(-a-c)/(2*o),i.t1=(-a+c)/(2*o),!0}const h7e=E();function I7(t,e){return sb(t,e,null)}function d7e(t,e,i){if(sb(t,e,i))return i;const r=zA(t,e,Ye.get());return me(i,e.origin,oe(Ye.get(),e.direction,wr(e.origin,r)/Ae(e.direction))),i}function zA(t,e,i){const r=Ye.get(),s=Wee.get();ot(r,e.origin,e.direction);const n=n1(t);ot(i,r,e.origin),oe(i,i,1/Ae(i)*n);const o=ETe(t,e.origin),a=Qee(e.origin,i);return wu(s,a+o,r),He(i,i,s),i}function p7e(t,e,i){return sb(t,e,i)?i:(N9e(e,t,i),lte(t,i,i))}function lte(t,e,i){const r=ve(Ye.get(),e,t),s=oe(Ye.get(),r,t[3]/Ae(r));return me(i,s,t)}function TTe(t,e){const i=ve(Ye.get(),e,t),r=Za(i),s=t[3]*t[3];return Math.sqrt(Math.abs(r-s))}function ETe(t,e){const i=ve(Ye.get(),e,t),r=Ae(i),s=n1(t),n=s+Math.abs(s-r);return fo(s/n)}const g6=E();function CTe(t,e,i,r){const s=ve(g6,e,t);switch(i){case hs.X:{const n=Qoe(s,g6)[2];return ne(r,-Math.sin(n),Math.cos(n),0)}case hs.Y:{const n=Qoe(s,g6),o=n[1],a=n[2],l=Math.sin(o);return ne(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case hs.Z:return ge(r,s);default:return}}function MTe(t,e){const i=ve(L7,e,t);return Ae(i)-t[3]}function f7e(t,e,i,r){const s=MTe(t,e),n=CTe(t,e,hs.Z,L7),o=oe(L7,n,i-s);return me(r,e,o)}function m7e(t,e){const i=Ko(t,e),r=n1(t);return i<=r*r}function g7e(t,e,i=Qt()){const r=wr(t,e),s=t[3],n=e[3];return r+n<s?(Rd(i,t),i):r+s<n?(Rd(i,e),i):(yr(i,t,e,(r+n-s)/(2*r)),i[3]=(r+s+n)/2,i)}const L7=E(),zB=ln(),y7e=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:bTe,altitudeAt:MTe,angleToSilhouette:ETe,axisAt:CTe,clear:o7e,closestPoint:p7e,closestPointOnSilhouette:zA,containsPoint:m7e,copy:WS,create:ln,distanceToSilhouette:TTe,elevate:l7e,equals:s7e,exactEquals:r7e,fromCenterAndRadius:wTe,fromRadius:UB,fromValues:xTe,getCenter:a7e,getRadius:n1,intersectLine:u7e,intersectRay:sb,intersectRayClosestSilhouette:d7e,intersectsRay:I7,projectPoint:lte,setAltitudeAt:f7e,setExtent:c7e,tmpSphere:zB,union:g7e,wrap:n7e},Symbol.toStringTag,{value:"Module"}));function _7e(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function v7e(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function b7e(t){return{operations:t,value:t.create()}}function ATe(t,e,i=b7e(t)){return i.operations=t,t.copy(e,i.value),i}function w7e(t){return ATe(y7e,xTe(0,0,0,ur(t).radius))}const Ole=2**50;function x7e(){return ATe(Q9e,tte([0,0,0],[Ole,0,0],[0,Ole,0]))}function S7e(t,e,i){return t.operations.axisAt(t.value,e,hs.Z,i)}function T7e(t,e,i,r){return t.operations.axisAt(t.value,e,i,r)}function E7e(t,e,i){return t.operations.intersectRay(t.value,e,i)}function C7e(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function M7e(t,e){return t.operations.altitudeAt(t.value,e)}function PTe(t,e,i,r){return t.operations.setAltitudeAt(t.value,e,i,r)}function A7e(t,e,i,r){return e!==r&&vn(r,e),ne(BT,r[12],r[13],r[14]),PTe(t,BT,i,BT),r[12]=BT[0],r[13]=BT[1],r[14]=BT[2],r}function y6(t,e,i){return t.operations.elevate(t.value,e,i.value)}const BT=E();function Rle(t,e,i,r,s){return s[0]=pe(t,e),s[1]=pe(t,i),s[2]=pe(t,r),s}function D7(t,e,i,r,s){ce(i,t),ce(PD,e),ge(PD,PD),ot(r,PD,i),ot(s,r,i)}function P7e(t,e){return t?xu(e):e.isGeographic?We.PlateCarree:e}const PD=E(),cte=96;function yBt(t,e){const i=t.extent,r=t.width,s=Gl(i==null?void 0:i.spatialReference);return i&&r?i.width/r*s*mee*cte:0}function O7e(t,e){return t/(Gl(e)*mee*cte)}function R7e(t){return t/(mee*cte)}function _Bt(t,e,i){return $7e(t,e)&&I7e(t,i)}function $7e(t,e){return e===0||t1(t,e)||t<e}function I7e(t,e){return e===0||t1(t,e)||t>e}function vBt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function L7e(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="subtype-group"&&"sublayers"in t}function bw(t){return(t==null?void 0:t.type)==="subtype-sublayer"}function z$(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function BM(t){return t!=null&&"type"in t&&t.type==="group"}const bBt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function OTe(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function D7e(t){return t==="IntegratedMeshLayer"||t==="IntegratedMesh3DTilesLayer"}function WI(t){return t==="integrated-mesh"||t==="integrated-mesh-3dtiles"}function $le(t){return(t==null?void 0:t.type)==="voxel"}function Ile(t){return(t==null?void 0:t.type)==="imagery-tile"}function G4(t){return(t==null?void 0:t.parent)!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function VB(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function wBt(t){var e;return((t==null?void 0:t.type)==="feature"||(t==null?void 0:t.type)==="subtype-group")&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function N7e(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const i=t.activeLayer.tileMatrixSets;if(i)return i}return null}async function RTe(t,e){const i=pi==null?void 0:pi.findServerInfo(t);if((i==null?void 0:i.currentVersion)!=null)return i.owningSystemUrl||null;const r=t.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const s=`${t.substring(0,r)}/rest/info`,n=e!=null?e.signal:null,{data:o}=await Yt(s,{query:{f:"json"},responseType:"json",signal:n});return(o==null?void 0:o.owningSystemUrl)||null}function F7e(t){if(!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function k7e(t){return F7e(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function U7e(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function z7e(t){return!!U7e(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}let GM=class extends D${constructor(e){super(e),this.addHandles(this.on("before-add",i=>{i.item!=null&&i.item.parent===this.owner&&(ie.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};GM=h([I("esri.support.AnalysesCollection")],GM);const j4={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],r=e[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},_6={xsmall:544,small:768,medium:992,large:1200};function V7e(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function v6(t,e){return e?j4[t].valueToClassName[e].split(" "):[]}const B7e=t=>{let e=class extends t{constructor(...i){super(...i),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=_6}initialize(){this.addHandles(ue(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),cr))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(i){if(i!==this._get("breakpoints")){if(!V7e(i)){const r=JSON.stringify(_6,null,2);console.warn("provided breakpoints are not valid, using defaults:"+r),i=_6}this._set("breakpoints",{...i})}}_updateClassNames(){if(!this.container)return;const i=iu.acquire(),r=iu.acquire();let s,n=!1;for(s in j4){const o=this[s],a=j4[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,v6(s,o).forEach(l=>r.push(l)),v6(s,a).forEach(l=>i.push(l)))}n&&(this._applyClassNameChanges(i,r),iu.release(i),iu.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in j4)v6(r,this[r]).forEach(s=>i.classList.remove(s))}};return h([f()],e.prototype,"breakpoints",null),h([f()],e.prototype,"orientation",void 0),h([f()],e.prototype,"widthBreakpoint",void 0),h([f()],e.prototype,"heightBreakpoint",void 0),e=h([I("esri.views.BreakpointsOwner")],e),e};let u0=class extends Re{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,i,r={}){return this._installWatch(e,i,r,ue)}addWhen(e,i,r={}){return this._installWatch(e,i,r,vu)}addOnCollectionChange(e,i,{initial:r=!1,final:s=!1}={}){const n=++this._handleId;return this.addHandles([Ta(e,"after-changes",this._createSyncUpdatingCallback(),ar),Ta(e,"change",i,{onListenerAdd:r?o=>i({added:o.toArray(),removed:[]}):void 0,onListenerRemove:s?o=>i({added:[],removed:o.toArray()}):void 0})],n),Ni(()=>this.removeHandles(n))}addPromise(e){if(e==null)return e;const i=++this._handleId;this.addHandles(Ni(()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this.hasHandles(OD)||this._set("updating",!1))}),i),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this.removeHandles(i);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,i,r={},s){const n=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,i,r);return this.addHandles(o,n),Ni(()=>this.removeHandles(n))}_installSyncUpdatingWatch(e,i){const r=this._createSyncUpdatingCallback(),s=ue(e,r,{sync:!0,equals:()=>!1});return this.addHandles(s,i),s}_createSyncUpdatingCallback(){return()=>{this.removeHandles(OD),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(hT(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(OD))}),OD)}}};h([f({readOnly:!0})],u0.prototype,"updating",void 0),u0=h([I("esri.core.support.UpdatingHandles")],u0);const OD=-42;/*!
 * @esri/arcgis-html-sanitizer - v4.0.1 - Thu May 30 2024 10:12:55 GMT-0400 (Eastern Daylight Time)
 * Copyright (c) 2024 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(é›·å®—æ°‘) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ez=function(){return ez=Object.assign||function(e){for(var i,r=1,s=arguments.length;r<s;r++){i=arguments[r];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},ez.apply(this,arguments)},N7={exports:{}},wn={},F7={exports:{}},wT={};function $Te(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function G7e(t,e,i){}function j7e(t,e,i){}var H7e=/javascript\s*\:/img;function q7e(t,e){return H7e.test(e)?"":e}wT.whiteList=$Te();wT.getDefaultWhiteList=$Te;wT.onAttr=G7e;wT.onIgnoreAttr=j7e;wT.safeAttrValue=q7e;var W7e={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},SP=W7e;function Y7e(t,e){t=SP.trimRight(t),t[t.length-1]!==";"&&(t+=";");var i=t.length,r=!1,s=0,n=0,o="";function a(){if(!r){var u=SP.trim(t.slice(s,n)),d=u.indexOf(":");if(d!==-1){var p=SP.trim(u.slice(0,d)),m=SP.trim(u.slice(d+1));if(p){var g=e(s,o.length,p,m,u);g&&(o+=g+"; ")}}}s=n+1}for(;n<i;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return SP.trim(o)}var Z7e=Y7e,RD=wT,X7e=Z7e;function Lle(t){return t==null}function J7e(t){var e={};for(var i in t)e[i]=t[i];return e}function ITe(t){t=J7e(t||{}),t.whiteList=t.whiteList||RD.whiteList,t.onAttr=t.onAttr||RD.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||RD.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||RD.safeAttrValue,this.options=t}ITe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,o=i.safeAttrValue,a=X7e(t,function(l,c,u,d,p){var m=r[u],g=!1;if(m===!0?g=m:typeof m=="function"?g=m(d):m instanceof RegExp&&(g=m.test(d)),g!==!0&&(g=!1),d=o(u,d),!!d){var y={position:c,sourcePosition:l,source:p,isWhite:g};if(g){var v=s(u,d,y);return Lle(v)?u+":"+d:v}else{var v=n(u,d,y);if(!Lle(v))return v}}});return a};var Q7e=ITe;(function(t,e){var i=wT,r=Q7e;function s(o,a){var l=new r(a);return l.process(o)}e=t.exports=s,e.FilterCSS=r;for(var n in i)e[n]=i[n]})(F7,F7.exports);var ute=F7.exports,hte={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,i=e.exec(t);return i?i.index:-1}},K7e=ute.FilterCSS,eWe=ute.getDefaultWhiteList,tz=hte;function LTe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height","loading"],ins:["datetime"],kbd:[],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var DTe=new K7e;function tWe(t,e,i){}function iWe(t,e,i){}function rWe(t,e,i){}function sWe(t,e,i){}function NTe(t){return t.replace(oWe,"&lt;").replace(aWe,"&gt;")}function nWe(t,e,i,r){if(i=BTe(i),e==="href"||e==="src"){if(i=tz.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(e==="background"){if($D.lastIndex=0,$D.test(i))return""}else if(e==="style"){if(Dle.lastIndex=0,Dle.test(i)||(Nle.lastIndex=0,Nle.test(i)&&($D.lastIndex=0,$D.test(i))))return"";r!==!1&&(r=r||DTe,i=r.process(i))}return i=GTe(i),i}var oWe=/</g,aWe=/>/g,lWe=/"/g,cWe=/&quot;/g,uWe=/&#([a-zA-Z0-9]*);?/gim,hWe=/&colon;?/gim,dWe=/&newline;?/gim,$D=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,Dle=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Nle=/u\s*r\s*l\s*\(.*/gi;function FTe(t){return t.replace(lWe,"&quot;")}function kTe(t){return t.replace(cWe,'"')}function UTe(t){return t.replace(uWe,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function zTe(t){return t.replace(hWe,":").replace(dWe," ")}function VTe(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return tz.trim(e)}function BTe(t){return t=kTe(t),t=UTe(t),t=zTe(t),t=VTe(t),t}function GTe(t){return t=FTe(t),t=NTe(t),t}function pWe(){return""}function fWe(t,e){typeof e!="function"&&(e=function(){});var i=!Array.isArray(t);function r(o){return i?!0:tz.indexOf(t,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",u=l.position+c.length;return s.push([n!==!1?n:l.position,u]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return tz.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function mWe(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("<!--",i);if(r===-1){e+=t.slice(i);break}e+=t.slice(i,r);var s=t.indexOf("-->",r);if(s===-1)break;i=s+3}return e}function gWe(t){var e=t.split("");return e=e.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),e.join("")}wn.whiteList=LTe();wn.getDefaultWhiteList=LTe;wn.onTag=tWe;wn.onIgnoreTag=iWe;wn.onTagAttr=rWe;wn.onIgnoreTagAttr=sWe;wn.safeAttrValue=nWe;wn.escapeHtml=NTe;wn.escapeQuote=FTe;wn.unescapeQuote=kTe;wn.escapeHtmlEntities=UTe;wn.escapeDangerHtml5Entities=zTe;wn.clearNonPrintableCharacter=VTe;wn.friendlyAttrValue=BTe;wn.escapeAttrValue=GTe;wn.onIgnoreTagStripAll=pWe;wn.StripTagBody=fWe;wn.stripCommentTag=mWe;wn.stripBlankChar=gWe;wn.attributeWrapSign='"';wn.cssFilter=DTe;wn.getDefaultCSSWhiteList=eWe;var BB={},Tv=hte;function yWe(t){var e=Tv.spaceIndex(t),i;return e===-1?i=t.slice(1,-1):i=t.slice(1,e+1),i=Tv.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function _We(t){return t.slice(0,2)==="</"}function vWe(t,e,i){var r="",s=0,n=!1,o=!1,a=0,l=t.length,c="",u="";e:for(a=0;a<l;a++){var d=t.charAt(a);if(n===!1){if(d==="<"){n=a;continue}}else if(o===!1){if(d==="<"){r+=i(t.slice(s,a)),n=a,s=a;continue}if(d===">"||a===l-1){r+=i(t.slice(s,n)),u=t.slice(n,a+1),c=yWe(u),r+=e(n,r.length,c,u,_We(u)),s=a+1,n=!1;continue}if(d==='"'||d==="'")for(var p=1,m=t.charAt(a-p);m.trim()===""||m==="=";){if(m==="="){o=d;continue e}m=t.charAt(a-++p)}}else if(d===o){o=!1;continue}}return s<l&&(r+=i(t.substr(s))),r}var bWe=/[^a-zA-Z0-9\\_:.-]/gim;function wWe(t,e){var i=0,r=0,s=[],n=!1,o=t.length;function a(p,m){if(p=Tv.trim(p),p=p.replace(bWe,"").toLowerCase(),!(p.length<1)){var g=e(p,m||"");g&&s.push(g)}}for(var l=0;l<o;l++){var c=t.charAt(l),u,d;if(n===!1&&c==="="){n=t.slice(i,l),i=l+1,r=t.charAt(i)==='"'||t.charAt(i)==="'"?i:SWe(t,l+1);continue}if(n!==!1&&l===r){if(d=t.indexOf(c,l+1),d===-1)break;u=Tv.trim(t.slice(r+1,d)),a(n,u),n=!1,l=d,i=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(d=xWe(t,l),d===-1){u=Tv.trim(t.slice(i,l)),a(u),n=!1,i=l+1;continue}else{l=d-1;continue}else if(d=TWe(t,l-1),d===-1){u=Tv.trim(t.slice(i,l)),u=Fle(u),a(n,u),n=!1,i=l+1;continue}else continue}return i<t.length&&(n===!1?a(t.slice(i)):a(n,Fle(Tv.trim(t.slice(i))))),Tv.trim(s.join(" "))}function xWe(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="="?e:-1}}function SWe(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="'"||i==='"'?e:-1}}function TWe(t,e){for(;e>0;e--){var i=t[e];if(i!==" ")return i==="="?e:-1}}function EWe(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function Fle(t){return EWe(t)?t.substr(1,t.length-2):t}BB.parseTag=vWe;BB.parseAttr=wWe;var CWe=ute.FilterCSS,ad=wn,jTe=BB,MWe=jTe.parseTag,AWe=jTe.parseAttr,H4=hte;function ID(t){return t==null}function PWe(t){var e=H4.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=H4.trim(t.slice(e+1,-1));var i=t[t.length-1]==="/";return i&&(t=H4.trim(t.slice(0,-1))),{html:t,closing:i}}function OWe(t){var e={};for(var i in t)e[i]=t[i];return e}function RWe(t){var e={};for(var i in t)Array.isArray(t[i])?e[i.toLowerCase()]=t[i].map(function(r){return r.toLowerCase()}):e[i.toLowerCase()]=t[i];return e}function HTe(t){t=OWe(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=ad.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=RWe(t.whiteList||t.allowList):t.whiteList=ad.whiteList,this.attributeWrapSign=t.singleQuotedAttributeValue===!0?"'":ad.attributeWrapSign,t.onTag=t.onTag||ad.onTag,t.onTagAttr=t.onTagAttr||ad.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||ad.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||ad.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||ad.safeAttrValue,t.escapeHtml=t.escapeHtml||ad.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new CWe(t.css))}HTe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,u=e.attributeWrapSign,d=e.cssFilter;i.stripBlankChar&&(t=ad.stripBlankChar(t)),i.allowCommentTag||(t=ad.stripCommentTag(t));var p=!1;i.stripIgnoreTagBody&&(p=ad.StripTagBody(i.stripIgnoreTagBody,n),n=p.onIgnoreTag);var m=MWe(t,function(g,y,v,b,w){var x={sourcePosition:g,position:y,isClosing:w,isWhite:Object.prototype.hasOwnProperty.call(r,v)},T=s(v,b,x);if(!ID(T))return T;if(x.isWhite){if(x.isClosing)return"</"+v+">";var C=PWe(b),M=r[v],O=AWe(C.html,function(D,k){var U=H4.indexOf(M,D)!==-1,H=o(v,D,k,U);return ID(H)?U?(k=l(v,D,k,d),k?D+"="+u+k+u:D):(H=a(v,D,k,U),ID(H)?void 0:H):H});return b="<"+v,O&&(b+=" "+O),C.closing&&(b+=" /"),b+=">",b}else return T=n(v,b,x),ID(T)?c(b):T},c);return p&&(m=p.remove(m)),m};var $We=HTe;(function(t,e){var i=wn,r=BB,s=$We;function n(a,l){var c=new s(l);return c.process(a)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,function(){for(var a in i)e[a]=i[a];for(var l in r)e[l]=r[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(N7,N7.exports);var GT=N7.exports,IWe=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},LWe=function(){function t(e,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],article:["style"],aside:["style"],audio:["autoplay","controls","loop","muted","preload"],b:[],blockquote:["style"],br:[],code:["style"],dd:["style"],details:["style"],div:["align","style","aria-label","aria-hidden"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],footer:["style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],header:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],main:["style"],mark:["style"],nav:["style"],ol:[],p:["style"],pre:["style"],section:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],summary:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],time:["style"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.arcgisCSSWhiteList=ez(ez({},GT.getDefaultCSSWhiteList()),{flex:!0,"flex-basis":!0,"flex-direction":!0,"flex-flow":!0,"flex-grow":!0,"flex-shrink":!0,"flex-wrap":!0,"line-height":!0,"justify-content":!0,overflow:!0}),this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?r.sanitizeUrl(a):GT.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!i?s=e:e&&i?(s=Object.create(this.arcgisFilterOptions),s.css={whiteList:this.arcgisCSSWhiteList},Object.keys(e).forEach(function(n){if(n==="whiteList")s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]);else if(n==="css"){var o=e.css.whiteList;o!=null&&e.css instanceof Object&&Object.keys(o).forEach(function(a){return s.css.whiteList[a]=o[a]})}else s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList,s.css={whiteList:this.arcgisCSSWhiteList}),this.xssFilterOptions=s,this._xssFilter=new GT.FilterXSS(s)}return t.prototype.sanitize=function(e,i){switch(i===void 0&&(i={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,i);default:return i.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,i){var r=(i??{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?GT.escapeAttrValue(e):!n&&!s?GT.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,i,r,s):GT.safeAttrValue(e,i,r,s)},t.prototype.validate=function(e,i){i===void 0&&(i={});var r=this.sanitize(e,i);return{isValid:e===r,sanitized:r}},t.prototype.encodeHTML=function(e){var i=this;return String(e).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},t.prototype.encodeAttrValue=function(e){var i=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(r,s){return i.test(r)?r:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var i={};return e.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},t.prototype._iterateOverObject=function(e,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(IWe(e)){var o=Object.keys(e);n=o.reduce(function(a,l){var c=e[l],u=r.validate(c,i);return u.isValid?a[l]=c:(s=!0,a[l]=u.sanitized),a},{})}else return i.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const GB=new Map;function qTe(){GB.clear()}function DWe(t){return GB.get(t)}function NWe(t,e){GB.set(t,e)}function b6(t){GB.delete(t)}function FWe(...t){const e=iu.acquire();for(let r=0;r<t.length;r++){const s=t[r],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const o in s)s[o]&&e.push(o)}const i=e.join(" ");return iu.release(e),i}(()=>{const t=new Map,e=new ResizeObserver(r=>{var s;qTe();for(const n of r)(s=t.get(n.target))==null||s(n)}),i=(r,s,n)=>(t.set(r,s),e.observe(r,n),Ni(()=>{e.unobserve(r),t.delete(r)}));return(r,s,n)=>{let o=null;return PS([ue(()=>typeof r=="function"?r():r,a=>{o==null||o.remove(),a&&(o=i(a,s,n))},sr),Ni(()=>o==null?void 0:o.remove())])}})();function kWe(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function TBt(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function EBt(t){const e="data-node-ref";this[t.getAttribute(e)]=t}const UWe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],zWe=UWe.reduce((t,e)=>(t[e]=[],t),{}),VWe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],WTe=new LWe({whiteList:zWe,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if(VWe.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function BWe(t){return t==="Enter"||t===" "}const YTe="http://www.w3.org/",jB=`${YTe}2000/svg`,ZTe=`${YTe}1999/xlink`;let kle=[],dte=(t,e)=>{let i={};return Object.keys(t).forEach(r=>{i[r]=t[r]}),e&&Object.keys(e).forEach(r=>{i[r]=e[r]}),i},pte=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),XTe=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},GWe=(t,e,i)=>{if(e.vnodeSelector!==""){for(let r=i;r<t.length;r++)if(pte(t[r],e))return r}return-1},w6=(t,e,i,r)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(pte(a,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},jWe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},k7=[],U7=!1,JTe=t=>{(t.children||[]).forEach(JTe),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},Ule=()=>{U7=!1,k7.forEach(JTe),k7.length=0},zle=t=>{k7.push(t),U7||(U7=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(Ule,{timeout:16}):setTimeout(Ule,16))},Vle=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i)return e.style.pointerEvents="none",void i(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),zle(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),zle(t))},HWe=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")V7(t,l,!0);else if(a==="classes"){let c=Object.keys(l),u=c.length;for(let d=0;d<u;d++){let p=c[d];l[p]&&t.classList.add(p)}}else if(a==="styles"){let c=Object.keys(l),u=c.length;for(let d=0;d<u;d++){let p=c[d],m=l[p];m&&(XTe(m),i.styleApplyer(t,p,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,t,e)),a==="oninput"&&function(){let u=l;l=function(d){u.apply(this,[d]),d.target["oninput-value"]=d.target.value}}()),t[a]=l):i.namespace===jB?a==="href"?t.setAttributeNS(ZTe,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=WTe.sanitize(l):z7(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function z7(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let iz,qWe=(t,e,i)=>{if(e)for(let r of e)iC(r,t,void 0,i)},QTe=(t,e,i)=>{qWe(t,e.children,i),e.text&&(t.textContent=e.text),HWe(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,i,e.vnodeSelector,e.properties,e.children])},iC=(t,e,i,r)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")s=t.domNode=a.createTextNode(t.text),i!==void 0?e.insertBefore(s,i):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let u=o.charAt(n-1),d=o.slice(n,l);u==="."?s.classList.add(d):u==="#"?s.id=d:(d==="svg"&&(r=dte(r,{namespace:jB})),r.namespace!==void 0?s=t.domNode=a.createElementNS(r.namespace,d):(s=t.domNode=t.domNode||a.createElement(d),d==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),i!==void 0?e.insertBefore(s,i):s.parentNode!==e&&e.appendChild(s)),n=l+1}}QTe(s,t,r)}},V7=(t,e,i)=>{e&&e.split(" ").forEach(r=>{r&&t.classList.toggle(r,i)})},WWe=(t,e,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=i[l],u=e[l];if(l==="class")u!==c&&(V7(t,u,!1),V7(t,c,!0));else if(l==="classes"){let d=t.classList,p=Object.keys(c),m=p.length;for(let g=0;g<m;g++){let y=p[g],v=!!c[y];v!==!!u[y]&&(s=!0,v?d.add(y):d.remove(y))}}else if(l==="styles"){let d=Object.keys(c),p=d.length;for(let m=0;m<p;m++){let g=d[m],y=c[g];y!==u[g]&&(s=!0,y?(XTe(y),r.styleApplyer(t,g,y)):r.styleApplyer(t,g,""))}}else if(c||typeof u!="string"||(c=""),l!=="value"||z7(t)){if(c!==u){let d=typeof c;d==="function"&&r.eventHandlerInterceptor||(r.namespace===jB?l==="href"?t.setAttributeNS(ZTe,l,c):t.setAttribute(l,c):d==="string"?l==="innerHTML"?t[l]=WTe.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):z7(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}else{let d=t[l];d!==c&&(t["oninput-value"]?d===t["oninput-value"]:c!==u)&&(t[l]=c,t["oninput-value"]=void 0),c!==u&&(s=!0)}}return s},YWe=(t,e,i,r,s)=>{if(i===r)return!1;r=r||kle;let n,o=(i=i||kle).length,a=r.length,l=0,c=0,u=!1;for(;c<a;){let d=l<o?i[l]:void 0,p=r[c];if(d!==void 0&&pte(d,p))u=iz(d,p,s)||u,l++;else{let m=GWe(i,p,l+1);if(m>=0){for(n=l;n<m;n++)Vle(i[n]),w6(i,n,t,"removed");u=iz(i[m],p,s)||u,l=m+1}else iC(p,e,l<o?i[l].domNode:void 0,s),jWe(p),w6(r,c,t,"added")}c++}if(o>l)for(n=l;n<o;n++)Vle(i[n]),w6(i,n,t,"removed");return u};iz=(t,e,i)=>{let r=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(o,r),e.domNode=o,s=!0,s}e.domNode=r}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(i=dte(i,{namespace:jB})),t.text!==e.text&&(n=!0,e.text===void 0?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,n=YWe(e,r,t.children,e.children,i)||n,n=WWe(r,t.properties,e.properties,i)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[r,i,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),s};let TP=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,iz(r,i,e)},domNode:t.domNode});const ZWe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}};let Q2=t=>dte(ZWe,t),Wv={create:(t,e)=>(e=Q2(e),iC(t,document.createElement("div"),void 0,e),TP(t,e)),append:(t,e,i)=>(i=Q2(i),iC(e,t,void 0,i),TP(e,i)),insertBefore:(t,e,i)=>(i=Q2(i),iC(e,t.parentNode,t,i),TP(e,i)),merge:(t,e,i)=>(i=Q2(i),e.domNode=t,QTe(t,e,i),TP(e,i)),replace:(t,e,i)=>(i=Q2(i),iC(e,t.parentNode,t,i),t.parentNode.removeChild(t),TP(e,i))},KTe,XWe=(t,e)=>{let i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i};KTe=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let JWe=(t,e)=>{let i=t;return e.forEach(r=>{i=i&&i.children?KTe(i.children,s=>s.domNode===r):void 0}),i},QWe=(t,e,i)=>{let r=function(s){i("domEvent",s);let n=e(),o=XWe(s.currentTarget,n.domNode);o.reverse();let a,l=JWe(n.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),a};return(s,n,o,a)=>r},Ble=t=>{let e,i,r=Q2(t),s=r.performanceLogger,n=!0,o=!1,a=[],l=[],c=(d,p,m)=>{let g,y=()=>g;r.eventHandlerInterceptor=QWe(e,y,s),g=d(p,m(),r),a.push(g),l.push(m)},u=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let d=0;d<a.length;d++){let p=l[d]();s("rendered",void 0),a[d].update(p),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:u,scheduleRender:()=>{i||o||(i=requestAnimationFrame(u))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,n=!0,e.scheduleRender()},append:(d,p)=>{c(Wv.append,d,p)},insertBefore:(d,p)=>{c(Wv.insertBefore,d,p)},merge:(d,p)=>{c(Wv.merge,d,p)},replace:(d,p)=>{c(Wv.replace,d,p)},detach:d=>{for(let p=0;p<l.length;p++)if(l[p]===d)return l.splice(p,1),a.splice(p,1)[0];throw new Error("renderFunction was not found")}},e},j_=class extends Re{constructor(){super(...arguments),this.items=new tt,this._watchUpdatingTracking=new u0,this._callbacks=new Map,this._projector=Ble(),this._hiddenProjector=Ble()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const r of i.added){const s=()=>r.render();this._callbacks.set(r,s),this._projector.append(this.surface,s)}for(const r of i.removed){const s=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(s.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,r=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);r.append(i,n),r.renderNow();const o={left:0,top:0,right:0,bottom:0};if(s!=null&&s.domNode){const a=s.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(r.detach(n);i.firstChild;)i.removeChild(i.firstChild);return o}overlaps(e,i){const r=this.computeBoundingRect(e),s=this.computeBoundingRect(i);return Math.max(r.left,s.left)<=Math.min(r.right,s.right)&&Math.max(r.top,s.top)<=Math.min(r.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,i){const r=!!(i!=null&&i.disableDecorations);if(!this.items.some(n=>n.visible&&!(r&&n.isDecoration)))return;const s=e.getContext("2d");s.save(),s.font=this._fontString(),this.items.forEach(n=>{r&&n.isDecoration||(s.save(),n.renderCanvas(s),s.restore())}),s.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};h([f({readOnly:!0})],j_.prototype,"surface",void 0),h([f({readOnly:!0})],j_.prototype,"items",void 0),h([f({readOnly:!0})],j_.prototype,"needsRender",null),h([f({readOnly:!0})],j_.prototype,"_watchUpdatingTracking",void 0),h([f({readOnly:!0})],j_.prototype,"updating",null),j_=h([I("esri.views.overlay.ViewOverlay")],j_);const Gle=j_,x6=[0,0];function KWe(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return x6[0]=i.left+((e==null?void 0:e.pageXOffset)??0),x6[1]=i.top+((e==null?void 0:e.pageYOffset)??0),x6}function jle(t){t&&(Nwe(t),t.parentNode&&t.parentNode.removeChild(t))}function eYe(t){const e=document.createElement("div");return t.appendChild(e),e}const EP=16,LD=750,tYe=512,iYe=2,rYe=t=>{let e=class extends t{constructor(...i){super(...i),this._freqInfo={freq:EP,time:LD},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([ue(()=>this.cursor,r=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",r)}),ue(()=>this.navigating,r=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",r.toString())})])}initialize(){this.addHandles([ue(()=>this.ui,(i,r)=>this._handleUIChange(i,r),cr),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=Le(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(i){const r=this._get("container"),s=gB(i);if(s||typeof i!="string"||ie.getLogger(this).error("#container",`element with id '${i}' not found`),r===s)return;if(this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(jle(this.root),this._set("root",null)),this.userContent&&(Eae(this.userContent,r),jle(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",Eae(s,n),s.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",s.insertBefore(o,s.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new Gle;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(ue(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=RS({render:()=>{var u;return(u=this.overlay)==null?void 0:u.render()}}):this._overlayRenderTaskHandle=Or(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){var i;(i=this.surface)==null||i.blur()}focus(){var i;(i=this.surface)==null||i.focus()}pageToContainer(i,r,s){const n=this.position;return i-=n?n[0]:0,r-=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const n=this.position;return i+=n?n[0]:0,r+=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){this.removeHandles("ui"),r&&r!==i&&r.destroy(),i&&(i.view=this,this.addHandles(ue(()=>this.root,s=>{i.container=s?eYe(s):null},cr),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=EP,i.time=LD,this.addHandles([PA(window,"resize",()=>{i.freq=EP,i.time=LD}),RS({prepare:r=>{const s=this._measure(),n=this._freqInfo;if(n.time+=r.deltaTime,s&&(n.freq=EP,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?EP:Math.min(LD,n.freq*iYe),!s&&n.freq>=tYe&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return r===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=i&&KWe(i);return!!s&&(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return h([f()],e.prototype,"container",null),h([f({readOnly:!0})],e.prototype,"focused",null),h([f({readOnly:!0})],e.prototype,"height",void 0),h([f()],e.prototype,"messagesCommon",void 0),h([f({type:Gle})],e.prototype,"overlay",void 0),h([f({readOnly:!0})],e.prototype,"position",void 0),h([f({readOnly:!0})],e.prototype,"resizing",void 0),h([f({readOnly:!0})],e.prototype,"root",void 0),h([f({value:null,readOnly:!0})],e.prototype,"size",null),h([f({readOnly:!0})],e.prototype,"surface",void 0),h([f({readOnly:!0})],e.prototype,"suspended",void 0),h([f()],e.prototype,"ui",void 0),h([f({readOnly:!0})],e.prototype,"userContent",void 0),h([f({readOnly:!0})],e.prototype,"width",void 0),h([f()],e.prototype,"widthBreakpoint",void 0),e=h([I("esri.views.DOMContainer")],e),e};function nb(t,e,i,r){return{x:t,y:e,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function MBt(t,e,i,r,s){t.x=e,t.y=i,t.z=r,t.hasZ=r!=null,t.spatialReference=s}function Zn(t,e,i,r,s){return!(e==null||r==null||t.length<2)&&(CP.x=t[0],CP.y=t[1],CP.z=t[2],CP.spatialReference=e,il(CP,i,r,s))}const CP=nb(0,0,0,We.WGS84);function ob(t,e,i){return!!Zn(t,e,DD,i.spatialReference)&&(i.x=DD[0],i.y=DD[1],i.z=DD[2],!0)}async function e2e(t,e,i,r){return await iL(e,i.spatialReference,null,r),ob(t,e,i)}const DD=E();function sYe(t){return gs(t,eC)||dT(t)?{wkid:au.GCSMARS2000}:gs(t,tC)||pT(t)?{wkid:au.GCSMOON2000}:We.WGS84}var Ge;function Hle(t){return t==="global"?Ge.Global:Ge.Local}function S6(t){return t===Ge.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(Ge||(Ge={}));var Zr,ta;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL",t[t.TILES3D=8]="TILES3D"})(Zr||(Zr={}));let nYe=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=ta.ALL,this.normalRequired=!0}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(ta||(ta={}));let oYe=class{constructor(e,i,r){this.object=e,this.geometryId=i,this.triangleNr=r}},aYe=class extends oYe{constructor(e,i,r,s){super(e,i,r),this.center=s!=null?Xs(s):null}},t2e=class{constructor(e){this.layerUid=e}},oL=class extends t2e{constructor(e,i){super(e),this.graphicUid=i}};function Zd(t){return(t==null?void 0:t.dist)!=null}function qle(t){return(e,i,r)=>(yr(Wle,e,i,r),!ste(t,Wle))}function HB(t){return Zd(t)&&t.intersector===Zr.OBJECT&&!!t.target}function qB(t){return Zd(t)&&t.intersector===Zr.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const Wle=E();function Xd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function lYe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function fte(t,e,i,r,s,n,o,a,l,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function WB(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function xT(t,e){if(t===e){const i=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function aL(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*o-a*c,p=-u*n+a*l,m=c*n-o*l;let g=i*d+r*p+s*m;return g?(g=1/g,t[0]=d*g,t[1]=(-u*r+s*c)*g,t[2]=(a*r-s*o)*g,t[3]=p*g,t[4]=(u*i-s*l)*g,t[5]=(-a*i+s*n)*g,t[6]=m*g,t[7]=(-c*i+r*l)*g,t[8]=(o*i-r*n)*g,t):null}function cYe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=o*u-a*c,t[1]=s*c-r*u,t[2]=r*a-s*o,t[3]=a*l-n*u,t[4]=i*u-s*l,t[5]=s*n-i*a,t[6]=n*c-o*l,t[7]=r*l-i*c,t[8]=i*o-r*n,t}function uYe(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*n-o*l)+i*(-c*s+o*a)+r*(l*s-n*a)}function jM(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=i[0],m=i[1],g=i[2],y=i[3],v=i[4],b=i[5],w=i[6],x=i[7],T=i[8];return t[0]=p*r+m*o+g*c,t[1]=p*s+m*a+g*u,t[2]=p*n+m*l+g*d,t[3]=y*r+v*o+b*c,t[4]=y*s+v*a+b*u,t[5]=y*n+v*l+b*d,t[6]=w*r+x*o+T*c,t[7]=w*s+x*a+T*u,t[8]=w*n+x*l+T*d,t}function HM(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=i[0],m=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=a,t[5]=l,t[6]=p*r+m*o+c,t[7]=p*s+m*a+u,t[8]=p*n+m*l+d,t}function YB(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=Math.sin(i),m=Math.cos(i);return t[0]=m*r+p*o,t[1]=m*s+p*a,t[2]=m*n+p*l,t[3]=m*o-p*r,t[4]=m*a-p*s,t[5]=m*l-p*n,t[6]=c,t[7]=u,t[8]=d,t}function lL(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function hYe(t,e,i){const r=i[0],s=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function dYe(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function pYe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function fYe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function mYe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function YI(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i+i,a=r+r,l=s+s,c=i*o,u=r*o,d=r*a,p=s*o,m=s*a,g=s*l,y=n*o,v=n*a,b=n*l;return t[0]=1-d-g,t[3]=u-b,t[6]=p+v,t[1]=u+b,t[4]=1-c-g,t[7]=m-y,t[2]=p-v,t[5]=m+y,t[8]=1-c-d,t}function i2e(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10],d=u*o-a*c,p=-u*n+a*l,m=c*n-o*l,g=i*d+r*p+s*m;if(!g)return null;const y=1/g;return t[0]=d*y,t[1]=(-u*r+s*c)*y,t[2]=(a*r-s*o)*y,t[3]=p*y,t[4]=(u*i-s*l)*y,t[5]=(-a*i+s*n)*y,t[6]=m*y,t[7]=(-c*i+r*l)*y,t[8]=(o*i-r*n)*y,t}function D1(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],m=e[11],g=e[12],y=e[13],v=e[14],b=e[15],w=i*a-r*o,x=i*l-s*o,T=i*c-n*o,C=r*l-s*a,M=r*c-n*a,O=s*c-n*l,D=u*y-d*g,k=u*v-p*g,U=u*b-m*g,H=d*v-p*y,z=d*b-m*y,Z=p*b-m*v;let q=w*Z-x*z+T*H+C*U-M*k+O*D;return q?(q=1/q,t[0]=(a*Z-l*z+c*H)*q,t[1]=(l*U-o*Z-c*k)*q,t[2]=(o*z-a*U+c*D)*q,t[3]=(s*z-r*Z-n*H)*q,t[4]=(i*Z-s*U+n*k)*q,t[5]=(r*U-i*z-n*D)*q,t[6]=(y*O-v*M+b*C)*q,t[7]=(v*T-g*O-b*x)*q,t[8]=(g*M-y*T+b*w)*q,t):null}function gYe(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function yYe(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function _Ye(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function vYe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function r2e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function bYe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function wYe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t}function xYe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function SYe(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=e[0],p=e[1],m=e[2],g=e[3],y=e[4],v=e[5],b=e[6],w=e[7],x=e[8],T=Lo();return Math.abs(i-d)<=T*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(r-p)<=T*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(s-m)<=T*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-g)<=T*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(o-y)<=T*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(a-v)<=T*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-b)<=T*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-w)<=T*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(u-x)<=T*Math.max(1,Math.abs(u),Math.abs(x))}function TYe(t){const e=Lo(),i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+u*u))<=e}const EYe=jM,CYe=r2e;Object.freeze(Object.defineProperty({__proto__:null,add:vYe,adjoint:cYe,copy:lYe,determinant:uYe,equals:SYe,exactEquals:xYe,frob:_Ye,fromMat2d:mYe,fromMat4:Xd,fromQuat:YI,fromRotation:pYe,fromScaling:fYe,fromTranslation:dYe,identity:WB,invert:aL,isOrthoNormal:TYe,mul:EYe,multiply:jM,multiplyScalar:bYe,multiplyScalarAndAdd:wYe,normalFromMat4:D1,normalFromMat4Legacy:i2e,projection:gYe,rotate:YB,scale:lL,scaleByVec2:hYe,set:fte,str:yYe,sub:CYe,subtract:r2e,translate:HM,transpose:xT},Symbol.toStringTag,{value:"Module"}));function MYe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function rz(t,e,i){i*=.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function ZB(t,e){const i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>Lo()?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function XB(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*u+o*a+s*c-n*l,t[1]=s*u+o*l+n*a-r*c,t[2]=n*u+o*c+r*l-s*a,t[3]=o*u-r*a-s*l-n*c,t}function AYe(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+o*a,t[1]=s*l+n*a,t[2]=n*l-s*a,t[3]=o*l-r*a,t}function PYe(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l-n*a,t[1]=s*l+o*a,t[2]=n*l+r*a,t[3]=o*l-s*a,t}function OYe(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*a,t[1]=s*l-r*a,t[2]=n*l+o*a,t[3]=o*l-n*a,t}function RYe(t,e){const i=e[0],r=e[1],s=e[2];return t[0]=i,t[1]=r,t[2]=s,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),t}function q4(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3];let l,c,u,d,p,m=i[0],g=i[1],y=i[2],v=i[3];return c=s*m+n*g+o*y+a*v,c<0&&(c=-c,m=-m,g=-g,y=-y,v=-v),1-c>Lo()?(l=Math.acos(c),u=Math.sin(l),d=Math.sin((1-r)*l)/u,p=Math.sin(r*l)/u):(d=1-r,p=r),t[0]=d*s+p*m,t[1]=d*n+p*g,t[2]=d*o+p*y,t[3]=d*a+p*v,t}function $Ye(t){const e=G3,i=e(),r=e(),s=e(),n=Math.sqrt(1-i),o=Math.sqrt(i);return t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=o*Math.sin(2*Math.PI*s),t[3]=o*Math.cos(2*Math.PI*s),t}function IYe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-s*a,t[3]=n*a,t}function o1(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function s2e(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;r=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*o+o]+1),t[s]=.5*r,r=.5/r,t[3]=(e[3*n+o]-e[3*o+n])*r,t[n]=(e[3*n+s]+e[3*s+n])*r,t[o]=(e[3*o+s]+e[3*s+o])*r}return t}function LYe(t,e,i,r){const s=.5*Math.PI/180;e*=s,i*=s,r*=s;const n=Math.sin(e),o=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),u=Math.cos(r);return t[0]=n*l*u-o*a*c,t[1]=o*a*u+n*l*c,t[2]=o*l*c-n*a*u,t[3]=o*l*u+n*a*c,t}function DYe(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const NYe=Rd,n2e=ds,FYe=Zee,kYe=XB,UYe=HS,zYe=tTe,VYe=LB,o2e=Xee,BYe=o2e,a2e=Jee,GYe=a2e,mte=eTe,jYe=BC,HYe=qS;function qYe(t,e,i){const r=pe(e,i);return r<-.999999?(ot(Gf,WYe,e),Ml(Gf)<1e-6&&ot(Gf,YYe,e),ge(Gf,Gf),rz(t,Gf,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ot(Gf,e,i),t[0]=Gf[0],t[1]=Gf[1],t[2]=Gf[2],t[3]=1+r,mte(t,t))}const Gf=E(),WYe=$e(1,0,0),YYe=$e(0,1,0);function ZYe(t,e,i,r,s,n){return q4(Yle,e,s,n),q4(Zle,i,r,n),q4(t,Yle,Zle,2*n*(1-n)),t}const Yle=Oh(),Zle=Oh();function XYe(t,e,i,r){const s=JYe;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],mte(t,s2e(t,s))}const JYe=Gr();Object.freeze(Object.defineProperty({__proto__:null,add:FYe,calculateW:RYe,conjugate:o1,copy:NYe,dot:zYe,equals:HYe,exactEquals:jYe,fromEuler:LYe,fromMat3:s2e,getAxisAngle:ZB,identity:MYe,invert:IYe,len:BYe,length:o2e,lerp:VYe,mul:kYe,multiply:XB,normalize:mte,random:$Ye,rotateX:AYe,rotateY:PYe,rotateZ:OYe,rotationTo:qYe,scale:UYe,set:n2e,setAxes:XYe,setAxisAngle:rz,slerp:q4,sqlerp:ZYe,sqrLen:GYe,squaredLength:a2e,str:DYe},Symbol.toStringTag,{value:"Module"}));function l2e(t,e,i){const r=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function QYe(t,e,i){return l2e(t,e,i),bu(i,i),i}function mu(t,e,i,r){if(t==null||r==null)return!1;const s=jU(t,lqe),n=jU(r,cqe);if(s===n&&!Xle(n)&&(s!==se.UNKNOWN||gs(t,r)))return yT(i,e),!0;if(Xle(n)){const o=CO[s][se.LON_LAT],a=CO[se.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,d_,0),a(d_,0,p_,0),l2e(ND*d_[0],ND*d_[1],i),i[12]=p_[0],i[13]=p_[1],i[14]=p_[2],!0)}if(!(n!==se.WEB_MERCATOR&&n!==se.PLATE_CARREE&&n!==se.WGS84&&n!==se.CGCS2000||s!==se.WGS84&&s!==se.SPHERICAL_ECEF&&s!==se.WEB_MERCATOR&&s!==se.CGCS2000)){const o=CO[s][se.LON_LAT],a=CO[se.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,d_,0),a(d_,0,p_,0),s===se.SPHERICAL_ECEF?QYe(ND*d_[0],ND*d_[1],i):Gd(i),i[12]=p_[0],i[13]=p_[1],i[14]=p_[2],!0)}return!1}function Xle(t){return t===se.SPHERICAL_ECEF||t===se.SPHERICAL_MARS_PCPF||t===se.SPHERICAL_MOON_PCPF}const ND=Rt(1),d_=E(),p_=E();let cL=class{constructor(e,i,r=i){this.data=e,this.size=i,this.stride=r}},it=class extends cL{constructor(e,i,r,s=!1,n=r){super(e,r,n),this.indices=i,this.exclusive=s}};const qM=1e-6,MP=E(),FD=E();function KYe(t,e){const{data:i,size:r}=t,s=i.length/r;if(s<=0)return;const n=new cZe(t);G7(MP,n.minProj,n.maxProj),OO(MP,MP,.5),wd(FD,n.maxProj,n.minProj);const o=B7(FD),a=new uZe;a.quality=o,s<14&&(t=new cL(new Float64Array(n.buffer,112,42),3));const l=E(),c=E(),u=E(),d=E(),p=E(),m=E(),g=E();switch(eZe(n,t,g,l,c,u,d,p,m,a)){case 1:return void ece(MP,FD,e);case 2:return void aZe(t,d,e)}tZe(t,g,l,c,u,d,p,m,a),c2e(t,a.b0,a.b1,a.b2,jC,HC);const y=E();wd(y,HC,jC),a.quality=B7(y),a.quality<o?u2e(a.b0,a.b1,a.b2,jC,HC,y,e):ece(MP,FD,e)}function eZe(t,e,i,r,s,n,o,a,l,c){return iZe(t,r,s),j7(r,s)<qM?1:(wd(o,r,s),ga(o,o),rZe(e,r,o,n)<qM?2:(wd(a,s,n),ga(a,a),wd(l,n,r),ga(l,l),xd(i,a,o),ga(i,i),ww(e,i,o,a,l,c),0))}const AP=E(),PP=E(),Ih=E(),Lh=E(),Dh=E(),f_=E(),m_=E(),g_=E();function tZe(t,e,i,r,s,n,o,a,l){sZe(t,e,i,AP,PP),AP[0]!==void 0&&(wd(Ih,AP,i),ga(Ih,Ih),wd(Lh,AP,r),ga(Lh,Lh),wd(Dh,AP,s),ga(Dh,Dh),xd(f_,Lh,n),ga(f_,f_),xd(m_,Dh,o),ga(m_,m_),xd(g_,Ih,a),ga(g_,g_),ww(t,f_,n,Lh,Ih,l),ww(t,m_,o,Dh,Lh,l),ww(t,g_,a,Ih,Dh,l)),PP[0]!==void 0&&(wd(Ih,PP,i),ga(Ih,Ih),wd(Lh,PP,r),ga(Lh,Lh),wd(Dh,PP,s),ga(Dh,Dh),xd(f_,Lh,n),ga(f_,f_),xd(m_,Dh,o),ga(m_,m_),xd(g_,Ih,a),ga(g_,g_),ww(t,f_,n,Lh,Ih,l),ww(t,m_,o,Dh,Lh,l),ww(t,g_,a,Ih,Dh,l))}function iZe(t,e,i){let r=j7(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const o=j7(t.maxVert[n],t.minVert[n]);o>r&&(r=o,s=n)}gh(e,t.minVert[s]),gh(i,t.maxVert[s])}const Nh=[0,0,0];function rZe(t,e,i,r){const{data:s,size:n}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){Nh[0]=s[l]-e[0],Nh[1]=s[l+1]-e[1],Nh[2]=s[l+2]-e[2];const c=i[0]*Nh[0]+i[1]*Nh[1]+i[2]*Nh[2],u=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],d=Nh[0]*Nh[0]+Nh[1]*Nh[1]+Nh[2]*Nh[2]-c*c/u;d>o&&(o=d,a=l)}return gh(r,s,a),o}const oo=lt();function sZe(t,e,i,r,s){oZe(t,e,oo,s,r);const n=d2e(i,e);oo[1]-qM<=n&&(r[0]=void 0),oo[0]+qM>=n&&(s[0]=void 0)}const Jle=E(),Qle=E(),Kle=E(),jT=E(),HT=E(),kD=E();function ww(t,e,i,r,s,n){if(h2e(e)<qM)return;xd(Jle,i,e),xd(Qle,r,e),xd(Kle,s,e),GC(t,e,oo),HT[1]=oo[0],jT[1]=oo[1],kD[1]=jT[1]-HT[1];const o=[i,r,s],a=[Jle,Qle,Kle];for(let l=0;l<3;++l){GC(t,o[l],oo),HT[0]=oo[0],jT[0]=oo[1],GC(t,a[l],oo),HT[2]=oo[0],jT[2]=oo[1],kD[0]=jT[0]-HT[0],kD[2]=jT[2]-HT[2];const c=B7(kD);c<n.quality&&(gh(n.b0,o[l]),gh(n.b1,e),gh(n.b2,a[l]),n.quality=c)}}const nZe=E();function GC(t,e,i){const{data:r,size:s}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const o=r[n]*e[0]+r[n+1]*e[1]+r[n+2]*e[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function oZe(t,e,i,r,s){const{data:n,size:o}=t;gh(r,n),gh(s,r),i[0]=d2e(nZe,e),i[1]=i[0];for(let a=o;a<n.length;a+=o){const l=n[a]*e[0]+n[a+1]*e[1]+n[a+2]*e[2];l<i[0]&&(i[0]=l,gh(r,n,a)),l>i[1]&&(i[1]=l,gh(s,n,a))}}function ece(t,e,i){i.center=t,i.halfSize=oe(e,e,.5),i.quaternion=Hee}const Wg=E(),qT=E(),OP=E(),jC=E(),HC=E(),tce=E();function aZe(t,e,i){gh(Wg,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?Wg[0]=0:Math.abs(e[1])>Math.abs(e[2])?Wg[1]=0:Wg[2]=0,h2e(Wg)<qM&&(Wg[0]=Wg[1]=Wg[2]=1),xd(qT,e,Wg),ga(qT,qT),xd(OP,e,qT),ga(OP,OP),c2e(t,e,qT,OP,jC,HC),wd(tce,HC,jC),u2e(e,qT,OP,jC,HC,tce,i)}function c2e(t,e,i,r,s,n){GC(t,e,oo),s[0]=oo[0],n[0]=oo[1],GC(t,i,oo),s[1]=oo[0],n[1]=oo[1],GC(t,r,oo),s[2]=oo[0],n[2]=oo[1]}const Rb=E(),RP=E(),UD=E(),jf=U$(1,0,0,0,1,0,0,0,1),lZe=Oh();function u2e(t,e,i,r,s,n,o){jf[0]=t[0],jf[1]=t[1],jf[2]=t[2],jf[3]=e[0],jf[4]=e[1],jf[5]=e[2],jf[6]=i[0],jf[7]=i[1],jf[8]=i[2],o.quaternion=hZe(lZe,jf),G7(Rb,r,s),OO(Rb,Rb,.5),OO(RP,t,Rb[0]),OO(UD,e,Rb[1]),G7(RP,RP,UD),OO(UD,i,Rb[2]),o.center=me(RP,RP,UD),o.halfSize=oe(Rb,n,.5)}const Pu=7;let cZe=class{constructor(e){this.minVert=new Array(Pu),this.maxVert=new Array(Pu);const i=64*Pu;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,Pu),r+=8*Pu,this.maxProj=new Float64Array(this.buffer,r,Pu),r+=8*Pu;for(let l=0;l<Pu;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Pu;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Pu;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(Pu),n=new Array(Pu),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<Pu;++l){let c=s[l];gh(this.minVert[l],o,c),c=n[l],gh(this.maxVert[l],o,c)}}},uZe=class{constructor(){this.b0=$e(1,0,0),this.b1=$e(0,1,0),this.b2=$e(0,0,1),this.quality=0}};function B7(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function G7(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}function wd(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}function OO(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}function gh(t,e,i=0){t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2]}function xd(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2];t[0]=s*l-n*a,t[1]=n*o-r*l,t[2]=r*a-s*o}function ga(t,e){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i>0){const r=1/Math.sqrt(i);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}}function h2e(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function j7(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function d2e(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function hZe(t,e){const i=e[0]+e[4]+e[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r}else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let o=Math.sqrt(e[3*r+r]-e[3*s+s]-e[3*n+n]+1);t[r]=.5*o,o=.5/o,t[3]=(e[3*s+n]-e[3*n+s])*o,t[s]=(e[3*s+r]+e[3*r+s])*o,t[n]=(e[3*n+r]+e[3*r+n])*o}return t}let gte=class W4{constructor(e=$n,i=bZe,r=Hee){this._data=[e[0],e[1],e[2],i[0],i[1],i[2],r[0],r[1],r[2],r[3]]}clone(){const e=new W4;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const i=new W4;return i._data=e.slice(),i}static fromJSON(e){return new W4(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return ne(Ye.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,i,r){this._data[0]=e,this._data[1]=i,this._data[2]=r}get halfSize(){return ne(Ye.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return n2e(Qqe.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const i=cs,r=this._data;i[0]=r[6],i[1]=r[7],i[2]=r[8],i[3]=r[9];for(let s=0;s<8;++s){const n=e[s];n[0]=(1&s?-1:1)*r[3],n[1]=(2&s?-1:1)*r[4],n[2]=(4&s?-1:1)*r[5],Jc(n,n,i),n[0]+=r[0],n[1]+=r[1],n[2]+=r[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],i=this._data[4],r=this._data[5];return Math.sqrt(e*e+i*i+r*r)}intersectSphere(e){hi[0]=this._data[0]-e[0],hi[1]=this._data[1]-e[1],hi[2]=this._data[2]-e[2];const i=this.getQuaternion(Qy);return o1(cs,i),Jc(hi,hi,cs),xM(hi,hi),Yg[0]=Math.min(hi[0],this._data[3]),Yg[1]=Math.min(hi[1],this._data[4]),Yg[2]=Math.min(hi[2],this._data[5]),DI(Yg,hi)<e[3]*e[3]}intersectSphereWithMBS(e,i=this.radius){const r=this._data;hi[0]=r[0]-e[0],hi[1]=r[1]-e[1],hi[2]=r[2]-e[2];const s=e[3],n=s+i;return!(yU(hi)>n*n)&&(cs[0]=-r[6],cs[1]=-r[7],cs[2]=-r[8],cs[3]=r[9],Jc(hi,hi,cs),xM(hi,hi),Yg[0]=Math.min(hi[0],r[3]),Yg[1]=Math.min(hi[1],r[4]),Yg[2]=Math.min(hi[2],r[5]),DI(Yg,hi)<s*s)}intersectPlane(e){const i=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],r=this.projectedRadius(e);return i>r?1:i<-r?-1:0}intersectRay(e,i,r=0){const s=this._data,n=cs;n[0]=-s[6],n[1]=-s[7],n[2]=-s[8],n[3]=s[9],hi[0]=e[0]-s[0],hi[1]=e[1]-s[1],hi[2]=e[2]-s[2];const o=Jc(hi,hi,cs),a=Jc(Yg,i,cs);let l=-1/0,c=1/0;const u=this.getHalfSize(qC);for(let d=0;d<3;d++){const p=o[d],m=a[d],g=u[d]+r;if(Math.abs(m)>1e-6){const y=(g-p)/m,v=(-g-p)/m;l=Math.max(l,Math.min(y,v)),c=Math.min(c,Math.max(y,v))}else if(p>g||p<-g)return!1}return l<=c}projectedArea(e,i,r,s){const n=this.getQuaternion(Qy);o1(cs,n),hi[0]=e[0]-this._data[0],hi[1]=e[1]-this._data[1],hi[2]=e[2]-this._data[2],Jc(hi,hi,cs);const o=this.getHalfSize(qC),a=hi[0]<-o[0]?-1:hi[0]>o[0]?1:0,l=hi[1]<-o[1]?-1:hi[1]>o[1]?1:0,c=hi[2]<-o[2]?-1:hi[2]>o[2]?1:0,u=Math.abs(a)+Math.abs(l)+Math.abs(c);if(u===0)return 1/0;const d=u===1?4:6,p=6*(a+3*l+9*c+13);YI(K2,n),lL(K2,K2,o);const m=this.getCenter(tf);for(let v=0;v<d;v++){const b=pZe[p+v];ne(hi,((1&b)<<1)-1,(2&b)-1,((4&b)>>1)-1),Qo(hi,hi,K2),me($b,m,hi),$b[3]=1,hu($b,$b,i);const w=1/Math.max(1e-6,$b[3]);ap[2*v]=$b[0]*w,ap[2*v+1]=$b[1]*w}const g=2*d-2;let y=ap[0]*(ap[3]-ap[g+1])+ap[g]*(ap[1]-ap[g-1]);for(let v=2;v<g;v+=2)y+=ap[v]*(ap[v+3]-ap[v-1]);return Math.abs(y)*r*s*.125}projectedRadius(e){const i=this.getQuaternion(Qy);return o1(cs,i),Jc(hi,e,cs),Math.abs(hi[0]*this._data[3])+Math.abs(hi[1]*this._data[4])+Math.abs(hi[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius(e)}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius(e)}toAaBoundingBox(e){const i=this.getQuaternion(Qy),r=YI(K2,i),s=this._data[3]*Math.abs(r[0])+this._data[4]*Math.abs(r[3])+this._data[5]*Math.abs(r[6]),n=this._data[3]*Math.abs(r[1])+this._data[4]*Math.abs(r[4])+this._data[5]*Math.abs(r[7]),o=this._data[3]*Math.abs(r[2])+this._data[4]*Math.abs(r[5])+this._data[5]*Math.abs(r[8]);e[0]=this._data[0]-s,e[1]=this._data[1]-n,e[2]=this._data[2]-o,e[3]=this._data[0]+s,e[4]=this._data[1]+n,e[5]=this._data[2]+o}transform(e,i,r,s=0,n=xu(r),o=xu(i),a=R1(i,o)){if(r===n)i.isGeographic?yZe(this,e,i,s,o):gZe(this,e,i,s,o,a);else if(i.isWGS84&&(r.isWebMercator||NS(r)))fZe(i,this,r,e,s);else if(i.isWebMercator&&NS(r))mZe(i,this,r,e,s);else{const l=this.getCenter(tf);l[2]+=s,ns(l,i,0,l,r,0,1),e.center=l,this!==e&&(e.quaternion=this.getQuaternion(Qy),e.halfSize=this.getHalfSize(qC))}}};const cs=Oh(),Qy=Oh(),dZe=Oh(),hi=E(),Yg=E(),$b=Qt();function p2e(t,e=new gte){return KYe(t,e),e}const ap=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],pZe=(()=>{const t=new Int8Array(162);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),t})();function f2e(t,e,i,r,s){const n=t.getQuaternion(Qy);s.quaternion=n,o1(cs,n);const o=t.getCenter(tf),a=t.getHalfSize(qC);if(r===Ge.Global){Jc(zr,o,cs),xM(zp,zr),pbe(Ru,zp,a),Ai(Ru,zp,Ru);const l=Ae(Ru);me(Ru,zp,a);const c=Ae(Ru);if(l<i)s.center=o,ne(zr,i,i,i),s.halfSize=me(zr,a,zr);else{const u=c>0?1+e/c:1,d=l>0?1+i/l:1,p=(d+u)/2,m=(d-u)/2;oe(Ru,zp,m),s.halfSize=On(Ru,Ru,a,p),oe(Ru,zp,p),On(Ru,Ru,a,m),dbe(zr,zr),nB(zr,Ru,zr);const g=t.getQuaternion(dZe);s.center=Jc(zr,zr,g)}}else{s.center=On(zr,o,wM,(i+e)/2);const l=Jc(zr,wM,cs);xM(l,l),s.halfSize=On(zp,a,l,(i-e)/2)}return s}function fZe(t,e,i,r,s){e.getCenter(tf),tf[2]+=s;const n=xu(i);ns(tf,t,0,tf,n,0,1),m2e(n,e,tf,i,r)}function mZe(t,e,i,r,s){e.getCenter(tf),tf[2]+=s,m2e(t,e,tf,i,r)}function m2e(t,e,i,r,s){const n=e.getQuaternion(Qy),o=YI(K2,n),a=e.getHalfSize(qC);for(let l=0;l<8;++l){for(let c=0;c<3;++c)Bm[c]=a[c]*(l&1<<c?-1:1);for(let c=0;c<3;++c){let u=i[c];for(let d=0;d<3;++d)u+=Bm[d]*o[3*d+c];Y4[3*l+c]=u}}ns(Y4,t,0,Y4,r,0,8),p2e(_Ze,s)}function gZe(t,e,i,r,s=xu(i),n=R1(i,s)){t.getCorners(ice),t.getCenter(Bm),Bm[2]+=r,mu(i,Bm,Ou,s),e.setCenter(Ou[12],Ou[13],Ou[14]);const o=2*Math.sqrt(1+Ou[0]+Ou[5]+Ou[10]);cs[0]=(Ou[6]-Ou[9])/o,cs[1]=(Ou[8]-Ou[2])/o,cs[2]=(Ou[1]-Ou[4])/o,cs[3]=.25*o;const a=t.getQuaternion(Qy);e.quaternion=XB(cs,cs,a),o1(cs,cs),ne(zp,0,0,0);const l=e.getCenter(vZe);for(const c of ice)c[2]+=r,n(c,0,c,0),Ai(zr,c,l),Jc(zr,zr,cs),xM(zr,zr),fbe(zp,zp,zr);e.halfSize=zp}function yZe(t,e,i,r,s=xu(i)){const n=ur(i),o=1+Math.max(0,r)/(n.radius+t.centerZ);t.getCenter(Bm),Bm[2]+=r,ns(Bm,i,0,Bm,s,0,1),e.center=Bm;const a=t.getQuaternion(Qy);e.quaternion=a,o1(cs,a),ne(zr,0,0,1),Jc(zr,zr,cs);const l=t.getHalfSize(qC);ne(zr,l[0]*Math.abs(zr[0]),l[1]*Math.abs(zr[1]),l[2]*Math.abs(zr[2])),oe(zr,zr,n.inverseFlattening),me(zr,l,zr),e.halfSize=oe(zr,zr,o)}const Y4=new Array(24),_Ze=new cL(Y4,3),Bm=E(),tf=E(),vZe=E(),qC=E(),K2=Gr(),Ou=Ee(),ice=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],zr=E(),zp=E(),Ru=E(),bZe=$e(-1,-1,-1);let wZe=class{constructor(){this._transform=Ee(),this._transformInverse=new zD({value:this._transform},In,Ee),this._transformInverseTranspose=new zD(this._transformInverse,bu,Ee),this._transformTranspose=new zD({value:this._transform},bu,Ee),this._transformInverseRotation=new zD({value:this._transform},i2e,Gr)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){vn(this._transform,e)}multiplyTransform(e){dr(this._transform,this._transform,e)}set(e){vn(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,i){this.setTransformMatrix(e),this.multiplyTransform(i),this._invalidateLazyTransforms()}},zD=class{constructor(e,i,r){this._original=e,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},xZe=class{constructor(e=0){this.offset=e,this.tmpVertex=E()}applyToVertex(e,i,r){const s=ne(yte,e,i,r),n=me(g2e,s,this.localOrigin),o=this.offset/Ae(n);return On(this.tmpVertex,s,n,o),this.tmpVertex}applyToAabb(e){const i=CZe,r=MZe,s=AZe;for(let l=0;l<3;++l)i[l]=e[0+l]+this.localOrigin[l],r[l]=e[3+l]+this.localOrigin[l],s[l]=i[l];const n=this.applyToVertex(i[0],i[1],i[2]);for(let l=0;l<3;++l)e[l]=n[l],e[l+3]=n[l];const o=l=>{const c=this.applyToVertex(l[0],l[1],l[2]);for(let u=0;u<3;++u)e[u]=Math.min(e[u],c[u]),e[u+3]=Math.max(e[u+3],c[u])};for(let l=1;l<8;++l){for(let c=0;c<3;++c)s[c]=l&1<<c?r[c]:i[c];o(s)}let a=0;for(let l=0;l<3;++l)i[l]*r[l]<0&&(a|=1<<l);if(a!==0&&a!==7){for(let l=0;l<8;++l)if(!(a&l)){for(let c=0;c<3;++c)s[c]=a&1<<c?0:l&1<<c?i[c]:r[c];o(s)}}for(let l=0;l<3;++l)e[l]-=this.localOrigin[l],e[l+3]-=this.localOrigin[l];return e}},SZe=class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=E(),this._tmpMbs=ln(),this._tmpObb=new gte,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Ae(e)}applyToVertex(e,i,r){const s=ne(yte,e,i,r),n=ne(g2e,e,i,r+this.componentLocalOriginLength),o=this._totalOffset/Ae(n);return On(this._tmpVertex,s,n,o),this._tmpVertex}applyToAabb(e){const i=this.componentLocalOriginLength,r=e[0],s=e[1],n=e[2]+i,o=e[3],a=e[4],l=e[5]+i,c=Math.abs(r),u=Math.abs(s),d=Math.abs(n),p=Math.abs(o),m=Math.abs(a),g=Math.abs(l),y=.5*(1+Math.sign(r*o))*Math.min(c,p),v=.5*(1+Math.sign(s*a))*Math.min(u,m),b=.5*(1+Math.sign(n*l))*Math.min(d,g),w=Math.max(c,p),x=Math.max(u,m),T=Math.max(d,g),C=Math.sqrt(y*y+v*v+b*b),M=Math.sign(c+r),O=Math.sign(u+s),D=Math.sign(d+n),k=Math.sign(p+o),U=Math.sign(m+a),H=Math.sign(g+l),z=this._totalOffset;if(C<z)return e[0]-=(1-M)*z,e[1]-=(1-O)*z,e[2]-=(1-D)*z,e[3]+=k*z,e[4]+=U*z,e[5]+=H*z,e;const Z=z/Math.sqrt(w*w+x*x+T*T),q=z/C,Y=q-Z,de=-Y;return e[0]+=r*(M*de+q),e[1]+=s*(O*de+q),e[2]+=n*(D*de+q),e[3]+=o*(k*Y+Z),e[4]+=a*(U*Y+Z),e[5]+=l*(H*Y+Z),e}applyToMbs(e){const i=Ae(e),r=this._totalOffset/i;return On(this._tmpMbs,e,e,r),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/i,this._tmpMbs}applyToObb(e){return f2e(e,this._totalOffset,this._totalOffset,Ge.Global,this._tmpObb),this._tmpObb}},TZe=class{constructor(e=0){this.offset=e,this.sphere=ln(),this.tmpVertex=E()}applyToVertex(e,i,r){const s=this.objectTransform.transform,n=ne(yte,e,i,r),o=He(n,n,s),a=this.offset/Ae(o);On(o,o,o,a);const l=this.objectTransform.inverse;return He(this.tmpVertex,o,l),this.tmpVertex}applyToMinMax(e,i){const r=this.offset/Ae(e);On(e,e,e,r);const s=this.offset/Ae(i);On(i,i,i,s)}applyToAabb(e){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const i=Ae(e),r=this.offset/i;return On(this.sphere,e,e,r),this.sphere[3]=e[3]+e[3]*this.offset/i,this.sphere}};const rce=new TZe;function H7(t){return t!=null?(rce.offset=t,rce):null}const sce=new SZe;function nce(t){return t!=null?(sce.offset=t,sce):null}const oce=new xZe;function EZe(t){return t!=null?(oce.offset=t,oce):null}const N1="terrain",yte=E(),g2e=E(),CZe=E(),MZe=E(),AZe=E(),WM=1e-5;let PZe=class{constructor(e){this.options=new nYe,this._results=new OZe,this.transform=new wZe,this.tolerance=WM,this.verticalOffset=null,this._ray=uo(),this._rayEnd=E(),this._rayBeginTransformed=E(),this._rayEndTransformed=E(),this.viewingMode=e??Ge.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,i,r){this.resetWithRay(oTe(e,i,this._ray),r)}resetWithRay(e,i){this.camera=i,e!==this._ray&&JU(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===Ge.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,me(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,i,r,s,n){var a;this.point=i,this.filterPredicate=s,this.tolerance=r??WM;const o=H7(this.verticalOffset);if(e&&e.length>0){const l=n?c=>{n(c)&&this.intersectObject(c)}:c=>{this.intersectObject(c)};for(const c of e){const u=(a=c.getSpatialQueryAccelerator)==null?void 0:a.call(c);u!=null?(o!=null?u.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,l,o):u.forEachAlongRay(this._ray.origin,this._ray.direction,l),this.options.selectionMode&&this.options.hud&&u.forEachDegenerateObject(l)):c.objects.forAll(d=>l(d))}}this.sortResults()}intersectObject(e){const i=e.geometries;if(!i)return;const r=e.effectiveTransformation,s=H7(this.verticalOffset);for(const n of i){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(r,n.transformation),He(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),He(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;s!=null&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,u,d,p,m,g)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const y=p?this._results.hud:this._results,v=p?b=>{const w=new aYe(e,a,d,g);b.set(Zr.HUD,w,c,u,Vr,m)}:b=>b.set(Zr.OBJECT,{object:e,geometryId:a,triangleNr:d},c,u,l,m);if((y.min.drapedLayerOrder==null||m>=y.min.drapedLayerOrder)&&(y.min.dist==null||c<y.min.dist)&&v(y.min),this.options.store!==ta.MIN&&(y.max.drapedLayerOrder==null||m<y.max.drapedLayerOrder)&&(y.max.dist==null||c>y.max.dist)&&v(y.max),this.options.store===ta.ALL)if(p){const b=new q7(this._ray);v(b),this._results.hud.all.push(b)}else{const b=new WC(this._ray);v(b),this._results.all.push(b)}}})}}sortResults(e=this._results.all){e.sort((i,r)=>i.dist!==r.dist?(i.dist??0)-(r.dist??0):i.drapedLayerOrder!==r.drapedLayerOrder?ace(i.drapedLayerOrder,r.drapedLayerOrder):ace(i.drapedLayerGraphicOrder,r.drapedLayerGraphicOrder))}};function ace(t,e){return(e??-Number.MAX_VALUE)-(t??-Number.MAX_VALUE)}function jd(t){return new PZe(t)}let OZe=class{constructor(){this.min=new WC(uo()),this.max=new WC(uo()),this.hud={min:new q7(uo()),max:new q7(uo()),all:new Array},this.ground=new WC(uo()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},WC=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(oe(VD,this.ray.direction,this.dist),Ae(VD)):null}getIntersectionPoint(e){return!!Zd(this)&&(oe(VD,this.ray.direction,this.dist),me(e,this.ray.origin,VD),!0)}getTransformedNormal(e){return ce($P,this.normal),$P[3]=0,hu($P,$P,this.transformation),ce(e,$P),ge(e,e)}constructor(e){this.intersector=Zr.OBJECT,this.normal=E(),this.transformation=Ee(),this._ray=uo(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Zr.OBJECT,JU(e,this._ray)}set(e,i,r,s,n,o,a){this.intersector=e,this.dist=r,ce(this.normal,s??wM),vn(this.transformation,n??Vr),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){JU(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,ce(this.normal,e.normal),vn(this.transformation,e.transformation)}},q7=class extends WC{constructor(){super(...arguments),this.intersector=Zr.HUD}};function _te(t){return new WC(t)}const VD=E(),$P=Qt();function y2e(t,e,i,r){return t.renderCoordsHelper.fromRenderCoords(e.eye,sz,r)!=null&&_we(i,sz)}function JB(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function ST(t,e,i,r){const s=t.state.camera.clone();e&&i&&r&&(s.eye=e,s.center=i,s.up=r),RZe(t,s.ray,y_)||ce(y_,s.center);const n=t.state.constraints,o=n.minimumPoiDistance;if(Ko(s.eye,y_)<o){const a=n.collision.enabled;ce(Ib,s.viewForward),oe(Ib,Ib,o),a?s.eye=ve(sz,y_,Ib):me(y_,s.eye,Ib);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),u=n.collision.elevationMargin;a&&c<u&&(ve(Ib,y_,s.eye),s.eye=l.setAltitude(sz,u,s.eye),me(y_,s.eye,Ib))}return s.center=y_,s}function lce(t,e,i){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const r=JB(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,i,t.renderDataExtent,r,IZe),o=n*n;return Ko(e,i)>o}function RZe(t,e,i){let r=cce[t.viewingMode];r||(r=jd(t.state.viewingMode),r.options.backfacesTerrain=!t.state.isGlobal,r.options.invisibleTerrain=!0,cce[t.viewingMode]=r);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,r,i)||lce(t,e.origin,i))||!(!t.renderCoordsHelper.intersectManifold(e,0,i)||lce(t,e.origin,i))||!!s&&$Ze(e,i,ur(t.spatialReference).radius)}function $Ze(t,e,i){const r=pe(t.origin,t.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return oe(e,t.direction,s/Ae(t.direction)),me(e,e,t.origin),!0}const cce={},sz=E(),y_=E(),Ib=E(),IZe={near:0,far:0},LZe=E(),BD=E();function vte(){return{direction:E(),up:E()}}function _2e(t,e,i,r,s){let n=ge(LZe,t),o=pe(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(pe(e,r)),o<.99?(ce(n,e),a&&oe(n,n,-1)):n=null);let l=0;if(n){oe(BD,r,pe(r,n)),ve(n,n,BD);const u=pe(n,s)/(Ae(n)*Ae(s));ot(BD,n,s),l=(pe(BD,r)>0?1:-1)*Ma(fo(u))}const c=Ma(fo(-pe(r,t)/Ae(t)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const v2e=$e(0,1,0),b2e=$e(0,0,1),IP=Ee(),Zg=E(),Xg=E();function w2e(t,e,i,r=vte()){const{direction:s,up:n}=r;return CSe(IP,-Rt(e)),kM(IP,IP,Rt(i)),He(s,b2e,IP),oe(s,s,-1),He(n,v2e,IP),r}function DZe(t,e,i,r){return _2e(e,i,r,b2e,v2e)}function NZe(t,e,i,r){const s=w2e(t,i,r),n=E();return oe(n,s.direction,-e),me(n,n,t),{up:s.up,eye:n,heading:i,tilt:r}}function FZe(t){return Ma(t)}function kZe(t){return Rt(t)}function x2e(t,e,i,r,s){const n=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return il(e,Zg,n),il(e,Xg,n),Zg[0]-=i/2,Xg[0]+=i/2,Zg[1]-=r/2,Xg[1]+=r/2,Zn(Zg,n,Zg,o),Zn(Xg,n,Xg,o),s?(s.xmin=Zg[0],s.ymin=Zg[1],s.xmax=Xg[0],s.ymax=Xg[1],s.spatialReference=o):s=new gi(Zg[0],Zg[1],Xg[0],Xg[1],o),s}const UZe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:DZe,eyeForCenterWithHeadingTilt:NZe,eyeTiltToLookAtTilt:kZe,headingTiltToDirectionUp:w2e,lookAtTiltToEyeTilt:FZe,toExtent:x2e},Symbol.toStringTag,{value:"Module"}));function uce(t,e,i){if(e.longitude==null||e.latitude==null||i.longitude==null||i.latitude==null)throw new Error("Invalid points: no lon/lat");return zZe(t,e.longitude,e.latitude,i.longitude,i.latitude)}function zZe(t,e,i,r,s){const n=Rt(i),o=Rt(s),a=n-o,l=Rt(e)-Rt(r),c=Math.sin(a/2),u=Math.sin(l/2),d=2*Tf(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*u*u))*t;return Math.round(1e4*d)/1e4}function VZe(t,e,i){const r=e.spatialReference,s=ur(r),n=new _t(e.x,t.y,r),o=new _t(i.x,t.y,r),a=new _t(t.x,e.y,r),l=new _t(t.x,i.y,r);return{lon:uce(s.radius,n,o),lat:uce(s.radius,a,l)}}function BZe(t,e,i){const r=e/i,s=Rt(t),n=Math.sin(r/2),o=Math.cos(s),a=2*Tf(Math.sqrt(n*n/(o*o)));return Ma(a)}function GZe(t,e){return t/15}function hce(t,e){const i=t==null?void 0:t[0];if(i==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=GZe(i);const r=e.hours%1;e.hours-=r,e.minutes=60*r;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}const S2e=$e(0,0,1),T2e=ge(E(),$e(1,1,1)),jZe=new x1(-180,180),LP=Ee(),Ev=E(),WT=E();function E2e(t,e,i,r=vte()){ot(Ev,t,S2e),pe(Ev,Ev)===0&&ot(Ev,t,T2e),wu(LP,-Rt(e),t),uu(LP,LP,-Rt(i),Ev);const{up:s,direction:n}=r;return ot(s,Ev,t),ge(s,s),He(s,s,LP),ge(n,t),ea(n,n),He(n,n,LP),r}function HZe(t,e,i,r){const s=Ev,n=WT;return ge(s,t),ot(WT,s,S2e),pe(WT,WT)===0&&ot(WT,s,T2e),ot(n,WT,s),_2e(e,i,r,s,n)}function qZe(t,e,i,r){const s={eye:E(),up:null,tilt:r,heading:i},n=Ev;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=Rt(i),l=Rt(r),c=Math.sin(a),u=Math.cos(a),d=Math.sin(l),p=Math.cos(l),m=Ae(n);let g;if(Math.abs(l)<1e-8)g=o+m;else{const de=m/d,L=Tf(o/de),F=Math.PI-l-L;g=de*Math.sin(F)}const y=p*o,v=o*o*(d*d),b=u*u*v,w=g-y,x=w*w,T=b*(b+x-n[1]*n[1]);if(T<0)return oe(s.eye,n,g/m),s.tilt=0,GD(s,t);const C=Math.sqrt(T),M=n[1]*w,O=b+x;let D;if(D=u>0?-C+M:C+M,Math.abs(O)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):oe(s.eye,n,g/m),s.tilt=0,T6(s.eye),GD(s,t);s.eye[1]=D/O;const k=c*c*v,U=d*o,H=u*U*s.eye[1],z=s.eye[1]*s.eye[1],Z=1-z,q=Math.sqrt(Z),Y=b*z+k-2*H*q*w+Z*x;return Math.abs(Y)<1e-8?(oe(s.eye,n,g/m),s.tilt=0,T6(s.eye),GD(s,t)):(s.eye[0]=(Z*(g*n[0]-y*n[0])-U*q*(n[0]*s.eye[1]*u+n[2]*c))/Y,s.eye[2]=(Z*(g*n[2]-y*n[2])-U*q*(n[2]*s.eye[1]*u-n[0]*c))/Y,oe(s.eye,s.eye,g),T6(s.eye),GD(s,t))}function T6(t){const e=t[1];t[1]=-t[2],t[2]=e}function GD(t,e){const i=E2e(e,t.heading,t.tilt);return t.up=i.up,t}function WZe(t,e,i){const r=Ae(e),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),n=Tf(i/(s/Math.sin(t)));return Ma(t-n)}function YZe(t,e,i){const r=Rt(t),s=Ae(e);return Tf(i/(s/Math.sin(r)))+r}function C2e(t,e,i,r,s){let n,o,a,l;const c=e.latitude,u=ur(t.spatialReference).radius,d=e.longitude,p=BZe(c,i,u)/2;n=d-p,o=d+p;const m=Rt(c),g=(1+Math.sin(m))/(1-Math.sin(m)),y=(g+1)*Math.tan(r/u/2),v=y*y;function b(x){const T=Math.PI/2;return(x=uBe.normalize(x,-T))>T&&(x=Math.PI-x),x}if(a=1.5*Math.PI-2*Math.atan(.5*(y+Math.sqrt(4*g+v))),l=a+r/u,a=b(a),l=b(l),l<a){const x=l;l=a,a=x}if(a=Math.max(Ma(a),-90),l=Math.min(Ma(l),90),o=jZe.monotonic(n,o),o-n>180){const x=(o-n-180)/2;n+=x,o-=x}const w=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:We.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=w):s=new gi(n,a,o,l,w),t.spatialReference&&t.spatialReference.isWebMercator&&lS(s,!1,s),s}const ZZe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:HZe,eyeForCenterWithHeadingTilt:qZe,eyeTiltToLookAtTilt:YZe,headingTiltToDirectionUp:E2e,lookAtTiltToEyeTilt:WZe,toExtent:C2e},Symbol.toStringTag,{value:"Module"}));function nz(t){return t.type==="point"}let bte=class{constructor(e,i=null,r=0){this.array=e,this.spatialReference=i,this.offset=r}};function M2e(t){return"array"in t}function Qm(t,e,i="ground"){if(nz(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(M2e(e)){let r=e.offset;return t.getElevation(e.array[r++],e.array[r++],e.array[r]||0,e.spatialReference??t.spatialReference,i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}function W7(t,e){return t!=null&&(e==null||(e===Ge.Local?!t.isGeographic||t.isWGS84||t.wkid===au.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===au.CGCS2000||t.wkid===au.GCSMARS2000||t.wkid===au.GCSMARS2000_SPHERE||t.wkid===au.GCSMOON2000))}const A2e=()=>ie.getLogger("esri.views.3d.support.cameraUtils"),P2e=39.37,O2e=96,Y7=1,XZe=8,JZe=5,R2e=1,dce=E(),QZe={heading:0,tilt:0},V$=E(),KZe=new x1(-20037508342788905e-9,20037508342788905e-9),eXe=new x1(-180,180);var Sa;function ab(t){return t.spatialReference??We.WGS84}function VA(t){return t.viewingMode==="global"?ZZe:UZe}function tXe(t,e,i,r,s){return VA(t).headingTiltToDirectionUp(e,i,r,s)}function By(t,e){if(e==null)return null;const i=t.renderSpatialReference,r=VA(t).headingTiltToDirectionUp,s=E();if(!il(e.position,s,i))return null;const n=r(s,e.heading,e.tilt);oe(n.direction,n.direction,t.state.camera.distance),me(n.direction,n.direction,s);const o=ST(t,s,n.direction,n.up);return o.fov=Rt(e.fov),o.row=e.layout.row,o.rows=e.layout.rows,o.column=e.layout.column,o.columns=e.layout.columns,o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(Sa||(Sa={}));const YT=E();function YM(t,e,i){const r=t.renderSpatialReference,s=KB(t,e.eye,e.viewForward,e.up,QZe);let n=ab(t);return Zn(e.eye,r,YT,n)||(n=We.WGS84,Zn(e.eye,r,YT,n)),i==null?i=new Eh(new _t(YT,n),s.heading,s.tilt,Ma(e.fov)):(i.position.x=YT[0],i.position.y=YT[1],i.position.z=YT[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=Ma(e.fov)),i.layout.row=e.row,i.layout.rows=e.rows,i.layout.column=e.column,i.layout.columns=e.columns,i}function QB(t,e,i){const r=t.state.camera,s=r.width/2/r.pixelRatio;return t.renderCoordsHelper.viewingMode===Ge.Global&&i!=null&&(e*=Math.cos(Rt(i))),e/=t.renderCoordsHelper.unitInMeters,s/(O2e*P2e/e)/Math.tan(r.fovX/2)}function F1(t,e,i){const r=t.state.camera,s=e*Math.tan(r.fovX/2),n=r.width/2/r.pixelRatio;let o=O2e*P2e/(n/s);return t.renderCoordsHelper.viewingMode===Ge.Global&&i!=null&&(o/=Math.cos(Rt(i))),o*t.renderCoordsHelper.unitInMeters}async function $2e(t,e,i,r,s,n){return I2e(t,e,QB(t,i,e.latitude),r,s,n)}function iXe(t,e,i,r,s,n){return W2e(t,wte(t,r.heading,r.tilt,e,i,s),r.fov,n)}async function I2e(t,e,i,r,s,n){const o=await D2e(t,r.heading,r.tilt,e,i,s,n);return Et(n),Y2e(t,o,r.fov,n)}function KB(t,e,i,r,s){return VA(t).directionToHeadingTilt(e,i,r,s)}function L2e(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,V$,t.spatialReference)&&t.elevationProvider&&(Qm(t.elevationProvider,V$)??0)>V$[2]-R2e)}async function rXe(t,e,i){if(L2e(t,e))return!0;const{elevationProvider:r,spatialReference:s,renderCoordsHelper:n}=t;if(r==null||!n.fromRenderCoords(e,V$,s))return!1;const[o,a,l]=V$,c=await r.queryElevation(o,a,l,s,"ground",i)??0;return Et(i),c>l-R2e}async function sXe(t,e,i){const r=E();if(e==null)return ce(r,t.state.camera.center);if(e instanceof _t){const{renderSpatialReference:s,basemapTerrain:n,elevationProvider:o}=t,a=e.spatialReference;if(await qU(e,r,s,0,{signal:i}),Et(i),e.z==null&&n!=null&&o!=null){const l=await o.queryElevation(e.x,e.y,e.z??0,a,"ground",i);Et(i),l!=null&&t.renderCoordsHelper.setAltitude(r,l)}return r}return ce(r,e)}function nXe(t,e){const i=E();if(e==null)return ce(i,t.state.camera.center);if(e instanceof _t){if(!il(e,i,t.renderSpatialReference))return null;const{basemapTerrain:r,elevationProvider:s}=t;if(e.z==null&&r!=null&&s!=null){const n=Qm(s,e);n!=null&&t.renderCoordsHelper.setAltitude(i,n)}return i}return ce(i,e)}function wte(t,e,i,r,s,n){return N2e(t,e,i,r instanceof _t?r:null,nXe(t,r),s,n)}async function D2e(t,e,i,r,s,n,o){const a=r instanceof _t?r:null,l=await sXe(t,r,o);return Et(o),F2e(t,e,i,a,l,s,n,o)}function N2e(t,e,i,r,s,n,o){if(s==null||!r&&(r=new _t({spatialReference:ab(t)}),!ob(s,t.renderSpatialReference,r)))return null;const a=k2e(t,e,i,s,n,o);if(U2e(t,i,o)&&L2e(t,a.eye)){const{tilt:l,mode:c}=z2e(t,i,s,n);return N2e(t,e,l,r,s,n,c)}return V2e(a,s)}async function F2e(t,e,i,r,s,n,o,a){r||(r=new _t({spatialReference:ab(t)}),await e2e(s,t.renderSpatialReference,r,{signal:a})||(r=null)),Et(a);const l=k2e(t,e,i,s,n,o);if(U2e(t,i,o)&&await rXe(t,l.eye,a)){Et(a);const{tilt:c,mode:u}=z2e(t,i,s,n);return F2e(t,e,c,r,s,n,u,a)}return V2e(l,s)}function k2e(t,e,i,r,s,n){const o=aXe(t,e,i,r,s=Math.max(s,t.state.constraints.minimumPoiDistance),n);return(0,VA(t).eyeForCenterWithHeadingTilt)(r,s,o.heading,o.tilt)}function U2e(t,e,i){const r=t.map.ground.navigationConstraint;return i===Sa.ADJUST&&t.viewingMode==="global"&&e>0&&(r==null||r.type==="stay-above")}function z2e(t,e,i,r){const s=q2e(t,i,r,cXe(t,r,e,i));return{tilt:s,mode:e-s<1?Sa.LOCKED:Sa.ADJUST}}function V2e(t,e){return{...t,center:Xs(e)}}function B2e(t,e){const{state:i,spatialReference:r}=t,s=e.spatialReference;return i.isGlobal&&W7(s,Ge.Global)||i.isLocal&&r.equals(s)}function G2e(t,e){let i,r,s;if(t.state.isGlobal){const u=new _t(e.xmin,e.ymin,e.spatialReference),d=new _t(e.xmax,e.ymax,e.spatialReference),p=e.spatialReference.isGeographic?eXe:KZe;i=new _t({x:p.center(u.x,d.x),y:(d.y+u.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const m=ur(e.spatialReference),g=VZe(i,u,d);r=g.lon,s=g.lat,p.diff(u.x,d.x)>p.range/2&&(r+=m.halfCircumference),r=Math.min(r,m.halfCircumference),s=Math.min(s,m.halfCircumference)}else{const u=t.renderSpatialReference??e.spatialReference;u.equals(e.spatialReference)||(e=ib(e,u)),r=e.xmax-e.xmin,s=e.ymax-e.ymin;const d=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;i=new _t({x:e.xmin+.5*r,y:e.ymin+.5*s,z:d,spatialReference:u})}const n=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,o=t.state.camera,a=1/Math.tan(o.fovX/2),l=1/Math.tan(o.fovY/2),c=1/Math.tan(o.fov/2);return{center:i,distance:Math.max(.5*r*a,.5*s*l,.5*n*c)/Y7}}async function j2e(t,e,i,r,s,n){const o=B2e(t,e)?e:await L1(e,t.spatialReference,{signal:n});Et(n);const{center:a,distance:l}=G2e(t,o),c=await D2e(t,i,r,a,l,s,n);return Et(n),Y2e(t,c,t.camera.fov,n)}function Z4(t,e,i,r,s,n){let o;try{o=B2e(t,e)?e:ib(e,t.spatialReference)}catch{return null}const{center:a,distance:l}=G2e(t,o),c=wte(t,i,r,a,l,s);return c==null?null:W2e(t,c,t.camera.fov,n)}function H2e(t,e,i){const r=t.renderSpatialReference,s=new _t({spatialReference:ab(t)});if(!ob(i,r,s))return null;const n=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=e1(e.eye,i),l=2*a*n*Y7,c=2*a*o*Y7;return t.viewingMode==="global"?C2e(t,s,l,c):x2e(t,s,l,c)}function oXe(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>XZe)return!0;const s=e,n=t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return wr(s,n)/(Math.tan(.5*t.state.camera.fov)*r)>JZe}function aXe(t,e,i,r,s,n){let o=0;return n===Sa.ADJUST&&oXe(t,r,s)?(e=0,o=lXe(t,s,i,r)):o=xte(t,r,s,i),o=t.state.constraints.clampTilt(s,o),{heading:e,tilt:i=q2e(t,r,s,o)}}const oz=.7;function lXe(t,e,i,r){const s=xte(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-oz)+n.max*oz;return Math.min(s,o)}function cXe(t,e,i,r){let s=xte(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-oz)+s*oz}function q2e(t,e,i,r){return VA(t).lookAtTiltToEyeTilt(r,e,i)}function xte(t,e,i,r){return VA(t).eyeTiltToLookAtTilt(r,e,i)}function W2e(t,e,i,r){if(e==null)return null;const s=t.renderSpatialReference,n=new _t({spatialReference:ab(t)});return ob(e.eye,s,n)?(r??(r=new Eh),r.position=n,r.heading=e.heading,r.tilt=e.tilt,r.fov=i,r):null}async function Y2e(t,e,i,r){const s=t.renderSpatialReference,n=new _t({spatialReference:ab(t)});return await e2e(e.eye,s,n,{signal:r}),Et(r),new Eh(n,e.heading,e.tilt,i)}function uXe(t,e){var r;const i=(r=t.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.levelAtScale(e);A2e().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function Z2e(t,e){var r;const i=(r=t.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.scaleAtLevel(e);A2e().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function X2e(t,e){const{renderSpatialReference:i}=t,r=sYe(i);let s=null;try{Zn(e.center,i,dce,r)&&(s=dce[1])}catch{}return F1(t,e.distance,s)}const Ste=()=>ie.getLogger("esri.layers.support.ElevationSampler");let J2e=class{queryElevation(e){return Q2e(e.clone(),this)}on(){return Ni()}projectIfRequired(e,i){return K2e(e,i)}},hXe=class extends J2e{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){super(),this.tile=e,this.noDataValue=r;const s=e.tile.extent;this.extent=pB(s,i.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=s;const n=Gl(i.spatialReference),o=i.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const i=this.projectIfRequired(e,this.spatialReference);return i!=null&&this.containsAt(i.x,i.y)}containsAt(e,i){return fB(this._aaExtent,e,i)}elevationAt(e,i){if(!this.containsAt(e,i)){const r=this.extent,s=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return Ste().warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return this.tile.sample(e,i)??this.noDataValue}},ZBt=class extends J2e{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){let s;super(),typeof i=="number"?(this.noDataValue=i,s=null):(s=i,this.noDataValue=r),this.samplers=s?e.map(o=>new hXe(o,s,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=pB(Ht(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,i){let r,s=!1;for(const n of this.samplers)if(n.containsAt(e,i)&&(s=!0,r=n.elevationAt(e,i),r!==n.noDataValue))return r;return r??(s||Ste().warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler`),this.noDataValue)}};function Q2e(t,e){const i=K2e(t,e.spatialReference);if(!i)return null;switch(t.type){case"point":dXe(t,i,e);break;case"polyline":pXe(t,i,e);break;case"multipoint":fXe(t,i,e)}return t}function K2e(t,e){if(t==null)return null;const i=t.spatialReference;if(i.equals(e))return t;const r=W3(t,e);return r||Ste().error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),r}function dXe(t,e,i){t.z=i.elevationAt(e.x,e.y)}function pXe(t,e,i){Gm.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],o=e.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];Gm.x=c[0],Gm.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(Gm.x,Gm.y)}}t.hasZ=!0}function fXe(t,e,i){Gm.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],o=e.points[s];Gm.x=o[0],Gm.y=o[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(Gm.x,Gm.y)}t.hasZ=!0}const Gm=new _t;var Z7;let mm=Z7=class extends ye{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new Z7({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],mm.prototype,"cols",void 0),h([f({type:Qr,json:{write:!0}})],mm.prototype,"level",void 0),h([f({type:String,json:{write:!0}})],mm.prototype,"levelValue",void 0),h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],mm.prototype,"origin",void 0),h([f({type:Number,json:{write:!0}})],mm.prototype,"resolution",void 0),h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],mm.prototype,"rows",void 0),h([f({type:Number,json:{write:!0}})],mm.prototype,"scale",void 0),mm=Z7=h([I("esri.layers.support.LOD")],mm);const Sd=mm;let eEe=class{constructor(e,i,r,s,n=void 0){this.id=e,this.level=i,this.row=r,this.col=s,this.extent=n}};var H_;const pce=new qi({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Da=H_=class extends ye{static create(t={}){const{resolutionFactor:e=1,scales:i,size:r=256,spatialReference:s=We.WebMercator,numLODs:n=24}=t;if(!sf(s)){const d=[];if(i)for(let p=0;p<i.length;p++){const m=i[p];d.push(new Sd({level:p,scale:m,resolution:m}))}else{let p=5e-4;for(let m=n-1;m>=0;m--)d.unshift(new Sd({level:m,scale:p,resolution:p})),p*=2}return new H_({dpi:96,lods:d,origin:new _t(0,0,s),size:[r,r],spatialReference:s})}const o=c0(s),a=t.origin?new _t({x:t.origin.x,y:t.origin.y,spatialReference:s}):new _t(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(Gl(s)*39.37*l),u=[];if(i)for(let d=0;d<i.length;d++){const p=i[d],m=p*c;u.push(new Sd({level:d,scale:p,resolution:m}))}else{let d=H3(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const p=Math.ceil(n/e);u.push(new Sd({level:0,scale:d,resolution:d*c}));for(let m=1;m<p;m++){const g=d/2**e,y=g*c;u.push(new Sd({level:m,scale:g,resolution:y})),d=g}}return new H_({dpi:l,lods:u,origin:a,size:[r,r],spatialReference:s})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const i=c0(t);return t.isWrappable&&!!i&&Math.abs(i.origin[0]-e.x)<=i.dx}return!1}readOrigin(t,e){return _t.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,i=0;const r=[],s=this._levelToLOD={};t&&(e=-1/0,i=1/0,t.forEach(n=>{r.push(n.scale),e=n.scale>e?n.scale:e,i=n.scale<i?n.scale:i,s[n.level]=n})),this._set("scales",r),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const i=Math.floor(t),r=i+1;return e[i]/(e[i]/e[r])**(t-i)}scaleToZoom(t){const e=this.scales,i=e.length-1;let r=0;for(;r<i;r++){const s=e[r],n=e[r+1];if(s<=t)return r;if(n===t)return r+1;if(s>t&&n<t)return r+Math.log(s/t)/Math.log(s/n)}return r}tileAt(t,e,i,r){const s=this.lodAt(t);if(!s)return null;let n,o;if(typeof e=="number")n=e,o=i;else if(gs(e.spatialReference,this.spatialReference))n=e.x,o=e.y,r=i;else{const c=W3(e,this.spatialReference);if(c==null)return null;n=c.x,o=c.y,r=i}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r=new eEe(null,0,0,0,Ht())),r.level=t,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(t,e=H_.ExtrapolateOptions.NONE){let i=this.lodAt(t.level);if(!i&&e===H_.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(i=o)}if(!i)return;const r=t.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=Ht()),t.extent[0]=this.origin.x+t.col*s,t.extent[1]=this.origin.y-(t.row+1)*n,t.extent[2]=t.extent[0]+s,t.extent[3]=t.extent[1]+n}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const i=this.lodAt(e.level);if(i==null)return null;const{resolution:r}=i,s=r*this.size[0],n=r*this.size[1];return t[0]=this.origin.x+e.col*s,t[1]=this.origin.y-(e.row+1)*n,t[2]=t[0]+s,t[3]=t[1]+n,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return H_.fromJSON(this.write({}))}getCompatibleForVTL(t){if(this.size[0]!==this.size[1]||this.size[0]===256&&t===512)return null;const e=(this.size[0]===512&&t===256?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===t&&e===0)return this;const i=[],r=this.lods.length-e;for(let s=0;s<r;s++){const n=s+e,{scale:o,resolution:a}=n>=0?this.lods[n]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};i.push(new Sd({level:s,scale:o,resolution:a}))}return new H_({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let i=0;i<t.length;i++){const r=t[i];this._upsampleLevels[r.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/r.resolution:0},e=r}}};h([f({type:Number,json:{write:!0}})],Da.prototype,"compressionQuality",void 0),h([f({type:Number,json:{write:!0}})],Da.prototype,"dpi",void 0),h([f({type:String,json:{read:pce.read,write:pce.write,origins:{"web-scene":{read:!1,write:!1}}}})],Da.prototype,"format",void 0),h([f({readOnly:!0})],Da.prototype,"isWrappable",null),h([f({type:_t,json:{write:!0}})],Da.prototype,"origin",void 0),h([Ce("origin")],Da.prototype,"readOrigin",null),h([f({type:[Sd],value:null,json:{write:!0}})],Da.prototype,"lods",null),h([f({readOnly:!0})],Da.prototype,"scales",void 0),h([f({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Da.prototype,"size",void 0),h([Ce("size",["rows","cols"])],Da.prototype,"readSize",null),h([Ve("size",{cols:{type:Qr},rows:{type:Qr}})],Da.prototype,"writeSize",null),h([f({type:We,json:{write:!0}})],Da.prototype,"spatialReference",void 0),Da=H_=h([I("esri.layers.support.TileInfo")],Da),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Da||(Da={}));const ug=Da,mXe=12;let su=class Uc{constructor(e){const i=Uc.checkUnsupported(e);if(i!=null)throw i;const r=e;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=H3(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,u)=>(u.level<c.minLod.level&&(c.minLod=u),c.max=Math.max(c.max,u.level),c),{minLod:r.lods[0],max:-1/0}),n=s.minLod,o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new Uc(this.toTileInfo())}toTileInfo(){return new ug({dpi:this.dpi,origin:new _t({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,i)=>new Sd({level:i,scale:e.scale,resolution:e.resolution}))})}getExtent(e,i,r,s){const n=this.levels[e],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+r*o,s[2]=this.origin[0]+(r+1)*o,s[3]=this.origin[1]-i*a,s[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(e,i){this._isWebMercator?(i[0]=mae(e[0]),i[1]=RU(e[1]),i[2]=mae(e[2]),i[3]=RU(e[3])):this._isGCS&&(i[0]=Rt(e[0]),i[1]=Rt(e[1]),i[2]=Rt(e[2]),i[3]=Rt(e[3]))}getExtentGeometry(e,i,r,s=new gi){return this.getExtent(e,i,r,Hf),s.spatialReference=this.spatialReference,s.xmin=Hf[0],s.ymin=Hf[1],s.xmax=Hf[2],s.ymax=Hf[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let i=!1;for(;this.levels.length<=e;){const{resolution:r,scale:s}=this.levels[this.levels.length-1],n=r/2*this.pixelSize;this.levels.push({resolution:r/2,scale:s/2,tileSize:[n,n]}),i=!0}return i}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e,i=1/0){if(Uc.checkUnsupported(e))return!1;const r=new Uc(e);if(!r.spatialReference.equals(this.spatialReference)||r.pixelSize!==this.pixelSize)return!1;const s=Math.min(this.levels.length-1,r.levels.length-1,i),n=this.levels[s].resolution;let o=.5*n;return!t1(r.origin[0],this.origin[0],o)||!t1(r.origin[1],this.origin[1],o)?!1:(o=.5*n/2**s/this.pixelSize*mXe,t1(n,r.levels[s].resolution,o))}rootTilesInExtent(e,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(e==null||n[0]===0||n[1]===0)return s;Uc.computeRowColExtent(e,n,this.origin,Hf);let o=Hf[1],a=Hf[3],l=Hf[0],c=Hf[2];const u=c-l,d=a-o;if(u*d>r){const p=Math.floor(Math.sqrt(r));d>p&&(o=o+Math.floor(.5*d)-Math.floor(.5*p),a=o+p),u>p&&(l=l+Math.floor(.5*u)-Math.floor(.5*p),c=l+p)}for(let p=o;p<a;p++)for(let m=l;m<c;m++)s.push([0,p,m]);return i!=null&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-a*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,i,r,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-e[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-e[1]-n)/i[1]))}static isPowerOfTwo(e){const i=e.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!lBe(s.resolution,r/2**s.level))}static hasGapInLevels(e){const i=e.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(e){const i=e.size[1];return i===e.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(e){const i=e.origin;return e.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new V("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?Tte():e.lods.length<1?new V("tilingscheme:generic","Tiling scheme must have at least one level"):Uc.isPowerOfTwo(e)?Uc.hasGapInLevels(e)?new V("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Uc.tileSizeSupported(e)?Uc.hasOriginPerLODs(e)?new V("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new V("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new V("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,i){const r=e[2]-e[0],s=e[3]-e[1],n=Gl(i),o=1.2*Math.max(r,s),a=256,l=o/a,c=l*n*(96/.0254),u=new Uc(new ug({size:[a,a],origin:new _t({x:e[0]-.5*(o-r),y:e[3]+.5*(o-s)}),lods:[new Sd({level:0,resolution:l,scale:c})],spatialReference:i}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(e){const i=new Uc(Uc.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(e),i}static makeGCSWithTileSize(e,i=256,r=16){const s=256/i,n=new Uc(new ug({size:[i,i],origin:new _t({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new Sd({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(r),n}get test(){}};function Tte(){return new V("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}su.WebMercatorAuxiliarySphereTileInfo=new ug({size:[256,256],origin:new _t({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:We.WebMercator}),spatialReference:We.WebMercator,lods:[new Sd({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),su.WebMercatorAuxiliarySphere=su.makeWebMercatorAuxiliarySphere(19);const Hf=Ht(),rC=64,RO=512,gXe=2.5,Ete=cBe(H9/10),tEe=2,iEe=Ht();su.WebMercatorAuxiliarySphere.getExtent(0,0,0,iEe);const yXe=Ht([-180,-90,180,90]),_Xe="Cannot extend surface to encompass all layers because it would result in too many root tiles.",vXe="Surface extent is too large for tile resolution at level 0.",Bn=4;let q_=class extends cn.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=Ete}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if((e==null?void 0:e.extent)==null||e.spatialReference==null)return null;const i=pB(e.extent,e.spatialReference);return i.zmin=e.visibleElevationBounds.min,i.zmax=e.visibleElevationBounds.max,i}get spatialReference(){var e;return((e=this.view.basemapTerrain)==null?void 0:e.spatialReference)??We.WGS84}elevationAt(e,i){var r;if(this.extent==null||!Cl(this.extent,e,i)){const s=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return ie.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return((r=this.view.elevationProvider)==null?void 0:r.getElevation(e,i,0,this.spatialReference,"ground"))??this.noDataValue}queryElevation(e){return Q2e(e.clone(),this)}};h([f({readOnly:!0})],q_.prototype,"demResolution",void 0),h([f({readOnly:!0})],q_.prototype,"extent",null),h([f({readOnly:!0})],q_.prototype,"noDataValue",void 0),h([f()],q_.prototype,"spatialReference",null),h([f({constructOnly:!0})],q_.prototype,"view",void 0),q_=h([I("esri.views.support.GroundViewElevationSampler")],q_);const bXe=q_;let py=class extends Re{constructor(e){super(e),this.view=null,this.layerViews=new tt}initialize(){this.addHandles(vu(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground},e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new bXe({view:this.view}):null:null}get extent(){const e=this.view;return e&&e.type!=="2d"&&e.ready?H2e(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>ue(()=>e.updating,()=>this._updateUpdating(),ar)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};h([f({readOnly:!0})],py.prototype,"elevationSampler",null),h([f({readOnly:!0})],py.prototype,"extent",null),h([f({type:Boolean,readOnly:!0})],py.prototype,"updating",null),h([f({constructOnly:!0})],py.prototype,"view",void 0),h([f({type:tt,readOnly:!0})],py.prototype,"layerViews",void 0),h([f({readOnly:!0})],py.prototype,"suspended",null),py=h([I("esri.views.GroundView")],py);const wXe=py;let C0=class{constructor(e,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in e){const s=e[r],n=new P1e(s,void 0,void 0,2,2);this._properties[r]={pool:n,acquired:[]}}this._afterDispatchHandle=G1e(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const i=this._properties[e];for(const r of i.acquired)Uoe(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(e){const i=this._owner._get(e),r=this._properties[e];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const e in this._properties){const i=this._properties[e];let r=0;for(const s of i.acquired)Uoe(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}};const xXe=re("mac")?"Meta":"Control",SXe=new Set(["Alt","Control","Meta","Shift","Ctrl","Primary"]),TXe=t=>SXe.has(t);let EXe=class{constructor(e,i=[]){this.eventType=e,this.keyModifiers=i}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=e.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}},na=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const i=this._incoming[e];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager||(e.setEventCallback(i=>this._handleEvent(i)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof e=="string"?new EXe(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=u=>{const d=this._incoming[u.match.eventType];if(d){const p=d.indexOf(u);d.splice(p,1),o(),this._manager&&this._manager.updateDependencies()}},l=new CXe(n,r,{onPause:a,onRemove:a,onResume:u=>{const d=this._incoming[u.match.eventType];d&&!d.includes(u)&&(d.push(u),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const i=new MXe(e,{onEmit:(r,s,n,o)=>{var a;(a=this._manager)==null||a.emit(r.eventType,s,n,o)},onRemove:r=>{var s;delete this._outgoing[r.eventType],(s=this._manager)==null||s.updateDependencies()}});return this._outgoing[e]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!0)}stopCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager&&(this.onUninstall(),this._manager=null)}_handleEvent(e){var r;const i=this._incoming[e.type];if(i){for(const s of i)if(s.match.matches(e)&&((r=s.callback)==null||r.call(s,e),e.shouldStopPropagation()))break}}},CXe=class{constructor(e,i,r){this.match=e,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},MXe=class{constructor(e,i){this.eventType=e,this._removed=!1,this._handler=i}emit(e,i,r){this._removed||this._handler.onEmit(this,e,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},AXe=class extends na{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{this._update(i.data)})}_update(e){const i=e.native.pointerType==="touch"?"touch":"mouse",{x:r,y:s}=e;i===this._value&&this._x===r&&this._y===s||(this._value=i,this._x=r,this._y=s,this._onChange(i,r,s))}},PXe=class{constructor(e,i){this._observable=new Q3,this._value=e,this._equalityFunction=i}get value(){return zt(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function hg(t,e=d1e){return new PXe(t,e)}let OXe=class extends na{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=hg(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},jh=class extends Re{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=xXe,this._latestPointerType="mouse",this._propertiesPool=new C0({latestPointerLocation:IXe},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const i of e)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,i,r=a1.INTERNAL){if(this._nameToGroup[e]||i.length===0)return;const s={name:e,handlers:i.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const o=s.handlers[n];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,u,d)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,d,u)},setPointerCapture:(a,l)=>{this._setPointerCapture(s,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const i=this._nameToGroup[e];i?(i.handlers.forEach(r=>{var s;r.removed=!0,(s=r.uninstallCallback)==null||s.call(r)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):ie.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}isModifierKeyDown(e){return this._activeKeyModifiers&&this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,i=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const s=this._handlers[r];s.priorityIndex=r,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const s=this._handlersPriority[r];s.priorityIndex=r;let n=s.handler.hasSideEffects;if(!n){for(const o of s.handler.outgoingEventTypes)if(e.has(o)){n=!0;break}}if(n)for(const o of s.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)TXe(a)||i.add(a)}s.active=n}this._sourceEvents=e,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,i,r){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(s==null||s.x!==i||s.y!==r){const n=this._propertiesPool.get("latestPointerLocation");n.x=i,n.y=r,this._set("latestPointerLocation",n)}}_onEventReceived(e,i){if(e==="pointer-capture-lost"){const n=i;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,i);const r=this.test.timestamp!=null?this.test.timestamp:i.native?i.native.timestamp:void 0,s=i.native?i.native.cancelable:void 0;this._emitInputEventFromSource(e,i,r,s)}_updateKeyModifiers(e,i){if(!i)return;let r=!1;const s=()=>{if(!r){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,r=!0}},n=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(s(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(s(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=i.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const o=i.native;n("Alt",!(!o||!o.altKey)),n("Control",!(!o||!o.ctrlKey)),n("Ctrl",!(!o||!o.ctrlKey)),n("Shift",!(!o||!o.shiftKey)),n("Meta",!(!o||!o.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new AXe((e,i,r)=>this._setLatestPointer(e,i,r)),this._multiTouchHandler=new OXe,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],a1.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,a1.INTERNAL)}_setPointerCapture(e,i,r,s){const n=e.name+"-"+i.priorityIndex,o=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,o),s?(o.add(n),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):o.has(n)&&(o.delete(n),o.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,i,r,s){this._emitInputEvent(0,e,i,r,s)}_emitInputEvent(e,i,r,s,n,o){const a=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new RXe(i,r,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new NU,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var i,r,s;this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:n,priorityIndex:o}=e.events.pop(),a=(i=n.data)==null?void 0:i.eventId;if(!(a!=null&&this._stoppedPropagationEventIds.has(a)))for(e.currentHandler=this._handlersPriority[o];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!n.shouldStopPropagation()&&((s=(r=e.currentHandler).eventCallback)==null||s.call(r,n)),n.shouldStopPropagation()){a!=null&&this._stoppedPropagationEventIds.add(a);break}if(n.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:n,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const i=new NU;i.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)i.push(r.events.pop());r.events=i,r.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,i){if(e.handler.hasSideEffects!==i.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==i.groupPriority)return e.groupPriority>i.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const s of i.handler.incomingEventMatches){if(r.eventType!==s.eventType)continue;const n=r.keyModifiers.filter(o=>s.keyModifiers.includes(o));if(n.length===r.keyModifiers.length!=(n.length===s.keyModifiers.length))return r.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(e){const i=[];for(const r of e){let s=0;for(;s<i.length&&this._compareHandlerPriority(r,i[s])>=0;)s++;i.splice(s,0,r)}return i}get debug(){const e=i=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},i(),this._setPointerCapture=r};return{injectEvent:(i,r)=>{e(()=>{this._onEventReceived(i,r)})},disablePointerCapture:e}}};h([f({readOnly:!0})],jh.prototype,"hasPendingInputs",null),h([f({constructOnly:!0})],jh.prototype,"eventSource",void 0),h([f({constructOnly:!0})],jh.prototype,"recognizers",void 0),h([f()],jh.prototype,"_latestPointerType",void 0),h([f()],jh.prototype,"latestPointerType",null),h([f()],jh.prototype,"multiTouchActive",null),h([f({readOnly:!0})],jh.prototype,"latestPointerLocation",void 0),h([f()],jh.prototype,"_paused",void 0),h([f({readOnly:!0})],jh.prototype,"updating",null),jh=h([I("esri.views.input.InputManager")],jh);let RXe=class{constructor(e,i,r,s,n){this.type=e,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=Cv.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=Cv.STOPPED}shouldStopPropagation(){return!!(this._propagationState&Cv.STOPPED)}async(e){this._propagationState|=Cv.PAUSED;const i=(r,s)=>{this._propagationState&=~Cv.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof e=="function"?e():e).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(e){return!!(this._propagationState&Cv.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var Cv;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(Cv||(Cv={}));const a1={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let $Xe=class{};const IXe=$Xe;function Jg(t){return t!=null&&"open"in t&&"declaredClass"in t}function fce(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const LXe=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([ue(()=>[this.ui,this.popup],([i,r],s)=>{const n="popup",o="manual";if(s){const[a,l]=s;a&&Jg(l)&&(l.view=null,fce(l)&&a.remove(l,n))}i&&Jg(r)&&(r.view=this,fce(r)&&i.add(r,{key:n,position:o,internal:!0}))},cr),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&(Jg(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(async()=>{await this.setupPopup(),Jg(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)}))},a1.WIDGET)]),zI(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{fe(()=>import("./Popup-URBzWqFF.js"),__vite__mapDeps([64,1,65,66,4,67,34,18,19,32,33,68]))})}destroy(){this.destroyed||this.closePopup()}async openPopup(i){if(Jg(this.popup))return this.popup.open(i);try{if(await this.setupPopup(),!this.popup)return void ie.getLogger(this).error(new V("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}}closePopup(){var i;(i=this._popupSetupTask)==null||i.abort(),Jg(this.popup)&&this.popup.close()}async fetchPopupFeatures(i,r){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(i,r),r)}async setupPopup(){var i;if((i=this._popupSetupTask)==null||i.abort(),this.popup&&!Jg(this.popup))return this._popupSetupTask=Nf(async r=>{const{default:s}=await fe(()=>import("./Popup-URBzWqFF.js"),__vite__mapDeps([64,1,65,66,4,67,34,18,19,32,33,68]));if(Et(r),!this.popup||Jg(this.popup))return;const n=this.popup;delete n.open,delete n.close,this.popup=new s(n)}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:i,hits:r},s){const n=[],o=[];let a=!1;const l=Fze(s,re("popup-view-fetch-timeout")??NXe),c=p=>{const m=new DXe(p);return o.push(m),n.push(m.promise),m},u=p=>{const m=o.at(-1);return m&&m.layerView===p&&!a?m:c(p)};for(const p of r)"graphic"in p?(u(p.layerView).graphics.push(p.graphic),a=!1):(n.push(p.layerView.fetchPopupFeaturesAtLocation(p.mapPoint,l)),a=!0);o.map(p=>p.resolve(l));const d=A9(n).then(p=>p.filter(m=>!!m).flat());return{pendingFeatures:n,allGraphicsPromise:d,location:i}}async _getPopupHits(i,r){const{hits:s,location:n}=await this.popupHitTest(i);Et(r);const o=[];for(const a of s)if("graphic"in a){if(this._isValidPopupGraphic(a.graphic,r)){const l=this._isValidPopupGraphicsLayerView(a.layerView)?a.layerView:void 0;o.push({graphic:a.graphic,layerView:l})}}else this._isValidPopupLocationLayerView(a.layerView)&&o.push({mapPoint:a.mapPoint,layerView:a.layerView});return{hits:o,location:n}}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(r==null?void 0:r.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(i){return!i||(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesFromGraphics"in i}_isValidPopupLocationLayerView(i){return(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesAtLocation"in i}};return h([f({cast(i){return!i||Jg(i)||typeof i=="object"&&(i.open=r=>(b1(ie.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(r)),i.close=()=>(b1(ie.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),i}})],e.prototype,"popup",void 0),h([f()],e.prototype,"popupEnabled",void 0),e=h([I("esri.views.PopupView")],e),e};let DXe=class{constructor(e){this.layerView=e,this._resolver=ra(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:i,graphics:r,_resolver:s}=this;if(!i)return s.resolve(r),s.promise;let n;return i.fetchPopupFeaturesFromGraphics(r,e).catch(o=>(n=o,null)).then(o=>{o?s.resolve(o):s.reject(n)}),s.promise}};const NXe=5e3;var Mv;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(Mv||(Mv={}));let FXe=class{constructor(){this._resolver=ra(),this._status=Mv.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=Mv.RESOLVED,this._cleanUp()},()=>{this._status=Mv.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===Mv.RESOLVED}isRejected(){return this._status===Mv.REJECTED}isFulfilled(){return this._status!==Mv.PENDING}abort(){this._resolver.reject(Di())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=ra(),i=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==r||ms(s)||this._resolver.reject(s)}),e.resolve()}};const BA=t=>{let e=class extends t{constructor(...i){super(...i),this._promiseProps=new FXe,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return this._promiseProps.promise.then(()=>this).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return e=h([I("esri.core.Promise")],e),e};let az=class extends BA(Re){};az=h([I("esri.core.Promise")],az);const kXe="not-loaded",UXe="loading",zXe="failed",mce="loaded",rEe=t=>{let e=class extends t{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=QV(n,l);this.destroyed&&l(new V("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===kXe){this._set("loadStatus",UXe);const a=this._loadController=new AbortController;s({signal:a.signal})}return r(),o}})),this.when(()=>{this._set("loadStatus",mce),this._loadController=null},r=>{this._set("loadStatus",zXe),this._set("loadError",r),this._loadController=null})}destroy(){this._loadController&&(this._loadController=Ul(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===mce}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new V("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort(),this._promiseProps.abort()),this}};return h([f({readOnly:!0})],e.prototype,"loaded",null),h([f({readOnly:!0})],e.prototype,"loadError",void 0),h([f({clonable:!1})],e.prototype,"loadStatus",void 0),h([f({type:[Sf],readOnly:!0})],e.prototype,"loadWarnings",null),e=h([I("esri.core.Loadable")],e),e};let $O=class extends rEe(az){};$O=h([I("esri.core.Loadable")],$O),function(t){function e(i){return!(!i||!i.load)}t.LoadableMixin=rEe,t.isLoadable=e}($O||($O={}));const Mf=$O;async function Cte(t,e){return await t.load(),sEe(t,e)}async function sEe(t,e){const i=[],r=(...n)=>{for(const o of n)o!=null&&(Array.isArray(o)?r(...o):tt.isCollection(o)?o.forEach(a=>r(a)):Mf.isLoadable(o)&&i.push(o))};e(r);let s=null;if(await Zje(i,async n=>{const o=await Vd(VXe(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return t}function VXe(t){return"loadAll"in t&&typeof t.loadAll=="function"}let jD;function BXe(t){return jD&&!jD.destroyed||(jD=t()),jD}var X7;const GXe=new qi({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Hh=X7=class extends Re{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new X7({categories:this.categories?Q(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let i=[];this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let r="";if(this.extent){const o=W3(this.extent,We.WGS84);o!=null&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>GXe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};h([f()],Hh.prototype,"categories",void 0),h([f()],Hh.prototype,"disableExtraQuery",void 0),h([f({type:gi})],Hh.prototype,"extent",void 0),h([f()],Hh.prototype,"filter",void 0),h([f()],Hh.prototype,"num",void 0),h([f()],Hh.prototype,"query",void 0),h([f()],Hh.prototype,"sortField",void 0),h([f()],Hh.prototype,"sortOrder",null),h([f()],Hh.prototype,"start",void 0),Hh=X7=h([I("esri.portal.PortalQueryParams")],Hh);const jm=Hh;var J7;let vo=J7=class extends ye{constructor(t){super(t),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){var i;const t=this.url,e=this.thumbnail;return t&&e&&this.portal?(i=this.portal)==null?void 0:i.normalizeUrl(`${t}/info/${e}?f=json`):null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?t+"/community/groups/"+this.id:null}fetchCategorySchema(t){return this.portal.request(this.url+"/categorySchema",t).then(e=>{const i=e.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",t):i})}fetchMembers(t){return this.portal.request(this.url+"/users",t)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}toJSON(){throw new V("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new J7({sourceJSON:t});return e.read(t),e}queryItems(t,e){let i=Ln(jm,t);const r=this.portal;return parseFloat(r.currentVersion)>5?(i=i||new jm,r.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",e)):(i=i?i.clone():new jm,i.query="group:"+this.id+(i.query?" "+i.query:""),r.queryItems(i,e))}_fetchCategorySchemaSet(t,e){const i=this.portal;return i.fetchSelf(i.authMode,!0,e).then(r=>{const s=r.contentCategorySetsGroupQuery;if(s){const n=new jm({disableExtraQuery:!0,num:1,query:s});return i.queryGroups(n,e)}throw new V("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(r=>{if(r.total){const s=r.results[0],n=new jm({num:1,query:`typekeywords:"${t}"`});return s.queryItems(n,e)}throw new V("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(r=>r.total?r.results[0].fetchData("json",e).then(s=>{const n=s==null?void 0:s.categorySchema;return n!=null&&n.length?n:[]}):[])}};h([f()],vo.prototype,"access",void 0),h([f({type:Date})],vo.prototype,"created",void 0),h([f()],vo.prototype,"description",void 0),h([f()],vo.prototype,"id",void 0),h([f()],vo.prototype,"isInvitationOnly",void 0),h([f({type:Date})],vo.prototype,"modified",void 0),h([f()],vo.prototype,"owner",void 0),h([f()],vo.prototype,"portal",void 0),h([f()],vo.prototype,"snippet",void 0),h([f()],vo.prototype,"sortField",void 0),h([f()],vo.prototype,"sortOrder",void 0),h([f()],vo.prototype,"sourceJSON",void 0),h([f()],vo.prototype,"tags",void 0),h([f()],vo.prototype,"thumbnail",void 0),h([f({readOnly:!0})],vo.prototype,"thumbnailUrl",null),h([f()],vo.prototype,"title",void 0),h([f({readOnly:!0})],vo.prototype,"url",null),vo=J7=h([I("esri.portal.PortalGroup")],vo);const Q7=vo;let xw=class extends Re{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};h([f()],xw.prototype,"nextQueryParams",void 0),h([f()],xw.prototype,"queryParams",void 0),h([f()],xw.prototype,"results",void 0),h([f()],xw.prototype,"total",void 0),xw=h([I("esri.portal.PortalQueryResult")],xw);const jXe=xw;let fy=class extends ye{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){var i;const e=(i=this.portal)==null?void 0:i.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new V("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};h([f({type:Date})],fy.prototype,"created",void 0),h([f()],fy.prototype,"id",void 0),h([f()],fy.prototype,"portal",void 0),h([f()],fy.prototype,"title",void 0),h([f({readOnly:!0})],fy.prototype,"url",null),h([f()],fy.prototype,"username",void 0),fy=h([I("esri.portal.PortalFolder")],fy);const HXe=fy;var K7;let Cs=K7=class extends ye{constructor(t){super(t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userLicenseTypeId=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/content/users/${this.username}`:null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,i=t==null?void 0:t.data,r=t==null?void 0:t.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal.request(n+"/addItem",s).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}async deleteItem(t,e=!1){let i=this.userContentUrl;t.ownerFolder&&(i+="/"+t.ownerFolder);const r=e?{permanentDelete:!0}:{};await this.portal.request(i+`/items/${t.id}/delete`,{method:"post",query:r}),t.id=null,t.portal=null}async deleteItems(t,e=!1){t=t.concat();const i=this.userContentUrl+"/deleteItems",r=[],s=t.map(n=>n.id);if(s.length){const n={method:"post",query:{items:s.join(","),permanentDelete:e}},o=await this.portal.request(i,n);for(const a of o.results){const l=t.find(d=>a.itemId===d.id),c=a.success;let u=null;c?(l.id=null,l.portal=null):a.error&&(u=new V("portal:delete-item-failed",a.error.message,a.error)),r.push({item:l,success:c,error:u})}}return r}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let i;return i=e&&e.folders?e.folders.map(r=>{const s=HXe.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(i=>{const r=Q7.fromJSON(i);return r.portal=this.portal,r}):[],e})}async fetchItems(t){t??(t={});let e=this.userContentUrl??"";t.folder&&(e+="/"+t.folder.id);const{default:i}=await fe(()=>Promise.resolve().then(()=>oEe),void 0),r={folders:!1,inRecycleBin:!!t.inRecycleBin||null,foldersContent:!(t.folder||!t.includeSubfolderItems)||null,num:t.num||10,start:t.start||1,sortField:t.sortField||"created",sortOrder:t.sortOrder||"asc"},s=await this.portal.request(e,{query:r});let n;return s!=null&&s.items?(n=s.items.map(o=>{const a=i.fromJSON(o);return a.portal=this.portal,a}),await Promise.all(n.map(o=>o.load())),{items:n,nextStart:s.nextStart,total:s.total}):{items:[],nextStart:-1,total:0}}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new Q7({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new V("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}async restoreItem(t,e){const i=this.userContentUrl,r=e?{folderID:typeof e=="string"?e:e.id}:null;await this.portal.request(i+`/items/${t.id}/restore`,{method:"post",query:r})}toJSON(){throw new V("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new K7({sourceJSON:t});return e.read(t),e}};h([f()],Cs.prototype,"access",void 0),h([f({type:Date})],Cs.prototype,"created",void 0),h([f()],Cs.prototype,"culture",void 0),h([f()],Cs.prototype,"description",void 0),h([f()],Cs.prototype,"email",void 0),h([f()],Cs.prototype,"favGroupId",void 0),h([f()],Cs.prototype,"fullName",void 0),h([f({type:Date})],Cs.prototype,"modified",void 0),h([f()],Cs.prototype,"orgId",void 0),h([f()],Cs.prototype,"portal",void 0),h([f()],Cs.prototype,"preferredView",void 0),h([f()],Cs.prototype,"privileges",void 0),h([f()],Cs.prototype,"region",void 0),h([f()],Cs.prototype,"role",void 0),h([f()],Cs.prototype,"roleId",void 0),h([f()],Cs.prototype,"sourceJSON",void 0),h([f()],Cs.prototype,"thumbnail",void 0),h([f({readOnly:!0})],Cs.prototype,"thumbnailUrl",null),h([f()],Cs.prototype,"units",void 0),h([f({readOnly:!0})],Cs.prototype,"userContentUrl",null),h([f({readOnly:!0})],Cs.prototype,"url",null),h([f()],Cs.prototype,"username",void 0),h([f()],Cs.prototype,"userLicenseTypeId",void 0),h([f()],Cs.prototype,"userType",void 0),Cs=K7=h([I("esri.portal.PortalUser")],Cs);const Mte=Cs;var Uu;let HD;const gce={PortalGroup:()=>Promise.resolve({default:Q7}),PortalItem:()=>fe(()=>Promise.resolve().then(()=>oEe),void 0),PortalUser:()=>Promise.resolve({default:Mte})};let je=Uu=class extends j3(Mf){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.recycleBinEnabled=!1,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=lr.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){yce.unregister(this),this.defaultBasemap=Le(this.defaultBasemap),this.defaultDevBasemap=Le(this.defaultDevBasemap),this.defaultVectorBasemap=Le(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=Or(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)lr.request.trustedServers.includes(e)||lr.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){var i;const t=(i=this.user)==null?void 0:i.orgId,e=!t||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=Mte.fromJSON(t),e.portal=this),e}load(t){const e=fe(()=>Promise.resolve().then(()=>hJe),void 0).then(({default:i})=>{Et(t),HD=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(i=>{var r;if(pi){const s=pi;this.credential=s.findCredential(this.restUrl),this.credential||this.authMode!==Uu.AUTH_MODE_AUTO&&this.authMode!==Uu.AUTH_MODE_NO_PROMPT||((r=this._esriIdCredentialCreateHandle)==null||r.remove(),this._esriIdCredentialCreateHandle=s.on("credential-create",qXe(new WeakRef(this))),yce.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await fe(async()=>{const{default:i}=await import("./ElevationLayer-Dyq4jKg3.js");return{default:i}},__vite__mapDeps([69,70,71]))).default;return t?t.map(i=>new e({id:i.id,url:i.url})):[]}async fetchBasemaps(t,e){const i=await this._fetchBasemaps(t,e);if((e==null?void 0:e.include3d)===!0&&this.use3dBasemaps!==!1){const r=await this._fetchBasemaps3D(t,e);i.unshift(...r)}return i}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):Yn(t)?Promise.reject(Di()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,i=new jm({num:100,sortField:"title"});if(e!=null&&e.length){const r=[];for(const s of e)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,t).then(s=>s.results)}return Yn(t)?Promise.reject(Di()):Promise.resolve([])}fetchRegions(t){var i;const e=((i=this.user)==null?void 0:i.culture)||this.culture||fu();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var i;const e=((i=this.user)==null?void 0:i.culture)||this.culture||fu();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return BXe(()=>new Uu)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,i){const r=this.restUrl+"/portals/self",s={authMode:t,query:{culture:fu().toLowerCase()},withCredentials:!0,...i};return s.authMode==="auto"&&(s.authMode="no-prompt"),e&&(s.query.default=!0),this.request(r,s)}queryPortal(t,e,i,r){const s=Ln(jm,e),n=o=>this.request(this.restUrl+t,{...s.toRequestOptions(this),...r}).then(a=>{const l=s.clone();return l.start=a.nextStart,new jXe({nextQueryParams:l,queryParams:s,total:a.total,results:Uu._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Pn(l),a)));return i&&gce[i]?gce[i]().then(({default:o})=>(Et(r),n(o))):n()}signIn(){if(this.authMode===Uu.AUTH_MODE_ANONYMOUS||this.authMode===Uu.AUTH_MODE_NO_PROMPT&&!pi)return Promise.reject(new V("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return pi?pi.getCredential(this.restUrl,{prompt:this.authMode!==Uu.AUTH_MODE_NO_PROMPT}).then(e=>t(e)):t(this.credential)}normalizeUrl(t){var i;const e=(i=this.credential)==null?void 0:i.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,i){return this.request(t,e).then(r=>{const s=Uu._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():r)).then(()=>s,()=>s)})}request(t,e={}){const i={f:"json",...e.query},{authMode:r=this.authMode===Uu.AUTH_MODE_ANONYMOUS||this.authMode===Uu.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:r,body:s,cacheBust:n,method:o,query:i,responseType:a,timeout:0,signal:l};return e.withCredentials&&(c.withCredentials=!0),Yt(this._normalizeSSL(t),c).then(u=>u.data)}toJSON(){throw new V("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Uu({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new V("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const i=new jm;i.query=t||(lr.apiKey&&pee(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0;const r=await this.queryGroups(i,e);if(!r.total)return[];const s=r.results[0];i.num=100,i.query='type:"Web Map" -type:"Web Application"',i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc";const n=await s.queryItems(i,e);return n.total?n.results.filter(o=>o.type==="Web Map").map(o=>new HD({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const i=t||this.basemapGalleryGroupQuery3D;if(!i)return[];const r=new jm({query:i,disableExtraQuery:!0}),s=await this.queryGroups(r,e);if(!s.total)return[];const n=s.results[0];r.num=100,r.query='type:"Web Scene"',r.sortField=n.sortField||"name",r.sortOrder=n.sortOrder||"desc";const o=await n.queryItems(r,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new HD({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=HD.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,i,r){let s;if(i){const n=r!=null?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(t||e)&&(s=s.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};je.AUTH_MODE_ANONYMOUS="anonymous",je.AUTH_MODE_AUTO="auto",je.AUTH_MODE_IMMEDIATE="immediate",je.AUTH_MODE_NO_PROMPT="no-prompt",h([f()],je.prototype,"access",void 0),h([f()],je.prototype,"allSSL",void 0),h([f()],je.prototype,"authMode",void 0),h([f()],je.prototype,"authorizedCrossOriginDomains",void 0),h([Ce("authorizedCrossOriginDomains")],je.prototype,"readAuthorizedCrossOriginDomains",null),h([f()],je.prototype,"basemapGalleryGroupQuery",void 0),h([f({json:{name:"3DBasemapGalleryGroupQuery"}})],je.prototype,"basemapGalleryGroupQuery3D",void 0),h([f()],je.prototype,"bingKey",void 0),h([f()],je.prototype,"canListApps",void 0),h([f()],je.prototype,"canListData",void 0),h([f()],je.prototype,"canListPreProvisionedItems",void 0),h([f()],je.prototype,"canProvisionDirectPurchase",void 0),h([f()],je.prototype,"canSearchPublic",void 0),h([f()],je.prototype,"canShareBingPublic",void 0),h([f()],je.prototype,"canSharePublic",void 0),h([f()],je.prototype,"canSignInArcGIS",void 0),h([f()],je.prototype,"canSignInIDP",void 0),h([f()],je.prototype,"colorSetsGroupQuery",void 0),h([f()],je.prototype,"commentsEnabled",void 0),h([f({type:Date})],je.prototype,"created",void 0),h([f()],je.prototype,"credential",void 0),h([f()],je.prototype,"culture",void 0),h([f()],je.prototype,"currentVersion",void 0),h([f()],je.prototype,"customBaseUrl",void 0),h([f()],je.prototype,"defaultBasemap",void 0),h([Ce("defaultBasemap")],je.prototype,"readDefaultBasemap",null),h([f()],je.prototype,"defaultDevBasemap",void 0),h([Ce("defaultDevBasemap")],je.prototype,"readDefaultDevBasemap",null),h([f({type:gi})],je.prototype,"defaultExtent",void 0),h([f()],je.prototype,"defaultVectorBasemap",void 0),h([Ce("defaultVectorBasemap")],je.prototype,"readDefaultVectorBasemap",null),h([f()],je.prototype,"description",void 0),h([f()],je.prototype,"devBasemapGalleryGroupQuery",void 0),h([f()],je.prototype,"eueiEnabled",void 0),h([f({readOnly:!0})],je.prototype,"extraQuery",null),h([f()],je.prototype,"featuredGroups",void 0),h([f()],je.prototype,"featuredItemsGroupQuery",void 0),h([f()],je.prototype,"galleryTemplatesGroupQuery",void 0),h([f()],je.prototype,"layoutGroupQuery",void 0),h([f()],je.prototype,"livingAtlasGroupQuery",void 0),h([f()],je.prototype,"hasCategorySchema",void 0),h([f()],je.prototype,"helpBase",void 0),h([f()],je.prototype,"helperServices",void 0),h([f()],je.prototype,"helpMap",void 0),h([f()],je.prototype,"homePageFeaturedContent",void 0),h([f()],je.prototype,"homePageFeaturedContentCount",void 0),h([f()],je.prototype,"httpPort",void 0),h([f()],je.prototype,"httpsPort",void 0),h([f()],je.prototype,"id",void 0),h([f()],je.prototype,"ipCntryCode",void 0),h([f({readOnly:!0})],je.prototype,"isOrganization",null),h([f()],je.prototype,"isPortal",void 0),h([f()],je.prototype,"isReadOnly",void 0),h([f({readOnly:!0})],je.prototype,"itemPageUrl",null),h([f()],je.prototype,"layerTemplatesGroupQuery",void 0),h([f()],je.prototype,"maxTokenExpirationMinutes",void 0),h([f({type:Date})],je.prototype,"modified",void 0),h([f()],je.prototype,"name",void 0),h([f()],je.prototype,"portalHostname",void 0),h([f()],je.prototype,"portalMode",void 0),h([f()],je.prototype,"portalProperties",void 0),h([f()],je.prototype,"region",void 0),h([f()],je.prototype,"recycleBinEnabled",void 0),h([f({readOnly:!0})],je.prototype,"restUrl",null),h([f()],je.prototype,"rotatorPanels",void 0),h([f()],je.prototype,"showHomePageDescription",void 0),h([f()],je.prototype,"sourceJSON",void 0),h([f()],je.prototype,"staticImagesUrl",void 0),h([f({json:{name:"2DStylesGroupQuery"}})],je.prototype,"stylesGroupQuery2d",void 0),h([f({json:{name:"stylesGroupQuery"}})],je.prototype,"stylesGroupQuery3d",void 0),h([f()],je.prototype,"supportsHostedServices",void 0),h([f()],je.prototype,"symbolSetsGroupQuery",void 0),h([f()],je.prototype,"templatesGroupQuery",void 0),h([f()],je.prototype,"thumbnail",void 0),h([f({readOnly:!0})],je.prototype,"thumbnailUrl",null),h([f()],je.prototype,"units",void 0),h([f()],je.prototype,"url",void 0),h([f()],je.prototype,"urlKey",void 0),h([Ce("urlKey")],je.prototype,"readUrlKey",null),h([f()],je.prototype,"user",void 0),h([Ce("user")],je.prototype,"readUser",null),h([f()],je.prototype,"use3dBasemaps",void 0),h([f()],je.prototype,"useStandardizedQuery",void 0),h([f()],je.prototype,"useVectorBasemaps",void 0),h([f()],je.prototype,"vectorBasemapGalleryGroupQuery",void 0),je=Uu=h([I("esri.portal.Portal")],je);const No=je,yce=new FinalizationRegistry(t=>{t.remove()});function qXe(t){const e=pi;return()=>{const i=t.deref();i&&e.findCredential(i.restUrl)&&i.signIn().catch(()=>{})}}let my=class extends Re{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e!=null&&e.portalItem&&e.path?{...e,path:_ce(e.path,e.portalItem)}:e}set path(e){e!=null&&xc(e)?ie.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return _ce(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",i){const r=this.cdnUrl;if(r==null)throw new V("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:i==null?void 0:i.signal})}async update(e,i){const{addOrUpdateResources:r}=await fe(()=>Promise.resolve().then(()=>PC),void 0);return await r(this.portalItem,[{resource:this,content:e,compress:i==null?void 0:i.compress,access:i==null?void 0:i.access}],"update",i),this}hasPath(){return this.path!=null}};function _ce(t,e){return t==null?t:(t=t.replace(/^\/+/,""),e!=null&&xc(t)&&(t=lee(t,e.itemUrl)),t==null?void 0:t.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}h([f()],my.prototype,"portalItem",void 0),h([f({type:String,value:null})],my.prototype,"path",null),h([Li("path")],my.prototype,"_castPath",null),h([f({type:String,readOnly:!0})],my.prototype,"url",null),h([f({type:String,readOnly:!0})],my.prototype,"cdnUrl",null),h([f({type:String,readOnly:!0})],my.prototype,"itemRelativeUrl",null),my=h([I("esri.portal.PortalItemResource")],my);const WXe=my;let IO=class extends Re{constructor(e){super(e),this.created=null,this.rating=null}};h([f()],IO.prototype,"created",void 0),h([f()],IO.prototype,"rating",void 0),IO=h([I("esri.portal.PortalRating")],IO);const E6=IO;function k1(t,e){var r;const i=(r=e==null?void 0:e.url)==null?void 0:r.path;if(t&&i&&(t=uh(t,i,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const s=lee(t,e.portalItem.itemUrl);s!=null&&YXe.test(s)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(s).path)}return(t=eW(t,e==null?void 0:e.portal))&&eG.test(t)?Ote(t):t}function YS(t,e,i=ZI.YES){var s,n;if((t=t&&eG.test(t)?nEe(t):t)==null)return t;!xc(t)&&(e!=null&&e.blockedRelativeUrls)&&e.blockedRelativeUrls.push(t);let r=uh(t);if(e){const o=((s=e.verifyItemRelativeUrls)==null?void 0:s.rootPath)||((n=e.url)==null?void 0:n.path);if(o){const a=eW(o,e.portal),l=eW(r,e.portal);r=lee(l,a,a),r!=null&&r!==l&&r!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=Pte(r,e==null?void 0:e.portal),xc(r)&&(r=vh(r)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!xc(r)&&!Og(r)&&i===ZI.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),r}function Ate(t,e,i){return k1(t,i)}function U1(t,e,i,r){const s=YS(t,r);s!==void 0&&(e[i]=s)}const eG=/\/items\/([^/]+)\/resources\/(.*)/,YXe=/^\.\/resources\//;function ZXe(t){const e=(t==null?void 0:t.match(eG))??null;return(e==null?void 0:e[1])??null}function XXe(t){const e=(t==null?void 0:t.match(eG))??null;if(e==null)return null;const i=e[2],r=i.lastIndexOf("/");if(r===-1){const{path:o,extension:a}=iae(i);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=iae(i.slice(r+1));return{prefix:i.slice(0,r),filename:s,extension:n}}function Pte(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?X9(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function eW(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const i=`${e.urlKey}.${e.customBaseUrl}`,r=see();return SM(r,`${r.scheme}://${i}`)?X9(t,e.portalHostname,i):X9(t,i,e.portalHostname)}function Ote(t){if(!t)return t||null;let e=t;return e&&pi&&!pi.findCredential(e)&&(e=pi._normalizeAGOLorgDomain(e),e=e.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),e=e.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),e=e.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),e}function nEe(t){if(!t)return t||null;let e=t;return e=e.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),e=e.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),e=e.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),e&&pi&&!pi.findCredential(e)&&(e=pi._normalizeAGOLorgDomain(e)),e}var ZI;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(ZI||(ZI={}));const vGt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return ZI},ensureMainOnlineDomain:Pte,fromCDNUrl:nEe,fromJSON:k1,itemIdFromResourceUrl:ZXe,prefixAndFilenameFromResourceUrl:XXe,read:Ate,toCDNUrl:Ote,toJSON:YS,write:U1},Symbol.toStringTag,{value:"Module"}));var Sw;const JXe=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),QXe=new Set(["KML","GeoJson","CSV"]);let mi=Sw=class extends j3(Mf){static from(t){return $S(Sw,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let i=t;return t==="Feature Service"||t==="Feature Collection"?i=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?i=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?i="Scene Layer":t==="Video Service"?i="Video Layer":t==="Scene Package"?i="Scene Layer Package":t==="Stream Service"?i="Feature Layer":t==="Geoprocessing Service"?i=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geoenrichment Service"?i="GeoEnrichment Service":t==="Geocoding Service"?i="Locator":t==="Microsoft Powerpoint"?i="Microsoft PowerPoint":t==="GeoJson"?i="GeoJSON":t==="Globe Service"?i="Globe Layer":t==="Vector Tile Service"?i="Tile Layer":t==="netCDF"?i="NetCDF":t==="Map Service"?i=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t!=null&&t.toLowerCase().includes("add in")?i=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?i="Big Data File Share":t==="Compact Tile Package"?i="Tile Package (tpkx)":t==="Raster function template"?i="Raster Function Template":t==="OGCFeatureServer"?i="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?i="Instant App":t==="Insights Page"?i="Insights Report":t==="Excalibur Imagery Project"?i="Excalibur Project":t==="3DTiles Service"?i="3D tiles layer":t==="3DTiles Package"&&(i="3D tiles package"),i}readExtent(t){return t&&t.length?new gi(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){var m;const t=((m=this.type)==null?void 0:m.toLowerCase())||"",e=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,u=!1,d=!1,p=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),u=e.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":u?"utilitynetwork":n?"featureshosted":"features"):t==="map service"||t==="wms"||t==="wmts"?(c=e.includes("Spatiotemporal"),d=e.includes("Relational"),s=c||d?"mapimages":n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages"):s=t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":t==="3dtiles service"?e.includes("3DObject")?"3dobjecttileslayer":e.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):t==="web map"||t==="cityengine web scene"?s="maps":t==="web scene"?s=e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?s="instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?s="apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?s="mapsgray":t==="service definition"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?s="datafiles":t==="360 vr experience"?s="360vr":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?s="appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?s="addindesktop":t==="pdf"?s="pdf":t==="microsoft word"?s="word":t==="microsoft excel"?s="excel":t==="microsoft powerpoint"?s="ppt":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?s="datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?s="toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?s="layersgray":t==="analysis model"?s="analysismodel":t==="scene package"?s="scenepackage":t==="3dtiles package"?s="3dtileslayerpackage":t==="3dtiles service"?s="3dtileslayer":t==="mobile scene package"?s="mobilescenepackage":t==="tile package"||t==="compact tile package"?s="tilepackage":t==="task file"?s="taskfile":t==="report template"?s="report-template":t==="statistical data collection"?s="statisticaldatacollection":t==="insights workbook"?s="workbook":t==="insights model"?s="insightsmodel":t==="insights page"?s="insightspage":t==="insights theme"?s="insightstheme":t==="hub initiative"?s="hubinitiative":t==="hub page"?s="hubpage":t==="hub site application"?s="hubsite":t==="hub event"?s="hubevent":t==="hub project"?s="hubproject":t==="relational database connection"?s="relationaldatabaseconnection":t==="big data file share"?s="datastorecollection":t==="image collection"?s="imagecollection":t==="desktop style"?s="desktopstyle":t==="style"?s=e.includes("Dictionary")?"dictionarystyle":"style":t==="dashboard"?s="dashboard":t==="raster function template"?s="rasterprocessingtemplate":t==="vector tile package"?s="vectortilepackage":t==="ortho mapping project"?s="orthomappingproject":t==="ortho mapping template"?s="orthomappingtemplate":t==="solution"?s="solutions":t==="geopackage"?s="geopackage":t==="deep learning package"?s="deeplearningpackage":t==="real time analytic"?s="realtimeanalytics":t==="big data analytic"?s="bigdataanalytics":t==="feed"?s="feed":t==="excalibur imagery project"?s="excaliburimageryproject":t==="notebook"?s="notebook":t==="storymap"?s="storymap":t==="survey123 add in"?s="survey123addin":t==="mission"?s="mission":t==="mission report"?s="missionreport":t==="mission template"?s="missiontemplate":t==="quickcapture project"?s="quickcaptureproject":t==="pro report"?s="proreport":t==="pro report template"?s="proreporttemplate":t==="urban model"?s="urbanmodel":t==="web experience"?s="experiencebuilder":t==="web experience template"?s="webexperiencetemplate":t==="experience builder widget"?s="experiencebuilderwidget":t==="experience builder widget package"?s="experiencebuilderwidgetpackage":t==="workflow"?s="workflow":t==="kernel gateway connection"?s="kernelgatewayconnection":t==="insights script"?s="insightsscript":t==="hub initiative template"?s="hubinitiativetemplate":t==="storymap theme"?s="storymaptheme":t==="knowledge graph"?s="knowledgegraph":t==="knowledge graph layer"?s="knowledgegraphlayer":t==="knowledge studio project"?s="knowledgestudio":t==="native application"?s="nativeapp":t==="native application installer"?s="nativeappinstaller":t==="web link chart"?s="linkchart":t==="knowledge graph web investigation"?s="investigation":t==="ogcfeatureserver"?s="features":t==="pro project"?s="proproject":t==="insights workbook package"?s="insightsworkbookpackage":t==="apache parquet"?s="apacheparquet":t==="notebook code snippet library"?s="notebookcodesnippets":t==="suitability model"?s="suitabilitymodel":t==="esri classifier definition"?s="classifierdefinition":t==="esri classification schema"?s="classificationschema":t==="insights data engineering workbook"?s="dataengineeringworkbook":t==="insights data engineering model"?s="dataengineeringmodel":t==="deep learning studio project"?s="deeplearningproject":t==="discussion"?s="discussion":t==="allsource project"?s="allsourceproject":t==="api key"?s="apikey":t==="data pipeline"?s="datapipelines":t==="group layer"?(p=e.includes("Map"),s=p?"layergroup2d":"layergroup"):s=t==="media layer"?"onlinemedialayer":t==="form"?e.includes("Survey123")?"survey":"datafilesgray":t==="csv"?"csv":t==="image"?"image":"maps",s?mr(i+s+r+".png"):null}get isLayer(){return this.type!=null&&JXe.has(this.type)}get itemCdnUrl(){return Ote(this.itemUrl)}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var i;const t=this.itemUrl,e=this.thumbnail;return t&&e?((i=this.portal)==null?void 0:i.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){var i,r,s;const t=(i=this.portal)==null?void 0:i.restUrl;if(!t)return null;const e=this.owner||((s=(r=this.portal)==null?void 0:r.user)==null?void 0:s.username);return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=No.getDefault()),i=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof E6&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new E6({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:Q(this.applicationProxies),avgRating:this.avgRating,categories:Q(this.categories),created:Q(this.created),culture:this.culture,description:this.description,extent:Q(this.extent),groupCategories:Q(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:Q(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:Q(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:Q(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Q(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new Sw({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){var i;const t=this.toJSON();for(const r of["tags","typeKeywords","categories"])t[r]=(i=t[r])==null?void 0:i.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return this.portal.request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new E6(e)):null}fetchRelatedItems(t,e){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},Sw)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t==null?void 0:t.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?i.query.text=e:typeof e=="object"&&(i.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new V("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new V("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:i}=this;await e.signIn();const{copyResources:r,folder:s,tags:n,title:o}=t||{},a={method:"post",query:{copyPrivateResources:r==="all",folder:typeof s=="string"?s:s==null?void 0:s.id,includeResources:!!r,tags:n==null?void 0:n.join(","),title:o}},{itemId:l}=await e.request(`${i}/copy`,a);return new Sw({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,i=t.filename,r={method:"post"};if(typeof e=="string")Og(e)?r.query={data:e}:r.query={url:uh(e)},i!=null&&(r.query.filename=i);else{const s=new FormData;i!=null?s.append("file",e,i):s.append("file",e),r.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new V("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:i}=await fe(()=>Promise.resolve().then(()=>PC),void 0);return i(this,t,e)}async addResource(t,e,i){const{addOrUpdateResources:r}=await fe(()=>Promise.resolve().then(()=>PC),void 0);return t.portalItem=this,await r(this,[{resource:t,content:e,compress:i==null?void 0:i.compress,access:i==null?void 0:i.access}],"add",i),t}async removeResource(t,e){const{removeResource:i}=await fe(()=>Promise.resolve().then(()=>PC),void 0);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new V("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await fe(()=>Promise.resolve().then(()=>PC),void 0);return e(this,t)}resourceFromPath(t){return new WXe({portalItem:this,path:t})}toJSON(){var i,r;const t=this.extent,e={accessInformation:this.accessInformation,categories:Q(this.categories),created:(i=this.created)==null?void 0:i.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:(r=this.modified)==null?void 0:r.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:Q(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Q(this.typeKeywords),url:this.url};return JUe(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Sw({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};h([f({type:["private","shared","org","public"]})],mi.prototype,"access",void 0),h([f()],mi.prototype,"accessInformation",void 0),h([f({type:String})],mi.prototype,"apiKey",void 0),h([f({json:{read:{source:"appProxies"}}})],mi.prototype,"applicationProxies",void 0),h([f()],mi.prototype,"avgRating",void 0),h([f()],mi.prototype,"categories",void 0),h([f({type:Date})],mi.prototype,"created",void 0),h([f()],mi.prototype,"culture",void 0),h([f()],mi.prototype,"description",void 0),h([f({readOnly:!0})],mi.prototype,"displayName",null),h([f({type:gi})],mi.prototype,"extent",void 0),h([Ce("extent")],mi.prototype,"readExtent",null),h([f()],mi.prototype,"groupCategories",void 0),h([f({readOnly:!0})],mi.prototype,"iconUrl",null),h([f()],mi.prototype,"id",void 0),h([f({readOnly:!0})],mi.prototype,"isLayer",null),h([f({type:Boolean,readOnly:!0})],mi.prototype,"isOrgItem",void 0),h([f()],mi.prototype,"itemControl",void 0),h([f({readOnly:!0})],mi.prototype,"itemPageUrl",null),h([f({readOnly:!0})],mi.prototype,"itemUrl",null),h([f()],mi.prototype,"licenseInfo",void 0),h([f({type:Date})],mi.prototype,"modified",void 0),h([f()],mi.prototype,"name",void 0),h([f()],mi.prototype,"numComments",void 0),h([f()],mi.prototype,"numRatings",void 0),h([f()],mi.prototype,"numViews",void 0),h([f()],mi.prototype,"owner",void 0),h([f()],mi.prototype,"ownerFolder",void 0),h([f({type:No})],mi.prototype,"portal",void 0),h([f()],mi.prototype,"screenshots",void 0),h([f()],mi.prototype,"size",void 0),h([f()],mi.prototype,"snippet",void 0),h([f()],mi.prototype,"sourceJSON",void 0),h([f({type:String})],mi.prototype,"sourceUrl",void 0),h([f({type:String})],mi.prototype,"spatialReference",void 0),h([f()],mi.prototype,"tags",void 0),h([f()],mi.prototype,"thumbnail",void 0),h([f({readOnly:!0})],mi.prototype,"thumbnailUrl",null),h([f()],mi.prototype,"title",void 0),h([f()],mi.prototype,"type",void 0),h([f()],mi.prototype,"typeKeywords",void 0),h([f({type:String,json:{read(t,e){var i;if(QXe.has(e.type)){const r=(i=this.portal)==null?void 0:i.restUrl;t||(t=r&&this.id?`${r}/content/items/${this.id}/data`:null)}return t}}})],mi.prototype,"url",void 0),h([f({readOnly:!0})],mi.prototype,"userItemUrl",null),mi=Sw=h([I("esri.portal.PortalItem")],mi);const l1=mi,oEe=Object.freeze(Object.defineProperty({__proto__:null,default:l1},Symbol.toStringTag,{value:"Module"}));async function KXe(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t.includes("-3d")?t.slice(0,t.indexOf("-3d")):t,i=await Jxe("esri/t9n/basemaps");return i[t]||i[e]}const tW={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return mr("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return mr("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return mr("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return mr("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return mr("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return mr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return mr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return mr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return mr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return mr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return mr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return mr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return mr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return mr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return mr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},eJe=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let W_=class extends Re{constructor(e){super(e),this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps",this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;const e=fu().toLowerCase();switch(e){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const i=g6e(e);return i==="pt"?"pt-BR":i&&eJe.has(i)?i:"global"}};h([f()],W_.prototype,"id",void 0),h([f()],W_.prototype,"language",void 0),h([f()],W_.prototype,"places",void 0),h([f()],W_.prototype,"serviceUrl",void 0),h([f()],W_.prototype,"worldview",void 0),W_=h([I("esri.support.BasemapStyle")],W_);const tJe=W_,iJe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),rJe=new Set(["catalog","csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","knowledge-graph","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function sJe(t){return t.layerContainerType==="basemap"?iJe:t.layerContainerType==="operational-layers"?rJe:null}function nJe(t,e){if(e.restrictedWebMapWriting){const i=sJe(e);return i==null||i.has(t.type)&&!VB(t)}return!0}function oJe(t,e){var i;if(e)if(VB(t)){const r=WV("featureCollection.layers",e),s=(i=r==null?void 0:r[0])==null?void 0:i.layerDefinition;s&&vce(t,s)}else t.type!=="group"&&vce(t,e)}function vce(t,e){"maxScale"in t&&(e.maxScale=mU(t.maxScale)??void 0),"minScale"in t&&(e.minScale=mU(t.minScale)??void 0)}function aJe(t,e){if(oJe(t,e),e&&(e.id=t.id,"blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=mU(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(VB(t)){const i=e.featureCollection;i&&(i.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function bce(t,e,i){if(!t.persistenceEnabled)return null;if(!("write"in t)||!t.write)return i!=null&&i.messages&&i.messages.push(new V("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(VB(t)&&!t.isTable)e=t.resourceInfo;else if(nJe(t,i)){const r={};return t.write(r,i)?r:null}return e!=null&&aJe(t,e=Q(e)),e}var LO;let lJe=0,zu=LO=class extends j3(Mf){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+lJe++,this.baseLayers=new tt,this.referenceLayers=new tt;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&ie.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.addHandles([this.baseLayers.on("after-add",r=>e(r.item)),this.referenceLayers.on("after-add",r=>e(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{ie.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.baseLayers.toArray();for(const i of t)i.destroy();const e=this.referenceLayers.toArray();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=Le(this.portalItem)}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",O1(t,this._get("baseLayers")))}_writeBaseLayers(t,e,i){const r=[];t&&(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=bce(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);n!=null&&r.push(n)}),this.referenceLayers.forEach(s=>{const n=bce(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);n!=null&&(s.type!=="scene"&&(n.isReference=!0),r.push(n))})),e.baseMapLayers=r}set referenceLayers(t){this._set("referenceLayers",O1(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Cte(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>tU(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>tU(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new LO({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){var i;return t=t||{},e!=null&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&((i=this.resourceInfo)!=null&&i.data.baseMapLayers)&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const s=Q(r);return s.url&&zd(s.url)&&(s.url=`https:${s.url}`),s.templateUrl&&zd(s.templateUrl)&&(s.templateUrl=`https:${s.templateUrl}`),s})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:i,style:r}=this;Et(t);const s=[];if(e){const n=e.context?e.context.url:null;if(s.push(this._loadLayersFromJSON(e.data,n,t)),e.data.id&&!e.data.title){const o=e.data.id;s.push(KXe(o).then(a=>{a&&this.read({title:a},e.context)}))}}else i?s.push(this._loadFromItem(i,t)):r&&s.push(this._loadFromStylesService(r,t));await Promise.all(s)}async _loadLayersFromJSON(t,e,i){var l,c;const r=(l=this.resourceInfo)==null?void 0:l.context,s=((c=this.portalItem)==null?void 0:c.portal)||(r==null?void 0:r.portal)||null,n=uJe[(r==null?void 0:r.origin)||""]??"web-map",{populateOperationalLayers:o}=await fe(async()=>{const{populateOperationalLayers:u}=await import("./layersCreator-ClsCR6T7.js");return{populateOperationalLayers:u}},__vite__mapDeps([72,73,74])),a=[];if(Et(i),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const u={context:{...r,origin:n,url:e,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},d=g=>n==="web-scene"&&g.layerType==="ArcGISSceneServiceLayer"||g.isReference,p=o(this.baseLayers,t.baseMapLayers.filter(g=>!d(g)),u);a.push(p);const m=o(this.referenceLayers,t.baseMapLayers.filter(d),u);a.push(m)}await Promise.allSettled(a)}async _loadFromItem(t,e){const i=await t.load(e),r=await i.fetchData("json",e),s=Ns(t.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:cJe[t.type||""]??"web-map",portal:t.portal||No.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||No.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}async _loadFromStylesService(t,e){const i=`${t.serviceUrl}/${t.id}`,r=(await Yt(i,{query:{language:t.getLanguageParamValue(),places:t.places,worldview:t.worldview},signal:e==null?void 0:e.signal})).data,s=Ns(i);return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:"web-map",url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}static fromId(t){const e=tW[t];return e?e.itemId?new LO({portalItem:{id:e.itemId,portal:{url:"https://www.arcgis.com"}}}):LO.fromJSON(e,{origin:e.is3d?"web-scene":"web-map"}):null}};h([f({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,i,r){this._writeBaseLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:tt}},writer(t,e,i,r){this._writeBaseLayers(t,e,r)}}}}}})],zu.prototype,"baseLayers",null),h([f({type:String,json:{origins:{"web-scene":{write:!0}}}})],zu.prototype,"id",void 0),h([f({type:l1})],zu.prototype,"portalItem",void 0),h([f()],zu.prototype,"referenceLayers",null),h([f({readOnly:!0})],zu.prototype,"resourceInfo",void 0),h([f({type:We})],zu.prototype,"spatialReference",void 0),h([f({type:tJe})],zu.prototype,"style",void 0),h([f()],zu.prototype,"thumbnailUrl",void 0),h([f({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],zu.prototype,"title",void 0),h([Ve("title")],zu.prototype,"writeTitle",null),zu=LO=h([I("esri.Basemap")],zu);const cJe={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},uJe={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},YC=zu,hJe=Object.freeze(Object.defineProperty({__proto__:null,default:YC},Symbol.toStringTag,{value:"Module"})),lz={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function aEe(t){return!!lz[t]||!!lz[t.toLowerCase()]}function Rte(t){return lz[t]??lz[t.toLowerCase()]}function dJe(t){return[...Rte(t)]}function C6(t,e,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?t+(e-t)*r:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function lEe(t,e,i,r=1){const s=(t%360+360)%360/360,n=i<=.5?i*(e+1):i+e-i*e,o=2*i-n;return[Math.round(255*C6(o,n,s+1/3)),Math.round(255*C6(o,n,s)),Math.round(255*C6(o,n,s-1/3)),r]}function pJe(t){const e=t.length>5,i=e?8:4,r=(1<<i)-1,s=e?1:17,n=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}function qD(t){return Te(qK(t),0,255)}function WD(t,e,i){return t=Number(t),isNaN(t)?i:t<e?e:t>i?i:t}function YD(t,e){const i=t.toString(16).padStart(2,"0");return e?i.substring(0,1):i}let X4=class Bo{static blendColors(e,i,r,s=new Bo){return s.r=Math.round(e.r+(i.r-e.r)*r),s.g=Math.round(e.g+(i.g-e.g)*r),s.b=Math.round(e.b+(i.b-e.b)*r),s.a=e.a+(i.a-e.a)*r,s._sanitize()}static fromRgb(e,i){const r=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),n=r[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),Bo.fromArray(a,i)}return Bo.fromArray(s.map(a=>parseFloat(a)),i)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return Bo.fromArray(lEe(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(e,i=new Bo){if(e[0]!=="#"||isNaN(+`0x${e.substring(1)}`))return null;switch(e.length){case 4:case 5:{const r=parseInt(e.substring(1,2),16),s=parseInt(e.substring(2,3),16),n=parseInt(e.substring(3,4),16),o=e.length===5?15:parseInt(e.substring(4),16);return Bo.fromArray([r+16*r,s+16*s,n+16*n,(o+16*o)/255],i)}case 7:case 9:{const r=parseInt(e.substring(1,3),16),s=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16),o=e.length===7?255:parseInt(e.substring(7),16);return Bo.fromArray([r,s,n,o/255],i)}default:return null}}static fromArray(e,i=new Bo){return i._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(e,i){const r=aEe(e)?Rte(e):null;return r&&Bo.fromArray(r,i)||Bo.fromRgb(e,i)||Bo.fromHex(e,i)}static fromJSON(e){return e!=null?new Bo([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?Bo.fromString(e,this):Array.isArray(e)?Bo.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof Bo||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const i=(e==null?void 0:e.capitalize)??!1,r=(e==null?void 0:e.digits)??6,s=r===3||r===4,n=r===4||r===8,o=`#${YD(this.r,s)}${YD(this.g,s)}${YD(this.b,s)}${n?YD(Math.round(255*this.a),s):""}`;return i?o.toUpperCase():o}toCss(e=!1){const i=this.r+", "+this.g+", "+this.b;return e?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=Bo.AlphaMode.ALWAYS){const i=qD(this.r),r=qD(this.g),s=qD(this.b);return e===Bo.AlphaMode.ALWAYS||this.a!==1?[i,r,s,qD(255*this.a)]:[i,r,s]}clone(){return new Bo(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(WD(this.r,0,255)),this.g=Math.round(WD(this.g,0,255)),this.b=Math.round(WD(this.b,0,255)),this.a=WD(this.a,0,1),this}_set(e,i,r,s){this.r=e,this.g=i,this.b=r,this.a=s}};X4.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(X4||(X4={}));const Oe=X4;function wGt(t){}function fJe(t){return()=>t}function ct(t,e={}){const i=t instanceof qi?t:new qi(t,e),r={type:(e==null?void 0:e.ignoreUnknown)??1?i.apiValues:String,json:{type:i.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:i.read},write:{writer:i.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(r.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(r.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(r.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(r.nonNullable=e.nonNullable),f(r)}var iW;let J4=iW=class extends ye{constructor(t){super(t),this.type="none"}clone(){return new iW({type:this.type})}};h([ct({none:"none",stayAbove:"stay-above"})],J4.prototype,"type",void 0),J4=iW=h([I("esri.ground.NavigationConstraint")],J4);function tG(t){const e=qK(100*(1-t));return Math.max(0,Math.min(e,100))}function XI(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var rW;let gy=rW=class extends j3(Mf){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new tt;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&ie.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>e(r.item)),this.layers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{ms(t)||ie.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)Le(e);this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",O1(t,this._get("layers")))}writeLayers(t,e,i,r){const s=[];t&&(r={...r,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const o={};fJe(n)().write(o,r)&&s.push(o)}else r!=null&&r.messages&&r.messages.push(new V("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Cte(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:i}=await fe(()=>import("./ElevationQuery-C00OyUSJ.js"),[]);Et(e);const r=new i,s=this.layers.filter(wce).toArray();return r.queryAll(s,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:i}=await fe(()=>import("./ElevationQuery-C00OyUSJ.js"),[]);Et(e);const r=new i,s=this.layers.filter(wce).toArray();return r.createSamplerAll(s,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:Q(this.surfaceColor),navigationConstraint:Q(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new rW({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}async _loadLayersFromJSON(t,e,i){const r=(e==null?void 0:e.origin)||"web-scene",s=(e==null?void 0:e.portal)||null,n=(e==null?void 0:e.url)||null,{populateOperationalLayers:o}=await fe(async()=>{const{populateOperationalLayers:l}=await import("./layersCreator-ClsCR6T7.js");return{populateOperationalLayers:l}},__vite__mapDeps([72,73,74]));Et(i);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}await Promise.allSettled(a)}};function mJe(t){return t&&"createElevationSampler"in t}function wce(t){return t.type==="elevation"||mJe(t)}h([f({json:{read:!1}})],gy.prototype,"layers",null),h([Ve("layers")],gy.prototype,"writeLayers",null),h([f({readOnly:!0})],gy.prototype,"resourceInfo",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Qr,read:{reader:XI,source:"transparency"},write:{writer:(t,e)=>{e.transparency=tG(t)},target:"transparency"}}})],gy.prototype,"opacity",void 0),h([f({type:Oe,json:{type:[Qr],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],gy.prototype,"surfaceColor",void 0),h([f({type:J4,json:{write:!0}})],gy.prototype,"navigationConstraint",void 0),gy=rW=h([I("esri.Ground")],gy);const cz=gy;let eE=class extends tt{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles(z1e(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let i=0;for(const r of e)r!=null&&(i=this._processCollection(i,r));this.splice(i,this.length)}_createNewInstance(e){return new tt(e)}_processCollection(e,i){if(!i)return e;const r=this.itemFilterFunction??(s=>!!s);for(const s of i)if(s){if(r(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const o of n)e=this._processCollection(e,o);else e=this._processCollection(e,n)}}return e}};h([f()],eE.prototype,"getCollections",void 0),h([f()],eE.prototype,"getChildrenFunction",void 0),h([f()],eE.prototype,"itemFilterFunction",void 0),eE=h([I("esri.core.CollectionFlattener")],eE);const ZM=eE,ZD=new WeakMap;function cEe(t){return!t.destroyed&&(ZD.has(t)||t.addHandles([ue(()=>{const e=t.parent;return!(!e||!("type"in e))&&(e.type==="catalog-dynamic-group"||cEe(e))},e=>ZD.set(t,e),sr),Ni(()=>ZD.delete(t))]),ZD.get(t))}function gJe(t){return typeof t=="object"&&t!=null&&"loaded"in t&&t.loaded===!0&&"type"in t}function yJe(t){var e,i;return!(!gJe(t)||!((i=(e=k7e(t))==null?void 0:e.operations)!=null&&i.supportsEditing)||"editingEnabled"in t&&!z7e(t)||cEe(t))}function iG(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function _Je(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function vJe(t,e,i,r,s,n,o,a,l,c,u,d,p,m,g,y){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=i,v[3]=r,v[4]=s,v[5]=n,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=u,v[11]=d,v[12]=p,v[13]=m,v[14]=g,v[15]=y,v}function bJe(t,e){return new Float32Array(t,e,16)}const wJe=iG();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:wJe,clone:_Je,create:iG,createView:bJe,fromValues:vJe},Symbol.toStringTag,{value:"Module"}));const xJe=(t,e)=>{const i=Rg(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return bu(i,i)},SJe=(t,e)=>{const i=Rg(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return bu(i,i)},TJe=(t,e)=>{const i=1-e,r=Rg(t,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return bu(r,r)},EJe=(t,e)=>{const i=Math.sin(e*Math.PI/180),r=Math.cos(e*Math.PI/180),s=Rg(t,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return bu(s,s)},CJe=(t,e)=>{const i=1-2*e,r=Rg(t,i,0,0,e,0,i,0,e,0,0,i,e,0,0,0,1);return bu(r,r)},MJe=(t,e)=>{const i=Rg(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return bu(i,i)},AJe=(t,e)=>{const i=1-e,r=Rg(t,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return bu(r,r)};let uEe=class hEe{constructor(e,i,r){this.strength=e,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(e,i,r){this.strength=Qc(e.strength,i.strength,r),this.radius=Qc(e.radius,i.radius,r),this.threshold=Qc(e.threshold,i.threshold,r)}clone(){return new hEe(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:B$(this.radius),strength:this.strength,threshold:this.threshold}}},dEe=class pEe{constructor(e){this.radius=e,this.type="blur"}interpolate(e,i,r){this.radius=Math.round(Qc(e.radius,i.radius,r))}clone(){return new pEe(this.radius)}toJSON(){return{type:"blur",radius:B$(this.radius)}}},sW=class fEe{constructor(e,i){this.type=e,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.amount=Qc(e.amount,i.amount,r),this._updateMatrix()}clone(){return new fEe(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||iG();switch(this.type){case"brightness":this._colorMatrix=xJe(e,this.amount);break;case"contrast":this._colorMatrix=SJe(e,this.amount);break;case"grayscale":this._colorMatrix=TJe(e,this.amount);break;case"invert":this._colorMatrix=CJe(e,this.amount);break;case"saturate":this._colorMatrix=MJe(e,this.amount);break;case"sepia":this._colorMatrix=AJe(e,this.amount)}}},mEe=class gEe{constructor(e,i,r,s){this.offsetX=e,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(e,i,r){this.offsetX=Qc(e.offsetX,i.offsetX,r),this.offsetY=Qc(e.offsetY,i.offsetY,r),this.blurRadius=Qc(e.blurRadius,i.blurRadius,r),this.color[0]=Math.round(Qc(e.color[0],i.color[0],r)),this.color[1]=Math.round(Qc(e.color[1],i.color[1],r)),this.color[2]=Math.round(Qc(e.color[2],i.color[2],r)),this.color[3]=Qc(e.color[3],i.color[3],r)}clone(){return new gEe(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:B$(this.offsetX),yoffset:B$(this.offsetY),blurRadius:B$(this.blurRadius),color:e}}},yEe=class _Ee{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.angle=Qc(e.angle,i.angle,r),this._updateMatrix()}clone(){return new _Ee(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||iG();this._colorMatrix=EJe(e,this.angle)}},vEe=class bEe{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,i,r){this.amount=Qc(e.amount,i.amount,r)}clone(){return new bEe(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function Qc(t,e,i){return t+(e-t)*i}function B$(t){return Math.round(1e3*Do(t))/1e3}function PJe(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new sW(t.type,0);case"saturate":case"brightness":case"contrast":return new sW(t.type,1);case"opacity":return new vEe(1);case"hue-rotate":return new yEe(0);case"blur":return new dEe(0);case"drop-shadow":return new mEe(0,0,0,[...Rte("transparent")]);case"bloom":return new uEe(0,0,1)}}function OJe(t,e){const i=t.length>e.length?t:e;return(t.length>e.length?e:t).every((r,s)=>r.type===i[s].type)}function RJe(t,e){const i=t.length>e.length?t:e,r=t.length>e.length?e:t;for(let s=r.length;s<i.length;s++)r.push(PJe(i[s]))}function $Je(t){const e=t[0];return!!e&&"type"in e}const xce=()=>ie.getLogger("esri.support.basemapUtils");function IJe(){return{}}function LJe(t){for(const e in t){const i=t[e];Le(i),delete t[e]}}function DJe(t,e){let i;if(typeof t=="string"){const r=t in tW,s=!r&&t.includes("/");if(!r&&!s){const n=Object.entries(tW).filter(([o,a])=>lr.apiKey&&!a.classic||!lr.apiKey&&(a.classic||a.is3d)).map(([o])=>`"${o}"`).sort().join(", ");return xce().warn(`Unable to find basemap definition for: ${t}. Try one of these: ${n}`),null}e&&(i=e[t]),i||(i=r?YC.fromId(t):new YC({style:{id:t}}),e&&(e[t]=i))}else i=Ln(YC,t);return i!=null&&i.destroyed&&(xce().warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function SGt(t,e){var i,r,s,n;return((r=(i=t.basemap)==null?void 0:i.referenceLayers)==null?void 0:r.some(o=>o.uid===e))||((n=(s=t.basemap)==null?void 0:s.baseLayers)==null?void 0:n.some(o=>o.uid===e))}function NJe(t){return new ZM({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const i=[];return"tables"in e&&i.push(e.tables),"layers"in e&&i.push(e.layers),i},itemFilterFunction:e=>{const i=e.parent;return!!i&&"tables"in i&&i.tables.includes(e)}})}function M6(t){for(const e of t.values())e==null||e.destroy();t.clear()}const Sce={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function FJe(t){let e=null;if(typeof t=="string")if(t in Sce){const i=Sce[t];e=new cz({resourceInfo:{data:{layers:[i]}}})}else ie.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=Ln(cz,t);return e}const Tce={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function A6(t,e,i,r=xg){const s=new Ch(Fee(r)),n=li.fromJSDate(t,{zone:s}),o=i==="decades"||i==="centuries"?"year":xEe(i);return i==="decades"&&(e*=10),i==="centuries"&&(e*=100),n.plus({[o]:e}).toJSDate()}function TGt(t,e,i="milliseconds"){const r=t.getTime(),s=wEe(e,i,"milliseconds");return new Date(r+s)}function Ece(t,e,i=xg){const r=new Ch(Fee(i)),s=li.fromJSDate(t,{zone:r});if(e==="decades"||e==="centuries"){const o=s.startOf("year"),{year:a}=o,l=a-a%(e==="decades"?10:100);return o.set({year:l}).toJSDate()}const n=xEe(e);return s.startOf(n).toJSDate()}function wEe(t,e,i){return t===0?0:t*Tce[e]/Tce[i]}function EGt(t,e){return t&&e?t.intersection(e):t||e}function xEe(t){switch(t){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var qh;let eh=qh=class extends ye{static get allTime(){return Cce}static get empty(){return kJe}static fromArray(t){return new qh({start:t[0]!=null?new Date(t[0]):t[0],end:t[1]!=null?new Date(t[1]):t[1]})}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=(t==null?void 0:t.getTime())??null}get isAllTime(){return this.equals(qh.allTime)}get isEmpty(){return this.equals(qh.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=(t==null?void 0:t.getTime())??null}clone(){return new qh({end:this.end,start:this.start})}equals(t){var n,o,a,l;if(!t)return!1;const e=((n=this.start)==null?void 0:n.getTime())??this.start,i=((o=this.end)==null?void 0:o.getTime())??this.end,r=((a=t.start)==null?void 0:a.getTime())??t.start,s=((l=t.end)==null?void 0:l.getTime())??t.end;return e===r&&i===s}expandTo(t,e=xg){if(this.isEmpty||this.isAllTime)return this.clone();let i=this.start;i&&(i=Ece(i,t,e));let r=this.end;if(r){const s=Ece(r,t,e);r=r.getTime()===s.getTime()?s:A6(s,1,t,e)}return new qh({start:i,end:r})}intersection(t){var a,l,c,u;if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return qh.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=((a=this.start)==null?void 0:a.getTime())??-1/0,i=((l=this.end)==null?void 0:l.getTime())??1/0,r=((c=t.start)==null?void 0:c.getTime())??-1/0,s=((u=t.end)==null?void 0:u.getTime())??1/0;let n,o;return r>=e&&r<=i?n=r:e>=r&&e<=s&&(n=e),i>=r&&i<=s?o=i:s>=e&&s<=i&&(o=s),n==null||o==null||isNaN(n)||isNaN(o)?qh.empty:new qh({start:n===-1/0?null:new Date(n),end:o===1/0?null:new Date(o)})}offset(t,e,i=xg){if(this.isEmpty||this.isAllTime)return this.clone();const r=new qh,{start:s,end:n}=this;return s!=null&&(r.start=A6(s,t,e,i)),n!=null&&(r.end=A6(n,t,e,i)),r}toArray(){var t,e;return this.isEmpty?[void 0,void 0]:[((t=this.start)==null?void 0:t.getTime())??null,((e=this.end)==null?void 0:e.getTime())??null]}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return Cce.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,i=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new qh({start:e,end:i})}};h([f({type:Date,json:{write:{allowNull:!0}}})],eh.prototype,"end",void 0),h([Ce("end")],eh.prototype,"readEnd",null),h([Ve("end")],eh.prototype,"writeEnd",null),h([f({readOnly:!0,json:{read:!1}})],eh.prototype,"isAllTime",null),h([f({readOnly:!0,json:{read:!1}})],eh.prototype,"isEmpty",null),h([f({type:Date,json:{write:{allowNull:!0}}})],eh.prototype,"start",void 0),h([Ce("start")],eh.prototype,"readStart",null),h([Ve("start")],eh.prototype,"writeStart",null),eh=qh=h([I("esri.TimeExtent")],eh);const Cce=new eh,kJe=new eh({start:void 0,end:void 0}),Sg=eh;let SEe=0;const rG=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+SEe++})}};return e=h([I("esri.core.Identifiable")],e),e},CGt=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:SEe++})}};return e=h([I("esri.core.Identifiable.NumericIdentifiable")],e),e};let Mce=class extends rG(class{}){};Mce=h([I("esri.core.Identifiable")],Mce);async function UJe(t){var r;const e="portalItem"in t?t:{portalItem:t},{fromItem:i}=await fe(async()=>{const{fromItem:s}=await import("./portalLayers-COfaAUa5.js").then(n=>n.p);return{fromItem:s}},__vite__mapDeps([73,74]));try{return await i(e)}catch(s){const n=e==null?void 0:e.portalItem,o=(n==null?void 0:n.id)||"unset",a=((r=n==null?void 0:n.portal)==null?void 0:r.url)||lr.portalUrl;throw ie.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+a+"', id: '"+o+"')",s),s}}let zJe=0,Kn=class extends cn.EventedMixin(rG(Mf)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new gi(-180,-90,180,90,We.WGS84),this.id=Date.now().toString(16)+"-layer-"+zJe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=We.WGS84,this.title=null,this.type=null,this.url=null,this.visibilityTimeExtent=null,this.visible=!0}static async fromArcGISServerUrl(e){const i=typeof e=="string"?{url:e}:e;return(await fe(async()=>{const{fromUrl:r}=await import("./arcgisLayers-CffRUE5l.js");return{fromUrl:r}},__vite__mapDeps([75,74]))).fromUrl(i)}static fromPortalItem(e){return UJe(e)}initialize(){this.when().catch(e=>{ms(e)||ie.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){const e=this.parent;if(e){const i=this;"layers"in e&&e.layers.includes(i)?e.layers.remove(i):"tables"in e&&e.tables.includes(i)?e.tables.remove(i):"baseLayers"in e&&e.baseLayers.includes(i)?e.baseLayers.remove(i):"referenceLayers"in e&&e.referenceLayers.includes(i)&&e.referenceLayers.remove(i),this._set("parent",null)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return Ns(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Yt(e,{query:{f:"json"},responseType:"json"})).data;throw new V("layer:no-attribution-data","Layer does not have attribution data")}};h([f({type:String})],Kn.prototype,"attributionDataUrl",void 0),h([f({type:gi})],Kn.prototype,"fullExtent",void 0),h([f({readOnly:!0})],Kn.prototype,"hasAttributionData",null),h([f({type:String,clonable:!1})],Kn.prototype,"id",void 0),h([f({type:Boolean,nonNullable:!0})],Kn.prototype,"legendEnabled",void 0),h([f({type:["show","hide","hide-children"]})],Kn.prototype,"listMode",void 0),h([f({type:Number,range:{min:0,max:1},nonNullable:!0})],Kn.prototype,"opacity",void 0),h([f({clonable:!1})],Kn.prototype,"parent",void 0),h([f({readOnly:!0})],Kn.prototype,"parsedUrl",null),h([f({type:Boolean,readOnly:!0})],Kn.prototype,"persistenceEnabled",void 0),h([f({type:Boolean})],Kn.prototype,"popupEnabled",void 0),h([f({type:Boolean})],Kn.prototype,"attributionVisible",void 0),h([f({type:We})],Kn.prototype,"spatialReference",void 0),h([f({type:String})],Kn.prototype,"title",void 0),h([f({readOnly:!0,json:{read:!1}})],Kn.prototype,"type",void 0),h([f()],Kn.prototype,"url",void 0),h([f({type:Sg})],Kn.prototype,"visibilityTimeExtent",void 0),h([f({type:Boolean,nonNullable:!0})],Kn.prototype,"visible",void 0),Kn=h([I("esri.layers.Layer")],Kn);const uL=Kn;function nW(t,e,i){let r,s;if(t)for(let n=0,o=t.length;n<o;n++){if(r=t.at(n),(r==null?void 0:r[e])===i)return r;if((r==null?void 0:r.type)==="group"&&(s=nW(r.layers,e,i),s))return s}}const VJe=t=>{let e=class extends t{constructor(...i){super(...i),this.layers=new tt;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||ie.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>{if(o.item===this)return o.preventDefault(),void ie.getLogger(this).error("#add()","Cannot add layer to itself.");r(o.item)}),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))])}destroy(){const i=this.layers.toArray();for(const r of i)r.destroy();this.layers.destroy()}set layers(i){this._set("layers",O1(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof uL){const n=i;n.parent===this?this.reorder(n,r):s.add(n,r)}else Cu(i)?i.then(n=>{this.destroyed||this.add(n,r)}):ie.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;let n=s.getNextIndex(r);i.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(i){return nW(this.layers,"id",i)}findLayerByUid(i){return nW(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return h([f()],e.prototype,"layers",null),e=h([I("esri.support.LayersMixin")],e),e};function oW(t,e,i){if(t)for(let r=0,s=t.length;r<s;r++){const n=t.at(r);if(n[e]===i)return n;if((n==null?void 0:n.type)==="group"){const o=oW(n.tables,e,i);if(o)return o}}}const BJe=t=>{let e=class extends t{constructor(...i){super(...i),this.tables=new tt,this.addHandles([this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&ie.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})])}destroy(){const i=this.tables.toArray();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",O1(i,this._get("tables")))}findTableById(i){return oW(this.tables,"id",i)}findTableByUid(i){return oW(this.tables,"uid",i)}};return h([f()],e.prototype,"tables",null),e=h([I("esri.support.TablesMixin")],e),e};let bp=class extends BJe(VJe(cn.EventedMixin(Re))){constructor(e){super(e),this.allLayers=new ZM({getCollections:()=>{var i,r,s;return[(i=this.basemap)==null?void 0:i.baseLayers,(r=this.ground)==null?void 0:r.layers,this.layers,(s=this.basemap)==null?void 0:s.referenceLayers]},getChildrenFunction:i=>"layers"in i?i.layers:null}),this.allTables=NJe(this),this.basemap=null,this.editableLayers=new ZM({getCollections:()=>[this.allLayers],itemFilterFunction:yJe}),this.ground=new cz,this._basemapCache=IJe()}destroy(){LJe(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=Le(this.basemap),Le(this.ground),this._set("ground",null)}castBasemap(e){return DJe(e,this._basemapCache)}castGround(e){return FJe(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(i=>i.id===e)}findTableById(e){return this.allTables.find(i=>i.id===e)}};h([f({readOnly:!0,dependsOn:[]})],bp.prototype,"allLayers",void 0),h([f({readOnly:!0})],bp.prototype,"allTables",void 0),h([f({type:YC,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],bp.prototype,"basemap",void 0),h([Li("basemap")],bp.prototype,"castBasemap",null),h([f({readOnly:!0})],bp.prototype,"editableLayers",void 0),h([f({type:cz,nonNullable:!0})],bp.prototype,"ground",void 0),h([Li("ground")],bp.prototype,"castGround",null),h([f()],bp.prototype,"undoRedo",void 0),bp=h([I("esri.Map")],bp);const TEe=bp;async function $te(t,e){const{WhereClause:i}=await fe(()=>import("./WhereClause-DrVgt2QQ.js").then(r=>r.W),__vite__mapDeps([20,21]));return i.create(t,e)}function GJe(t,e){return t==="1=1"?e??t:e==="1=1"?t??e:t!=null&&t!==""?e!=null&&e!==""?`(${t}) AND (${e})`:t:e}function OGt(t){return typeof t=="number"}function Ite(t){return typeof t=="string"||t instanceof String}const jJe="yyyy-MM-dd",HJe="TT";var G$;(function(t){t.HM="HH:mm",t.HMS="HH:mm:ss",t.HMS_MS="HH:mm:ss.SSS"})(G$||(G$={}));const qJe=[G$.HMS_MS,G$.HMS,G$.HM,HJe];function Ace(t){if(!t||!Ite(t))return null;const e=li.fromFormat(t,jJe);return e.isValid?e:null}function Pce(t){return t&&Ite(t)?oze(qJe,e=>{const i=li.fromFormat(t,e);return i.isValid?i:null})??null:null}function Oce(t){if(!t||!Ite(t))return null;const e=li.fromISO(t);return e.isValid?e:null}var XM;(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(XM||(XM={}));const WJe=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function YJe(t){return t!=null&&WJe.has(t.type)}function EEe(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function CEe(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function MEe(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function ZJe(t,e,i){const r=t==null?void 0:t.domain;if(!r)return null;switch(r.type){case"range":{const{min:s,max:n}=AEe(t);if(s!=null&&+e<s||n!=null&&+e>n)return XM.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(r.codedValues==null||r.codedValues.every(s=>s==null||s.code!==e))return XM.INVALID_CODED_VALUE}return null}function AEe(t,e){const i=t==null?void 0:t.domain;if(!i||i.type!=="range")return;const r="range"in i?i.range[0]:i.minValue,s="range"in i?i.range[1]:i.maxValue,n=YJe(t);return EEe(t)||MEe(t)||CEe(t)?{...XJe(t,s,r),isInteger:n}:{min:r!=null&&typeof r=="number"?r:null,max:s!=null&&typeof s=="number"?s:null,rawMin:r,rawMax:s,isInteger:n}}function XJe(t,e,i){var r,s,n,o,a,l;return EEe(t)?{min:(r=Ace(i))==null?void 0:r.toMillis(),max:(s=Ace(e))==null?void 0:s.toMillis(),rawMin:i,rawMax:e}:MEe(t)?{min:(n=Pce(i))==null?void 0:n.toMillis(),max:(o=Pce(e))==null?void 0:o.toMillis(),rawMin:i,rawMax:e}:CEe(t)?{min:(a=Oce(i))==null?void 0:a.toMillis(),max:(l=Oce(e))==null?void 0:l.toMillis(),rawMin:i,rawMax:e}:{max:null,min:null}}const JJe=()=>ie.getLogger("esri.support.arcadeOnDemand");let P6;function z1(){return P6||(P6=(async()=>{const t=await fe(()=>import("./arcadeUtils-CVVL4DyC.js").then(e=>e.aN),__vite__mapDeps([76,21,77,24,78]));return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),P6}const QJe=(t,e,i)=>Lte.create(t,e,i,null,["$feature","$view"],[]),PEe=(t,e,i)=>Lte.create(t,e,i,null,["$feature","$view"],[]),KJe=(t,e,i,r)=>Lte.create(t,e,i,r,["$feature","$view"],[]);let Lte=class OEe{constructor(e,i,r,s,n,o,a){this.services=null,this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o==null?void 0:o.fields;this.fields=l??[],this._syntaxTree=r,this._arcade=i,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,i,r,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await z1(),u=We.fromJSON(i);let d;try{d=a.parseScript(e,o)}catch(D){return JJe().error(new V("arcade-bad-expression","Failed to parse arcade script",{script:e,error:D})),null}const p=n.reduce((D,k)=>({...D,[k]:null}),{});let m=null;s!=null&&(m=new c(s),m.immutable=!0,p.$config=null);const g=a.scriptUsesGeometryEngine(d),y=g&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(d)&&a.enableFeatureSetSupport(),b=a.scriptIsAsync(d),w=b&&a.enableAsyncSupport(),x={vars:p,spatialReference:u,useAsync:!!w};await Promise.all([y,v,w]);const T=new Set;await a.loadDependentModules(T,d,null,b,g);const C=new c;C.immutable=!1,C.setField("scale",0);const M=a.compileScript(d,x),O=(D,k)=>{var H;const U=(H=D.$view)==null?void 0:H.timeZone;return"$view"in D&&D.$view&&(C.setField("scale",typeof D.$view=="object"&&"scale"in D.$view?D.$view.scale:void 0),D.$view=C),m&&(D.$config=m),M({vars:D,spatialReference:u,services:k,timeZone:U})};return new OEe(e,a,d,O,new l,r,u)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const eQe=/^([0-9_])/,tQe=/[^a-z0-9_\u0080-\uffff]+/gi;function iQe(t){return t==null?null:t.trim().replaceAll(tQe,"_").replace(eQe,"F$1")||null}const rQe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],sQe=["field","normalizationField"];function Rce(t,e){if(t!=null&&e!=null){for(const i of Array.isArray(t)?t:[t])if($ce(rQe,i,e),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)$ce(sQe,r,e)}}function $ce(t,e,i){if(t)for(const r of t){const s=WV(r,e),n=s&&typeof s!="function"&&i.get(s);n&&kl(r,n.name,e)}}function REe(t,e){var i;if(t!=null&&((i=e==null?void 0:e.fields)!=null&&i.length))if("startField"in t){const r=e.get(t.startField),s=e.get(t.endField);t.startField=(r==null?void 0:r.name)??null,t.endField=(s==null?void 0:s.name)??null}else{const r=e.get(t.startTimeField),s=e.get(t.endTimeField);t.startTimeField=(r==null?void 0:r.name)??null,t.endTimeField=(s==null?void 0:s.name)??null}}const O6=new Set;function sG(t,e){return t&&e?(O6.clear(),ZS(O6,t,e),Array.from(O6).sort()):[]}function ZS(t,e,i){var r;if(i)if((r=e==null?void 0:e.fields)!=null&&r.length)if(i.includes("*"))for(const{name:s}of e.fields)t.add(s);else for(const s of i)Sc(t,e,s);else{if(i.includes("*"))return t.clear(),void t.add("*");for(const s of i)s!=null&&t.add(s)}}function Sc(t,e,i){if(typeof i=="string")if(e){const r=e.get(i);r&&t.add(r.name)}else t.add(i)}function nQe(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(i=>i.name):e}async function Vl(t,e,i){var n;if(!i)return;const{arcadeUtils:r}=await z1(),s=r.extractFieldNames(i,(n=e==null?void 0:e.fields)==null?void 0:n.map(o=>o.name));for(const o of s)Sc(t,e,o)}async function $Ee(t,e,i){if(i&&i!=="1=1"){const r=await $te(i,e);if(!r.isStandardized)throw new V("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});ZS(t,e,r.fieldNames)}}function oQe({displayField:t,fields:e}){return t||(e!=null&&e.length?R6(e,"name-or-title")||R6(e,"unique-identifier")||R6(e,"type-or-category")||aQe(e):null)}function aQe(t){for(const e of t){if(!(e!=null&&e.name))continue;const i=e.name.toLowerCase();if(i.includes("name")||i.includes("title"))return e.name}return null}function R6(t,e){for(const i of t)if(i!=null&&i.valueType&&i.valueType===e)return i.name;return null}async function RGt(t,e){var r;if(!e)return;const i=(r=e.elevationInfo)==null?void 0:r.featureExpressionInfo;return i?i.collectRequiredFields(t,e.fieldsIndex):void 0}function lQe(t,e,i){i.onStatisticExpression?Vl(t,e,i.onStatisticExpression.expression):t.add(i.onStatisticField)}async function $Gt(t,e,i){if(!e||!i||!("fields"in i))return;const r=[],s=i.popupTemplate;r.push(cQe(t,e,s)),i.fields&&r.push(...i.fields.map(async n=>lQe(t,e.fieldsIndex,n))),await Promise.all(r)}async function cQe(t,e,i){const r=[];i!=null&&i.expressionInfos&&r.push(...i.expressionInfos.map(n=>Vl(t,e.fieldsIndex,n.expression)));const s=i==null?void 0:i.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&r.push(Vl(t,e.fieldsIndex,n.expressionInfo.expression));await Promise.all(r)}async function IGt(t,e,i){e&&(e.timeInfo&&(i!=null&&i.timeExtent)&&ZS(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&ZS(t,e.fieldsIndex,[e.floorInfo.floorField]),(i==null?void 0:i.where)!=null&&await $Ee(t,e.fieldsIndex,i.where))}async function LGt(t,e,i){e&&i&&await Promise.all(i.map(r=>uQe(t,e,r)))}async function uQe(t,e,i){e&&i&&(i.valueExpression?await Vl(t,e.fieldsIndex,i.valueExpression):i.field&&Sc(t,e.fieldsIndex,i.field))}function hQe(t){return t?sG(t.fieldsIndex,IEe(t)):[]}function dQe(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?sG(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const pQe=new Set(["oid","global-id","guid"]),fQe=new Set(["oid","global-id"]),mQe=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function gQe(t){const e=new Set;LEe(t).forEach(r=>e.add(r)),dQe(t).forEach(r=>e.add(r.toLowerCase()));const i=t&&"infoFor3D"in t?t.infoFor3D:void 0;return i&&(Object.values(i.assetMapFieldRoles).forEach(r=>e.add(r.toLowerCase())),Object.values(i.transformFieldRoles).forEach(r=>e.add(r.toLowerCase()))),Array.from(e)}function IEe(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=e;return[i,r,s,n].filter(Boolean)}function LEe(t){return IEe(t).map(e=>e.toLowerCase())}function yQe(t,e){var i;return t.editable&&!pQe.has(t.type)&&!LEe(e).includes(((i=t.name)==null?void 0:i.toLowerCase())??"")}function _Qe(t,e){var r;const i=((r=t.name)==null?void 0:r.toLowerCase())??"";return!((e==null?void 0:e.objectIdField)!=null&&i===e.objectIdField.toLowerCase()||(e==null?void 0:e.globalIdField)!=null&&i===e.globalIdField.toLowerCase()||gQe(e).includes(i)||fQe.has(t.type)||mQe.some(s=>s.test(i)))}async function DGt(t,e){const{labelingInfo:i,fieldsIndex:r}=e;i!=null&&i.length&&await Promise.all(i.map(s=>vQe(t,r,s)))}async function vQe(t,e,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await Vl(t,e,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{Sc(t,e,o.slice(1,-1))})}await $Ee(t,e,s)}function bQe(t){const e=t.defaultValue;return e!==void 0&&FEe(t,e)?e:t.nullable?null:void 0}function NGt(t){const e=typeof t=="string"?{type:t}:t;return $Qe(e)?255:e.type==="esriFieldTypeDate"||e.type==="date"?8:void 0}function DEe(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function wQe(t){return t===null||DEe(t)}function xQe(t){return t===null||Number.isInteger(t)}function NEe(t){return t!=null&&typeof t=="string"}function SQe(t){return t===null||NEe(t)}function TQe(){return!0}function FEe(t,e){let i;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":i=t.nullable?xQe:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=t.nullable?wQe:DEe;break;case"string":case"esriFieldTypeString":i=t.nullable?SQe:NEe;break;default:i=TQe}return arguments.length===1?i:i(e)}const EQe=["integer","small-integer","big-integer"],CQe=["single","double"],MQe=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],AQe=["esriFieldTypeSingle","esriFieldTypeDouble"],PQe=new Set([...EQe,...MQe]),OQe=new Set([...CQe,...AQe]),RQe=F1e(PQe,OQe);function Dte(t){return t!=null&&RQe.has(t.type)}function $Qe(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function kEe(t){return t!=null&&(t.type==="date"||t.type==="esriFieldTypeDate")}function FGt(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function kGt(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function IQe(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function Ice(t){return t!=null&&(t.type==="oid"||t.type==="esriFieldTypeOID")}function Lce(t){return t!=null&&(t.type==="global-id"||t.type==="esriFieldTypeGlobalID")}function UGt(t,e){return LQe(t,e)===null}var uz,hz;function zGt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function LQe(t,e){return t==null||t.nullable&&e===null?null:Dte(t)&&!DQe(t.type,Number(e))?uz.OUT_OF_RANGE:FEe(t,e)?t.domain?ZJe(t,e):null:hz.INVALID_TYPE}function DQe(t,e){const i=typeof t=="string"?UEe(t):t;if(!i)return!1;const r=i.min,s=i.max;return i.isInteger?Number.isInteger(e)&&e>=r&&e<=s:e>=r&&e<=s}function UEe(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return NQe;case"esriFieldTypeInteger":case"integer":return FQe;case"esriFieldTypeBigInteger":case"big-integer":return kQe;case"esriFieldTypeSingle":case"single":return UQe;case"esriFieldTypeDouble":case"double":return zQe}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(uz||(uz={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(hz||(hz={}));const NQe={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},FQe={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},kQe={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},UQe={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},zQe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function VGt(t,e,i){switch(t){case XM.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case XM.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case hz.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case uz.OUT_OF_RANGE:{const{min:r,max:s}=UEe(e.type);return`Value ${i} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${r} to ${s}`}}}function BGt(t,e){return!VQe(t,e,null)}function VQe(t,e,i){if(!(e!=null&&e.attributes)||!t){if(i!=null)for(const n of t??[])i.add(n);return!0}const r=new Set(Object.keys(e.attributes));let s=!1;for(const n of t)if(!r.has(n)){if(s=!0,i==null)break;i.add(n)}return s}function BQe(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}function zEe(t){const e=t==null?void 0:t.match(/{[^}]+}/g);return e?e.map(i=>i.slice(1,-1).split(":")[0].trim()):[]}let Q4=class extends ye{constructor(e){super(e),this.type=null}};h([f({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],Q4.prototype,"type",void 0),Q4=h([I("esri.popup.content.Content")],Q4);const lb=Q4;var aW;let Tw=aW=class extends lb{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new aW({description:this.description,displayType:this.displayType,title:this.title})}};h([f({type:String,json:{write:!0}})],Tw.prototype,"description",void 0),h([f({type:["auto","preview","list"],json:{write:!0}})],Tw.prototype,"displayType",void 0),h([f({type:String,json:{write:!0}})],Tw.prototype,"title",void 0),h([f({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],Tw.prototype,"type",void 0),Tw=aW=h([I("esri.popup.content.AttachmentsContent")],Tw);const JI=Tw;var lW;let Ew=lW=class extends lb{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new lW({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?Q(this.outFields):null})}};h([f()],Ew.prototype,"creator",void 0),h([f()],Ew.prototype,"destroyer",void 0),h([f()],Ew.prototype,"outFields",void 0),h([f({type:["custom"],readOnly:!0})],Ew.prototype,"type",void 0),Ew=lW=h([I("esri.popup.content.CustomContent")],Ew);const GQe=Ew;var cW;let tE=cW=class extends ye{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new cW({title:this.title,expression:this.expression})}};h([f({type:String,json:{write:!0}})],tE.prototype,"title",void 0),h([f({type:String,json:{write:!0}})],tE.prototype,"expression",void 0),h([f({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],tE.prototype,"returnType",void 0),tE=cW=h([I("esri.popup.ElementExpressionInfo")],tE);const jQe=tE;var uW;let DO=uW=class extends lb{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new uW({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};h([f({type:jQe,json:{write:!0}})],DO.prototype,"expressionInfo",void 0),h([f({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],DO.prototype,"type",void 0),DO=uW=h([I("esri.popup.content.ExpressionContent")],DO);const Nte=DO;let iE=class extends Kr(ye){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};h([ct(CHe)],iE.prototype,"dateFormat",void 0),h([f({type:Boolean,json:{write:!0}})],iE.prototype,"digitSeparator",void 0),h([f({type:Qr,json:{write:!0}})],iE.prototype,"places",void 0),iE=h([I("esri.popup.support.FieldInfoFormat")],iE);const K4=iE;var hW;let wp=hW=class extends ye{constructor(t){super(t),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){var t;return new hW({fieldName:this.fieldName,format:(t=this.format)==null?void 0:t.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};h([f({type:String,json:{write:!0}})],wp.prototype,"fieldName",void 0),h([f({type:K4,json:{write:!0}})],wp.prototype,"format",void 0),h([f({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],wp.prototype,"isEditable",void 0),h([f({type:String,json:{write:!0}})],wp.prototype,"label",void 0),h([ct(new qi({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],wp.prototype,"stringFieldOption",void 0),h([f({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],wp.prototype,"statisticType",void 0),h([f({type:String,json:{write:!0}})],wp.prototype,"tooltip",void 0),h([f({type:Boolean,json:{write:!0}})],wp.prototype,"visible",void 0),wp=hW=h([I("esri.popup.FieldInfo")],wp);const Fte=wp;var dW;let yy=dW=class extends lb{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(i=>i.toJSON())}clone(){return new dW(Q({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};h([f({type:Object,json:{write:!0}})],yy.prototype,"attributes",void 0),h([f({type:String,json:{write:!0}})],yy.prototype,"description",void 0),h([f({type:[Fte]})],yy.prototype,"fieldInfos",void 0),h([Ve("fieldInfos")],yy.prototype,"writeFieldInfos",null),h([f({type:String,json:{write:!0}})],yy.prototype,"title",void 0),h([f({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],yy.prototype,"type",void 0),yy=dW=h([I("esri.popup.content.FieldsContent")],yy);const QI=yy;let Cw=class extends ye{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};h([f({type:String,json:{write:!0}})],Cw.prototype,"altText",void 0),h([f({type:String,json:{write:!0}})],Cw.prototype,"caption",void 0),h([f({type:String,json:{write:!0}})],Cw.prototype,"title",void 0),h([f({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],Cw.prototype,"type",void 0),Cw=h([I("esri.popup.content.mixins.MediaInfo")],Cw);const kte=Cw;var pW;let Mw=pW=class extends Re{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){var t;return new pW({color:(t=this.color)==null?void 0:t.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};h([f()],Mw.prototype,"color",void 0),h([f()],Mw.prototype,"fieldName",void 0),h([f()],Mw.prototype,"tooltip",void 0),h([f()],Mw.prototype,"value",void 0),Mw=pW=h([I("esri.popup.content.support.ChartMediaInfoValueSeries")],Mw);const HQe=Mw;var fW;let Y_=fW=class extends ye{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new fW({colors:Q(this.colors),fields:Q(this.fields),normalizeField:this.normalizeField,series:Q(this.series),tooltipField:this.tooltipField})}};h([f({type:[Oe],json:{type:[[Qr]],write:!0}})],Y_.prototype,"colors",void 0),h([f({type:[String],json:{write:!0}})],Y_.prototype,"fields",void 0),h([f({type:String,json:{write:!0}})],Y_.prototype,"normalizeField",void 0),h([f({type:[HQe],json:{read:!1}})],Y_.prototype,"series",void 0),h([f({type:String,json:{write:!0}})],Y_.prototype,"tooltipField",void 0),Y_=fW=h([I("esri.popup.content.support.ChartMediaInfoValue")],Y_);const qQe=Y_;let NO=class extends kte{constructor(e){super(e),this.type=null,this.value=void 0}};h([f({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],NO.prototype,"type",void 0),h([f({type:qQe,json:{write:!0}})],NO.prototype,"value",void 0),NO=h([I("esri.popup.content.mixins.ChartMediaInfo")],NO);const nG=NO,oG=Bl()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var mW;let e5=mW=class extends nG{constructor(t){super(t),this.type="bar-chart"}clone(){var t;return new mW({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};h([f({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:oG.write}})],e5.prototype,"type",void 0),e5=mW=h([I("esri.popup.content.BarChartMediaInfo")],e5);const VEe=e5;var gW;let t5=gW=class extends nG{constructor(t){super(t),this.type="column-chart"}clone(){var t;return new gW({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};h([f({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:oG.write}})],t5.prototype,"type",void 0),t5=gW=h([I("esri.popup.content.ColumnChartMediaInfo")],t5);const BEe=t5;var yW;let FO=yW=class extends ye{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new yW({linkURL:this.linkURL,sourceURL:this.sourceURL})}};h([f({type:String,json:{write:!0}})],FO.prototype,"linkURL",void 0),h([f({type:String,json:{write:!0}})],FO.prototype,"sourceURL",void 0),FO=yW=h([I("esri.popup.content.support.ImageMediaInfoValue")],FO);const WQe=FO;var _W;let rE=_W=class extends kte{constructor(t){super(t),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){var t;return new _W({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:(t=this.value)==null?void 0:t.clone()})}};h([f({type:Number,json:{write:!0}})],rE.prototype,"refreshInterval",void 0),h([f({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],rE.prototype,"type",void 0),h([f({type:WQe,json:{write:!0}})],rE.prototype,"value",void 0),rE=_W=h([I("esri.popup.content.ImageMediaInfo")],rE);const GEe=rE;var vW;let i5=vW=class extends nG{constructor(t){super(t),this.type="line-chart"}clone(){var t;return new vW({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};h([f({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:oG.write}})],i5.prototype,"type",void 0),i5=vW=h([I("esri.popup.content.LineChartMediaInfo")],i5);const jEe=i5;var bW;let r5=bW=class extends nG{constructor(t){super(t),this.type="pie-chart"}clone(){var t;return new bW({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};h([f({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:oG.write}})],r5.prototype,"type",void 0),r5=bW=h([I("esri.popup.content.PieChartMediaInfo")],r5);const HEe=r5,qEe={base:kte,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":VEe,"column-chart":BEe,"line-chart":jEe,"pie-chart":HEe,image:GEe}};var wW;let xp=wW=class extends lb{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?GEe.fromJSON(e):e.type==="barchart"?VEe.fromJSON(e):e.type==="columnchart"?BEe.fromJSON(e):e.type==="linechart"?jEe.fromJSON(e):e.type==="piechart"?HEe.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(i=>i.toJSON())}clone(){return new wW(Q({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};h([f()],xp.prototype,"activeMediaInfoIndex",void 0),h([f({type:Object,json:{write:!0}})],xp.prototype,"attributes",void 0),h([f({type:String,json:{write:!0}})],xp.prototype,"description",void 0),h([f({types:[qEe]})],xp.prototype,"mediaInfos",void 0),h([Ce("mediaInfos")],xp.prototype,"readMediaInfos",null),h([Ve("mediaInfos")],xp.prototype,"writeMediaInfos",null),h([f({type:String,json:{write:!0}})],xp.prototype,"title",void 0),h([f({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],xp.prototype,"type",void 0),xp=wW=h([I("esri.popup.content.MediaContent")],xp);const dz=xp;var xW;let kO=xW=class extends ye{constructor(t){super(t),this.field=null,this.order=null}clone(){return new xW({field:this.field,order:this.order})}};h([f({type:String,json:{write:!0}})],kO.prototype,"field",void 0),h([f({type:["asc","desc"],json:{write:!0}})],kO.prototype,"order",void 0),kO=xW=h([I("esri.popup.support.RelatedRecordsInfoFieldOrder")],kO);const Ute=kO;let gm=class extends Kr(lb){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};h([f({type:String,json:{write:!0}})],gm.prototype,"description",void 0),h([f({type:Number,json:{type:Qr,write:!0}})],gm.prototype,"displayCount",void 0),h([f({type:["list"],json:{write:!0}})],gm.prototype,"displayType",void 0),h([f({type:[Ute],json:{write:!0}})],gm.prototype,"orderByFields",void 0),h([f({type:Number,json:{type:Qr,write:!0}})],gm.prototype,"relationshipId",void 0),h([f({type:String,json:{write:!0}})],gm.prototype,"title",void 0),h([f({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],gm.prototype,"type",void 0),gm=h([I("esri.popup.content.RelationshipContent")],gm);const pz=gm;var SW;let UO=SW=class extends lb{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new SW({text:this.text})}};h([f({type:String,json:{write:!0}})],UO.prototype,"text",void 0),h([f({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],UO.prototype,"type",void 0),UO=SW=h([I("esri.popup.content.TextContent")],UO);const fz=UO,YQe={base:null,key:"type",typeMap:{attachment:JI,media:dz,text:fz,expression:Nte,field:QI,relationship:pz}};var TW;let Aw=TW=class extends ye{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new TW({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};h([f({type:String,json:{write:!0}})],Aw.prototype,"name",void 0),h([f({type:String,json:{write:!0}})],Aw.prototype,"title",void 0),h([f({type:String,json:{write:!0}})],Aw.prototype,"expression",void 0),h([f({type:["string","number"],json:{write:!0}})],Aw.prototype,"returnType",void 0),Aw=TW=h([I("esri.popup.ExpressionInfo")],Aw);const ZQe=Aw;var EW;let zO=EW=class extends ye{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new EW({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};h([f({type:Boolean,json:{write:!0}})],zO.prototype,"returnTopmostRaster",void 0),h([f({type:Boolean,json:{write:!0}})],zO.prototype,"showNoDataRecords",void 0),zO=EW=h([I("esri.popup.LayerOptions")],zO);const XQe=zO;var CW;let VO=CW=class extends ye{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new CW({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?Q(this.orderByFields):null})}};h([f({type:Boolean,json:{write:!0}})],VO.prototype,"showRelatedRecords",void 0),h([f({type:[Ute],json:{write:!0}})],VO.prototype,"orderByFields",void 0),VO=CW=h([I("esri.popup.RelatedRecordsInfo")],VO);const JQe=VO;var MW;let Wh=MW=class extends rG(Re){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new MW({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};h([f()],Wh.prototype,"active",void 0),h([f()],Wh.prototype,"className",void 0),h([f()],Wh.prototype,"disabled",void 0),h([f()],Wh.prototype,"icon",void 0),h([f()],Wh.prototype,"id",void 0),h([f()],Wh.prototype,"indicator",void 0),h([f()],Wh.prototype,"title",void 0),h([f()],Wh.prototype,"type",void 0),h([f()],Wh.prototype,"visible",void 0),Wh=MW=h([I("esri.support.actions.ActionBase")],Wh);const zte=Wh;var AW;let s5=AW=class extends zte{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new AW({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};h([f()],s5.prototype,"image",void 0),s5=AW=h([I("esri.support.actions.ActionButton")],s5);const QQe=s5;var PW;let BO=PW=class extends zte{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new PW({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};h([f()],BO.prototype,"image",void 0),h([f()],BO.prototype,"value",void 0),BO=PW=h([I("esri.support.actions.ActionToggle")],BO);const KQe=BO,DP="relationships/",Dce="expression/",eKe=tt.ofType({key:"type",defaultKeyValue:"button",base:zte,typeMap:{button:QQe,toggle:KQe}}),tKe={base:lb,key:"type",typeMap:{media:dz,custom:GQe,text:fz,attachments:JI,fields:QI,expression:Nte,relationship:pz}},iKe=new Set(["attachments","fields","media","text","expression","relationship"]);let Go=class extends Kr(ye){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(i=>xf(tKe,i)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Cu(e)?e:(ie.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeContent(e,i,r,s){typeof e!="string"?Array.isArray(e)&&(i.popupElements=e.filter(n=>iKe.has(n.type)).map(n=>n==null?void 0:n.toJSON(s)),i.popupElements.forEach(n=>{n.type==="attachments"?this._writeAttachmentContent(i):n.type==="media"?this._writeMediaContent(n,i):n.type==="text"?this._writeTextContent(n,i):n.type==="relationship"&&this._writeRelationshipContent(n,i)})):i.description=e}writeFieldInfos(e,i,r,s){const{content:n}=this,o=Array.isArray(n)?n:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var u;return(u=c.fieldInfos)==null?void 0:u.length});i.fieldInfos=e.filter(Boolean).map(c=>{const u=c.toJSON(s);return l&&(u.visible=!1),u})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,i)}writeLayerOptions(e,i,r,s){i[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,i){i.title=e||""}async collectRequiredFields(e,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,i,[...r,...this._getContentExpressionInfos(this.content,r)]),ZS(e,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const i=new Set;return await this.collectRequiredFields(i,e),[...i].sort()}_writeFieldsContent(e,i){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=Q(e.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach(s=>{const n=i.fieldInfos.find(o=>{var a,l;return((a=o.fieldName)==null?void 0:a.toLowerCase())===((l=s.fieldName)==null?void 0:l.toLowerCase())});n?n.visible=!0:i.fieldInfos.push(s)}):i.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,i){var n,o;const r=((n=e.orderByFields)==null?void 0:n.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],s=[...((o=i.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...(s==null?void 0:s.length)&&{orderByFields:s}}}_writeTextContent(e,i){!i.description&&e.text&&(i.description=e.text)}_writeMediaContent(e,i){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=Q(e.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(e,i,r){const s={description:!1,mediaInfos:!1};return r.map(n=>n.type==="media"?(n.mediaInfos||!i||s.mediaInfos||(n.mediaInfos=i,s.mediaInfos=!0),dz.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),fz.fromJSON(n)):n.type==="attachments"?JI.fromJSON(n):n.type==="fields"?QI.fromJSON(n):n.type==="expression"?Nte.fromJSON(n):n.type==="relationship"?pz.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:i,order:r}=e;if(!(i!=null&&i.startsWith(DP)))return null;const s=i.replace(DP,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),o=s[1];return typeof n=="number"&&o?pz.fromJSON({relationshipId:n,orderByFields:[{field:o,order:r}]}):null}_toFieldOrderJSON(e,i){const{order:r,field:s}=e;return{field:`${DP}${i}/${s}`,order:r}}_readPopupInfo({description:e,mediaInfos:i,showAttachments:r,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new fz({text:e})):n.push(new QI),Array.isArray(i)&&i.length&&n.push(dz.fromJSON({mediaInfos:i})),r&&n.push(JI.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=s;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const i=e==null?void 0:e.type;if(i==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(i==="custom")return e.outFields||[];if(i==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(i==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return i==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:i,title:r,value:s}=e,n=s||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:u}=n,d=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(c),...this._extractFieldNames(u),...o??[]];return a&&d.push(a),l&&d.push(l),d}_getContentExpressionInfos(e,i){return Array.isArray(e)?e.reduce((r,s)=>[...r,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],i):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,i,r){r&&await Promise.all(r.map(s=>Vl(e,i,s.expression)))}_getFieldInfoFields(e){return e?e.filter(({fieldName:i,visible:r})=>!(r!==void 0&&!r||!i||i.startsWith(DP)||i.startsWith(Dce))).map(i=>i.fieldName):[]}_getActionsFields(e){return e?e.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:i,title:r,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){return zEe(e).filter(i=>!(i.indexOf(DP)===0||i.indexOf(Dce)===0))}};h([f({type:eKe})],Go.prototype,"actions",void 0),h([f()],Go.prototype,"content",void 0),h([Li("content")],Go.prototype,"castContent",null),h([Ce("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],Go.prototype,"readContent",null),h([Ve("content",{popupElements:{type:tt.ofType(YQe)},showAttachments:{type:Boolean},mediaInfos:{type:tt.ofType(qEe)},description:{type:String},relatedRecordsInfo:{type:JQe}})],Go.prototype,"writeContent",null),h([f({type:[ZQe],json:{write:!0}})],Go.prototype,"expressionInfos",void 0),h([f({type:[Fte]})],Go.prototype,"fieldInfos",void 0),h([Ve("fieldInfos")],Go.prototype,"writeFieldInfos",null),h([f({type:XQe})],Go.prototype,"layerOptions",void 0),h([Ve("layerOptions")],Go.prototype,"writeLayerOptions",null),h([f({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],Go.prototype,"lastEditInfoEnabled",void 0),h([f()],Go.prototype,"outFields",void 0),h([f()],Go.prototype,"overwriteActions",void 0),h([f()],Go.prototype,"returnGeometry",void 0),h([f({json:{type:String}})],Go.prototype,"title",void 0),h([Ve("title")],Go.prototype,"writeTitle",null),Go=h([I("esri.PopupTemplate")],Go);const GA=Go,Nce=new qi({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let rKe=0,sE=class extends ye{constructor(e){super(e),this.id="sym"+rKe++,this.type=null,this.color=new Oe([0,0,0,1])}readColor(e){return(e==null?void 0:e[0])!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,i){}hash(){return JSON.stringify(this.toJSON())}clone(){}};h([f({type:Nce.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:Nce.write}}})],sE.prototype,"type",void 0),h([f({type:Oe,json:{write:{allowNull:!0}}})],sE.prototype,"color",void 0),h([Ce("color")],sE.prototype,"readColor",null),sE=h([I("esri.symbols.Symbol")],sE);const ll=sE;var OW;let Z_=OW=class extends ll{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){var i;if(((i=this.data)==null?void 0:i.type)==="CIMSymbolReference"){const r=this.data.primitiveOverrides;if(r){const s=r.map(n=>{const o=n.valueExpressionInfo;return o?Vl(t,e,o.expression):null});await Promise.all(s)}}}clone(){return new OW({data:Q(this.data)})}hash(){return BK(JSON.stringify(this.data)).toString()}};h([f({json:{write:!1}})],Z_.prototype,"color",void 0),h([f({json:{write:!0}})],Z_.prototype,"data",void 0),h([Ce("data",["symbol"])],Z_.prototype,"readData",null),h([Ve("data",{})],Z_.prototype,"writeData",null),h([ct({CIMSymbolReference:"cim"},{readOnly:!0})],Z_.prototype,"type",void 0),Z_=OW=h([I("esri.symbols.CIMSymbol")],Z_);const cb=Z_;let nE=class extends ye{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,i,r){e||(i[r]=e)}};h([f({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],nE.prototype,"enabled",void 0),h([Ve("enabled")],nE.prototype,"writeEnabled",null),h([f({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],nE.prototype,"type",void 0),nE=h([I("esri.symbols.Symbol3DLayer")],nE);const $g=nE;function sKe(t,e){const i=e.transparency!=null?XI(e.transparency):1,r=e.color;return r&&Array.isArray(r)?new Oe([r[0]||0,r[1]||0,r[2]||0,i]):null}function nKe(t,e){e.color=t.toJSON().slice(0,3);const i=tG(t.a);i!==0&&(e.transparency=i)}const V0={type:Oe,json:{type:[Qr],default:null,read:{source:["color","transparency"],reader:sKe},write:{target:{color:{type:[Qr]},transparency:{type:Qr}},writer:nKe}}},Tg={type:Number,cast:pr,json:{write:!0}};let Pw=class extends ye{constructor(e){super(e),this.color=new Oe([0,0,0,1]),this.extensionLength=0,this.size=Do(1)}clone(){}cloneProperties(){return{color:Q(this.color),size:this.size,extensionLength:this.extensionLength}}};h([f({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Pw.prototype,"type",void 0),h([f(V0)],Pw.prototype,"color",void 0),h([f({...Tg,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],Pw.prototype,"extensionLength",void 0),h([f(Tg)],Pw.prototype,"size",void 0),Pw=h([I("esri.symbols.edges.Edges3D")],Pw);const Vte=Pw;var RW;let n5=RW=class extends Vte{constructor(t){super(t),this.type="sketch"}clone(){return new RW(this.cloneProperties())}};h([ct({sketch:"sketch"},{readOnly:!0})],n5.prototype,"type",void 0),n5=RW=h([I("esri.symbols.edges.SketchEdges3D")],n5);const oKe=n5;var $W;let o5=$W=class extends Vte{constructor(t){super(t),this.type="solid"}clone(){return new $W(this.cloneProperties())}};h([ct({solid:"solid"},{readOnly:!0})],o5.prototype,"type",void 0),o5=$W=h([I("esri.symbols.edges.SolidEdges3D")],o5);const WEe=o5,Bte={types:{key:"type",base:Vte,typeMap:{solid:WEe,sketch:oKe}},json:{write:!0}};var IW;let xh=IW=class extends ye{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new IW(t)}};h([f(V0)],xh.prototype,"color",void 0),xh=IW=h([I("esri.symbols.support.Symbol3DMaterial")],xh);var LW;let X_=LW=class extends $g{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){var t,e;return new LW({edges:(t=this.edges)==null?void 0:t.clone(),enabled:this.enabled,material:(e=this.material)==null?void 0:e.clone(),castShadows:this.castShadows,size:this.size})}};h([ct({Extrude:"extrude"},{readOnly:!0})],X_.prototype,"type",void 0),h([f({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],X_.prototype,"size",void 0),h([f({type:xh,json:{write:!0}})],X_.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],X_.prototype,"castShadows",void 0),h([f(Bte)],X_.prototype,"edges",void 0),X_=LW=h([I("esri.symbols.ExtrudeSymbol3DLayer")],X_);const YEe=X_;let GO=class extends ll{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};h([ct({esriSLS:"simple-line"},{readOnly:!0})],GO.prototype,"type",void 0),h([f({type:Number,cast:pr,json:{write:!0}})],GO.prototype,"width",void 0),GO=h([I("esri.symbols.LineSymbol")],GO);const aKe=GO,lKe=["begin","end","begin-end"],ZEe=["arrow","circle","square","diamond","cross","x"];var DW;let ym=DW=class extends ye{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,i,r){e[i]=(r==null?void 0:r.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return(t==null?void 0:t[0])!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,i,r){(r==null?void 0:r.origin)==="web-map"||(e[i]=t)}clone(){return new DW({color:Q(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};h([f({type:["begin","end","begin-end"],json:{write:!0}})],ym.prototype,"placement",void 0),h([ct({"line-marker":"line-marker"},{readOnly:!0}),f({json:{origins:{"web-map":{write:!1}}}})],ym.prototype,"type",void 0),h([f({type:ZEe})],ym.prototype,"style",void 0),h([Ve("style")],ym.prototype,"writeStyle",null),h([f({type:Oe,value:null,json:{write:{allowNull:!0}}})],ym.prototype,"color",null),h([Ce("color")],ym.prototype,"readColor",null),h([Ve("color")],ym.prototype,"writeColor",null),ym=DW=h([I("esri.symbols.LineSymbolMarker")],ym);const cKe=ym;var NW;const $6=new qi({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let _y=NW=class extends aKe{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,i,r,s,n){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),i!=null&&(o.width=pr(i)),r!=null&&(o.cap=r),s!=null&&(o.join=s),n!=null&&(o.miterLimit=pr(n)),o}clone(){var t;return new NW({color:Q(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};h([ct({esriSLS:"simple-line"},{readOnly:!0})],_y.prototype,"type",void 0),h([f({type:$6.apiValues,json:{read:$6.read,write:$6.write}})],_y.prototype,"style",void 0),h([f({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&(i==null?void 0:i.origin)==null})}}})],_y.prototype,"cap",void 0),h([f({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&(i==null?void 0:i.origin)==null})}}})],_y.prototype,"join",void 0),h([f({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":cKe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],_y.prototype,"marker",void 0),h([f({type:Number,json:{read:!1,write:!1}})],_y.prototype,"miterLimit",void 0),_y=NW=h([I("esri.symbols.SimpleLineSymbol")],_y);const Mu=_y;let jO=class extends ll{constructor(e){super(e),this.outline=null,this.type=null}hash(){var e;return`${this.type}.${(e=this.outline)==null?void 0:e.hash()}`}};h([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Mu}},json:{default:null,write:!0}})],jO.prototype,"outline",void 0),h([f({type:["simple-fill","picture-fill"],readOnly:!0})],jO.prototype,"type",void 0),jO=h([I("esri.symbols.FillSymbol")],jO);const XEe=jO;let a5=class extends ye{constructor(e){super(e)}clone(){throw new Error("Subclasses of LinePattern3D should implement their own clone method.")}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],a5.prototype,"type",void 0),a5=h([I("esri.symbols.patterns.LinePattern3D")],a5);const JEe=a5,uKe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var FW;const hKe=Bl()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let HO=FW=class extends JEe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new FW(t)}};h([f({type:["style"]})],HO.prototype,"type",void 0),h([ct(hKe),f({type:uKe})],HO.prototype,"style",void 0),HO=FW=h([I("esri.symbols.patterns.LineStylePattern3D")],HO);const Gte=HO;let l5=class extends ye{constructor(e){super(e),this.type="style"}clone(){throw new Error("Subclasses of Pattern3D should implement their own clone method.")}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],l5.prototype,"type",void 0),l5=h([I("esri.symbols.patterns.Pattern3D")],l5);const QEe=l5,dKe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var kW;let qO=kW=class extends QEe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){return new kW({style:this.style})}};h([f({type:["style"]})],qO.prototype,"type",void 0),h([f({type:dKe,json:{read:!0,write:!0}})],qO.prototype,"style",void 0),qO=kW=h([I("esri.symbols.patterns.StylePattern3D")],qO);const KEe=qO,pKe={types:{key:"type",base:QEe,typeMap:{style:KEe}},json:{write:!0}},eCe={types:{key:"type",base:JEe,typeMap:{style:Gte}},json:{write:!0}},j$=new Oe("white");new Oe("black");const fKe=new Oe([255,255,255,0]);function mKe(t){return t.r===0&&t.g===0&&t.b===0}var UW;let H$=UW=class extends xh{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new UW(t)}};h([ct({multiply:"multiply",replace:"replace",tint:"tint"})],H$.prototype,"colorMixMode",void 0),H$=UW=h([I("esri.symbols.support.Symbol3DFillMaterial")],H$);function Jn(t=nCe){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function XS(t,e,i,r,s,n,o=Jn()){return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function ijt(t,e){const i=isFinite(t[2])||isFinite(t[5]);return new gi(i?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function JM(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function gKe(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function Af(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function yh(t,e,i=0,r=e.length/3){let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let u=0;u<r;u++)s=Math.min(s,e[i+3*u]),n=Math.min(n,e[i+3*u+1]),o=Math.min(o,e[i+3*u+2]),a=Math.max(a,e[i+3*u]),l=Math.max(l,e[i+3*u+1]),c=Math.max(c,e[i+3*u+2]);t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function I6(t,e,i){const r=e.length;let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(i)for(let u=0;u<r;u++){const d=e[u];s=Math.min(s,d[0]),n=Math.min(n,d[1]),o=Math.min(o,d[2]),a=Math.max(a,d[0]),l=Math.max(l,d[1]),c=Math.max(c,d[2])}else for(let u=0;u<r;u++){const d=e[u];s=Math.min(s,d[0]),n=Math.min(n,d[1]),a=Math.max(a,d[0]),l=Math.max(l,d[1])}t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function yKe(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function TT(t){return t[0]>=t[3]?0:t[3]-t[0]}function ET(t){return t[1]>=t[4]?0:t[4]-t[1]}function ub(t){return t[2]>=t[5]?0:t[5]-t[2]}function tCe(t){const e=TT(t),i=ub(t),r=ET(t);return Math.sqrt(e*e+i*i+r*r)}function of(t,e=[0,0,0]){return e[0]=t[0]+TT(t)/2,e[1]=t[1]+ET(t)/2,e[2]=t[2]+ub(t)/2,e}function c5(t,e=[0,0,0]){return e[0]=TT(t),e[1]=ET(t),e[2]=ub(t),e}function jte(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function rjt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function _Ke(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function af(t,e){return e==null||_Ke(t,e)}function iCe(t,e,i,r,s=t){return s[0]=t[0]+e,s[1]=t[1]+i,s[2]=t[2]+r,s[3]=t[3]+e,s[4]=t[4]+i,s[5]=t[5]+r,s}function sjt(t,e,i=t){const r=t[0]+TT(t)/2,s=t[1]+ET(t)/2,n=t[2]+ub(t)/2;return i[0]=r+(t[0]-r)*e,i[1]=s+(t[1]-s)*e,i[2]=n+(t[2]-n)*e,i[3]=r+(t[3]-r)*e,i[4]=s+(t[4]-s)*e,i[5]=n+(t[5]-n)*e,i}function njt(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function rCe(t,e,i=t){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i!==t&&(i[3]=t[3],i[4]=t[4],i[5]=t[5]),i}function sCe(t,e,i=t){return i[3]=e[0],i[4]=e[1],i[5]=e[2],i!==t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),t}function aG(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Br(t){return t?aG(t,Fce):Jn(Fce)}function Hte(t,e){return e||(e=Ht()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function ojt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function vKe(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=Number.NEGATIVE_INFINITY,t[3]=r,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function zW(t){return t.length===6}function qte(t){return TT(t)===0&&ET(t)===0&&ub(t)===0}function ajt(t,e,i){if(t==null||e==null)return t===e;if(!zW(t)||!zW(e))return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function bKe(t,e,i,r,s,n){return XS(t,e,i,r,s,n,wKe)}const ljt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],Fce=[1/0,1/0,1/0,-1/0,-1/0,-1/0],nCe=[0,0,0,0,0,0],wKe=Jn();function L6(t,{isPrimitive:e,width:i,depth:r,height:s}){const n=e?10:1;if(i==null&&s==null&&r==null)return[n*t[0],n*t[1],n*t[2]];const o=$e(i,r,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const xKe=XS(-.5,-.5,-.5,.5,.5,.5),SKe=XS(-.5,-.5,0,.5,.5,1),TKe=XS(-.5,-.5,0,.5,.5,.5);function EKe(t){switch(t){case"sphere":case"cube":case"diamond":return xKe;case"cylinder":case"cone":case"inverted-cone":return SKe;case"tetrahedron":return TKe;default:return}}const Wte=["butt","square","round"],CKe=[...Wte,"none"],oCe=["miter","bevel","round"];var VW;let Ow=VW=class extends ye{constructor(t){super(t),this.color=new Oe([0,0,0,1]),this.size=Do(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new VW(t)}};h([f(V0)],Ow.prototype,"color",void 0),h([f(Tg)],Ow.prototype,"size",void 0),h([f(eCe)],Ow.prototype,"pattern",void 0),h([f({type:Wte,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],Ow.prototype,"patternCap",void 0),Ow=VW=h([I("esri.symbols.support.Symbol3DOutline")],Ow);var u5;let vy=u5=class extends $g{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new u5(t)}static fromSimpleFillSymbol(t){var r,s,n;const e=t.outline&&t.outline.style&&t.outline.style!=="solid"?new Gte({style:t.outline.style}):null,i={size:((r=t.outline)==null?void 0:r.width)??0,color:(((s=t.outline)==null?void 0:s.color)??j$).clone(),pattern:e};return e&&((n=t.outline)!=null&&n.cap)&&(i.patternCap=t.outline.cap),new u5({material:new H$({color:(t.color??fKe).clone()}),pattern:t.style&&t.style!=="solid"?new KEe({style:t.style}):null,outline:i})}};h([ct({Fill:"fill"},{readOnly:!0})],vy.prototype,"type",void 0),h([f({type:H$,json:{write:!0}})],vy.prototype,"material",void 0),h([f(pKe)],vy.prototype,"pattern",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],vy.prototype,"castShadows",void 0),h([f({type:Ow,json:{write:!0}})],vy.prototype,"outline",void 0),h([f(Bte)],vy.prototype,"edges",void 0),vy=u5=h([I("esri.symbols.FillSymbol3DLayer")],vy);const CT=vy,MKe=["none","underline","line-through"],AKe=["normal","italic","oblique"],PKe=["normal","lighter","bold","bolder"],aCe={type:Number,cast:t=>{const e=bd(t);return e===0?1:Te(e,.1,4)},nonNullable:!0},OKe=["left","right","center"],RKe=["baseline","top","middle","bottom"],lCe={type:OKe,nonNullable:!0},cCe={type:RKe,nonNullable:!0},$Ke=8;var BW;let by=BW=class extends ye{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return pr(t)}clone(){return new BW({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};h([f({type:MKe,json:{default:"none",write:!0}})],by.prototype,"decoration",void 0),h([f({type:String,json:{write:!0}})],by.prototype,"family",void 0),h([f({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.textSymbol3D})}}})],by.prototype,"size",void 0),h([Li("size")],by.prototype,"castSize",null),h([f({type:AKe,json:{default:"normal",write:!0}})],by.prototype,"style",void 0),h([f({type:PKe,json:{default:"normal",write:!0}})],by.prototype,"weight",void 0),by=BW=h([I("esri.symbols.Font")],by);const hL=by;var GW;const IKe=Bl()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let Rw=GW=class extends ye{constructor(t){super(t)}readHref(t,e,i){return t?k1(t,i):e.dataURI}writeHref(t,e,i,r){t&&(Og(t)?e.dataURI=t:(e.href=YS(t,r),xc(e.href)&&(e.href=vh(e.href))))}clone(){return new GW({href:this.href,primitive:this.primitive})}};h([f({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],Rw.prototype,"href",void 0),h([Ce("href")],Rw.prototype,"readHref",null),h([Ve("href",{href:{type:String},dataURI:{type:String}})],Rw.prototype,"writeHref",null),h([ct(IKe)],Rw.prototype,"primitive",void 0),Rw=GW=h([I("esri.symbols.support.IconSymbol3DLayerResource")],Rw);const LKe="circle";var jW;let Wx=jW=class extends Re{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new jW({x:this.x,y:this.y})}};h([f({type:Number})],Wx.prototype,"x",void 0),h([f({type:Number})],Wx.prototype,"y",void 0),Wx=jW=h([I("esri.symbols.support.Symbol3DAnchorPosition2D")],Wx);var HW;let WO=HW=class extends ye{constructor(t){super(t),this.color=new Oe([0,0,0,1]),this.size=Do(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new HW(t)}};h([f(V0)],WO.prototype,"color",void 0),h([f(Tg)],WO.prototype,"size",void 0),WO=HW=h([I("esri.symbols.support.Symbol3DIconOutline")],WO);var oE;const uCe="esri.symbols.IconSymbol3DLayer";let _m=oE=class extends $g{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new oE({anchor:this.anchor,anchorPosition:Q(this.anchorPosition),enabled:this.enabled,material:Q(this.material),outline:Q(this.outline),resource:Q(this.resource),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||j$,i=kce(t),r=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||j$).clone()}:null;return new oE({size:t.size,resource:{primitive:NKe(t.style)},material:{color:e},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(t){const e=!t.color||mKe(t.color)?j$:t.color,i=kce(t);return new oE({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(t){return new oE({resource:{href:Rbe({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};h([f({type:xh,json:{write:!0}})],_m.prototype,"material",void 0),h([f({type:Rw,json:{write:!0}})],_m.prototype,"resource",void 0),h([ct({Icon:"icon"},{readOnly:!0})],_m.prototype,"type",void 0),h([f(Tg)],_m.prototype,"size",void 0),h([ct({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),f({json:{default:"center"}})],_m.prototype,"anchor",void 0),h([f({type:Wx,json:{type:[Number],read:{reader:t=>new Wx({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],_m.prototype,"anchorPosition",void 0),h([f({type:WO,json:{write:!0}})],_m.prototype,"outline",void 0),_m=oE=h([I(uCe)],_m);const Yv=_m;function kce(t){const e="width"in t?t.width:t.size,i="height"in t?t.height:t.size,r=Uce(t.xoffset),s=Uce(t.yoffset);return(r||s)&&e&&i?{x:-r/e,y:s/i}:null}function Uce(t){return isFinite(t)?t:0}const DKe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function NKe(t){return DKe[t]||(ie.getLogger(uCe).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}let $w=class extends Kr(ye){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],$w.prototype,"type",void 0),h([f({type:lKe,json:{default:"begin-end",write:!0}})],$w.prototype,"placement",void 0),h([f({type:ZEe,json:{default:"arrow",write:!0}})],$w.prototype,"style",void 0),h([f({type:Oe,json:{type:[Qr],default:null,write:!0}})],$w.prototype,"color",void 0),$w=h([I("esri.symbols.LineStyleMarker3D")],$w);const qW=$w;var h5;let vm=h5=class extends $g{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Do(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new h5(t)}static fromSimpleLineSymbol(t){var i;const e={enabled:!0,size:t.width??Do(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style?new Gte({style:t.style}):null,material:new xh({color:(t.color||j$).clone()}),marker:t.marker?new qW({placement:t.marker.placement,style:t.marker.style,color:((i=t.marker.color)==null?void 0:i.clone())??null}):null};return new h5(e)}};h([f({type:xh,json:{write:!0}})],vm.prototype,"material",void 0),h([ct({Line:"line"},{readOnly:!0})],vm.prototype,"type",void 0),h([f({type:oCe,json:{write:!0,default:"miter"}})],vm.prototype,"join",void 0),h([f({type:Wte,json:{write:!0,default:"butt"}})],vm.prototype,"cap",void 0),h([f(Tg)],vm.prototype,"size",void 0),h([f(eCe)],vm.prototype,"pattern",void 0),h([f({types:{key:"type",base:qW,typeMap:{style:qW}},json:{write:!0}})],vm.prototype,"marker",void 0),vm=h5=h([I("esri.symbols.LineSymbol3DLayer")],vm);const jA=vm;var WW;const FKe=Bl()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let YO=WW=class extends ye{clone(){return new WW({href:this.href,primitive:this.primitive})}};h([f({type:String,json:{read:Ate,write:U1}})],YO.prototype,"href",void 0),h([ct(FKe)],YO.prototype,"primitive",void 0),YO=WW=h([I("esri.symbols.support.ObjectSymbol3DLayerResource")],YO);const hCe="sphere";var YW;let Ex=YW=class extends Re{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new YW({x:this.x,y:this.y,z:this.z})}};h([f({type:Number})],Ex.prototype,"x",void 0),h([f({type:Number})],Ex.prototype,"y",void 0),h([f({type:Number})],Ex.prototype,"z",void 0),Ex=YW=h([I("esri.symbols.support.Symbol3DAnchorPosition3D")],Ex);var ZW;let vl=ZW=class extends $g{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){var t,e,i;return new ZW({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:(t=this.anchorPosition)==null?void 0:t.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:((e=this.material)==null?void 0:e.clone())??null,castShadows:this.castShadows,resource:(i=this.resource)==null?void 0:i.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};h([f({type:xh,json:{write:!0}})],vl.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],vl.prototype,"castShadows",void 0),h([f({type:YO,json:{write:!0}})],vl.prototype,"resource",void 0),h([ct({Object:"object"},{readOnly:!0})],vl.prototype,"type",void 0),h([f({type:Number,json:{write:!0}})],vl.prototype,"width",void 0),h([f({type:Number,json:{write:!0}})],vl.prototype,"height",void 0),h([f({type:Number,json:{write:!0}})],vl.prototype,"depth",void 0),h([ct({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),f({json:{default:"origin"}})],vl.prototype,"anchor",void 0),h([f({type:Ex,json:{type:[Number],read:{reader:t=>new Ex({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],vl.prototype,"anchorPosition",void 0),h([f({type:Number,json:{write:!0}})],vl.prototype,"heading",void 0),h([f({type:Number,json:{write:!0}})],vl.prototype,"tilt",void 0),h([f({type:Number,json:{write:!0}})],vl.prototype,"roll",void 0),h([f({readOnly:!0})],vl.prototype,"isPrimitive",null),vl=ZW=h([I("esri.symbols.ObjectSymbol3DLayer")],vl);const Yte=vl;var XW;let sc=XW=class extends $g{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new XW({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};h([f({type:xh,json:{write:!0}})],sc.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],sc.prototype,"castShadows",void 0),h([ct({Path:"path"},{readOnly:!0})],sc.prototype,"type",void 0),h([f({type:["circle","quad"],json:{write:!0,default:"circle"}})],sc.prototype,"profile",void 0),h([f({type:oCe,json:{write:!0,default:"miter"}})],sc.prototype,"join",void 0),h([f({type:CKe,json:{write:!0,default:"butt"}})],sc.prototype,"cap",void 0),h([f({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],sc.prototype,"width",void 0),h([Ce("width",["width","size","height"])],sc.prototype,"readWidth",null),h([f({type:Number,json:{write:!0}})],sc.prototype,"height",void 0),h([Ce("height",["height","size","width"])],sc.prototype,"readHeight",null),h([f({type:["center","bottom","top"],json:{write:!0,default:"center"}})],sc.prototype,"anchor",void 0),h([f({type:["heading","all"],json:{write:!0,default:"all"}})],sc.prototype,"profileRotation",void 0),sc=XW=h([I("esri.symbols.PathSymbol3DLayer")],sc);const Zte=sc;var JW;let sC=JW=class extends ye{constructor(){super(...arguments),this.color=new Oe([0,0,0,1]),this.size=0}clone(){const t={color:Q(this.color),size:this.size};return new JW(t)}};h([f(V0)],sC.prototype,"color",void 0),h([f(Tg)],sC.prototype,"size",void 0),sC=JW=h([I("esri.symbols.support.Symbol3DHalo")],sC);let q$=class extends Kr(ye){constructor(e){super(e),this.color=null}};h([f(V0)],q$.prototype,"color",void 0),q$=h([I("esri.symbols.support.Symbol3DTextBackground")],q$);var d5;let zc=d5=class extends $g{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,i,r){const s={...r,textSymbol3D:!0};e.font=t.write({},s),delete e.font.size}get size(){var t;return this._userSize!=null?this._userSize:((t=this.font)==null?void 0:t.size)!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new d5({enabled:this.enabled,font:this.font&&Q(this.font),halo:this.halo&&Q(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:Q(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new d5({font:t.font!=null?t.font.clone():new hL,halo:kKe(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new xh({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new q$({color:t.backgroundColor.clone()}):null})}};function kKe(t,e){return t&&e!=null&&e>0?new sC({color:Q(t),size:e}):null}h([f({type:hL,json:{write:!0}})],zc.prototype,"font",null),h([Ve("font")],zc.prototype,"writeFont",null),h([f({type:sC,json:{write:!0}})],zc.prototype,"halo",void 0),h([f({...lCe,json:{default:"center",write:!0}})],zc.prototype,"horizontalAlignment",void 0),h([f({...aCe,json:{default:1,write:!0}})],zc.prototype,"lineHeight",void 0),h([f({type:xh,json:{write:!0}})],zc.prototype,"material",void 0),h([f({type:q$,json:{write:!0}})],zc.prototype,"background",void 0),h([f(Tg)],zc.prototype,"size",null),h([f({type:String,json:{write:!0}})],zc.prototype,"text",void 0),h([ct({Text:"text"},{readOnly:!0})],zc.prototype,"type",void 0),h([f({...cCe,json:{default:"baseline",write:!0}})],zc.prototype,"verticalAlignment",void 0),zc=d5=h([I("esri.symbols.TextSymbol3DLayer")],zc);const MT=zc;var QW;let J_=QW=class extends $g{constructor(t){super(t),this.color=KW.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new QW({color:Q(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};h([f({type:Oe,nonNullable:!0,json:{type:[Qr],write:(t,e,i)=>e[i]=t.toArray(Oe.AlphaMode.UNLESS_OPAQUE),default:()=>KW.clone(),defaultEquals:t=>t.toCss(!0)===KW.toCss(!0)}})],J_.prototype,"color",void 0),h([ct({Water:"water"},{readOnly:!0})],J_.prototype,"type",void 0),h([f({type:["small","medium","large"],json:{write:!0,default:"medium"}})],J_.prototype,"waterbodySize",void 0),h([f({type:Number,json:{write:!0,default:null}})],J_.prototype,"waveDirection",void 0),h([f({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],J_.prototype,"waveStrength",void 0),J_=QW=h([I("esri.symbols.WaterSymbol3DLayer")],J_);const dCe=J_,KW=new Oe([0,119,190]);var eY;let Iw=eY=class extends Re{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new eY({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};h([f({type:String})],Iw.prototype,"name",void 0),h([f({type:String})],Iw.prototype,"styleUrl",void 0),h([f({type:String})],Iw.prototype,"styleName",void 0),h([f({type:No})],Iw.prototype,"portal",void 0),Iw=eY=h([I("esri.symbols.support.StyleOrigin")],Iw);const KI=Iw;var tY;let vS=tY=class extends Re{constructor(){super(...arguments),this.url=""}clone(){return new tY({url:this.url})}};h([f({type:String})],vS.prototype,"url",void 0),vS=tY=h([I("esri.symbols.support.Thumbnail")],vS);const pCe={icon:Yv,object:Yte,line:jA,path:Zte,fill:CT,extrude:YEe,text:MT,water:dCe},UKe=tt.ofType({base:$g,key:"type",typeMap:pCe,errorContext:"symbol-layer"});let bm=class extends ll{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const i=this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers,r=i==null?void 0:i.type,s=r||tt;this._set("symbolLayers",new s)}get color(){return null}set color(e){this.constructed&&ie.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){O1(e,this._get("symbolLayers"))}readStyleOrigin(e,i,r){if(e.styleUrl&&e.name){const s=k1(e.styleUrl,r);return new KI({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new KI({portal:(r==null?void 0:r.portal)||No.getDefault(),styleName:e.styleName,name:e.name});r!=null&&r.messages&&r.messages.push(new Sf("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,i,r,s){if(e.styleUrl&&e.name){let n=YS(e.styleUrl,s);xc(n)&&(n=vh(n)),i.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&(s!=null&&s.portal)&&!Obe(e.portal.restUrl,s.portal.restUrl)?s!=null&&s.messages&&s.messages.push(new Sf("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):i.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof $g||e&&pCe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};h([f({json:{read:!1,write:!1}})],bm.prototype,"color",null),h([f({type:UKe,nonNullable:!0,json:{write:!0}}),Li(iSe)],bm.prototype,"symbolLayers",null),h([f({type:KI})],bm.prototype,"styleOrigin",void 0),h([Ce("styleOrigin")],bm.prototype,"readStyleOrigin",null),h([Ve("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],bm.prototype,"writeStyleOrigin",null),h([f({type:vS,json:{read:!1}})],bm.prototype,"thumbnail",void 0),h([f({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],bm.prototype,"type",void 0),bm=h([I("esri.symbols.Symbol3D")],bm);const HA=bm;let ZO=class extends ye{constructor(e){super(e),this.visible=!0}clone(){throw new Error("Subclasses of Callout3D should implement their own clone method.")}};h([f({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],ZO.prototype,"type",void 0),h([f({readOnly:!0})],ZO.prototype,"visible",void 0),ZO=h([I("esri.symbols.callouts.Callout3D")],ZO);const fCe=ZO;var iY;let p5=iY=class extends ye{constructor(t){super(t),this.color=new Oe("white")}clone(){return new iY({color:Q(this.color)})}};h([f(V0)],p5.prototype,"color",void 0),p5=iY=h([I("esri.symbols.callouts.LineCallout3DBorder")],p5);const zKe=p5;var rY;let Q_=rY=class extends fCe{constructor(t){super(t),this.type="line",this.color=new Oe([0,0,0,1]),this.size=Do(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new rY({color:Q(this.color),size:this.size,border:Q(this.border)})}};h([ct({line:"line"})],Q_.prototype,"type",void 0),h([f(V0)],Q_.prototype,"color",void 0),h([f(Tg)],Q_.prototype,"size",void 0),h([f({type:zKe,json:{write:!0}})],Q_.prototype,"border",void 0),h([f({readOnly:!0})],Q_.prototype,"visible",null),Q_=rY=h([I("esri.symbols.callouts.LineCallout3D")],Q_);const mCe=Q_;function Xte(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function gCe(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!Xte(t)}function Jte(t){return t.type==="point-3d"||t.type==="label-3d"}function yCe(t){return t.horizontalAlignment==="center"}const _Ce={types:{key:"type",base:fCe,typeMap:{line:mCe}},json:{write:!0}};var sY;let aE=sY=class extends ye{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new sY({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};h([f(Tg)],aE.prototype,"screenLength",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0,default:0}})],aE.prototype,"minWorldLength",void 0),h([f({type:Number,json:{write:!0}})],aE.prototype,"maxWorldLength",void 0),aE=sY=h([I("esri.symbols.support.Symbol3DVerticalOffset")],aE);const Qte=aE;var f5;const vCe=tt.ofType({base:null,key:"type",typeMap:{text:MT}});let K_=f5=class extends HA{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new vCe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return gCe(this)}hasVisibleVerticalOffset(){return Xte(this)}clone(){return new f5({styleOrigin:Q(this.styleOrigin),symbolLayers:Q(this.symbolLayers),thumbnail:Q(this.thumbnail),callout:Q(this.callout),verticalOffset:Q(this.verticalOffset)})}static fromTextSymbol(t){return new f5({symbolLayers:new tt([MT.fromTextSymbol(t)])})}};h([f({type:Qte,json:{write:!0}})],K_.prototype,"verticalOffset",void 0),h([f(_Ce)],K_.prototype,"callout",void 0),h([f({json:{read:!1,write:!1}})],K_.prototype,"styleOrigin",void 0),h([f({type:vCe})],K_.prototype,"symbolLayers",void 0),h([ct({LabelSymbol3D:"label-3d"},{readOnly:!0})],K_.prototype,"type",void 0),K_=f5=h([I("esri.symbols.LabelSymbol3D")],K_);const lG=K_;var m5;const bCe=tt.ofType({base:null,key:"type",typeMap:{line:jA,path:Zte}}),VKe=tt.ofType({base:null,key:"type",typeMap:{line:jA,path:Zte}});let XO=m5=class extends HA{constructor(t){super(t),this.symbolLayers=new bCe,this.type="line-3d"}clone(){return new m5({styleOrigin:Q(this.styleOrigin),symbolLayers:Q(this.symbolLayers),thumbnail:Q(this.thumbnail)})}static fromSimpleLineSymbol(t){return new m5({symbolLayers:new tt([jA.fromSimpleLineSymbol(t)])})}};h([f({type:bCe,json:{type:VKe}})],XO.prototype,"symbolLayers",void 0),h([ct({LineSymbol3D:"line-3d"},{readOnly:!0})],XO.prototype,"type",void 0),XO=m5=h([I("esri.symbols.LineSymbol3D")],XO);const AT=XO;let ev=class extends ll{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};h([f({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],ev.prototype,"angle",void 0),h([f({type:["simple-marker","picture-marker"],readOnly:!0})],ev.prototype,"type",void 0),h([f({type:Number,cast:pr,json:{write:!0}})],ev.prototype,"xoffset",void 0),h([f({type:Number,cast:pr,json:{write:!0}})],ev.prototype,"yoffset",void 0),h([f({type:Number,cast:t=>t==="auto"?t:pr(t),json:{write:!0}})],ev.prototype,"size",void 0),ev=h([I("esri.symbols.MarkerSymbol")],ev);const wCe=ev;var g5;const xCe=tt.ofType({base:null,key:"type",typeMap:{fill:CT}});let JO=g5=class extends HA{constructor(t){super(t),this.symbolLayers=new xCe,this.type="mesh-3d"}clone(){return new g5({styleOrigin:Q(this.styleOrigin),symbolLayers:Q(this.symbolLayers),thumbnail:Q(this.thumbnail)})}static fromSimpleFillSymbol(t){return new g5({symbolLayers:new tt([CT.fromSimpleFillSymbol(t)])})}};h([f({type:xCe})],JO.prototype,"symbolLayers",void 0),h([ct({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],JO.prototype,"type",void 0),JO=g5=h([I("esri.symbols.MeshSymbol3D")],JO);const dL=JO;function BKe(t,e,i){return e.imageData?Rbe({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):SCe(e.url,i)}function SCe(t,e){if(!xc(t)){const i=jKe(e);if(i)return zl(i,"images",t)}return k1(t,e)}function GKe(t,e,i,r){if(Og(t)){const s=T1(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,i&&i.imageData===e.imageData&&i.url&&U1(i.url,e,"url",r)}else U1(t,e,"url",r)}const TCe={json:{read:{source:["imageData","url"],reader:BKe},write:{writer(t,e,i,r){GKe(t,e,this.source,r)}}}},ECe={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,i){const r={};return e.imageData&&(r.imageData=e.imageData),e.contentType&&(r.contentType=e.contentType),e.url&&(r.url=SCe(e.url,i)),r}}}};function jKe(t){var s,n;if(!t)return null;const{origin:e,layer:i}=t;if(e!=="service"&&e!=="portal-item")return null;const r=i==null?void 0:i.type;return r==="feature"||r==="stream"?(s=i.parsedUrl)==null?void 0:s.path:r==="map-image"||r==="tile"?(n=t.url)==null?void 0:n.path:null}var nY;let Yh=nY=class extends XEe{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),i!=null&&(s.width=pr(i)),r!=null&&(s.height=pr(r)),s}clone(){const t=new nY({color:Q(this.color),height:this.height,outline:Q(this.outline),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",Q(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};h([ct({esriPFS:"picture-fill"},{readOnly:!0})],Yh.prototype,"type",void 0),h([f(TCe)],Yh.prototype,"url",void 0),h([f({type:Number,json:{write:!0}})],Yh.prototype,"xscale",void 0),h([f({type:Number,json:{write:!0}})],Yh.prototype,"yscale",void 0),h([f({type:Number,cast:pr,json:{write:!0}})],Yh.prototype,"width",void 0),h([f({type:Number,cast:pr,json:{write:!0}})],Yh.prototype,"height",void 0),h([f({type:Number,cast:pr,json:{write:!0}})],Yh.prototype,"xoffset",void 0),h([f({type:Number,cast:pr,json:{write:!0}})],Yh.prototype,"yoffset",void 0),h([f(ECe)],Yh.prototype,"source",void 0),Yh=nY=h([I("esri.symbols.PictureFillSymbol")],Yh);const Kte=Yh;var oY;let Sp=oY=class extends wCe{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const r={};return t&&(r.url=t),e!=null&&(r.width=pr(e)),i!=null&&(r.height=pr(i)),r}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new oY({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",Q(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};h([f({json:{write:!1}})],Sp.prototype,"color",void 0),h([ct({esriPMS:"picture-marker"},{readOnly:!0})],Sp.prototype,"type",void 0),h([f(TCe)],Sp.prototype,"url",void 0),h([f(ECe)],Sp.prototype,"source",void 0),h([f({type:Number,cast:pr,json:{write:!0}})],Sp.prototype,"height",void 0),h([Ce("height",["height","size"])],Sp.prototype,"readHeight",null),h([f({type:Number,cast:pr,json:{write:!0}})],Sp.prototype,"width",void 0),h([f({json:{write:!1}})],Sp.prototype,"size",void 0),Sp=oY=h([I("esri.symbols.PictureMarkerSymbol")],Sp);const pL=Sp;var Lw;const CCe=tt.ofType({base:null,key:"type",typeMap:{icon:Yv,object:Yte,text:MT}});let Dw=Lw=class extends HA{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new CCe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return gCe(this)}hasVisibleVerticalOffset(){return Xte(this)}clone(){return new Lw({verticalOffset:Q(this.verticalOffset),callout:Q(this.callout),styleOrigin:Q(this.styleOrigin),symbolLayers:Q(this.symbolLayers),thumbnail:Q(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new Lw({symbolLayers:new tt([Yv.fromSimpleMarkerSymbol(t)])})}static fromPictureMarkerSymbol(t){return new Lw({symbolLayers:new tt([Yv.fromPictureMarkerSymbol(t)])})}static fromCIMSymbol(t){var r,s;if(((s=(r=t.data)==null?void 0:r.symbol)==null?void 0:s.type)!=="CIMPointSymbol")return null;const i=t.data.symbol;return new Lw(i!=null&&i.callout?{symbolLayers:new tt([Yv.fromCIMSymbol(t)]),callout:new mCe({size:.5,color:new Oe([0,0,0])}),verticalOffset:new Qte({screenLength:40})}:{symbolLayers:new tt([Yv.fromCIMSymbol(t)])})}static fromTextSymbol(t){return new Lw({symbolLayers:new tt([MT.fromTextSymbol(t)])})}};h([f({type:Qte,json:{write:!0}})],Dw.prototype,"verticalOffset",void 0),h([f(_Ce)],Dw.prototype,"callout",void 0),h([f({type:CCe,json:{origins:{"web-scene":{write:!0}}}})],Dw.prototype,"symbolLayers",void 0),h([ct({PointSymbol3D:"point-3d"},{readOnly:!0})],Dw.prototype,"type",void 0),Dw=Lw=h([I("esri.symbols.PointSymbol3D")],Dw);const Km=Dw;var QO;const MCe=tt.ofType({base:null,key:"type",typeMap:{extrude:YEe,fill:CT,icon:Yv,line:jA,object:Yte,text:MT,water:dCe}});let KO=QO=class extends HA{constructor(t){super(t),this.symbolLayers=new MCe,this.type="polygon-3d"}initialize(){const t=e=>{e.type==="line"&&b1(ie.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),e.type==="text"&&b1(ie.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const e of this.symbolLayers)t(e);this.addHandles(Ta(()=>this.symbolLayers,"after-add",({item:e})=>t(e),ar))}clone(){return new QO({styleOrigin:Q(this.styleOrigin),symbolLayers:Q(this.symbolLayers),thumbnail:Q(this.thumbnail)})}static fromJSON(t){var i;const e=new QO;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const r=e.symbolLayers.at(0),s=e.symbolLayers.at(1);!s.enabled||(i=t.symbolLayers)!=null&&i[1]&&t.symbolLayers[1].enable===!1||(r.outline={size:s.size,color:s.material!=null?s.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new QO({symbolLayers:new tt([CT.fromSimpleFillSymbol(t)])})}};h([f({type:MCe,json:{write:!0}})],KO.prototype,"symbolLayers",void 0),h([ct({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],KO.prototype,"type",void 0),KO=QO=h([I("esri.symbols.PolygonSymbol3D")],KO);const hb=KO;var aY;const D6=new qi({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Nw=aY=class extends XEe{constructor(...t){super(...t),this.color=new Oe([0,0,0,.25]),this.outline=new Mu,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.style=t),e&&(r.outline=e),i&&(r.color=i),r}clone(){return new aY({color:Q(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};h([f()],Nw.prototype,"color",void 0),h([f()],Nw.prototype,"outline",void 0),h([ct({esriSFS:"simple-fill"},{readOnly:!0})],Nw.prototype,"type",void 0),h([f({type:D6.apiValues,json:{read:D6.read,write:D6.write}})],Nw.prototype,"style",void 0),Nw=aY=h([I("esri.symbols.SimpleFillSymbol")],Nw);const db=Nw;var lY;const N6=new qi({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let wm=lY=class extends wCe{constructor(...t){super(...t),this.color=new Oe([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Mu}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=pr(e)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new lY({angle:this.angle,color:Q(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};h([f()],wm.prototype,"color",void 0),h([Ve("color")],wm.prototype,"writeColor",null),h([ct({esriSMS:"simple-marker"},{readOnly:!0})],wm.prototype,"type",void 0),h([f()],wm.prototype,"size",void 0),h([f({type:N6.apiValues,json:{read:N6.read,write:N6.write}})],wm.prototype,"style",void 0),h([f({type:String,json:{write:!0}})],wm.prototype,"path",null),h([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Mu}},json:{default:null,write:!0}})],wm.prototype,"outline",void 0),wm=lY=h([I("esri.symbols.SimpleMarkerSymbol")],wm);const kf=wm;var cY;let Qs=cY=class extends ll{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new hL,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.text=t),e&&(r.font=e),i&&(r.color=i),r}writeLineWidth(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}castLineWidth(t){return pr(t)}writeLineHeight(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}clone(){return new cY({angle:this.angle,backgroundColor:Q(this.backgroundColor),borderLineColor:Q(this.borderLineColor),borderLineSize:this.borderLineSize,color:Q(this.color),font:this.font&&this.font.clone(),haloColor:Q(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t,e,i;return`${(t=this.backgroundColor)==null?void 0:t.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(e=this.color)==null?void 0:e.hash()}.${this.font&&this.font.hash()}.${(i=this.haloColor)==null?void 0:i.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};h([f({type:Oe,json:{write:!0}})],Qs.prototype,"backgroundColor",void 0),h([f({type:Oe,json:{write:!0}})],Qs.prototype,"borderLineColor",void 0),h([f({type:Number,json:{write:!0},cast:pr})],Qs.prototype,"borderLineSize",void 0),h([f({type:hL,json:{write:!0}})],Qs.prototype,"font",void 0),h([f({...lCe,json:{write:!0}})],Qs.prototype,"horizontalAlignment",void 0),h([f({type:Boolean,json:{write:!0}})],Qs.prototype,"kerning",void 0),h([f({type:Oe,json:{write:!0}})],Qs.prototype,"haloColor",void 0),h([f({type:Number,cast:pr,json:{write:!0}})],Qs.prototype,"haloSize",void 0),h([f({type:Boolean,json:{write:!0}})],Qs.prototype,"rightToLeft",void 0),h([f({type:Boolean,json:{write:!0}})],Qs.prototype,"rotated",void 0),h([f({type:String,json:{write:!0}})],Qs.prototype,"text",void 0),h([ct({esriTS:"text"},{readOnly:!0})],Qs.prototype,"type",void 0),h([f({...cCe,json:{write:!0}})],Qs.prototype,"verticalAlignment",void 0),h([f({type:Number,cast:pr,json:{write:!0}})],Qs.prototype,"xoffset",void 0),h([f({type:Number,cast:pr,json:{write:!0}})],Qs.prototype,"yoffset",void 0),h([f({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Qs.prototype,"angle",void 0),h([f({type:Number,json:{write:!0}})],Qs.prototype,"width",void 0),h([f({type:Number})],Qs.prototype,"lineWidth",void 0),h([Ve("lineWidth")],Qs.prototype,"writeLineWidth",null),h([Li("lineWidth")],Qs.prototype,"castLineWidth",null),h([f(aCe)],Qs.prototype,"lineHeight",void 0),h([Ve("lineHeight")],Qs.prototype,"writeLineHeight",null),Qs=cY=h([I("esri.symbols.TextSymbol")],Qs);const qA=Qs;var uY;let Tp=uY=class extends ll{constructor(t){super(t),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:No.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new uY({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const i=e!=null?e.cache:null,r=i?this._fetchCacheKey:null;if(i!=null){const a=r&&i.get(r);if(a)return a.clone()}const{resolveWebStyleSymbol:s}=await fe(()=>Promise.resolve().then(()=>Ext),void 0);Et(e);const n=s(this,{portal:this.portal},t,e);n.catch(a=>{ie.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(i!=null&&i.set(r,o.clone()),o):null}};h([f({json:{write:!1}})],Tp.prototype,"color",void 0),h([f({type:String,json:{write:!0}})],Tp.prototype,"styleName",void 0),h([f({type:No,json:{write:!1}})],Tp.prototype,"portal",void 0),h([f({type:String,json:{read:Ate,write:U1}})],Tp.prototype,"styleUrl",void 0),h([f({type:vS,json:{read:!1}})],Tp.prototype,"thumbnail",void 0),h([f({type:String,json:{write:!0}})],Tp.prototype,"name",void 0),h([ct({styleSymbolReference:"web-style"},{readOnly:!0})],Tp.prototype,"type",void 0),h([f()],Tp.prototype,"_fetchCacheKey",null),Tp=uY=h([I("esri.symbols.WebStyleSymbol")],Tp);const PT=Tp;function cG(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function JS(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const bS={base:ll,key:"type",typeMap:{"simple-fill":db,"picture-fill":Kte,"picture-marker":pL,"simple-line":Mu,"simple-marker":kf,text:qA,"label-3d":lG,"line-3d":AT,"mesh-3d":dL,"point-3d":Km,"polygon-3d":hb,"web-style":PT,cim:cb},errorContext:"symbol"},fjt={base:ll,key:"type",typeMap:{"picture-marker":pL,"simple-marker":kf,"point-3d":Km,cim:cb},errorContext:"symbol"},mjt={base:ll,key:"type",typeMap:{"simple-line":Mu,"line-3d":AT,cim:cb},errorContext:"symbol"},gjt={base:ll,key:"type",typeMap:{"simple-fill":db,"picture-fill":Kte,"polygon-3d":hb,cim:cb},errorContext:"symbol"},HKe={base:ll,key:"type",typeMap:{"picture-marker":pL,"simple-marker":kf,text:qA,"web-style":PT,cim:cb},errorContext:"symbol"},qKe=OA({types:bS}),ACe={base:ll,key:"type",typeMap:{"simple-fill":db,"picture-fill":Kte,"picture-marker":pL,"simple-line":Mu,"simple-marker":kf,text:qA,"line-3d":AT,"mesh-3d":dL,"point-3d":Km,"polygon-3d":hb,"web-style":PT,cim:cb},errorContext:"symbol"},WKe={base:ll,key:"type",typeMap:{text:qA,"label-3d":lG},errorContext:"symbol"},zce={base:ll,key:"type",typeMap:{"line-3d":AT,"mesh-3d":dL,"point-3d":Km,"polygon-3d":hb,"web-style":PT,cim:cb},errorContext:"symbol"},YKe={base:ll,key:"type",typeMap:{"label-3d":lG},errorContext:"symbol"},PCe=xf(bS);var hY;function ZKe(t){if(!t)return null;const e={};for(const i in t){const r=C1(t[i]);r&&(e[i]=r)}return Object.keys(e).length!==0?e:null}function XKe(t){if(t==null)return null;const e={};for(const i in t){const r=t[i];r&&(e[i]=r.toJSON())}return Object.keys(e).length!==0?e:null}let nc=hY=class extends Kr(ye){constructor(t){super(t),this.isAggregate=!1,this.layer=null,this.origin=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:_h(),configurable:!0}),Object.defineProperty(this,"_lastMeshTransform",{value:{},configurable:!0,writable:!0,enumerable:!1}),arguments.length>1&&DUe(ie.getLogger(this),"Graphic",{version:"4.30"})}initialize(){this._watchMeshGeometryChanges()}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),(t==null?void 0:t.type)!=="mesh"&&this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new hY({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;const e=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const i of[e,this.sourceLayer,this.layer])if(i){if("popupTemplate"in i&&i.popupTemplate)return i.popupTemplate;if(t&&"defaultPopupTemplate"in i&&i.defaultPopupTemplate!=null)return i.defaultPopupTemplate}return null}getAttribute(t){var e;return(e=this.attributes)==null?void 0:e[t]}setAttribute(t,e){if(this.attributes){const i=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",i,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){var t;return{aggregateGeometries:XKe(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:bU(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:((t=this.popupTemplate)==null?void 0:t.toJSON())??null}}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if((e==null?void 0:e.type)==="mesh"){const i={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",i,i,t.action)}}_notifyLayer(t,e,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:t,oldValue:e,newValue:i};t==="origin-transform"&&(s.action=r),t==="attributes"&&(s.attributeName=r),this.layer.graphicChanged(s)}_watchMeshGeometryChanges(){this.addHandles([vu(()=>{var t,e;return((t=this.geometry)==null?void 0:t.type)==="mesh"&&this.geometry.vertexSpace.origin?{localMatrix:(e=this.geometry.transform)==null?void 0:e.localMatrix,origin:this.geometry.vertexSpace.origin}:void 0},({localMatrix:t,origin:e})=>{this._lastMeshTransform.localMatrix===t&&this._lastMeshTransform.origin===e||(this._lastMeshTransform.localMatrix=t,this._lastMeshTransform.origin=e,this.notifyMeshTransformChanged())}),vu(()=>{var t;return((t=this.geometry)==null?void 0:t.type)==="mesh"?{vertexAttributes:this.geometry.vertexAttributes}:void 0},()=>{var e;const t=this.geometry;(t==null?void 0:t.type)==="mesh"&&t.vertexSpace.origin?(this._lastMeshTransform.localMatrix=(e=t.transform)==null?void 0:e.localMatrix,this._lastMeshTransform.origin=t.vertexSpace.origin):(this._lastMeshTransform.localMatrix=void 0,this._lastMeshTransform.origin=void 0),this._notifyLayer("geometry",this.geometry,this.geometry)},{equals:(t,e)=>t===e,sync:!0})])}};h([f({value:null,json:{read:ZKe}})],nc.prototype,"aggregateGeometries",null),h([f({value:null})],nc.prototype,"attributes",null),h([f({value:null,types:fT,json:{read:C1}})],nc.prototype,"geometry",null),h([f({type:Boolean})],nc.prototype,"isAggregate",void 0),h([f({clonable:"reference"})],nc.prototype,"layer",void 0),h([f({clonable:"reference"})],nc.prototype,"origin",void 0),h([f({type:GA})],nc.prototype,"popupTemplate",void 0),h([f({clonable:"reference"})],nc.prototype,"sourceLayer",void 0),h([f({value:null,types:bS})],nc.prototype,"symbol",null),h([f({type:Boolean,value:!0})],nc.prototype,"visible",null),nc=hY=h([I("esri.Graphic")],nc),function(t){t.generateUID=_h}(nc||(nc={}));const Su=nc;let wS=class extends D${_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};h([See({Type:Su,ensureType:Ln(Su)})],wS.prototype,"itemType",void 0),wS=h([I("esri.support.GraphicsCollection")],wS);let tv=class extends Re{constructor(e){super(e),this.view=null,this.baseLayerViews=new tt,this.referenceLayerViews=new tt,this._loadingHandle=ue(()=>{var i,r;return(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.basemap},i=>{i&&i.load().catch(()=>{})},cr)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var i,r,s;if((i=this.view)!=null&&i.suspended)return!1;const e=(s=(r=this.view)==null?void 0:r.map)==null?void 0:s.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(n=>n.updating)||this.referenceLayerViews.some(n=>n.updating))}};h([f({constructOnly:!0})],tv.prototype,"view",void 0),h([f({readOnly:!0})],tv.prototype,"baseLayerViews",void 0),h([f({readOnly:!0})],tv.prototype,"referenceLayerViews",void 0),h([f({readOnly:!0})],tv.prototype,"suspended",null),h([f({type:Boolean,readOnly:!0})],tv.prototype,"updating",null),tv=h([I("esri.views.BasemapView")],tv);function JKe(t){return"tryRecycleWith"in t}function QKe(t){return t!=null&&typeof t=="object"&&"layerViews"in t}let KKe=class{constructor(e,i,r){this.layer=e,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=ra(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,Io(this._controller.signal,()=>{const s=new V("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!JKe(this.layerView))return null;const i=this.layer.type,r=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==i)continue;const o=this.layerView.tryRecycleWith(n,{signal:r});if(o){e.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(Et(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,u)=>Io(this._controller.signal,()=>u(Di())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:i,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var s,n;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:i,view:r}=this;this._map=r.map;try{let o,a;if(await i.load({signal:e}),i.prefetchResources&&await i.prefetchResources({signal:e}),tet(i))o=await i.createLayerView(r,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new V("layer:view-not-supported","No layerview implementation was found");const u=await this.layerViewImporter.importLayerView(i);Et(e),o="default"in u?new u.default({layer:i,view:r}):new u({layer:i,view:r})}const l=()=>{a=Or(a),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};a=Io(e,l),Et(e);try{await o.when()}catch(u){throw l(),u}if(!((n=(s=this._map)==null?void 0:s.allLayers)==null?void 0:n.includes(i)))return l(),void this._deferred.reject(new V("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=o,i.emit("layerview-create",{view:r,layerView:o}),r.emit("layerview-create",{layer:i,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){i.emit("layerview-create-error",{view:r,error:o}),r.emit("layerview-create-error",{layer:i,error:o}),this.done=!0,this._deferred.reject(new V("layerview:create-error","layerview creation failed",{layer:i,error:o}))}}},Zh=class extends Re{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new u0,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var r;const i=(r=this.view.map)==null?void 0:r.allLayers;if(i)for(const s of i)this.layerViewImporter.hasLayerViewModule(s)&&this.layerViewImporter.importLayerView(s)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=ra(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(hT(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,u;if(this.destroyed)return;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,s=[],n=this.view.ready,o=d=>{if(d!=null){for(const p of d)if(p){r.add(p);const m=this._layerLayerViewInfoMap.get(p);m&&n?m.start():m||this._recyclingInfoMap.has(p)||s.push(p),"layers"in p&&p.layers&&o(p.layers)}}};for(const d of this._rootCollectionNames)o(mf(this,d));for(const[d,p]of this._layerLayerViewInfoMap)if(!r.has(d)){this._layerLayerViewInfoMap.delete(p.layer);const m=p.tryRecycle(s);m?(this.notifyChange("updating"),this._recyclingInfoMap.set(p.layer,p),m.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(p.layer),this._layerLayerViewInfoMap.set(p.layer,p),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(p.layer),p.destroy(),this._reschedule()})):p.destroy()}for(const[d,p]of this._recyclingInfoMap)r.has(d)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(p.layer),p.destroy());for(const d of s)this._createLayerView(d);this._refreshCollections();const a=[(l=i==null?void 0:i.ground)==null?void 0:l.layers,(c=i==null?void 0:i.basemap)==null?void 0:c.baseLayers,(u=i==null?void 0:i.basemap)==null?void 0:u.referenceLayers,i==null?void 0:i.layers].filter(d=>!!d);r.forEach(d=>"layers"in d&&a.push(d.layers)),this.addHandles(a.map(d=>this._watchUpdatingTracking.addOnCollectionChange(()=>d,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([Ta(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),ue(()=>{const e=this.view,i=e==null?void 0:e.map;return[i==null?void 0:i.basemap,i==null?void 0:i.ground,i==null?void 0:i.layers,e==null?void 0:e.ready]},()=>this._reschedule(),sr)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),M6(this._recyclingInfoMap),M6(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(Di()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||mh(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){this.destroyed||(M6(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new V("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}isCreatingLayerViewsForLayer(e,i){var n;this.commitProperty("updatingRemaining");const r=this._layerLayerViewInfoMap.get(e);if(!(r!=null&&r.done))return!0;const s=r.layerView;return!(!s||!i||s.parent===i)||!!(r.done&&s&&"layers"in e&&((n=e.layers)!=null&&n.length))&&e.layers.some(o=>this.isCreatingLayerViewsForLayer(o,s))}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(mf(this,e),mf(this,i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,i,r){if(!e||!i)return void(i&&i.removeAll());let s=0;for(const n of e){const o=this._layerLayerViewInfoMap.get(n);if(!(o!=null&&o.layerView))continue;const a=o.layerView;a.layer=n,a.parent=r,i.at(s)!==a&&i.splice(s,0,a),"layers"in n&&QKe(a)&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),s+=1}s<i.length&&i.splice(s,i.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new KKe(e,this.view,this.layerViewImporter);i.promise.then(()=>this._refreshCollections(),r=>{r&&(ms(r)||r.name==="cancelled:layerview-create")||ie.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};h([f()],Zh.prototype,"_workPromise",void 0),h([f({readOnly:!0})],Zh.prototype,"_watchUpdatingTracking",void 0),h([f({readOnly:!0})],Zh.prototype,"_layersToLayerViews",null),h([f({readOnly:!0})],Zh.prototype,"_rootCollectionNames",null),h([f()],Zh.prototype,"layerViewImporter",void 0),h([f()],Zh.prototype,"supportsGround",void 0),h([f({readOnly:!0})],Zh.prototype,"updating",null),h([f({readOnly:!0})],Zh.prototype,"updatingRemaining",null),h([f({constructOnly:!0})],Zh.prototype,"view",void 0),Zh=h([I("esri.views.LayerViewManager")],Zh);const eet=Zh;function tet(t){return"createLayerView"in t&&t.createLayerView!=null}let Vu=class extends Re{constructor(e){super(e),this.factor=1.5,this.offset=Bd(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};h([f({type:Number})],Vu.prototype,"factor",void 0),h([f({nonNullable:!0})],Vu.prototype,"offset",void 0),h([f()],Vu.prototype,"position",void 0),h([f({type:Number,range:{min:0}})],Vu.prototype,"size",void 0),h([f()],Vu.prototype,"maskUrl",void 0),h([f()],Vu.prototype,"maskEnabled",void 0),h([f()],Vu.prototype,"overlayUrl",void 0),h([f()],Vu.prototype,"overlayEnabled",void 0),h([f({readOnly:!0})],Vu.prototype,"version",null),h([f({type:Boolean})],Vu.prototype,"visible",void 0),Vu=h([I("esri.views.Magnifier")],Vu);const OCe=Vu;let y5=class{constructor(e){this._observable=new Q3,this._map=new Map(e)}get size(){return zt(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const i=this._map.delete(e);return i&&this._observable.notify(),i}entries(){return zt(this._observable),this._map.entries()}forEach(e,i){zt(this._observable),this._map.forEach((r,s)=>e.call(i,r,s,this),i)}get(e){return zt(this._observable),this._map.get(e)}has(e){return zt(this._observable),this._map.has(e)}keys(){return zt(this._observable),this._map.keys()}set(e,i){return this._map.set(e,i),this._observable.notify(),this}values(){return zt(this._observable),this._map.values()}[Symbol.iterator](){return zt(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}};var dY;let eR=dY=class extends ye{constructor(t){super(t),this.name=null,this.code=null}clone(){return new dY({name:this.name,code:this.code})}};h([f({type:String,json:{write:!0}})],eR.prototype,"name",void 0),h([f({type:[String,Number],json:{write:!0}})],eR.prototype,"code",void 0),eR=dY=h([I("esri.layers.support.CodedValue")],eR);const iet=new qi({inherited:"inherited",codedValue:"coded-value",range:"range"});let tR=class extends ye{constructor(e){super(e),this.name=null,this.type=null}};h([f({type:String,json:{write:!0}})],tR.prototype,"name",void 0),h([ct(iet)],tR.prototype,"type",void 0),tR=h([I("esri.layers.support.Domain")],tR);const uG=tR;var pY;let iR=pY=class extends uG{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const i=String(t);this.codedValues.some(r=>(String(r.code)===i&&(e=r.name),!!e))}return e}clone(){return new pY({codedValues:Q(this.codedValues),name:this.name})}};h([f({type:[eR],json:{write:!0}})],iR.prototype,"codedValues",void 0),h([ct({codedValue:"coded-value"})],iR.prototype,"type",void 0),iR=pY=h([I("esri.layers.support.CodedValueDomain")],iR);const RCe=iR;var fY;let _5=fY=class extends uG{constructor(t){super(t),this.type="inherited"}clone(){return new fY}};h([ct({inherited:"inherited"})],_5.prototype,"type",void 0),_5=fY=h([I("esri.layers.support.InheritedDomain")],_5);const $Ce=_5;var mY;let lE=mY=class extends uG{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new mY({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};h([f({json:{type:[Number],read:{source:"range",reader:(t,e)=>{var i;return(i=e.range)==null?void 0:i[1]}},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,i){e[i]=[this.minValue||0,t]}}}})],lE.prototype,"maxValue",void 0),h([f({json:{type:[Number],read:{source:"range",reader:(t,e)=>{var i;return(i=e.range)==null?void 0:i[0]}},write:{target:"range",writer(t,e,i){e[i]=[t,this.maxValue||0]}}}})],lE.prototype,"minValue",void 0),h([ct({range:"range"})],lE.prototype,"type",void 0),lE=mY=h([I("esri.layers.support.RangeDomain")],lE);const ICe=lE,LCe={key:"type",base:uG,typeMap:{range:ICe,"coded-value":RCe,inherited:$Ce}};function hG(t){if(!(t!=null&&t.type))return null;switch(t.type){case"range":return ICe.fromJSON(t);case"codedValue":return RCe.fromJSON(t);case"inherited":return $Ce.fromJSON(t)}return null}const ret=new qi({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var gY;const set=new qi({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let bl=gY=class extends ye{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return(i==null?void 0:i.value)??null}readValueType(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?set.fromJSON(i.fieldValueType):null}clone(){var t;return new gY({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:((t=this.domain)==null?void 0:t.clone())??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};h([f({type:String,json:{write:!0}})],bl.prototype,"alias",void 0),h([f({type:[String,Number],json:{write:{allowNull:!0}}})],bl.prototype,"defaultValue",void 0),h([f()],bl.prototype,"description",void 0),h([Ce("description")],bl.prototype,"readDescription",null),h([f({types:LCe,json:{read:{reader:hG},write:!0}})],bl.prototype,"domain",void 0),h([f({type:Boolean,json:{write:!0}})],bl.prototype,"editable",void 0),h([f({type:Qr,json:{write:{overridePolicy:t=>({enabled:Number.isFinite(t)})}}})],bl.prototype,"length",void 0),h([f({type:String,json:{write:!0}})],bl.prototype,"name",void 0),h([f({type:Boolean,json:{write:!0}})],bl.prototype,"nullable",void 0),h([ct(ret)],bl.prototype,"type",void 0),h([f()],bl.prototype,"valueType",void 0),h([Ce("valueType",["description"])],bl.prototype,"readValueType",null),h([f({type:Boolean,json:{read:!1}})],bl.prototype,"visible",void 0),bl=gY=h([I("esri.layers.support.Field")],bl);const dG=bl;var yY;let cE=yY=class extends ye{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new yY({mapLayerId:t,gdbVersion:e})}};h([ct({mapLayer:"map-layer"})],cE.prototype,"type",void 0),h([f({type:Qr,json:{write:!0}})],cE.prototype,"mapLayerId",void 0),h([f({type:String,json:{write:!0}})],cE.prototype,"gdbVersion",void 0),cE=yY=h([I("esri.layers.support.source.MapLayerSource")],cE);var _Y;let wy=_Y=class extends ye{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:i,spatialReference:r,geometryType:s}=this,n={workspaceId:t,query:e,oidFields:i,spatialReference:(r==null?void 0:r.clone())??void 0,geometryType:s};return new _Y(n)}};h([ct({queryTable:"query-table"})],wy.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],wy.prototype,"workspaceId",void 0),h([f({type:String,json:{write:!0}})],wy.prototype,"query",void 0),h([f({type:String,json:{write:!0}})],wy.prototype,"oidFields",void 0),h([f({type:We,json:{write:!0}})],wy.prototype,"spatialReference",void 0),h([ct(Iwe)],wy.prototype,"geometryType",void 0),wy=_Y=h([I("esri.layers.support.source.QueryTableDataSource")],wy);var vY;let uE=vY=class extends ye{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new vY({workspaceId:t,dataSourceName:e})}};h([ct({raster:"raster"})],uE.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],uE.prototype,"dataSourceName",void 0),h([f({type:String,json:{write:!0}})],uE.prototype,"workspaceId",void 0),uE=vY=h([I("esri.layers.support.source.RasterDataSource")],uE);var bY;let Fw=bY=class extends ye{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:i}=this;return new bY({workspaceId:t,gdbVersion:e,dataSourceName:i})}};h([ct({table:"table"})],Fw.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],Fw.prototype,"workspaceId",void 0),h([f({type:String,json:{write:!0}})],Fw.prototype,"gdbVersion",void 0),h([f({type:String,json:{write:!0}})],Fw.prototype,"dataSourceName",void 0),Fw=bY=h([I("esri.layers.support.source.TableDataSource")],Fw);var wY,xY;const net=Bl()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let Bu=wY=class extends ye{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,i){return Vce()(t,e,i)}castLeftTableSource(t){return xf(SY(),t)}readRightTableSource(t,e,i){return Vce()(t,e,i)}castRightTableSource(t){return xf(SY(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:t,rightTableKey:e,leftTableSource:(i==null?void 0:i.clone())??void 0,rightTableSource:(r==null?void 0:r.clone())??void 0,joinType:s};return new wY(n)}};h([ct({joinTable:"join-table"})],Bu.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],Bu.prototype,"leftTableKey",void 0),h([f({type:String,json:{write:!0}})],Bu.prototype,"rightTableKey",void 0),h([f({json:{write:!0}})],Bu.prototype,"leftTableSource",void 0),h([Ce("leftTableSource")],Bu.prototype,"readLeftTableSource",null),h([Li("leftTableSource")],Bu.prototype,"castLeftTableSource",null),h([f({json:{write:!0}})],Bu.prototype,"rightTableSource",void 0),h([Ce("rightTableSource")],Bu.prototype,"readRightTableSource",null),h([Li("rightTableSource")],Bu.prototype,"castRightTableSource",null),h([ct(net)],Bu.prototype,"joinType",void 0),Bu=wY=h([I("esri.layers.support.source.JoinTableDataSource")],Bu);let F6=null;function Vce(){return F6||(F6=OA({types:SY()})),F6}let k6=null;function SY(){return k6||(k6={key:"type",base:null,typeMap:{"data-layer":Vp,"map-layer":cE}}),k6}const oet={key:"type",base:null,typeMap:{"join-table":Bu,"query-table":wy,raster:uE,table:Fw}};let Vp=xY=class extends ye{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new xY({fields:t,dataSource:e})}};h([ct({dataLayer:"data-layer"})],Vp.prototype,"type",void 0),h([f({type:[dG],json:{write:!0}})],Vp.prototype,"fields",void 0),h([f({types:oet,json:{write:!0}})],Vp.prototype,"dataSource",void 0),Vp=xY=h([I("esri.layers.support.source.DataLayerSource")],Vp),Vp.from=Ln(Vp);let kw=class extends Kr(ye){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};h([f({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],kw.prototype,"onFields",void 0),h([f({type:String,json:{write:!0}})],kw.prototype,"operator",void 0),h([f({type:String,json:{write:!0}})],kw.prototype,"searchTerm",void 0),h([f({type:String,json:{write:!0}})],kw.prototype,"searchType",void 0),kw=h([I("esri.rest.support.FullTextSearch")],kw);const aet=kw;var TY;const Bce=new qi({upperLeft:"upper-left",lowerLeft:"lower-left"});let Uw=TY=class extends ye{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new TY(Q({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};h([f({type:gi,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Uw.prototype,"extent",void 0),h([f({type:["view","edit"],json:{write:!0}})],Uw.prototype,"mode",void 0),h([f({type:String,json:{read:Bce.read,write:Bce.write}})],Uw.prototype,"originPosition",void 0),h([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Uw.prototype,"tolerance",void 0),Uw=TY=h([I("esri.rest.support.QuantizationParameters")],Uw);const cet=Uw,uet=new qi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});var EY;const Gce=new qi({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let Ep=EY=class extends ye{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=Q(t))}clone(){return new EY({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:Q(this.statisticParameters)})}};h([f({type:Number,json:{write:!0}})],Ep.prototype,"maxPointCount",void 0),h([f({type:Number,json:{write:!0}})],Ep.prototype,"maxRecordCount",void 0),h([f({type:Number,json:{write:!0}})],Ep.prototype,"maxVertexCount",void 0),h([f({type:String,json:{write:!0}})],Ep.prototype,"onStatisticField",void 0),h([f({type:String,json:{write:!0}})],Ep.prototype,"outStatisticFieldName",void 0),h([f({type:String,json:{read:{source:"statisticType",reader:Gce.read},write:{target:"statisticType",writer:Gce.write}}})],Ep.prototype,"statisticType",void 0),h([f({type:Object})],Ep.prototype,"statisticParameters",void 0),h([Ve("statisticParameters")],Ep.prototype,"writeStatisticParameters",null),Ep=EY=h([I("esri.rest.support.StatisticDefinition")],Ep);const het=Ep;var v5;const det=new qi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Bt=v5=class extends ye{static from(t){return $S(v5,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const i={};for(const r in t){const s=t[r];Array.isArray(s)?i[r]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?i[r]=s.getTime():i[r]=s}e.parameterValues=i}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new v5(Q({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};Bt.MAX_MAX_RECORD_COUNT_FACTOR=5,h([f({json:{write:!0}})],Bt.prototype,"aggregateIds",void 0),h([f({type:Boolean,json:{write:!0}})],Bt.prototype,"cacheHint",void 0),h([f({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"compactGeometryEnabled",void 0),h([f({json:{write:!0}})],Bt.prototype,"datumTransformation",void 0),h([Li("datumTransformation")],Bt.prototype,"castDatumTransformation",null),h([f({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"defaultSpatialReferenceEnabled",void 0),h([f({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],Bt.prototype,"distance",void 0),h([f({type:Vp,json:{write:!0}})],Bt.prototype,"dynamicDataSource",void 0),h([f({type:String,json:{write:!0}})],Bt.prototype,"formatOf3DObjects",void 0),h([f({type:[aet],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],Bt.prototype,"fullText",void 0),h([f({type:String,json:{write:!0}})],Bt.prototype,"gdbVersion",void 0),h([f({types:fT,json:{read:C1,write:!0}})],Bt.prototype,"geometry",void 0),h([f({type:Number,json:{write:!0}})],Bt.prototype,"geometryPrecision",void 0),h([f({type:[String],json:{write:!0}})],Bt.prototype,"groupByFieldsForStatistics",void 0),h([f({type:String,json:{write:!0}})],Bt.prototype,"having",void 0),h([f({type:Date})],Bt.prototype,"historicMoment",void 0),h([Ve("historicMoment")],Bt.prototype,"writeHistoricMoment",null),h([f({type:Number,json:{write:!0}})],Bt.prototype,"maxAllowableOffset",void 0),h([f({type:Number,cast:t=>t<1?1:t>Bt.MAX_MAX_RECORD_COUNT_FACTOR?Bt.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],Bt.prototype,"maxRecordCountFactor",void 0),h([f({type:["xyFootprint"],json:{write:!0}})],Bt.prototype,"multipatchOption",void 0),h([f({type:Number,json:{read:{source:"resultRecordCount"}}})],Bt.prototype,"num",void 0),h([f({json:{write:!0}})],Bt.prototype,"objectIds",void 0),h([f({type:[String],json:{write:!0}})],Bt.prototype,"orderByFields",void 0),h([f({type:[String],json:{write:!0}})],Bt.prototype,"outFields",void 0),h([f({type:We,json:{name:"outSR",write:!0}})],Bt.prototype,"outSpatialReference",void 0),h([f({type:[het],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],Bt.prototype,"outStatistics",void 0),h([f({json:{write:!0}})],Bt.prototype,"parameterValues",void 0),h([Ve("parameterValues")],Bt.prototype,"writeParameterValues",null),h([f({type:_t,json:{write:!0}})],Bt.prototype,"pixelSize",void 0),h([f({type:cet,json:{write:!0}})],Bt.prototype,"quantizationParameters",void 0),h([f({type:[Object],json:{write:!0}})],Bt.prototype,"rangeValues",void 0),h([f({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Bt.prototype,"relationParameter",void 0),h([f({type:String,json:{write:!0}})],Bt.prototype,"resultType",void 0),h([f({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"returnCentroid",void 0),h([f({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"returnDistinctValues",void 0),h([f({type:Boolean,json:{default:!0,write:!0}})],Bt.prototype,"returnExceededLimitFeatures",void 0),h([f({type:Boolean,json:{write:!0}})],Bt.prototype,"returnGeometry",void 0),h([f({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"returnQueryGeometry",void 0),h([f({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"returnM",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Bt.prototype,"returnZ",void 0),h([f({type:We,json:{write:!0}})],Bt.prototype,"sourceSpatialReference",void 0),h([ct(uet,{ignoreUnknown:!1,name:"spatialRel"})],Bt.prototype,"spatialRelationship",void 0),h([f({type:Number,json:{read:{source:"resultOffset"}}})],Bt.prototype,"start",void 0),h([Ve("start"),Ve("num")],Bt.prototype,"writeStart",null),h([f({type:String,json:{write:!0}})],Bt.prototype,"sqlFormat",void 0),h([f({type:String,json:{write:!0}})],Bt.prototype,"text",void 0),h([f({type:Sg,json:{write:!0}})],Bt.prototype,"timeExtent",void 0),h([f({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"timeReferenceUnknownClient",void 0),h([ct(det,{ignoreUnknown:!1}),f({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],Bt.prototype,"units",void 0),h([f({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],Bt.prototype,"where",void 0),h([Ve("where")],Bt.prototype,"writeWhere",null),Bt=v5=h([I("esri.rest.support.Query")],Bt);const Pf=Bt;function XD(t){return!!(t!=null&&typeof t=="object"&&"createQuery"in t&&t.createQuery&&"on"in t&&t.on)}let xy=class extends cn.EventedAccessor{constructor(e){super(e),this._selectionMap=new y5,this._sources=new tt,this._trashCan=[],this._layerEditHandles=new tt,this._vizTaskId=0,this.showHighlight=!0}initialize(){this.addHandles([ue(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),Ta(()=>this.sources,"change",i=>{const r=this._selectionMap;for(const s of i.removed)r.delete(s);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);const e=new tt;this.view.when().then(()=>{this.view.map&&(this.view.map.allLayers.flatten(i=>"sublayers"in i&&i.sublayers?i.sublayers:null).forEach(i=>{(XD(i)&&!L7e(i)||bw(i))&&e.add(i)}),this.sources=e)})}destroy(){this._layerEditHandles.drain(Or)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{const[i,r]=e;return{layer:i,selection:[...r.selection]}})}get count(){let e=0;for(const i of this._selectionMap.values())e+=i.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){O1(e,this._sources)}async getSelectedFeatures(e,i={},r="layerView"){const{view:s,selections:n}=this,o=(e!==void 0?n.filter(a=>e.includes(a.layer)):n).filter(a=>a.selection.length>0).map(async a=>{const{layer:l,selection:c}=a,u=bw(l)?l.parent:l;if(u==null||!Hce(u))return null;if(r==="layer")return qce(u,c,i);if(jce(u))return null;const d=await s.whenLayerView(u).catch(()=>null);return d?qce(d,c,i):null});return(await Promise.all(o)).filter(a=>a!=null)}updateSelection(e){const i=new Map;for(const[n,o]of this._selectionMap)i.set(n,[...o.selection]);let r=!1;const s=e.current.concat(e.added);for(const n of s){const o=n.sourceLayer,a=n.getObjectId();if(this.sources.includes(o)&&(XD(o)||bw(o))&&a!==null){const l=V3(i,o,()=>[]);l.includes(a)||(l.push(a),r=!0)}}for(const n of e.removed){const o=n.sourceLayer,a=n.getObjectId();if(this.sources.includes(o)&&(XD(o)||bw(o))&&a!==null){const l=i.get(o),c=l==null?void 0:l.indexOf(a);c!==void 0&&c>=0&&(l==null||l.splice(c,1),r=!0)}}if(r){const{_selectionMap:n,_trashCan:o}=this,a=[];for(const[l,c]of i){const u=n.get(l);u!==void 0&&o.push(u),n.set(l,{selection:c}),a.push({layer:l,selection:c,...x9(u!==void 0?u.selection:[],c)})}this._onSelectionChange(a)}}setSelection(e,i){this._setSelection(e,i)}getSelection(e){const i=this._selectionMap.get(e);return i==null?void 0:i.selection}appendToSelection(e,i){const r=this._selectionMap.get(e),s=r!==void 0?[...r.selection]:[];for(const n of i)s.includes(n)||s.push(n);this._setSelection(e,s)}removeFromSelection(e,i){const r=this._selectionMap.get(e);if(!r)return;const s=[];for(const n of r.selection)i.includes(n)||s.push(n);this._setSelection(e,s)}toggleInSelection(e,i){const r=this._selectionMap.get(e);if(!r||r.selection.length===0)return void this._setSelection(e,i);const s=new Set(r.selection),n=new Set(i),o=Xze(s,n);this._setSelection(e,Array.from(o))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const i=[];for(const[r,s]of this._selectionMap.entries())i.push({layer:r,added:[],removed:[...s.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(i)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){var o;if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;){const a=this._trashCan.pop();(o=a==null?void 0:a.highlightHandle)==null||o.remove()}const{sources:e,view:i,_selectionMap:r,showHighlight:s}=this,n=this._vizTaskId;for(const a of e){const l=r.get(a),c=bw(a)?a.parent:a;if(c!=null&&Hce(c)){if(jce(c))continue;i.whenLayerView(c).then(u=>{var d;(d=l==null?void 0:l.highlightHandle)==null||d.remove(),l!=null&&s&&n===this._vizTaskId&&"highlight"in u&&typeof u.highlight=="function"&&l.selection.length>0&&(l.highlightHandle=u.highlight(l.selection,"selection"))}).catch(()=>{var u;(u=l==null?void 0:l.highlightHandle)==null||u.remove()})}}}_refreshListeners(){this._layerEditHandles.drain(Or);for(const e of this.sources){const i=bw(e)?e.parent:e;if(i!=null&&XD(i)){const r=i.on("edits",s=>{this._handleEditChanges(s,e)});this._layerEditHandles.push(r)}}}_handleEditChanges(e,i){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(i)){const r=e.deletedFeatures.filter(s=>s.error==null).map(s=>s.objectId).filter(K1);this.removeFromSelection(i,r)}}_setSelection(e,i){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const r=this._selectionMap.get(e);if(r===void 0||!fet(r,{selection:i})){r!==void 0&&this._trashCan.push(r),this._selectionMap.set(e,{selection:[...i]});const s={layer:e,selection:[...i],...x9(r!==void 0?r.selection:[],i)};this._onSelectionChange([s])}}};h([f({readOnly:!0,nonNullable:!0})],xy.prototype,"selections",null),h([f({readOnly:!0,nonNullable:!0})],xy.prototype,"count",null),h([f({constructOnly:!0,nonNullable:!0})],xy.prototype,"view",void 0),h([f({readOnly:!0,nonNullable:!0})],xy.prototype,"hasSelection",null),h([f()],xy.prototype,"showHighlight",void 0),h([f()],xy.prototype,"sources",null),xy=h([I("esri.views.SelectionManager")],xy);const jce=t=>{var e;return bw(t)?((e=t.parent)==null?void 0:e.isTable)===!0:t.isTable},pet=t=>t.layer!==void 0,Hce=t=>(t==null?void 0:t.when)!==void 0,fet=(t,e)=>{if(t==null&&e==null)return!0;if(t!=null&&e==null||t==null&&e!=null)return!1;if(t!=null&&e!=null&&t.selection!=null&&e.selection!=null){const i=[...t.selection],r=[...e.selection];if(i.length!==r.length)return!1;i.sort(),r.sort();for(let s=0;s<i.length;s++)if(i[s]!==r[s])return!1}return!0},qce=async(t,e,i={})=>{let r;if(pet(t)){const s=t;r=s===void 0?null:await s.queryFeatures(new Pf({...i,objectIds:e})).then(n=>({data:n,layer:t.layer}))}else{const s=t;r=s===void 0?null:await s.queryFeatures(new Pf({...i,objectIds:e})).then(n=>({data:n,layer:s}))}return r},met=xy;let rR=class extends Kr(Re){constructor(e){super(e),this.accentColor=new Oe([255,127,0]),this.textColor=new Oe([255,255,255])}};h([f({type:Oe,nonNullable:!0})],rR.prototype,"accentColor",void 0),h([f({type:Oe,nonNullable:!0})],rR.prototype,"textColor",void 0),rR=h([I("esri.views.Theme")],rR);const CY=rR;var Wce;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(Wce||(Wce={}));const DCe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],NCe={};function FCe(t){return!!NCe[t]}function get(t){for(const e of t)if(!FCe(e))return!1;return!0}DCe.forEach(t=>{NCe[t]=!0});let yet=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:r},s)=>{var n;return(n=this.inputManager)==null?void 0:n.installHandlers(s,[i],r)})}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>{var r;return(r=this.inputManager)==null?void 0:r.uninstallHandlers(i)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,r,s){const n=Array.isArray(e)?e:e.split(",");if(!get(n))return n.some(FCe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:s=r,s=s??a1.DEFAULT;const l=this._createUniqueGroupName(),c=new _et(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const u of n){const d=this._handlerCounts.get(u)||0;this._handlerCounts.set(u,d+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),Ni(()=>this._removeHandler(l,n))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const r of i){const s=this._handlerCounts.get(r);s===void 0||(s===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,s-1))}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},_et=class extends na{constructor(e,i,r,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,o=>s(wet(e,o)));break;case"double-click":this.registerIncoming("double-click",r,o=>s(xet(e,o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>s(Tet(e,o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>s(Eet(e,o)));break;case"hold":this.registerIncoming("hold",r,o=>s(Cet(e,o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>s(Met(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>s(Aet(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>s(NP(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>s(NP(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>s(NP(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>s(Pet(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>s(Oet(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>s(NP(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>s(NP(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{s(Ret(o))});break;case"focus":this.registerIncoming("focus",r,o=>{s(vet(o))});break;case"blur":this.registerIncoming("blur",r,o=>{s(bet(o))})}}_wrapDrag(e){const i=e.data,{x:r,y:s}=i.center,{action:n,pointerType:o,button:a}=i;if(n==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:u,timestamp:d}=e,p={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:p,pointerType:o,button:a,buttons:c,radius:i.radius,angle:Ma(i.angle),native:l,timestamp:d,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}};function vet(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function bet(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function wet(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:u,screenPoint:Bd(n,o),mapPoint:fL(t,n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}function xet(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:u,mapPoint:fL(t,n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}function Tet(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:d}=e;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:fL(t,n,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}function Eet(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:d}=e;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:fL(t,n,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}function Cet(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:fL(t,n,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}function fL(t,e,i){return t.toMap(Bd(e,i),{exclude:[]})}function Met(t){const{key:e,repeat:i,native:r}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-down",key:e,repeat:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}function Aet(t){const{key:e,native:i}=t.data,{cancelable:r,timestamp:s}=t;return{type:"key-up",key:e,native:i,timestamp:s,cancelable:r,stopPropagation:()=>t.stopPropagation(),async:n=>t.async(n),preventDefault:()=>t.preventDefault()}}function NP(t,e){const{x:i,y:r,button:s,buttons:n,native:o,eventId:a}=t.data,l=o.pointerId,c=o.pointerType,{cancelable:u,timestamp:d}=t;return{type:e,x:i,y:r,pointerId:l,pointerType:c,button:s,buttons:n,native:o,timestamp:d,eventId:a,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}function Pet(t){const{x:e,y:i,buttons:r,native:s,eventId:n}=t.data.currentEvent,{button:o}=t.data.startEvent,a=t.data.startEvent.native.pointerId,l=t.data.startEvent.native.pointerType,c=t.data.action,u={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:d,timestamp:p}=t;return{type:"pointer-drag",x:e,y:i,pointerId:a,pointerType:l,button:o,buttons:r,action:c,origin:u,native:s,timestamp:p,eventId:n,cancelable:d,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}function Oet(t){const{cancelable:e,data:i,timestamp:r}=t,{x:s,y:n,deltaY:o,native:a}=i;return{type:"mouse-wheel",x:s,y:n,deltaY:o,native:a,timestamp:r,cancelable:e,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}function Ret(t){const{action:e,state:i,device:r}=t.data,{cancelable:s,timestamp:n}=t,{buttons:o,axes:a}=i;return{type:"gamepad",device:r,timestamp:n,action:e,buttons:o,axes:a,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}var e3,Yce,Zce;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(e3||(e3={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(Yce||(Yce={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(Zce||(Zce={}));function $et(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return ie.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function MY(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(e3.USER)&&t.getEditableFlag(e3.MANAGER)}function xm(t){return Bd(t.x,t.y)}function Pjt(t){return vs(t.x,t.y)}function kCe(t,e){var r;const i=(r=t instanceof HTMLElement?t:t.surface)==null?void 0:r.getBoundingClientRect();return i?Bd(e.clientX-i.left,e.clientY-i.top):Bd(0,0)}function Xce(t,e){return e instanceof Event?kCe(t,e):xm(e)}function Jce(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let Iet=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,i){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":Kce(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!eue(e))break;const s=xm(e),n=ZT(s,e.pointerType,i.forEachTool);if(n==null)break;const o=n.manipulator,a=n.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._releaseManipulatorBeforeDragging(o,e,i),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!eue(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=s==null?void 0:s.manipulator,o=s==null?void 0:s.tool;if(n==null||o==null)break;const a=xm(e);a.x=Te(a.x,0,i.view.width),a.y=Te(a.y,0,i.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}r();break}case"immediate-click":{const s=xm(e),n=ZT(s,e.pointerType,i.forEachTool);if(Let(e)||i.forEachTool(c=>{if((n==null||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let u=!1;c.manipulators.forEach(({manipulator:d})=>{d.selected&&(d.selected=!1,u=!0)}),u&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),n==null)break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:r}),U6(o,r);break}case"click":{const s=xm(e),n=ZT(s,e.pointerType,i.forEachTool),o=n==null?void 0:n.manipulator;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a}),r();break}case"double-click":{const s=xm(e),n=ZT(s,e.pointerType,i.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),U6(o,r);break}case"immediate-double-click":{const s=xm(e),n=ZT(s,e.pointerType,i.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),U6(o,r);break}}this._onFocusChange(i.forEachTool)}_releaseManipulatorBeforeDragging(e,i,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:xm(i)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorRelease(r.setActiveTool)}_handlePointerEnd(e,i){var s;const r=(s=this._grabbedManipulators.get(e.pointerId))==null?void 0:s.manipulator;r!=null&&r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:xm(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(i.setActiveTool))}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=Qce(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=Qce(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:s})=>{i.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{r.add(s)}),e(s=>{s.hasGrabbedManipulators=i.has(s),s.hasHoveredManipulators=r.has(s);const n=this._grabbedManipulators.values(),o=NUe(n,({tool:a})=>a===s);s.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:i,setActiveTool:r},s=!0,n){const o=(a,l)=>a===e&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},u)=>{o(a,l)&&(this._grabbedManipulators.delete(u),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorRelease(r),this._onFocusChange(i)}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(Bd(i.x,i.y),r,i.pointerType,e)})}handleHoverEvent(e,i){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!Kce(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(xm(e),e.pointerId,e.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(e,i,r,s){var a;let n=ZT(e,r,s);const o=(a=this._hoveredManipulators.get(i))==null?void 0:a.manipulator;n==null||n.manipulator.interactive||(n=null),n!=null&&o===n.manipulator||(o!=null&&(o.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(i,n)):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_afterManipulatorRelease(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function Qce(t){let e=null;return mh(t,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(e=i.grabCursor,!0):!!i.cursor&&(e=i.cursor,!0))),e}function ZT(t,e,i){let r=null;return i(s=>{if(s.manipulators==null||!MY(s))return!1;const n=s.manipulators.intersect(t,e);return n!=null&&(r={tool:s,manipulator:n},!0)}),r}function Kce(t){return t==="mouse"}function eue(t){return t.pointerType!=="mouse"||t.button===0}function Let(t){return!!t.native.shiftKey}function U6(t,e){t!=null&&t.consumesClicks&&e()}const tue="attached",z6="tools",Det=1e3;let Sm=class extends Re{constructor(e){super(e),this._updatingHandles=new u0,this._clock=z3,this._manipulatorState=new Iet,this.tools=new tt,this.cursor=null,this._interacting=!1,this._interactingTimeout=Det,this._interactingTimeoutHandle=null,this._forEachTool=i=>{for(const r of this.tools.items)if(i(r))return}}initialize(){this.addHandles([this.view.on(DCe,e=>{this._handleInputEvent(e)},a1.TOOL),...$et(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void ie.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),i!=null&&i.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const s=MY(r);this.activeTool!=null&&s||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=Or(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){var e;this.view.type==="3d"?this.addHandles([ue(()=>{const{state:i}=this.view;return"camera"in i&&i.camera},()=>this._forEachManipulator(i=>i.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",i=>this._forEachManipulator(r=>r.onElevationChange(i)))],tue):this.addHandles(ue(()=>this.view.extent,()=>this._forEachManipulator(i=>i.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(tue),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(i=>{i.manipulators&&i.manipulators.forEach(({manipulator:r})=>e(r,i))})}_handleInputEvent(e){let i=!1;const r={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(s=>{!i&&s.visible&&s.handleInputEvent(r)}),!i&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),i||this.activeTool==null||this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(z6),this._forEachTool(e=>{if(e instanceof Re){const i=ue(()=>[e.cursor,e.visible,e.editable],()=>{MY(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(i,z6)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],z6)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var i;(i=e.setEditableFlag)==null||i.call(e,e3.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(i=>!(i.cursor==null||!i.visible)&&(e=i.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(i=>(e==null||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}get test(){}};h([f({constructOnly:!0,nonNullable:!0})],Sm.prototype,"view",void 0),h([f({value:null})],Sm.prototype,"activeTool",null),h([f({readOnly:!0,type:tt})],Sm.prototype,"tools",void 0),h([f({readOnly:!0})],Sm.prototype,"cursor",void 0),h([f({readOnly:!0})],Sm.prototype,"updating",null),h([f()],Sm.prototype,"_interacting",void 0),h([f({readOnly:!0})],Sm.prototype,"interacting",null),Sm=h([I("esri.views.ToolViewManager")],Sm);let hE=class extends Re{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Net.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Fet[this.deviceType]}};h([f({nonNullable:!0,readOnly:!0})],hE.prototype,"nativeIndex",void 0),h([f({type:String,readOnly:!0})],hE.prototype,"deviceType",null),h([f({type:Number,readOnly:!0})],hE.prototype,"axisThreshold",null),hE=h([I("esri.views.input.gamepad.GamepadInputDevice")],hE);const eie=hE,Net=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Fet={standard:.15,spacemouse:.025,unknown:0};let sR=class extends Re{constructor(...e){super(...e),this.devices=new tt,this.enabledFocusMode="document"}};h([f({type:tt.ofType(eie),readOnly:!0})],sR.prototype,"devices",void 0),h([f({type:["document","view","none"]})],sR.prototype,"enabledFocusMode",void 0),sR=h([I("esri.views.input.gamepad.GamepadSettings")],sR);const ket=sR;let b5=class extends Re{constructor(){super(...arguments),this.gamepad=new ket}};h([f({readOnly:!0})],b5.prototype,"gamepad",void 0),b5=h([I("esri.views.input.Input")],b5);const Uet=b5,zet=()=>lr.respectPrefersReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;let iv=class extends Re{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};h([f({type:Boolean,nonNullable:!0})],iv.prototype,"enabled",void 0),h([f({type:eie})],iv.prototype,"device",void 0),h([f({type:["pan","zoom"],nonNullable:!0})],iv.prototype,"mode",void 0),h([f({type:["forward-down","forward-up"],nonNullable:!0})],iv.prototype,"tiltDirection",void 0),h([f({type:Number,nonNullable:!0})],iv.prototype,"velocityFactor",void 0),iv=h([I("esri.views.navigation.gamepad.GamepadSettings")],iv);const UCe=iv;let zw=class extends Re{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new UCe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}get effectiveMomentumEnabled(){return this.momentumEnabled&&!zet()}};h([f({type:Boolean})],zw.prototype,"browserTouchPanEnabled",void 0),h([f({type:UCe,nonNullable:!0})],zw.prototype,"gamepad",void 0),h([f({type:Boolean})],zw.prototype,"momentumEnabled",void 0),h([f({type:Boolean})],zw.prototype,"mouseWheelZoomEnabled",void 0),zw=h([I("esri.views.navigation.Navigation")],zw);const zCe=zw,VCe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},BCe=Object.values(VCe),GCe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${BCe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Vet=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${BCe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Bet=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function Fjt(t){return GCe.test(t)}function B0(t){if(t==null)return null;const e=Ns(t),i=(e==null?void 0:e.path.match(GCe))||(e==null?void 0:e.path.match(Vet));if(!i)return null;const[,r,s,n,o]=i,a=s.indexOf("/");return{title:pG(a!==-1?s.slice(a+1):s),serverType:VCe[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function Get(t){const e=Ns(t).path.match(Bet);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function pG(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function jCe(t,e){const i=[];if(t){const r=B0(t);r!=null&&r.title&&i.push(r.title)}if(e){const r=pG(e);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function HCe(t){let e=Dd(t,!0);return!!e&&(e=e.toLowerCase(),e.endsWith(".arcgis.com")&&(e.startsWith("services")||e.startsWith("tiles")||e.startsWith("features")))}function jet(t,e){return t&&lB(Ibe(t,e))}function qCe(t){let{url:e}=t;if(!e)return{url:e};e=Ibe(e,t.logger);const i=Ns(e),r=B0(i.path);let s;if(r!=null)r.sublayer!=null&&t.layer.layerId==null&&(s=r.sublayer),e=r.url.path;else if(t.nonStandardUrlAllowed){const n=Get(i.path);n!=null&&(e=n.serviceUrl,s=n.sublayerId)}return{url:lB(e),layerId:s}}function WCe(t,e,i,r,s){U1(e,r,"url",s),r.url&&t.layerId!=null&&(r.url=zl(r.url,i,t.layerId.toString()))}function kjt(t){if(!t)return!1;const e=t.toLowerCase(),i=e.includes("/services/"),r=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return i&&(r||s||n)}function Ujt(t,e,i){const r=YCe(t),s=e,n=Het(r,s,i);if(r){const o=gT.deriveUnitFromSR(r,t.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new V("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new V("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!qet(t)||n===Zc.Unsupported)return new V("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case Zc.Units:{const o=(r==null?void 0:r.heightUnit)||"unknown",a=(s==null?void 0:s.heightUnit)||"unknown",l=new V("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new V("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Zc.HeightModel:{const o=(r==null?void 0:r.heightModel)||"unknown",a=(s==null?void 0:s.heightModel)||"unknown",l=new V("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new V("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Zc.CRS:{const o=(r==null?void 0:r.vertCRS)||"unknown",a=(s==null?void 0:s.vertCRS)||"unknown",l=new V("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new V("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function Het(t,e,i){if(!iue(t)||!iue(e))return Zc.Unsupported;if(t==null||e==null)return Zc.Ok;if(!i&&t.heightUnit!==e.heightUnit)return Zc.Units;if(t.heightModel!==e.heightModel)return Zc.HeightModel;switch(t.heightModel){case"gravity-related-height":return Zc.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?Zc.Ok:Zc.CRS;default:return Zc.Unsupported}}var Zc;function iue(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function qet(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!JCe(t)}function YCe(t){var r;if(t.type==="integrated-mesh-3dtiles")return null;const e=t.url?B0(t.url):void 0;return!(((r=t.spatialReference)==null?void 0:r.vcsWkid)==null&&e!=null&&e.serverType==="ImageServer")&&ZCe(t)&&t.heightModelInfo?t.heightModelInfo:JCe(t)?gT.deriveUnitFromSR(Yet,t.spatialReference):null}function ZCe(t){return"heightModelInfo"in t}function XCe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function JCe(t){return XCe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):QCe(t)}function Wet(t){return t.layers!=null||QCe(t)||XCe(t)||ZCe(t)}function QCe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(Zc||(Zc={}));const Yet=new gT({heightModel:"gravity-related-height"});let AY,V6=null;async function Zet(t){V6||(V6=fe(()=>Promise.resolve().then(()=>DEt),void 0).then(e=>AY=e)),await V6,Et(t)}async function KCe(t,e,i,r){if(!t)return null;const s=t.spatialReference;return kA()||Ac(s,e)?ib(t,e):AY?AY.projectGeometry(t,e,i,r):(await Promise.race([Zet(r),FM(r)]),KCe(t,e,i,r))}let os=class extends Re{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Ul(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var r,s,n,o;const e=(r=this.map)==null?void 0:r.call(this),i=[];return this.priorityCollection!=null&&i.push(this.priorityCollection),i.push({parent:e==null?void 0:e.basemap,layers:(s=e==null?void 0:e.basemap)==null?void 0:s.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(n=e==null?void 0:e.ground)==null?void 0:n.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),i}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;let r=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(r,o);a!=null&&(r=a)}if(r!=null&&r.length===1)break}if(i&&(r==null||r.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(r);return{spatialReference:(s==null?void 0:s.spatialReference)??null,viewingMode:(s==null?void 0:s.viewingMode)??null,updating:!1}}get _tileInfoTask(){var r,s,n,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:i}=this._collectLayers([{parent:(s=(r=this.map)==null?void 0:r.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const u=e[0].tileInfo;return{tileInfo:u!=null&&u.spatialReference.equals(this.spatialReference)?u:null,updating:!1}}return{updating:i}}get _heightModelInfoTask(){var r,s,n;if(!this.required.heightModelInfo||this.suspended&&((r=this._get("_heightModelInfoTask"))!=null&&r.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;for(const o of e)if(Wet(o)){const a=YCe(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,i=e.updating,r=[];for(const s of e.layers){const n="fullExtents"in s&&s.fullExtents||(s.fullExtent!=null?[s.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:n[0],a=n.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const l of n)r.push({extent:l,layer:s})}return{candidates:r,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),s=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=Ul(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:s.clone(),task:Nf(async n=>{try{const o=await KCe(r.extent,s,"portalItem"in r.layer?r.layer.portalItem:void 0,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(Yn(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(e==null)return i;const r=new Array;for(const s of e)for(const n of i){if(!s.spatialReference.equals(n.spatialReference))continue;const o=Jet(s.viewingMode,n.viewingMode);if(o!==!1){r.push({spatialReference:s.spatialReference,viewingMode:o});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return e==null||e.length<1?i?{spatialReference:i,viewingMode:null}:null:(i!=null&&e.length>1&&e.some(({spatialReference:r})=>r.equals(i))&&(e=e.filter(({spatialReference:r})=>r.equals(i))),e.length>1&&e.some(({viewingMode:r})=>r!==Ge.Local)&&(e=e.filter(({viewingMode:r})=>r!==Ge.Local)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const r=[];for(const s of i){const n=this.getSpatialReferenceSupport(s,e);if(n!=null){const o=n.constraints??[{spatialReference:s,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||r.push({spatialReference:a,viewingMode:l})}}return r}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:r})=>i.equals(r.spatialReference))||e[0]}_collectLayers(e){var r;if(this._loadMaybe((r=this.map)==null?void 0:r.call(this))!=="loaded")return{layers:[],updating:!0};const i=new Xet;for(const s of e)if(this._collectCollection(s,i),i.preloading===this.sourcePreloadCount)break;return{layers:i.layers,updating:i.updating}}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":i.updating||i.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},i)}if(i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(i=>{ms(i)||console.log(i)}),"loading"):e.loadStatus:"loaded"}};h([f()],os.prototype,"required",void 0),h([f({constructOnly:!0})],os.prototype,"map",void 0),h([f({constructOnly:!0})],os.prototype,"getSpatialReferenceSupport",void 0),h([f()],os.prototype,"defaultSpatialReference",void 0),h([f()],os.prototype,"userSpatialReference",void 0),h([f()],os.prototype,"sourcePreloadCount",void 0),h([f()],os.prototype,"priorityCollection",void 0),h([f()],os.prototype,"requiresExtentInSpatialReference",void 0),h([f()],os.prototype,"suspended",void 0),h([f({readOnly:!0})],os.prototype,"ready",null),h([f({readOnly:!0})],os.prototype,"heightModelInfoReady",null),h([f({readOnly:!0})],os.prototype,"spatialReference",null),h([f({readOnly:!0})],os.prototype,"extent",null),h([f({readOnly:!0})],os.prototype,"heightModelInfo",null),h([f({readOnly:!0})],os.prototype,"vcsWkid",null),h([f({readOnly:!0})],os.prototype,"latestVcsWkid",null),h([f({readOnly:!0})],os.prototype,"viewingMode",null),h([f({readOnly:!0})],os.prototype,"tileInfo",null),h([f({readOnly:!0})],os.prototype,"mapCollections",null),h([f({readOnly:!0})],os.prototype,"_allLayers",null),h([f({readOnly:!0})],os.prototype,"_spatialReferenceTask",null),h([f({readOnly:!0})],os.prototype,"_tileInfoTask",null),h([f({readOnly:!0})],os.prototype,"_heightModelInfoTask",null),h([f({readOnly:!0})],os.prototype,"_extentCandidatesTask",null),h([f()],os.prototype,"_extentTask",null),h([f()],os.prototype,"_projectExtentTask",void 0),os=h([I("esri.views.support.DefaultsFromMap")],os);let Xet=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};function Jet(t,e){return t!=null?e!=null?t===e&&t:t:e}var nR;let Lt=nR=class extends cn.EventedMixin(BA(Re)){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.handles=new Pg,this.updatingHandles=new u0,this.allLayerViews=new ZM({getCollections:()=>{var e,i,r;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:Ket}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new wS,this.analyses=new GM,this.typeSpecificPreconditionsReady=!0,this.layerViews=new tt,this.magnifier=new OCe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Uet,this.navigation=new zCe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new yet(this),this.persistableViewModels=new tt,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add(ue(()=>this.preconditionsReady,e=>{var r,s;const i=this.ready;if(e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,nR.views.add(this)):(this._lockedSpatialReference=null,nR.views.remove(this)),this.notifyChange("spatialReference"),!e&&i)(r=this.toolViewManager)==null||r.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(s=this.layerViewManager)==null||s.clear(),this._teardown();else if(e&&!i){try{this._startup()}catch(n){return void queueMicrotask(()=>{this.fatalError=new V("startup-error",null,n)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},ar))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,zI(()=>this.ready)))),this.basemapView=new tv({view:this}),this.layerViewManager=new eet({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new Sm({view:this}),this._setupSpatialReferenceLogger(),this.selectionManager=new met({view:this}),this.addHandles([ue(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},sr),ue(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},ar),ue(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},sr)])}_setupSpatialReferenceLogger(){let t=null;this.addHandles([ue(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var r;const i=((r=this.map)==null?void 0:r.allLayers.length)>0;if(e&&!this.spatialReference&&i){if(t!=null)return;const s=Ni(()=>t=Ul(t));t=Nf(async n=>{try{await RI(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{t=null}ie.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(s,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){var t,e;this.destroyed||(nR.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Le(this.graphics),this.analyses=Le(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Le(this.analysisViewManager),this.toolViewManager=Le(this.toolViewManager),this.layerViewManager=Le(this.layerViewManager),this.selectionManager=Le(this.selectionManager),this.basemapView=Le(this.basemapView),(t=this.groundView)==null||t.destroy(),(e=this.layerViews)==null||e.forEach(i=>i.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=Le(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return ie.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new os({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(t,e)=>this.getSpatialReferenceSupport(t,e),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Mf.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(ie.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),Mf.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",t))}get spatialReference(){var e,i;const t=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(t&&((i=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&i.heightModelInfo)){const r=t.clone();return r.vcsWkid=this.defaultsFromMap.vcsWkid,r.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,r}return t}set spatialReference(t){const e=!gs(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??xg}set timeZone(t){const e=new Set(["etc/utc","etc/gmt","gmt"]),i=new Set(Intl.supportedValuesOf("timeZone").map(r=>r.toLowerCase()));this._userTimeZone=t,t===xg||t===GS||e.has(t.toLowerCase())||i.has(t.toLowerCase())||ie.getLogger(this).warn("#timeZone",`the parsed value '${t}' may not be a valid IANA time zone`)}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){var t;return((t=this.toolViewManager)==null?void 0:t.cursor)??this._cursor??"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new CY}whenLayerView(t){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(t))??Promise.reject()}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}getDefaultTimeZone(){return null}importLayerView(t){throw new V("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport(t)!=null}when(t,e){return this.isResolved()&&!this.ready&&ie.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(vu(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};Lt.views=new tt,h([f()],Lt.prototype,"_userSpatialReference",void 0),h([f()],Lt.prototype,"activeTool",null),h([f({readOnly:!0})],Lt.prototype,"allLayerViews",void 0),h([f()],Lt.prototype,"groundView",void 0),h([f()],Lt.prototype,"animation",null),h([f()],Lt.prototype,"basemapView",void 0),h([f()],Lt.prototype,"center",null),h([f({readOnly:!0})],Lt.prototype,"_defaultsFromMapSettings",null),h([f()],Lt.prototype,"defaultsFromMap",null),h([f()],Lt.prototype,"fatalError",void 0),h([f({type:gi})],Lt.prototype,"extent",null),h([f(BU(wS,"graphics"))],Lt.prototype,"graphics",void 0),h([f(BU(GM,"analyses"))],Lt.prototype,"analyses",void 0),h([f({readOnly:!0,type:gT})],Lt.prototype,"heightModelInfo",null),h([f({readOnly:!0})],Lt.prototype,"interacting",null),h([f({readOnly:!0})],Lt.prototype,"navigating",null),h([f({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Lt.prototype,"preconditionsReady",null),h([f({readOnly:!0})],Lt.prototype,"typeSpecificPreconditionsReady",void 0),h([f({type:tt,readOnly:!0})],Lt.prototype,"layerViews",void 0),h([f()],Lt.prototype,"resolution",null),h([f({type:OCe})],Lt.prototype,"magnifier",void 0),h([f({value:null,type:TEe})],Lt.prototype,"map",null),h([f()],Lt.prototype,"padding",void 0),h([f({readOnly:!0})],Lt.prototype,"ready",void 0),h([f({type:We})],Lt.prototype,"spatialReference",null),h([f()],Lt.prototype,"spatialReferenceWarningDelay",void 0),h([f()],Lt.prototype,"stationary",null),h([f({readOnly:!0})],Lt.prototype,"supportsGround",void 0),h([f({type:Sg})],Lt.prototype,"timeExtent",void 0),h([f({type:String,nonNullable:!0})],Lt.prototype,"timeZone",null),h([f()],Lt.prototype,"tools",null),h([f()],Lt.prototype,"toolViewManager",void 0),h([f({readOnly:!0})],Lt.prototype,"type",void 0),h([f({type:Number})],Lt.prototype,"scale",void 0),h([f({readOnly:!0})],Lt.prototype,"updating",void 0),h([f({readOnly:!0})],Lt.prototype,"initialExtentRequired",void 0),h([f({readOnly:!0})],Lt.prototype,"initialExtent",null),h([f()],Lt.prototype,"cursor",null),h([f({readOnly:!0})],Lt.prototype,"input",void 0),h([f({type:zCe,nonNullable:!0})],Lt.prototype,"navigation",void 0),h([f()],Lt.prototype,"layerViewManager",void 0),h([f()],Lt.prototype,"analysisViewManager",void 0),h([f()],Lt.prototype,"selectionManager",void 0),h([f()],Lt.prototype,"width",void 0),h([f()],Lt.prototype,"height",void 0),h([f({readOnly:!0})],Lt.prototype,"resizing",void 0),h([f({value:null,readOnly:!0})],Lt.prototype,"size",null),h([f({readOnly:!0})],Lt.prototype,"suspended",void 0),h([f({readOnly:!0})],Lt.prototype,"viewEvents",void 0),h([f({readOnly:!0})],Lt.prototype,"persistableViewModels",void 0),h([f()],Lt.prototype,"_isValid",void 0),h([f()],Lt.prototype,"_readyCycleForced",void 0),h([f()],Lt.prototype,"_lockedSpatialReference",void 0),h([f()],Lt.prototype,"_userTimeZone",void 0),h([f()],Lt.prototype,"_lockedTimeZone",void 0),h([f({type:CY})],Lt.prototype,"theme",void 0),h([f({readOnly:!0,type:CY})],Lt.prototype,"effectiveTheme",null),Lt=nR=h([I("esri.views.View")],Lt);const Qet=Lt;function Ket(t){return t.layerViews}let rv=class extends az{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=ra(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new V("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,i){i||(i=Cu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}};h([f({readOnly:!0})],rv.prototype,"done",null),h([f({readOnly:!0,type:String})],rv.prototype,"state",void 0),h([f()],rv.prototype,"target",void 0),rv=h([I("esri.views.ViewAnimation")],rv),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(rv||(rv={}));const QM=rv,FP=()=>fe(()=>import("./TileLayerView3D-DBqd0-x9.js"),__vite__mapDeps([79,80,81,82,83,84,85,86,87,18,19,88])),rue=()=>fe(()=>import("./ElevationLayerView3D-D1sLYglQ.js"),__vite__mapDeps([89,70,71,80,81,83])),sue={"base-dynamic":()=>fe(()=>import("./BaseDynamicLayerView3D-C-4MVQSg.js"),__vite__mapDeps([90,91,80,92,93,83,84])),"base-elevation":rue,"base-tile":FP,"bing-maps":FP,"building-scene":()=>fe(()=>import("./BuildingSceneLayerView3D-BTDdhoKT.js"),__vite__mapDeps([94,20,21,95,96,97,98,56,68,99,100,101,29,102,103,104,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84,112,113,114,55,115,116,117])),catalog:()=>fe(()=>import("./CatalogLayerView3D-CFRcPQkn.js"),__vite__mapDeps([118,80,83])),"catalog-dynamic-group":()=>fe(()=>import("./CatalogDynamicGroupLayerView3D-CFdpYWGY.js"),__vite__mapDeps([119,80,83])),"catalog-footprint":()=>fe(()=>import("./CatalogFootprintLayerView3D-DiHYMiCr.js"),__vite__mapDeps([120,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,20,21,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84])),csv:()=>fe(()=>import("./CSVLayerView3D-Blz5Q_4l.js"),__vite__mapDeps([121,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,20,21,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84])),dimension:()=>fe(()=>import("./DimensionLayerView3D-Bb5y5ULe.js"),__vite__mapDeps([122,80,83])),elevation:rue,feature:()=>fe(()=>import("./FeatureLayerView3D-hK0V7mGf.js"),__vite__mapDeps([104,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,20,21,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84])),geojson:()=>fe(()=>import("./GeoJSONLayerView3D-D7xjLwGC.js"),__vite__mapDeps([123,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,20,21,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84])),graphics:()=>fe(()=>import("./GraphicsLayerView3D-DjhFze7h.js"),__vite__mapDeps([124,80,109,125,110,23,15,16,92,83])),group:()=>fe(()=>import("./GroupLayerView-DiVQFs5H.js"),__vite__mapDeps([126,83])),imagery:()=>fe(()=>import("./ImageryLayerView3D-DfOIpxKO.js"),__vite__mapDeps([127,91,80,92,93,83,84,107])),"integrated-mesh":()=>fe(()=>import("./IntegratedMeshLayerView3D-CVYBtF6i.js"),__vite__mapDeps([128,95,96,97,98,56,68,99,100,101,29,102,103,104,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,20,21,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84,112,113,114,55,115])),"integrated-mesh-3dtiles":()=>fe(()=>import("./IntegratedMesh3DTilesLayerView3D-DJMqaNYo.js"),__vite__mapDeps([129,96,97,62,80,83])),"line-of-sight":()=>fe(()=>import("./LineOfSightLayerView3D-CZSeppk4.js"),__vite__mapDeps([130,80,83])),"map-image":()=>fe(()=>import("./MapImageLayerView3D-B0fIo-UV.js"),__vite__mapDeps([131,91,80,92,93,83,84,132,86,88,107,85,87,18,19])),media:()=>fe(()=>import("./MediaLayerView3D-CXYuSN9T.js").then(t=>t.M),__vite__mapDeps([133,134,135,19,80,136,137,138,139,9,140,141,86,93,83])),"ogc-feature":()=>fe(()=>import("./OGCFeatureLayerView3D-CoTx46dK.js"),__vite__mapDeps([142,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,20,21,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84])),"open-street-map":FP,"oriented-imagery":()=>fe(()=>import("./FeatureLayerView3D-hK0V7mGf.js"),__vite__mapDeps([104,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,20,21,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84])),"point-cloud":()=>fe(()=>import("./PointCloudLayerView3D-B1DiLBrs.js"),__vite__mapDeps([143,80,71,49,50,144,83])),voxel:()=>fe(()=>import("./VoxelLayerView3D-BxZL9K1P.js"),__vite__mapDeps([145,80,144,83])),route:()=>fe(()=>import("./RouteLayerView3D-FLlpaXZV.js"),__vite__mapDeps([146,147,80,125,110,23,15,16,92,111,83])),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?fe(()=>import("./SceneLayerView3D-B5wTXq8h.js"),__vite__mapDeps([148,68,20,21,86,95,96,97,98,56,99,100,101,29,102,103,104,105,106,107,92,108,109,78,110,23,15,16,17,18,19,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84,112,113,114,55,115,149,117,116,144])):fe(()=>import("./SceneLayerGraphicsView3D-DlOjijEh.js"),__vite__mapDeps([150,98,97,56,68,99,100,101,29,102,103,104,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,20,21,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84,149,117,144])),stream:()=>fe(()=>import("./StreamLayerView3D-amq9V6VX.js"),__vite__mapDeps([151,46,47,34,18,19,32,33,111,106,107,92,108,109,78,110,23,15,16,86,17,20,21,10,22,3,4,5,6,13,14,80,83])),tile:FP,"imagery-tile":()=>fe(()=>import("./ImageryTileLayerView3D-DyFwKEq7.js"),__vite__mapDeps([152,54,80,81,107,83,84,87])),"vector-tile":()=>fe(()=>import("./VectorTileLayerView3D-DujxMn9p.js"),__vite__mapDeps([153,44,33,43,154,80,81,83])),wcs:()=>fe(()=>import("./ImageryTileLayerView3D-DyFwKEq7.js"),__vite__mapDeps([152,54,80,81,107,83,84,87])),"web-tile":FP,wfs:()=>fe(()=>import("./WFSLayerView3D-DmRh3d05.js"),__vite__mapDeps([155,105,106,107,92,108,109,78,110,23,15,16,86,17,18,19,20,21,10,22,3,4,5,6,13,14,80,34,32,33,71,111,83,84])),wms:()=>fe(()=>import("./WMSLayerView3D-pKN1l1xO.js"),__vite__mapDeps([156,91,80,92,93,83,84,157,107])),wmts:()=>fe(()=>import("./WMTSLayerView3D-DhstHW7t.js"),__vite__mapDeps([158,80,81,82,83,84])),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function ett(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new V(`${i}:view-not-supported`,`${e} is not supported in 3D`)}const nue={hasLayerViewModule:t=>sue[t.type]!=null,importLayerView:t=>{const e=sue[t.type];if(e==null)throw ett(t);return e(t)}},oue="analyses-owner-handles";var nC,Cx;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(nC||(nC={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(Cx||(Cx={}));let Vw=class extends Re{constructor(e){super(e),this._allAnalysisViews=new tt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=aue(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null},viewshed:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(Di("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(Di()),this._attachedToViewResolver=aue()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const i=this._items.get(e);if(i==null||i.state.list===Cx.REMOVED)throw new V("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return i.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),oue)}_disconnectOwners(){this.removeHandles(oue),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const i=e.on("after-add",s=>this._addAnalysis(s.item)),r=e.on("after-remove",s=>this._removeAnalysis(s.item));return Ni(()=>{i.remove(),r.remove();for(const s of e)this._removeAnalysis(s)})}_addAnalysis(e){const i=this._items.get(e);if(i==null){const r={state:{view:nC.PENDING,list:Cx.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=Nf(s=>this._createAnalysisViewPromise(r,s))}else i.state.list=Cx.ADDED}_removeAnalysis(e){const i=this._items.get(e);i!=null?(i.state.list=Cx.REMOVED,this._scheduleUpdate()):ie.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=hT(()=>this._update()))}_update(){this._scheduledUpdateHandle=Or(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===Cx.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case nC.PENDING:e.createAnalysisViewTask=Ul(e.createAnalysisViewTask);break;case nC.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=Le(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,i){const r=e.analysis,s=r.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,n.module==null)try{n.module=await this._loadAnalysisModule(s)}catch(a){throw this._creatingViewCount-=1,a}if(Yn(i))throw this._creatingViewCount-=1,Di("AnalysisView creation aborted");const o=new n.module.default({analysis:r,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(Yn(i))throw this._creatingViewCount-=1,o.destroy(),Di("AnalysisView creation aborted");return e.view=o,e.state.view=nC.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return fe(()=>import("./AreaMeasurementAnalysisView3D-DyhtFJfm.js"),__vite__mapDeps([159,160,161,65,162,163,139,9,140,138,164,165,141,166,167]));case"dimension":return fe(()=>import("./DimensionAnalysisView3D-DtuOgsNo.js"),__vite__mapDeps([168,162,169,161,65,166,167,138,139,9,140,170,171,154,172,173,174,175,137,141,86,136,176,177,165,108,178,93,179,180,181,182,164]));case"direct-line-measurement":return fe(()=>import("./DirectLineMeasurementAnalysisView3D-TT2ZuNJ8.js"),__vite__mapDeps([183,160,161,65,162,164,138,139,9,140,166,167,175,172]));case"line-of-sight":return fe(()=>import("./LineOfSightAnalysisView3D-BS9_AZB4.js"),__vite__mapDeps([184,162,185,113,114,164,177,165,141,186,173,167,181,174]));case"slice":return fe(()=>import("./SliceAnalysisView3D-DyjyaonR.js"),__vite__mapDeps([187,162,188,189,177,165,141,93,113,114,164,167,180,178,181,182]));case"viewshed":return fe(()=>import("./ViewshedAnalysisView3D-CPogzC9K.js"),__vite__mapDeps([190,162,139,9,140,177,165,141,178,167,189,191,171,154,172,173,181,136,182]))}}};function aue(){const t=ra();return t.promise.catch(()=>{}),t}h([f()],Vw.prototype,"updating",null),h([f({constructOnly:!0})],Vw.prototype,"view",void 0),h([f()],Vw.prototype,"_allAnalysisViews",void 0),h([f()],Vw.prototype,"_creatingViewCount",void 0),Vw=h([I("esri.views.3d.analysis.AnalysisViewManager3D")],Vw);const ttt=Vw;let Sy=class extends Re{constructor(e){super(e),this.collision=new oR,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Ge.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Ge.Local?this._set("altitude",e):ie.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?Te(e,this.altitude.min,this.altitude.max):e}clampTilt(e,i){if(!this.tilt)return i;const r=this.tilt(e);return Te(i,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Ge.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(i,r=B6)=>(r.min=ya.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?B4([[4e3,ya.max],[1e4,Rt(88)],[6e6,Rt(88)]]):()=>ya.max;return(i,r=B6)=>(r.min=ya.min,r.max=e(i),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?B4([[4e3,ya.max],[5e4,Rt(88)],[6e6,Rt(88)],[2e7,ya.min]]):B4([[3e5,ya.max],[3e6,Rt(88)],[6e6,Rt(88)],[2e7,ya.min]]);return(i,r=B6)=>(r.min=ya.min,r.max=e(i),r)}};function itt(t){return{min:-2e5,max:4*t.radius}}h([f()],Sy.prototype,"altitude",null),h([f({readOnly:!0})],Sy.prototype,"collision",void 0),h([f()],Sy.prototype,"distance",void 0),h([f({readOnly:!0})],Sy.prototype,"minimumPoiDistance",void 0),h([f()],Sy.prototype,"tilt",void 0),h([f({constructOnly:!0})],Sy.prototype,"mode",void 0),Sy=h([I("esri.views.3d.state.Constraints")],Sy);const lue=itt(ir),ya={min:Rt(.5),max:Rt(179.5)},B6={min:0,max:0};let oR=class extends Re{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};h([f({type:Boolean})],oR.prototype,"enabled",void 0),h([f({type:Number})],oR.prototype,"elevationMargin",void 0),oR=h([I("esri.views.3d.state.Constraints.CollisionConstraint")],oR);let oC=class extends IS{constructor(){super(...arguments),this.min=lue.min,this.max=lue.max}};h([f({type:Number})],oC.prototype,"min",void 0),h([f({type:Number})],oC.prototype,"max",void 0),oC=h([I("esri.views.3d.constraints.AltitudeConstraint")],oC);let Gy=class extends IS{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,i){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==i&&this._set("far",i))}};h([f({type:Number,value:1e-8})],Gy.prototype,"near",null),h([Li("near")],Gy.prototype,"castNear",null),h([f({type:Number,value:1e-8})],Gy.prototype,"far",null),h([Li("far")],Gy.prototype,"castFar",null),h([f({type:["auto","manual"]})],Gy.prototype,"mode",void 0),Gy=h([I("esri.views.3d.constraints.ClipDistanceConstraint")],Gy);const PY={min:Ma(ya.min),max:Ma(ya.max)};let Mx=class extends IS{constructor(e){super(e),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return Te(e,PY.min,PY.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};h([f({type:["auto","manual"]})],Mx.prototype,"mode",void 0),h([f({type:Number,value:PY.max})],Mx.prototype,"max",null),h([Li("max")],Mx.prototype,"castMax",null),Mx=h([I("esri.views.3d.constraints.TiltConstraint")],Mx);let Ax=class extends IS{constructor(){super(...arguments),this.tilt=new Mx,this.altitude=new oC,this.clipDistance=new Gy}};h([f({type:Mx})],Ax.prototype,"tilt",void 0),h([f({type:oC})],Ax.prototype,"altitude",void 0),h([f({type:Gy})],Ax.prototype,"clipDistance",void 0),Ax=h([I("esri.views.3d.constraints.Constraints")],Ax);var OY;let Xh=OY=class extends ye{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,i){e[i]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,i){t&&(e[i]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new OY(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};h([f({readOnly:!0,type:["sun"],json:{write:!0}})],Xh.prototype,"type",void 0),h([f({type:Date,json:{type:Number,write:{target:"datetime"}}})],Xh.prototype,"date",void 0),h([Ce("date",["datetime"])],Xh.prototype,"readDate",null),h([Ve("date")],Xh.prototype,"writeDate",null),h([f({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Xh.prototype,"directShadowsEnabled",void 0),h([Ce("directShadowsEnabled",["directShadows"])],Xh.prototype,"readDirectShadowsEnabled",null),h([Ve("directShadowsEnabled")],Xh.prototype,"writedirectShadowsEnabled",null),h([f({type:Number,json:{write:!0}})],Xh.prototype,"displayUTCOffset",void 0),h([Ve("displayUTCOffset")],Xh.prototype,"writeDisplayUTCOffset",null),Xh=OY=h([I("esri.webscene.SunLighting")],Xh);const t3=Xh;var dE;let sv=dE=class extends cn.EventedMixin(t3){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),i=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new dE(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const i=dE.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const s=dE.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(JD.target=this,JD.timezoneOffset=s,this.emit("timezone-will-change",JD),JD.target=null),t!=null)return isNaN(t.getTime())||r!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new dE({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([f({type:Boolean})],sv.prototype,"cameraTrackingEnabled",void 0),h([f({type:Date})],sv.prototype,"defaultDate",null),h([f({type:Date})],sv.prototype,"date",null),sv=dE=h([I("esri.views.3d.environment.SunLighting")],sv),function(t){function e({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}t.calculateTimezoneOffset=e}(sv||(sv={}));const JD={target:null,timezoneOffset:0},Bw=sv;var RY;let aR=RY=class extends ye{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new RY(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};h([f({readOnly:!0,type:["virtual"],json:{write:!0}})],aR.prototype,"type",void 0),h([f({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],aR.prototype,"directShadowsEnabled",void 0),aR=RY=h([I("esri.webscene.VirtualLighting")],aR);const fG=aR;var w5;let x5=w5=class extends cn.EventedMixin(fG){constructor(t){super(t),this.cameraTrackingEnabled=!0}clone(){return new w5({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new w5(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([f({type:Boolean})],x5.prototype,"cameraTrackingEnabled",void 0),x5=w5=h([I("esri.views.3d.environment.VirtualLighting")],x5);const lR=x5,rtt={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Bw,virtual:lR}};var $Y;let W$=$Y=class extends Re{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new $Y({quality:this.quality})}};h([f({type:["low","high"],value:"low"})],W$.prototype,"quality",null),W$=$Y=h([I("esri.views.3d.environment.SceneViewAtmosphere")],W$);var IY;let cR=IY=class extends ye{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new IY({cloudCover:this.cloudCover})}};h([ct({sunny:"sunny"})],cR.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],cR.prototype,"cloudCover",void 0),cR=IY=h([I("esri.views.3d.environment.SunnyWeather")],cR);const LY=cR;var DY;let uR=DY=class extends ye{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new DY({cloudCover:this.cloudCover})}};h([ct({cloudy:"cloudy"})],uR.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],uR.prototype,"cloudCover",void 0),uR=DY=h([I("esri.views.3d.environment.CloudyWeather")],uR);const stt=uR;var NY;let hR=NY=class extends ye{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new NY({fogStrength:this.fogStrength})}};h([ct({foggy:"foggy"})],hR.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],hR.prototype,"fogStrength",void 0),hR=NY=h([I("esri.views.3d.environment.FoggyWeather")],hR);const ntt=hR;var FY;let pE=FY=class extends ye{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new FY({cloudCover:this.cloudCover,precipitation:this.precipitation})}};h([ct({rainy:"rainy"})],pE.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],pE.prototype,"cloudCover",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],pE.prototype,"precipitation",void 0),pE=FY=h([I("esri.views.3d.environment.RainyWeather")],pE);const ott=pE;var kY;let Gw=kY=class extends ye{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new kY({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};h([ct({snowy:"snowy"})],Gw.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Gw.prototype,"cloudCover",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Gw.prototype,"precipitation",void 0),h([f({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],Gw.prototype,"snowCover",void 0),Gw=kY=h([I("esri.views.3d.environment.SnowyWeather")],Gw);const att=Gw,eMe={key:"type",base:LY,typeMap:{sunny:LY,cloudy:stt,rainy:ott,snowy:att,foggy:ntt}},ltt=Object.keys(eMe.typeMap);function ctt(t,e){return!!ltt.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const Zy=1e4,utt=1e5,htt={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:t3,virtual:fG}};let S5=class extends ye{constructor(e){super(e)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};h([f({readOnly:!0,json:{read:!1}})],S5.prototype,"type",void 0),S5=h([I("esri.webscene.background.Background")],S5);const tMe=S5;var UY;const dtt={...V0,nonNullable:!0};let dR=UY=class extends tMe{constructor(t){super(t),this.type="color",this.color=new Oe([0,0,0,1])}clone(){return new UY(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};h([ct({color:"color"},{readOnly:!0})],dR.prototype,"type",void 0),h([f(dtt)],dR.prototype,"color",void 0),dR=UY=h([I("esri.webscene.background.ColorBackground")],dR);const iMe=dR,cue={base:tMe,key:"type",typeMap:{color:iMe}};function ptt(t){return(e,i,r)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,r),n}}}const ftt={types:cue,json:{read:ptt(cue),write:{overridePolicy:(t,e,i)=>({enabled:!(i!=null&&i.isPresentation)})}}};var zY;const uue=(t,e,i)=>({enabled:!(i!=null&&i.isPresentation)});let nv=zY=class extends ye{constructor(t){super(t),this.lighting=new t3,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){ctt(t==null?void 0:t.type,ie.getLogger(this))&&this._set("weather",t)}clone(){return new zY(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?fG.prototype.clone.call(this.lighting):t3.prototype.clone.call(this.lighting),background:Q(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};h([f({types:htt,nonNullable:!0,json:{write:!0}})],nv.prototype,"lighting",void 0),h([f(ftt)],nv.prototype,"background",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:uue}}})],nv.prototype,"atmosphereEnabled",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:uue}}})],nv.prototype,"starsEnabled",void 0),h([f({types:eMe,nonNullable:!0,json:{write:!0},value:new LY})],nv.prototype,"weather",null),nv=zY=h([I("esri.webscene.Environment")],nv);const rMe=nv;var pR;let fE=pR=class extends rMe{constructor(t){super(t),this.atmosphere=new W$,this.lighting=this.castLighting(),this.cachedCameraTrackingEnabled=null}destroy(){this.atmosphere.destroy()}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new pR({...e,lighting:e.lighting?e.lighting.type==="virtual"?lR.fromWebsceneLighting(e.lighting):Bw.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLightingWithDestroy(t)}applyLighting(t){this.lighting=this._convertLightingWithDestroy(t)}_convertLightingWithDestroy(t){const e=this._convertLighting(t);return e!==t&&this.addHandles(g1e(e)),e}_convertLighting(t){var e,i;return t?t instanceof Bw||t instanceof lR?t:t instanceof t3?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new Bw({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof fG?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new lR({...t.cloneConstructProperties(),...(i=this.lighting)==null?void 0:i.cloneNonPersistentConstructProperties()}):xf(rtt,t):new Bw}clone(){return new pR({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Q(this.background)})}cloneWithWebsceneEnvironment(t){return new pR({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Q(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):Bw.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):lR.fromWebsceneLighting(t.lighting);default:return t.lighting,Bw.fromWebsceneLighting(t.lighting)}}};h([f({type:W$,json:{read:!1},nonNullable:!0})],fE.prototype,"atmosphere",void 0),h([f({nonNullable:!0})],fE.prototype,"lighting",void 0),h([Li("lighting")],fE.prototype,"castLighting",null),fE=pR=h([I("esri.views.3d.environment.SceneViewEnvironment")],fE);const mE=fE;function mtt(t,e){return{type:FS(e),value:t,unit:e}}function Jjt(t){return{value:t}}function h0(t,e){return{type:FS(e),value:t,unit:e}}function gtt(t,e){return{type:FS(e),value:t,unit:e}}function mG(t,e,i="arithmetic"){return{type:FS(e),value:t,unit:e,rotationType:i}}function ytt(t,e){const i=_tt(t,e);return t.type==="angle"?mG(i,e,t.rotationType):mtt(i,e)}function _tt(t,e){return ro(t.value,t.unit,e)}function Qjt(t,e){return t==null?e:e==null||t.value>ro(e.value,e.unit,t.unit)?t:e}function Kjt(t,e){return t==null?null:{...t,value:t.value*e}}function e6t(t,e,i){if(e===i)return t;switch(i){case"arithmetic":case"geographic":return 90-t}}const t6t=h0(0,"meters"),i6t=gtt(0,"square-meters");mG(0,"radians");const r6t=mG(0,"degrees"),s6t=mG(0,"degrees","geographic");var ka;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(ka||(ka={}));function sMe(t){return"r"in t&&"g"in t&&"b"in t}function nMe(t){return"h"in t&&"s"in t&&"v"in t}function oMe(t){return"l"in t&&"a"in t&&"b"in t}function aMe(t){return"l"in t&&"c"in t&&"h"in t}function vtt(t){return"x"in t&&"y"in t&&"z"in t}const btt=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],wtt=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function lMe(t,e){const i=[];let r,s;if(t[0].length!==e.length)throw new Error("dimensions do not match");const n=t.length,o=t[0].length;let a=0;for(r=0;r<n;r++){for(a=0,s=0;s<o;s++)a+=t[r][s]*e[s];i.push(a)}return i}function cMe(t){const e=[t.r/255,t.g/255,t.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=lMe(btt,e);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function tie(t){const e=lMe(wtt,[t.x/100,t.y/100,t.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function uMe(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function hMe(t){const e=t.l,i=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function xtt(t){const e=t.l,i=t.a,r=t.b,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n=n>0?n:n+2*Math.PI,{l:e,c:s,h:n}}function Stt(t){const e=t.l,i=t.c,r=t.h;return{l:e,a:i*Math.cos(r),b:i*Math.sin(r)}}function Ttt(t){return uMe(cMe(t))}function Ett(t){return tie(hMe(t))}function Ctt(t){return xtt(uMe(cMe(t)))}function Mtt(t){return tie(hMe(Stt(t)))}function Att(t){const e=t.r,i=t.g,r=t.b,s=Math.max(e,i,r),n=s-Math.min(e,i,r);let o=s,a=n===0?0:s===e?(i-r)/n%6:s===i?(r-e)/n+2:(e-i)/n+4,l=n===0?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function Ptt(t){const e=(t.h+360)%360/60,i=t.s/100,r=t.v/100*255,s=r*i,n=s*(1-Math.abs(e%2-1));let o;switch(Math.floor(e)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-s),o.g=Math.round(o.g+r-s),o.b=Math.round(o.b+r-s),o}function QS(t){return sMe(t)?t:aMe(t)?Mtt(t):oMe(t)?Ett(t):vtt(t)?tie(t):nMe(t)?Ptt(t):t}function Ott(t){return nMe(t)?t:Att(QS(t))}function VY(t){return oMe(t)?t:Ttt(QS(t))}function hue(t){return aMe(t)?t:Ctt(QS(t))}function Rtt(t,e){const{r:i,g:r,b:s}=t;return .2126*i+.7152*r+.0722*s}var BY;function n6t(t,e=BY.High){return Rtt(t)>e?new Oe([0,0,0,t.a]):new Oe([255,255,255,t.a])}function o6t(t,e){const i=VY(t);i.l*=1-e;const r=QS(i),s=t.clone();return s.setColor(r),s.a=t.a,s}function a6t(t,e){const i=t.clone();return i.a*=e,i}function l6t(t,e){const i=Ott(t);i.s*=e;const r=QS(i),s=t.clone();return s.setColor(r),s.a=t.a,s}function i3(t){return Oe.toUnitRGBA(t)}function c6t(t,e){return t===e||t!=null&&e!=null&&qS(t,e)}function u6t(t){return Wt(t[0],t[1],t[2],t.length>3?t[3]:1)}function h6t(t,e){const i=Oe.toUnitRGBA(t);return i[3]*=e,i}(function(t){t[t.Low=160]="Low",t[t.High=225]="High"})(BY||(BY={}));function Aa(t,e){return t[0]=e[0],t[1]=e[1],t}function Pi(t,e,i){return t[0]=e,t[1]=i,t}function Bp(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function Hm(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function dMe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function pMe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function $tt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Itt(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Ltt(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function Dtt(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function Ntt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function hh(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function Ftt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}function V1(t,e){const i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function mz(t,e){const i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function iie(t){const e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function fMe(t){const e=t[0],i=t[1];return e*e+i*i}function mMe(t,e){return t[0]=-e[0],t[1]=-e[1],t}function ktt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function r3(t,e){const i=e[0],r=e[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function Gn(t,e){return t[0]*e[0]+t[1]*e[1]}function Utt(t,e,i){const r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function Td(t,e,i,r){const s=e[0],n=e[1];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t}function ztt(t,e){e=e||1;const i=2*G3()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function gMe(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s,t[1]=i[1]*r+i[3]*s,t}function Vtt(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s+i[4],t[1]=i[1]*r+i[3]*s+i[5],t}function Btt(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[3]*s+i[6],t[1]=i[1]*r+i[4]*s+i[7],t}function Gtt(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[4]*s+i[12],t[1]=i[1]*r+i[5]*s+i[13],t}function jtt(t,e,i,r){const s=e[0]-i[0],n=e[1]-i[1],o=Math.sin(r),a=Math.cos(r);return t[0]=s*a-n*o+i[0],t[1]=s*o+n*a+i[1],t}function Htt(t,e){const i=t[0],r=t[1],s=e[0],n=e[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function qtt(t){return"vec2("+t[0]+", "+t[1]+")"}function yMe(t,e){return t[0]===e[0]&&t[1]===e[1]}function _Me(t,e){const i=t[0],r=t[1],s=e[0],n=e[1],o=Lo();return Math.abs(i-s)<=o*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=o*Math.max(1,Math.abs(r),Math.abs(n))}function Wtt(t,e,i,r,s){let n=e[0]-i[0],o=e[1]-i[1];const a=(r[0]*n+r[1]*o)*(s-1);return n=r[0]*a,o=r[1]*a,t[0]=e[0]+n,t[1]=e[1]+o,t}const Ytt=iie,Ztt=Hm,Xtt=dMe,Jtt=pMe,vMe=V1,Qtt=mz,Ktt=fMe;Object.freeze(Object.defineProperty({__proto__:null,add:Bp,angle:Htt,ceil:$tt,copy:Aa,cross:Utt,dist:vMe,distance:V1,div:Jtt,divide:pMe,dot:Gn,equals:_Me,exactEquals:yMe,floor:Itt,inverse:ktt,len:Ytt,length:iie,lerp:Td,max:Dtt,min:Ltt,mul:Xtt,multiply:dMe,negate:mMe,normalize:r3,projectAndScale:Wtt,random:ztt,rotate:jtt,round:Ntt,scale:hh,scaleAndAdd:Ftt,set:Pi,sqrDist:Qtt,sqrLen:Ktt,squaredDistance:mz,squaredLength:fMe,str:qtt,sub:Ztt,subtract:Hm,transformMat2:gMe,transformMat2d:Vtt,transformMat3:Btt,transformMat4:Gtt},Symbol.toStringTag,{value:"Module"}));function rie(t){return Te((t-1e5)/9e5,0,1)}const GY=1e4,eit=.085,Av=1e5;let tit=class{};const $r=tit;function S(t,...e){let i="";for(let r=0;r<e.length;r++)i+=t[r]+e[r];return i+=t[t.length-1],i}(function(t){function e(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}t.int=e,t.float=i})(S||(S={}));var R;function iit(t){return t===R.POSITION}(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.PERSPECTIVEDIVIDE="perspectiveDivide",t.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",t.LENGTH="length",t.PREVPOSITION="prevPosition",t.NEXTPOSITION="nextPosition",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.INSTANCEMODELORIGINHI="instanceModelOriginHi",t.INSTANCEMODELORIGINLO="instanceModelOriginLo",t.INSTANCEMODEL="instanceModel",t.INSTANCEMODELNORMAL="instanceModelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMAL2COMPRESSED="normal2Compressed",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(R||(R={}));var ps;function lf(t,e){switch(e.textureCoordinateType){case ps.Default:return t.attributes.add(R.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(S`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case ps.Compressed:return t.attributes.add(R.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(S`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case ps.Atlas:return t.attributes.add(R.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(R.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(S`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case ps.None:return void t.vertex.code.add(S`void forwardTextureCoordinates() {}`);case ps.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(ps||(ps={}));function Uf(t){t.code.add(S`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}var Hi;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(Hi||(Hi={}));let Fs=class{constructor(e,i,r,s,n=null){if(this.name=e,this.type=i,this.arraySize=n,this.bind={[Hi.Pass]:null,[Hi.Draw]:null},s)switch(r){case Hi.Pass:this.bind[Hi.Pass]=s;break;case Hi.Draw:this.bind[Hi.Draw]=s}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},Fr=class extends Fs{constructor(e,i){super(e,"vec2",Hi.Pass,(r,s,n)=>r.setUniform2fv(e,i(s,n)))}};function sie(t){t.include(Uf),t.code.add(S`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
return linearDepthFromRGBA(texelFetch(depthTexture, iuv, 0), nearFar);
}`)}function Ig(t){t.uniforms.add(new Fr("zProjectionMap",(e,i)=>rit(i.camera))),t.code.add(S`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),t.code.add(S`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),t.code.add(S`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}function rit(t){const e=t.projectionMatrix;return Pi(sit,e[14],e[10])}const sit=lt();function gG(t){t.fragment.code.add(S`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}let Vt=class extends Fs{constructor(e,i){super(e,"vec3",Hi.Pass,(r,s,n)=>r.setUniform3fv(e,i(s,n)))}};function G0(t){t.uniforms.add(new Vt("mainLightDirection",(e,i)=>i.lighting.mainLight.direction))}function Lg(t){t.uniforms.add(new Vt("mainLightIntensity",(e,i)=>i.lighting.mainLight.intensity))}function gz(t){G0(t.fragment),Lg(t.fragment),t.fragment.code.add(S`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let zi=class extends Fs{constructor(e,i){super(e,"vec4",Hi.Pass,(r,s,n)=>r.setUniform4fv(e,i(s,n)))}},qe=class extends Fs{constructor(e,i){super(e,"float",Hi.Pass,(r,s,n)=>r.setUniform1f(e,i(s,n)))}},ss=class extends Fs{constructor(e,i){super(e,"mat4",Hi.Pass,(r,s,n)=>r.setUniformMatrix4fv(e,i(s,n)))}};const pl=Qt();let nit=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function ft(t,e){if(!t){e=e||"Assertion";const i=new Error(e).stack;throw new nit(`${e} at ${i}`)}}function XT(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function bMe(t,e,i,r){let s,n=(i[0]-t[0])/e[0],o=(r[0]-t[0])/e[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-t[1])/e[1],l=(r[1]-t[1])/e[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(i[2]-t[2])/e[2],u=(r[2]-t[2])/e[2];return c>u&&(s=c,c=u,u=s),!(n>u||c>o)&&(u<o&&(o=u),!(o<0))}function QD(t,e,i,r,s,n=lt()){const o=(r[s]-i[s])*(e[0]-t[0])-(r[0]-i[0])*(e[s]-t[s]),a=(r[0]-i[0])*(t[s]-i[s])-(r[s]-i[s])*(t[0]-i[0]);if(o===0)return!1;const l=a/o;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function due(t,e,i,r,s){pl[0]=t[0],pl[1]=t[1],pl[2]=t[2],pl[3]=1,hu(pl,pl,e),s.length>2&&(s[2]=-pl[2]),hu(pl,pl,i),ft(pl[3]!==0),s[0]=pl[0]/pl[3],s[1]=pl[1]/pl[3],s[2]=pl[2]/pl[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function oit(t,e){return Math.log(t)/Math.log(e)}function ait(t,e,i,r){t[12]=e,t[13]=i,t[14]=r}function wMe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const lit=()=>ie.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let xMe=class{constructor(){this._includedModules=new Map}include(e,i){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,i),e(this.builder,i))}},Vi=class extends xMe{constructor(){super(...arguments),this.vertex=new pue,this.fragment=new pue,this.attributes=new hit,this.varyings=new dit,this.extensions=new jY,this.constants=new SMe,this.outputs=new qY}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const i=this.extensions.generateSource(e),r=this.attributes.generateSource(e),s=this.varyings.generateSource(e),n=e==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=e==="vertex"?fit:pit,c=this.constants.generateSource().concat(n.constants.generateSource()),u=this.outputs.generateSource(e);return`#version 300 es
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${s.join(`
`)}

${u.join(`
`)}

${a.join(`
`)}`}generateBindPass(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[Hi.Pass];o&&i.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[Hi.Pass];o&&i.set(n.name,o)});const r=Array.from(i.values()),s=r.length;return(n,o)=>{for(let a=0;a<s;++a)r[a](e,n,o)}}generateBindDraw(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[Hi.Draw];o&&i.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[Hi.Draw];o&&i.set(n.name,o)});const r=Array.from(i.values()),s=r.length;return(n,o,a)=>{for(let l=0;l<s;++l)r[l](e,n,o,a)}}},cit=class{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(const i of e)this._add(i);return this._stage}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new V(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else lit().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},uit=class{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}},pue=class extends xMe{constructor(){super(...arguments),this.uniforms=new cit(this),this.code=new uit(this),this.constants=new SMe}get builder(){return this}},hit=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(e){return e==="fragment"?[]:this._entries.map(i=>`in ${i[1]} ${i[0]};`)}},dit=class{constructor(){this._entries=new Map}add(e,i){this._entries.has(e)&&ft(this._entries.get(e)===i),this._entries.set(e,i)}generateSource(e){const i=new Array;return this._entries.forEach((r,s)=>i.push(e==="vertex"?`out ${r} ${s};`:`in ${r} ${s};`)),i}},jY=class HY{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const i=e==="vertex"?HY.ALLOWLIST_VERTEX:HY.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}};jY.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],jY.ALLOWLIST_VERTEX=[];let qY=class WY{constructor(){this._entries=new Map}add(e,i,r=0){const s=this._entries.get(r);s?ft(s.name===e&&s.type===i,`Fragment shader output location ${r} occupied`):this._entries.set(r,{name:e,type:i})}generateSource(e){if(e==="vertex")return[];this._entries.size===0&&this._entries.set(0,{name:WY.DEFAULT_NAME,type:WY.DEFAULT_TYPE});const i=new Array;return this._entries.forEach((r,s)=>i.push(`layout(location = ${s}) out ${r.type} ${r.name};`)),i}};qY.DEFAULT_TYPE="vec4",qY.DEFAULT_NAME="fragColor";let SMe=class Nn{constructor(){this._entries=new Set}add(e,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=Nn._numberToFloatStr(r);break;case"int":s=Nn._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${Nn._numberToFloatStr(r[0])},                            ${Nn._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${Nn._numberToFloatStr(r[0])},                            ${Nn._numberToFloatStr(r[1])},                            ${Nn._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${Nn._numberToFloatStr(r[0])},                            ${Nn._numberToFloatStr(r[1])},                            ${Nn._numberToFloatStr(r[2])},                            ${Nn._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${Nn._numberToIntStr(r[0])},                             ${Nn._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${Nn._numberToIntStr(r[0])},                             ${Nn._numberToIntStr(r[1])},                             ${Nn._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${Nn._numberToIntStr(r[0])},                             ${Nn._numberToIntStr(r[1])},                             ${Nn._numberToIntStr(r[2])},                             ${Nn._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>Nn._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${e} = ${s};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const pit=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,fit=`precision highp float;
precision highp sampler2D;`;let mt=class extends Fs{constructor(e,i){super(e,"sampler2D",Hi.Pass,(r,s,n)=>r.bindTexture(e,i(s,n)))}};const ZC=$e(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),G6=3,j6=$e(G6*parseFloat(65e-8.toFixed(6)),G6*parseFloat(1881e-9.toFixed(6)),G6*parseFloat(85e-9.toFixed(6))),mit=3996e-9,git=$e(parseFloat(Number(ZC[0]+j6[0]).toFixed(6)),parseFloat(Number(ZC[1]+j6[1]).toFixed(6)),parseFloat(Number(ZC[2]+j6[2]).toFixed(6)));function TMe(t){const e=new Vi;e.attributes.add(R.POSITION,"vec2"),e.include(lf,{textureCoordinateType:ps.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=e;return i.uniforms.add(new ss("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new ss("inverseViewMatrix",(s,n)=>rb(yit,n.camera.viewMatrix))),i.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Vt("backgroundColor",s=>s.backgroundColor),new Fr("radii",s=>s.radii),new Vt("cameraPosition",(s,n)=>n.camera.eye),new zi("heightParameters",s=>s.heightParameters),new qe("innerFadeDistance",s=>s.innerFadeDistance),new qe("altitudeFade",s=>s.altitudeFade),new mt("depthTexture",s=>s.depthTexture),new qe("hazeStrength",s=>s.hazeStrength)),r.constants.add("betaRayleigh","vec3",ZC),r.constants.add("betaCombined","vec3",git),r.constants.add("betaMie","float",mit),r.constants.add("scaleHeight","float",eit*Av),G0(r),e.include(gG),t.haze&&r.include(Ig),r.code.add(S`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(S`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(S`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(S`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?S`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":S`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":S`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?S`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:S`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":S`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?S`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?S`
          float depthSample = texture(depthTexture, vuv0).r;
          if (depthSample != 1.0) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?S`cameraSpaceRay *= -textureBilinear(vuv0);`:S`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:S`${t.reduced?"":S`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?S`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != 1.0){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:S`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":S`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const yit=Ee(),_it=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:ZC,build:TMe},Symbol.toStringTag,{value:"Module"}));let Bi=class{constructor(e,i){this._module=e,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var Lr,vi,Pe,M0,Tt,cf,KM,Me,fr,fs,ii,bi,Is,Ft,gt,sl,_a,rr,lh,Va;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(Lr||(Lr={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(vi||(vi={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Pe||(Pe={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(M0||(M0={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(Tt||(Tt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(cf||(cf={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(KM||(KM={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=5131]="HALF_FLOAT"}(Me||(Me={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(fr||(fr={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(fs||(fs={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(ii||(ii={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(bi||(bi={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(Is||(Is={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Ft||(Ft={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(gt||(gt={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(sl||(sl={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(_a||(_a={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(rr||(rr={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(lh||(lh={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Va||(Va={}));const H6=33984;var nn,qn,ao;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.TransformFeedback=7]="TransformFeedback",t[t.Sync=8]="Sync",t[t.UNCOUNTED=9]="UNCOUNTED",t[t.LinesOfCode=9]="LinesOfCode",t[t.Uniform=10]="Uniform",t[t.COUNT=11]="COUNT"})(nn||(nn={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(qn||(qn={})),function(t){t[t.NONE=0]="NONE",t[t.BACK=1029]="BACK"}(ao||(ao={}));const eA=33306;var qs,fue,mue,gue,yz,YY,yue;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(qs||(qs={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(fue||(fue={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(mue||(mue={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(gue||(gue={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(yz||(yz={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(YY||(YY={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(yue||(yue={}));let Wi=class{constructor(e,i,r){this.release=r,this.initializeConfiguration(e,i),this._configuration=i.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}destroy(){this._program=It(this._program),this._pipeline=this._configuration=null}reload(e){It(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return vi.TRIANGLES}getPipeline(e,i,r){return this._pipeline}initializeConfiguration(e,i){}};const wi=new Map([[R.POSITION,0],[R.NORMAL,1],[R.NORMALCOMPRESSED,1],[R.UV0,2],[R.COLOR,3],[R.COLORFEATUREATTRIBUTE,3],[R.SIZE,4],[R.TANGENT,4],[R.CENTEROFFSETANDDISTANCE,5],[R.SYMBOLCOLOR,5],[R.FEATUREATTRIBUTE,6],[R.INSTANCEFEATUREATTRIBUTE,6],[R.INSTANCECOLOR,7],[R.OBJECTANDLAYERIDCOLOR,7],[R.INSTANCEOBJECTANDLAYERIDCOLOR,7],[R.INSTANCEMODEL,8],[R.INSTANCEMODELNORMAL,12],[R.INSTANCEMODELORIGINHI,11],[R.INSTANCEMODELORIGINLO,15]]),vit=()=>ie.getLogger("esri.views.webgl.checkWebGLError");function bit(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const _z=!!re("enable-feature:webgl-debug");function Gp(){return _z}function ZY(){return _z}function qm(t){if(Gp()){const e=t.getError();if(e){const i=bit(t,e),r=new Error().stack;vit().error(new V("webgl-error","WebGL error occurred",{message:i,stack:r}))}}}let Yi=class{constructor(e,i,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new Zt({deallocator:null}),this._glProgram=e.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBindPass(this),this.bindDraw=i.generateBindDraw(this),this._fragmentUniforms=Gp()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,i){this._glProgram.setUniform1i(e,i?1:0)}setUniform1i(e,i){this._glProgram.setUniform1i(e,i)}setUniform1f(e,i){this._glProgram.setUniform1f(e,i)}setUniform2fv(e,i){this._glProgram.setUniform2fv(e,i)}setUniform3fv(e,i){this._glProgram.setUniform3fv(e,i)}setUniform4fv(e,i){this._glProgram.setUniform4fv(e,i)}setUniformMatrix3fv(e,i){this._glProgram.setUniformMatrix3fv(e,i)}setUniformMatrix4fv(e,i){this._glProgram.setUniformMatrix4fv(e,i)}setUniform1fv(e,i){this._glProgram.setUniform1fv(e,i)}setUniform1iv(e,i){this._glProgram.setUniform1iv(e,i)}setUniform2iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform3iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform4iv(e,i){this._glProgram.setUniform4iv(e,i)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,i){if((i==null?void 0:i.glName)==null){const s=this._textures.get(e);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(e)),null}let r=this._textures.get(e);return r==null?(r=this._allocTextureUnit(i),this._textures.set(e,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){var e;this._context.useProgram(this),this._textures.forEach((i,r)=>{this._context.bindTexture(i.texture,i.unit),this.setUniform1i(r,i.unit)}),(e=this._fragmentUniforms)==null||e.forEach(i=>{i.type!=="sampler2D"&&i.type!=="samplerCube"||this._textures.has(i.name)||console.error(`Texture sampler ${i.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var Nr,KS,tr,B1,Tc,A0,Cr,Nl,d0;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(Nr||(Nr={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(KS||(KS={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(tr||(tr={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(B1||(B1={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Tc||(Tc={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(A0||(A0={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(Cr||(Cr={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(Nl||(Nl={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(d0||(d0={}));function Ah(t,e,i=M0.ADD,r=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function sa(t,e,i,r,s=M0.ADD,n=M0.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const nie={face:cf.BACK,mode:KM.CCW},EMe={face:cf.FRONT,mode:KM.CCW},yG=t=>t===Nr.Back?nie:t===Nr.Front?EMe:null,Tu={zNear:0,zFar:1},Kt={r:!0,g:!0,b:!0,a:!0};function wit(t){return Oit.intern(t)}function xit(t){return Rit.intern(t)}function Sit(t){return $it.intern(t)}function Tit(t){return Iit.intern(t)}function Eit(t){return Lit.intern(t)}function Cit(t){return Dit.intern(t)}function Mit(t){return Nit.intern(t)}function Ait(t){return Fit.intern(t)}function Pit(t){return kit.intern(t)}function Gt(t){return Uit.intern(t)}let Dg=class{constructor(e,i){this._makeKey=e,this._makeRef=i,this._interns=new Map}intern(e){if(!e)return null;const i=this._makeKey(e),r=this._interns;return r.has(i)||r.set(i,this._makeRef(e)),r.get(i)??null}};function Ng(t){return"["+t.join(",")+"]"}const Oit=new Dg(CMe,t=>({__tag:"Blending",...t}));function CMe(t){return t?Ng([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const Rit=new Dg(MMe,t=>({__tag:"Culling",...t}));function MMe(t){return t?Ng([t.face,t.mode]):null}const $it=new Dg(AMe,t=>({__tag:"PolygonOffset",...t}));function AMe(t){return t?Ng([t.factor,t.units]):null}const Iit=new Dg(PMe,t=>({__tag:"DepthTest",...t}));function PMe(t){return t?Ng([t.func]):null}const Lit=new Dg(OMe,t=>({__tag:"StencilTest",...t}));function OMe(t){return t?Ng([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const Dit=new Dg(RMe,t=>({__tag:"DepthWrite",...t}));function RMe(t){return t?Ng([t.zNear,t.zFar]):null}const Nit=new Dg($Me,t=>({__tag:"ColorWrite",...t}));function $Me(t){return t?Ng([t.r,t.g,t.b,t.a]):null}const Fit=new Dg(IMe,t=>({__tag:"StencilWrite",...t}));function IMe(t){return t?Ng([t.mask]):null}const kit=new Dg(LMe,t=>({__tag:"DrawBuffers",...t}));function LMe(t){return t?Ng(t.buffers):null}const Uit=new Dg(zit,t=>({blending:wit(t.blending),culling:xit(t.culling),polygonOffset:Sit(t.polygonOffset),depthTest:Tit(t.depthTest),stencilTest:Eit(t.stencilTest),depthWrite:Cit(t.depthWrite),colorWrite:Mit(t.colorWrite),stencilWrite:Ait(t.stencilWrite),drawBuffers:Pit(t.drawBuffers)}));function zit(t){return t?Ng([CMe(t.blending),MMe(t.culling),AMe(t.polygonOffset),PMe(t.depthTest),OMe(t.stencilTest),RMe(t.depthWrite),$Me(t.colorWrite),IMe(t.stencilWrite),LMe(t.drawBuffers)]):null}let Vit=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,i,r,s){return(r||e!==i)&&(s(e),this._pipelineInvalid=!0),e}},Bit=class extends $r{constructor(){super(...arguments),this.heightParameters=Qt(),this.radii=lt(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=lt(),this.backgroundColor=E()}},fR=class DMe extends Wi{initializeProgram(e){return new Yi(e.rctx,DMe.shader.get().build(this.configuration),wi)}initializePipeline(){return this.configuration.reduced?Gt({blending:Ah(Pe.ONE,Pe.ZERO),depthTest:{func:fr.ALWAYS},colorWrite:Kt}):this.configuration.haze?Gt({blending:sa(Pe.ONE,Pe.ZERO,Pe.ONE_MINUS_SRC_COLOR,Pe.ONE),colorWrite:Kt}):Gt({blending:Ah(Pe.SRC_ALPHA,Pe.ONE_MINUS_SRC_ALPHA),depthTest:{func:fr.LEQUAL},colorWrite:Kt})}};fR.shader=new Bi(_it,()=>fe(()=>Promise.resolve().then(()=>rUt),void 0));let jl=class extends $r{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,i={key:this.key};for(const r of e)i[r]=this[r];return i}};function B(t={}){return(e,i)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(i),t.constValue!=null)Object.defineProperty(e,i,{get:()=>t.constValue});else{const r=e._parameterNames.length-1,s=t.count||2,n=Math.ceil(Math.log2(s)),o=e._parameterBits??[0];let a=0;for(;o[a]+n>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<n)-1<<l;o[a]+=n,Object.defineProperty(e,i,{get(){return this[r]},set(u){if(this[r]!==u&&(this[r]=u,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+u<<l&c,typeof u!="number"&&typeof u!="boolean"))throw new Error("Configuration value for "+i+" must be boolean or number, got "+typeof u)}})}}}let NMe=class extends jl{constructor(){super(...arguments),this.haze=!1}};h([B()],NMe.prototype,"haze",void 0);let FMe=class extends NMe{constructor(){super(...arguments),this.reduced=!1}};h([B()],FMe.prototype,"reduced",void 0);var Xr,Ao;(function(t){t[t.RED=0]="RED",t[t.RG=1]="RG",t[t.RGBA4=2]="RGBA4",t[t.RGBA=3]="RGBA",t[t.RGBA_MIPMAP=4]="RGBA_MIPMAP",t[t.R16F=5]="R16F",t[t.RGBA16F=6]="RGBA16F"})(Xr||(Xr={})),function(t){t[t.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",t[t.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(Ao||(Ao={}));let bs=class{constructor(e,i,r,s,n,o=!1,a=0){this.name=e,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}};new bs(R.POSITION,3,Me.FLOAT,0,12);const oie=[new bs(R.POSITION,2,Me.FLOAT,0,8)],mL=[new bs(R.POSITION,2,Me.FLOAT,0,16),new bs(R.UV0,2,Me.FLOAT,8,16)];function Git(t){switch(t){case Me.BYTE:case Me.UNSIGNED_BYTE:return 1;case Me.SHORT:case Me.UNSIGNED_SHORT:case Me.HALF_FLOAT:return 2;case Me.FLOAT:case Me.INT:case Me.UNSIGNED_INT:return 4}}function kMe(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function p0(t,e){return t.vertexBuffers[e].usedMemory/jit(t.layout[e])}function jit(t){return t[0].stride}function aie(t,e,i,r,s=0){var o;const n=t.gl;t.bindBuffer(i);for(const a of r){const l=e.get(a.name);if(l===void 0){console.warn(`There is no location for vertex attribute '${a.name}' defined.`);continue}const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&t.gl.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let u=0;u<3;u++)n.vertexAttribPointer(l+u,3,a.type,a.normalized,a.stride,a.offset+12*u+c),n.enableVertexAttribArray(l+u),a.divisor>0&&t.gl.vertexAttribDivisor(l+u,a.divisor);else if(a.count===16)for(let u=0;u<4;u++)n.vertexAttribPointer(l+u,4,a.type,a.normalized,a.stride,a.offset+16*u+c),n.enableVertexAttribArray(l+u),a.divisor>0&&((o=t.gl)==null||o.vertexAttribDivisor(l+u,a.divisor));else console.error("Unsupported vertex attribute element count: "+a.count);if(Gp()){const u=kMe(t),d=Git(a.type),p=a.offset,m=Math.round(d/p)!==d/p?`. Offset not a multiple of stride. DataType requires ${d} bytes, but descriptor has an offset of ${p}`:"";u&&console.error(`Unable to bind vertex attribute "${a.name}" with baseInstanceOffset ${c}${m}:`,u,a)}}}function UMe(t,e,i,r){var n,o,a;const s=t.gl;t.bindBuffer(i);for(const l of r){const c=e.get(l.name);if(l.count<=4)s.disableVertexAttribArray(c),l.divisor&&l.divisor>0&&((n=t.gl)==null||n.vertexAttribDivisor(c,0));else if(l.count===9)for(let u=0;u<3;u++)s.disableVertexAttribArray(c+u),l.divisor&&l.divisor>0&&((o=t.gl)==null||o.vertexAttribDivisor(c+u,0));else if(l.count===16)for(let u=0;u<4;u++)s.disableVertexAttribArray(c+u),l.divisor&&l.divisor>0&&((a=t.gl)==null||a.vertexAttribDivisor(c+u,0));else console.error("Unsupported vertex attribute element count: "+l.count)}t.unbindBuffer(Tt.ARRAY_BUFFER)}function lie(t){switch(t){case Ft.ALPHA:case Ft.LUMINANCE:case Ft.RED:case Ft.RED_INTEGER:case gt.R8:case gt.R8I:case gt.R8UI:case gt.R8_SNORM:case _a.STENCIL_INDEX8:return 1;case Ft.LUMINANCE_ALPHA:case Ft.RG:case Ft.RG_INTEGER:case gt.RGBA4:case gt.R16F:case gt.R16I:case gt.R16UI:case gt.RG8:case gt.RG8I:case gt.RG8UI:case gt.RG8_SNORM:case gt.RGB565:case gt.RGB5_A1:case _a.DEPTH_COMPONENT16:return 2;case Ft.DEPTH_COMPONENT:case Ft.RGB:case Ft.RGB_INTEGER:case gt.RGB8:case gt.RGB8I:case gt.RGB8UI:case gt.RGB8_SNORM:case gt.SRGB8:case _a.DEPTH_COMPONENT24:return 3;case Ft.DEPTH_STENCIL:case Ft.DEPTH24_STENCIL8:case Ft.RGBA:case Ft.RGBA_INTEGER:case gt.RGBA8:case gt.R32F:case gt.R11F_G11F_B10F:case gt.RG16F:case gt.R32I:case gt.R32UI:case gt.RG16I:case gt.RG16UI:case gt.RGBA8I:case gt.RGBA8UI:case gt.RGBA8_SNORM:case gt.SRGB8_ALPHA8:case gt.RGB9_E5:case gt.RGB10_A2UI:case gt.RGB10_A2:case _a.DEPTH_STENCIL:case _a.DEPTH_COMPONENT32F:case _a.DEPTH24_STENCIL8:return 4;case _a.DEPTH32F_STENCIL8:return 5;case gt.RGB16F:case gt.RGB16I:case gt.RGB16UI:return 6;case gt.RG32F:case gt.RG32I:case gt.RG32UI:case gt.RGBA16F:case gt.RGBA16I:case gt.RGBA16UI:return 8;case gt.RGB32F:case gt.RGB32I:case gt.RGB32UI:return 12;case gt.RGBA32F:case gt.RGBA32I:case gt.RGBA32UI:return 16;case qs.COMPRESSED_RGB_S3TC_DXT1_EXT:case qs.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case qs.COMPRESSED_RGBA_S3TC_DXT3_EXT:case qs.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case qs.COMPRESSED_R11_EAC:case qs.COMPRESSED_SIGNED_R11_EAC:case qs.COMPRESSED_RGB8_ETC2:case qs.COMPRESSED_SRGB8_ETC2:case qs.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case qs.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case qs.COMPRESSED_RG11_EAC:case qs.COMPRESSED_SIGNED_RG11_EAC:case qs.COMPRESSED_RGBA8_ETC2_EAC:case qs.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}const KD=()=>ie.getLogger("esri.views.webgl.VertexArrayObject");let Of=class{constructor(e,i,r,s,n=null){this._context=e,this._locations=i,this._layout=r,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,i)=>e+this._buffers[i].usedMemory,this._indexBuffer!=null?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*l1e}dispose(){var e;if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const i in this._buffers)(e=this._buffers[i])==null||e.dispose(),delete this._buffers[i];this._indexBuffer=It(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&KD().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(nn.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,i=e.createVertexArray();e.bindVertexArray(i),this._bindLayout(),e.bindVertexArray(null),this._glName=i,this._context.instanceCounter.increment(nn.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:i,_indexBuffer:r}=this;e||KD().error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in e){const o=e[n];o||KD().error("Vertex buffer is uninitialized!");const a=i[n];a||KD().error("Vertex element descriptor is empty!"),aie(this._context,this._locations,o,a)}r!=null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}},Fg=class extends Of{};const _ue=()=>ie.getLogger("esri.views.webgl.BufferObject");let vr=class jw{static createIndex(e,i,r){return new jw(e,Tt.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(e,i,r){return new jw(e,Tt.ARRAY_BUFFER,i,r)}static createUniform(e,i,r){return new jw(e,Tt.UNIFORM_BUFFER,i,r)}static createPixelPack(e,i=rr.STREAM_READ,r){const s=new jw(e,Tt.PIXEL_PACK_BUFFER,i);return r&&s.setSize(r),s}static createPixelUnpack(e,i=rr.STREAM_DRAW,r){return new jw(e,Tt.PIXEL_UNPACK_BUFFER,i,r)}static createTransformFeedback(e,i=rr.STATIC_DRAW,r){const s=new jw(e,Tt.TRANSFORM_FEEDBACK_BUFFER,i);return s.setSize(r),s}constructor(e,i,r,s){this._context=e,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(nn.BufferObject,this),this._glName=this._context.gl.createBuffer(),qm(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===Tt.ELEMENT_ARRAY_BUFFER?this._indexType===Me.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===Tt.ELEMENT_ARRAY_BUFFER||this.bufferType===Tt.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(nn.BufferObject,this),this._context=null):this._glName&&_ue().warn("Leaked WebGL buffer object")}setSize(e,i=null){if(this.bufferType===Tt.ELEMENT_ARRAY_BUFFER&&i!=null)switch(this._indexType=i,i){case Me.UNSIGNED_SHORT:e*=2;break;case Me.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let i=e.byteLength;this.bufferType===Tt.ELEMENT_ARRAY_BUFFER&&(HV(e)&&(i/=2,this._indexType=Me.UNSIGNED_SHORT),kK(e)&&(i/=4,this._indexType=Me.UNSIGNED_INT)),this._setBufferData(i,e)}_setBufferData(e,i=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;i!=null?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,e,this.usage),qm(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,i,r,s){if(!e)return;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:o}=this._context;o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,e,r,s-r),qm(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,i=0,r,s){if(r<0||s<0)return;const n=Hit(e)?e.BYTES_PER_ELEMENT:1;if(n*((r??0)+(s??0))>e.byteLength)return;i+n*(s??0)>this.usedMemory&&_ue().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===Tt.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,Tt.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(Tt.TRANSFORM_FEEDBACK_BUFFER,i,e,r,s),this._context.unbindBuffer(Tt.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,Tt.COPY_READ_BUFFER),o.getBufferSubData(Tt.COPY_READ_BUFFER,i,e,r,s),this._context.unbindBuffer(Tt.COPY_READ_BUFFER))}async getSubDataAsync(e,i=0,r,s){await this._context.clientWaitAsync(),this.getSubData(e,i,r,s)}};function Hit(t){return UUe(t)}var P0;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(P0||(P0={}));let jr=class{constructor(e=0,i=e){this.width=e,this.height=i,this.target=Is.TEXTURE_2D,this.pixelFormat=Ft.RGBA,this.dataType=sl.UNSIGNED_BYTE,this.samplingMode=ii.LINEAR,this.wrapMode=bi.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function qit(t){return t.width<=0||t.height<=0?0:Math.round(t.width*t.height*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:lie(t.internalFormat)))}let Wit=class zMe extends jr{constructor(e,i){switch(super(),this.context=e,Object.assign(this,i),this.internalFormat){case gt.R16F:case gt.R16I:case gt.R16UI:case gt.R32F:case gt.R32I:case gt.R32UI:case gt.R8_SNORM:case gt.R8:case gt.R8I:case gt.R8UI:this.pixelFormat=Ft.RED}}static validate(e,i){return new zMe(e,i)}};const vue=4;let br=class Jh{constructor(e,i=null,r=null){if(this.type=P0.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,r=i;else{const s=Wit.validate(e,i);if(!s)throw new V("Texture descriptor invalid");this._descriptor=s}this._descriptor.target===Is.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return qit(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(nn.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,i){const r=this._descriptor;if(r.width!==e||r.height!==i){if(this._wasImmutablyAllocated)throw new V("Immutable textures can't be resized!");r.width=e,r.height=i,this._descriptor.target===Is.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let i=Is.TEXTURE_CUBE_MAP_POSITIVE_X;i<=Is.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(e,i)}setData(e){this._setData(e)}_setData(e,i){var c;if(!((c=this._descriptor.context)!=null&&c.gl))return;const r=this._descriptor.context.gl;qm(r),this._glName||(this._glName=r.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(nn.Texture,this)),e===void 0&&(e=null);const s=this._descriptor,n=i??s.target,o=kP(n);e===null&&(s.width=s.width||vue,s.height=s.height||vue,o&&(s.depth=s.depth??1));const a=this._descriptor.context.bindTexture(this,Jh.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Jh.TEXTURE_UNIT_FOR_UPDATES),eN(s),this._configurePixelStorage(),qm(r);const l=this._deriveInternalFormat();if(xue(e)){let u="width"in e?e.width:e.codedWidth,d="height"in e?e.height:e.codedHeight;const p=1;e instanceof HTMLVideoElement&&(u=e.videoWidth,d=e.videoHeight),s.width&&s.height,o&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,u,d,p),this._texImage(n,0,l,u,d,p,e),qm(r),s.hasMipmap&&this.generateMipmap(),s.width||(s.width=u),s.height||(s.height=d),o&&!s.depth&&(s.depth=p)}else{const{width:u,height:d,depth:p}=s;if(u==null||d==null)throw new V("Width and height must be specified!");if(o&&p==null)throw new V("Depth must be specified!");if(s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,u,d,p),T5(e)){const m=e.levels,g=Sue(n,u,d,p),y=Math.min(g-1,m.length-1);r.texParameteri(s.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,y);const v=l;if(!Xit(v))throw new V("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((b,w,x,T)=>{const C=m[Math.min(b,m.length-1)];this._compressedTexImage(n,b,v,w,x,T,C)},y)}else this._texImage(n,0,l,u,d,p,e),qm(r),s.hasMipmap&&this.generateMipmap()}bue(r,this._descriptor),wue(r,this._descriptor),Yit(this._descriptor.context,this._descriptor),qm(r),this._descriptor.context.bindTexture(a,Jh.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,i,r,s,n,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor,c=this._deriveInternalFormat(),{context:u,pixelFormat:d,dataType:p,target:m,isImmutable:g}=l;if(g&&!this._wasImmutablyAllocated)throw new V("Cannot update immutable texture before allocation!");const y=u.bindTexture(this,Jh.TEXTURE_UNIT_FOR_UPDATES,!0);(i<0||r<0||i+s>l.width||r+n>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:v}=u;a&&v.pixelStorei(v.UNPACK_SKIP_ROWS,a),xue(o)?v.texSubImage2D(m,e,i,r,s,n,d,p,o):T5(o)?v.compressedTexSubImage2D(m,e,i,r,s,n,c,o.levels[e]):v.texSubImage2D(m,e,i,r,s,n,d,p,o),a&&v.pixelStorei(v.UNPACK_SKIP_ROWS,0),u.bindTexture(y,Jh.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor,u=this._deriveInternalFormat(),{context:d,pixelFormat:p,dataType:m,isImmutable:g,target:y}=c;if(g&&!this._wasImmutablyAllocated)throw new V("Cannot update immutable texture before allocation!");kP(y)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=d.bindTexture(this,Jh.TEXTURE_UNIT_FOR_UPDATES);d.setActiveTexture(Jh.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||i+n>c.width||r+o>c.height||s+a>c.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:b}=d;if(T5(l))l=l.levels[e],b.compressedTexSubImage3D(y,e,i,r,s,n,o,a,u,l);else{const w=l;b.texSubImage3D(y,e,i,r,s,n,o,a,p,m,w)}d.bindTexture(v,Jh.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new V("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,eN(e)}e.samplingMode===ii.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=ii.LINEAR_MIPMAP_NEAREST):e.samplingMode===ii.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=ii.NEAREST_MIPMAP_NEAREST);const i=this._descriptor.context.bindTexture(this,Jh.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Jh.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(i,Jh.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new V("Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,eN(e)}e.samplingMode===ii.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,e.samplingMode=ii.LINEAR):e.samplingMode===ii.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=ii.NEAREST)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,eN(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor,i=e.context.gl;this._samplingModeDirty&&(bue(i,e),this._samplingModeDirty=!1),this._wrapModeDirty&&(wue(i,e),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===Ft.DEPTH_STENCIL&&(this._descriptor.internalFormat=Ft.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case sl.FLOAT:switch(this._descriptor.pixelFormat){case Ft.RGBA:return this._descriptor.internalFormat=gt.RGBA32F;case Ft.RGB:return this._descriptor.internalFormat=gt.RGB32F;default:throw new V("Unable to derive format")}case sl.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case Ft.RGBA:return this._descriptor.internalFormat=gt.RGBA8;case Ft.RGB:return this._descriptor.internalFormat=gt.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===Ft.DEPTH_STENCIL?Ft.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(e,i,r,s,n,o){const{gl:a}=this._descriptor.context;if(!Zit(i))throw new V("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?Sue(e,s,n,o):1;if(kP(e)){if(o==null)throw new V("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,i,s,n,o)}else a.texStorage2D(e,l,i,s,n);this._wasImmutablyAllocated=!0}_texImage(e,i,r,s,n,o,a){const l=this._descriptor.context.gl,c=kP(e),{isImmutable:u,pixelFormat:d,dataType:p}=this._descriptor;if(u){if(a!=null){const m=a;if(c){if(o==null)throw new V("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,i,0,0,0,s,n,o,d,p,m)}else l.texSubImage2D(e,i,0,0,s,n,d,p,m)}}else{const m=a;if(c){if(o==null)throw new V("Missing depth dimension for 3D texture upload");l.texImage3D(e,i,r,s,n,o,0,d,p,m)}else l.texImage2D(e,i,r,s,n,0,d,p,m)}}_compressedTexImage(e,i,r,s,n,o,a){const l=this._descriptor.context.gl,c=kP(e);if(this._descriptor.isImmutable){if(a!=null)if(c){if(o==null)throw new V("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,i,0,0,0,s,n,o,r,a)}else l.compressedTexSubImage2D(e,i,0,0,s,n,r,a)}else if(c){if(o==null)throw new V("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,i,r,s,n,o,0,a)}else l.compressedTexImage2D(e,i,r,s,n,0,a)}_forEachMipmapLevel(e,i=1/0){let{width:r,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===Is.TEXTURE_3D;if(r==null||s==null||l&&n==null)throw new V("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,r,s,n),o&&(r!==1||s!==1||l&&n!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}};function eN(t){(t.width!=null&&t.width<0||t.height!=null&&t.height<0||t.depth!=null&&t.depth<0)&&console.error("Negative dimension parameters are not allowed!")}function bue(t,e){let i=e.samplingMode,r=e.samplingMode;i===ii.LINEAR_MIPMAP_NEAREST||i===ii.LINEAR_MIPMAP_LINEAR?(i=ii.LINEAR,e.hasMipmap||(r=ii.LINEAR)):i!==ii.NEAREST_MIPMAP_NEAREST&&i!==ii.NEAREST_MIPMAP_LINEAR||(i=ii.NEAREST,e.hasMipmap||(r=ii.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,i),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,r)}function wue(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function Yit(t,e){const i=t.capabilities.textureFilterAnisotropic;i&&t.gl.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function Zit(t){return t in gt}function Xit(t){return t in qs}function T5(t){return t!=null&&"type"in t&&t.type==="compressed"}function Jit(t){return t!=null&&"byteLength"in t}function xue(t){return t!=null&&!T5(t)&&!Jit(t)}function kP(t){return t===Is.TEXTURE_3D||t===Is.TEXTURE_2D_ARRAY}function Sue(t,e,i,r=1){let s=Math.max(e,i);return t===Is.TEXTURE_3D&&(s=Math.max(s,r)),Math.round(Math.log(s)/Math.LN2)+1}br.TEXTURE_UNIT_FOR_UPDATES=0;function kg(t,e=oie,i=wi,r=-1,s=1){let n=null;return e===mL?n=new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]):n=new Float32Array([r,r,s,r,r,s,s,s]),new Fg(t,i,{geometry:e},{geometry:vr.createVertex(t,rr.STATIC_DRAW,n)})}const Qit=4;function VMe(t){const e=new jr(Qit);return e.samplingMode=ii.NEAREST,new br(t,e)}const vz=16;function c1(t){return Math.ceil(t/vz)*vz}function BMe(t){return Math.floor(t/vz)*vz}function Kit(t,e){let n=t.width*t.height;if(n<4096)return t instanceof ImageData?GMe(t):t;let o=t.width,a=t.height;do o=Math.ceil(o/2),a=Math.ceil(a/2),n=o*a;while(n>1048576||e!=null&&(o>e||a>e));return cie(t,o,a)}function ert(t,e){const i=Math.max(t.width,t.height);if(i<=e)return t;const r=e/i;return cie(t,Math.round(t.width*r),Math.round(t.height*r))}function cie(t,e,i){if(t instanceof ImageData)return cie(GMe(t),e,i);const r=document.createElement("canvas");return r.width=e,r.height=i,r.getContext("2d").drawImage(t,0,0,r.width,r.height),r}function GMe(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");if(i==null)throw new V("Failed to create 2d context from HTMLCanvasElement");return i.putImageData(t,0,0),e}function Oa(t,e=!0){t.attributes.add(R.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(S`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?S`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let uie=class extends $r{};function jMe(t){const e=new Vi;e.include(Oa),e.fragment.uniforms.add(new mt("colorTexture",r=>r.color),new mt("depthTexture",r=>r.depth));const i=t.haze;return e.fragment.code.add(S`
    void main() {
      float depthSample = texture(depthTexture, uv).r;
      if (depthSample ${i?S`== 1.0`:S`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `),e}const trt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:uie,build:jMe},Symbol.toStringTag,{value:"Module"}));let XY=class HMe extends Wi{initializeProgram(e){return new Yi(e.rctx,HMe.shader.get().build(this.configuration),wi)}initializePipeline(){return this.configuration.haze?Gt({blending:sa(Pe.ONE,Pe.ZERO,Pe.ONE_MINUS_SRC_COLOR,Pe.ONE),depthTest:{func:fr.ALWAYS},colorWrite:Kt}):Gt({blending:Ah(Pe.SRC_ALPHA,Pe.ONE_MINUS_SRC_ALPHA),depthTest:{func:fr.ALWAYS},colorWrite:Kt})}};XY.shader=new Bi(trt,()=>fe(()=>Promise.resolve().then(()=>sUt),void 0));let irt=class{constructor(e,i){this._view=e,this._context=i,this.type=ka.Realistic,this._handles=new Pg,this._compositingPassParameters=new uie,this._passParameters=new Bit,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=ir.radius,this._fadeHaze=0,this._updateRadius(ir.radius);const r=this._context.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([ue(()=>{var n,o;return(o=(n=this._view)==null?void 0:n.basemapTerrain)==null?void 0:o.rootTileElevationBounds},()=>{var n;return(n=this._view)!=null&&n.basemapTerrain?this._updateRootTileElevationBounds():null}),ue(()=>{var n,o;return(o=(n=this._view)==null?void 0:n.basemapTerrain)==null?void 0:o.visibleElevationBounds},()=>{var n;return(n=this._view)!=null&&n.basemapTerrain?this._updateVisibleElevationBounds():null}),ue(()=>{var n;return(n=this._view)==null?void 0:n.environment.background},n=>{const o=n instanceof iMe?i3(n.color):wh;ne(this._passParameters.backgroundColor,o[0]*o[3],o[1]*o[3],o[2]*o[3])},sr)]);const s=new FMe;s.haze=!1,this._atmosphereTechnique=this._context.techniques.acquire(fR,s),this._compositingTechnique=this._context.techniques.acquire(XY,s),s.haze=!0,this._atmosphereHazeTechnique=this._context.techniques.acquire(fR,s),this._compositingHazeTechnique=this._context.techniques.acquire(XY,s),s.reduced=!0,s.haze=!1,this._atmosphereReducedTechnique=this._context.techniques.acquire(fR,s),s.haze=!0,this._atmosphereHazeReducedTechnique=this._context.techniques.acquire(fR,s),this._vao=kg(r,mL)}destroy(){this._handles.destroy(),this._compositingTechnique.release(),this._compositingHazeTechnique.release(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,i){this._render(e,i?this._atmosphereTechnique:this._atmosphereReducedTechnique,i,!1)}renderHaze(e,i,r){this._fadeHaze=i,this._render(e,r?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,r,!0)}_render(e,i,r,s){const n=e.bindParameters.mainDepth;if(!n)return;this._update(e.bindParameters.camera),this._passParameters.depthTexture=n;const o=e.rctx.bindTechnique(i,e.bindParameters,this._passParameters),a=e.offscreenRenderingHelper;if(r)a.renderDepthDetached(()=>this._renderCommon(o,e));else{const l=e.rctx.getViewport(),c=Ae(e.bindParameters.camera.eye)-ir.radius;let u;if(c<Av){const y=Math.min(1,Math.max(0,c/Av));u=s?Dt(.4,.5,y):Dt(.2,.3,y)}else{const y=Math.min(1,Math.max(0,(c-Av)/(15*Av)));u=s?Dt(.5,1,y):Dt(.3,.6,y)}const d=c1(Math.round(u*e.bindParameters.camera.fullViewport[2])),p=c1(Math.round(u*e.bindParameters.camera.fullViewport[3]));e.rctx.setViewport(0,0,d,p);const m=a.renderToCachedFBO(null,s?"chapman haze":"chapman",()=>this._renderCommon(o,e),[0,0,0,1],Xr.RGBA,null,d,p);e.rctx.setViewport(l.x,l.y,l.width,l.height),this._compositingPassParameters.color=m.getTexture(),this._compositingPassParameters.depth=n;const g=s?this._compositingHazeTechnique:this._compositingTechnique;e.rctx.bindTechnique(g,e.bindParameters,this._compositingPassParameters),a.renderDepthDetached(()=>e.rctx.screen.draw()),m.release()}}_renderCommon(e,i){this._vao!=null&&(i.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.rctx.drawArrays(vi.TRIANGLE_STRIP,0,4))}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=ir.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=rrt(ir.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,Pi(this._passParameters.radii,e,e+Av),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-GY)*GY)}_update(e){if(!e)return;const i=Za(e.eye),r=Math.sqrt(i),s=i-this._passParameters.radii[1]*this._passParameters.radii[1],n=Te((r-this._passParameters.radii[0])/Av,0,1);ds(this._passParameters.heightParameters,r,i,s,n),this._passParameters.altitudeFade=rie(r-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=Dt(Dt(.6,1,FI(9500,10500,r-ir.radius)),1,this._fadeHaze)}};function rrt(t){return t*Math.cos(Math.PI/16/16)}function hie(t){t.fragment.code.add(S`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function die(t,e){switch(t.include(lf,e),e.textureCoordinateType){case ps.Default:case ps.Compressed:return void t.fragment.code.add(S`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case ps.Atlas:return t.include(hie),void t.fragment.code.add(S`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case ps.None:case ps.COUNT:return}}let Sh=class extends Fs{constructor(e,i){super(e,"vec3",Hi.Draw,(r,s,n,o)=>r.setUniform3fv(e,i(s,n,o)))}},dg=class extends Fs{constructor(e,i){super(e,"sampler2D",Hi.Draw,(r,s,n)=>r.bindTexture(e,i(s,n)))}},pb=class{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){this._techniques.release(this._technique)}get technique(){return this._technique}get _stippleTextures(){return this._techniques.constructionContext.stippleTextures}get _markerTextures(){return this._techniques.constructionContext.markerTextures}ensureTechnique(e,i){return this._technique=this._techniques.releaseAndAcquire(e,this._material.getConfiguration(this._output,i),this._technique),this._technique}ensureResources(e){return B1.LOADED}},pie=class extends pb{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this._textureId=e.textureId,this._acquire(e.textureId,i=>this._texture=i),this._acquire(e.normalTextureId,i=>this._textureNormal=i),this._acquire(e.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(e.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(e.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=ti(this._texture),this._textureNormal=ti(this._textureNormal),this._textureEmissive=ti(this._textureEmissive),this._textureOcclusion=ti(this._textureOcclusion),this._textureMetallicRoughness=ti(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?B1.LOADED:B1.LOADING}get textureBindParameters(){return new qMe(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=ti(this._texture),this._textureId=e,this._acquire(this._textureId,i=>this._texture=i))}_acquire(e,i){if(e==null)return void i(null);const r=this._textures.acquire(e);if(Cu(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return ti(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}},qMe=class extends $r{constructor(e=null,i=null,r=null,s=null,n=null,o,a){super(),this.texture=e,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=s,this.textureMetallicRoughness=n,this.scale=o,this.normalTextureTransformMatrix=a}};var xt;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Simplified=5]="Simplified",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(xt||(xt={}));function fie(t,e){const i=t.fragment,r=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===xt.Normal&&r&&t.include(die,e),e.pbrMode!==xt.Schematic)if(e.pbrMode!==xt.Disabled){if(e.pbrMode===xt.Normal){i.code.add(S`vec3 mrr;
vec3 emission;
float occlusion;`);const s=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(i.uniforms.add(s===Hi.Pass?new mt("texMetallicRoughness",n=>n.textureMetallicRoughness):new dg("texMetallicRoughness",n=>n.textureMetallicRoughness)),i.code.add(S`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(i.uniforms.add(s===Hi.Pass?new mt("texEmission",n=>n.textureEmissive):new dg("texEmission",n=>n.textureEmissive)),i.code.add(S`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(i.uniforms.add(s===Hi.Pass?new mt("texOcclusion",n=>n.textureOcclusion):new dg("texOcclusion",n=>n.textureOcclusion)),i.code.add(S`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(S`float getBakedOcclusion() { return 1.0; }`),s===Hi.Pass?i.uniforms.add(new Vt("emissionFactor",n=>n.emissiveFactor),new Vt("mrrFactors",n=>n.mrrFactors)):i.uniforms.add(new Sh("emissionFactor",n=>n.emissiveFactor),new Sh("mrrFactors",n=>n.mrrFactors)),i.code.add(S`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?S`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?S`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?S`applyEmission(${e.hasEmissiveTextureTransform?S`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?S`applyOcclusion(${e.hasOcclusionTextureTransform?S`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else i.code.add(S`float getBakedOcclusion() { return 1.0; }`);else i.code.add(S`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function mie(t,e){const i=t.fragment,r=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new Vt("lightingAmbientSH0",(s,n)=>ne(Tue,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),i.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add(new zi("lightingAmbientSH_R",(s,n)=>ds(Qg,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new zi("lightingAmbientSH_G",(s,n)=>ds(Qg,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new zi("lightingAmbientSH_B",(s,n)=>ds(Qg,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))),i.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add(new Vt("lightingAmbientSH0",(s,n)=>ne(Tue,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new zi("lightingAmbientSH_R1",(s,n)=>ds(Qg,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new zi("lightingAmbientSH_G1",(s,n)=>ds(Qg,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new zi("lightingAmbientSH_B1",(s,n)=>ds(Qg,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new zi("lightingAmbientSH_R2",(s,n)=>ds(Qg,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new zi("lightingAmbientSH_G2",(s,n)=>ds(Qg,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new zi("lightingAmbientSH_B2",(s,n)=>ds(Qg,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))),i.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==xt.Normal&&e.pbrMode!==xt.Schematic||i.code.add(S`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Tue=E(),Qg=Qt();function gL(t){t.vertex.code.add(S`const float PI = 3.141592653589793;`),t.fragment.code.add(S`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var eg,eT;function srt(t){return(t==null?void 0:t.cubeMap)!=null}function nrt(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FADING=1]="FADING",t[t.FINISHED=2]="FINISHED"})(eg||(eg={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(eT||(eT={}));function j0(t=ort){return[t[0],t[1],t[2],t[3]]}function q6(t,e,i=j0()){return ce(i,t),i[3]=e,i}function Eue(t,e,i=Qt()){return ot(i,t,e),ge(i,i),i[3]=-mbe(t,e),i}function Y6t(t,e=j0()){const i=PSe(mR,t);return WMe(e,Ma(ZB(e,i))),e}function Cue(t,e,i=j0()){return rz(mR,t,Mue(t)),rz(Aue,e,Mue(e)),XB(mR,Aue,mR),WMe(i,Ma(ZB(i,mR)))}function Z6t(t,e,i,r=j0()){return q6(QK,t,tN),q6(KK,e,Pue),q6(wM,i,Oue),Cue(tN,Pue,tN),Cue(tN,Oue,r),r}function X6t(t){return t}function J6t(t){return t[3]}function Mue(t){return Rt(t[3])}function WMe(t,e){return t[3]=e,t}const ort=[0,0,1,0],mR=Oh(),Aue=Oh();j0();const tN=j0(),Pue=j0(),Oue=j0();var Mi;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(Mi||(Mi={}));let art=class{constructor(){this.readChannels=eT.RG,this.renderingStage=eg.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=E(),this.parallax=new Rue,this.parallaxNew=new Rue,this.pointOnGround=E(),this.fadeMode=Ur.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const i=this.parallax,r=Ae(e.eye);if(i.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(r*r-ir.radius*ir.radius,0))/r,Eue($ue,i.anchorPointClouds,JT),uu(i.transform,Vr,JT[3],JT),this.fadeMode===Ur.CROSS_FADE){const s=this.parallaxNew;Eue($ue,s.anchorPointClouds,JT),uu(s.transform,Vr,JT[3],JT)}}updateFading(e,i,r,s){this.isFading&&this._advanceFading(r,s),this._evaluateFading(e,i,r)}_evaluateFading(e,i,r){const s=e.relativeElevation,n=this._calculateDistanceToAnchorPoint(e);if((s>1.7*Zy||s<-Zy||n>drt)&&this.opacity>0)this._setFade(Ur.HIDE,r);else if(!this.isFading){if((s>Zy||s<-.35*Zy||n>hrt)&&this.opacity>0)this._setFade(Ur.FADE_OUT,r);else if(s<=Zy&&s>=-.35*Zy&&i===Mi.IDLE&&nrt(this.data)){if(this.opacity===0)return void this._setFade(Ur.FADE_IN,r);(n>urt||this.renderingStage===eg.FADING)&&this._setFade(Ur.CROSS_FADE,r)}}}_advanceFading(e,i){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,i)}_advanceFadingFactorAndOpacity(e,i){if(this.fadeFactor<1)return this.fadeFactor=i?Te((e-this.startTime)/(crt*i),0,1):1,this.fadeMode===Ur.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===Ur.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===Ur.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===Ur.FADE_OUT&&(this.opacity=0),this.fadeMode===Ur.FADE_IN&&(this.opacity=1),this.fadeMode===Ur.CROSS_FADE&&(this.opacity=1),this.fadeMode=Ur.NONE}_switchReadChannels(){const e=this.fadeMode===Ur.CROSS_FADE&&this.fadeFactor===1,i=this.fadeMode===Ur.FADE_IN&&this.fadeFactor===0;this.renderingStage===eg.FADING&&(e||i)&&(this.readChannels=1-this.readChannels,this.renderingStage=eg.FINISHED)}_calculateDistanceToAnchorPoint(e){return ge(this.pointOnGround,e.eye),oe(this.pointOnGround,this.pointOnGround,ir.radius),Ae(ve(lrt,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===Ur.CROSS_FADE&&(this.fadeFactor===0&&ce(this.parallaxNew.anchorPointClouds,this.pointOnGround),this.fadeFactor===1&&ce(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===Ur.FADE_IN&&this.fadeFactor===0&&ce(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,i){switch(e){case Ur.HIDE:this.opacity=0;break;case Ur.FADE_OUT:this.opacity=1;break;case Ur.FADE_IN:this.opacity=0;break;case Ur.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=i}get isFading(){return this.fadeMode===Ur.FADE_OUT||this.fadeMode===Ur.FADE_IN||this.fadeMode===Ur.CROSS_FADE}};var Ur;(function(t){t[t.NONE=0]="NONE",t[t.HIDE=1]="HIDE",t[t.FADE_OUT=2]="FADE_OUT",t[t.FADE_IN=3]="FADE_IN",t[t.CROSS_FADE=4]="CROSS_FADE"})(Ur||(Ur={}));let Rue=class{constructor(){this.anchorPointClouds=E(),this.radiusCurvatureCorrectionFactor=0,this.transform=Ee()}};const $ue=$e(0,0,1),JT=j0(),lrt=E(),crt=1.25,urt=34e3,hrt=64e3,drt=2e5;let pg=class extends Fs{constructor(e,i){super(e,"bool",Hi.Pass,(r,s,n)=>r.setUniform1b(e,i(s,n)))}},prt=class extends Fs{constructor(e,i){super(e,"samplerCube",Hi.Pass,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function YMe(t){const e=t.fragment;e.uniforms.add(new ss("rotationMatrixClouds",(i,r)=>r.cloudsFade.parallax.transform),new ss("rotationMatrixCloudsCrossFade",(i,r)=>r.cloudsFade.parallaxNew.transform),new Vt("anchorPosition",(i,r)=>r.cloudsFade.parallax.anchorPointClouds),new Vt("anchorPositionCrossFade",(i,r)=>r.cloudsFade.parallaxNew.anchorPointClouds),new qe("cloudsHeight",()=>utt),new qe("radiusCurvatureCorrectionFactor",(i,r)=>r.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new qe("totalFadeInOut",(i,r)=>1-r.cloudsFade.opacity),new qe("crossFadeAnchorFactor",(i,r)=>Te(r.cloudsFade.fadeFactor,0,1)),new prt("cubeMap",(i,r)=>{var s,n;return((n=(s=r.cloudsFade.data)==null?void 0:s.cubeMap)==null?void 0:n.colorTexture)??null}),new pg("crossFade",(i,r)=>r.cloudsFade.fadeMode===Ur.CROSS_FADE),new pg("readChannelsRG",(i,r)=>r.cloudsFade.readChannels===eT.RG),new pg("fadeTextureChannels",(i,r)=>r.cloudsFade.renderingStage===eg.FADING)),e.constants.add("planetRadius","float",ir.radius),e.code.add(S`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(S`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(S`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),G0(e),Lg(e),e.code.add(S`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(S`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(S`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(S`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(S`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function Ug(t){t.code.add(S`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function ZMe(){const t=new Vi,{attributes:e,varyings:i,vertex:r,fragment:s}=t;return e.add(R.POSITION,"vec2"),i.add("worldRay","vec3"),r.uniforms.add(new ss("inverseProjectionMatrix",(n,o)=>o.camera.inverseProjectionMatrix),new ss("inverseViewMatrix",(n,o)=>rb(frt,o.camera.viewMatrix))),r.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),s.include(Ug),s.include(Uf),t.include(mie,{pbrMode:xt.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(gL),t.include(gG),t.include(gz),t.include(YMe),s.uniforms.add(new Vt("cameraPosition",(n,o)=>o.camera.eye)),s.code.add(S`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const frt=Ee(),mrt=Object.freeze(Object.defineProperty({__proto__:null,build:ZMe},Symbol.toStringTag,{value:"Module"}));let XMe=class JMe extends Wi{constructor(e){super(e,new jl,()=>this.destroy())}initializeProgram(e){return new Yi(e.rctx,JMe.shader.get().build(),wi)}initializePipeline(){return Gt({blending:sa(Pe.ONE,Pe.ZERO,Pe.SRC_ALPHA,Pe.ONE),depthTest:{func:fr.LEQUAL},colorWrite:Kt})}};XMe.shader=new Bi(mrt,()=>fe(()=>Promise.resolve().then(()=>nUt),void 0));let Hw=class extends Re{constructor(e){super(e),this._technique=new XMe(e),this._vao=kg(e.rctx)}destroy(){this._technique=ti(this._technique),this._vao=It(this._vao)}render(e){if(!this._technique.compiled)return void this.requestRender();const i=e.bindParameters.cloudsFade;if(this._vao==null||i.data==null)return;const r=e.rctx.bindTechnique(this._technique,e.bindParameters,grt);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(vi.TRIANGLE_STRIP,0,4)}};h([f({constructOnly:!0})],Hw.prototype,"rctx",void 0),h([f({constructOnly:!0})],Hw.prototype,"viewingMode",void 0),h([f({constructOnly:!0})],Hw.prototype,"planetRadius",void 0),h([f({constructOnly:!0})],Hw.prototype,"requestRender",void 0),Hw=h([I("esri.views.3d.environment.CloudsComposition")],Hw);const grt=new $r;function nu(){return new Float32Array(3)}function JY(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Tr(t,e,i){const r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r}function yrt(t,e){return new Float32Array(t,e,3)}function gie(){return nu()}function QMe(){return Tr(1,1,1)}function KMe(){return Tr(1,0,0)}function eAe(){return Tr(0,1,0)}function tAe(){return Tr(0,0,1)}const _rt=gie(),vrt=QMe(),brt=KMe(),wrt=eAe(),xrt=tAe();Object.freeze(Object.defineProperty({__proto__:null,ONES:vrt,UNIT_X:brt,UNIT_Y:wrt,UNIT_Z:xrt,ZEROS:_rt,clone:JY,create:nu,createView:yrt,fromValues:Tr,ones:QMe,unitX:KMe,unitY:eAe,unitZ:tAe,zeros:gie},Symbol.toStringTag,{value:"Module"}));var vc;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(vc||(vc={}));let E5=class extends jl{constructor(){super(...arguments),this.steps=vc.SIXTEEN,this.writeTextureChannels=eT.RG}};h([B({count:vc.COUNT})],E5.prototype,"steps",void 0),h([B({constValue:re("esri-mobile")?1024:2048})],E5.prototype,"cubeMapSize",void 0),h([B()],E5.prototype,"writeTextureChannels",void 0);let gR=class{constructor(e,i,r,s,n,o,a,l,c=.5){this.coverage=e,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const Iue=new gR([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],vc.SIXTEEN),Fa={sunny:Iue,cloudy:new gR([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],vc.TWOHUNDRED,.6),rainy:new gR([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],vc.TWOHUNDRED,.4),snowy:new gR([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],vc.HUNDRED,.65),foggy:new gR([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],vc.SIXTEEN),default:Iue},gd=re("esri-mobile")?64:128,Srt=gd/128,Fp=Math.ceil(Math.sqrt(gd)),u1=(gd+2)*Fp,Trt=1e5,W6=128,Ert=u1/1560;let Jd=class extends Fs{constructor(e,i){super(e,"mat3",Hi.Pass,(r,s,n)=>r.setUniformMatrix3fv(e,i(s,n)))}},yie=class extends $r{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=Fa.default.raymarchingSteps,this.weatherTile=lt(),this.viewMatrix=Gr()}};function iAe(t){const e=new Vi;e.include(Oa,!1);const i=e.fragment;return i.uniforms.add(new qe("cloudRadius",r=>r.cloudRadius),new qe("power",r=>Dt(35,120,r.absorption)),new qe("sigmaE",r=>1+r.absorption),new qe("density",r=>Dt(0,.3,r.density)),new qe("cloudSize",r=>Dt(0,.02,Math.max(.01,1-r.cloudSize))),new qe("detailSize",r=>Dt(0,.2,Math.max(.01,1-r.detailSize))),new qe("smoothness",r=>Dt(0,.5,1-r.smoothness)),new qe("cloudHeight",r=>Dt(0,1500,r.cloudHeight)),new qe("coverage",r=>r.coverage),new Jd("view",r=>r.viewMatrix),new mt("cloudShapeTexture",r=>r.noiseTexture!=null?r.noiseTexture.textureAtlas:null),new Fr("cloudVariables",r=>Pi(Crt,r.coverage,r.absorption))),i.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),i.code.add(S`
    const int STEPS = ${t.steps===vc.SIXTEEN?S`16`:t.steps===vc.HUNDRED?S`100`:S`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(S`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${S.float(u1)};
      const float dataWidth = ${S.float(u1)};
      const float tileRows = ${S.float(Fp)};
      const vec3 atlasDimensions = vec3(${S.float(gd)}, ${S.float(gd)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${S.float(Srt)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${S.float(Ert)} * p) / ${S.float(u1)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),i.code.add(S`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(S`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),i.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),i.code.add(S`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(S`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.code.add(S`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const Crt=lt(),Mrt=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:yie,build:iAe},Symbol.toStringTag,{value:"Module"}));let rAe=class sAe extends Wi{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new Yi(e.rctx,sAe.shader.get().build(this.configuration),wi)}initializePipeline(){return Gt({blending:Ah(Pe.CONSTANT_COLOR,Pe.ONE_MINUS_CONSTANT_COLOR,M0.ADD,this.configuration.writeTextureChannels===eT.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:fr.LEQUAL},colorWrite:Kt})}};rAe.shader=new Bi(Mrt,()=>fe(()=>Promise.resolve().then(()=>oUt),void 0));var dh;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(dh||(dh={}));let QY=class extends jl{constructor(){super(...arguments),this.mode=dh.Full}};h([B({count:dh.COUNT})],QY.prototype,"mode",void 0);let _ie=class extends $r{constructor(){super(...arguments),this.weatherTile=_i(0,0)}};function nAe(t){const e=new Vi;return e.include(Oa,!1),e.fragment.code.add(S`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===dh.Full&&e.fragment.code.add(S`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${S.float(Fp)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${S.float(8)});

      float worley0 = worley(p, ${S.float(2)} * 2.0);
      float worley1 = worley(p, ${S.float(2)} * 8.0);
      float worley2 = worley(p, ${S.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${S.float(2)});
      float worley1 = worley(p, ${S.float(2)} * 2.0);
      float worley2 = worley(p, ${S.float(2)} * 4.0);
      float worley3 = worley(p, ${S.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new Fr("weatherTile",i=>i.weatherTile)),e.fragment.code.add(S`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${S.float(W6)});

      // Get global coordinates of p
      p += weatherTile * ${S.float(W6)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${S.float(Trt)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(S`void main() {`),t.mode===dh.Full&&e.fragment.code.add(S`
        float padWidth = 1.0;
        float paddedSize = ${S.float(gd)} + 2.0 * padWidth;
        float tileCount = ${S.float(Fp)} * ${S.float(Fp)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${S.float(gd)};
          }

          if (startPadY) {
            pixel.y += ${S.float(gd)};
          }

          if (endPadX) {
            pixel.x -= ${S.float(gd)};
          }

          if (endPadY) {
            pixel.y -= ${S.float(gd)};
          }

          uv = vec2(pixel.xy / ${S.float(gd)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${S.float(gd)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${S.float(Fp)} * ${S.float(Fp)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${S.float(Fp)} * ${S.float(Fp)});
        p = p_;
        p.z /= (${S.float(Fp)} * ${S.float(Fp)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(S`
      vec2 mapUV = ${S.float(W6)} * (gl_FragCoord.xy / ${S.float(u1)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===dh.Full?S`fragColor.ba = vec2(0.0, map);`:S`fragColor = vec4(map);`};
    }
  `),e}const Art=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:_ie,build:nAe},Symbol.toStringTag,{value:"Module"}));let KY=class oAe extends Wi{initializeProgram(e){return new Yi(e.rctx,oAe.shader.get().build(this.configuration),wi)}initializePipeline(){return Gt({blending:this.configuration.mode===dh.Full?Ah(Pe.ONE,Pe.ZERO):sa(Pe.ZERO,Pe.ONE,Pe.ONE,Pe.ZERO),depthTest:{func:fr.ALWAYS},colorWrite:Kt})}};KY.shader=new Bi(Art,()=>fe(()=>Promise.resolve().then(()=>aUt),void 0));let aAe=class{constructor(e,i,r=i){this.internalFormat=e,this.width=i,this.height=r,this.multisampled=!1,this.samples=1}};function Prt(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*lie(t.internalFormat)}let lAe=class{constructor(e,i){this._context=e,this._descriptor=i,this.type=P0.RenderBuffer,this._context.instanceCounter.increment(nn.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=i;a?r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,s,n):r.renderbufferStorage(r.RENDERBUFFER,o,s,n),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,i=this._context.parameters.maxSamples;return e?Math.min(e,i):i}get usedMemory(){return Prt(this._descriptor)}resize(e,i){const r=this._descriptor;if(r.width===e&&r.height===i)return;r.width=e,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(nn.Renderbuffer,this),this._context=null)}};const Ort=()=>ie.getLogger("esri.views.webgl.FramebufferObject");let zg=class yR{constructor(e,i,r=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(nn.FramebufferObject,this);const s=C5(i)?i:new br(this._context,i);if(this._colorAttachments.set(qn.COLOR_ATTACHMENT0,s),this._validateTextureDescriptor(s.descriptor),this._validateColorAttachmentPoint(qn.COLOR_ATTACHMENT0),r!=null)if($rt(r))this._depthStencilTexture=C5(r)?r:new br(this._context,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const n=Rrt(r)?r:new lAe(this._context,r);this._depthStencilBuffer=n,this._validateRenderBufferDescriptor(n.descriptor)}}dispose(){var i,r;if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((s,n)=>{var o;return(o=this.detachColorTexture(n))==null?void 0:o.dispose()}),(i=this.detachDepthStencilBuffer())==null||i.dispose(),(r=this.detachDepthStencilTexture())==null||r.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(nn.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(qn.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){var i;const e=this._colorAttachments.get(qn.COLOR_ATTACHMENT0);return((i=e==null?void 0:e.descriptor)==null?void 0:i.width)??0}get height(){var i;const e=this._colorAttachments.get(qn.COLOR_ATTACHMENT0);return((i=e==null?void 0:e.descriptor)==null?void 0:i.height)??0}get usedMemory(){var e;return[...this._colorAttachments].reduce((i,[r,s])=>i+s.usedMemory,((e=this.depthStencil)==null?void 0:e.usedMemory)??0)}getColorTexture(e){const i=this._colorAttachments.get(e);return i&&C5(i)?i:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,i=qn.COLOR_ATTACHMENT0){var s;if(!e)return;this._validateColorAttachmentPoint(i);const r=e.descriptor;this._validateTextureDescriptor(r),(s=this.detachColorTexture(i))==null||s.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,i)),this._colorAttachments.set(i,e)}detachColorTexture(e=qn.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);if(i){if(this._initialized){const r=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e),this._context.bindFramebuffer(r)}return this._colorAttachments.delete(e),i}}setColorTextureTarget(e,i=qn.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);r&&this._framebufferTexture2D(r.glName,i,e)}attachDepthStencil(e){if(e)switch(e.type){case P0.Texture:return this._attachDepthStencilTexture(e);case P0.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){var r;if(e==null)return;const i=e.descriptor;i.pixelFormat!==Ft.DEPTH_STENCIL&&i.pixelFormat!==Ft.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==sl.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._validateTextureDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,eA)),(r=this._depthStencilTexture)==null||r.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;if(e&&this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,eA),this._context.bindFramebuffer(i)}return this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const i=e.descriptor;if(this._validateRenderBufferDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,s=this._getGLAttachmentPoint(i);r.framebufferRenderbuffer(Va.FRAMEBUFFER,s,r.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const r=this._context.gl,s=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(Va.FRAMEBUFFER,s,r.RENDERBUFFER,null),this._context.bindFramebuffer(i)}return this._depthStencilBuffer=null,e}copyToTexture(e,i,r,s,n,o,a){(e<0||i<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==Is.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||e+r>this.width||i+s>this.height||n+r>l.width||o+s>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,u=c.bindTexture(a,br.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(br.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(Is.TEXTURE_2D,0,n,o,e,i,r,s),c.bindTexture(u,br.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,i,r,s,n,o,a){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,i,r,s,n,o,a)}async readPixelsAsync(e,i,r,s,n,o,a){const{gl:l}=this._context,c=vr.createPixelPack(this._context,rr.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,i,r,s,n,o,0),this._context.unbindBuffer(Tt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,i){var s,n;if(this.width===e&&this.height===i)return;const r={width:e,height:i};Yx(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(o=>o.resize(r.width,r.height)),(s=this._depthStencilTexture)==null||s.resize(r.width,r.height),this._initialized&&(Yx(r,this._context.parameters.maxRenderbufferSize),(n=this._depthStencilBuffer)==null||n.resize(r.width,r.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=Va.FRAMEBUFFER){const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(e,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=i.createFramebuffer();if(i.bindFramebuffer(e,r),this._colorAttachments.forEach((s,n)=>this._framebufferTexture2D(s.glName,n,Lue(s),e)),this._depthStencilBuffer){const s=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);i.framebufferRenderbuffer(e,s,i.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,Lue(this._depthStencilTexture),e);Gp()&&i.checkFramebufferStatus(e)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,i=qn.COLOR_ATTACHMENT0,r=Is.TEXTURE_2D,s=Va.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,i,r,e,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const i=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(Va.FRAMEBUFFER,i,e.RENDERBUFFER,null)}this._depthStencilBuffer=It(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=It(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==Is.TEXTURE_2D&&e.target!==Is.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),Yx(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){Yx(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case _a.DEPTH_COMPONENT16:case _a.DEPTH_COMPONENT24:case _a.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case _a.DEPTH24_STENCIL8:case _a.DEPTH32F_STENCIL8:case _a.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case _a.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(yR._MAX_COLOR_ATTACHMENTS===-1){const{gl:r}=this._context;yR._MAX_COLOR_ATTACHMENTS=r.getParameter(r.MAX_COLOR_ATTACHMENTS)}const i=e-qn.COLOR_ATTACHMENT0;i+1>yR._MAX_COLOR_ATTACHMENTS&&ie.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${yR._MAX_COLOR_ATTACHMENTS} color attachments`)}};function C5(t){return t!=null&&"type"in t&&t.type===P0.Texture}function Rrt(t){return t!=null&&"type"in t&&t.type===P0.RenderBuffer}function $rt(t){return C5(t)||t!=null&&"pixelFormat"in t}function Yx(t,e){const i=Math.max(t.width,t.height);if(i>e){Ort().warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const r=e/i;return t.width=Math.round(t.width*r),t.height=Math.round(t.height*r),!1}return!0}function Lue(t){return t.descriptor.target===Is.TEXTURE_CUBE_MAP?Is.TEXTURE_CUBE_MAP_POSITIVE_X:Is.TEXTURE_2D}zg._MAX_COLOR_ATTACHMENTS=-1;let _R=class extends Re{constructor(e){super(e),this._needsRender=!0,this._passParameters=new _ie,this._fbo=new zg(e.context.renderContext.rctx,new jr(u1)),this._vao=kg(e.context.renderContext.rctx)}get _techniques(){return this.context.techniques}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(dh.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(dh.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(Aa(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=ti(this._fullTechniqueCached),this._weatherMapTechniqueCached=ti(this._weatherMapTechniqueCached),this._fbo=It(this._fbo),this._vao=It(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new QY;e.mode=dh.Full,this._fullTechniqueCached=this._techniques.acquire(KY,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new QY;e.mode=dh.WeatherMap,this._weatherMapTechniqueCached=this._techniques.acquire(KY,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._fbo==null)return null;const i=e===dh.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,s=r.getViewport();r.setViewport(0,0,u1,u1),r.bindFramebuffer(this._fbo);const n=r.bindTechnique(i,null,this._passParameters);return r.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._fbo.colorTexture}};h([f({constructOnly:!0})],_R.prototype,"context",void 0),h([f({readOnly:!0})],_R.prototype,"_techniques",null),_R=h([I("esri.views.3d.environment.NoiseTextureAtlas")],_R);function _G(t){return t?{ray:uo(t.ray),c0:t.c0,c1:t.c1}:{ray:uo(),c0:0,c1:Number.MAX_VALUE}}function Irt(t,e=_G()){return JU(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function Lrt(t,e,i=_G()){const r=Ae(t.vector);return aTe(t.origin,e,i.ray),i.c0=0,i.c1=r,i}function d8t(t,e){return cAe(t,t.c0,e)}function p8t(t,e){return cAe(t,t.c1,e)}function cAe(t,e,i){return me(i,t.ray.origin,oe(i,t.ray.direction,e))}new U0(()=>_G());function s3(t){return t?[Qi(t[0]),Qi(t[1]),Qi(t[2]),Qi(t[3]),Qi(t[4]),Qi(t[5])]:[Qi(),Qi(),Qi(),Qi(),Qi(),Qi()]}function uAe(){return[E(),E(),E(),E(),E(),E(),E(),E()]}function bz(t,e){for(let i=0;i<WA;i++)DB(t[i],e[i]);return t}function hAe(t,e,i,r=zrt){const s=dr(Wee.get(),e,t);In(s,s);for(let n=0;n<krt;++n){const o=hu(qee.get(),Urt[n],s);ne(r[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}dAe(i,r)}function dAe(t,e){qa(e[pt.FAR_BOTTOM_LEFT],e[pt.NEAR_BOTTOM_LEFT],e[pt.NEAR_TOP_LEFT],t[_r.LEFT]),qa(e[pt.NEAR_BOTTOM_RIGHT],e[pt.FAR_BOTTOM_RIGHT],e[pt.FAR_TOP_RIGHT],t[_r.RIGHT]),qa(e[pt.FAR_BOTTOM_LEFT],e[pt.FAR_BOTTOM_RIGHT],e[pt.NEAR_BOTTOM_RIGHT],t[_r.BOTTOM]),qa(e[pt.NEAR_TOP_LEFT],e[pt.NEAR_TOP_RIGHT],e[pt.FAR_TOP_RIGHT],t[_r.TOP]),qa(e[pt.NEAR_BOTTOM_LEFT],e[pt.NEAR_BOTTOM_RIGHT],e[pt.NEAR_TOP_RIGHT],t[_r.NEAR]),qa(e[pt.FAR_BOTTOM_RIGHT],e[pt.FAR_BOTTOM_LEFT],e[pt.FAR_TOP_LEFT],t[_r.FAR])}function Zv(t,e){for(let i=0;i<WA;i++){const r=t[i];if(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=e[3])return!1}return!0}function Drt(t,e){return fAe(t,Irt(e,mAe.get()))}function f8t(t,e){for(let i=0;i<WA;i++){const r=t[i];if(!R9e(r,e))return!1}return!0}function Nrt(t,e,i){return fAe(t,Lrt(e,i,mAe.get()))}function pAe(t,e){for(let i=0;i<WA;i++)if(Er(t[i],e)>0)return!1;return!0}function fAe(t,e){for(let i=0;i<WA;i++)if(!O9e(t[i],e))return!1;return!0}var _r,pt;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(_r||(_r={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(pt||(pt={}));const Frt={bottom:[pt.FAR_BOTTOM_RIGHT,pt.NEAR_BOTTOM_RIGHT,pt.NEAR_BOTTOM_LEFT,pt.FAR_BOTTOM_LEFT],near:[pt.NEAR_BOTTOM_LEFT,pt.NEAR_BOTTOM_RIGHT,pt.NEAR_TOP_RIGHT,pt.NEAR_TOP_LEFT],far:[pt.FAR_BOTTOM_RIGHT,pt.FAR_BOTTOM_LEFT,pt.FAR_TOP_LEFT,pt.FAR_TOP_RIGHT],right:[pt.NEAR_BOTTOM_RIGHT,pt.FAR_BOTTOM_RIGHT,pt.FAR_TOP_RIGHT,pt.NEAR_TOP_RIGHT],left:[pt.FAR_BOTTOM_LEFT,pt.NEAR_BOTTOM_LEFT,pt.NEAR_TOP_LEFT,pt.FAR_TOP_LEFT],top:[pt.FAR_TOP_LEFT,pt.NEAR_TOP_LEFT,pt.NEAR_TOP_RIGHT,pt.FAR_TOP_RIGHT]},WA=6,krt=8,Urt=[Wt(-1,-1,-1,1),Wt(1,-1,-1,1),Wt(1,1,-1,1),Wt(-1,1,-1,1),Wt(-1,-1,1,1),Wt(1,-1,1,1),Wt(1,1,1,1),Wt(-1,1,1,1)],mAe=new U0(_G),zrt=uAe();function Vrt(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function Brt(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function Grt(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function jrt(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}let eZ=class{constructor(){this.adds=new Zt,this.removes=new Zt,this.updates=new Zt({allocator:e=>e||new Hrt,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},Hrt=class{},qrt=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var Zp,ai;function gAe(t){const e=new Map,i=r=>{let s=e.get(r);return s||(s=new qrt,e.set(r,s)),s};return t.removes.forAll(r=>{Y6(r)&&i(r.material).removes.push(r)}),t.adds.forAll(r=>{Y6(r)&&i(r.material).adds.push(r)}),t.updates.forAll(r=>{Y6(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),e}function Y6(t){return t.geometry.indexCount>=1}(function(t){t[t.Default=0]="Default",t[t.Screenshot=1]="Screenshot",t[t.ObjectAndLayerID=2]="ObjectAndLayerID"})(Zp||(Zp={})),function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"}(ai||(ai={}));var tZ;let oi=tZ=class extends Re{constructor(t){super(t),this._ray=uo(),this._viewport=Wt(0,0,1,1),this._padding=Wt(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=_i(1,1e3),this._viewDirty=!0,this._viewMatrix=Ee(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Ee(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Ee(),this._frustumDirty=!0,this._frustum=s3(),this._fullViewport=Qt(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=E(),this._up=E(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return ve(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){vn(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),ne(E(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),ne(E(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),ne(E(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=HS(Qt(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&qS(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=HS(Qt(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&qS(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[ai.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[ai.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[ai.RIGHT]+this._padding[ai.LEFT]}set fullWidth(t){this.width=t-(this._padding[ai.RIGHT]+this._padding[ai.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[ai.TOP]+this._padding[ai.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[ai.TOP]+this._padding[ai.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[ai.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[ai.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){BC(this._padding,t)||(this._viewport[0]+=t[ai.LEFT]-this._padding[ai.LEFT],this._viewport[1]+=t[ai.BOTTOM]-this._padding[ai.BOTTOM],this._viewport[2]-=t[ai.RIGHT]+t[ai.LEFT]-(this._padding[ai.RIGHT]+this._padding[ai.LEFT]),this._viewport[3]-=t[ai.TOP]+t[ai.BOTTOM]-(this._padding[ai.TOP]+this._padding[ai.BOTTOM]),Rd(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(dr(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return In(Ee(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||Ee()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Grt(this._fov,this.width,this.height)}set fovX(t){this._fov=Vrt(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return jrt(this._fov,this.width,this.height)}set fovY(t){this._fov=Brt(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return wr(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(In(this._viewInverseTransposeMatrix,this.viewMatrix),bu(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}get _projectionMatrixInternal(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2)*2,r=i*this._aspect,s=i/this.rows,n=r/this.columns,o=-r/2+this.column*n,a=o+n,l=-i/2+this.row*s,c=l+s,u=OSe(Ee(),o*(1+2*this._padding[ai.LEFT]/t),a*(1+2*this._padding[ai.RIGHT]/t),l*(1+2*this._padding[ai.BOTTOM]/e),c*(1+2*this._padding[ai.TOP]/e),this.near,this.far),d=this._get("projectionMatrix");return d&&RB(d,u)?d:u}copyFrom(t){ce(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,Rd(this._viewport,t.viewport),this.notifyChange("_viewport"),Rd(this._padding,t.padding),this.notifyChange("_padding"),Aa(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(vn(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(bz(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(vn(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Rd(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new tZ().copyFrom(this)}equals(t){return Oo(this.eye,t.eye)&&Oo(this.center,t.center)&&Oo(this.up,t.up)&&BC(this._viewport,t.viewport)&&BC(this._padding,t.padding)&&yMe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||ZU(t.screenPadding,this.screenPadding)>=e||ZU(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;Ai(Ra,t.eye,t.center),Ai(Z6,this.eye,this.center);const i=pe(Ra,Z6),r=yU(Ra),s=yU(Z6),n=5e-4;return i*i>=(1-1e-10)*r*s&&DI(t.eye,this.eye)<Math.max(r,s)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(s1(this.viewForward,ve(Ra,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=vs()){return t[0]=(this.padding[ai.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[ai.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[ai.LEFT]+this.width*e,t[1]=this.padding[ai.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==Fi&&ce(Fi,t),Fi[3]=1,hu(Fi,Fi,this.projectionMatrix);const i=Math.abs(Fi[3]);oe(Fi,Fi,1/i);const r=this.fullViewport;e[0]=Dt(0,r[0]+r[2],.5+.5*Fi[0]),e[1]=Dt(0,r[1]+r[3],.5+.5*Fi[1]),e[2]=.5*(Fi[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;Fi[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],Fi[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],Fi[2]=(2*t[2]-1)*t[3],Fi[3]=t[3],this.inverseProjectionMatrix!=null&&(hu(Fi,Fi,this.inverseProjectionMatrix),e[0]=Fi[0],e[1]=Fi[1],e[2]=Fi[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,X6),this.renderToScreen(X6,e),e}projectToRenderScreen(t,e){if(Fi[0]=t[0],Fi[1]=t[1],Fi[2]=t[2],Fi[3]=1,hu(Fi,Fi,this.viewProjectionMatrix),Fi[3]===0)return null;const i=Fi;oe(i,i,1/Math.abs(Fi[3]));const r=this.fullViewport,s=Dt(0,r[0]+r[2],.5+.5*i[0]),n=Dt(0,r[1]+r[3],.5+.5*i[1]);return"x"in e?(e.x=s,e.y=n):(e[0]=s,e[1]=n,e.length>2&&(e[2]=.5*(i[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,X6),e)}unprojectFromRenderScreen(t,e){if(dr(iN,this.projectionMatrix,this.viewMatrix),!In(iN,iN))return null;const i=this.fullViewport;return Fi[0]=2*(t[0]-i[0])/i[2]-1,Fi[1]=2*(t[1]-i[1])/i[3]-1,Fi[2]=2*t[2]-1,Fi[3]=1,hu(Fi,Fi,iN),Fi[3]===0?null:(e[0]=Fi[0]/Fi[3],e[1]=Fi[1]/Fi[3],e[2]=Fi[2]/Fi[3],e)}constrainWindowSize(t,e,i,r){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-i/2,0),a=Math.max(this.fullHeight-n-r/2,0),l=-Math.min(s-i/2,0),c=-Math.min(this.fullHeight-n-r/2,0),u=i-l- -Math.min(this.fullWidth-s-i/2,0),d=r-c- -Math.min(n-r/2,0);return[Math.round(o),Math.round(a),Math.round(u),Math.round(d)]}computeUp(t){t===Ge.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){ve(Ra,this.center,this.eye);const t=Ae(this.center);t<1?(ne(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(pe(Ra,this.center))>.9999*Ae(Ra)*t||(ot(this._up,Ra,this.center),ot(this._up,this._up,Ra),ge(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){k0(Ra,this.eye,this.center),Math.abs(Ra[2])<=.9999&&(oe(Ra,Ra,Ra[2]),ne(this._up,-Ra[0],-Ra[1],1-Ra[2]),ge(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?Oo(t,e)||(ce(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):ie.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(hAe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(OB(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};h([f()],oi.prototype,"_viewport",void 0),h([f()],oi.prototype,"_padding",void 0),h([f()],oi.prototype,"_fov",void 0),h([f()],oi.prototype,"_nearFar",void 0),h([f()],oi.prototype,"_viewDirty",void 0),h([f()],oi.prototype,"_viewMatrix",void 0),h([f()],oi.prototype,"_pixelRatio",void 0),h([f()],oi.prototype,"pixelRatio",null),h([f()],oi.prototype,"row",void 0),h([f()],oi.prototype,"column",void 0),h([f()],oi.prototype,"_rows",void 0),h([f()],oi.prototype,"rows",null),h([f()],oi.prototype,"_columns",void 0),h([f()],oi.prototype,"columns",null),h([f()],oi.prototype,"eye",null),h([f()],oi.prototype,"center",null),h([f()],oi.prototype,"_center",void 0),h([f()],oi.prototype,"up",null),h([f()],oi.prototype,"_up",void 0),h([f()],oi.prototype,"viewMatrix",null),h([f({readOnly:!0})],oi.prototype,"viewForward",null),h([f({readOnly:!0})],oi.prototype,"viewUp",null),h([f({readOnly:!0})],oi.prototype,"viewRight",null),h([f({readOnly:!0})],oi.prototype,"nearFar",null),h([f()],oi.prototype,"near",null),h([f()],oi.prototype,"far",null),h([f()],oi.prototype,"viewport",null),h([f({readOnly:!0})],oi.prototype,"screenViewport",null),h([f({readOnly:!0})],oi.prototype,"screenPadding",null),h([f()],oi.prototype,"x",null),h([f()],oi.prototype,"y",null),h([f()],oi.prototype,"width",null),h([f()],oi.prototype,"height",null),h([f()],oi.prototype,"fullWidth",null),h([f()],oi.prototype,"fullHeight",null),h([f({readOnly:!0})],oi.prototype,"_aspect",null),h([f()],oi.prototype,"padding",null),h([f({readOnly:!0})],oi.prototype,"projectionMatrix",null),h([f({readOnly:!0})],oi.prototype,"inverseProjectionMatrix",null),h([f()],oi.prototype,"fov",null),h([f()],oi.prototype,"fovX",null),h([f()],oi.prototype,"fovY",null),h([f()],oi.prototype,"viewInverseTransposeMatrix",null),h([f({readOnly:!0})],oi.prototype,"_projectionMatrixInternal",null),h([f()],oi.prototype,"relativeElevation",void 0),oi=tZ=h([I("esri.views.3d.webgl.RenderCamera")],oi);const Pr=oi,Fi=Qt(),iN=Ee(),Ra=E(),Z6=E(),X6=xa();var fc;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(fc||(fc={}));function Wrt(t){t.include(Ig),t.uniforms.add(new mt("geometryDepthTexture",(e,i)=>{var r;return(r=i.multipassGeometry.depth)==null?void 0:r.attachment})),t.code.add(S`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}let Yrt=class{};function Vg(t,e){if(!e.multipassEnabled)return;t.fragment.include(Ig),t.fragment.uniforms.add(new mt("terrainDepthTexture",(r,s)=>{var n;return(n=s.multipassTerrain.depth)==null?void 0:n.attachment}));const i=e.occlusionPass;t.fragment.code.add(S`
   ${i?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${i?S`return fragmentDepth < linearDepth && depth < 1.0;`:S`
          if(fragmentDepth ${e.cullAboveGround?">":"<="} linearDepth){
            discard;
          }`}
    }`)}let Zrt=class{constructor(){this.cullAboveGround=!1}};var _e;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.OPAQUE_NO_SSAO_DEPTH=3]="OPAQUE_NO_SSAO_DEPTH",t[t.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_NO_SSAO_DEPTH=5]="TRANSPARENT_NO_SSAO_DEPTH",t[t.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",t[t.OPAQUE_ENVIRONMENT=12]="OPAQUE_ENVIRONMENT",t[t.TRANSPARENT_ENVIRONMENT=13]="TRANSPARENT_ENVIRONMENT",t[t.LASERLINES=14]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=15]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=16]="HUD_MATERIAL",t[t.LABEL_MATERIAL=17]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=18]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=19]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=20]="DRAPED_MATERIAL",t[t.DRAPED_WATER=21]="DRAPED_WATER",t[t.VIEWSHED=22]="VIEWSHED",t[t.VOXEL=23]="VOXEL",t[t.MAX_SLOTS=24]="MAX_SLOTS"})(_e||(_e={}));var nt;(function(t){t[t.ColorAlpha=0]="ColorAlpha",t[t.FrontFace=1]="FrontFace",t[t.NONE=2]="NONE",t[t.COUNT=3]="COUNT"})(nt||(nt={}));let vie=class{constructor(e=E()){this.intensity=e}},yAe=class{constructor(e=E(),i=$e(.57735,.57735,.57735)){this.intensity=e,this.direction=i}},wz=class{constructor(e=E(),i=$e(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=e,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}},_Ae=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function Xrt(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function J6(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e;return i}function XC(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function vAe(t){return(t+1)*(t+1)}function Jrt(t){return Te(Math.floor(Math.sqrt(t)-1),0,2)}function bAe(t,e,i){const r=t[0],s=t[1],n=t[2],o=i||[];return o.length=vAe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function Qrt(t,e){const i=vAe(t),r=e||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function Krt(t,e){const i=Jrt(e.r.length);for(const r of t)ea(iZ,r.direction),bAe(iZ,i,Ky),Xrt(Ky,M5),J6(Ky,r.intensity[0],QT),XC(e.r,QT),J6(Ky,r.intensity[1],QT),XC(e.g,QT),J6(Ky,r.intensity[2],QT),XC(e.b,QT);return e}function est(t,e){bAe(iZ,0,Ky);for(const i of t)e.r[0]+=Ky[0]*M5[0]*i.intensity[0]*4*Math.PI,e.g[0]+=Ky[0]*M5[0]*i.intensity[1]*4*Math.PI,e.b[0]+=Ky[0]*M5[0]*i.intensity[2]*4*Math.PI;return e}function tst(t,e,i,r){Qrt(e,r),ne(i.intensity,0,0,0);let s=!1;const n=ist,o=rst,a=sst;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof wz&&!s?(ce(i.direction,l.direction),ce(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof wz||l instanceof yAe?n.push(l):l instanceof vie?o.push(l):l instanceof _Ae&&a.push(l);Krt(n,r),est(o,r);for(const l of a)XC(r.r,l.r),XC(r.g,l.g),XC(r.b,l.b)}const ist=[],rst=[],sst=[],Ky=[0],QT=[0],iZ=E(),M5=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let Due=class{constructor(){this.color=E(),this.intensity=1}},nst=class{constructor(){this.direction=E(),this.ambient=new Due,this.diffuse=new Due}};const wAe=.4;let Q6=class{constructor(){this._shOrder=2,this._legacy=new nst,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new _Ae,this._mainLight=new wz(E(),$e(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){tst(e,this._shOrder,this._mainLight,this._sphericalHarmonics),ce(this._legacy.direction,this._mainLight.direction);const i=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,oe(this._legacy.diffuse.color,this._mainLight.intensity,i),ce(rN,this._legacy.diffuse.color),oe(rN,rN,wAe*this.globalFactor),me(this._legacy.ambient.color,this._legacy.ambient.color,rN)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),ce(this._mainLight.direction,e.mainLight.direction),ce(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,r){if(yr(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=Dt(e.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=Dt(e.mainLight.specularStrength,i.mainLight.specularStrength,r),ce(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=Dt(e.globalFactor,i.globalFactor,r),this.noonFactor=Dt(e.noonFactor,i.noonFactor,r),e.sh.r.length===i.sh.r.length)for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=Dt(e.sh.r[s],i.sh.r[s],r),this._sphericalHarmonics.g[s]=Dt(e.sh.g[s],i.sh.g[s],r),this._sphericalHarmonics.b[s]=Dt(e.sh.b[s],i.sh.b[s],r);else for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=i.sh.r[s],this._sphericalHarmonics.g[s]=i.sh.g[s],this._sphericalHarmonics.b[s]=i.sh.b[s]}};const rN=E();let vG=class{constructor(e,i){this.shadowMap=e,this.slicePlane=i,this.slot=_e.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=nt.NONE,this.alignPixelEnabled=!1,this.decorations=Nl.ON,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new Pr,this._inverseViewport=lt(),this.oldLighting=new Q6,this.newLighting=new Q6,this._fadedLighting=new Q6,this._lighting=this.newLighting,this.ssr=new ost,this.multipassEnabled=!1,this.multipassTerrain=new Zrt,this.multipassGeometry=new Yrt,this.hudRenderStyle=fc.Occluded,this.cloudsFade=new art,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:i,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(i,r,e),this._lighting=this._fadedLighting)}},ost=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=Ee()}};const ia=Symbol("Yield");let ast=class{constructor(){this._tasks=new Array,this._runningTasks=hg(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(this.length===0)return ia;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,i,r){return++this._runningTasks.value,new Promise((s,n)=>this._tasks.push(new Nue(s,n,e,i,r))).finally(()=>--this._runningTasks.value)}unshift(e,i,r){return++this._runningTasks.value,new Promise((s,n)=>this._tasks.unshift(new Nue(s,n,e,i,r))).finally(()=>--this._runningTasks.value)}_process(e){var r;if(this._tasks.length===0)return!1;const i=this._tasks.shift();try{const s=Yn(i.signal);if(s&&!i.abortCallback)i.reject(Di());else{const n=s?(r=i.abortCallback)==null?void 0:r.call(i,Di()):i.callback(e);Cu(n)?n.then(i.resolve,i.reject):i.resolve(n)}}catch(s){i.reject(s)}return!0}cancelAll(){const e=Di();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(e);i.resolve(r)}else i.reject(e);this._tasks.length=0}},Nue=class{constructor(e,i,r,s=void 0,n=void 0){this.resolve=e,this.reject=i,this.callback=r,this.signal=s,this.abortCallback=n}},vR=class extends Re{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};h([f()],vR.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),h([f()],vR.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),vR=h([I("esri.views.support.debugFlags")],vR);const lst=new vR;function cst(){return new xz.Scheduler}var Mt;(function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"})(Mt||(Mt={}));const km=0,Fue=new Map([[Mt.RESOURCE_CONTROLLER_IMMEDIATE,km],[Mt.RESOURCE_CONTROLLER,4],[Mt.SLIDE,km],[Mt.STREAM_DATA_LOADER,km],[Mt.ELEVATION_QUERY,km],[Mt.TERRAIN_SURFACE,1],[Mt.SURFACE_GEOMETRY_UPDATES,1],[Mt.LOD_RENDERER,2],[Mt.GRAPHICS_CORE,2],[Mt.I3S_CONTROLLER,2],[Mt.POINT_CLOUD_LAYER,2],[Mt.FEATURE_TILE_FETCHER,2],[Mt.OVERLAY,4],[Mt.STAGE,4],[Mt.GRAPHICS_DECONFLICTOR,4],[Mt.FILTER_VISIBILITY,4],[Mt.SCALE_VISIBILITY,4],[Mt.FRUSTUM_VISIBILITY,4],[Mt.CLOUDS_GENERATOR,4],[Mt.POINT_OF_INTEREST_FREQUENT,6],[Mt.POINT_OF_INTEREST_INFREQUENT,30],[Mt.LABELER,8],[Mt.FEATURE_QUERY_ENGINE,8],[Mt.FEATURE_TILE_TREE,16],[Mt.FEATURE_TILE_TREE_ACTIVE,km],[Mt.ELEVATION_ALIGNMENT,12],[Mt.ELEVATION_ALIGNMENT_SCENE,14],[Mt.TEXT_TEXTURE_ATLAS,12],[Mt.TEXTURE_UNLOAD,12],[Mt.LINE_OF_SIGHT_TOOL,16],[Mt.LINE_OF_SIGHT_TOOL_INTERACTIVE,km],[Mt.SNAPPING,km],[Mt.SHADOW_ACCUMULATOR,30]]);function kue(t){return Fue.has(t)?Fue.get(t):typeof t=="number"?t:1}const ust=6.5,Uue=1,hst=30,dst=1e3/30,pst=100,zue=.9;var xz,Lb;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=hg(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new r0("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=Mi.INTERACTING,this._tasks=new Zt,this._runQueue=new Zt,this._load=0,this._idleStateCallbacks=new Zt,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=ue(()=>lst.SCHEDULER_LOG_SLOW_TASKS,n=>this._debug=n,cr);for(const n of Object.keys(Mt))this.performanceInfo.tasks.set(Mt[n],new r0(Mt[n]))}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),Or(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=new i(this,n,o);return this._tasks.push(a),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new r0(n)),a}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Mi.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Mi.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==Mi.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){++this._frameNumber;let o=ust,a=n.frameDuration,l=Uue;switch(this.state){case Mi.IDLE:o=0,a=Math.max(pst,n.frameDuration),l=hst;break;case Mi.INTERACTING:a=Math.max(dst,n.frameDuration);case Mi.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==Mi.IDLE&&a<Uue&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Mi.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case Mi.INTERACTING:this._runInteracting();break;default:this._runAnimating()}}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return Lb.SCHEDULED;let o=Lb.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=Lb.READY:o!==Lb.READY&&(o=Lb.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*zue+n*(1-zue)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===km&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==km&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===ia&&(a.blockFrame=this._frameNumber)}catch(c){ie.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c),a.blockFrame=this._frameNumber}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,Mt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(Mt))this._frameTaskTimes.set(Mt[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){}}t.Scheduler=e;class i{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,o,a){this._scheduler=n,this.name=o,this.blockFrame=0,this.runtime=0,this._queue=new ast,this._handles=new Pg,this._basePriority=kue(o),this.schedulePriority=this._basePriority,this._task=hg(a??this._queue),this._handles.add(vu(()=>this.task.running,l=>n.taskRunningChanged(l)))}remove(){this.processQueue(lu),this._scheduler.removeTask(this),this.schedule=tA.schedule,this.reschedule=tA.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){if(this.name===n)return;this.name=n;const o=kue(n);this._basePriority!==km&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){return this._queue.runTask(n)}}class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Mi.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=r})(xz||(xz={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(Lb||(Lb={}));const lu=(()=>{const t=new xz.Budget;return t.enabled=!1,t})();let fst=class{remove(){}processQueue(){}schedule(e,i,r){try{if(Yn(i)){const s=Di();return r?Promise.resolve(r(s)):Promise.reject(s)}return P9(e(lu))}catch(s){return Promise.reject(s)}}reschedule(e,i,r){return this.schedule(e,i,r)}};const tA=new fst;let oc=class extends Re{constructor(e){super(e),this._techniques=new Array,this._techniqueConfiguration=new E5,this._bindParameters=new vG(null,null),this._passParameters=new yie,this._weatherTile=lt(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=Dt(Fa.default.coverage[0],Fa.default.coverage[1],.5),this.density=Dt(Fa.default.density[0],Fa.default.density[1],.5),this.absorption=Dt(Fa.default.absorption[0],Fa.default.absorption[1],.5),this.cloudSize=Dt(Fa.default.cloudSize[0],Fa.default.cloudSize[1],.5),this.detailSize=Dt(Fa.default.detailSize[0],Fa.default.detailSize[1],.5),this.smoothness=Dt(Fa.default.smoothness[0],Fa.default.smoothness[1],.5),this.cloudHeight=Dt(Fa.default.cloudHeight[0],Fa.default.cloudHeight[1],.5),this.raymarchingSteps=Fa.default.raymarchingSteps,this._viewMatrix=Ee(),this._dirty=!1,this.running=!1,this._vao=kg(e.context.renderContext.rctx)}_getTechnique(e){const i=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,r=i===eT.RG?2*e:2*e+1;return this._techniques[r]||(this._techniqueConfiguration.writeTextureChannels=i,this._techniqueConfiguration.steps=e,this._techniques[r]=new rAe({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[r])}updateWeatherTile(){const e=this.view.camera.position.latitude,i=this.view.camera.position.longitude;if(e==null||i==null)return;Pi(this._weatherTile,(e+90)/180,(i+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-r)*this._weatherTile[1]);let s=0,n=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+s)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+n%100)%(4*this._weatherTileCount),_Me(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=ur(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this.addHandles([this.view.resourceController.scheduler.registerTask(Mt.CLOUDS_GENERATOR,this),ue(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),cr)])}destroy(){this._techniques.forEach(e=>ti(e)),this._frameBufferCube=It(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=Le(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case vc.SIXTEEN:return 1;case vc.HUNDRED:return 4;case vc.COUNT:case vc.TWOHUNDRED:return 8}}get usedMemory(){var e,i,r;return(((e=this._frameBufferCube)==null?void 0:e.usedMemory)??0)+(((r=(i=this._passParameters.noiseTexture)==null?void 0:i.textureAtlas)==null?void 0:r.usedMemory)??0)}_ensureNoiseTexture(){var e;return(e=this._passParameters).noiseTexture??(e.noiseTexture=new _R({context:this.context})),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile),this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const i=new jr(e);i.target=Is.TEXTURE_CUBE_MAP,i.wrapMode=bi.CLAMP_TO_EDGE,this._frameBufferCube=new zg(this.context.renderContext.rctx,i)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=It(this._frameBufferCube)}applyPreset(e,i){const r=e.median,s=n=>{const o=Dt(n[0],n[1],r);return i<.5?Dt(n[0],o,2*i):Dt(o,n[1],2*(i-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),Aa(this._passParameters.weatherTile,this._weatherTile));const i=this._getTechnique(this._passParameters.raymarchingSteps);if(!i.compiled||this.context.renderContext.bindParameters.cloudsFade.fadeMode===Ur.CROSS_FADE||!this._ensureNoiseTexture())return ia;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=eg.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const r=mst[this._faceIndex],s=gst[this._faceIndex];$Se(this._viewMatrix,yst,r,s),Xd(this._passParameters.viewMatrix,this._viewMatrix);const n=this.context.renderContext.rctx,o=n.bindTechnique(i,this._bindParameters,this._passParameters);n.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao);const a=n.getViewport(),l=i.configuration.cubeMapSize,c=l/this._tilesPerFace,u=this._tileIndex*c;n.setViewport(0,u,l,c);const d=this._ensureFrameBufferCube(l);n.bindFramebuffer(d);const p=Is.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return d.setColorTextureTarget(p),n.gl.drawArrays(n.gl.TRIANGLE_STRIP,0,4),n.gl.flush(),n.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=eg.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),ia}};h([f({constructOnly:!0})],oc.prototype,"context",void 0),h([f({constructOnly:!0})],oc.prototype,"view",void 0),h([f({constructOnly:!0})],oc.prototype,"requestRender",void 0),h([f()],oc.prototype,"coverage",void 0),h([f()],oc.prototype,"density",void 0),h([f()],oc.prototype,"absorption",void 0),h([f()],oc.prototype,"cloudSize",void 0),h([f()],oc.prototype,"detailSize",void 0),h([f()],oc.prototype,"smoothness",void 0),h([f()],oc.prototype,"cloudHeight",void 0),h([f()],oc.prototype,"raymarchingSteps",void 0),h([f()],oc.prototype,"running",void 0),oc=h([I("esri.views.3d.environment.CloudsGenerator")],oc);const mst=[Tr(1,0,0),Tr(-1,0,0),Tr(0,1,0),Tr(0,-1,0),Tr(0,0,1)],gst=[Tr(0,1,0),Tr(0,1,0),Tr(0,0,-1),Tr(0,0,1),Tr(0,1,0)],yst=gie();let bie=class extends $r{constructor(){super(...arguments),this.fogColor=E(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function xAe(){const t=new Vi;t.attributes.add(R.POSITION,"vec2"),t.include(lf,{textureCoordinateType:ps.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:i}=t;return e.uniforms.add(new ss("inverseProjectionMatrix",(r,s)=>s.camera.inverseProjectionMatrix),new ss("inverseViewMatrix",(r,s)=>rb(_st,s.camera.viewMatrix))),e.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new qe("atmosphereC",r=>r.atmosphereC),new Vt("cameraPosition",(r,s)=>s.camera.eye),new Fr("nearFar",(r,s)=>s.camera.nearFar),new mt("depthTexture",r=>r.depthTexture),new qe("fogStrength",r=>r.fogStrength),new qe("fogAmount",r=>r.fogAmount),new Vt("fogColor",r=>r.fogColor)),t.include(gG),i.include(sie),i.code.add(S`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(S`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),i.code.add(S`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const _st=Ee(),vst=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:bie,build:xAe},Symbol.toStringTag,{value:"Module"}));let SAe=class TAe extends Wi{constructor(e){super(e,new jl,()=>this.destroy())}initializeProgram(e){return new Yi(e.rctx,TAe.shader.get().build(),wi)}initializePipeline(){return Gt({blending:sa(Pe.SRC_ALPHA,Pe.ZERO,Pe.ONE_MINUS_SRC_ALPHA,Pe.ONE),colorWrite:Kt})}};SAe.shader=new Bi(vst,()=>fe(()=>Promise.resolve().then(()=>lUt),void 0));const bst=.95,wst=1;let qw=class extends Re{constructor(e){super(e),this._passParameters=new bie;const i=e.context.renderContext.rctx;this._vao=kg(i,mL),this._technique=new SAe(e);const r=ur(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+Av}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,i){if(this._update(e,i),this._passParameters.fogAmount<=0)return;const r=this._technique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(r,e.bindParameters,this._passParameters);this._renderFog(n,e)})}_renderFog(e,i){const r=i.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(vi.TRIANGLE_STRIP,0,4)}_update(e,i){const r=e.bindParameters.camera;ge(Vue,r.eye);const s=Math.max(0,pe(Vue,e.bindParameters.lighting.mainLight.direction)),n=i.color;oe(Bue,n,.1),yr(this._passParameters.fogColor,Bue,n,s);const o=Ae(r.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-FI(bst*Zy,wst*Zy,Math.abs(o-this._planetRadius)))*i.amount,this._passParameters.fogStrength=i.strength}};h([f({constructOnly:!0})],qw.prototype,"context",void 0),h([f({constructOnly:!0})],qw.prototype,"view",void 0),h([f({constructOnly:!0})],qw.prototype,"rctx",void 0),h([f({constructOnly:!0})],qw.prototype,"viewingMode",void 0),qw=h([I("esri.views.3d.environment.Fog")],qw);let xst=class{constructor(){this.color=E(),this.strength=0,this.amount=0}};const Vue=E(),Bue=E();var G;function Sst(t){return JC(t)||t===G.Depth||t===G.Normal||t===G.ObjectAndLayerIdColor}function JC(t){return t===G.Shadow||t===G.ShadowHighlight||t===G.ShadowExcludeHighlight||t===G.ViewshedShadow}function Y$(t){return rZ(t)||t===G.Normal}function xS(t){return t===G.Highlight||t===G.ObjectAndLayerIdColor}function EAe(t){return t===G.Color||xS(t)}function f0(t){return t===G.Color}function K6(t){return f0(t)||t===G.ObjectAndLayerIdColor}function Tst(t){return f0(t)||t===G.Highlight}function Gue(t){return Tst(t)||h1(t)}function A5(t){return f0(t)||xS(t)}function rZ(t){return A5(t)||h1(t)}function h1(t){return t===G.Depth}(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.ViewshedShadow=6]="ViewshedShadow",t[t.Highlight=7]="Highlight",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(G||(G={}));function wie({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(S`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(S`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let CAe=class extends Fs{constructor(e,i){super(e,"mat4",Hi.Draw,(r,s,n)=>r.setUniformMatrix4fv(e,i(s,n)))}};function Rf(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",$n):t.uniforms.add(new Sh("cameraPosition",(i,r)=>ne(MAe,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function bc(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new ss("proj",(r,s)=>s.camera.projectionMatrix),new CAe("view",(r,s)=>rl(jue,s.camera.viewMatrix,r.origin)),new Sh("localOrigin",r=>r.origin));const i=r=>ne(MAe,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new ss("proj",(r,s)=>s.camera.projectionMatrix),new ss("view",(r,s)=>rl(jue,s.camera.viewMatrix,i(s))),new Vt("localOrigin",(r,s)=>i(s)))}const jue=Ee(),MAe=E();function iA(t){t.uniforms.add(new ss("viewNormal",(e,i)=>i.camera.viewInverseTransposeMatrix))}function YA(t){t.uniforms.add(new qe("pixelRatio",(e,i)=>i.camera.pixelRatio/i.overlayStretch))}function sZ(t,e,i){for(let r=0;r<i;++r)e[2*r]=t[r],e[2*r+1]=t[r]-e[2*r]}function Est(t,e){const i=t.length;for(let r=0;r<i;++r)aC[0]=t[r],e[r]=aC[0];return e}function Cst(t,e){const i=t.length;for(let r=0;r<i;++r)aC[0]=t[r],aC[1]=t[r]-aC[0],e[r]=aC[1];return e}const aC=new Float32Array(2);let nZ=class extends jl{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}};h([B()],nZ.prototype,"instancedDoublePrecision",void 0),h([B()],nZ.prototype,"hasModelTransformation",void 0);const Hue=Gr();function AAe(t,e){const i=e.hasModelTransformation,r=e.instancedDoublePrecision;i&&(t.vertex.uniforms.add(new ss("model",n=>n.modelTransformation??Vr)),t.vertex.uniforms.add(new Jd("normalLocalOriginFromModel",n=>(D1(Hue,n.modelTransformation??Vr),Hue)))),e.instanced&&r&&(t.attributes.add(R.INSTANCEMODELORIGINHI,"vec3"),t.attributes.add(R.INSTANCEMODELORIGINLO,"vec3"),t.attributes.add(R.INSTANCEMODEL,"mat3"),t.attributes.add(R.INSTANCEMODELNORMAL,"mat3"));const s=t.vertex;r&&(s.include(wie,e),s.uniforms.add(new Sh("viewOriginHi",(n,o)=>Est(ne(sN,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),sN)),new Sh("viewOriginLo",(n,o)=>Cst(ne(sN,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),sN)))),s.code.add(S`
    vec3 getVertexInLocalOriginSpace() {
      return ${i?r?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":r?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${r?S`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),s.code.add(S`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${i?r?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":r?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),e.output===G.Normal&&(iA(s),s.code.add(S`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${i?r?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":r?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),e.hasVertexTangents&&s.code.add(S`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${i?r?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":r?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const sN=E();let Ec=class extends nZ{};h([B({constValue:!0})],Ec.prototype,"hasSliceHighlight",void 0),h([B({constValue:!1})],Ec.prototype,"hasSliceInVertexProgram",void 0),h([B({constValue:Hi.Pass})],Ec.prototype,"pbrTextureBindType",void 0);var Eg;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(Eg||(Eg={}));let xie=class extends Ec{constructor(){super(...arguments),this.geometry=Eg.Cone}};h([B({count:Eg.COUNT})],xie.prototype,"geometry",void 0);function yL(t){t.attributes.add(R.POSITION,"vec3"),t.vertex.code.add(S`vec3 positionModel() { return position; }`)}let Sz=class extends Fs{constructor(e,i){super(e,"mat3",Hi.Draw,(r,s,n)=>r.setUniformMatrix3fv(e,i(s,n)))}};function QC(t,e){t.include(yL);const i=t.vertex;i.include(wie,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),i.uniforms.add(new Vt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new Vt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Jd("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new ss("transformProjFromView",r=>r.transformProjFromView),new Sz("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Sh("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Sh("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)),i.code.add(S`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(S`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?S`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:S`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new Vt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(S`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(S`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let Mst=class extends $r{constructor(){super(...arguments),this.transformWorldFromViewTH=E(),this.transformWorldFromViewTL=E(),this.transformViewFromCameraRelativeRS=Gr(),this.transformProjFromView=Ee()}},Ast=class extends $r{constructor(){super(...arguments),this.transformWorldFromModelRS=Gr(),this.transformWorldFromModelTH=E(),this.transformWorldFromModelTL=E()}};function oZ(t){t.varyings.add("linearDepth","float")}function bG(t){t.vertex.uniforms.add(new Fr("nearFar",(e,i)=>i.camera.nearFar))}function PAe(t){t.vertex.code.add(S`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function ZA(t,e){const{vertex:i}=t;switch(e.output){case G.Color:if(e.receiveShadows)return oZ(t),void i.code.add(S`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:case G.ViewshedShadow:return t.include(QC,e),oZ(t),bG(t),PAe(t),void i.code.add(S`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}i.code.add(S`void forwardLinearDepth() {}`)}function Ja(t){PAe(t),t.vertex.code.add(S`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(S`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let wG=class extends $r{constructor(){super(...arguments),this.texV=lt(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new Sie}},Sie=class{constructor(){this.center=E(),this.v1=E(),this.v2=E()}};function OAe(t){const e=new Vi,{vertex:i,fragment:r}=e;if(G0(i),t.geometry===Eg.Underground)e.attributes.add(R.POSITION,"vec2"),e.varyings.add("color","vec4"),i.uniforms.add(new Vt("cameraPosition",(s,n)=>n.camera.eye),new qe("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),i.code.add(S`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(S`void main() {
fragColor = color;
}`);else{e.include(Ja,t),e.attributes.add(R.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===Eg.Cylinder;i.uniforms.add(new ss("proj",(a,l)=>l.camera.projectionMatrix),new ss("view",(a,l)=>l.camera.viewMatrix)),s||(e.varyings.add("innerFactor","float"),i.uniforms.add(new Vt("silCircleCenter",a=>a.silhouette.center)),i.uniforms.add(new Vt("silCircleV1",a=>a.silhouette.v1)),i.uniforms.add(new Vt("silCircleV2",a=>a.silhouette.v2)),i.uniforms.add(new Fr("texV",a=>a.texV)),i.uniforms.add(new qe("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;i.code.add(S`
		void main(void) {
      ${s?S`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:S`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${S.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${S.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new mt("tex",a=>a.texture)),s||r.uniforms.add(new qe("altitudeFade",a=>a.altitudeFade)),r.code.add(S`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?S`fragColor = atmosphereColor;`:S`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const Pst=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:Sie,SimpleAtmospherePassParameters:wG,build:OAe},Symbol.toStringTag,{value:"Module"}));let Tz=class RAe extends Wi{initializeProgram(e){return new Yi(e.rctx,RAe.shader.get().build(this.configuration),wi)}initializePipeline(){return this.configuration.geometry===Eg.Cylinder?Gt({blending:sa(Pe.SRC_ALPHA,Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA,Pe.ONE_MINUS_SRC_ALPHA),culling:nie,depthTest:{func:fr.LEQUAL},colorWrite:Kt}):Gt({blending:sa(Pe.SRC_ALPHA,Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA,Pe.ONE_MINUS_SRC_ALPHA),depthTest:{func:fr.LEQUAL},colorWrite:Kt})}};Tz.shader=new Bi(Pst,()=>fe(()=>Promise.resolve().then(()=>cUt),void 0));const Ost=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Au(t,e=0){const i=t.stride;return Array.from(t.fields.keys()).map(r=>{var c;const s=t.fields.get(r),n=s.constructor.ElementCount,o=Rst(s.constructor.ElementType),a=s.offset,l=((c=s.optional)==null?void 0:c.glNormalized)??!1;return new bs(r,n,o,a,i,l,e)})}function Rst(t){const e=$st[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const $st={u8:Me.UNSIGNED_BYTE,u16:Me.UNSIGNED_SHORT,u32:Me.UNSIGNED_INT,i8:Me.BYTE,i16:Me.SHORT,i32:Me.INT,f32:Me.FLOAT};let Tie=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};Tie.ElementCount=9;let Eie=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};Eie.ElementCount=16;let H0=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,i){this.typedBuffer[e*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}};H0.ElementCount=1;let q0=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,Pi(i,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e]=i[1]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};q0.ElementCount=2;let W0=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,ne(i,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e]=i[2]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=s}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};W0.ElementCount=3;let Y0=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,ds(i,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e++]=i[2],this.typedBuffer[e]=i[3]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};Y0.ElementCount=4;let xG=class $Ae extends H0{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}static fromTypedArray(e,i){return new $Ae(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};xG.ElementType="f32";let OT=class aZ extends q0{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(aZ,e,i)}static fromTypedArray(e,i){return new aZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};OT.ElementType="f32";let po=class lZ extends W0{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(lZ,e,i)}static fromTypedArray(e,i){return new lZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};po.ElementType="f32";let $f=class cZ extends Y0{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(cZ,e,i)}static fromTypedArray(e,i){return new cZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};$f.ElementType="f32";let G1=class uZ extends Tie{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(uZ,e,i)}static fromTypedArray(e,i){return new uZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};G1.ElementType="f32";let Cie=class hZ extends Tie{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(hZ,e,i)}static fromTypedArray(e,i){return new hZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Cie.ElementType="f64";let Mie=class dZ extends Eie{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(dZ,e,i)}static fromTypedArray(e,i){return new dZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Mie.ElementType="f32";let n3=class pZ extends Eie{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(pZ,e,i)}static fromTypedArray(e,i){return new pZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};n3.ElementType="f64";let Aie=class fZ extends H0{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(fZ,e,i)}static fromTypedArray(e,i){return new fZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Aie.ElementType="f64";let Pie=class mZ extends q0{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(mZ,e,i)}static fromTypedArray(e,i){return new mZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Pie.ElementType="f64";let Hd=class gZ extends W0{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(gZ,e,i)}static fromTypedArray(e,i){return new gZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Hd.ElementType="f64";let SG=class yZ extends Y0{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(yZ,e,i)}static fromTypedArray(e,i){return new yZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};SG.ElementType="f64";let rA=class _Z extends H0{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(_Z,e,i)}static fromTypedArray(e,i){return new _Z(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};rA.ElementType="u8";let TG=class vZ extends q0{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(vZ,e,i)}static fromTypedArray(e,i){return new vZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};TG.ElementType="u8";let EG=class bZ extends W0{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(bZ,e,i)}static fromTypedArray(e,i){return new bZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};EG.ElementType="u8";let nl=class wZ extends Y0{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(wZ,e,i)}static fromTypedArray(e,i){return new wZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};nl.ElementType="u8";let CG=class xZ extends H0{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(xZ,e,i)}static fromTypedArray(e,i){return new xZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};CG.ElementType="u16";let Oie=class SZ extends q0{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(SZ,e,i)}static fromTypedArray(e,i){return new SZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Oie.ElementType="u16";let MG=class TZ extends W0{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(TZ,e,i)}static fromTypedArray(e,i){return new TZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};MG.ElementType="u16";let _L=class EZ extends Y0{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(EZ,e,i)}static fromTypedArray(e,i){return new EZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};_L.ElementType="u16";let AG=class CZ extends H0{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(CZ,e,i)}static fromTypedArray(e,i){return new CZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};AG.ElementType="u32";let Rie=class MZ extends q0{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(MZ,e,i)}static fromTypedArray(e,i){return new MZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Rie.ElementType="u32";let IAe=class AZ extends W0{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(AZ,e,i)}static fromTypedArray(e,i){return new AZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};IAe.ElementType="u32";let LAe=class PZ extends Y0{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(PZ,e,i)}static fromTypedArray(e,i){return new PZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};LAe.ElementType="u32";let $ie=class OZ extends H0{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(OZ,e,i)}static fromTypedArray(e,i){return new OZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};$ie.ElementType="i8";let PG=class RZ extends q0{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(RZ,e,i)}static fromTypedArray(e,i){return new RZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};PG.ElementType="i8";let DAe=class $Z extends W0{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer($Z,e,i)}static fromTypedArray(e,i){return new $Z(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};DAe.ElementType="i8";let NAe=class IZ extends Y0{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(IZ,e,i)}static fromTypedArray(e,i){return new IZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};NAe.ElementType="i8";let FAe=class LZ extends H0{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(LZ,e,i)}static fromTypedArray(e,i){return new LZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};FAe.ElementType="i16";let vL=class DZ extends q0{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(DZ,e,i)}static fromTypedArray(e,i){return new DZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};vL.ElementType="i16";let kAe=class NZ extends W0{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(NZ,e,i)}static fromTypedArray(e,i){return new NZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};kAe.ElementType="i16";let UAe=class FZ extends Y0{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(FZ,e,i)}static fromTypedArray(e,i){return new FZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};UAe.ElementType="i16";let zAe=class kZ extends H0{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(kZ,e,i)}static fromTypedArray(e,i){return new kZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};zAe.ElementType="i32";let VAe=class UZ extends q0{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(UZ,e,i)}static fromTypedArray(e,i){return new UZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};VAe.ElementType="i32";let BAe=class zZ extends W0{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(zZ,e,i)}static fromTypedArray(e,i){return new zZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};BAe.ElementType="i32";let GAe=class VZ extends Y0{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(VZ,e,i)}static fromTypedArray(e,i){return new VZ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};GAe.ElementType="i32";function que(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let Wue=class jAe{constructor(e,i){this.layout=e,this.buffer=typeof i=="number"?new ArrayBuffer(i*e.stride):i;for(const r of e.fields.keys()){const s=e.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,i){const r=this[e];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(e,i){return new jAe(this.layout,this.buffer.slice(e*this.stride,i*this.stride))}copyFrom(e,i=0,r=0,s=e.count){const n=this.stride;if(n%4==0){const o=new Uint32Array(e.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(o)}else{const o=new Uint8Array(e.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(o)}return this}get usedMemory(){return this.byteLength}dispose(){}},Ist=class HAe{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(i=>this._fields.set(i[0],{...i[1],constructor:Dst(i[1].constructor)})))}freeze(){return this}vec2f(e,i){return this._appendField(e,OT,i),this}vec2f64(e,i){return this._appendField(e,Pie,i),this}vec3f(e,i){return this._appendField(e,po,i),this}vec3f64(e,i){return this._appendField(e,Hd,i),this}vec4f(e,i){return this._appendField(e,$f,i),this}vec4f64(e,i){return this._appendField(e,SG,i),this}mat3f(e,i){return this._appendField(e,G1,i),this}mat3f64(e,i){return this._appendField(e,Cie,i),this}mat4f(e,i){return this._appendField(e,Mie,i),this}mat4f64(e,i){return this._appendField(e,n3,i),this}vec4u8(e,i){return this._appendField(e,nl,i),this}f32(e,i){return this._appendField(e,xG,i),this}f64(e,i){return this._appendField(e,Aie,i),this}u8(e,i){return this._appendField(e,rA,i),this}u16(e,i){return this._appendField(e,CG,i),this}i8(e,i){return this._appendField(e,$ie,i),this}vec2i8(e,i){return this._appendField(e,PG,i),this}vec2i16(e,i){return this._appendField(e,vL,i),this}vec2u8(e,i){return this._appendField(e,TG,i),this}vec4u16(e,i){return this._appendField(e,_L,i),this}u32(e,i){return this._appendField(e,AG,i),this}_appendField(e,i,r){if(this._fields.has(e))return void ft(!1,`${e} already added to vertex buffer layout`);const s=i.ElementCount*que(i.ElementType),n=this._stride;this._stride+=s,this._fields.set(e,{size:s,constructor:i,offset:n,optional:r})}createBuffer(e){return new Wue(this,e)}createView(e){return new Wue(this,e)}clone(){const e=new HAe;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((i,r)=>e._fields.set(r,i)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(i=>e=Math.max(e,que(i.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function Ts(){return new Ist}let Q8t=class{constructor(e){this.fields=new Array,e.fields.forEach((i,r)=>{const s={...i,constructor:qAe(i.constructor)};this.fields.push([r,s])}),this.stride=e.stride}};const Lst=[xG,OT,po,$f,G1,Mie,Aie,Pie,Hd,SG,Cie,n3,rA,TG,EG,nl,CG,Oie,MG,_L,AG,Rie,IAe,LAe,$ie,PG,DAe,NAe,FAe,vL,kAe,UAe,zAe,VAe,BAe,GAe];function qAe(t){return`${t.ElementType}_${t.ElementCount}`}function Dst(t){return WAe.get(t)}const WAe=new Map;Lst.forEach(t=>WAe.set(qAe(t),t));function ho(t,e=!1){return t<=_u?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function YAe(t){return(wg(t)?t.length:t.byteLength/8)<=_u?Array.from(t):new Float64Array(t)}function Nd(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function Nst(t,e){for(let i=0;i<e.length;++i)t[i]=e[i];return t}function eHt(t){return Array.isArray(t)?new Float64Array(t):t}function ws(t,e=!1){return t<=_u?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function tHt(t){return wg(t)?t.length<_u?t:new Float32Array(t):t.length<_u?Array.from(t):t}function Yue(t){return(wg(t)?t.length:t.byteLength/8)<=_u?Array.from(t):new Float32Array(t)}function Ez(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function fg(t){if(wg(t)){if(t.length<_u)return t}else if(t.length<_u)return Array.from(t);let e=!0,i=!0;return t.some((r,s)=>(e=e&&r===0,i=i&&r===s,!e&&!i)),e?fb(t.length):i?RT(t.length):wg(t)||t.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?Fst(t):t}function Fst(t){let e=!0;for(const i of t){if(i>=65536)return wg(t)?new Uint32Array(t):t;i>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function Cz(t){return t<=_u?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function kst(t){return t<=_u?new Array(t):new Uint32Array(t)}let KT=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const ZAe=[0],e8=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function RT(t){if(t===1)return ZAe;if(t<_u)return Array.from(new Uint16Array(e8.buffer,0,t));if(t<e8.length)return new Uint16Array(e8.buffer,0,t);if(t>KT.length){const e=Math.max(2*KT.length,t);KT=new Uint32Array(e);for(let i=0;i<KT.length;i++)KT[i]=i}return new Uint32Array(KT.buffer,0,t)}let nN=new Uint8Array(65536);function fb(t){if(t===1)return ZAe;if(t<_u)return new Array(t).fill(0);if(t>nN.length){const e=Math.max(2*nN.length,t);nN=new Uint8Array(e)}return new Uint8Array(nN.buffer,0,t)}var BZ;(function(t){function e(o,a){const l=o[a],c=o[a+1],u=o[a+2];return Math.sqrt(l*l+c*c+u*u)}function i(o,a){const l=o[a],c=o[a+1],u=o[a+2],d=1/Math.sqrt(l*l+c*c+u*u);o[a]*=d,o[a+1]*=d,o[a+2]*=d}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,u,d=a){(u=u||o)[d]=o[a]+l[c],u[d+1]=o[a+1]+l[c+1],u[d+2]=o[a+2]+l[c+2]}function n(o,a,l,c,u,d=a){(u=u||o)[d]=o[a]-l[c],u[d+1]=o[a+1]-l[c+1],u[d+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=i,t.scale=r,t.add=s,t.subtract=n})(BZ||(BZ={}));var Ls;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(Ls||(Ls={}));function Ust(t){if(t.length<_u)return Array.from(t);if(wg(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return HV(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let XAe=class JAe{constructor(e,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=i,this.position=r,this._children=void 0,ft(e.length>=1),ft(r.size===3||r.size===4);const{data:s,size:n,indices:o}=r;ft(o.length%this._numIndexPerPrimitive==0),ft(o.length>=e.length*this._numIndexPerPrimitive);const a=e.length;let l=n*o[this._numIndexPerPrimitive*e[0]];Db.clear(),Db.push(l);const c=$e(s[l],s[l+1],s[l+2]),u=Xs(c);for(let m=0;m<a;++m){const g=this._numIndexPerPrimitive*e[m];for(let y=0;y<this._numIndexPerPrimitive;++y){l=n*o[g+y],Db.push(l);let v=s[l];c[0]=Math.min(v,c[0]),u[0]=Math.max(v,u[0]),v=s[l+1],c[1]=Math.min(v,c[1]),u[1]=Math.max(v,u[1]),v=s[l+2],c[2]=Math.min(v,c[2]),u[2]=Math.max(v,u[2])}}this.bbMin=c,this.bbMax=u;const d=yr(E(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(u[0]-c[0],u[1]-c[1]),u[2]-c[2]);let p=this.radius*this.radius;for(let m=0;m<Db.length;++m){l=Db.at(m);const g=s[l]-d[0],y=s[l+1]-d[1],v=s[l+2]-d[2],b=g*g+y*y+v*v;if(b<=p)continue;const w=Math.sqrt(b),x=.5*(w-this.radius);this.radius=this.radius+x,p=this.radius*this.radius;const T=x/w;d[0]+=g*T,d[1]+=y*T,d[2]+=v*T}this.center=d,Db.clear()}getChildren(){if(this._children||Ko(this.bbMin,this.bbMax)<=1)return this._children;const e=yr(E(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let u=0;u<8;++u)s[u]=0;const{data:n,size:o,indices:a}=this.position;for(let u=0;u<i;++u){let d=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[u];let m=o*a[p],g=n[m],y=n[m+1],v=n[m+2];for(let b=1;b<this._numIndexPerPrimitive;++b){m=o*a[p+b];const w=n[m],x=n[m+1],T=n[m+2];w<g&&(g=w),x<y&&(y=x),T<v&&(v=T)}g<e[0]&&(d|=1),y<e[1]&&(d|=2),v<e[2]&&(d|=4),r[u]=d,++s[d]}let l=0;for(let u=0;u<8;++u)s[u]>0&&++l;if(l<2)return;const c=new Array(8);for(let u=0;u<8;++u)c[u]=s[u]>0?new Uint32Array(s[u]):void 0;for(let u=0;u<8;++u)s[u]=0;for(let u=0;u<i;++u){const d=r[u];c[d][s[d]++]=this.primitiveIndices[u]}this._children=new Array;for(let u=0;u<8;++u)c[u]!==void 0&&this._children.push(new JAe(c[u],this._numIndexPerPrimitive,this.position));return this._children}static prune(){Db.prune()}};const Db=new Zt({deallocator:null});let bL=class{constructor(){this.id=_h()}};function zst(t){return t?{p0:Xs(t.p0),p1:Xs(t.p1),p2:Xs(t.p2)}:{p0:E(),p1:E(),p2:E()}}function Vst(t,e,i){const r=e[0]-t[0],s=e[1]-t[1],n=i[0]-t[0],o=i[1]-t[1];return .5*Math.abs(r*o-s*n)}function Bst(t,e,i){return ve(t8,e,t),ve(Zue,i,t),.5*Ae(ot(t8,t8,Zue))}new U0(Ff);new U0(()=>zst());const t8=E(),Zue=E();function Gst(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;ne(e,0,0,0),ne(hd,0,0,0);let n=0,o=0;for(let a=0;a<s.length-2;a+=3){const l=s[a]*i,c=s[a+1]*i,u=s[a+2]*i;ne(Co,r[l],r[l+1],r[l+2]),ne(e0,r[c],r[c+1],r[c+2]),ne(oN,r[u],r[u+1],r[u+2]);const d=Bst(Co,e0,oN);d?(me(Co,Co,e0),me(Co,Co,oN),oe(Co,Co,1/3*d),me(e,e,Co),n+=d):(me(hd,hd,Co),me(hd,hd,e0),me(hd,hd,oN),o+=3)}return(o!==0||n!==0)&&(n!==0?(oe(e,e,1/n),!0):o!==0&&(oe(e,hd,1/o),!0))}function jst(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;ne(e,0,0,0);let n=-1,o=0;for(let a=0;a<s.length;a++){const l=s[a]*i;n!==l&&(e[0]+=r[l],e[1]+=r[l+1],e[2]+=r[l+2],o++),n=l}return o>1&&oe(e,e,1/o),o>0}function Hst(t,e,i){if(!t)return!1;ne(i,0,0,0),ne(hd,0,0,0);let r=0,s=0;const{size:n,data:o,indices:a}=t,l=a.length-1,c=l+(e?2:0);for(let u=0;u<c;u+=2){const d=u<l?u+1:0,p=a[u<l?u:l]*n,m=a[d]*n;Co[0]=o[p],Co[1]=o[p+1],Co[2]=o[p+2],e0[0]=o[m],e0[1]=o[m+1],e0[2]=o[m+2],oe(Co,me(Co,Co,e0),.5);const g=e1(Co,e0);g>0?(me(i,i,oe(Co,Co,g)),r+=g):r===0&&(me(hd,hd,Co),s++)}return r!==0?(oe(i,i,1/r),!0):s!==0&&(oe(i,hd,1/s),!0)}const Co=E(),e0=E(),oN=E(),hd=E();let Mz=class{constructor(e){this.channel=e,this.id=_h()}};function GZ(t,e){return t==null&&(t=[]),t.push(e),t}function jZ(t,e){if(t==null)return null;const i=t.filter(r=>r!==e);return i.length===0?null:i}function qst(t,e,i,r,s){aN[0]=t.get(e,0),aN[1]=t.get(e,1),aN[2]=t.get(e,2),sZ(aN,Nb,3),i.set(s,0,Nb[0]),r.set(s,0,Nb[1]),i.set(s,1,Nb[2]),r.set(s,1,Nb[3]),i.set(s,2,Nb[4]),r.set(s,2,Nb[5])}const aN=E(),Nb=new Float32Array(6);let bn=class QAe extends bL{constructor(e,i,r=null,s=Ls.Mesh,n=null,o=-1){super(),this.material=e,this.mapPositions=r,this.type=s,this.objectAndLayerIdColor=n,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[a,l]of i)this._attributes.set(a,{...l,indices:fg(l.indices)}),a===R.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(a).indices.length:this.edgeIndicesLength)}instantiate(e={}){const i=new QAe(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((r,s)=>{r.exclusive=!1,i._attributes.set(s,r)}),i._boundingInfo=this._boundingInfo,i.transformation=e.transformation||this.transformation,i}get attributes(){return this._attributes}getMutableAttribute(e){let i=this._attributes.get(e);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:Ust(i.data)},this._attributes.set(e,i)),i}setAttributeData(e,i){const r=this._attributes.get(e);r&&this._attributes.set(e,{...r,exclusive:!0,data:i})}get indexCount(){const e=this._attributes.values().next().value.indices;return(e==null?void 0:e.length)??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===Ls.Mesh?this._computeAttachmentOriginTriangles(e):this.type===Ls.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&He(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const i=this.attributes.get(R.POSITION);return Gst(i,e)}_computeAttachmentOriginLines(e){const i=this.attributes.get(R.POSITION);return Hst(i,Wst(this.material.parameters,i),e)}_computeAttachmentOriginPoints(e){const i=this.attributes.get(R.POSITION);return jst(i,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(R.POSITION);if(!e||e.indices.length===0)return null;const i=this.type===Ls.Mesh?3:1;ft(e.indices.length%i==0,"Indexing error: "+e.indices.length+" not divisible by "+i);const r=RT(e.indices.length/i);return new XAe(r,i,e)}get transformation(){return this._transformation??Vr}set transformation(e){this._transformation=e&&e!==Vr?zM(e):null}addHighlight(){const e=new Mz(A0.Highlight);return this.highlights=GZ(this.highlights,e),e}removeHighlight(e){this.highlights=jZ(this.highlights,e)}};function Wst(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}const e2=BZ,i8=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],Yst=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],Zst=[0,0,1,0,1,1,0,1],Xst=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],KAe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)KAe[6*t+e]=t;const Ww=new Array(36);for(let t=0;t<6;t++)Ww[6*t]=0,Ww[6*t+1]=1,Ww[6*t+2]=2,Ww[6*t+3]=2,Ww[6*t+4]=3,Ww[6*t+5]=0;function Jst(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=i8[r][0]*e[0],i[3*r+1]=i8[r][1]*e[1],i[3*r+2]=i8[r][2]*e[2];return new bn(t,[[R.POSITION,new it(i,Xst,3,!0)],[R.NORMAL,new it(Yst,KAe,3)],[R.UV0,new it(Zst,Ww,2)]])}const r8=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],Qst=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],Kst=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],ent=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function tnt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=r8[r][0]*e[0],i[3*r+1]=r8[r][1]*e[1],i[3*r+2]=r8[r][2]*e[2];return new bn(t,[[R.POSITION,new it(i,Kst,3,!0)],[R.NORMAL,new it(Qst,ent,3)]])}const P5=Tr(-.5,0,-.5),O5=Tr(.5,0,-.5),R5=Tr(0,0,.5),$5=Tr(0,.5,0),t2=nu(),i2=nu(),KC=nu(),eM=nu(),tM=nu();ve(t2,P5,$5),ve(i2,P5,O5),ot(KC,t2,i2),ge(KC,KC),ve(t2,O5,$5),ve(i2,O5,R5),ot(eM,t2,i2),ge(eM,eM),ve(t2,R5,$5),ve(i2,R5,P5),ot(tM,t2,i2),ge(tM,tM);const s8=[P5,O5,R5,$5],int=[0,-1,0,KC[0],KC[1],KC[2],eM[0],eM[1],eM[2],tM[0],tM[1],tM[2]],rnt=[0,1,2,3,1,0,3,2,1,3,0,2],snt=[0,0,0,1,1,1,2,2,2,3,3,3];function nnt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=s8[r][0]*e[0],i[3*r+1]=s8[r][1]*e[1],i[3*r+2]=s8[r][2]*e[2];return new bn(t,[[R.POSITION,new it(i,rnt,3,!0)],[R.NORMAL,new it(int,snt,3)]])}function sHt(t,e,i,r,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(i)),u=Math.max(2,Math.floor(r)),d=(c+1)*(u+1),p=ws(3*d),m=ws(3*d),g=ws(2*d),y=[];let v=0;for(let x=0;x<=u;x++){const T=[],C=x/u,M=a+C*l,O=Math.cos(M);for(let D=0;D<=c;D++){const k=D/c,U=n+k*o,H=Math.cos(U)*O,z=Math.sin(M),Z=-Math.sin(U)*O;p[3*v]=H*e,p[3*v+1]=z*e,p[3*v+2]=Z*e,m[3*v]=H,m[3*v+1]=z,m[3*v+2]=Z,g[2*v]=k,g[2*v+1]=C,T.push(v),++v}y.push(T)}const b=new Array;for(let x=0;x<u;x++)for(let T=0;T<c;T++){const C=y[x][T],M=y[x][T+1],O=y[x+1][T+1],D=y[x+1][T];x===0?(b.push(C),b.push(O),b.push(D)):x===u-1?(b.push(C),b.push(M),b.push(O)):(b.push(C),b.push(M),b.push(O),b.push(O),b.push(D),b.push(C))}const w=[[R.POSITION,new it(p,b,3,!0)],[R.NORMAL,new it(m,b,3,!0)]];return s.uv&&w.push([R.UV0,new it(g,b,2,!0)]),s.offset&&(w[0][0]=R.OFFSET,w.push([R.POSITION,new it(Float64Array.from(s.offset),fb(b.length),3,!0)])),new bn(t,w)}function ont(t,e,i,r){const s=ePe(e,i,r);return new bn(t,s)}function ePe(t,e,i){const r=t;let s,n;if(i)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const c=r*(1+Math.sqrt(5))/2;s=[-r,c,0,r,c,0,-r,-c,0,r,-c,0,0,-r,c,0,r,c,0,-r,-c,0,r,-c,c,0,-r,c,0,r,-c,0,-r,-c,0,r],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<s.length;c+=3)e2.scale(s,c,t/e2.length(s,c));let o={};function a(c,u){c>u&&([c,u]=[u,c]);const d=c.toString()+"."+u.toString();if(o[d])return o[d];let p=s.length;return s.length+=3,e2.add(s,3*c,s,3*u,s,p),e2.scale(s,p,t/e2.length(s,p)),p/=3,o[d]=p,p}for(let c=0;c<e;c++){const u=n.length,d=new Array(4*u);for(let p=0;p<u;p+=3){const m=n[p],g=n[p+1],y=n[p+2],v=a(m,g),b=a(g,y),w=a(y,m),x=4*p;d[x]=m,d[x+1]=v,d[x+2]=w,d[x+3]=g,d[x+4]=b,d[x+5]=v,d[x+6]=y,d[x+7]=w,d[x+8]=b,d[x+9]=v,d[x+10]=b,d[x+11]=w}n=d,o={}}const l=Yue(s);for(let c=0;c<l.length;c+=3)e2.normalize(l,c);return[[R.POSITION,new it(Yue(s),n,3,!0)],[R.NORMAL,new it(l,n,3,!0)]]}function HZ(t,e,i,r,s,n,o,a,l=null){const c=i?Xs(i):E(),u=e?Xs(e):$e(0,0,1);o??(o=lt());const d=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],p=s!=null&&s.length===2?s:[1,1],m=fb(1),g=[[R.POSITION,new it(c,m,3,!0)],[R.NORMAL,new it(u,m,3,!0)],[R.UV0,new it(o,m,o.length)],[R.COLOR,new it(d,m,4,!0)],[R.SIZE,new it(p,m,2)]];if(n!=null&&(n=[n[0],n[1],n[2],n[3]],g.push([R.CENTEROFFSETANDDISTANCE,new it(n,m,4)])),a){const y=[a[0],a[1],a[2],a[3]];g.push([R.FEATUREATTRIBUTE,new it(y,m,4)])}return new bn(t,g,null,Ls.Point,l)}const ant=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function nHt(t,e=ant){const i=new Array(12);for(let c=0;c<4;c++)for(let u=0;u<3;u++)i[3*c+u]=e[c][u];const r=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[R.POSITION,new it(i,r,3,!0)],[R.NORMAL,new it(s,n,3,!0)],[R.UV0,new it(o,r,2,!0)],[R.COLOR,new it(a,n,4,!0)]];return new bn(t,l)}function Xue(t,e,i,r,s,n=!0,o=!0){let a=0;const l=i,c=e;let u=Tr(0,a,0),d=Tr(0,a+c,0),p=Tr(0,-1,0),m=Tr(0,1,0);s&&(a=c,d=Tr(0,0,0),u=Tr(0,a,0),p=Tr(0,1,0),m=Tr(0,-1,0));const g=[d,u],y=[p,m],v=r+2,b=Math.sqrt(c*c+l*l);if(s)for(let O=r-1;O>=0;O--){const D=O*(2*Math.PI/r),k=Tr(Math.cos(D)*l,a,Math.sin(D)*l);g.push(k);const U=Tr(c*Math.cos(D)/b,-l/b,c*Math.sin(D)/b);y.push(U)}else for(let O=0;O<r;O++){const D=O*(2*Math.PI/r),k=Tr(Math.cos(D)*l,a,Math.sin(D)*l);g.push(k);const U=Tr(c*Math.cos(D)/b,l/b,c*Math.sin(D)/b);y.push(U)}const w=new Array,x=new Array;if(n){for(let O=3;O<g.length;O++)w.push(1),w.push(O-1),w.push(O),x.push(0),x.push(0),x.push(0);w.push(g.length-1),w.push(2),w.push(1),x.push(0),x.push(0),x.push(0)}if(o){for(let O=3;O<g.length;O++)w.push(O),w.push(O-1),w.push(0),x.push(O),x.push(O-1),x.push(1);w.push(0),w.push(2),w.push(g.length-1),x.push(1),x.push(2),x.push(y.length-1)}const T=ws(3*v);for(let O=0;O<v;O++)T[3*O]=g[O][0],T[3*O+1]=g[O][1],T[3*O+2]=g[O][2];const C=ws(3*v);for(let O=0;O<v;O++)C[3*O]=y[O][0],C[3*O+1]=y[O][1],C[3*O+2]=y[O][2];const M=[[R.POSITION,new it(T,w,3,!0)],[R.NORMAL,new it(C,x,3,!0)]];return new bn(t,M)}function lnt(t,e,i,r,s,n,o){const a=s?JY(s):Tr(1,0,0),l=n?JY(n):Tr(0,0,0);o??(o=!0);const c=nu();ge(c,a);const u=nu();oe(u,c,Math.abs(e));const d=nu();oe(d,u,-.5),me(d,d,l);const p=Tr(0,1,0);Math.abs(1-pe(c,p))<.2&&ne(p,0,0,1);const m=nu();ot(m,c,p),ge(m,m),ot(p,m,c);const g=2*r+(o?2:0),y=r+(o?2:0),v=ws(3*g),b=ws(3*y),w=ws(2*g),x=new Array(3*r*(o?4:2)),T=new Array(3*r*(o?4:2));o&&(v[3*(g-2)]=d[0],v[3*(g-2)+1]=d[1],v[3*(g-2)+2]=d[2],w[2*(g-2)]=0,w[2*(g-2)+1]=0,v[3*(g-1)]=v[3*(g-2)]+u[0],v[3*(g-1)+1]=v[3*(g-2)+1]+u[1],v[3*(g-1)+2]=v[3*(g-2)+2]+u[2],w[2*(g-1)]=1,w[2*(g-1)+1]=1,b[3*(y-2)]=-c[0],b[3*(y-2)+1]=-c[1],b[3*(y-2)+2]=-c[2],b[3*(y-1)]=c[0],b[3*(y-1)+1]=c[1],b[3*(y-1)+2]=c[2]);const C=(U,H,z)=>{x[U]=H,T[U]=z};let M=0;const O=nu(),D=nu();for(let U=0;U<r;U++){const H=U*(2*Math.PI/r);oe(O,p,Math.sin(H)),oe(D,m,Math.cos(H)),me(O,O,D),b[3*U]=O[0],b[3*U+1]=O[1],b[3*U+2]=O[2],oe(O,O,i),me(O,O,d),v[3*U]=O[0],v[3*U+1]=O[1],v[3*U+2]=O[2],w[2*U]=U/r,w[2*U+1]=0,v[3*(U+r)]=v[3*U]+u[0],v[3*(U+r)+1]=v[3*U+1]+u[1],v[3*(U+r)+2]=v[3*U+2]+u[2],w[2*(U+r)]=U/r,w[2*U+1]=1;const z=(U+1)%r;C(M++,U,U),C(M++,U+r,U),C(M++,z,z),C(M++,z,z),C(M++,U+r,U),C(M++,z+r,z)}if(o){for(let U=0;U<r;U++){const H=(U+1)%r;C(M++,g-2,y-2),C(M++,U,y-2),C(M++,H,y-2)}for(let U=0;U<r;U++){const H=(U+1)%r;C(M++,U+r,y-1),C(M++,g-1,y-1),C(M++,H+r,y-1)}}const k=[[R.POSITION,new it(v,x,3,!0)],[R.NORMAL,new it(b,T,3,!0)],[R.UV0,new it(w,x,2,!0)]];return new bn(t,k)}function oHt(t,e,i,r,s,n){r=r||10,s=s==null||s,ft(e.length>1);const o=[[0,0,0]],a=[],l=[];for(let c=0;c<r;c++){a.push([0,-c-1,-(c+1)%r-1]);const u=c/r*2*Math.PI;l.push([Math.cos(u)*i,Math.sin(u)*i])}return cnt(t,l,e,o,a,s,n)}function cnt(t,e,i,r,s,n,o=Tr(0,0,0)){const a=e.length,l=ws(i.length*a*3+(6*r.length||0)),c=ws(i.length*a*3+(r?6:0)),u=new Array,d=new Array;let p=0,m=0;const g=E(),y=E(),v=E(),b=E(),w=E(),x=E(),T=E(),C=E(),M=E(),O=E(),D=E(),k=E(),U=E(),H=Qi();ne(M,0,1,0),ve(y,i[1],i[0]),ge(y,y),n?(me(C,i[0],o),ge(v,C)):ne(v,0,0,1),Az(y,v,M,M,w,v,Jue),ce(b,v),ce(k,w);for(let F=0;F<r.length;F++)oe(x,w,r[F][0]),oe(C,v,r[F][2]),me(x,x,C),me(x,x,i[0]),l[p++]=x[0],l[p++]=x[1],l[p++]=x[2];c[m++]=-y[0],c[m++]=-y[1],c[m++]=-y[2];for(let F=0;F<s.length;F++)u.push(s[F][0]>0?s[F][0]:-s[F][0]-1+r.length),u.push(s[F][1]>0?s[F][1]:-s[F][1]-1+r.length),u.push(s[F][2]>0?s[F][2]:-s[F][2]-1+r.length),d.push(0),d.push(0),d.push(0);let z=r.length;const Z=r.length-1;for(let F=0;F<i.length;F++){let j=!1;F>0&&(ce(g,y),F<i.length-1?(ve(y,i[F+1],i[F]),ge(y,y)):j=!0,me(O,g,y),ge(O,O),me(D,i[F-1],b),nL(i[F],O,H),vT(H,Mh(D,g),C)?(ve(C,C,i[F]),ge(v,C),ot(w,O,v),ge(w,w)):Az(O,b,k,M,w,v,Jue),ce(b,v),ce(k,w)),n&&(me(C,i[F],o),ge(U,C));for(let W=0;W<a;W++)if(oe(x,w,e[W][0]),oe(C,v,e[W][1]),me(x,x,C),ge(T,x),c[m++]=T[0],c[m++]=T[1],c[m++]=T[2],me(x,x,i[F]),l[p++]=x[0],l[p++]=x[1],l[p++]=x[2],!j){const X=(W+1)%a;u.push(z+W),u.push(z+a+W),u.push(z+X),u.push(z+X),u.push(z+a+W),u.push(z+a+X);for(let K=0;K<6;K++){const te=u.length-6;d.push(u[te+K]-Z)}}z+=a}const q=i[i.length-1];for(let F=0;F<r.length;F++)oe(x,w,r[F][0]),oe(C,v,r[F][1]),me(x,x,C),me(x,x,q),l[p++]=x[0],l[p++]=x[1],l[p++]=x[2];const Y=m/3;c[m++]=y[0],c[m++]=y[1],c[m++]=y[2];const de=z-a;for(let F=0;F<s.length;F++)u.push(s[F][0]>=0?z+s[F][0]:-s[F][0]-1+de),u.push(s[F][2]>=0?z+s[F][2]:-s[F][2]-1+de),u.push(s[F][1]>=0?z+s[F][1]:-s[F][1]-1+de),d.push(Y),d.push(Y),d.push(Y);const L=[[R.POSITION,new it(l,u,3,!0)],[R.NORMAL,new it(c,d,3,!0)]];return new bn(t,L)}function aHt(t,e,i,r){ft(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),ft(e[0].length===3,"createPolylineGeometry(): malformed vertex"),ft(i==null||i.length===e.length,"createPolylineGeometry: need same number of points and normals"),ft(i==null||i[0].length===3,"createPolylineGeometry(): malformed normal");const s=ho(3*e.length),n=new Array(2*(e.length-1));let o=0,a=0;for(let c=0;c<e.length;c++){for(let u=0;u<3;u++)s[o++]=e[c][u];c>0&&(n[a++]=c-1,n[a++]=c)}const l=[[R.POSITION,new it(s,n,3,!0)]];if(i){const c=ws(3*i.length);let u=0;for(let d=0;d<e.length;d++)for(let p=0;p<3;p++)c[u++]=i[d][p];l.push([R.NORMAL,new it(c,n,3,!0)])}return r&&l.push([R.COLOR,new it(r,RT(r.length/4),4)]),new bn(t,l,null,Ls.Line)}function lHt(t,e,i,r,s,n=0){const o=new Array(18),a=[[-i,n,s/2],[r,n,s/2],[0,e+n,s/2],[-i,n,-s/2],[r,n,-s/2],[0,e+n,-s/2]],l=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let c=0;c<6;c++)o[3*c]=a[c][0],o[3*c+1]=a[c][1],o[3*c+2]=a[c][2];return new bn(t,[[R.POSITION,new it(o,l,3,!0)]])}function cHt(t,e){const i=t.getMutableAttribute(R.POSITION).data;for(let r=0;r<i.length;r+=3){const s=i[r],n=i[r+1],o=i[r+2];ne(r2,s,n,o),He(r2,r2,e),i[r]=r2[0],i[r+1]=r2[1],i[r+2]=r2[2]}}function unt(t,e=t){const i=t.attributes,r=i.get(R.POSITION).data,s=i.get(R.NORMAL).data;if(s){const n=e.getMutableAttribute(R.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(r){const n=e.getMutableAttribute(R.POSITION).data;for(let o=0;o<r.length;o+=3){const a=r[o+1];n[o+1]=-r[o+2],n[o+2]=a}}}function n8(t,e,i,r,s){return!(Math.abs(pe(e,t))>s)&&(ot(i,t,e),ge(i,i),ot(r,i,t),ge(r,r),!0)}function Az(t,e,i,r,s,n,o){return n8(t,e,s,n,o)||n8(t,i,s,n,o)||n8(t,r,s,n,o)}const Jue=.99619469809,r2=E();let hnt=class{constructor(e,i){this.type=ka.Local,this._configuration=new xie,this._passParameters=new wG,this._configuration.geometry=Eg.Cylinder,this._technique=i.techniques.acquire(Tz,this._configuration);const r=i.renderContext.rctx;this._vao=dnt(r),this._vaoCount=p0(this._vao,"geometry");const s=new jr;s.wrapMode=bi.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new br(r,s,Ost)}destroy(){this._passParameters.texture=It(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const i=e.rctx,r=i.bindTechnique(this._technique,e.bindParameters,this._passParameters);pnt(Que,e.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",Que),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(vi.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}};function dnt(t){const e=ePe(1,2,!1),{data:i,indices:r}=e[0][1],s=Kue.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o%3==0?o+2:o%3==2?o-2:o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new Fg(t,wi,{geometry:Au(Kue)},{geometry:vr.createVertex(t,rr.STATIC_DRAW,s.buffer)})}function pnt(t,e){vn(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const Que=Ee(),Kue=Ts().vec3f(R.POSITION),fnt=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),lN=128,ehe=-GY,the=0,o8=50,mnt=()=>1-511/512,gnt=B4([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let ynt=class{constructor(e,i){this.view=e,this.type=ka.Mars,this._passParameters=new wG,this._vaoCount=0,this._texV1=1;const r=ur(e.spatialReference);this._planetRadius=r.radius,this._outerRimWidth=r.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+ehe)/this._planetRadius,this._middleRimFactor=(this._planetRadius+the)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=the/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniques=i.techniques;const s=i.renderContext.rctx;this._cameraChangeHandle=ue(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>i.requestRender(),sr),this._vao=this._createRibbon(s),this._vaoCount=p0(this._vao,"geometry"),this._fadeVao=kg(s),this._fadeVaoCount=p0(this._fadeVao,"geometry");const n=new jr;n.wrapMode=bi.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new br(s,n,fnt);const o=new xie;o.geometry=Eg.Cone,this._coneTechnique=this._techniques.acquire(Tz,o),o.geometry=Eg.Underground,this._undergroundTechnique=this._techniques.acquire(Tz,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=It(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const i=e.bindParameters.camera;this._update(i);const r=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(r.bindTechnique(this._coneTechnique,e.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(vi.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(r.bindTechnique(this._undergroundTechnique,e.bindParameters,this._passParameters),r.bindVAO(this._fadeVao),r.drawArrays(vi.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const i=E(),r=this._planetRadius,s=Ae(e.eye),n=s-r;if(n<0){const m=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(o8,n),a=r+ehe;this._passParameters.innerScale=_nt(r+o,r,a)-1,this._passParameters.altitudeFade=rie(n),oe(i,e.eye,(r+o8)/s),ihe(i,e.center,e.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,i,e.up,this._passParameters.silhouette),c=mnt(),u=gnt(n);let d=this._texV0+c*this._texVScale,p=this._texV0+l*u*this._texVScale;if(n>o8){ihe(e.eye,e.center,e.up,r,this._passParameters.silhouette);const m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),g=Te((m-1.5)/(l-1.5),0,1);d=this._texV0+g*c*this._texVScale,p=this._texV0+Dt(this._texV1,l*u,g)*this._texVScale}Pi(this._passParameters.texV,d,p)}_createRibbon(e){const i=ws(3+3*lN*3),r=new Uint32Array(3*lN*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<lN;o++){const a=9*o+3;i[a]=o,i[a+1]=this._innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this._middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this._outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===lN-1?1:l+3,u=15*o;r[u]=l,r[u+1]=l+1,r[u+2]=c+1,r[u+3]=c+1,r[u+4]=c,r[u+5]=l,r[u+6]=l+1,r[u+7]=l+2,r[u+8]=c+2,r[u+9]=c+2,r[u+10]=c+1,r[u+11]=l+1,r[u+12]=l,r[u+13]=c,r[u+14]=0}const s=rhe.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new Fg(e,wi,{geometry:Au(rhe)},{geometry:vr.createVertex(e,rr.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(e,i,r,s){return me(s2,s.center,s.v2),oe(cN,s2,this._outerRimFactor),OB(a8,i,s2,r),due(s2,a8,e.projectionMatrix,e.viewport,s2),due(cN,a8,e.projectionMatrix,e.viewport,cN),wr(s2,cN)/e.height}};function ihe(t,e,i,r,s){const n=Ae(t),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.v1,c=s.v2;return oe(s.center,t,a/n),ot(l,t,e),Za(l)<1&&ot(l,t,i),oe(l,l,o/Ae(l)),ot(c,l,t),oe(c,c,o/Ae(c)),o}const a8=Ee(),s2=E(),cN=E();function _nt(t,e,i){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-i*i)+e*i)}const rhe=Ts().vec3f(R.POSITION);var O0;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(O0||(O0={}));let qZ=class extends jl{constructor(){super(...arguments),this.type=O0.Rain}};h([B({count:O0.COUNT})],qZ.prototype,"type",void 0);function tPe(t){const e=new Vi;return e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Vt("cameraPosition",(i,r)=>r.camera.eye)),e.vertex.uniforms.add(new Vt("offset",(i,r)=>vnt(i,r))),e.vertex.uniforms.add(new qe("width",i=>i.width)),e.vertex.uniforms.add(new ss("proj",(i,r)=>r.camera.projectionMatrix)),e.vertex.uniforms.add(new ss("view",(i,r)=>r.camera.viewMatrix)),e.vertex.uniforms.add(new qe("time",i=>i.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(S`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===O0.Rain?S`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:S`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new qe("opacity",i=>i.opacity),new Vt("particleColor",(i,r)=>bnt(r,t))),e.fragment.code.add(S`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===O0.Rain?S`d = 0.35 * smoothstep(0.5, 0.0, d);`:S`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function vnt(t,e){const i=e.camera.eye,r=.5*t.width,s=1/t.width,n=hbe(WZ,ne(WZ,(i[0]+r)*s,(i[1]+r)*s,(i[2]+r)*s));return Ai(n,i,oe(n,n,t.width))}function bnt(t,e){const i=e.type===O0.Rain?xnt:wnt,r=oe(WZ,i,Snt),s=t.camera.eye;ge(she,s);const n=Math.max(0,pe(she,t.lighting.mainLight.direction));return yr(r,r,i,n)}const WZ=E(),she=E(),wnt=$e(1,1,1),xnt=$e(.85,.85,.85),Snt=.7,Tnt=Object.freeze(Object.defineProperty({__proto__:null,build:tPe},Symbol.toStringTag,{value:"Module"}));let Ent=class extends $r{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},YZ=class iPe extends Wi{initializeProgram(e){return new Yi(e.rctx,iPe.shader.get().build(this.configuration),Pz)}initializePipeline(){return Gt({blending:sa(Pe.ONE,Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA,Pe.ONE_MINUS_SRC_ALPHA),depthTest:{func:fr.LEQUAL},colorWrite:Kt})}};YZ.shader=new Bi(Tnt,()=>fe(()=>Promise.resolve().then(()=>uUt),void 0));const Pz=new Map([[R.POSITION,0],[R.INSTANCEFEATUREATTRIBUTE,1]]);let rPe=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:i}){return i!=null?this._time!==i&&(this._time=i,!0):(this._time=this._time+e,e!==0)}},Cnt=class{constructor(e,i){this.deltaTime=e,this.fixedTime=i}},bR=class extends Re{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new Ent,this._animation=new rPe,this._passParameters.time=0,this._passParameters.radius=ur(e.view.spatialReference).radius,this._techniques=e.context.techniques}destroy(){this._numParticles=0,this._snowTechniqueCached=ti(this._snowTechniqueCached),this._rainTechniqueCached=ti(this._rainTechniqueCached),this._vao=It(this._vao),this._instanceIdBuffer=It(this._instanceIdBuffer)}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new qZ;e.type=O0.Rain,this._rainTechniqueCached=this._techniques.acquire(YZ,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new qZ;e.type=O0.Snow,this._snowTechniqueCached=this._techniques.acquire(YZ,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,i,r){const s=r==="rainy"?this._rainTechnique:this._snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),s==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=e.bindParameters.cloudsFade.opacity),this._passParameters.opacity<=0))return;const o=.35;i=i<.5?Dt(0,o,2*i):Dt(o,1,2*(i-.5)),this._passParameters.time=(r==="rainy"?this._rainSpeed:this._snowSpeed)*jK(this._animation.time)%1e5;const a=n.bindTechnique(s,e.bindParameters,this._passParameters);n.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),aie(n,Pz,this._instanceIdBuffer,nhe,0),n.drawArraysInstanced(vi.TRIANGLES,0,3,this._numParticles*i),UMe(n,Pz,this._instanceIdBuffer,nhe)}_ensureResources(e){this._vao==null&&(this._vao=Mnt(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const i=[];for(let r=0;r<this._numParticles;r++)i.push(r);return vr.createVertex(e,rr.STATIC_DRAW,new Float32Array(i))}};function Mnt(t){const e=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Fg(t,Pz,{geometry:Au(Ant)},{geometry:vr.createVertex(t,rr.STATIC_DRAW,e)})}h([f({constructOnly:!0})],bR.prototype,"context",void 0),h([f({constructOnly:!0})],bR.prototype,"view",void 0),bR=h([I("esri.views.3d.environment.Precipitation")],bR);const Ant=Ts().vec3f(R.POSITION),nhe=Au(Ts().f32(R.INSTANCEFEATUREATTRIBUTE),1);function sPe(){const t=new Vi;return t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.COLOR,"vec4"),t.attributes.add(R.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new ss("transform",(e,i)=>Pnt(e,i)),new zi("viewport",(e,i)=>i.camera.fullViewport),new qe("pixelRatio",(e,i)=>i.camera.pixelRatio)),t.vertex.code.add(S`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(S`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function Pnt(t,e){return vn(__,e.camera.projectionMatrix),__[10]=24e-8-1,__[11]=-1,__[14]=(24e-8-2)*e.camera.near,dr(__,__,e.camera.viewMatrix),dr(__,__,t.modelMatrix)}const __=Ee(),Ont=Object.freeze(Object.defineProperty({__proto__:null,build:sPe},Symbol.toStringTag,{value:"Module"}));let Rnt=class extends $r{constructor(){super(...arguments),this.modelMatrix=Ee()}},nPe=class oPe extends Wi{constructor(e){super(e,new jl,()=>this.destroy())}initializeProgram(e){return new Yi(e.rctx,oPe.shader.get().build(),wi)}initializePipeline(){return Gt({blending:sa(Pe.SRC_ALPHA,Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA,Pe.ONE_MINUS_SRC_ALPHA),depthTest:{func:fr.LEQUAL},colorWrite:Kt})}};nPe.shader=new Bi(Ont,()=>fe(()=>Promise.resolve().then(()=>hUt),void 0));let ov=class extends Re{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._passParameters=new Rnt,this._updatingTracking=new u0}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Ul(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=ti(this._technique),this._vao=It(this._vao),Fb=null}render(e){const{rctx:i}=e;if(this._ensureResources(i),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const r=i.bindTechnique(this._technique,e.bindParameters,this._passParameters);i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(vi.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||Fb==null)return;this._technique=new nPe({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=Fb.byteLength/aPe;const i=new Float32Array(Fb,0,2*this._numPoints),r=new Uint8Array(Fb,2*this._numPoints*4,this._numPoints);this._vao=$nt(e,i,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,s=>this._update(s),cr)}_update(e){if(!e)return;const i=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*Int(e),s=vn(this._passParameters.modelMatrix,Unt);UM(s,s,-r*Math.PI),dr(s,knt,s),UM(s,s,-i*Math.PI),this.requestRender()}_createLoadDataTask(){if(Fb!=null)return null;const e=Nf(async i=>{const{data:r}=await bGe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:i});Lnt(r),Fb=r});return e.promise.catch(i=>{ms(i)||ie.getLogger(this).error(i)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}};function $nt(t,e,i,r){const s=ohe.createBuffer(r),n=s.position,o=s.color,a=s.size;for(let l=0;l<r;l++){const c=e[2*l],u=e[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(u)),n.set(l,1,-Math.sin(c)*Math.sin(u)),n.set(l,2,-Math.cos(u));const d=Nnt(i[l]),p=Dnt(Fnt[d[1]]);o.set(l,0,255*p[0]),o.set(l,1,255*p[1]),o.set(l,2,255*p[2]),o.set(l,3,255),a.set(l,d[0])}return new Fg(t,wi,{geometry:Au(ohe)},{geometry:vr.createVertex(t,rr.STATIC_DRAW,s.buffer)})}function Int(t){const e=t,i=new Date(t.getFullYear(),0,1,11,58,56);return(+e-+i)/(+new Date(t.getFullYear()+1,0,1,11,58,55)-+i)}function Lnt(t){if(!t)throw new V("stars:no-data-received","Failed to create stars because star catalogue is missing");const e=t.byteLength/aPe;if(e%1!=0||e>5e4||e<5e3)throw new V("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}function Dnt(t){return[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)]}function Nnt(t){return t>=192?[2.9,t-192]:t>=160?[2.5,t-160]:t>=128?[2,t-128]:t>=96?[1.5,t-96]:t>=64?[1,t-64]:t>=32?[.7,t-32]:[.4,t]}h([f({constructOnly:!0})],ov.prototype,"view",void 0),h([f({constructOnly:!0})],ov.prototype,"requestRender",void 0),h([f({readOnly:!0})],ov.prototype,"updating",null),h([f()],ov.prototype,"_loadDataTask",void 0),h([f()],ov.prototype,"_updatingTracking",void 0),ov=h([I("esri.views.3d.environment.Stars")],ov);const Fnt=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],knt=jee(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),Unt=jee(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),aPe=9,ohe=Ts().vec3f(R.POSITION).vec4u8(R.COLOR).f32(R.SIZE);let Fb=null;const OG={required:[]},Iie={required:[G.Depth]};let RG=class extends Re{consumes(){return OG}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}get materialReference(){return null}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}queryRenderOccludedState(e){return!1}},Lie=class extends RG{},lPe=class extends RG{constructor(){super(...arguments),this.drapedPriority=0}},znt=class extends RG{},Vnt=class extends RG{};function ZZ(t){return"prepareTechnique"in t}function ahe(t){return"prepareTechniques"in t}var iM;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(iM||(iM={}));let la=class extends Lie{constructor(e){super(e),this.produces=new Map([[_e.OPAQUE_ENVIRONMENT,()=>!(this._atmosphere===null&&this._stars===null)],[_e.TRANSPARENT_ENVIRONMENT,()=>this._atmosphere!==null]]),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new l8,this._newWeatherParameters=new l8,this._fadedWeatherParameters=new l8,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){var e;this.removeHandles(),this.uninitializeRenderContext(),((e=this.view)==null?void 0:e._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:ka.None}consumes(){return this._atmosphereType===ka.Realistic?Iie:OG}updateAnimation(e){return this._precipitation!=null&&this._precipitation.update(e)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return Ae(this.view.state.camera.eye)-ur(this.view.spatialReference).radius<=Zy}get usedMemory(){var e;return((e=this._clouds)==null?void 0:e.usedMemory)??0}get _stars(){var s;const e=this.view,i=((s=e.environment)==null?void 0:s.starsEnabled)??!1,r=this._get("_stars");return i&&this._context!=null?r??new ov({view:e,requestRender:()=>this._setNeedsRender()}):(Le(r),null)}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return Le(e),null;const i=this.view,r=this._context;return e!=null&&e.context===r?e:(Le(e),new bR({context:r,view:i}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return Le(e),null;if(e!=null)return e;const i=this.view,r=this._context;return Le(e),new oc({context:r,view:i,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return Le(e),null;const i=this.view.state.viewingMode,r=this._context.renderContext.rctx,s=ur(this.view.spatialReference).radius;return e!=null&&e.viewingMode===i&&e.planetRadius===s?e:(Le(e),new Hw({rctx:r,viewingMode:i,planetRadius:s,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||this._context==null)return Le(e),null;if(e!=null)return e;const i=this.view,r=this._context,s=this._context.renderContext.rctx,n=this.view.state.viewingMode;return new qw({context:r,view:i,rctx:s,viewingMode:n})}get weatherEnabled(){var e,i;return!!((i=(e=this.view)==null?void 0:e.environmentManager)!=null&&i.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(e=null){this._context=e;const i=()=>this._setNeedsRender();this.addHandles([ue(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),r=>this._updateAtmosphere(r),sr),ue(()=>this._stars,i),ue(()=>this._precipitation,i),ue(()=>this._clouds,()=>this._updateWeather(),cr),ue(()=>this._fog,()=>this._updateFogHaze(),cr),ue(()=>this.view.state.mode,()=>this._setNeedsRender(),ar),ue(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},sr)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Le(this._atmosphere),this._set("_stars",Le(this._stars)),this._set("_precipitation",Le(this._precipitation)),this._set("_clouds",Le(this._clouds)),this._set("_cloudsComposition",Le(this._cloudsComposition)),this._set("_fog",Le(this._fog))}prepareRender(e){var i;e.bindParameters.cloudsFade.data=srt(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&((i=e.bindParameters.cloudsFade.data)==null?void 0:i.cubeMap)!=null&&(this._updateWeatherFading(e.bindParameters,e.time),e.bindParameters.cloudsFade.renderingStage===eg.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),e.bindParameters.cloudsFade.data=null))}renderNode(e){var i,r,s,n,o,a,l,c;switch(e.bindParameters.slot){case _e.OPAQUE_ENVIRONMENT:(i=this._stars)==null||i.render(e),this.atmosphere!=null&&(this.atmosphere.render(e,(n=(s=(r=this.view)==null?void 0:r._stage)==null?void 0:s.renderer)==null?void 0:n.fullResolutionAtmosphere),this._cloudsComposition&&e.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(e)),e.bindParameters.cloudsFade.isFading&&this._context&&((o=e.bindParameters.cloudsFade.data)==null?void 0:o.cubeMap)!=null&&this._context.requestRender());break;case _e.TRANSPARENT_ENVIRONMENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(e,this._weatherParameters.hazeAmount,(c=(l=(a=this.view)==null?void 0:a._stage)==null?void 0:l.renderer)==null?void 0:c.fullResolutionAtmosphere),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(e,this._weatherParameters.fog),this._precipitation)){const u=this.view.environment.weather;u.type!=="rainy"&&u.type!=="snowy"||this._precipitation.render(e,u.precipitation,u.type)}}}updateLightSources(e,i,r,s){if(this._context!=null){const n=this._context.renderContext;n.bindParameters.oldLighting.copyFrom(n.bindParameters.lighting),n.bindParameters.newLighting.noonFactor=i,n.bindParameters.newLighting.globalFactor=r,n.bindParameters.newLighting.set(e),s===iM.Faded||n.bindParameters.weatherFading?n.bindParameters.fadeLighting(0):n.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return e==null?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeatherFading(e,i){e.cloudsFade.updateFading(e.camera,this.view.state.mode,i,this.view.qualitySettings.fadeDuration),e.cloudsFade.updateParallax(e.camera),e.weatherFading&&(Bnt(e),this._updateFogAtmoshpere(e))}_updateFogAtmoshpere(e){e.cloudsFade.fadeMode!==Ur.CROSS_FADE&&e.cloudsFade.fadeMode!==Ur.FADE_IN?this._fadeWeather(0):this._fadeWeather(e.cloudsFade.fadeFactor)}_fadeWeather(e){const{_newWeatherParameters:i,_oldWeatherParameters:r}=this;e>=1?this._weatherParameters=i:(this._fadedWeatherParameters.lerp(r,i,e),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const e=this._weatherUpdateParameters;e!=null&&this._clouds!=null&&(this._clouds.applyPreset(Fa[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const e=this._weatherUpdateParameters;if(this._fog==null||e==null||this._context==null)return;const i=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),e.type){case"foggy":this._newWeatherParameters.fog.strength=Dt(3e-5,.005,e.weatherAdjustment**3),ce(this._newWeatherParameters.fog.color,lhe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=Dt(4e-6,2e-4,(e.effect??0)**3),ce(this._newWeatherParameters.fog.color,Gnt),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=Dt(4e-6,2e-4,(e.effect??0)**3),ce(this._newWeatherParameters.fog.color,lhe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}i.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(e){const i=this._selectAtmosphereType(e);if(i!==ka.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==i){this._atmosphere=Le(this._atmosphere);const r=this._getAtmosphereClass(i);r&&(this._atmosphere=new r(this.view,this._context))}}else this._atmosphere=Le(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(e){switch(e){case ka.Realistic:return irt;case ka.Local:return hnt;case ka.Mars:return ynt;default:case ka.None:return null}}_selectAtmosphereType(e){const{enabled:i,viewingMode:r}=e;return!i||pT(this.view.spatialReference)?ka.None:r===Ge.Local?ka.Local:this._context!=null&&CM(this.view.spatialReference)?ka.Realistic:dT(this.view.spatialReference)?ka.Mars:ka.None}get test(){}};h([f({constructOnly:!0})],la.prototype,"view",void 0),h([f({readOnly:!0})],la.prototype,"atmosphere",null),h([f({readOnly:!0})],la.prototype,"_atmosphereType",null),h([f({type:Boolean,readOnly:!0})],la.prototype,"updating",null),h([f({readOnly:!0})],la.prototype,"weatherVisible",null),h([f()],la.prototype,"_context",void 0),h([f()],la.prototype,"_atmosphere",void 0),h([f({readOnly:!0})],la.prototype,"_stars",null),h([f({readOnly:!0})],la.prototype,"_precipitation",null),h([f({readOnly:!0})],la.prototype,"_clouds",null),h([f({readOnly:!0})],la.prototype,"_cloudsComposition",null),h([f({readOnly:!0})],la.prototype,"_fog",null),h([f({readOnly:!0})],la.prototype,"weatherEnabled",null),h([f({readOnly:!0})],la.prototype,"_precipitationEnabled",null),h([f({readOnly:!0})],la.prototype,"_weatherUpdateParameters",null),la=h([I("esri.views.3d.environment.EnvironmentRenderer")],la);let l8=class{constructor(){this.fog=new xst,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,ce(this.fog.color,e.fog.color)}lerp(e,i,r){this.fog.amount=Dt(e.fog.amount,i.fog.amount,r),this.hazeAmount=Dt(e.hazeAmount,i.hazeAmount,r),this.fog.strength=Dt(e.fog.strength,i.fog.strength,r),yr(this.fog.color,e.fog.color,i.fog.color,r)}};function Bnt(t){t.cloudsFade.fadeMode!==Ur.CROSS_FADE&&t.cloudsFade.fadeMode!==Ur.FADE_IN?t.fadeLighting(0):t.fadeLighting(t.cloudsFade.fadeFactor)}const Gnt=$e(.5,.5,.5),lhe=$e(1.5,1.5,1.5);var CHt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wL(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var che,uhe,hhe,cPe={exports:{}};che=cPe,uhe=function(){var t=Math.PI,e=Math.sin,i=Math.cos,r=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,u=2451545,d={dec:0,ra:0};function p(L){return L.valueOf()/l-.5+c}function m(L){return new Date((L+.5-c)*l)}function g(L){return p(L)-u}var y=23.4397*a;function v(L,F){return n(e(L)*i(y)-r(F)*e(y),i(L))}function b(L,F){return s(e(F)*i(y)+i(F)*e(y)*e(L))}function w(L,F,j){return n(e(L),i(L)*e(F)-r(j)*i(F))}function x(L,F,j){return s(e(F)*e(j)+i(F)*i(j)*i(L))}function T(L,F){return a*(280.16+360.9856235*L)-F}function C(L){return a*(357.5291+.98560028*L)}function M(L){return a*(1.9148*e(L)+.02*e(2*L)+3e-4*e(3*L))}function O(L,F){return L+F+102.9372*a+t}function D(L,F){var j=C(L),W=O(j,M(j));return F||(F={dec:0,ra:0}),F.dec=b(W,0),F.ra=v(W,0),F}var k={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(L,F,j,W){var X=a*-j,K=a*F,te=g(L),he=D(te,d),we=T(te,X)-he.ra;return W||(W={azimuth:0,altitude:0}),W.azimuth=w(we,K,he.dec),W.altitude=x(we,K,he.dec),W}},U=[[-.83,"sunrise","sunset"]];k.addTime=function(L,F,j){U.push([L,F,j])};var H=9e-4;function z(L,F){return Math.round(L-H-F/(2*t))}function Z(L,F,j){return H+(L+F)/(2*t)+j}function q(L,F,j){return u+L+.0053*e(F)-.0069*e(2*j)}function Y(L,F,j){return o((e(L)-e(F)*e(j))/(i(F)*i(j)))}function de(L){var F=a*(134.963+13.064993*L),j=a*(93.272+13.22935*L),W=a*(218.316+13.176396*L)+6.289*a*e(F),X=5.128*a*e(j),K=385001-20905*i(F);return{ra:v(W,X),dec:b(W,X),dist:K}}return k.getTimes=function(L,F,j){var W=a*-j,X=a*F,K=z(g(L),W),te=Z(0,W,K),he=C(te),we=M(he),De=O(he,we),at=b(De,0),et=q(te,he,De);function Ke(ke){return q(Z(Y(ke,X,at),W,K),he,De)}function Je(ke){var Ze=(e(ke)-e(X)*e(at))/(i(X)*i(at));return Ze<-1?k.PolarException.MIDNIGHT_SUN:Ze>1?k.PolarException.POLAR_NIGHT:k.PolarException.NORMAL}var Xe,si,ei,Gi,Ue,ui={solarNoon:m(et),nadir:m(et-.5),polarException:k.PolarException.NORMAL};for(Xe=0,si=U.length;Xe<si;Xe+=1)Ue=et-((Gi=Ke((ei=U[Xe])[0]*a))-et),ui[ei[1]]=m(Ue),ui[ei[2]]=m(Gi);return ui.polarException=Je(U[0][0]*a),ui},k.getMoonPosition=function(L,F,j){var W=a*-j,X=a*F,K=g(L),te=de(K),he=T(K,W)-te.ra,we=x(he,X,te.dec);return we+=.017*a/r(we+10.26*a/(we+5.1*a)),{azimuth:w(he,X,te.dec),altitude:we,distance:te.dist}},k.getMoonFraction=function(L){var F=g(L),j=D(F),W=de(F),X=149598e3,K=o(e(j.dec)*e(W.dec)+i(j.dec)*i(W.dec)*i(j.ra-W.ra)),te=n(X*e(K),W.dist-X*i(K));return(1+i(te))/2},k},(hhe=uhe())!==void 0&&(che.exports=hhe);const tT=wL(cPe.exports),Rl={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let uN=class{constructor(e,i){this.direct=e,this.ambient=i}};function jnt(t,e,i,r,s,n){ne(n.ambient.color,1,1,1),n.ambient.intensity=Rl.global.ambient,ne(n.direct.color,1,1,1),n.direct.intensity=Rl.global.direct;const o=e[2],a=Te((Math.abs(o)-Rl.local.altitude)/(Rl.global.altitude-Rl.local.altitude),0,1);let l;if(n.globalFactor=a,t!=null&&(l=tT.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=Jnt(t,l,r);else{const u=dPe(r);c={direct:{intensity:Rl.local.directAtNoon*u.direct,color:$e(1,1,1)},ambient:{intensity:Rl.local.ambientAtNoon*u.ambient,color:$e(1,1,1)},timeOfDay:"early afternoon"}}yr(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=Dt(c.ambient.intensity,n.ambient.intensity,a),yr(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=Dt(c.direct.intensity,n.direct.intensity,a),n.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,n.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}n.noonFactor=t!=null?Xnt(t,l):1,t!=null?Hnt(t,e,i,n.direct.directionToLightSource):uPe(s,i,n.direct.directionToLightSource)}function uPe(t,e,i){e===Ge.Global?ge(d8,t.eye):ne(d8,0,0,1),oe(p8,t.viewForward,-1);const r=XU(p8,d8),s=Math.max(r-2*f8,0),n=.85*s/(s+1),o=Math.max(f8,r-f8-n);wu(xhe,-o,t.viewRight),He(i,p8,xhe),me(i,i,oe(Qnt,t.viewRight,Knt)),ge(i,i)}function Hnt(t,e,i,r){const s=Znt,n=Gd(Ynt);if(i===Ge.Global)tT.getPosition(t,0,0,s),ne(r,0,0,-1),kM(n,n,-s.azimuth),PB(n,n,-s.altitude),He(r,r,n);else{const o=Rl.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=Te(c,0,1),c<1?(tT.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),ne(r,0,-1,0),UM(n,n,-s.azimuth),kM(n,n,-s.altitude),He(r,r,n)}}function qnt(t,e){if(e===Ge.Global)return!0;const i=Rl.planarDirection;return Math.abs(t)<i.localAltitude}const Wnt=$e(.5773502691896258,-.5773502691896258,.5773502691896258);let hPe=class{constructor(){this.ambient={color:$e(1,1,1),intensity:.55},this.direct={color:$e(1,1,1),intensity:.55,directionToLightSource:Xs(Wnt)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const Ynt=Ee(),Znt={azimuth:0,altitude:0};function Xnt(t,e){const i=t.valueOf();let r,s;e.polarException===tT.PolarException.MIDNIGHT_SUN?(r=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=r+432e6):e.polarException===tT.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=r+(s-r)/2;return 1-Te(Math.abs(i-n)/432e5,0,1)}function dPe(t){switch(t){case"disabled":case"sunny":case"cloudy":return new uN(1,1);case"rainy":return new uN(.4,1.2);case"snowy":return new uN(.5,1.3);case"foggy":return new uN(.2,1.6)}}function dhe(t,e){const i=(t[0]+t[1]+t[2])/3;t[0]+=(i-t[0])*e,t[1]+=(i-t[1])*e,t[2]+=(i-t[2])*e}const c8=$e(.01,.01,.01),XZ=$e(1,.6,.5),JZ=$e(1,.98,.98),phe=$e(1,1,1),u8=$e(.8,.8,1),QZ=$e(.8,.8,1),KZ=$e(.98,.98,1),fhe=$e(1,1,1),h8=_i(.01,Rl.local.ambientAtNight),eX=_i(Rl.local.directAtTwilight,Rl.local.ambientAtTwilight),tX=_i(.9*Rl.local.directAtNoon,Rl.local.ambientAtNoon),mhe=_i(Rl.local.directAtNoon,Rl.local.ambientAtNoon),ghe=tX,yhe=JZ,_he=KZ,vhe=eX,bhe=XZ,whe=QZ;function Jnt(t,e,i){const r=t.valueOf();let s,n;e.polarException===tT.PolarException.MIDNIGHT_SUN?(s=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===tT.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,u=a+l,d=.06*o,p=s-d/2,m=s+d/2,g=n-d/2,y=n+d/2,v=lt(),b=E(),w=E();let x="";if(r<p||r>y)Aa(v,h8),ce(b,c8),ce(w,u8),x="night";else if(r<m){const M=(r-p)/(m-p);Td(v,h8,eX,M),yr(b,c8,XZ,M),yr(w,u8,QZ,M),x="sun rising"}else if(r<c){const M=(r-m)/(c-m);Td(v,eX,tX,M),yr(b,XZ,JZ,M),yr(w,QZ,KZ,M),x="early morning"}else if(r<a){const M=(r-c)/(a-c);Td(v,tX,mhe,M),yr(b,JZ,phe,M),yr(w,KZ,fhe,M),x="late morning"}else if(r<u){const M=(r-a)/(u-a);Td(v,mhe,ghe,M),yr(b,phe,yhe,M),yr(w,fhe,_he,M),x="early afternoon"}else if(r<g){const M=(r-u)/(g-u);Td(v,ghe,vhe,M),yr(b,yhe,bhe,M),yr(w,_he,whe,M),x="late afternoon"}else if(r<y){const M=(r-g)/(y-g);Td(v,vhe,h8,M),yr(b,bhe,c8,M),yr(w,whe,u8,M),x="sun setting"}let T=0;switch(i){case"rainy":case"foggy":T=.8;break;case"snowy":T=.5}T>0&&(dhe(b,T),dhe(w,T));const C=dPe(i);return{direct:{intensity:v[0]*C.direct,color:b},ambient:{intensity:v[1]*C.ambient,color:w},timeOfDay:x}}const xhe=Ee(),d8=E(),p8=E(),Qnt=E(),f8=.25,Knt=.2;function pPe(t){return CM(t)?S0(t)||Ef(t)||MM(t)||kI(t)?e7e:t:xu(t)}var mg;function PHt(t){return eot(t,mg.Horizontal)}function eot(t,e){const{hasZ:i,spatialReference:r}=t,s=pPe(r);let n=0;const o=twe(s);if(o==null)return null;const a=e===mg.Direct?fPe:mPe;for(const l of t.paths){if(l.length<2)continue;const c=l.length-1;for(let u=0;u<c;++u){const d=l[u];Ro[0]=d[0],Ro[1]=d[1],Ro[2]=i?d[2]:0;const p=l[u+1];$o[0]=p[0],$o[1]=p[1],$o[2]=i?p[2]:0;const m=a(Ro,$o,r);if(m==null)return null;n+=m.value}}return h0(n,o)}function OHt(t,e){const{spatialReference:i}=t;return gs(i,e.spatialReference)?(Ro[0]=t.x,Ro[1]=t.y,Ro[2]=t.hasZ?t.z:0,$o[0]=e.x,$o[1]=e.y,$o[2]=e.hasZ?e.z:0,rot(Ro,$o,i)):null}function tot(t,e){const{spatialReference:i}=t;return gs(i,e.spatialReference)?(Ro[0]=t.x,Ro[1]=t.y,Ro[2]=t.hasZ?t.z:0,$o[0]=e.x,$o[1]=e.y,$o[2]=e.hasZ?e.z:0,fPe(Ro,$o,i)):null}function RHt(t,e){const{spatialReference:i}=t;return gs(i,e.spatialReference)?(Ro[0]=t.x,Ro[1]=t.y,Ro[2]=t.hasZ?t.z:0,$o[0]=e.x,$o[1]=e.y,$o[2]=e.hasZ?e.z:0,mPe(Ro,$o,i)):null}function $Ht(t,e){const{spatialReference:i}=t;return gs(i,e.spatialReference)?(Ro[0]=t.x,Ro[1]=t.y,Ro[2]=t.hasZ?t.z:0,$o[0]=e.x,$o[1]=e.y,$o[2]=e.hasZ?e.z:0,sot(Ro,$o,i)):null}function IHt(t){return t!=null?iot(t.hasZ?t.z:0,t.spatialReference):null}function iot(t,e){const i=iwe(e);return i!=null?h0(t??0,i):null}function rot(t,e,i){const r=$G(t,e,i);return r!=null?{direct:h0(r.direct,r.unit),horizontal:h0(r.horizontal,r.unit),vertical:h0(r.vertical,r.unit)}:null}function fPe(t,e,i){const r=$G(t,e,i,mg.Direct);return r!=null?h0(r.direct,r.unit):null}function mPe(t,e,i){const r=$G(t,e,i,mg.Horizontal);return r!=null?h0(r.horizontal,r.unit):null}function sot(t,e,i){const r=$G(t,e,i,mg.Vertical);return r!=null?h0(r.verticalSigned,r.unit):null}function $G(t,e,i,r){const s=pPe(i),n=twe(s);if(n==null)return null;const o=e[2]-t[2];if(r===mg.Vertical)return{verticalSigned:o,unit:n};if(!Zn(t,i,m8,s)||!Zn(e,i,hN,s))return null;if(r===mg.Direct)return{direct:wr(hN,m8),unit:n};if(ne(dN,t[0],t[1],e[2]),!Zn(dN,i,dN,s))return null;const a=wr(dN,hN);return r===mg.Horizontal?{horizontal:a,unit:n}:{direct:wr(hN,m8),horizontal:a,vertical:Math.abs(o),unit:n}}(function(t){t[t.Direct=0]="Direct",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"})(mg||(mg={}));const Ro=E(),$o=E(),m8=E(),hN=E(),dN=E();let Cp=class extends cn.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandlesKey="viewHandles",this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new wz,this._ambientLight=new vie,this._moonLight=new yAe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePositionGeographic=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,i,r;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((r=(i=this._view)==null?void 0:i.state)==null?void 0:r.viewingMode)===Ge.Global&&CM(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionGeographic(){return this._referencePositionGeographic}connectView(e){if(this._renderer)return;this._renderer=new la({view:e});const i=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this.addHandles([ue(()=>e.environment.lighting,s=>this._updateLightingHandler(s),ar),ue(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),ar),ue(()=>e.stationary,()=>this._interactingStationaryHandler()),ue(()=>e.environment.lighting.directShadowsEnabled,i,ar),ue(()=>e.qualitySettings.ambientOcclusion,i,ar),ue(()=>e.qualitySettings.reflections,i,ar),ue(()=>e.spatialReference,()=>this._resetReferencePosition(!0),ar),ue(()=>e.environment.weather.type,()=>this._updateLighting(null,iM.Faded),ar),ue(()=>this.weatherEnabled,()=>this._updateLighting(null,iM.Faded),ar),ue(()=>e.viewingMode,()=>this._resetReferencePosition(!0),sr),ue(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),sr),ue(()=>e.state.camera,r,sr),ue(()=>this.disableQueries,r)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=Le(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const i=this._view.environment.lighting;(i==null?void 0:i.type)!=="virtual"&&(i.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const i=this._view.environment.lighting;if((i==null?void 0:i.type)!=="virtual"){if(e){if(!i.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!Ac(r,We.WGS84)){const s=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(s))return void this._requestReferencePositionUpdate(s)}if(this._preupdateTracking(e),this._referencePositionGeographic!=null){const s=hce(this._referencePositionGeographic,She);s!=null&&(i.autoUpdate(null,s),this._trackingEnabled&&(i.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const i=this._view;if(!i.ready)return;const r=i.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,i){const r=CM(this._view.spatialReference);if(r&&!Ac(this._view.spatialReference,We.WGS84))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const s=e.position;return this._referencePositionGeographic??(this._referencePositionGeographic=E()),r?il(s,this._referencePositionGeographic,We.WGS84):ne(this._referencePositionGeographic,s.longitude??0,s.latitude??0,s.z??0),this.notifyChange("referencePositionGeographic"),this._autoUpdateTimezone(this._referencePositionGeographic,i)||this._updateLighting(i),!0}_cameraHandlerServerSide(e){const i=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(i))&&this._requestReferencePositionUpdate(i,!0),this._view.mapCoordsHelper&&this._referencePositionGeographic&&(this._referencePositionGeographic[2]=(i.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,i=iM.Immediate){const r=this._view;e=e||(r.environment.lighting.type==="virtual"?null:r.environment.lighting.date);const s=this._referencePositionGeographic,n=s?not:oot,o=this.weatherVisible?r.environment.weather.type:"disabled";s!=null?jnt(e,s,r.state.viewingMode,o,r.state.camera,n):r.environment.lighting.type==="virtual"&&uPe(r.state.camera,r.state.viewingMode,n.direct.directionToLightSource);const a=this._mainLight,l=n.direct;oe(a.intensity,l.color,l.intensity*Math.PI),ce(a.direction,l.directionToLightSource),a.specularStrength=n.specularStrength,a.environmentStrength=n.environmentStrength;const c=this._ambientLight;oe(c.intensity,n.ambient.color,n.ambient.intensity);const u=this._moonLight;yr(u.intensity,lot,cot,n.globalFactor);const d=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));oe(u.intensity,u.intensity,d),ce(u.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,u],n.noonFactor,n.globalFactor,i),this._updateRenderParameters()}_autoUpdateTimezone(e,i=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const r=aot;r.setTime((i||this._view.environment.lighting.date).getTime());const s=hce(e,She);if(s==null)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const o=r.getUTCHours()-(s.hours-n.hours),a=r.getUTCMinutes()-(s.minutes-n.minutes),l=r.getUTCSeconds()-(s.seconds-n.seconds);return r.setUTCHours(o),r.setUTCMinutes(a),r.setUTCSeconds(l),!i&&this._view.environment.lighting.autoUpdate(r,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const i=this._referencePositionGeographic==null||qnt(this._referencePositionGeographic[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&i,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePositionGeographic=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,i=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!i,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=RI(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const n=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(n)}}).catch(n=>{n.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),s=this._referencePosUpdateTimer=RI(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===s&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const i=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(i[0])&&!isNaN(i[1])){const r=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePositionGeographic?ne(this._referencePositionGeographic,i[0],i[1],r):this._referencePositionGeographic=$e(i[0],i[1],r),this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePositionGeographic)||this._updateLighting(),this.notifyChange("referencePositionGeographic")}_exceedsReferencePosDistThreshold(e){const i=this._referencePosMapCoords;if(i==null)return!0;const r=tot(i,e);return r==null?!0:ytt(r,"meters").value>this._referencePointUpdateDistThreshold}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){}};h([f({type:Boolean,readOnly:!0})],Cp.prototype,"updating",null),h([f()],Cp.prototype,"disableQueries",void 0),h([f()],Cp.prototype,"_disableWeather",void 0),h([f()],Cp.prototype,"weatherEnabled",null),h([f()],Cp.prototype,"weatherVisible",null),h([f()],Cp.prototype,"referencePositionGeographic",null),h([f()],Cp.prototype,"_renderer",void 0),h([f()],Cp.prototype,"_referencePositionGeographic",void 0),Cp=h([I("esri.views.3d.environment.SceneViewEnvironmentManager")],Cp);const not=new hPe,oot=new hPe,aot=new Date,She={hours:0,minutes:0,seconds:0},lot=$e(.22,.22,.33),cot=$e(.22,.22,.22);var Jr;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Jr||(Jr={}));var ci;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(ci||(ci={}));var Cg;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(Cg||(Cg={}));let Qd=class{constructor(e=Jr.ALL,i=ci.NONE,r=0,s=null,n=null,o=Cg.TUMBLE){this.selection=e,this.interactionType=i,this.interactionFactor=r,this.interactionStartCamera=s,this.interactionDirection=n,this.tiltMode=o}};function o3(t,e){return!!(t&e)}function Oz(t,e,i,r,s,n){t!==0&&(i?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):r!=null?(n.min-=Math.max(0,(e-n.min)*(1-r)),n.max+=Math.max(0,(e-n.max)*(1-r))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const $T=new Qd(Jr.NONE);function gPe(t,e,i,r){return e=e||t.viewForward,ce(r,e),oe(r,r,Math.sign(pe(e,i))),r}function uot(t,e,i,r){return mot(t,e,i,pot(r,e,i,!0))}function hot(t,e,i,r){const s=pe(i,ve(t,r,e));return me(t,e,oe(t,i,s))}const dot={dir:E(),len:0,clip:lt()};function pot(t,e,i,r){const s=dot;return t?(i&&r&&(s.len=wr(e,i)),ce(s.dir,t)):(s.len=wr(e,i),ve(s.dir,i,e),oe(s.dir,s.dir,1/s.len)),s}function fot(t,e,i){const r=pe(t,i.dir),s=-Er(t,e);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function mot(t,e,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!fot(t[s],e,r))return!1;return!0}function got(t,e,i=$T){const r=Die(t,e,i);if(r===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+r,o=gPe(e,i.interactionDirection,vot(t,e,Math.sign(r),Sot),xot),a=ce(Tot,e.viewForward),l=s.intersectInfiniteManifold(Mh(e.eye,o),n,g8);return e.eye=l??s.setAltitude(g8,n,e.eye),e.center=hot(g8,e.eye,a,e.center),!0}function Die(t,e,i=$T){if(!yot(t,i)||!t.state.constraints.altitude)return 0;const r=bot(t.state.constraints.altitude,wot);_ot(t,i,r);const s=t.renderCoordsHelper.getAltitude(e.eye),n=Te(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function yot(t,e){const i=t.state.constraints.altitude;return!(!t.state.isGlobal||!i)&&(e.interactionType!==ci.TUMBLE||!o3(e.selection,Jr.TILT))}function _ot(t,e,i){const r=e.interactionType;if(r===ci.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===ci.TUMBLE||r===ci.ZOOM,c=Die(t,o),u=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,Oz(c,u,l,a,.05*u,i)}function vot(t,e,i,r){return t.renderCoordsHelper.worldUpAtPosition(e.eye,r),oe(r,r,i),r}function bot(t,e){return e.min=t.min,e.max=t.max,e}const wot={min:0,max:0},xot=E(),Sot=E(),Tot=E(),g8=E();function Nie(t,e,i=$T){if(!t.state.isLocal)return 0;const r=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;pN.min=0,pN.max=r,Cot(t,i,pN);const s=Fie(t,e),n=pN.max-s;return n>=-1e-6?0:n}function Eot(t,e,i=$T){const r=Nie(t,e,i);if(r===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=Fie(t,e)+r,o=ce(Aot,e.eye),a=gPe(e,i.interactionDirection,Mot(e,s.renderLocation,Rot),Oot);if(!sb(wTe(s.renderLocation,n),Mh(e.eye,a),fN))return!1;e.eye=fN;const l=ve(Pot,e.eye,o);e.center=me(fN,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),u=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,fN);return u!=null&&(e.center=u),!0}function Cot(t,e,i){const r=e.interactionType;if(r===ci.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===ci.ZOOM||r===ci.PAN,c=Nie(t,o),u=c===0?0:Fie(t,o);i.min=s,i.max=n,Oz(c,u,l,a,.05*u,i)}function Fie(t,e){const i=t.pointsOfInterest.surfaceOrigin;return i.renderLocation?wr(e.eye,i.renderLocation):0}function Mot(t,e,i){return k0(i,t.eye,e)}const pN={min:0,max:0},Aot=E(),Pot=E(),Oot=E(),Rot=E(),fN=E();function XA(t,e,i=$d.EYE){const r=t.state.constraints;if(!r.collision.enabled)return!1;const s=JB(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;const a=Ae(e.eye);if(ve(mN,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude($ot,o,e.eye),i===$d.EYE_AND_CENTER)e.center=me(mN,e.eye,mN);else if(i===$d.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;e.center=oe(mN,e.center,l)}return!0}var $d;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})($d||($d={}));const mN=E(),$ot=E();function j1(t,e,i){t.worldUpAtPosition(e,The),ve(y8,i,e);const r=Ae(y8);return r===0?0:fo(pe(y8,The)/r)}const The=E(),y8=E();function yPe(t,e,i,r=!0){UP.eyeCenterDistance=0,UP.requiresTwoSteps=!1;const s=kie(t,e,i,$T,UP);if(s===0)return!1;switch(wu(gN,-s,e.viewRight),i.tiltMode){case Cg.LOOK_AROUND:He(v_,e.viewForward,gN),oe(v_,v_,UP.eyeCenterDistance),e.center=me(Nv,e.eye,v_);break;case Cg.TUMBLE:ve(v_,e.center,e.eye),He(v_,v_,gN),e.eye=ve(Nv,e.center,v_);break;default:i.tiltMode}return e.up=He(Nv,e.up,gN),!UP.requiresTwoSteps||!r||yPe(t,e,i,!1)}function kie(t,e,i,r=$T,s){if(!t.state.constraints.tilt)return 0;const n=e.distance,o=t.state.constraints.tilt(n,Bot);return Vot(t,i,o),r.interactionType===ci.TUMBLE&&o3(r.selection,Jr.ALTITUDE)&&_Pe(t,r.interactionStartCamera,o),i.tiltMode===Cg.LOOK_AROUND||r.tiltMode===Cg.LOOK_AROUND?Lot(t,e,o,s):Iot(t,e,o)}function Iot(t,e,i){const r=j1(t.renderCoordsHelper,e.center,e.eye),s=r-Te(r,i.min,i.max);return a3(s)?s:0}function Lot(t,e,i,r){switch(r&&(r.requiresTwoSteps=!1),t.viewingMode){case"global":return Not(t,e,i,r);case"local":return Dot(t,e,i,r)}}function Dot(t,e,i,r){const s=j1(t.renderCoordsHelper,e.center,e.eye),n=Te(s,i.min,i.max),o=s-n;if(!a3(o))return 0;if(r){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=e.distance}return o}function Not(t,e,i,r){const s=Fot(t,e,Got),n=Te(s.tiltAtCenter,i.min,i.max);if(!a3(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=kot(s),a=Uot(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=zot(s,o)),r&&(r.eyeCenterDistance=iX(s,o)),a}function Fot(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+ur(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,r,Nv);return i.eyeCenterDistance=e.distance,i.centerIsOnSurface=!1,n!=null?(i.eyeCenterDistance=wr(e.eye,n),i.tiltAtCenter=j1(t.renderCoordsHelper,n,e.eye),i.centerIsOnSurface=!0):t.state.isLocal?i.tiltAtCenter=j1(t.renderCoordsHelper,e.center,e.eye):(zA(UB(zB,s),e.ray,Nv),i.eyeCenterDistance=wr(e.eye,Nv),i.tiltAtCenter=fo(-pe(e.viewForward,ge(Nv,Nv)))),i.radius=s,i.eyeRadius=Ae(e.eye),i.constraints=t.state.constraints,i}function a3(t){return Math.abs(t)>1e-9}function kot(t){const{constraints:e,eyeCenterDistance:i,tiltAtCenter:r}=t;let s=r,n=e.clampTilt(i,r);const o=iX(t,n);if(e.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&a3(n-s);){const l=(s+n)/2,c=iX(t,l);a3(e.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function iX(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const i=Math.PI-Te(e,0,Math.PI),r=Tf(t.radius/t.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(t.eyeRadius<t.radius&&n>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*t.eyeRadius}return n*t.eyeRadius}function Uot(t,e){const i=Tf(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),r=Tf(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?i-r:r-i}function zot(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function Vot(t,e,i){if(e.interactionType===ci.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=e;if(!r)return;const{min:n,max:o}=i,a=kie(t,r,$T,e),l=a===0?0:j1(t.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,e.interactionType===ci.TUMBLE?(o3(e.selection,Jr.ALTITUDE)&&_Pe(t,r,i),Oz(a,l,!0,s,Ehe,i)):Oz(a,l,!1,s,Ehe,i)}function _Pe(t,e,i){const r=t.state.constraints;if(t.state.isLocal||!r.altitude||!e)return;const s=Za(e.center),n=Math.sqrt(s),o=e.distance,a=ur(t.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,u=(l*l-o*o-s)/(-2*n*o),d=(c*c-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-fo(d),i.max)),i.max=Math.min(i.max,Math.PI-fo(u))}const v_=E(),gN=Ee(),Nv=E(),Ehe=Rt(5),Bot={min:0,max:0},Got={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},UP={eyeCenterDistance:0,requiresTwoSteps:!1},jot=t=>t,IG=t=>t*t,Uie=t=>1-IG(1-t),Hot=t=>t<.5?IG(2*t)/2:(Uie(2*(t-.5))+1)/2,zie=t=>t*t*t,vPe=t=>1-zie(1-t),bPe=t=>t<.5?zie(2*t)/2:(vPe(2*(t-.5))+1)/2,Vie=t=>t*t*t*t,wPe=t=>1-Vie(1-t),qot=t=>t<.5?Vie(2*t)/2:(wPe(2*(t-.5))+1)/2,Bie=t=>t*t*t*t*t,xPe=t=>1-Bie(1-t),Wot=t=>t<.5?Bie(2*t)/2:(xPe(2*(t-.5))+1)/2,Gie=t=>1-Math.cos(t*Math.PI/2),SPe=t=>1-Gie(1-t),Yot=t=>t<.5?Gie(2*t)/2:(SPe(2*(t-.5))+1)/2,jie=t=>2**(10*(t-1)),xL=t=>1-jie(1-t),Zot=t=>t<.5?jie(2*t)/2:(xL(2*(t-.5))+1)/2,Hie=t=>-(Math.sqrt(1-t*t)-1),TPe=t=>1-Hie(1-t),Xot=t=>t<.5?Hie(2*t)/2:(TPe(2*(t-.5))+1)/2;function Kd(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return r=>r<i?t*r*r:e*r-e+1}function ep(t,e){return(i,r)=>i<e?e*t(i/e,r):1-t((1-i)/(1-e),r)*(1-e)}const Jot=ep(Kd(1),1),Qot=ep(Kd(1),0),rX=ep(Kd(1),.5),Kot=ep(Kd(2),1),eat=ep(Kd(2),0),tat=ep(Kd(2),.5),iat=ep(Kd(3),1),rat=ep(Kd(3),0),sat=ep(Kd(3),.5),nat=ep(Kd(4),1),oat=ep(Kd(4),0),aat=ep(Kd(4),.5),lat={linear:jot,"in-quad":IG,"out-quad":Uie,"in-out-quad":Hot,"in-coast-quad":Jot,"out-coast-quad":Qot,"in-out-coast-quad":rX,"in-cubic":zie,"out-cubic":vPe,"in-out-cubic":bPe,"in-coast-cubic":Kot,"out-coast-cubic":eat,"in-out-coast-cubic":tat,"in-quart":Vie,"out-quart":wPe,"in-out-quart":qot,"in-coast-quart":iat,"out-coast-quart":rat,"in-out-coast-quart":sat,"in-quint":Bie,"out-quint":xPe,"in-out-quint":Wot,"in-coast-quint":nat,"out-coast-quint":oat,"in-out-coast-quint":aat,"in-sine":Gie,"out-sine":SPe,"in-out-sine":Yot,"in-expo":jie,"out-expo":xL,"in-out-expo":Zot,"in-circ":Hie,"out-circ":TPe,"in-out-circ":Xot};function on(t,e,i=dat,r=e){r!==e&&r.copyFrom(e),r.computeUp(t.state.viewingMode);let s=!1;for(let a=0;a<pat;a++){let l=0;for(const c of hat)if(o3(i.selection,c.type)){const u=Math.abs(c.error(t,r,i));c.apply(t,r,i)&&(s=!0,l+=u)}if(l===0)break}const n=o3(i.selection,Jr.COLLISION),o=cat(i.interactionType,t);return n&&XA(t,r,o)&&(s=!0),s&&r.computeUp(t.state.viewingMode),s}function cat(t,e){switch(t){case ci.PAN:return $d.EYE_AND_CENTER;case ci.ASCEND:return e.state.isGlobal?$d.EYE_AND_CENTER_SCALE:$d.EYE_AND_CENTER;default:return $d.EYE}}function Xp(t){const e=Math.min(1,t/150);return bPe(e)}function uat(t,e,i){return kie(t,e,i)*e.distance}const hat=[{type:Jr.TILT,error:uat,apply:yPe},{type:Jr.ALTITUDE,error:Die,apply:got},{type:Jr.DISTANCE,error:Nie,apply:Eot}],dat=new Qd,pat=5;let Che=class{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(e){this.viewingMode=e,this.center=E(),this._pitch=0,this._yaw=0,this._distance=0,this.direction=Xs(Mhe),this._fov=55,this._size=1}pixelsPerPanAtZoom(e){return this._size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this._size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this._pitch)),.5);return this._size/2/e}compareTo(e,i){if(this.viewingMode===Ge.Global){const n=(Ae(this.center)+Ae(e.center))/2;i.pan=XU(this.center,e.center)*n}else i.pan=wr(this.center,e.center);let r=Math.abs(e._yaw-this._yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(e._pitch-this._pitch);i.rotate=Math.max(r,s),i.fov=e.fov-this.fov,i.sourceZoom=this._distance,i.targetZoom=e._distance}interpolate(e,i,r){this.viewingMode===Ge.Global?S9e(e.center,i.center,r.pan,this.center):yr(this.center,e.center,i.center,r.pan),this._distance=isFinite(i.distance)?Dt(e.distance,i.distance+r.zoomOffset,r.zoom):e.distance,this._pitch=Dt(e.pitch,i.pitch,r.rotate);let s=e._yaw;const n=i._yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this._yaw=Dt(s,n,r.rotate),this._fov=Dt(e.fov,i.fov,r.fov)}copyFrom(e){ce(this.center,e.center),this._pitch=e.pitch,this._yaw=e.yaw,this._distance=e.distance,ce(this.direction,e.direction),this._size=e.size,this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const i=this._lookAtOrientation(e.center,Ahe);ce(this.center,e.center),ve(aa,e.center,e.eye),Qo(aa,aa,i),Qo(w_,e.up,i),this._distance=Ae(aa),this._distance!==0&&(aa[0]/=this._distance,aa[1]/=this._distance,aa[2]/=this._distance),this._pitch=this._eyeUpToPitch(aa),this._yaw=fat(aa,w_),this._size=Math.sqrt(e.width*e.width+e.height*e.height),this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(e){const i=this._lookAtOrientation(this.center,Ahe);xT(i,i),this._axisAngleVec3(I5,this._pitch-Math.PI/2,Mhe,aa),this._axisAngleVec3(Px,this._yaw,aa,aa),this._axisAngleVec3(I5,this._pitch-Math.PI/2,Px,w_),this._axisAngleVec3(Px,this._yaw,w_,w_),oe(aa,aa,this._distance),Qo(aa,aa,i),Qo(w_,w_,i),e.center=this.center,e.eye=ve(aa,this.center,aa),e.up=w_,e.fov=this._fov}_axisAngleVec3(e,i,r,s){const n=Math.cos(i),o=Math.sin(i);return oe($u,r,n),ot(Yc,e,r),oe(Yc,Yc,o),oe(b_,e,(1-n)*pe(e,r)),me(s,me(s,$u,Yc),b_)}_lookAtOrientation(e,i=Gr()){return this._upAtLookAt(e,b_),ot($u,this.direction,b_),ge($u,$u),$u[0]===0&&$u[1]===0&&$u[2]===0&&ce($u,I5),ot(Yc,b_,$u),ge(Yc,Yc),i[0]=$u[0],i[1]=Yc[0],i[2]=b_[0],i[3]=$u[1],i[4]=Yc[1],i[5]=b_[1],i[6]=$u[2],i[7]=Yc[2],i[8]=b_[2],i}_upAtLookAt(e,i){return this.viewingMode===Ge.Local?ce(i,Px):ge(i,e)}_eyeUpToPitch(e){return Math.PI-XU(Px,e)}};function fat(t,e){const i=mat;return Math.abs(e[2])<.5?(ce(i,e),t[2]>0&&oe(i,i,-1)):ce(i,t),ot(Yc,i,Px),ge(Yc,Yc),XU(I5,Yc,Px)}const $u=E(),Yc=E(),b_=E(),aa=E(),w_=E(),mat=E(),Px=wM,Mhe=KK,I5=QK,Ahe=Gr();let gat=class{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};const Rz={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let yat=class EPe{constructor(e){this._createCamera=e,this.compared=new gat,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:Rz.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new EPe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,r){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:Rz.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>Lo()}get hasFov(){return Math.abs(this.compared.fov)>Lo()}get hasRotate(){return this.compared.rotate>Lo()}},_at=class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}},vat=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce((e,i)=>e+i.time,0)}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,s=0;const n=this.definition,o=this.segments.reduce((a,l)=>a||l.definition.hasZoom,!1);for(let a=0;a<this.segments.length;a++){const l=this.segments[a],c=l.definition;if(e<=l.time||a===this.segments.length-1){if(this.segmentInterpolateComponentsAt(l,l.time===0?0:e/l.time,i),n.hasPan&&!isNaN(i.pan)&&isFinite(n.compared.pan)?i.pan=(r+c.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate&&!isNaN(i.rotate)&&isFinite(n.compared.rotate)?i.rotate=(s+c.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1,o&&!isNaN(i.zoom)&&isFinite(c.compared.targetZoom)){const{sourceZoom:u,targetZoom:d}=c.compared,p=i.zoom*(d-u)+u,m=this.segments[0].definition.compared.sourceZoom,g=this.segments[this.segments.length-1].definition.compared.targetZoom,y=Math.abs(d-m)>Math.abs(u-m)?d:u;i.zoomOffset=y-g,i.zoom=(p-m)/(y-m)}else i.zoom=1;return i}e-=l.time,r+=c.compared.pan,s+=c.compared.rotate}}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r)}},_8=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(r);const n=(e.source.pixelsPerRotateAtZoom(r)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;r&&(s&&(o=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,u=1+c;this._panPixelFlow=c/u*l,this._rotatePixelFlow=1/u*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=this.rotateTime??this.zoomTime??this.panTime??this.fovTime??0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:null}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:null}get fovTime(){return this.definition.hasFov?Math.abs(this.definition.compared.fov)/bat:null}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-e-i)/(r-i)}return e}_interpolateComponentsFov(e){if(e===0)return this.definition.segmentStart;if(e===1)return this.definition.segmentEnd;if(this.definition.hasFov){const{segmentStart:i,segmentEnd:r}=this.definition;return i+e*(r-i)}return this.definition.segmentStart}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),i.zoom=this._interpolateComponentsZoom(e),i.pan=this._interpolateComponentsPan(e),i.rotate=this._interpolateComponentsRotate(e),i.zoomOffset=0,i.fov=this._interpolateComponentsFov(e)}};const bat=Rt(90);function wat(t,e,i){const r=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(r);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function xat(t,e,i){const r=1/e,s=Math.log(t.compared.sourceZoom*r),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*r*n*o*l*c-t.halfWindowSize*s*n*o*l+t.halfWindowSize*s*n*o*c/(a*a)}function Sat(t,e,i){const r=e-t.compared.sourceZoom,s=1/r,n=1/e,o=Math.log(t.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Tat(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function Eat(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Cat(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function Mat(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function Aat(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function Pat(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function Oat(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function Rat(t,e,i){const r=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*r*s*n*a+t.halfWindowSize*r*s*n*l/(o*o)+t.halfWindowSize*s*n*a*l/e}function $at(t,e,i){const r=e-t.compared.targetZoom,s=1/r,n=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Iat(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function Lat(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Dat(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function Nat(t){const e=t.compared.sourceZoom-t.compared.targetZoom;if(e===0)return t.compared.pan*t.halfWindowSize/(t.desiredPixelFlow*t.halfWindowPanAtZoom(t.compared.sourceZoom));const i=Math.LN2*t.compared.pan,r=e,s=t.halfWindowPanAtZoom(r),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*s);return t.compared.sourceZoom<=t.compared.targetZoom?n*(i-s):n*(i+s)}function Fat(t,e){let i=kat(t,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,o=s?Tat:wat,a=s?Eat:xat,l=s?Cat:Sat,c=n?Iat:Oat,u=n?Lat:Rat,d=n?Dat:$at,p=T=>o(t,T,r)+Mat(t,T,r)+c(t,T,r),m=T=>a(t,T,r)+Aat(t,T,r)+u(t,T,r),g=T=>l(t,T,r)+Pat(t,T,r)+d(t,T,r);let y=p(i);const v=Nat(t);let b;const w=e.maximumIterations||20,x=e.maximumDistance!=null?e.maximumDistance:1/0;for(b=0;b<w;b++){const T=e.desiredSlope??1e-6;let C=m(i);Math.abs(C)>T&&(C+=T);const M=C/g(i);if(isNaN(M)||i>=x&&M<0){if(!isFinite(x))return null;i=x,y=p(i);break}if(i-=M,i<t.compared.sourceZoom||i<t.compared.targetZoom)return null;const O=p(i);if(Math.abs(O-y)/y<=.005)break;y=O}return y>v*(1-.3)||i<t.compared.sourceZoom||i<t.compared.targetZoom?null:i}function kat(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),r=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return r<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,r):r}let Uat=class extends vat{constructor(e,i){super(),this._preallocSegments=[new _8,new _8,new _8],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();const r=i!=null&&i.apex?Fat(e,i.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r?this._updateWithApex(r,i==null?void 0:i.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r),e===this._ascensionSegment?r.zoom=Uie(r.zoom):e===this._descensionSegment&&(r.zoom=IG(r.zoom))}_updateWithApex(e,i){const[r,s,n]=this._preallocSegments,o=(i==null?void 0:i.ascensionFactor)??.5,a=Math.min(1-o,(i==null?void 0:i.ascensionFactor)!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.definition.segmentEnd=o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.definition.segmentStart=r.definition.segmentEnd,s.definition.segmentEnd=r.definition.segmentEnd+l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.definition.segmentStart=o+l,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const zat=new _at;let Vat=class{get time(){return this._time}get isLinear(){return this.path.segments.length===1}constructor(e){this._time=0,this._easing=rX,this.definition=new yat(e),this.path=new Uat}update(e,i,r){this.definition.update(e,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(I1e(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing??(this._time>=1e3?rX:xL)}cameraAt(e,i){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,zat);i.interpolate(this.definition.source,this.definition.target,r)}_normalizedEasing(e){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(r-i)}_applyTimeSettings(e,i){const r=i.speedFactor!=null?i.speedFactor:1,s=i.minDuration??Rz.minDuration/r,n=i.maxDuration??Rz.maxDuration/r;return e=i.duration!=null?i.duration:Math.min(Math.max(e/r,s),n)}},Bat=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new Vat(()=>new Che(e)),this._current=new Che(e)}update(e,i,r){const{source:s,target:n}=this._animation.definition,o=ve(Gat,i.center,e.center),a=Ae(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ce(s.direction,o),ce(n.direction,o),s.copyFromRenderCamera(e),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,e.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(e,i){return this._animation.cameraAt(e,this._current),i=i||new Pr,this._current.copyToRenderCamera(i),i}step(e,i){return this.finished||(this.currentTime=this.currentTime+I1e(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}};const Gat=E();var us;(function(t){t[t.Ready=0]="Ready",t[t.Rejected=1]="Rejected",t[t.Running=2]="Running",t[t.Stopped=3]="Stopped",t[t.Finished=4]="Finished"})(us||(us={}));let Xy=class extends Re{constructor(e){super(e),this.state=us.Ready}get active(){return this.state===us.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=us.Stopped,!0)}finishController(){this.state=us.Finished}get steppingFinished(){return!1}};h([f({constructOnly:!0})],Xy.prototype,"view",void 0),h([f({readOnly:!0})],Xy.prototype,"active",null),h([f()],Xy.prototype,"state",void 0),h([f({readOnly:!0})],Xy.prototype,"isInteractive",null),Xy=h([I("esri.views.3d.state.controllers.CameraController")],Xy);let l3=class extends Xy{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Di()),this._asyncResult=null),this.state===us.Finished||this.state===us.Stopped?(YV(e),this.state===us.Finished?e.resolve():e.reject(Di())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=us.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==us.Ready&&this.state!==us.Running||(this.viewAnimation.state===QM.State.FINISHED?this.finish():this.viewAnimation.state===QM.State.STOPPED&&(this.state=us.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===us.Finished?this.viewAnimation.finish():this.state===us.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===us.Finished?this._asyncResult.resolve():this._asyncResult.reject(Di()))}finish(){this.finishController()}};l3=h([I("esri.views.3d.state.controllers.AnimationController")],l3);let n0=class extends l3{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new Bat(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new QM}get isInteractive(){return this.mode==="interaction"}begin(e,i){this._hasTarget=!0;const r=this.animationSettings(i);yN.copyFrom(this.view.state.camera);const s=jd(this.view.state.viewingMode);this.intersectionHelper.intersectRay(yN.ray,s,Phe)&&(yN.center=Phe),this.animation.update(yN,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,i){this._hasTarget&&this.animation.step(e,i)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?lat[e.easing]:e.easing}}};h([f({constructOnly:!0})],n0.prototype,"mode",void 0),h([f({readOnly:!0})],n0.prototype,"isInteractive",null),n0=h([I("esri.views.3d.state.controllers.PointToPointAnimationController")],n0);const yN=new Pr,Phe=E();function LG(t=Hat){return[t[0],t[1],t[2],t[3]]}function c3(t,e){return jat(t[0],t[1],t[2],e,qee.get())}function jat(t,e,i,r,s=LG()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function qie(t,e,i){return ot(i,t,e),ge(i,i),i[3]=Qee(t,e),i}const Hat=[0,0,1,0];function WHt(t,e,i=uo()){return Wie(t,ef(e),i),ge(i.direction,i.direction),i}function Wie(t,e,i){return qat(t,t.screenToRender(e,Ye.get()),i)}function qat(t,e,i){const r=Aa(Ye.get(),e);if(r[2]=0,!t.unprojectFromRenderScreen(r,i.origin))return null;const s=Aa(Ye.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,Ye.get());return n==null?null:(ve(i.direction,n,i.origin),i)}function JA(t,e,i){return Yie(t,t.screenToRender(e,Ye.get()),i)}function Yie(t,e,i){ce(i.origin,t.eye);const r=ne(Ye.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(r,Ye.get());return s==null?null:(ve(i.direction,s,i.origin),i)}function Zie(t,e,i,r){const s=JA(e,i,Wat);return sb(t,s,r)}const Wat=uo();var sA;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(sA||(sA={}));const CPe=30,$z=[1,3e8],DG=80,MPe=8,APe=200,PPe=1508e5,OPe=5,RPe=50,Yat=5,Zat=10,v8=90,IT={exclude:new Set([N1])};function SS(t,e,i){return i[0]=e[0]/(t.fullWidth/t.pixelRatio),i[1]=e[1]/(t.fullHeight/t.pixelRatio),i}function sX(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function H1(t,e,i){const r=wu(Wee.get(),i[3],i);r==null||LSe(r,Vr)||(ve(gr,t.eye,e),He(gr,gr,r),t.eye=me(gr,gr,e),ve(gr,t.center,e),He(gr,gr,r),t.center=me(gr,gr,e),t.up=He(gr,t.up,r))}function Xat(t,e,i,r){return vT(t,Wie(e,i,Qie),r)}function nX(t,e,i,r){return vT(t,JA(e,i,Qie),r)}function Xie(t,e,i,r){const s=Ye.get();let n=1-i;ve(s,e,t.eye);const o=Ae(s);let a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||(oe(s,s,n),t.eye=me(gr,t.eye,s),t.center=yr(gr,t.center,e,n))}function $Pe(t,e,i){e.getScreenCenter(Ohe),Zie(t,e,Ohe,gr)&&(e.center=gr);const r=e.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=oe(Ye.get(),e.viewForward,s);e.eye=ve(gr,e.center,n)}const Ohe=vs();function b8(t,e){ne(e,0,0,0);for(const i of t)me(e,e,i);oe(e,e,1/t.length)}function L5(t,e,i,r){return Math.sin(t/Ae(e))*(i+r.radius)}function Rhe(t,e,i,r){return L5(Math.PI/2,e,i,r)+(t-Math.PI/2)}var ba;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(ba||(ba={}));const $he={Elevation:3e4,Angle:Rt(16)},_N={Pole:.95,Angle:Rt(18),Tilt:45},IPe=Rt(80);function LPe(t,e,i,r,s,n){const o=E(),a=ln();let l=!0,c=!0;return t.intersectScreen(i,o,n)?a[3]=Ae(o):(c=!1,e.aboveGround&&s!==sA.Ellipsoid?a[3]=Math.max(Ae(e.center),.9*r.radius):a[3]=Ae(e.eye)-e.relativeElevation,s===sA.Silhouette?u3(a,e,i,o):l=Zie(a,e,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function SL(t,e,i,r){const s=t.relativeElevation;if(s>$he.Elevation&&r==="global")return ba.Horizontal;JA(t,e,x8);const n=Math.sign(s),o=i.worldUpAtPosition(t.eye,gr);return-n*pe(o,x8.direction)<Math.sin($he.Angle)*Ae(x8.direction)?ba.Vertical:ba.Horizontal}function DPe(t,e,i){ve(w8,i,e),t.eye=ve(gr,t.eye,w8),t.center=ve(gr,t.center,w8)}const w8=E();function u3(t,e,i,r){const s=JA(e,i,Qie);return s!=null&&(zA(t,s,vN),sb(t,s,r)?!(Ko(vN,s.origin)<Ko(r,s.origin))||(ce(r,vN),!1):(ve(n2,e.eye,e.center),ge(n2,n2),sTe(n2,-pe(ge(n2,n2),vN),Ihe),vT(Ihe,s,r),!1))}const vN=E(),n2=E(),Ihe=Qi();function NPe(t,e,i,r,s,n){let o=0;if(ot(Dz,t,e),ve(SN,t,e),Ae(t)<=s||!r.aboveGround){ot(i,SN,r.eye);const a=pe(t,e)/(Ae(t)*Ae(e));if(a<.9999)o=fo(a);else{const c=Ae(ot(E(),t,e))/(Ae(t)*Ae(e));o=Tf(c)}const l=Math.cos(Te(S1.normalize(Rt(n)),0,IPe));o=-o-Math.max(0,Ae(e)-s)/(l*s)}else ve(Lhe,r.eye,r.center),ot(i,SN,Lhe),o=-Ae(SN)/s;return ge(i,i),oe(i,i,Ae(Dz)),o}const Lhe=E();function Dhe(t,e,i,r){let s,n;const o=Math.cos(Te(S1.normalize(Rt(r)),0,IPe));return s=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):fo(e/i),n=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):fo(t/i),(n-s)*i}function Jat(t,e,i,r,s,n,o,a,l,c){const u=Dhe(t[2],e[2],n[3],a),d=l?Dhe(t[0],e[0],n[3],180):e[0]-t[0],p=Math.sin(o)*d-Math.cos(o)*u,m=Math.cos(o)*d+Math.sin(o)*u;ge(gr,s);const g=l?p/Math.sqrt(Math.abs(n[3]**2-pe(i,gr)**2)):p/n[3],y=m/Math.sqrt(Math.abs(n[3]**2-pe(i,r)**2));Pi(c,g,y)}function FPe(t,e,i,r,s,n,o,a,l,c){ot(Dz,t,e),D7(n.up,n.eye,bN,wN,xN),D7([0,0,1],n.eye,m0,d1,VPe),ce(i,d1),ce(r,m0),ge(i,i),oe(i,i,Ae(Dz)),Rle(t,ge(wN,wN),ge(xN,xN),ge(bN,bN),Nhe),Rle(e,wN,xN,bN,Fhe),Jat(Nhe,Fhe,t,m0,d1,o,a,l,c,s)}function Qat(t,e,i,r,s,n,o){wu(Iz,s,r),wu(Lz,o,n),dr(lC,Iz,Lz),ve(e,t,i),He(e,e,lC),me(e,e,i)}function kPe(t,e,i,r,s,n){wu(Iz,r,i),wu(Lz,n,s),dr(lC,Iz,Lz),ve(gr,t.eye,e),He(gr,gr,lC),t.eye=me(gr,gr,e),ve(gr,t.center,e),He(gr,gr,lC),t.center=me(gr,gr,e),ve(gr,t.up,e),He(gr,gr,lC),t.up=me(gr,gr,e)}function Jie(t,e,i,r,s,n){return(Math.abs(r)>Math.PI-_N.Angle||Math.abs(r)<_N.Angle)&&(Math.abs(t[2])<i*_N.Pole||Math.abs(e)>i)&&n.aboveGround&&s<_N.Tilt}function UPe(t,e,i,r,s,n){if(n)qie(i,r,khe),H1(e,t,khe);else{const o=NPe(i,r,Uhe,e,t[3],s);H1(e,t,c3(Uhe,o))}}function zPe(t,e,i,r,s,n,o){const a=o?20:1,l=1e-12;let c,u;ce(kb,r),TN.copyFrom(e);for(let d=0;d<a&&Ko(i,kb)>l&&(c=Ko(i,kb),FPe(i,kb,d1,m0,zP,TN,t,s,n,o),kPe(TN,t,m0,zP[1],d1,zP[0]),Qat(kb,kb,t,m0,zP[1],d1,zP[0]),u=Ko(i,kb),u<c||d===0);d++)e.copyFrom(TN)}function Kat(t,e,i,r,s,n,o){Jie(i,pe(e.up,i),t[3],-S1.normalize(Rt(s)),n,e)?zPe(t,e,i,r,-S1.normalize(Rt(s)),n,o):UPe(t,e,i,r,n,o)}function elt(t,e,i,r,s,n){const{eye:o}=t;D7([0,0,1],o,m0,d1,VPe);const a=e.translation[0]*i.pan,l=s.mode==="zoom"?0:e.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-pe(t.center,m0)**2/Ae(t.center)**2)),.5),u=(Math.sin(n)*l+Math.cos(n)*a)/c,d=-Math.cos(n)*l+Math.sin(n)*a;switch(uu(r.pan.matrix,r.pan.matrix,u,m0),r.pan.enabled=!0,s.mode){case"pan":uu(r.pan.matrix,r.pan.matrix,d,d1),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*i.zoom}}function tlt(t,e,i,r,s){const{eye:n,viewRight:o}=t,a=ot(Ye.get(),o,n),l=e.translation[0]*i.pan;switch(l!==0&&(uu(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*i.pan;c!==0&&(uu(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*i.zoom}}function ilt(t,e,i,r,s,n,o,a,l){Jie(t.center,pe(t.up,t.center),Ae(t.center),-S1.normalize(Rt(n)),o,e)?elt(e,i,r,a,l,-S1.normalize(Rt(s))):tlt(e,i,r,a,l)}const m0=E(),d1=E(),VPe=E(),bN=E(),wN=E(),xN=E(),Nhe=E(),Fhe=E(),zP=lt(),khe=LG(),Iz=Ee(),Lz=Ee(),lC=Ee(),kb=E(),gr=E(),SN=E(),TN=new Pr,Dz=E(),Uhe=E(),Qie={origin:E(),direction:E()},x8={origin:E(),direction:E()},zhe=.6,S8=4,rlt=60;let Nz=class extends n0{constructor(){super(...arguments),this._zoomLocation=E(),this._tmpCamera=new Pr,this._tmpViewDir=E(),this._tmpRayDir={origin:E(),direction:E()},this._targetOnSphere=E(),this._tmpCenter=E(),this._beginCamera=new Pr,this._constraintOptions=new Qd(Jr.ALL_EXCEPT_COLLISION,ci.ZOOM,null,this._beginCamera),this._sphere=ln()}initialize(){this._intersector=jd(this.view.state.viewingMode)}zoomStep(e,i){if(!this.active)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera);let s=!1,n=!1;this.intersectionHelper.intersectScreen(i,this._zoomLocation,this.view.map.ground.opacity===0?IT:{})&&(s=e>0,n=!0),this._tmpCamera.copyFrom(r.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ce(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,i,n),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:xL}}_updateCamera(e,i,r,s,n){const o=SL(e,s,this.view.renderCoordsHelper,this.view.viewingMode),a=Math.abs(this.view.camera.position.z);ge(CN,e.eye),oe(CN,CN,-1),JA(e,s,this._tmpRayDir),ge(this._tmpRayDir.direction,this._tmpRayDir.direction);const l=Te(Math.min(MPe,1/Math.abs(pe(CN,this._tmpRayDir.direction)))*a,APe,PPe);if(o===ba.Horizontal){let c=zhe**i;this._sphere[3]=Ae(r),ve(this._tmpViewDir,e.center,e.eye);const u=Math.min(Ae(this._tmpViewDir),l);let d=u*c;if(c<=1&&d<S8&&(d=S8,c=d/u),Math.abs(u-d)<1e-6)return;const p=Ae(e.center);if(this._sphere[3]!==p){const m=this._sphere[3]+c*(p-this._sphere[3]);e.center=oe(EN,e.center,m/p)}oe(this._tmpViewDir,this._tmpViewDir,-c),e.eye=me(EN,e.center,this._tmpViewDir),on(this.view,e,this._constraintOptions),Ko(r,e.center)>1e-12&&Zie(this._sphere,e,s,this._targetOnSphere)&&Kat(this._sphere,e,r,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=zhe**Math.abs(i);const u=i>0?1:-1;ve(this._tmpViewDir,r,e.eye);const d=Ae(this._tmpViewDir),p=this.view._stage.renderView.getMinimalDepthForArea(null,s[0],s[1],this.view.state.camera,rlt);let m=p??l;m=n&&i>0?Math.min(m,d):m,oe(this._tmpRayDir.direction,this._tmpRayDir.direction,m),me(r,this._tmpRayDir.origin,this._tmpRayDir.direction);let g=m*c;const y=Math.max(S8,1.01*e.nearFar[0]);if(i>0&&g<y&&(g=y,c=g/m),Math.abs(m-g)<1e-6)return;oe(this._tmpRayDir.direction,this._tmpRayDir.direction,u*(1-c)),e.eye=me(EN,e.eye,this._tmpRayDir.direction),e.center=me(EN,e.center,this._tmpRayDir.direction)}XA(this.view,e)}};Nz=h([I("esri.views.3d.state.controllers.ZoomStepControllerGlobal")],Nz);const EN=E(),CN=E();let D5,N5=null;const rM=new Map;async function ZHt(t){N5==null&&(D5==null&&(D5=fe(()=>import("./VoxelWasmPerSceneView-DWH4y2PA.js"),[])),N5=await D5);const e=t.view;let i=rM.get(e);return i||(i=new N5.default({view:e}),rM.set(e,i)),i.addVoxelLayer(t)}function h3(t){return rM.get(t)}function XHt(t){const e=t.view,i=rM.get(e);i&&i.removeVoxelLayer(t)<1&&(rM.delete(e),rM.size===0&&(D5=null,N5=null))}const slt=.6,nlt=4,olt=60;let Fz=class extends n0{constructor(){super(...arguments),this._zoomLocation=E(),this._tmpCamera=new Pr,this._tmpRayDir=E(),this._tmpCenter=E(),this._beginCamera=new Pr,this._constraintOptions=new Qd(Jr.ALL,ci.ZOOM,null,this._beginCamera)}zoomStep(e,i){if(!this.active)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera),this._tmpCamera.copyFrom(r.camera);const s=jd(this.view.state.viewingMode);let n=!1;e>0?(n=this.intersectionHelper.intersectScreenFreePointFallback(i,this._zoomLocation,this.view.map.ground.opacity===0?IT:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ce(this._zoomLocation,this._tmpCamera.center);const o=slt**e;let a=this.view._stage.renderView.getMinimalDepthForArea(h3(this.view),i[0],i[1],this.view.state.camera,olt);ve(MN,this._tmpCamera.eye,this._zoomLocation),ge(MN,MN);const l=Te(Math.min(MPe,1/Math.abs(pe(alt,MN)))*Math.abs(this.view.camera.position.z),APe,PPe);if(a=a??l,a){const c=E();ve(c,this._zoomLocation,this._tmpCamera.eye),(a<Ae(c)||!n)&&(ge(c,c),me(this._zoomLocation,this._tmpCamera.eye,oe(c,c,a)))}this._updateCamera(this._tmpCamera,o,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:xL}}_updateCamera(e,i,r){ve(this._tmpRayDir,r,e.eye);const s=Ae(this._tmpRayDir);let n=s*i;const o=i<=1,a=Math.max(nlt,1.01*e.nearFar[0]);n!==0&&(o&&n<a&&(n=a,i=n/s),Math.abs(s-n)<1e-6||(oe(this._tmpRayDir,this._tmpRayDir,i),e.eye=ve(Vhe,r,this._tmpRayDir),e.center=yr(Vhe,e.center,r,1-i),on(this.view,e,this._constraintOptions)))}};Fz=h([I("esri.views.3d.state.controllers.ZoomStepControllerLocal")],Fz);const Vhe=E(),alt=$e(0,0,1),MN=E();function llt(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function Kie(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let clt=class extends na{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const i=e.data;if(llt(i,"primary")){const r=this._view.state.isGlobal?new Nz({view:this._view,mode:"animation"}):new Fz({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),vs(i.x,i.y)),e.stopPropagation()}}};function ult(t,e,i){return t===Ge.Global?new dlt(i):new hlt(e,i)}let hlt=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=ur(i),this._unitInMeters=Gl(i,this._referenceEllipsoid.metersPerDegree)}compute(e,i,r,s,n){var x;n||(n={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-s,c=(x=this._elevationProvider)==null?void 0:x.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const u={x:(r=r??new gi({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},d=Math.max(u.x,u.y,u.z);ve(Ub,i,e),o2[0]=Ub[0]>0?r.xmax:r.xmin,o2[1]=Ub[1]>0?r.ymax:r.ymin,o2[2]=Ub[2]>0?d/2:-d/2,ve(o2,o2,e),ge(Ub,Ub);const p=1.1*pe(o2,Ub)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),y=g*mlt*this._unitInMeters,v=g*glt*this._unitInMeters,b=Te((o-v)/(y-v),0,1)**3,w=Math.min(Dt(m,p,b),m)*Math.max(Math.log(Math.abs(l)),1);return BPe(Math.min(w,Math.max(34064e4,d))/this._unitInMeters,plt,this._unitInMeters,n)}},dlt=class{constructor(e){this._referenceEllipsoid=ur(e)}compute(e,i,r,s,n){n||(n={near:0,far:0});const o=Ae(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),u=Math.max(c,Math.abs(a)),d=Math.sqrt(u*(u+2*l)),p=o+this._referenceEllipsoid.radius;return BPe(1.2*Dt(d,p,rie(u)),Te(2e4-(Math.log(u)-7.983)/9.011*19900,100,2e4),1,n)}};function BPe(t,e,i,r){const s=flt/i;return t/e>s?(r.far=t,r.near=r.far/e):(r.near=s,r.far=r.near*e),r}const plt=2e4,flt=2,mlt=.001,glt=1e-4,o2=E(),Ub=E();let F5=class extends Re{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const i=this.view.state.camera;e.spatialReference!=null&&y2e(this.view,i,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>XA(this.view,e,$d.EYE_AND_CENTER))}};h([f({constructOnly:!0})],F5.prototype,"view",void 0),F5=h([I("esri.views.3d.state.SurfaceCollisionConstraint")],F5);let wR=class extends Re{constructor(e){super(e),this.nearFarHeuristic=ult(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([ue(()=>{var e,i,r,s;return[(i=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:i.near,(s=(r=this.view.constraints)==null?void 0:r.clipDistance)==null?void 0:s.far]},()=>this._clipDistanceNearFarChanged()),ue(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:i.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),ue(()=>this.view.renderDataExtent,()=>this._updateNearFar(),ar),ue(()=>{var e,i,r,s;return[(i=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:i.min,(s=(r=this.view.constraints)==null?void 0:r.altitude)==null?void 0:s.max]},()=>this._updateAltitude(),ar),ue(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:i.max},()=>this._updateTiltMax(),ar),ue(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:i.mode},()=>this._updateTilt(),ar),ue(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),ar),ue(()=>{var e,i,r,s,n,o;return[(r=(i=(e=this.view.map)==null?void 0:e.ground)==null?void 0:i.navigationConstraint)==null?void 0:r.type,(o=(n=(s=this.view.state)==null?void 0:s.constraints)==null?void 0:n.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),ar)]),this.view.state.isLocal&&this.addHandles(ue(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),cr)),this._updateNearFar(),this.view.state.viewingMode!==Ge.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new F5({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var i;const e=(i=this.view.constraints)==null?void 0:i.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(r=>Bhe(r,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const i=this.view.constraints&&this.view.constraints.clipDistance;(i?i.mode:"auto")==="manual"?Bhe(e,i):this._updateCameraNearFarAuto(e,i)}_updateCameraNearFarAuto(e,i){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,JB(this.view,e.eye),e),i&&i.autoUpdate(e.near,e.far)}_updateCollision(){var s,n,o;const e=(o=(n=(s=this.view.map)==null?void 0:s.ground)==null?void 0:n.navigationConstraint)==null?void 0:o.type,i=!e||e==="stay-above",r=this.view.state.constraints.collision;if(i!==r.enabled){r.enabled=i,i&&this._reapplyConstraints(Jr.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Ge.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const i=this.view.state.constraints;i.tilt=i.createConstantMaxTilt(Rt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const i=this.view.state.constraints;if(i.tilt){const r=i.tilt(this.view.state.camera.distance).max;e.autoUpdate(Ma(r))}}_updateLocalSurfaceDistance(e){if(e==null)return;let i=Math.max(e.width,e.height);if(i<=0)return;e.zmax!=null&&e.zmin!=null&&(i=Math.max(i,e.zmax-e.zmin));const r=this.view.state,s=3*i/Math.atan(r.camera.fov/2);s!==r.constraints.distance&&(r.constraints.distance=s)}_reapplyConstraints(e=Jr.ALL){this.view.state.updateCamera(i=>on(this.view,i,new Qd(e,ci.NONE,null)))}};function Bhe(t,e){e&&(t.near=e.near,t.far=e.far)}h([f({constructOnly:!0})],wR.prototype,"view",void 0),h([f({readOnly:!0})],wR.prototype,"surfaceCollisionConstraint",void 0),wR=h([I("esri.views.3d.state.ConstraintsManager")],wR);let Xv=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=s3(),this._points=uAe(),this.lines=new Array(12),this._origin=E(),this._direction=E(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:E(),endpoint:null}}update(e){hAe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),ce(this._origin,e.eye),ce(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let i=0;i<this._points.length;i++)ce(this._points[i],e[i]);dAe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return Zv(this.frustum,e)}intersectsRay(e){return Drt(this.frustum,e)}intersectsLineSegment(e,i){return Nrt(this.frustum,e,i)}intersectsPoint(e){return pAe(this.frustum,e)}_updateLines(){const e=this._points;for(let i=0;i<4;i++){const r=i+4;T8(this.lines[i],e[i],e[r]),T8(this.lines[i+4],e[i],i===3?e[0]:e[i+1]),T8(this.lines[i+8],e[r],i===3?e[4]:e[r+1])}}};function T8(t,e,i){t.origin=e,t.endpoint=i,k0(t.direction,e,i)}Xv.planePointIndices=Frt,Xv.nearFarLineIndices=[[pt.NEAR_BOTTOM_LEFT,pt.FAR_BOTTOM_LEFT],[pt.NEAR_BOTTOM_RIGHT,pt.FAR_BOTTOM_RIGHT],[pt.NEAR_TOP_RIGHT,pt.FAR_TOP_RIGHT],[pt.NEAR_TOP_LEFT,pt.FAR_TOP_LEFT]];let Z$=class extends Xy{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=us.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||y2e(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),XA(this.view,e,$d.EYE_AND_CENTER)||this.constraintEnabled||(this.state=us.Stopped)})}};h([f({constructOnly:!0})],Z$.prototype,"desiredCamera",null),Z$=h([I("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],Z$);const ylt=.66;function GPe(t){return 360-tee.normalize(t)}function NG(t){return tee.normalize(360-t)}function _lt(t,e,i){const r=e.camera;if(r!=null)return blt(r,ab(t));const{targetGeometry:s}=e;if(s==null)return null;const{camera:n,mode:o}=jPe(t,e.rotation,i);if(s.type==="point")return xlt(t,e,s,n,o);const a=s.extent;return a==null?null:Z4(t,a,n.heading,n.tilt,o)}async function vlt(t,e,i,r){const s=e.camera;if(s!=null)return wlt(s,ab(t),r);const{targetGeometry:n}=e;if(n==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:o,mode:a}=jPe(t,e.rotation,i);if(n.type==="point")return Slt(t,e,n,o,a,r);const l=n.extent;if(l==null)throw new Error("Target geometry has no extent!");return j2e(t,l,o.heading,o.tilt,a,r)}function blt(t,e){const i=t.position;let r;try{r=I1(i,e)}catch{return null}if(!r)return null;const s=t.clone();return s.position=r.clone(),s}async function wlt(t,e,i){const r=t.position,s=await L1(r,e,{signal:i});Et(i);const n=t.clone();return n.position=s.clone(),n}function jPe(t,e,i){const r=YM(t,t.state.camera);let s=Sa.ADJUST;return e!=null&&(r.heading=GPe(e),s=Sa.LOCKED),i!=null&&(r.tilt=i),{camera:r,mode:s}}function xlt(t,e,i,r,s){const n=t.spatialReference;let o;try{o=I1(i.clone(),n)}catch{return null}if(!o)return null;const a=e.scale!=null?QB(t,e.scale,o.latitude):t.state.camera.distance;return iXe(t,o,a,r,s)}async function Slt(t,e,i,r,s,n){const o=t.spatialReference,a=await L1(i.clone(),o,{signal:n});Et(n);const l=e.scale!=null?QB(t,e.scale,a.latitude):t.state.camera.distance;return I2e(t,a,l,r,s,n)}function Tlt(t,e,i=null){return i==null&&(i=new M1),tre(t,null,e.clone(),i)}async function Elt(t,e,i){const r=Dlt(t,e);if(!r)throw new V("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new Eh({fov:t.camera.fov}),n=new M1({camera:s});if(r.target instanceof M1)return zb(await Alt(t,r.target,r,i,n));if(r.target instanceof Eh)return zb(await qPe(t,r.target,i,n));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof gi){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return zb(o||c?await oX(t,r,r.target.center,s,i,n):await $lt(t,r,r.target,s,i,n))}const a=new Flt,l=o?Clt(t,r):void 0;if(await HPe(t,r.target,l,a,i),isFinite(a.boundingBox[0])){let c;if(of(a.boundingBox,Zs),ih.x=Zs[0],ih.y=Zs[1],ih.z=Zs[2],ih.spatialReference=t.spatialReference,isFinite(ih.z)&&a.hasZ?c=qte(a.boundingBox):(ih.z=void 0,c=$je(Hte(a.boundingBox,klt))),o||c)return zb(await oX(t,r,ih,s,i,n));const u=Nlt(t,a.screenSpaceObjects);return zb(await Llt(t,r,ih,a.boundingBox,u,s,i,n))}return r.position?zb(await Olt(t,r,s,n,i)):zb(await Rlt(t,r,s,i,n))}function ere(t,e){return e.scale==null&&e.zoom!=null?Z2e(t,e.zoom):e.scale}function Clt(t,e){const i=ere(t,e);return i?R7e(i):void 0}function FG(t,e){let i=!1;return e.heading!=null?(t.heading=e.heading,i=!0):e.rotation!=null&&(t.heading=GPe(e.rotation),i=!0),e.tilt!=null&&(t.tilt=e.tilt,i=!0),e.fov!=null&&(t.fov=e.fov),i}function tre(t,e,i,r){const s=t.spatialReference||We.WGS84;if(e??(e=By(t,i)),e==null)return r;const n=new _t({spatialReference:s});if(!ob(e.center,t.renderSpatialReference,n))return r;r.targetGeometry=n;const{latitude:o}=n;return r.scale=o!=null?F1(t,e.distance,o):X2e(t,e),r.rotation=NG(i.heading),r.camera=i,r}async function kz(t,e,i,r){var d;const s=()=>new V("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw s();e.type==="mesh"&&(e=e.extent);const n=t.basemapTerrain.spatialReference;if(!e.hasZ&&t.basemapTerrain){let p;switch(e.type){case"point":p=e;break;case"multipoint":case"polyline":p=(d=e.extent)==null?void 0:d.center;break;case"extent":p=e.center;break;case"polygon":p=e.centroid}p!=null&&n&&t.elevationProvider?(p=await L1(p,n,{signal:r}),Zs[2]=Qm(t.elevationProvider,p)??0):Zs[2]=0}const o=Ult[e.type],a=new Array;if(o(e,e.hasZ?p=>{a.push([p[0],p[1],p[2]])}:p=>{a.push([p[0],p[1]])},Zs),a.length===0)throw s();const l=e.spatialReference,c=t.spatialReference,u=await L1(new $A({spatialReference:l,hasZ:e.hasZ,hasM:!1,points:a}),c,{signal:r});if(e.hasZ&&(i.hasZ=!0),e.hasZ)for(const[p,m,g]of u.points)Zs[0]=p,Zs[1]=m,Zs[2]=g,Af(i.boundingBox,Zs);else for(const[p,m]of u.points)Zs[0]=p,Zs[1]=m,Af(i.boundingBox,Zs)}async function Mlt(t,e,i,r,s){const n=await Vd(t.whenViewForGraphic(e));if(n.ok===!1||n.value==null||!("whenGraphicBounds"in n.value))return void await kz(t,e.geometry,r,s);const o=n.value,a=await Vd(o.whenGraphicBounds(e,{minDemResolution:i}));if(a.ok===!1||!a.value)return void await kz(t,e.geometry,r,s);const{screenSpaceObjects:l,boundingBox:c}=a.value;JM(r.boundingBox,c),l&&l.forEach(u=>{r.screenSpaceObjects.push(u)}),isFinite(c[2])&&(r.hasZ=!0)}async function HPe(t,e,i,r,s){var n;if(Array.isArray(e)&&e.length===2){const o=e[0],a=e[1];if(typeof o=="number"&&typeof a=="number")return ih.x=o,ih.y=a,ih.z=void 0,ih.spatialReference=(n=t.spatialReference)!=null&&n.isGeographic?t.spatialReference:We.WGS84,void await kz(t,ih,r,s)}e&&"map"in e&&typeof e.map=="function"?await Promise.allSettled(e.map(o=>HPe(t,o,i,r,s))):e instanceof eb?await kz(t,e,r,s):e instanceof Su&&await Mlt(t,e,i,r,s)}async function Alt(t,e,i,r,s){if(e.camera)return qPe(t,e.camera,r,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=NG(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=ere(t,i);return n!=null&&(s.scale=n),s.camera=await vlt(t,s,i.tilt,r),s}async function qPe(t,e,i,r){const s=t.spatialReference,n=await L1(e.position,s,{signal:i}),o=e.clone();return o.position=n,tre(t,null,o,r)}async function Plt(t,e,i,r,s,n,o){const a=t.renderSpatialReference;return await qU(e,E8,a,0,{signal:o}),await qU(i,PN,a,0,{signal:o}),n.targetGeometry=new _t(e),s.position=new _t(i),ve(Uz,E8,PN),KB(t,PN,Uz,r.up,s),n.scale=F1(t,wr(PN,E8),n.targetGeometry.latitude),n.rotation=NG(s.heading),n.camera=s,n}async function oX(t,e,i,r,s,n){n.targetGeometry=i.clone();const o=ST(t);if(e.position)return Plt(t,n.targetGeometry,e.position,o,r,n,s);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=oe(Zs,o.viewForward,-l);o.eye=me(Zs,o.center,c),n.scale=F1(t,l,i.latitude)}YM(t,o,r);const a=FG(r,e)?Sa.LOCKED:Sa.ADJUST;if(!e.zoomFactor){const l=ere(t,e);l==null?(await qU(i,Zs,t.renderSpatialReference,0,{signal:s}),pAe(o.frustum,Zs)?n.scale=F1(t,wr(o.eye,Zs),i.latitude):n.scale=X2e(t,o)):n.scale=l,n.camera=await $2e(t,n.targetGeometry,n.scale,r,a,s)}return n}async function Olt(t,e,i,r,s){const n=ST(t);ce(Uz,n.viewForward),KB(t,n.eye,Uz,n.up,C8);const o=t.spatialReference,{position:a}=e;if(a){const l=await L1(a,o,{signal:s});i.position=l}else i.position=new _t;return i.heading=e.heading!=null?e.heading:C8.heading,i.tilt=e.tilt!=null?e.tilt:C8.tilt,tre(t,null,i,r)}async function Rlt(t,e,i,r,s){if(e.heading!=null||e.rotation!=null||e.scale!=null||e.tilt!=null||e.zoom!=null||e.zoomFactor!=null){const n=ST(t),{spatialReference:o,renderSpatialReference:a}=t,l=new _t({spatialReference:o});return ob(n.center,a,l)?oX(t,e,l,i,r,s):s}return s.scale=t.scale,s.camera=t.camera.clone(),FG(s.camera,e),s}async function $lt(t,e,i,r,s,n){n.targetGeometry=i.clone();const o=ST(t);YM(t,o,r);const a=FG(r,e)?Sa.LOCKED:Sa.ADJUST;return n.camera=await j2e(t,i,r.heading,r.tilt,a,s),n}function Ilt(t,e,i,r,s){let n=0;i.z!=null?n=i.z:t.basemapTerrain&&t.elevationProvider&&(n=Qm(t.elevationProvider,i)),ne(Zs,i.x,i.y,n),mu(t.spatialReference,Zs,Ghe,t.renderSpatialReference),Xd(AN,Ghe),xT(AN,AN),Br(VP);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){const y=o[g];let v=r[y[2]];isFinite(v)||(v=n),ne(Zs,r[y[0]],r[y[1]],v),Zn(Zs,t.spatialReference,Zs,t.renderSpatialReference),Af(VP,Qo(Zs,Zs,AN))}const a=TT(VP),l=ub(VP),c=ET(VP),u=1/Math.tan(e.fovX/2),d=1/Math.tan(e.fovY/2),p=.5*Math.sqrt(a*a+c*c)*Math.max(d,u)+.5*l,m=.5*l*d+.5*Math.max(a,c);return Math.max(p,m)/s}async function Llt(t,e,i,r,s,n,o,a){a.targetGeometry=i.clone();const l=ST(t),c=Ilt(t,l,i,r,s);YM(t,l,n);const u=FG(n,e)?Sa.LOCKED:Sa.ADJUST;return a.scale=F1(t,c,a.targetGeometry.latitude),a.camera=await $2e(t,a.targetGeometry,a.scale,n,u,o),a}function Dlt(t,e){if(!e||!t.spatialReference)return null;const i={target:void 0};return"declaredClass"in e||Array.isArray(e)?i.target=e:(Object.assign(i,e),!i.target&&"center"in e&&e.center&&(i.target=e.center)),i}function zb(t){return(t==null?void 0:t.camera)!=null&&(t.rotation=NG(t.camera.heading)),t}function Nlt(t,e){const i=ylt;if(!e.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(t.width,t.height)*2}class Flt{constructor(){this.hasZ=!1,this.boundingBox=Br(),this.screenSpaceObjects=new Array}}const Zs=E(),Ghe=Ee(),AN=Gr(),VP=Jn(),klt=Ht(),Uz=E(),PN=E(),E8=E(),C8={heading:0,tilt:0},ih=new _t,Ult={point(t,e,i){i[0]=t.x,i[1]=t.y,t.z!=null&&(i[2]=t.z),e(i)},polygon(t,e,i){const r=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),e(i)}},polyline(t,e,i){const r=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),e(i)}},multipoint(t,e,i){const r=t.points,s=t.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),e(i)},extent(t,e,i){t.zmin!=null&&t.zmax!=null?(e(ne(i,t.xmin,t.ymin,t.zmin)),e(ne(i,t.xmax,t.ymin,t.zmin)),e(ne(i,t.xmin,t.ymax,t.zmin)),e(ne(i,t.xmax,t.ymax,t.zmin)),e(ne(i,t.xmin,t.ymin,t.zmax)),e(ne(i,t.xmax,t.ymin,t.zmax)),e(ne(i,t.xmin,t.ymax,t.zmax)),e(ne(i,t.xmax,t.ymax,t.zmax))):(e(ne(i,t.xmin,t.ymin,i[2])),e(ne(i,t.xmax,t.ymin,i[2])),e(ne(i,t.xmin,t.ymax,i[2])),e(ne(i,t.xmax,t.ymax,i[2])))}};let zlt=class{constructor(e,i,r){this._target=e,this._options=i,this.view=r,this.state="pending",this._animationController=null,this.promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;this._options.signal!=null&&Io(this._options.signal,()=>{this.abort()}),this._abortController=o,this._waitForReady()})}_resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}_reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this._reject(Di())}async _waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await zI(()=>this.view.ready,this._abortController.signal)}catch(e){return this._reject(e)}this._createViewPoint()}async _createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this._options.animate?this._getAnimationController():null;try{const e=await Elt(this.view,this._target,this._abortController.signal);if(this.state==="finished")return;const i=e?this._getCameraFromViewpoint(e):null;if(i==null)return;if(this._options.animate){if(this._animationController==null)return;this._startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this._resolve()}catch(e){this._reject(e)}}}_getCameraFromViewpoint(e){var n;const i=!!(this._target instanceof M1&&this._target.camera||this._target instanceof Eh),r=e.camera;if(r==null)return null;if(!this.view.stateManager.isCompatible(r)){const o=r.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(n=this.view.spatialReference)==null?void 0:n.wkid;return this._reject(new V("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:r})),null}const s=By(this.view,r);return s==null?(this._reject(new V("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:i}}_startAnimation(e,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(r==null)return void this._reject(new V("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!i.active||i.viewAnimation==null||i.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;e.isFullySpecified?(s=new Z$({view:this.view,desiredCamera:e.camera}),XA(this.view,e.camera,$d.EYE_AND_CENTER)):on(this.view,e.camera),i.begin(e.camera,this._options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof n0&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):i.viewAnimation!=null&&i.viewAnimation.target===e.viewpoint&&i.state===us.Finished&&(this.view.state.cameraController=s))},o=a=>{if(this.view.state!=null)switch(i.state){case us.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._resolve()}break;case us.Ready:case us.Rejected:case us.Running:case us.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._reject(a)}}};r.when(n,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,i=null;const r=this.view.state.cameraController;return r instanceof n0&&(r.updateStateFromViewAnimation(),r.active&&(e=r,i=e.viewAnimation)),e!=null||(e=new n0({view:this.view,mode:"animation"}),i=e.viewAnimation,this.view.state.switchCameraController(e))?e:(i!=null&&i.stop(),this._reject(new V("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},q1=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,i){var r;return(r=this._outer.get(e))==null?void 0:r.get(i)}set(e,i,r){const s=this._outer.get(e);s?s.set(i,r):this._outer.set(e,new Map([[i,r]]))}delete(e,i){const r=this._outer.get(e);r&&(r.delete(i),r.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((i,r)=>e(i,r))}};var Ws;function jhe(t=!re("disable-feature:high-quality-idle"),e=null){const i=new q1;return t?(i.set(Mi.IDLE,Ws.Antialiasing,e!=="low"),i.set(Mi.IDLE,Ws.HighResolutionAtmosphere,e!=="low"),i.set(Mi.IDLE,Ws.HighQualityTransparency,!0),i.set(Mi.IDLE,Ws.SSAO,!0),i.set(Mi.IDLE,Ws.WaterReflection,!0),i.set(Mi.IDLE,Ws.PhysicalPixelRendering,!0)):(i.set(Mi.ANIMATING,Ws.HighResolutionShadows,!0),i.set(Mi.ANIMATING,Ws.HighResolutionViewshed,!0),i.set(Mi.INTERACTING,Ws.HighResolutionShadows,!0),i.set(Mi.INTERACTING,Ws.HighResolutionViewshed,!0)),i.set(Mi.IDLE,Ws.HighResolutionShadows,!0),i.set(Mi.IDLE,Ws.HighResolutionViewshed,!0),i.set(Mi.IDLE,Ws.HighResolutionVoxel,!0),i}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.HighResolutionViewshed=7]="HighResolutionViewshed",t[t.PhysicalPixelRendering=8]="PhysicalPixelRendering"})(Ws||(Ws={}));let Ks=class extends Re{constructor(e){super(e),this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=Hhe,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:i=>this._devicePixelRatioOverride=i,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(i){this.viewStateManager._idleTimeout=i?Hhe:0}},this._propertiesPool=new C0({frustum:Xv},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new Vlt}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Ta(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),ue(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,i)=>this._cameraChangedHandler(e,i),ar)]),vu(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([RS({prepare:()=>this._prepareFrame()}),ue(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(RN)}),Ta(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Le(this._propertiesPool)}get camera(){const e=this._get("camera");if(!this.ready)return e;const i=YM(this.view,this.view.state.camera,M8);return i&&e&&i.equals(e)?e:i.clone()}set camera(e){var i,r;this._updatePropertyBeforeReady("camera",e)||((i=this.view.elevationProvider)==null||i.enableCache(!0),this.setStateCamera(By(this.view,e),{applyConstraints:!1})||ie.getLogger(this).error("#camera=","Invalid camera",e),(r=this.view.elevationProvider)==null||r.enableCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const i=YM(this.view,this.view.state.contentCamera,M8);return i&&e&&i.equals(e)?e:i.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const i=By(this.view,e);i!=null?(this._updateElevation(i),this.view.state.contentCamera=i):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(A8),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const i=this.zoom,r=this.view.state.camera.distance**2,s=Ol(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([ue(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(A8),this.test.contentCameraResetState.clear())}),ue(()=>this.zoom,o=>{o!==void 0&&i!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-i)/2),Math.abs(o-i)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),ue(()=>this.view.state.camera,o=>{const a=Ko(s,o.center);this.test.contentCameraResetState.set("camera.center",a/r),a>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],A8),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var i;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():ie.getLogger(this).error("#center=","Invalid center",e):ie.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e):ie.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,i=H2e(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return i??this._get("extent")}set extent(e){var i;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||ie.getLogger(this).error("#extent=","Invalid extent",e):ie.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e):ie.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){var i;const e=this.view.map;return e&&"initialViewProperties"in e?(i=e.initialViewProperties)==null?void 0:i.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return F1(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||ie.getLogger(this).error("#scale=","Invalid scale",e)}get terrainScale(){if(!this.ready)return this._get("scale");const e=this.view,i=e.basemapTerrain.tilingScheme,r=e.pointsOfInterest.cameraOnSurface.scale;if(!i||!r)return this._get("scale");const s=e.state.contentCamera;let n=KB(e,s.eye,s.viewForward,s.up).tilt;n>90&&(n=180-n);const o=2*(n/90)**2,a=i.levelAtScale(r)-o;return a<0?this._get("scale"):i.scaleAtLevel(a)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,i=e.padding,r=e.pixelRatio,s=this._get("padding"),n=Math.round(i[ai.TOP]/r),o=Math.round(i[ai.RIGHT]/r),a=Math.round(i[ai.BOTTOM]/r),l=Math.round(i[ai.LEFT]/r);return s!=null&&s.top===n&&s.right===o&&s.bottom===a&&s.left===l?s:{top:n,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,ON),this.view.state.updateCamera(i=>i.padding=ON))}_paddingToArray(e,i,r){e?ds(r,e.top||0,e.right||0,e.bottom||0,e.left||0):ds(r,0,0,0,0);for(let s=0;s<4;s++)r[s]=Math.round(r[s]*i)}get screenCenter(){const e=this.padding;return Bd((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?Tlt(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var i;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||ie.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const r=e.camera!=null?e.camera.position:e.targetGeometry,s=r!=null&&r.spatialReference;ie.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(s?s.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e)}else ie.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?uXe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||ie.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){var s;if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),i=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*i),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*i);const r=(s=this.view._stage.renderView.renderingContext)==null?void 0:s.parameters.maxTextureSize;return r&&Yx(this._tmpCanvasSize,r),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:i,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,i;return((i=(e=this.view)==null?void 0:e._stage)==null?void 0:i.renderer.isFeatureEnabled(Ws.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var i,r;const e=(r=(i=this.view)==null?void 0:i._stage)==null?void 0:r.renderer;return e&&(e.isFeatureEnabled(Ws.PhysicalPixelRendering,Mi.IDLE)||e.isFeatureEnabled(Ws.PhysicalPixelRendering,Mi.INTERACTING)||e.isFeatureEnabled(Ws.PhysicalPixelRendering,Mi.ANIMATING))}preinit(e){var i,r,s;return!(this._isOverridden("center")&&!J2(this.center.spatialReference,e))&&!(this._isOverridden("camera")&&!J2(this.camera.position.spatialReference,e))&&!(this._isOverridden("extent")&&!J2(this.extent.spatialReference,e))&&!!(!this._isOverridden("viewpoint")||J2((i=this.viewpoint.targetGeometry)==null?void 0:i.spatialReference,e)&&J2((s=(r=this.viewpoint.camera)==null?void 0:r.position)==null?void 0:s.spatialReference,e))}init(){this._constraintsManager=new wR({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const i of e)this.set(i.name,i.value);if(!this._cameraSetByUser){const i=this._initialViewpoint||this.view.initialExtent;i&&this.isCompatible(i)?this._setInitialView(i):this.view.state.viewingMode===Ge.Local&&this.addHandles(vu(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(RN),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),RN)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(RN),this._constraintsManager=Le(this._constraintsManager))}async goTo(e,i){return i={animate:!0,...i},this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new zlt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(ST(this.view),{applyConstraints:!1})}step(e){const i=this.view.state,r=i==null?void 0:i.cameraController;r&&(i.updateCamera(s=>r.stepController(e,s)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,i=[];for(const{propertyName:r,overrides:s}of Glt){const n=e.has(r),o=this._isOverridden(r);!n&&o&&i.push({name:r,value:this._get(r)}),this._clearOverride(r),(n||o)&&s.forEach(a=>e.add(a))}return i}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof Eh)return void this.setStateCamera(By(this.view,e),{applyConstraints:!1});if(e instanceof M1){if(e.targetGeometry instanceof gi){const n=Z4(this.view,e.targetGeometry,0,.5,Sa.LOCKED);return void(n!=null&&this.setStateCamera(By(this.view,n),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,r)}const i=Z4(this.view,e,0,.5,Sa.LOCKED);i!=null&&this.setStateCamera(By(this.view,i),{applyConstraints:!0})}_updatePropertyBeforeReady(e,i){return!this.ready&&(this._override(e,i),i&&Blt.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof M1?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Eh?this.isCompatible(e.position):e.spatialReference&&!fSe(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=jlt){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,i,r=x_){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),o=wte(this.view,s,n,e,i,Sa.ADJUST);return o==null?null:(r.copyFrom(this.view.state.camera),r.eye=o.eye,r.center=o.center,r.up=o.up,r)}_centerToCamera(e){const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:i,tilt:r}=this._getPreservingHeadingTilt(),s=Z4(this.view,e,i,r,Sa.ADJUST,M8);return s?By(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.renderLocation,s=i.location.latitude,n=QB(this.view,e,s);return this._centerPointAtDistanceToCamera(r,n)}_zoomToCamera(e){return this._scaleToCamera(Z2e(this.view,e))}_viewpointToCamera(e){return By(this.view,_lt(this.view,e))}setStateCamera(e,i){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,i.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{i.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up,r.fov=e.fov):r.copyFrom(e),i.applyConstraints&&on(this.view,r)}),i.applyConstraints||(this.view.state.cameraController=new Z$({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:i}=this.view;if(!e||!i)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._computeCanvasSize();if(r.width!==0&&r.height!==0&&(i.width===r.width&&i.height===r.height||(i.width=r.width,i.height=r.height),this.view.state)){const s=this.view.state.camera;s.fullWidth===r.width&&s.fullHeight===r.height&&s.pixelRatio===r.pixelRatio||(x_.copyFrom(s),x_.pixelRatio!==r.pixelRatio&&(this._paddingToArray(this.padding,r.pixelRatio,ON),x_.padding=ON),x_.fullWidth=r.width,x_.fullHeight=r.height,x_.pixelRatio=r.pixelRatio,this.view.state.camera=x_),this._updateViewState()}}_updateElevation(e){var n,o;const i=(n=this.view.basemapTerrain)==null?void 0:n.spatialReference,r=((o=this.view.renderCoordsHelper)==null?void 0:o.getAltitude(e.eye))??0,s=i?JB(this.view,e.eye):0;e.relativeElevation=r-s}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Mi.ANIMATING:this.view.interacting?this.view.state.mode=Mi.INTERACTING:(this.view.state.mode===Mi.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=Mi.INTERACTING:this.view.state.mode=Mi.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,i){e&&i&&e.almostEquals(i)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};h([f({type:Eh,dependsOn:["view.state.camera","ready"]})],Ks.prototype,"camera",null),h([f({type:Eh,dependsOn:["view.state.contentCamera","ready"]})],Ks.prototype,"contentCamera",null),h([f({type:_t})],Ks.prototype,"center",null),h([f({type:gi})],Ks.prototype,"extent",null),h([f({readOnly:!0})],Ks.prototype,"frustum",null),h([f()],Ks.prototype,"_constraintsManager",void 0),h([f({readOnly:!0})],Ks.prototype,"constraintsManager",null),h([f()],Ks.prototype,"_initialViewpoint",null),h([f({readOnly:!0})],Ks.prototype,"hasInitialView",null),h([f({readOnly:!0,type:Boolean})],Ks.prototype,"ready",void 0),h([f({type:Number})],Ks.prototype,"scale",null),h([f({type:Number})],Ks.prototype,"terrainScale",null),h([f()],Ks.prototype,"padding",null),h([f({readOnly:!0})],Ks.prototype,"screenCenter",null),h([f({constructOnly:!0})],Ks.prototype,"view",void 0),h([f({type:M1})],Ks.prototype,"viewpoint",null),h([f({type:Number})],Ks.prototype,"zoom",null),h([f({readOnly:!0})],Ks.prototype,"_rasterPixelRatio",null),h([f({readOnly:!0})],Ks.prototype,"_usePhysicalPixelRendering",null),h([f({readOnly:!0})],Ks.prototype,"_usePhysicalPixelRenderingAny",null),h([f()],Ks.prototype,"_windowDevicePixelRatio",void 0),h([f()],Ks.prototype,"_devicePixelRatioOverride",void 0),Ks=h([I("esri.views.3d.state.ViewStateManager")],Ks);let Vlt=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const Blt=new Set(["camera","viewpoint","extent","scale","center","zoom"]),Glt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],jlt={heading:0,tilt:0},M8=new Eh,x_=new Pr,ON=Qt(),RN="pending-initial-view",A8="content-camera-reset",Hhe=300,qhe=100;let tg=class extends Xy{constructor(){super(...arguments),this.startCamera=new Pr,this.currentCamera=new Pr,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<qhe}stepController(e,i){i.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(i)}onControllerStart(e){this.state=us.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),qhe),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};h([f({readOnly:!0})],tg.prototype,"isInteractive",null),h([f()],tg.prototype,"_lastInteraction",void 0),tg=h([I("esri.views.3d.state.controllers.InteractiveController")],tg);var Xc;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(Xc||(Xc={}));let X$=class extends tg{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=Xc.CENTER,this._rotScale=0,this._lastPoint=lt(),this._tmpWorldUp=E(),this._tmpViewDir=E(),this._tmpRotCurPoint=lt(),this._tmpTransf=Ee(),this._tmpAxis=E(),this._tmpPivotPoint=E(),this._pivotPos=E(),this._constraintOptions=new Qd(Jr.ALL,ci.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===Xc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Xc.EYE:ce(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=ci.LOOK_AROUND,this._constraintOptions.tiltMode=Cg.LOOK_AROUND,this._constraintOptions.selection=Jr.NONE;break;case Xc.CENTER:{const i=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?IT:{});i||ce(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,i),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=ci.TUMBLE,this._constraintOptions.tiltMode=Cg.TUMBLE,this._constraintOptions.selection=Jr.ALL&~Jr.DISTANCE;break}}SS(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,i){const r=this.startCamera,s=E();ve(s,this._pivotPos,r.eye);const n=Ae(s),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Whe);let a=Math.max(Math.min(Yat,1/Math.abs(pe(Whe,r.viewForward)))*o,Zat);i&&(a=Math.min(n,a));const l=vs(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),c=SL(this.startCamera,l,this.view.renderCoordsHelper,this.view.viewingMode);let u=this.view._stage.renderView.getMinimalDepthForArea(h3(this.view),r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*v8,v8),d=this.view._stage.renderView.getMinimalDepthForArea(h3(this.view),e[0],e[1],r,v8);u==null&&d==null||(u=u??d??0,d=d==null||c===ba.Horizontal?u:d,a=u>d?d:u,a=i?Math.min(a,n):a),ge(s,s),ce(this._pivotPos,me(this._tmpPivotPoint,r.eye,oe(this._tmpPivotPoint,s,a)))}update(e){if(this.active){switch(this.pivot){case Xc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case Xc.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}on(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,i,r,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),SS(e,i,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;ve(this._tmpViewDir,r,s);const a=Ae(this._tmpViewDir),l=fo(pe(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===Xc.EYE){n*=-.5;const c=.5*Math.PI-l,u=.5*Math.PI*.99;n=c-Math.max(-u,Math.min(u,c+n))}return n=Te(n+l,ya.min,ya.max)-l,ot(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===Xc.CENTER&&(o=-o),wu(this._tmpTransf,o,this._tmpWorldUp),uu(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),He(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=He(P8,e.up,this._tmpTransf),me(P8,s,this._tmpViewDir),Aa(this._lastPoint,this._tmpRotCurPoint),P8}};h([f()],X$.prototype,"pivot",void 0),X$=h([I("esri.views.3d.state.controllers.RotateController")],X$);const P8=E(),Whe=E();let O8=class extends na{constructor(e,i,r,s){super(!0),this._view=e,this.pointerAction=i,this._pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!Kie(e.data,this.pointerAction))return;const r=vs(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new X$({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},aX=class extends tg{constructor(){super(...arguments),this._pickPoint=E(),this._tmpP0=lt(),this._panAxisAngle=LG(),this._tmpRayDir=E(),this._tmpRayDirPick=E(),this._targetOnSphere=E(),this._navMode=ba.Horizontal,this._tmpRay={origin:E(),direction:E()},this.dragBeginPoint=vs(),this._normalizedAnchorPoint=lt(),this._constraintOptions=new Qd(Jr.ALL_EXCEPT_COLLISION,ci.ZOOM,0,this.startCamera),this._sphere=ln(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Aa(this.dragBeginPoint,e),SS(this.startCamera,e,this._normalizedAnchorPoint);const i=ur(this.view.spatialReference),r=LPe(this._intersectionHelper,this.startCamera,e,i,sA.Ellipsoid,this.view.map.ground.opacity===0?IT:{});if(this._navMode=SL(this.startCamera,e,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===ba.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=r.scenePickPoint??this._pickPoint,this._sphere=r.sphere;else{let s;JA(this.startCamera,e,this._tmpRay),ge(this._tmpRay.direction,this._tmpRay.direction),r.scenePickPoint!=null&&(ve(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),s=Ae(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,Yhe);let o=Te(Math.min(CPe,1/Math.abs(pe(Yhe,this._tmpRay.direction)))*n,$z[0],$z[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,DG);o=a??o,o=s!=null?Math.min(o,s):o,this._hasPickPoint=!0,oe(this._tmpRay.direction,this._tmpRay.direction,o),me(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===ba.Horizontal){ve(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=Ae(this._tmpRayDir);SS(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<1e-6)return;if(this._hasPickPoint&&s<i){const o=1-(1-s/i)*(1-this._sphere[3]/Ae(this.currentCamera.center));this.currentCamera.center=oe($N,this.currentCamera.center,o)}oe(this._tmpRayDir,this._tmpRayDir,-s/i),this.currentCamera.eye=me($N,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Xp(V1(this.dragBeginPoint,e)),on(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(u3(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),qie(this._pickPoint,this._targetOnSphere,this._panAxisAngle),H1(this.currentCamera,this._sphere,this._panAxisAngle))}else{const i=Ae(this._tmpRay.direction);SS(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<1e-6)return;oe(this._tmpRayDir,this._tmpRay.direction,1-s/i),this.currentCamera.eye=me($N,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=me($N,this.currentCamera.center,this._tmpRayDir)}XA(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};aX=h([I("esri.views.3d.state.controllers.ZoomControllerGlobal")],aX);const $N=E(),Yhe=E();let lX=class extends tg{constructor(){super(...arguments),this._tmpP=E(),this._tmpDir=E(),this._tmpN=E(),this._tmpP0=lt(),this._tmpPoi=E(),this._tmpRayDir=E(),this.dragBeginPoint=vs(),this._normalizedAnchorPoint=lt(),this._constraintOptions=new Qd(Jr.ALL,ci.ZOOM,0,this.startCamera,E()),this._plane=Qi()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Aa(this.dragBeginPoint,e),SS(this.startCamera,e,this._normalizedAnchorPoint);const i=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?IT:{});ve(this._tmpDir,this._tmpP,this.startCamera.eye);const r=Ae(this._tmpDir);ge(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=Te(Math.min(CPe,1/Math.abs(pe(Hlt,this._tmpDir)))*s,$z[0],$z[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(h3(this.view),e[0],e[1],this.view.state.camera,DG);n=o??n,n=i?Math.min(n,r):n,oe(this._tmpDir,this._tmpDir,n),me(this._tmpP,this.startCamera.eye,this._tmpDir),ve(this._tmpN,this.startCamera.eye,this.startCamera.center),ge(this._tmpN,this._tmpN),this._tmpN[1]<0&&ea(this._tmpN,this._tmpN),nL(this._tmpP,this._tmpN,this._plane)}update(e){if(!this.active)return;Xat(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||ce(this._tmpPoi,this.currentCamera.center),SS(this.currentCamera,e,this._tmpP0);let i=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);Aa(this._normalizedAnchorPoint,this._tmpP0),ve(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=Ae(this._tmpRayDir);let s=r*(1-i);this._constraintOptions.interactionDirection&&(ce(this._constraintOptions.interactionDirection,this._tmpRayDir),oe(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(i)/r));const n=this.view.state.constraints.minimumPoiDistance;i>=0&&s<n&&(s=n,i=-(s-r)/r),Math.abs(r-s)<1e-6||(oe(this._tmpRayDir,this._tmpRayDir,i),this.currentCamera.eye=me(Vb,this.currentCamera.eye,this._tmpRayDir),yr(Vb,this.currentCamera.center,this._tmpPoi,i),this._tmpPoi[2]>this.startCamera.center[2]?Vb[2]=Math.max(this.startCamera.center[2],Vb[2]):Vb[2]=Math.min(this.startCamera.center[2],Vb[2]),this.currentCamera.center=Vb,this._constraintOptions.interactionFactor=Xp(V1(this.dragBeginPoint,e)),on(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};lX=h([I("esri.views.3d.state.controllers.ZoomControllerLocal")],lX);const Vb=E(),Hlt=$e(0,0,1);let qlt=class extends na{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!Kie(e.data,this.pointerAction))return;const r=vs(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new aX({view:this._view}):this._cameraController=new lX({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function lp(t){let e=t*t;return t<0&&(e*=-1),e}function Zhe(t,e,i){const r=i,s=t.state,n=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(r.translation[0]=lp(s.axes[0]),r.translation[1]=lp(s.axes[1]),r.translation[2]=lp(s.buttons[7])-lp(s.buttons[6]),r.heading=lp(s.axes[2]),r.tilt=lp(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*lp(s.axes[0]),r.translation[1]=1.2*lp(s.axes[1]),r.translation[2]=2*-lp(s.axes[2]),r.heading=1.2*lp(s.axes[5]),r.tilt=1.2*lp(s.axes[3])),r.tilt*=o,oe(r.translation,r.translation,a),r}function Xhe(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function R8(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let Zx=class extends tg{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new Pr,this._headingStart=0,this._constraintOptions=new Qd(Jr.ALL,ci.NONE,0,new Pr,null,Cg.LOOK_AROUND)}handleEventGamepad(e){const i=Zhe(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||R8(i))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,Xhe(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const i=Xhe(this._keysButtonState,this._transformation);R8(i)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const i=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(i-this._filteredSurfaceElevation)*e}stepController(e,i){var r;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(i),this._updateCameraCenter(),(r=this._constraintOptions.interactionStartCamera)==null||r.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Bb),this._applyDisabledMovementTypes(Bb),this._applyPan(Bb.pan),this._applyRotate(Bb.rotate),this._applyZoom(Bb.zoom),this._applyAscend(Bb.ascend),this._constraintOptions.interactionType=ci.NONE,this._constraintOptions.selection=Jr.COLLISION,on(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,i)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const i=this.currentCamera;ve(Wl,i.center,i.eye),He(Wl,Wl,e.matrix),i.center=me(Wl,Wl,i.eye),i.up=He(Wl,i.up,e.matrix),this._constraintOptions.interactionType=ci.LOOK_AROUND,this._constraintOptions.selection=Jr.ALL_EXCEPT_COLLISION,on(this.view,i,this._constraintOptions)}_applyPan(e,i=this.currentCamera){e.enabled&&(i.eye=He(Wl,i.eye,e.matrix),i.center=He(Wl,i.center,e.matrix),this.view.state.isGlobal&&(i.up=He(Wl,i.up,e.matrix)),this._constraintOptions.interactionType=ci.PAN,this._constraintOptions.selection=Jr.ALL,on(this.view,i,this._constraintOptions))}_applyZoom(e){if(!e)return;const i=this.currentCamera.viewForward;this.currentCamera.eye=me(Wl,this.currentCamera.eye,oe(Ye.get(),i,e)),ce(BP,i),ea(BP,BP),this._constraintOptions.interactionDirection=BP,this._constraintOptions.interactionType=ci.ZOOM,this._constraintOptions.selection=Jr.ALL_EXCEPT_COLLISION,on(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const i=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Ye.get());if(this._constraintOptions.interactionDirection=ce(BP,i),this.view.state.isGlobal){const r=Ae(this.currentCamera.eye),s=(r+e)/r;this.currentCamera.eye=oe(Wl,this.currentCamera.eye,s),this.currentCamera.center=oe(Wl,this.currentCamera.center,s)}else{const r=oe(Ye.get(),i,e);this.currentCamera.eye=me(Wl,this.currentCamera.eye,r),this.currentCamera.center=me(Wl,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=ci.ASCEND,this._constraintOptions.selection=Jr.COLLISION,on(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Jr.ALL_EXCEPT_COLLISION,on(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,i,r){Klt(r);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,i,r):this._calculateControlTransformationGlobal(s,i,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,i=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=i.intersectManifoldClosestSilhouette(r,e,Wl)}_calculateControlTransformationLocal(e,i,r){const{viewRight:s,viewForward:n}=i,o=this._transformation,a=this.view.navigation.gamepad,l=ne(Ye.get(),n[0],n[1],0);ge(l,l);const c=o.translation[0]*e.pan;if(c!==0){const y=oe(Ye.get(),s,c);rl(r.pan.matrix,r.pan.matrix,y),r.pan.enabled=!0}switch(a.mode){case"pan":{const y=-o.translation[1]*e.pan;if(y!==0){const v=oe(Ye.get(),l,y);rl(r.pan.matrix,r.pan.matrix,v),r.pan.enabled=!0}r.zoom=o.zoom*e.zoom;break}case"zoom":r.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const u=o.translation[2]*e.ascend;r.ascend=u;const d=-o.heading*e.rotate;d!==0&&(uu(r.rotate.matrix,r.rotate.matrix,d,this.view.renderCoordsHelper.worldUpAtPosition(i.eye,Ye.get())),r.rotate.enabled=!0);const p=o.tilt*e.rotate,m=j1(this.view.renderCoordsHelper,i.center,i.eye),g=Te(m+p,ya.min,ya.max)-m;g&&(uu(r.rotate.matrix,r.rotate.matrix,g,s),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,i,r){const{eye:s,viewRight:n}=i,o=this._transformation,a=this.view.navigation.gamepad,l=ot(Ye.get(),n,s);ge(l,l),ea(l,l),ilt(this.startCamera,i,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Bb.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,u=o.translation[2]*e.ascend;r.ascend=u;const d=-o.heading*e.rotate;d!==0&&(uu(r.rotate.matrix,r.rotate.matrix,d,this._tmpCamera.eye),r.rotate.enabled=!0);const p=o.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(p,i.ray,c);m!==0&&(uu(r.rotate.matrix,r.rotate.matrix,m,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,i,r){const s=ur(this.view.spatialReference),n=L5(ya.min,i.origin,r,s);let o=0,a=0;const l=Ye.get();if(this.view.renderCoordsHelper.intersectManifold(i,r,l)){const c=j1(this.view.renderCoordsHelper,l,i.origin);o=L5(c,i.origin,r,s),a=L5(ya.max,i.origin,r,s)}else{zA(UB(zB,r+s.radius),i,l);const c=Math.PI+Qee(i.direction,l);o=Rhe(c,i.origin,r,s),a=Rhe(ya.max,i.origin,r,s)}return Te(o+e,n,a)-o}_getPointAbsoluteSurfaceElevation(e,i,r){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),o=i+Math.abs(n-i);return s.setAltitude(r,o,e),o}_clampedDistanceToSurface(e,i){const{renderCoordsHelper:r}=this.view,{camera:s}=this.view.state,{direction:n}=tXe(this.view,i,0,WPe,Qlt),o=r.intersectManifoldClosestSilhouette(Mh(i,n),e,Ye.get()),a=wr(i,o),l=r.intersectManifoldClosestSilhouette(Mh(i,k0(Ye.get(),i,s.center)),e,Ye.get()),c=wr(i,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:i,state:r}=this.view,{camera:s,isGlobal:n}=r,o=i.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,Ye.get());if(n){const a=ve(Ye.get(),e,o),l=Ae(a);oe(a,a,1/l);const c=ge(Ye.get(),e),u=fo(pe(c,a));return l*Math.sin(Math.min(Ylt,u))}{const a=ce(Ye.get(),e);return i.setAltitude(a,this._filteredSurfaceElevation),wr(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:Zlt}_computeVelocities(e){const i=this._filteredSurfaceElevation,r=i+ur(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,o=Ye.get(),a=this._getPointAbsoluteSurfaceElevation(s.eye,i,o),l=this._clampedDistanceToSurface(i,o),c=s.width/2,u=Jhe*s.width,d=Jhe*s.width,p=l*Math.tan(.5*s.fovX)/c,m=p/r,g=p/this._computeHeadingRotateRadius(o),y=a-i;return{pan:(n?m:p)*u*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(u*e/c)*y-y),zoom:2**(u*e/c)*l-l,rotate:Te(g*d,Xlt,Jlt)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Gd(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Gd(e.rotate.matrix))}static activatesFor(e,i){const r=Zhe(i,e.navigation.gamepad,Wlt);return!(i.action==="end"||R8(r))}};h([f({constructOnly:!0})],Zx.prototype,"gamepadDevice",void 0),h([f({constructOnly:!0})],Zx.prototype,"disableMovements",void 0),Zx=h([I("esri.views.3d.state.controllers.GamepadKeyboardController")],Zx);const Wlt={translation:[0,0,0],heading:0,tilt:0,zoom:0},WPe=80,Ylt=Rt(WPe),Jhe=.75,Zlt=5,Xlt=Rt(30),Jlt=Rt(80),Bb={zoom:0,ascend:0,pan:{enabled:!1,matrix:Ee()},rotate:{enabled:!1,matrix:Ee()}},Wl=E(),BP=E(),Qlt=vte();function Klt(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,Gd(t.pan.matrix),t.rotate.enabled=!1,Gd(t.rotate.matrix)}let ect=class extends na{constructor(e){super(!0),this._view=e,this._watchHandles=new Pg,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([ue(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},cr),ue(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){var s;const i=this._view.navigation.gamepad.device;if(i&&e.data.device!==i)return;const r=(s=this._cameraControllerGamepad)==null?void 0:s.active;if(r||Zx.activatesFor(this._view,e.data)){if(!r){const n=new Zx({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(n)&&(this._cameraControllerGamepad=n)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};function tct(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),Ni(()=>document.removeEventListener("visibilitychange",e))}var jc;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(jc||(jc={}));let ict=class extends na{constructor(e,i){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Ge.Local},this._keyToNumber={[i.left]:jc.LEFT,[i.right]:jc.RIGHT,[i.forward]:jc.FORWARD,[i.backward]:jc.BACKWARD,[i.up]:jc.UP,[i.down]:jc.DOWN,[i.headingLeft]:jc.HEADINGLEFT,[i.headingRight]:jc.HEADINGRIGHT,[i.tiltUp]:jc.TILTUP,[i.tiltDown]:jc.TILTDOWN,[i.zoomIn]:jc.ZOOMIN,[i.zoomOut]:jc.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=tct(r=>r?null:this._handleStop())}onUninstall(){var e;(e=this._visibilityHandle)==null||e.remove(),this._handleStop()}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new Zx({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(i),e.stopPropagation()))}_handleStop(){var e;(e=this._cameraControllerKeyboard)!=null&&e.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){var r;if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&((r=this._cameraControllerKeyboard)!=null&&r.active)&&(this._cameraControllerKeyboard.deactivateDirection(i),e.stopPropagation())}},rct=class extends na{constructor(e,i){super(!0),this._view=e,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const i=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new Nz({view:this._view,mode:"interaction"}):new Fz({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*i.deltaY,vs(i.x,i.y)),e.preventDefault(),e.stopPropagation()}},zz=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},iT=class extends l3{constructor(){super(...arguments),this._beginCamera=new Pr,this._elapsedTimeSec=0,this.constraintOptions=new Qd(Jr.ALL,ci.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new QM}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),super.onControllerStart(e)}stepController(e,i){i.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,i),on(this.view,i,this.constraintOptions)}};iT=h([I("esri.views.3d.state.controllers.momentum.MomentumController")],iT);let J$=class extends iT{constructor(e){super(e),this.interactionType=ci.PAN,this._tmpPan=E()}momentumStep(e,i){const r=this.momentum.value(e);oe(this._tmpPan,this.momentum.direction,r),i.eye=ve(Qhe,i.eye,this._tmpPan),i.center=ve(Qhe,i.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};h([f({constructOnly:!0})],J$.prototype,"momentum",void 0),J$=h([I("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],J$);const Qhe=E(),sct=E(),IN=E();let k5=class extends iT{constructor(e){super(e),this.interactionType=ci.PAN}momentumStep(e,i){const r=this.momentum.value1(e),s=this.momentum.value2(e);ce(IN,i.eye),ge(IN,IN),ot(this.momentum.axis2,IN,this.momentum.axis1),kPe(i,sct,this.momentum.axis1,r,this.momentum.axis2,s)}};h([f({constructOnly:!0})],k5.prototype,"momentum",void 0),k5=h([I("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],k5);let Ox=class extends iT{set center(e){this._set("center",Xs(e))}set axis(e){this._set("axis",Xs(e))}constructor(e){super(e),this.interactionType=ci.TUMBLE}momentumStep(e,i){const r=this.momentum.value(e);H1(i,this.center,c3(this.axis,r))}};h([f({constructOnly:!0})],Ox.prototype,"momentum",void 0),h([f({constructOnly:!0})],Ox.prototype,"center",null),h([f({constructOnly:!0})],Ox.prototype,"axis",null),Ox=h([I("esri.views.3d.state.controllers.momentum.RotationMomentumController")],Ox);let cC=class extends iT{set zoomCenter(e){this._set("zoomCenter",Xs(e))}constructor(e){super(e),this.interactionType=ci.ZOOM,this.constraintOptions.interactionDirection=E()}momentumStep(e,i){const{interactionDirection:r}=this.constraintOptions;if(!r)return;ce(r,i.eye);const s=this.momentum.valueDelta(0,e);Xie(i,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),k0(r,i.eye,r)}};h([f({constructOnly:!0})],cC.prototype,"momentum",void 0),h([f({constructOnly:!0})],cC.prototype,"zoomCenter",null),cC=h([I("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],cC);let Yw=class extends iT{set screenCenter(e){this._set("screenCenter",vs(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Xs(e))}constructor(e){super(e),this.interactionType=ci.ZOOM,this.radius=0,this._tmpSceneCenter=E(),this._tmpZoomAxisAngle=LG(),this._sphere=ln()}initialize(){this._sphere[3]=this.radius}momentumStep(e,i){const r=this.momentum.valueDelta(0,e);$Pe(this._sphere,i,r),this.constraintOptions.interactionType=ci.ZOOM,on(this.view,i,this.constraintOptions),u3(this._sphere,i,this.screenCenter,this._tmpSceneCenter),qie(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),H1(i,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=ci.PAN}};h([f({constructOnly:!0})],Yw.prototype,"momentum",void 0),h([f({constructOnly:!0})],Yw.prototype,"screenCenter",null),h([f({constructOnly:!0})],Yw.prototype,"sceneCenter",null),h([f({constructOnly:!0})],Yw.prototype,"radius",void 0),Yw=h([I("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],Yw);let Jp=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const i=this.computeDelta(e);this._updateDelta(i)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},kG=class{constructor(e,i,r){this._initialVelocity=e,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,i){const r=this.value(e);return this.value(e+i)-r}valueFromInitialVelocity(e,i){i=Math.min(i,this.duration);const r=1-this.friction;return e*(r**i-1)/Math.log(r)}},nct=class extends kG{constructor(e,i,r,s,n){super(e,i,r),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},YPe=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._time=new Jp(.6),this._screen=[new Jp(.4),new Jp(.4)],this._scene=[new Jp(.6),new Jp(.6),new Jp(.6)],this._tmpDirection=E()}add(e,i,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?0:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=s==null||r==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){ne(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=Ae(this._tmpDirection);s>0&&oe(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new nct(e,i,r,n==null?0:s/n,this._tmpDirection)}},Khe=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const ede=1e-5;let oct=class extends kG{constructor(e,i,r,s,n,o=0,a){super(e,i,r),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},act=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=E(),this._tmpAxis2=E(),this._tmpAngles=lt(),this._time=new Jp(.3),this._screen=[new Jp(.4),new Jp(.4)],this._angle1=new Khe(.6),this._angle2=new Khe(.6),this._axis1=E(),this._axis2=E(),this._lastScene=E()}addMomentumDirectRotation(e,i,r,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let a=NPe(this._lastScene,i,this._tmpAxis2,s,n,o);this._angle2.update(0),Za(this._tmpAxis2)<ede?a=0:ge(this._axis1,this._tmpAxis2),this._angle1.update(a),ce(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,i,r,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;FPe(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),Za(this._tmpAxis2)<ede?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),ge(this._axis1,this._tmpAxis1),ge(this._axis2,this._tmpAxis2)),ce(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?null:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=r==null||s==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new oct(e,i,r,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}},ZPe=class{constructor(e=2.5,i=.01,r=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this._maxVelocity=s,this.enabled=!0,this.value=new Jp(.8),this.time=new Jp(.3)}add(e,i){if(this.enabled&&i!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=Te(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,i,r){return new kG(e,i,r)}},XPe=class extends ZPe{constructor(e=3,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){const r=this.value.lastValue;if(r!=null){let s=e-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=r+s}super.add(e,i)}},lct=class extends kG{constructor(e,i,r){super(e,i,r)}value(e){const i=super.value(e);return Math.exp(i)}valueDelta(e,i){const r=super.value(e),s=super.value(e+i)-r;return Math.exp(s)}},JPe=class extends ZPe{constructor(e=2.5,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){super.add(Math.log(e),i)}createMomentum(e,i,r){return new lct(e,i,r)}},cX=class extends tg{constructor(){super(...arguments),this._smoothRotation=new zz(.05),this._rotationAxis=E(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Qi(),this._beginRadius=0,this._smoothScaling=new zz(.05),this._zoomCenterScreen=vs(),this._zoomMomentumEstimator=new JPe,this._rotationMomentumEstimator=new XPe,this._panSphericalMomentumEstimator=new act,this._panPlanarMomentumEstimator=new YPe,this._adjustedSphere=ln(),this._tmp3d=E(),this._tmpScreenPointArray=vs(),this._beginScreenPoint=vs(),this._beginScenePoint=E(),this._screenPickPoint=vs(),this._scenePickPoint=E(),this._navMode=ba.Horizontal,this._sphere=ln(),this._pointerCount=0,this._tmpInteractionDirection=E(),this._beginCamera=new Pr,this._constraintOptions=new Qd(Jr.ALL,ci.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled,this._beginHeading=-S1.normalize(Rt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),ef(e.center,this._screenPickPoint),Aa(this._beginScreenPoint,this._screenPickPoint);const i=ur(this.view.spatialReference),r=LPe(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,sA.Silhouette,this.view.map.ground.opacity===0?IT:{});r.scenePickPoint!=null&&(this._scenePickPoint=r.scenePickPoint,this._sphere=r.sphere,ce(this._beginScenePoint,this._scenePickPoint),this._navMode=SL(this.startCamera,this._screenPickPoint,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===ba.Vertical&&this._preparePlanarPanMode(e,r.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1;this._navMode===ba.Horizontal?(i&&this._zoomSpherical(e),this._panningSpherical(e),i&&this._rotateSpherical(e)):(i&&this._zoomPlanar(e),this._panningPlanar(e),i&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return this._navMode===ba.Horizontal?new Yw({view:this.view,momentum:i,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new cC({view:this.view,momentum:i,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new Ox({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._navMode===ba.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new k5({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new J$({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,i){const r=ea(this._tmp3d,this.startCamera.viewForward);nL(this._scenePickPoint,r,this._panningPlane);const s=vs(this._screenPickPoint[0],0),n=E(),o=Ae(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],u3(this._adjustedSphere,this.startCamera,s,n);const a=xa();this.startCamera.projectToRenderScreen(n,a);const l=E(),c=E(),u=E();ve(l,this._scenePickPoint,this.currentCamera.eye);const d=Ae(l);ge(l,l);const p=OPe*Math.max(Math.abs(this.view.camera.position.z),RPe),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,DG);let g=m??p;g=i?Math.min(g,d):g,ce(u,me(c,this.currentCamera.eye,oe(c,l,g))),this._panningPlane[3]=-pe(this._panningPlane,u),this.startCamera.center=me(c,this.startCamera.eye,oe(c,this.startCamera.viewForward,g));const y=ef(e.center,this._tmpScreenPointArray);nX(this._panningPlane,this.startCamera,y,this._beginScenePoint)}_zoomSpherical(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),$Pe(this._sphere,this.currentCamera,this._smoothScaling.value),ef(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=ci.ZOOM,this._constraintOptions.interactionFactor=Xp(e.radius-this._beginRadius),on(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const i=ef(e.center,this._tmpScreenPointArray);u3(this._sphere,this.currentCamera,i,this._tmp3d),Jie(this._beginScenePoint,pe(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(zPe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(UPe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=ci.PAN,this._constraintOptions.interactionFactor=Xp(V1(this._screenPickPoint,i)),on(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){ge(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||ea(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value,r=i+sX(e.angle-i),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(r);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),H1(this.currentCamera,this._sphere,c3(this._rotationAxis,n)),this._constraintOptions.interactionType=ci.TUMBLE,this._constraintOptions.interactionFactor=Xp(e.radius*r),on(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const i=ef(e.center,this._tmpScreenPointArray);nX(this._panningPlane,this.currentCamera,i,this._tmp3d)&&(DPe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(i,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=ci.PAN,this._constraintOptions.interactionFactor=Xp(V1(this._beginScreenPoint,i)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),on(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),Xie(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=ci.ZOOM,this._constraintOptions.interactionFactor=Xp(e.radius-this._beginRadius),on(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){ce(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||ea(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value;let r=e.angle-i;r=sX(r);const s=i+r,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),H1(this.currentCamera,this._sphere,c3(this._rotationAxis,o)),this._constraintOptions.interactionType=ci.TUMBLE,this._constraintOptions.interactionFactor=Xp(e.radius*o),on(this.view,this.currentCamera,this._constraintOptions)}};cX=h([I("esri.views.3d.state.controllers.PinchAndPanControllerGlobal")],cX);const tde=$e(0,0,1);let uX=class extends tg{constructor(){super(...arguments),this._rotationValueSmooth=new zz(.05),this._scalingValueSmooth=new zz(.05),this._planeHorizontal=Qi(),this._planeVertical=Qi(),this._rotationMomentumEstimator=new XPe,this._panMomentumEstimator=new YPe(300,12,.9),this._zoomMomentumEstimator=new JPe,this._beginRadius=0,this._beginCenter=E(),this._beginAngle=0,this._tmpPoints=[],this._navMode=ba.Horizontal,this._beginCenterScreen=vs(),this._tmpCentroid3d=E(),this._tmpCentroid2d=vs(),this._tmp2d=vs(),this._pointerCount=0,this._beginCamera=new Pr,this._constraintOptions=new Qd(Jr.ALL,ci.NONE,0,this._beginCamera)}begin(e){if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panMomentumEstimator.enabled=i,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),ef(e.center,this._beginCenterScreen),sTe(tde,0,this._planeHorizontal);const r=E(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?IT:{}),n=E();ea(n,this.startCamera.viewForward);const o=E();ce(o,tde);const a=pe(n,o);this._navMode=SL(this.startCamera,this._beginCenterScreen,this.view.renderCoordsHelper,this.view.viewingMode);const l=Math.min(OPe,1/Math.abs(pe(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),RPe);O7(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||R7(this._planeHorizontal,this._planeHorizontal);const c=E(),u=E(),d=E();ve(c,r,this.currentCamera.eye);const p=Ae(c);if(ge(c,c),this._navMode===ba.Vertical){oe(o,o,a),ve(this._planeVertical,n,o),ge(this._planeVertical,this._planeVertical),O7(this._planeVertical,this._planeVertical,r);const m=this.view._stage.renderView.getMinimalDepthForArea(h3(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,DG);let g=m??l;g=s?Math.min(g,p):g,ce(d,me(u,this.currentCamera.eye,oe(u,c,g))),this._planeVertical[3]=-pe(this._planeVertical,d),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),b8(this._tmpPoints,this._beginCenter)}else{const m=s?p:l;ce(d,me(u,this.currentCamera.eye,oe(u,c,m))),this._planeHorizontal[3]=-pe(this._planeHorizontal,d),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),b8(this._tmpPoints,this._beginCenter)}this._beginCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1,r=this._navMode===ba.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(i){const n=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(n),Xie(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=ci.ZOOM,this._constraintOptions.interactionFactor=Xp(Math.abs(e.radius-this._beginRadius)),on(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),b8(this._tmpPoints,this._tmpCentroid3d),ef(e.center,this._tmpCentroid2d),DPe(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=ci.PAN,this._constraintOptions.interactionFactor=Xp(V1(this._beginCenterScreen,this._tmpCentroid2d)),on(this.view,this.currentCamera,this._constraintOptions),i){const n=s,o=this._rotationValueSmooth.value,a=o+sX(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=l,this._rotationValueSmooth.update(a);const c=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(c,.001*e.timestamp);const u=this._planeHorizontal;H1(this.currentCamera,n,c3(u,c)),this._constraintOptions.interactionType=ci.TUMBLE,this._constraintOptions.interactionFactor=Xp(Math.abs(e.radius*c)),on(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return new cC({view:this.view,momentum:i,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new Ox({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new J$({view:this.view,momentum:s}):null}_computePlanePoints(e,i,r,s){s.length=e.size;const n=this._tmp2d;let o=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,s[o]===void 0&&(s[o]=E()),nX(i,r,n,s[o]),o+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};uX=h([I("esri.views.3d.state.controllers.PinchAndPanControllerLocal")],uX);let ide=class extends na{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!Kie(e.data,this.pointerAction))return;const i=e.timestamp-this._lastEndTimestamp,r=40,s=this._momentum&&this._momentum.active&&i<r;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,i){var r;if((r=this._controller)!=null&&r.active){this._lastEndTimestamp=e.timestamp;const s=this._controller.end(e.data);i&&s&&(this._momentum=s,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new cX({view:this._view}):new uX({view:this._view})}},cct=class extends na{constructor(e,i){super(!0),this.view=e,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}},QPe=class extends na{constructor(e,i){super(!0),this.key=e,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},uct=class extends QPe{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},hct=class extends QPe{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},dct=class extends na{constructor(e,i=!1){super(!0),this._view=e,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){var s,n,o;const i=this._invert?-1:1,r=vs(0,e.data.delta*i);switch(e.data.action){case"begin":(s=this._cameraController)==null||s.end(),this._cameraController=new X$({view:this._view,pivot:Xc.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":(n=this._cameraController)==null||n.update(r);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}};function rde(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value||1:0),axes:e.axes.map(i=>mct(i,t.axisThreshold))}:{buttons:[],axes:[]}}function pct(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function fct(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function mct(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let gct=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,rde(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(sde(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new eie(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=RS({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;sde(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=rde(n),l=r||fct(a);o&&(o.timestamp===s.timestamp||!o.active&&l||pct(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_emitGamepadEvent(e,i,r){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!r)return;const o=!n&&r?"start":n&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:o})}};function yct(t){if(!t||!t.connected)return!1;for(let e=0;e<t.axes.length;e++)if(isNaN(t.axes[e]))return!1;return!0}function sde(t){const e=window.navigator.getGamepads();for(let i=0;i<e.length;i++){const r=e[i];yct(r)&&t(r)}}const nde=re("edge"),_ct=re("chrome"),vct=re("ff"),bct=re("safari"),ode="esri-view-surface",a2={touchNone:`${ode}--touch-none`,touchPan:`${ode}--touch-pan`};let KPe=class eOe{constructor(e,i){this._input=i,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new gct(e,this._input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Le(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const r=this._active[i];this._element.removeEventListener($8[i],r),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&$8[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener($8[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,i){i?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?a2.touchNone:a2.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?a2.touchPan:a2.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(a2.touchNone),this._element.classList.remove(a2.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const r=kCe(this._element,e);return eOe.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(e,i){const{key:r}=i;r&&e==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,r)}_handleMouseWheel(e,i){let r=i.deltaY;switch(i.deltaMode){case 0:nde&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}nde?r*=.7:_ct||bct?r*=.6:vct&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(e,o)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const r={native:i};i.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};KPe.test={disableSubpixelCoordinates:!1};const $8={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let wct=class extends na{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};const ph={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function hX(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function xct(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function Sct(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:Bd()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[x,T]=t,[C,M]=[T.x-x.x,T.y-x.y];return e.radius=Math.sqrt(C*C+M*M)/2,e.center.x=(x.x+T.x)/2,e.center.y=(x.y+T.y)/2,e}let i=0,r=0;for(let x=0;x<t.length;x++)i+=t[x].x,r+=t[x].y;i/=t.length,r/=t.length;const s=t.map(x=>x.x-i),n=t.map(x=>x.y-r);let o=0,a=0,l=0,c=0,u=0,d=0,p=0;for(let x=0;x<s.length;x++){const T=s[x],C=n[x],M=T*T,O=C*C;o+=M,a+=O,l+=T*C,c+=M*T,u+=O*C,d+=T*O,p+=C*M}const m=.5*(c+d),g=.5*(u+p),y=o*a-l*l,v=(m*a-g*l)/y,b=(o*g-l*m)/y,w=Bd(v+i,b+r);return{radius:Math.sqrt(v*v+b*b+(o+a)/t.length),center:w}}function Q$(t){const{native:e}=t,{pointerId:i,button:r,pointerType:s}=e;return s==="mouse"?`${i}:${r}`:`${s}`}let Tct=class extends na{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,r,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:s,pointers:Ect(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const i=e.native.pointerId,r=LN(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,s);const n=U5(s,tOe(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,r=this._activePointerMap.get(i);r?r.event=e:this._addPointer(e)}_removePointer(e){const i=LN(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=LN(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=U5(r,i)-e,r.lastAngle=U5(r,i)-e})}_emitEvent(e,i,r){const s=LN(this._activePointerMap);this._drag.emit(this._createPayload(e,i,s,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,r=e.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const i=e.data,r=i.currentEvent,s=e.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function tOe(t){const e=[];return t.forEach(i=>{e.push(Bd(i.event.x,i.event.y))}),Sct(e)}function LN(t){const e=tOe(t);let i=0;return t.forEach(r=>{let s=U5(r,e),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s;const o=s-r.initialAngle;i+=o}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function Ect(t){const e=new Map;return t.forEach((i,r)=>e.set(r,i.event)),e}function U5(t,e){const i=t.event,r=i.x-e.center.x,s=i.y-e.center.y;return Math.atan2(s,r)}var ade;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(ade||(ade={}));let Cct=class extends na{constructor(e=ph.maximumDoubleClickDelay,i=ph.maximumDoubleClickDistance,r=ph.maximumDoubleTouchDelay,s=ph.maximumDoubleTouchDistance,n=z3){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=Q$(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,r=Q$(i),s=this._pointerState.get(r);if(s&&s.downButton===i.native.button){const n=s.immediateDoubleClick,o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;n?(n.timeoutHandle.remove(),hX(n,e.data)>o?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(i))):hX(s,e.data)>o?this._removeState(i):this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,i){const r=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),r)}}_removeState(e){const i=Q$(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},Mct=class extends na{constructor(e=ph.maximumClickDelay,i=ph.movementUntilMouseDrag,r=ph.movementUntilPenDrag,s=ph.movementUntilTouchDrag,n=ph.holdDelay,o=z3){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Or(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_handlePointerMove(e){const i=e.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(DN("update",s,i),void 0,s.modifiers):xct(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),s.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const i=e.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(DN("start",s,i)):this._pointerDrag.emit(DN("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const r=e.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(DN("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}};function DN(t,e,i){return{action:t,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:i}}let Act=class extends na{constructor(e=ph.maximumDoubleClickDelay,i=ph.maximumDoubleClickDistance,r=ph.maximumDoubleTouchDelay,s=ph.maximumDoubleTouchDistance,n=z3){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Or(e.doubleClickTimer))}get hasPendingInputs(){return mh(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,i){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=Or(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_handleImmediateClick(e){const i=e.data,{pointerType:r}=i.native,s=Pct(i);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;hX(o,i)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const i=Q$(e.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:r}}=i,s=Q$(i),n=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n);this._pointerState.set(s,{event:e,doubleClickTimer:o,pointerDownCount:1}),this.refreshHasPendingInputs()}};function Pct(t){const{pointerId:e,pointerType:i,button:r}=t.native;return i==="mouse"?`${e}:${r}`:`${i}`}let Oct=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var i,r;this._startEvent=e,(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},Rct=class extends na{constructor(e=20,i=40){super(!1),this._threshold=e,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new Oct({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,i){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,i,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,i){let r=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:y,y:v}of i.pointers.values())r=Math.max(r,y),s=Math.min(s,y),n=Math.max(n,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,u=1/0;for(const{x:y,y:v}of e.pointers.values())a=Math.max(a,y),l=Math.min(l,y),c=Math.max(c,v),u=Math.min(u,v);const d=r-s,p=n-o,m=a-l,g=c-u;return Math.abs(e.center.x-i.center.x)<this._threshold&&Math.abs(m-d)<=this._maxDelta&&Math.abs(g-p)<=this._maxDelta}_checkVerticalThresholdReached(e,i){let r=Math.abs(e.center.y-i.center.y);return e.pointers.forEach((s,n)=>{const o=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-o.y))}),r>=this._threshold}},Mp=class extends Re{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){var e;return!!((e=this._inputManager)!=null&&e.updating)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Le(this._inputManager)}connect(){const e=this.view;this._source=new KPe(this.view.surface,e.input);const i=[new Cct,new Mct,new Act,new Tct(this.view.navigation),new Rct],r=new jh({eventSource:this._source,recognizers:i});this._inputManager=r,r.installHandlers("prevent-context-menu",[new wct],a1.INTERNAL),this._modeDragPan=new ide(e,"primary"),this._modeDragRotate=new O8(e,"secondary",Xc.CENTER),this._modeDragZoom=new qlt(e,"tertiary");const s={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new cct(e),new clt(e),new ect(e),new ict(e,s.pan),new rct(e),new hct(e,s.resetTilt),new uct(e,s.resetHeading),new O8(e,"primary",Xc.EYE,[s.lookAround]),new O8(e,"secondary",Xc.CENTER,[s.lookAround]),new ide(e,"tertiary",[s.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new dct(e)],a1.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this.addHandles(ue(()=>{var n;return(n=this.view.navigation)==null?void 0:n.browserTouchPanEnabled},n=>{this._source.browserTouchPanningEnabled=!n},cr))}isModifierKeyDown(e){var i;return((i=this._inputManager)==null?void 0:i.isModifierKeyDown(e))??!1}_updateMode(){var s;const e=this.mode,i=this.primaryDragAction,r=(s=dX.get(e))==null?void 0:s.get(i);r&&(this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom))}get test(){}};h([f()],Mp.prototype,"view",void 0),h([f({value:"pan"})],Mp.prototype,"primaryDragAction",null),h([f({value:"default"})],Mp.prototype,"mode",null),h([f({readOnly:!0})],Mp.prototype,"updating",null),h([f()],Mp.prototype,"latestPointerType",null),h([f()],Mp.prototype,"latestPointerLocation",null),h([f()],Mp.prototype,"multiTouchActive",null),h([f()],Mp.prototype,"_inputManager",void 0),Mp=h([I("esri.views.3d.input.SceneInputManager")],Mp);const dX=new Map,I8=new Map,L8=new Map;I8.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),I8.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),L8.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),L8.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),dX.set("default",I8),dX.set("pro",L8);const $ct=Mp;let en=class extends Re{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};h([f()],en.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),h([f()],en.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),h([f()],en.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),h([f()],en.prototype,"DECONFLICTOR_SHOW_GRID",void 0),h([f()],en.prototype,"LABELS_SHOW_BORDER",void 0),h([f()],en.prototype,"TEXT_SHOW_BASELINE",void 0),h([f()],en.prototype,"TEXT_SHOW_BORDER",void 0),h([f()],en.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),h([f()],en.prototype,"OVERLAY_SHOW_CENTER",void 0),h([f()],en.prototype,"SHOW_POI",void 0),h([f()],en.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),h([f()],en.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),h([f()],en.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),h([f()],en.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),h([f()],en.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),h([f()],en.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),h([f()],en.prototype,"I3S_TREE_SHOW_TILES",void 0),h([f()],en.prototype,"I3S_SHOW_MODIFICATIONS",void 0),h([f()],en.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),h([f()],en.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),h([f()],en.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),h([f()],en.prototype,"LINE_WIREFRAMES",void 0),en=h([I("esri.views.3d.support.debugFlags")],en);const Rr=new en;let rh,sM,pX=!1,fX=!1,mX=!1,gX=!1,K$=null;function Ict(t,e){if(!fX||!sM)return;iOe();const i=sM;let r=0;for(let s=0;s<t.accBinsNumX;s++)for(let n=0;n<t.accBinsNumY;n++){const o=t.accBins[s][t.accBinsNumY-1-n];r+=o.length;const a=s*t.accBinsSizeX,l=(s+1)*t.accBinsSizeX,c=n*t.accBinsSizeY,u=(n+1)*t.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),rOe(a,l,c,u,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+e.size,70,50),i.fillText("total numTests: "+t.accNumTests,70,30)}function Lct(t){mX=Rr.DECONFLICTOR_SHOW_VISIBLE,gX=Rr.DECONFLICTOR_SHOW_INVISIBLE,pX=mX||gX,fX=Rr.DECONFLICTOR_SHOW_GRID,K$=null,pX||fX?K$=()=>Dct(t):rh&&(rh.parentElement.removeChild(rh),rh=null)}function iOe(){K$&&(K$(),K$=null)}function Dct(t){rh==null&&(rh=document.createElement("canvas"),rh.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(rh));const{state:e}=t,{camera:i,pixelRatio:r}=e,{width:s,height:n}=i,o=s*r,a=n*r;rh.setAttribute("width",`${o}px`),rh.setAttribute("height",`${a}px`),rh.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),sM=rh.getContext("2d"),sM.clearRect(0,0,s,n),sM.font="12px Arial"}function rOe(t,e,i,r,s){iOe();const n=rh.height,o=sM;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(t,n-i),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.closePath()}function Nct(t,e){pX&&(e&&mX||!e&&gX)&&rOe(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var wa,Po;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(wa||(wa={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(Po||(Po={}));function sOe(t,e){return new aOe(t,cOe,e)}function Fct(t,e){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=cOe;return new aOe(t,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:D8.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:D8.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:D8.minPixelSize},e)}function kct(t){return Math.abs(t*t*t)}function nOe(t,e,i){const r=i.parameters;return N8.scale=Math.min(r.divisor/(e-r.offset),1),N8.factor=kct(t),N8}function ire(t,e){return Dt(t*Math.max(e.scale,e.minScaleFactor),t,e.factor)}function Uct(t,e,i){const r=nOe(t,e,i);return r.minScaleFactor=0,ire(1,r)}function lde(t,e,i,r){r.scale=Uct(t,e,i),r.factor=0,r.minScaleFactor=i.minScaleFactor}function oOe(t,e,i=[0,0]){const r=Math.min(Math.max(e.scale,e.minScaleFactor),1);return i[0]=t[0]*r,i[1]=t[1]*r,i}function zct(t,e,i,r){return ire(t,nOe(e,i,r))}let aOe=class lOe{get minScaleFactor(){return this._fontHeight!=null?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,i,r,s=Vct(),n){this._viewingMode=e,this._description=i,this._ellipsoidRadius=r,this.parameters=s,this._fontHeight=n,this._viewingMode===Ge.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(e){return e!==this._fontHeight?new lOe(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,i,r){const{scaleStart:s,scaleFallOffRange:n}=this._description,{fovY:o,distance:a}=e,l=this._calculateCurvatureDependentParameters(e,i),c=this._coverageCompensation(e,i,l),{tiltAngle:u,scaleFallOffFactor:d}=l,p=Math.sin(u)*a,m=.5*Math.PI-u-o*(.5-s*c),g=p/Math.cos(m),y=m+o*n*c,v=(g-d*(p/Math.cos(y)))/(1-d);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=v,r.divisor=g-v,r}_calculateCurvatureDependentParametersLocal(e,i,r=cde){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(e,i,r=cde){const s=this._description.curvatureDependent,n=1+e.distance/i,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=Te((o-a)/(l-a),0,1),[u,d]=[s.min,s.max];return r.tiltAngle=Dt(u.tiltAngle,d.tiltAngle,c),r.scaleFallOffFactor=Dt(u.scaleFallOffFactor,d.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(e,i,r){return(e.fovY-r.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,i,r){const s=i*i,n=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+s-2*Math.cos(n)*a*i,c=Math.sqrt(l),u=Math.sqrt(l-s);return(Math.acos(u/c)-Math.asin(i/(c/Math.sin(n)))+.5*o)/o}};const cOe={curvatureDependent:{min:{curvature:Rt(10),tiltAngle:Rt(12),scaleFallOffFactor:.5},max:{curvature:Rt(70),tiltAngle:Rt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},D8={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function Vct(){return{camera:{distance:0,fovY:0},divisor:0,offset:0}}const N8={scale:0,factor:0,minScaleFactor:0},cde={tiltAngle:0,scaleFallOffFactor:0};function Bct(t){return t instanceof Float32Array&&t.length>=16}function Gct(t){return Array.isArray(t)&&t.length>=16}function jct(t){return Bct(t)||Gct(t)}const nA={unknown:1,inches:ro(1,"meters","inches"),feet:ro(1,"meters","feet"),"us-feet":ro(1,"meters","us-feet"),yards:ro(1,"meters","yards"),miles:ro(1,"meters","miles"),"nautical-miles":ro(1,"meters","nautical-miles"),millimeters:ro(1,"meters","millimeters"),centimeters:ro(1,"meters","centimeters"),decimeters:ro(1,"meters","decimeters"),meters:ro(1,"meters","meters"),kilometers:ro(1,"meters","kilometers"),"decimal-degrees":1/VGe(1,"meters",ir.radius)};var Wa,ude;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(Wa||(Wa={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(ude||(ude={}));let rre=class{constructor(e){this.field=e}},Hct=class extends rre{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[Wa.Undefined,Wa.Undefined,Wa.Undefined]}},qct=class extends rre{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},Wct=class extends rre{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},Yct=class{};function GP(t){return t!=null}function l2(t){return typeof t=="number"}function UG(t){return typeof t=="string"}function Zct(t){return t==null||UG(t)}function Xct(t,e,i,r=Ee()){const s=t||0,n=e||0,o=i||0;return s!==0&&UM(r,r,-s/180*Math.PI),n!==0&&kM(r,r,n/180*Math.PI),o!==0&&PB(r,r,o/180*Math.PI),r}function S_(t,e,i,r,s){var a;const n=t.minSize,o=t.maxSize;if(t.useSymbolValue){const l=r.symbolSize[i];return e.minSize[i]=l,e.maxSize[i]=l,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=Wa.DefinedSize,!0}if(GP(t.field))return GP(t.stops)?t.stops.length===2&&l2(t.stops[0].size)&&l2(t.stops[1].size)?(hde(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=Wa.DefinedSize,!0):!1:l2(n)&&l2(o)&&GP(t.minDataValue)&&GP(t.maxDataValue)?(hde(n,o,t.minDataValue,t.maxDataValue,e,i),e.type[i]=Wa.DefinedSize,!0):t.valueUnit==="unknown"?!1:nA[t.valueUnit]!=null?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/nA[t.valueUnit],e.type[i]=Wa.DefinedSize,!0):!1;if(!GP(t.field)){if((a=t.stops)!=null&&a[0]&&l2(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=Wa.DefinedSize,!0;if(l2(n))return e.minSize[i]=n,e.maxSize[i]=n,e.offset[i]=n,e.factor[i]=0,e.type[i]=Wa.DefinedSize,!0}return!1}function hde(t,e,i,r,s,n){const o=Math.abs(r-i)>0?(e-t)/(r-i):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-i*o,s.factor[n]=o}function Jct(t,e,i,r){if(t.normalizationField||t.valueRepresentation||!Zct(t.field))return null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return null}else e.size.field=t.field}else e.size=new Hct(t.field);let s;switch(t.axis){case"width":return s=S_(t,e.size,0,i),s?e:null;case"height":return s=S_(t,e.size,2,i),s?e:null;case"depth":return s=S_(t,e.size,1,i),s?e:null;case"width-and-depth":return s=S_(t,e.size,0,i),s&&S_(t,e.size,1,i),s?e:null;case null:case void 0:case"all":return s=S_(t,e.size,0,i),s=s&&S_(t,e.size,1,i),s=s&&S_(t,e.size,2,i),s?e:null;default:return`${t.axis}`,null}}function Qct(t,e,i){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===Wa.DefinedSize&&(n*=e.modelSize[s],t.type[s]=Wa.DefinedScale),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let r;if(t.type[0]!==Wa.Undefined)r=0;else if(t.type[1]!==Wa.Undefined)r=1;else{if(t.type[2]===Wa.Undefined)return!1;r=2}for(let s=0;s<3;++s)t.type[s]===Wa.Undefined&&(t.minSize[s]=t.minSize[r],t.maxSize[s]=t.maxSize[r],t.offset[s]=t.offset[r],t.factor[s]=t.factor[r],t.type[s]=t.type[r]);return!0}function dde(t,e,i){t[4*e]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function Kct(t,e,i){if(t.normalizationField)return null;if(UG(t.field)){if(!t.stops)return null;{if(t.stops.length>8)return null;e.color=new qct(t.field);const r=t.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.color.values[s]=n.value,dde(e.color.colors,s,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const r=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,dde(e.color.colors,s,r)}}return e}function eut(t,e,i){if(t.normalizationField)return null;if(UG(t.field)){if(!t.stops)return null;{if(t.stops.length>8)return null;e.opacity=new Wct(t.field);const r=t.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const r=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=r}}return e}function F8(t,e,i){const r=i===2&&t.rotationType==="arithmetic";e.offset[i]=r?90:0,e.factor[i]=r?-1:1,e.type[i]=1}function tut(t,e,i){if(!UG(t.field))return null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return F8(t,e.rotation,0),e;case"roll":return F8(t,e.rotation,1),e;case null:case void 0:case"heading":return F8(t,e.rotation,2),e;default:return`${t.axis}`,null}}let TL=class{constructor(e,i=[1,1,1],r=[1,1,1],s=1,n=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=i,this.symbolSize=r,this.unitInMeters=s,this.anchor=n,this.scale=o,this.rotation=a}};function uOe(t,e,i){if(!t)return null;const r=t.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return null;switch(n.type){case"size":return e.supports.size?Jct(n,s,e,i):s;case"color":return e.supports.color?Kct(n,s):s;case"opacity":return e.supports.opacity?eut(n,s):null;case"rotation":return e.supports.rotation?tut(n,s,i):s;default:return null}},new Yct);return!(t.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r!=null&&r.size&&!Qct(r.size,e)?null:r:null}let iut=class{constructor(e,i,r){this.visualVariables=e,this.materialParameters=i,this.requiresShaderTransformation=r}};function oA(t,e){if(!t||Rr.TESTS_DISABLE_FAST_UPDATES)return null;const i=uOe(t.visualVariables,e);return i?new iut(i,dOe(i,e),!!i.size):null}function aA(t,e,i){if(!e||!t)return!1;const r=t.visualVariables,s=uOe(e.visualVariables,i);return!!s&&!!(NN(r.size,s.size,"size")&&NN(r.color,s.color,"color")&&NN(r.rotation,s.rotation,"rotation")&&NN(r.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=dOe(s,i),t.requiresShaderTransformation=!!s.size,!0)}function NN(t,e,i){if(!!t!=!!e||t&&t.field!==(e==null?void 0:e.field))return!1;if(t&&i==="rotation"){const r=t,s=e;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}let hOe=class extends $r{constructor(e){super(),this.vvSize=(e==null?void 0:e.size)??null,this.vvColor=(e==null?void 0:e.color)??null,this.vvOpacity=(e==null?void 0:e.opacity)??null}};function dOe(t,e){const i=new hOe(t);return i.vvSize&&(i.vvSymbolAnchor=e.anchor,Gd(eI),Xct(e.rotation[2],e.rotation[0],e.rotation[1],eI),i.vvSymbolRotationMatrix=i.vvSymbolRotationMatrix||Gr(),Xd(i.vvSymbolRotationMatrix,eI)),i}function rut(t,e,i){if(!t.vvSize)return i;vn(T_,i);const r=t.vvSymbolRotationMatrix;Rg(eI,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),dr(T_,T_,eI);for(let s=0;s<3;++s){const n=t.vvSize.offset[s]+e[0]*t.vvSize.factor[s];pde[s]=Te(n,t.vvSize.minSize[s],t.vvSize.maxSize[s])}return rL(T_,T_,pde),rl(T_,T_,t.vvSymbolAnchor),T_}function sre(t,e,i){if(!e.vvSize)return ne(t,1,1,1),t;for(let r=0;r<3;++r){const s=e.vvSize.offset[r]+i[0]*e.vvSize.factor[r];t[r]=Te(s,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return t}function _f(t,e){const i=t==null?0:e.attributes[t];return typeof i=="number"&&isFinite(i)?i:0}const T_=Ee(),pde=E(),eI=Ee();function nre(t){t.vertex.code.add(S`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(S`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add(S`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(S`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(S`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(S`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function sut(t){t.uniforms.add(new Vt("screenSizePerspective",e=>pOe(e.screenSizePerspective)))}function zG(t){t.uniforms.add(new Vt("screenSizePerspectiveAlignment",e=>pOe(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function pOe(t){return ne(nut,t.parameters.divisor,t.parameters.offset,t.minScaleFactor)}const nut=E();function fOe(t,e){const i=t.vertex;e.hasVerticalOffset?(mOe(i),e.hasScreenSizePerspective&&(t.include(nre),zG(i),Rf(t.vertex,e)),i.code.add(S`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?S`vec3 worldNormal = normalize(worldPos + localOrigin);`:S`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?S`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:S`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(S`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const out=Qt();function mOe(t){t.uniforms.add(new zi("verticalOffset",(e,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return ds(out,n*a,o,r,s)}))}const gOe=.5;function yOe(t,e){t.include(nre),t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.NORMAL,"vec3"),t.attributes.add(R.CENTEROFFSETANDDISTANCE,"vec4");const i=t.vertex;bc(i,e),Rf(i,e),i.uniforms.add(new zi("viewport",(r,s)=>s.camera.fullViewport),new qe("polygonOffset",r=>r.shaderPolygonOffset),new qe("cameraGroundRelative",(r,s)=>s.camera.aboveGround?1:-1)),e.hasVerticalOffset&&mOe(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(S`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(S`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.multipassEnabled?S.float(0):S`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),e.draped&&!e.hasVerticalOffset||iA(i),e.draped||(i.uniforms.add(new qe("perDistancePixelRatio",(r,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),i.code.add(S`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${S.float(gOe)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),e.screenCenterOffsetUnitsEnabled&&YA(i),e.hasScreenSizePerspective&&zG(i),i.code.add(S`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?S`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":S`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}function _Oe(t,e,i,r,s){let n=(i.screenLength||0)*t.pixelRatio;s!=null&&(n=zct(n,r,e,s));const o=n*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return Te(o*e,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function vOe(t,e){const i=e?vOe(e):{};for(const r in t){let s=t[r];s!=null&&s.forEach&&(s=lut(s)),s==null&&r in i||(i[r]=s)}return i}function aut(t,e){let i=!1;for(const r in e){const s=e[r];s!==void 0&&(Array.isArray(s)?t[r]===null?(t[r]=s.slice(),i=!0):Qve(t[r],s)&&(i=!0):t[r]!==s&&(i=!0,t[r]=s))}return i}function lut(t){const e=[];return t.forEach(i=>e.push(i)),e}const bOe={multiply:1,ignore:2,replace:3,tint:4};let mb=class extends bL{constructor(e,i){super(),this.type=Ls.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._vertexAttributeLocations=wi,this._pp0=$e(0,0,1),this._pp1=$e(0,0,0),this._parameters=vOe(e,i),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,i=!0){aut(this._parameters,e)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bindParameters.decorations===Nl.ON)&&!!(this.parameters.renderOccluded&e.renderOccludedMask)}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){var e;(e=this.repository)==null||e.materialChanged(this)}queryRenderOccludedState(e){return this.isVisible()&&this.parameters.renderOccluded===e}intersectDraped(e,i,r,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,i,r,this._pp0,this._pp1,n)}},wOe=class extends Cnt{constructor(e,i,r){super(i,r),this.camera=e}};var Ji;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(Ji||(Ji={}));let ore=class extends $r{constructor(){super(...arguments),this.renderOccluded=Ji.Occlude,this.isDecoration=!1}},xOe=class{constructor(){this.factor=new fde,this.factorAlignment=new fde}},fde=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function f9t(t,e,i,r=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r===1)for(let c=0;c<l;++c)o[i]=s[n[c]],i+=a;else for(let c=0;c<l;++c){const u=s[n[c]];for(let d=0;d<r;d++)o[i]=u,i+=a}}function mde(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length;i*=o;for(let l=0;l<a;++l){const c=2*s[l];n[i]=r[c],n[i+1]=r[c+1],i+=o}}function SOe(t,e,i,r){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r==null||r===1)for(let c=0;c<l;++c){const u=3*n[c];o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],i+=a}else for(let c=0;c<l;++c){const u=3*n[c];for(let d=0;d<r;++d)o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],i+=a}}function lA(t,e,i,r=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r===1)for(let c=0;c<l;++c){const u=4*n[c];o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],o[i+3]=s[u+3],i+=a}else for(let c=0;c<l;++c){const u=4*n[c];for(let d=0;d<r;++d)o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],o[i+3]=s[u+3],i+=a}}function gde(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<i;++n)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=s}function are(t,e,i,r,s=1){if(!e)return void SOe(t,i,r,s);const{data:n,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length,u=e[0],d=e[1],p=e[2],m=e[4],g=e[5],y=e[6],v=e[8],b=e[9],w=e[10],x=e[12],T=e[13],C=e[14];r*=l;let M=0,O=0,D=0;const k=$B(e)?U=>{M=n[U]+x,O=n[U+1]+T,D=n[U+2]+C}:U=>{const H=n[U],z=n[U+1],Z=n[U+2];M=u*H+m*z+v*Z+x,O=d*H+g*z+b*Z+T,D=p*H+y*z+w*Z+C};if(s===1)for(let U=0;U<c;++U)k(3*o[U]),a[r]=M,a[r+1]=O,a[r+2]=D,r+=l;else for(let U=0;U<c;++U){k(3*o[U]);for(let H=0;H<s;++H)a[r]=M,a[r+1]=O,a[r+2]=D,r+=l}}function lre(t,e,i,r,s=1){if(!e)return void SOe(t,i,r,s);const{data:n,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,u=o.length,d=a[0],p=a[1],m=a[2],g=a[4],y=a[5],v=a[6],b=a[8],w=a[9],x=a[10],T=!Gee(a),C=1e-6,M=1-C;r*=c;let O=0,D=0,k=0;const U=$B(a)?H=>{O=n[H],D=n[H+1],k=n[H+2]}:H=>{const z=n[H],Z=n[H+1],q=n[H+2];O=d*z+g*Z+b*q,D=p*z+y*Z+w*q,k=m*z+v*Z+x*q};if(s===1)if(T)for(let H=0;H<u;++H){U(3*o[H]);const z=O*O+D*D+k*k;if(z<M&&z>C){const Z=1/Math.sqrt(z);l[r]=O*Z,l[r+1]=D*Z,l[r+2]=k*Z}else l[r]=O,l[r+1]=D,l[r+2]=k;r+=c}else for(let H=0;H<u;++H)U(3*o[H]),l[r]=O,l[r+1]=D,l[r+2]=k,r+=c;else for(let H=0;H<u;++H){if(U(3*o[H]),T){const z=O*O+D*D+k*k;if(z<M&&z>C){const Z=1/Math.sqrt(z);O*=Z,D*=Z,k*=Z}}for(let z=0;z<s;++z)l[r]=O,l[r+1]=D,l[r+2]=k,r+=c}}function cut(t,e,i,r,s=1){if(!e)return void lA(t,i,r,s);const{data:n,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,u=o.length,d=a[0],p=a[1],m=a[2],g=a[4],y=a[5],v=a[6],b=a[8],w=a[9],x=a[10],T=!Gee(a),C=1e-6,M=1-C;if(r*=c,s===1)for(let O=0;O<u;++O){const D=4*o[O],k=n[D],U=n[D+1],H=n[D+2],z=n[D+3];let Z=d*k+g*U+b*H,q=p*k+y*U+w*H,Y=m*k+v*U+x*H;if(T){const de=Z*Z+q*q+Y*Y;if(de<M&&de>C){const L=1/Math.sqrt(de);Z*=L,q*=L,Y*=L}}l[r]=Z,l[r+1]=q,l[r+2]=Y,l[r+3]=z,r+=c}else for(let O=0;O<u;++O){const D=4*o[O],k=n[D],U=n[D+1],H=n[D+2],z=n[D+3];let Z=d*k+g*U+b*H,q=p*k+y*U+w*H,Y=m*k+v*U+x*H;if(T){const de=Z*Z+q*q+Y*Y;if(de<M&&de>C){const L=1/Math.sqrt(de);Z*=L,q*=L,Y*=L}}for(let de=0;de<s;++de)l[r]=Z,l[r+1]=q,l[r+2]=Y,l[r+3]=z,r+=c}}function TOe(t,e,i,r,s=1){const{data:n,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length;if(r*=l,e!==n.length||e!==4)if(s!==1)if(e!==4)for(let u=0;u<c;++u){const d=3*o[u];for(let p=0;p<s;++p)a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=255,r+=l}else for(let u=0;u<c;++u){const d=4*o[u];for(let p=0;p<s;++p)a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=n[d+3],r+=l}else{if(e===4){for(let u=0;u<c;++u){const d=4*o[u];a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=n[d+3],r+=l}return}for(let u=0;u<c;++u){const d=3*o[u];a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=255,r+=l}}else{a[r]=n[0],a[r+1]=n[1],a[r+2]=n[2],a[r+3]=n[3];const u=new Uint32Array(i.typedBuffer.buffer,i.start),d=l/4,p=u[r/=4];r+=d;const m=c*s;for(let g=1;g<m;++g)u[r]=p,r+=d}}function uut(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length,l=r[0];i*=o;for(let c=0;c<a;++c)n[i]=l,i+=o}function EOe(t,e,i,r,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(r*=o,s===1)for(let a=0;a<i;++a)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o;else for(let a=0;a<i;++a)for(let l=0;l<s;++l)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o}function COe(t,e,i,r,s,n){var o;for(const a of e.fields.keys()){const l=t.attributes.get(a),c=l==null?void 0:l.indices;if(l&&c)hut(a,l,i,r,s,n);else if(a===R.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const u=(o=t.attributes.get(R.POSITION))==null?void 0:o.indices;if(u){const d=u.length,p=s.getField(a,nl);EOe(t.objectAndLayerIdColor,p,d,n)}}}}function hut(t,e,i,r,s,n){switch(t){case R.POSITION:{ft(e.size===3);const o=s.getField(t,po);ft(!!o,`No buffer view for ${t}`),o&&are(e,i,o,n);break}case R.NORMAL:{ft(e.size===3);const o=s.getField(t,po);ft(!!o,`No buffer view for ${t}`),o&&lre(e,r,o,n);break}case R.NORMALCOMPRESSED:{ft(e.size===2);const o=s.getField(t,vL);ft(!!o,`No buffer view for ${t}`),o&&mde(e,o,n);break}case R.UV0:{ft(e.size===2);const o=s.getField(t,OT);ft(!!o,`No buffer view for ${t}`),o&&mde(e,o,n);break}case R.COLOR:case R.SYMBOLCOLOR:{const o=s.getField(t,nl);ft(!!o,`No buffer view for ${t}`),ft(e.size===3||e.size===4),!o||e.size!==3&&e.size!==4||TOe(e,e.size,o,n);break}case R.COLORFEATUREATTRIBUTE:{const o=s.getField(t,xG);ft(!!o,`No buffer view for ${t}`),ft(e.size===1),o&&e.size===1&&uut(e,o,n);break}case R.TANGENT:{ft(e.size===4);const o=s.getField(t,$f);ft(!!o,`No buffer view for ${t}`),o&&cut(e,i,o,n);break}case R.PROFILERIGHT:case R.PROFILEUP:case R.PROFILEVERTEXANDNORMAL:case R.FEATUREVALUE:{ft(e.size===4);const o=s.getField(t,$f);ft(!!o,`No buffer view for ${t}`),o&&lA(e,o,n)}}}let m9t=class extends $r{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function dut(t,e){MOe(t,e,new Vt("slicePlaneOrigin",(i,r)=>ROe(e,i,r)),new Vt("slicePlaneBasis1",(i,r)=>{var s;return Vz(e,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Vt("slicePlaneBasis2",(i,r)=>{var s;return Vz(e,i,r,(s=r.slicePlane)==null?void 0:s.basis2)}))}function gn(t,e){MOe(t,e,new Sh("slicePlaneOrigin",(i,r)=>ROe(e,i,r)),new Sh("slicePlaneBasis1",(i,r)=>{var s;return Vz(e,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Sh("slicePlaneBasis2",(i,r)=>{var s;return Vz(e,i,r,(s=r.slicePlane)==null?void 0:s.basis2)}))}function MOe(t,e,...i){if(!e.hasSlicePlane){const o=S`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...i),t.fragment.uniforms.add(...i);const r=S`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=S`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=e.hasSliceHighlight?S`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:S`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(r),t.fragment.code.add(r),t.fragment.code.add(n)}function AOe(t,e,i){return t.instancedDoublePrecision?ne(put,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function POe(t,e){return t!=null?ve(Bz,e.origin,t):e.origin}function OOe(t,e,i){return t.hasSliceTranslatedView?e!=null?rl(fut,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function ROe(t,e,i){if(i.slicePlane==null)return $n;const r=AOe(t,e,i),s=POe(r,i.slicePlane),n=OOe(t,r,i);return n!=null?He(Bz,s,n):s}function Vz(t,e,i,r){if(r==null||i.slicePlane==null)return $n;const s=AOe(t,e,i),n=POe(s,i.slicePlane),o=OOe(t,s,i);return o!=null?(me(jP,r,n),He(Bz,n,o),He(jP,jP,o),ve(jP,jP,Bz)):r}const put=E(),Bz=E(),jP=E(),fut=Ee();function LT(t,e){const i=e.output===G.ObjectAndLayerIdColor,r=e.objectAndLayerIdColorInstanced;i&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),r?t.attributes.add(R.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(R.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(S`
     void forwardObjectAndLayerIdColor() {
      ${i?r?S`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:S`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:S``} }`),t.fragment.code.add(S`
      void outputObjectAndLayerIdColor() {
        ${i?S`fragColor = objectAndLayerIdColorVarying;`:S``} }`)}function VG(t){t.uniforms.add(new pg("alignPixelEnabled",(e,i)=>i.alignPixelEnabled)),t.code.add(S`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(S`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function mut(t,e){const{vertex:i,fragment:r}=t;i.include(VG),e.multipassEnabled&&t.varyings.add("depth","float"),i.code.add(S`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.multipassEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.include(Vg,e),r.code.add(S`
  void main() {
    fragColor = vec4(1);
    ${e.multipassEnabled?S`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)}function $Oe(t){t.vertex.uniforms.add(new qe("renderTransparentlyOccludedHUD",(e,i)=>i.hudRenderStyle===fc.Occluded?1:i.hudRenderStyle===fc.NotOccluded?0:.75),new zi("viewport",(e,i)=>i.camera.fullViewport),new mt("hudVisibilityTexture",(e,i)=>{var r;return(r=i.hudVisibility)==null?void 0:r.getTexture()})),t.vertex.include(VG),t.vertex.code.add(S`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}const IOe=Wt(1,1,0,1),cre=Wt(1,0,1,1);function gb(t){t.fragment.uniforms.add(new mt("depthTexture",(e,i)=>i.mainDepth)),t.fragment.constants.add("occludedHighlightFlag","vec4",IOe).add("unoccludedHighlightFlag","vec4",cre),t.fragment.code.add(S`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let LOe=class extends Fs{constructor(e,i,r){super(e,"vec4",Hi.Pass,(s,n,o)=>s.setUniform4fv(e,i(n,o)),r)}},Fl=class extends Fs{constructor(e,i,r){super(e,"float",Hi.Pass,(s,n,o)=>s.setUniform1fv(e,i(n,o)),r)}},EL=class extends hOe{constructor(){super(...arguments),this.renderOccluded=Ji.Occlude,this.isDecoration=!1}};const nM=8;function g0(t,e){const{vertex:i,attributes:r}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&r.add(R.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(i.uniforms.add(new Vt("vvSizeMinSize",s=>s.vvSize.minSize)),i.uniforms.add(new Vt("vvSizeMaxSize",s=>s.vvSize.maxSize)),i.uniforms.add(new Vt("vvSizeOffset",s=>s.vvSize.offset)),i.uniforms.add(new Vt("vvSizeFactor",s=>s.vvSize.factor)),i.uniforms.add(new Jd("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),i.uniforms.add(new Vt("vvSymbolAnchor",s=>s.vvSymbolAnchor)),i.code.add(S`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(S`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?S`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(S`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(i.constants.add("vvColorNumber","int",nM),i.uniforms.add(new Fl("vvColorValues",s=>s.vvColor.values,nM),new LOe("vvColorColors",s=>s.vvColor.colors,nM)),i.code.add(S`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?S`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):i.code.add(S`vec4 vvColor() { return vec4(1.0); }`)}const Gz=.1,Xo=.001;function DOe(t){const e=new Vi,i=t.signedDistanceFieldEnabled;if(e.include(yOe,t),e.include(gn,t),t.occlusionPass)return e.include(mut,t),e;const{vertex:r,fragment:s}=e;e.include(nre),s.include(Uf),s.include(Ug),e.include(g0,t),e.include(LT,t),e.include($Oe),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),e.varyings.add("voccluded","float"),r.uniforms.add(new zi("viewport",(c,u)=>u.camera.fullViewport),new Fr("screenOffset",(c,u)=>Pi(NOe,2*c.screenOffset[0]*u.camera.pixelRatio,2*c.screenOffset[1]*u.camera.pixelRatio)),new Fr("anchorPosition",c=>d3(c)),new zi("materialColor",c=>c.color)),YA(r),i&&(r.uniforms.add(new zi("outlineColor",c=>c.outlineColor)),s.uniforms.add(new zi("outlineColor",c=>yde(c)?c.outlineColor:wh),new qe("outlineSize",c=>yde(c)?c.outlineSize:0))),t.pixelSnappingEnabled&&r.include(VG),t.hasScreenSizePerspective&&(sut(r),zG(r)),t.debugDrawLabelBorder&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(R.UV0,"vec2"),e.attributes.add(R.COLOR,"vec4"),e.attributes.add(R.SIZE,"vec2"),e.attributes.add(R.FEATUREATTRIBUTE,"vec4"),r.code.add(S`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?S`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:S`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const n=S`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=t.pixelSnappingEnabled?i?S`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:S`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:S`posProj += quadOffset;`;r.code.add(S`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${t.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===G.ObjectAndLayerIdColor?S`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${S.float(Xo)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${S.float(Xo)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?S`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new mt("tex",c=>c.texture));const a=t.debugDrawLabelBorder?S`(isBorder > 0.0 ? 0.0 : ${S.float(Gz)})`:S.float(Gz),l=S`
    ${t.debugDrawLabelBorder?S`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${t.sampleSignedDistanceFieldTexelCenter?S`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:S`
      vec2 samplePos = vtc;
      `}

    ${i?S`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${S.float(Xo)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:S`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?S`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(t.output){case G.Color:t.transparencyPassType===nt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),s.code.add(S`
        void main() {
          ${l}
          ${t.transparencyPassType===nt.FrontFace?"fragColor.rgb /= fragColor.a;":""}
          ${t.transparencyPassType===nt.ColorAlpha?"fragAlpha = fragColor.a;":""}
        }`);break;case G.ObjectAndLayerIdColor:s.code.add(S`
        void main() {
          ${l}
          outputObjectAndLayerIdColor();
        }`);break;case G.Highlight:s.constants.add("occludedHighlightFlag","vec4",IOe),s.constants.add("unoccludedHighlightFlag","vec4",cre),s.code.add(S`
        void main() {
          ${l}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return e}function yde(t){return t.outlineColor[3]>0&&t.outlineSize>0}function d3(t,e=NOe){return t.textureIsSignedDistanceField?gut(t.anchorPosition,t.distanceFieldBoundingBox,e):Aa(e,t.anchorPosition),e}function gut(t,e,i){e!=null?Pi(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):Pi(i,0,0)}const NOe=lt(),yut=Object.freeze(Object.defineProperty({__proto__:null,build:DOe,calculateAnchorPosForRendering:d3},Symbol.toStringTag,{value:"Module"})),gu=sa(Pe.SRC_ALPHA,Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA,Pe.ONE_MINUS_SRC_ALPHA),_ut=sa(Pe.ONE,Pe.ZERO,Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA);function Z0(t){return t===nt.FrontFace?null:_ut}function BG(t){return t===nt.FrontFace?Tu:null}const GG=5e5,jG={factor:-1,units:-2};function HG(t){return t?jG:null}function yb(t,e=fr.LESS){return t===nt.NONE||t===nt.FrontFace?e:fr.LEQUAL}function X0(t){return t===nt.ColorAlpha?{buffers:[qn.COLOR_ATTACHMENT0,qn.COLOR_ATTACHMENT1]}:null}let FOe=class kOe extends Wi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Ge.Global}initializeProgram(e){return new Yi(e.rctx,kOe.shader.get().build(this.configuration),wi)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===nt.NONE,s=e===nt.FrontFace,n=this.configuration.hasPolygonOffset?vut:null,o=i.draped?null:(r||s)&&i.output!==G.Highlight&&(i.depthEnabled||i.occlusionPass)?Tu:null;return Gt({blending:i.output===G.Color||i.output===G.Highlight?r?but:Z0(e):null,depthTest:i.draped?null:{func:fr.LEQUAL},depthWrite:o,drawBuffers:X0(e),colorWrite:Kt,polygonOffset:n})}get primitiveType(){return this.configuration.occlusionPass?vi.POINTS:vi.TRIANGLES}};FOe.shader=new Bi(yut,()=>fe(()=>Promise.resolve().then(()=>dUt),void 0));const vut={factor:0,units:-4},but=Ah(Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA);let hn=class extends Ec{constructor(){super(...arguments),this.output=G.Color,this.transparencyPassType=nt.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};h([B({count:G.COUNT})],hn.prototype,"output",void 0),h([B({count:nt.COUNT})],hn.prototype,"transparencyPassType",void 0),h([B()],hn.prototype,"screenCenterOffsetUnitsEnabled",void 0),h([B()],hn.prototype,"spherical",void 0),h([B()],hn.prototype,"occlusionTestEnabled",void 0),h([B()],hn.prototype,"signedDistanceFieldEnabled",void 0),h([B()],hn.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),h([B()],hn.prototype,"vvSize",void 0),h([B()],hn.prototype,"vvColor",void 0),h([B()],hn.prototype,"hasVerticalOffset",void 0),h([B()],hn.prototype,"hasScreenSizePerspective",void 0),h([B()],hn.prototype,"debugDrawLabelBorder",void 0),h([B()],hn.prototype,"hasSlicePlane",void 0),h([B()],hn.prototype,"hasPolygonOffset",void 0),h([B()],hn.prototype,"depthEnabled",void 0),h([B()],hn.prototype,"pixelSnappingEnabled",void 0),h([B()],hn.prototype,"draped",void 0),h([B()],hn.prototype,"multipassEnabled",void 0),h([B()],hn.prototype,"cullAboveGround",void 0),h([B()],hn.prototype,"occlusionPass",void 0),h([B()],hn.prototype,"objectAndLayerIdColorInstanced",void 0),h([B({constValue:!0})],hn.prototype,"hasSliceInVertexProgram",void 0),h([B({constValue:!1})],hn.prototype,"hasVvInstancing",void 0);let cA=class extends mb{constructor(e){super(e,new Rut),this._configuration=new hn,this.produces=new Map([[_e.HUD_MATERIAL,i=>A5(i)&&!this.parameters.drawInSecondSlot],[_e.LABEL_MATERIAL,i=>A5(i)&&this.parameters.drawInSecondSlot],[_e.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[_e.DRAPED_MATERIAL,i=>A5(i)]])}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=i.slot===_e.OCCLUSION_PIXELS&&this.parameters.occlusionTest,e===G.Color&&(this._configuration.debugDrawLabelBorder=!!Rr.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(e,i,r,s,n,o){if(!(r.options.selectionMode&&r.options.hud&&e.visible&&r.point))return;const a=this.parameters,l=r.point,c=r.camera;let{scaleX:u,scaleY:d}=this._getScreenScale(e);u*=c.pixelRatio,d*=c.pixelRatio,Xd(U8,i),e.attributes.has(R.FEATUREATTRIBUTE)&&Sut(U8);const p=e.attributes.get(R.POSITION),m=e.attributes.get(R.SIZE),g=e.attributes.get(R.NORMAL),y=e.attributes.get(R.CENTEROFFSETANDDISTANCE);ft(p.size>=3);const v=d3(a),b=this.parameters.centerOffsetUnits==="screen";for(let w=0;w<p.data.length/p.size;w++){const x=w*p.size;ne($a,p.data[x],p.data[x+1],p.data[x+2]),He($a,$a,i);const T=w*m.size;E_[0]=m.data[T]*u,E_[1]=m.data[T+1]*d,He($a,$a,c.viewMatrix);const C=w*y.size;if(ne(Iu,y.data[C],y.data[C+1],y.data[C+2]),!b&&($a[0]+=Iu[0],$a[1]+=Iu[1],Iu[2]!==0)){const O=Iu[2];ge(Iu,$a),ve($a,$a,oe(Iu,Iu,O))}const M=w*g.size;if(ne(HP,g.data[M],g.data[M+1],g.data[M+2]),_de(HP,U8,c,z8),this._applyVerticalOffsetTransformationView($a,z8,c,k8),c.applyProjection($a,fl),fl[0]>-1){b&&(Iu[0]||Iu[1])&&(fl[0]+=Iu[0]*c.pixelRatio,Iu[1]!==0&&(fl[1]+=ire(Iu[1],k8.factorAlignment)*c.pixelRatio),c.unapplyProjection(fl,$a)),fl[0]+=this.parameters.screenOffset[0]*c.pixelRatio,fl[1]+=this.parameters.screenOffset[1]*c.pixelRatio,fl[0]=Math.floor(fl[0]),fl[1]=Math.floor(fl[1]),oOe(E_,k8.factor,E_);const O=Aut*c.pixelRatio;let D=0;if(a.textureIsSignedDistanceField&&(D=a.outlineSize*c.pixelRatio/2),vde(l,fl[0],fl[1],E_,O,D,a,v)){const k=r.ray;if(He(bde,$a,In(Eut,c.viewMatrix)),fl[0]=l[0],fl[1]=l[1],c.unprojectFromRenderScreen(fl,$a)){const U=E();ce(U,k.direction);const H=1/Ae(U);oe(U,U,H),o(wr(k.origin,$a)*H,U,-1,!0,1,bde)}}}}}intersectDraped(e,i,r,s,n,o){const a=e.attributes.get(R.POSITION),l=e.attributes.get(R.SIZE),c=this.parameters,u=d3(c);let{scaleX:d,scaleY:p}=this._getScreenScale(e);d*=e.screenToWorldRatio,p*=e.screenToWorldRatio;const m=Put*e.screenToWorldRatio;for(let g=0;g<a.data.length/a.size;g++){const y=g*a.size,v=a.data[y],b=a.data[y+1],w=g*l.size;E_[0]=l.data[w]*d,E_[1]=l.data[w+1]*p;let x=0;c.textureIsSignedDistanceField&&(x=c.outlineSize*e.screenToWorldRatio/2),vde(s,v,b,E_,m,x,c,u)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new Iut(this)}_updateScaleInfo(e,i,r){const s=this.parameters;s.screenSizePerspective!=null?lde(r,i,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),s.screenSizePerspectiveAlignment!=null?lde(r,i,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,i,r,s,n,o,a){const l=_de(i,r,n,z8);return this._applyVerticalGroundOffsetView(e,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(e,i,r,s,n){return this._applyCenterOffsetNDC(e,i,r,s),n!=null&&ce(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(e,i,r,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ce(n,e);const c=Te(Math.abs(i.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/s.viewport[2];return oe(n,e,l>0?u:1/u),n}_applyVerticalGroundOffsetView(e,i,r,s){const n=Ae(e),o=r.aboveGround?1:-1,a=r.computeRenderPixelSizeAtDist(n)*gOe,l=oe($a,i.normal,o*a);return me(s,e,l),s}_applyVerticalOffsetTransformationView(e,i,r,s){var c;const n=this.parameters;if(!((c=n.verticalOffset)!=null&&c.screenLength)){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const u=Ae(e);this._updateScaleInfo(s,u,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const o=Ae(e),a=n.screenSizePerspectiveAlignment??n.screenSizePerspective,l=_Oe(r,o,n.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(s,o,i.cosAngle),oe(i.normal,i.normal,l),me(e,e,i.normal)}_applyCenterOffsetView(e,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==e&&ce(r,e),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(ge(HP,r),me(r,r,oe(HP,HP,i[2])))),r}_applyCenterOffsetNDC(e,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&ce(s,e),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(e,i,r,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&ce(s,e),n){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);s[2]-=(a||o)*n}return s}createGLMaterial(e){return new wut(e)}calculateRelativeScreenBounds(e,i,r=Ht()){return xut(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e){const i=e.attributes.get(R.FEATUREATTRIBUTE);if(i==null)return{scaleX:1,scaleY:1};const r=HI(i.data,Mut),[s,n]=sre(Cut,this.parameters,r);return{scaleX:s,scaleY:n}}},wut=class extends pie{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(FOe,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function xut(t,e,i,r){r[0]=t.anchorPosition[0]*-e[0]+t.screenOffset[0]*i,r[1]=t.anchorPosition[1]*-e[1]+t.screenOffset[1]*i}function _de(t,e,i,r){return jct(e)&&(e=Xd(Tut,e)),Qo(r.normal,t,e),He(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=pe(UOe,Out),r}function Sut(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=1/Math.sqrt(e*e+i*i+r*r),d=1/Math.sqrt(s*s+n*n+o*o),p=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*u,t[1]=i*u,t[2]=r*u,t[3]=s*d,t[4]=n*d,t[5]=o*d,t[6]=a*p,t[7]=l*p,t[8]=c*p,t}function vde(t,e,i,r,s,n,o,a){let l=e-s-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*s,u=i-s-(a[1]>0?r[1]*a[1]:0),d=u+r[1]+2*s;const p=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&p!=null&&(l+=r[0]*p[0],u+=r[1]*p[1],c-=r[0]*(1-p[2]),d-=r[1]*(1-p[3]),l-=n,c+=n,u-=n,d+=n),t[0]>l&&t[0]<c&&t[1]>u&&t[1]<d}const k8=new xOe,$a=E(),HP=E(),fl=Qt(),UOe=E(),bde=E(),U8=Gr(),Tut=Gr(),Eut=Ee(),Iu=E(),Cut=E(),Mut=Qt(),z8={normal:UOe,cosAngle:0},Aut=1,Put=2,E_=[0,0],Out=$e(0,0,1);class Rut extends qMe{constructor(){super(...arguments),this.renderOccluded=Ji.Occlude,this.isDecoration=!1,this.color=Wt(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=_i(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=Wt(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1}}const zOe=Ts().vec3f(R.POSITION).vec3f(R.NORMAL).vec2f(R.UV0).vec4u8(R.COLOR).vec2f(R.SIZE).vec4f(R.CENTEROFFSETANDDISTANCE).vec4f(R.FEATUREATTRIBUTE),$ut=zOe.clone().vec4u8(R.OBJECTANDLAYERIDCOLOR);let Iut=class{constructor(e){this._material=e,this.vertexBufferLayout=re("enable-feature:objectAndLayerId-rendering")?$ut:zOe}elementCount(e){return 6*e.attributes.get(R.POSITION).indices.length}write(e,i,r,s,n){var b;are(r.attributes.get(R.POSITION),e,s.position,n,6),lre(r.attributes.get(R.NORMAL),i,s.normal,n,6);const o=r.attributes.get(R.UV0).data;let a,l,c,u;if(o==null||o.length<4){const w=this._material.parameters;a=0,l=0,c=w.texCoordScale[0],u=w.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],u=o[3];c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let d=r.attributes.get(R.POSITION).indices.length,p=n;const m=s.uv0;for(let w=0;w<d;++w)m.set(p,0,a),m.set(p,1,l),p++,m.set(p,0,c),m.set(p,1,l),p++,m.set(p,0,c),m.set(p,1,u),p++,m.set(p,0,c),m.set(p,1,u),p++,m.set(p,0,a),m.set(p,1,u),p++,m.set(p,0,a),m.set(p,1,l),p++;TOe(r.attributes.get(R.COLOR),4,s.color,n,6);const{data:g,indices:y}=r.attributes.get(R.SIZE);d=y.length;const v=s.size;p=n;for(let w=0;w<d;++w){const x=g[2*y[w]],T=g[2*y[w]+1];for(let C=0;C<6;++C)v.set(p,0,x),v.set(p,1,T),p++}if(r.attributes.get(R.CENTEROFFSETANDDISTANCE)?lA(r.attributes.get(R.CENTEROFFSETANDDISTANCE),s.centerOffsetAndDistance,n,6):gde(s.centerOffsetAndDistance,n,6*d),r.attributes.get(R.FEATUREATTRIBUTE)?lA(r.attributes.get(R.FEATUREATTRIBUTE),s.featureAttribute,n,6):gde(s.featureAttribute,n,6*d),r.objectAndLayerIdColor!=null){const w=(b=r.attributes.get(R.POSITION))==null?void 0:b.indices;if(w){const x=w.length,T=s.getField(R.OBJECTANDLAYERIDCOLOR,nl);EOe(r.objectAndLayerIdColor,T,x,n,6)}}}};const qf=E(),c2=Qt(),qP=Qt(),V8=E(),Lut=Ee(),Dut=ln(),B8=uo(),Nut=E(),Fut=Ht();class kut{constructor(){this.aabr=Ht(),this.distance=0,this.culled=!1,this.visible=!1}}class Uut{constructor(e,i){this.graphics3DGraphic=e,this.slicePlaneEnabled=i,this.info={}}}var Wc;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(Wc||(Wc={}));class zut{constructor(){this.camera=new Pr,this.slicePlane=z0(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),bT(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let uC=class extends Re{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._viewState=new zut,this._state=Wc.Idle,this._active=new Map,this._visible=new Map,this._iterators=new jut,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Wc.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/Wc.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case Wc.Idle:this._startUpdate(),t.madeProgress();case Wc.Process:if(this._state=Wc.Process,!this._processActiveGraphics(t))return;case Wc.Sort:if(this._state=Wc.Sort,!this._sortVisibleGraphics(t))return;case Wc.Deconflict:if(this._state=Wc.Deconflict,!this._deconflictVisibleGraphics(t))return;default:Ict(this,this._visible),this._state=Wc.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(i=>this.addToActiveGraphics(i)):t.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;if(((e==null?void 0:e.geometries.length)??0)!==1)return!1;const i=e==null?void 0:e.geometries[0];return(i==null?void 0:i.material)instanceof cA}_startUpdate(){Lct(this.view),this._dirty=!1,this._viewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._viewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new kut,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),Vut(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),i=rb(Lut,this._viewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._viewState.camera.relativeElevation>0?Dut:null;let s=0;for(r!=null&&(He(r,$n,this._viewState.camera.viewMatrix),r[3]=ur(this.view.spatialReference).radius,s=TTe(r,$n));!t.done;){t.madeProgress();const n=e.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o==null?void 0:o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const i=e.next();if(t.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===Po.LABEL;for(;!t.done;){t.madeProgress();const r=e.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled){this._setGraphicVisibility(s,!1);continue}const o=s.graphics3DGraphic,a=!i||o.isVisible();n.visible=a&&!this._isConflicted(s),n.visible&&this._addToBins(s),this._setGraphicVisibility(s,n.visible),Nct(n,n.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=wde(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=wde(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=But(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,i,r){const s=t.graphics3DGraphic;if(s.destroyed)return;const n=t.info[this.visibilityGroup];if(!s.isVisible(Po.GRAPHIC,wa.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);Mc(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=Yut,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,qf)||i!=null&&Wut(a,i,r)))return void(n.culled=!0);this._expandBoundingRect(n,l,c,a)}a==null?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(t,e,i){const r=this._viewState.camera,s=t.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;He(qf,a,r.viewMatrix);const l=n.attributes,c=l.get(R.NORMAL).data,u=l.get(R.CENTEROFFSETANDDISTANCE).data;o.applyShaderOffsetsView(qf,c,s.transformation,u,r,i.scaleInfo,qf),ds(c2,qf[0],qf[1],qf[2],1),hu(qP,c2,r.projectionMatrix),oe(i.positionNDC,qP,1/qP[3]),o.applyShaderOffsetsNDC(i.positionNDC,u,r,i.positionNDC,V8),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(V8[2]),i.distance=V8[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),ds(qP,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),hu(c2,qP,e),HS(c2,c2,1/c2[3]),ne(i.positionView,qf[0],qf[1],qf[2])}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&ste(this._viewState.slicePlane,e)}_expandBoundingRect(t,e,i,{positionNDC:r,scaleInfo:s}){const n=this._viewState.camera,o=e.getScreenSize(Hut);oOe(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=DU(i.calculateRelativeScreenBounds(o,s.factorAlignment.scale,Fut),Dt(0,n.fullWidth,.5+.5*r[0]),Dt(0,n.fullHeight,.5+.5*r[1])),l=this.marginFactor;if(l!==0){const c=l*Math.min(Xa(a),_c(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}r1(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,i=t.info[this.visibilityGroup];let r=!0;for(let s=Math.floor(i.aabr[0]/this._accBinsSizeX);s<=Math.floor(i.aabr[2]/this._accBinsSizeX);s++)if(!(s<0||s>=this._accBinsNumX))for(let n=Math.floor(i.aabr[1]/this._accBinsSizeY);n<=Math.floor(i.aabr[3]/this._accBinsSizeY);n++){if(n<0||n>=this._accBinsNumY)continue;r=!1;const o=this._accBins[s][n];for(let a=0;a<o.length;a++){const l=o.data[a],c=l.info[this.visibilityGroup];if(c&&c.visible&&l.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,X3(c.aabr,i.aabr)))return!0}}return r}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let i=0;i<this._accBinsNumX;i++){this._accBins.push([]);const r=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)r.push(new Zt)}}else for(let i=0;i<this._accBinsNumX;i++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[i][r].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],i=Math.floor(e.aabr[0]/this._accBinsSizeX),r=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const i=t.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(this.visibilityGroup,wa.DECONFLICTION,e),this.visibilityGroup===Po.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,e))}};function Vut(t,e){const i=t.graphics3DGraphic;i.destroyed||i.setVisibilityFlag(e,wa.DECONFLICTION,!0)}function*wde(t){if(Map.prototype.entries){const e=t.entries();for(let i=e.next();!i.done;i=e.next())yield i.value[1]}else yield*t.values()}function*But(t,e,i){e.clear(),t.forEach((s,n)=>{var l;const o=e.pushNew();o.id=n,o.visible=s.graphics3DGraphic.getVisibilityFlag(i,wa.DECONFLICTION);const a=(l=s.info)==null?void 0:l[i];o.prio=s.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const r=e.iterableSort((s,n)=>s.prio!==n.prio?n.prio-s.prio:s.distance!==n.distance?s.distance-n.distance:s.visible!==n.visible?s.visible?-1:1:s.id-n.id);for(let s=r.next();!s.done;s=r.next())yield;e.forAll(s=>{const n=t.get(s.id);n&&(t.delete(s.id),t.set(s.id,n))}),e.clear()}h([f({constructOnly:!0})],uC.prototype,"view",void 0),h([f({type:Boolean,readOnly:!0})],uC.prototype,"updating",null),uC=h([I("esri.views.3d.layers.graphics.Deconflictor")],uC);class Gut{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class jut{constructor(e=null,i=null,r=null){this.active=e,this.visible=i,this.sort=r,this.sortArray=new Zt({allocator:s=>s||new Gut})}}const Hut=lt();class qut{constructor(){this.positionView=E(),this.positionNDC=E(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new xOe}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}function Wut(t,e,i){return ce(B8.direction,t.positionView),ne(B8.origin,0,0,0),!!sb(e,B8,Nut)&&t.distanceWithoutPolygonOffset>i}const Yut=new qut,Zut=2e3;let z5=class extends uC{constructor(e){super(e),this.visibilityGroup=Po.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return ia;const i=performance.now();if(e.state!==Mi.IDLE&&i-this._lastDeconfliction<Zut)return ia;super.runTask(e),this.state===Wc.Idle&&(this._lastDeconfliction=i)}enabledChanged(e,i){this.modifyGraphics(i,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};h([f({constructOnly:!0})],z5.prototype,"parent",void 0),z5=h([I("esri.views.3d.layers.graphics.LabelDeconflictor")],z5);let yX=class extends uC{constructor(){super(...arguments),this._contexts=new Map,this.visibilityGroup=Po.GRAPHIC,this._marginFactor=-.1,this.test={overrideMarginFactor:e=>{this._marginFactor=e,this.setDirty()}}}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([ue(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.state)==null?void 0:i.camera},()=>{this._updateViewState(),this.setDirty()}),ue(()=>{var e,i,r;return(r=(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground)==null?void 0:r.opacity},(e,i)=>{e!==1&&i!==1||this.setDirty()}),ue(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},cr)]),this._frameTask=this.view.resourceController.scheduler.registerTask(Mt.GRAPHICS_DECONFLICTOR,this),this._labels=new z5({view:this.view,parent:this})}destroy(){this._labels=Le(this._labels),this._frameTask=Or(this._frameTask)}get marginFactor(){return this._marginFactor}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}_updateViewState(){var e;(e=this.view)!=null&&e.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&gTe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){mh(this._contexts,(e,i)=>i.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const i=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,i,r),removeGraphic:r=>this._removeGraphic(i,r),labelingInfoChange:()=>this._labels.enabledChanged(e,i),featureReductionChange:()=>this.enabledChanged(e,i),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,i),clear:()=>i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._contexts.get(e);i&&(i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,i,r){const s=r.graphic.uid,n=new Uut(r,e.symbolCreationContext.slicePlaneEnabled);i.set(s,n),G8(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n);const o=!this._graphicSupportsDeconfliction(r)||!G8(e);r.setVisibilityFlag(Po.GRAPHIC,wa.DECONFLICTION,o)}_removeGraphic(e,i){const r=i.graphic.uid,s=e.get(r);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(r),this.setDirty())}enabledChanged(e,i){const r=G8(e);r||Xut(e),this.modifyGraphics(i,r)}_slicePlaneEnabledChanged(e,i){const r=e.symbolCreationContext.slicePlaneEnabled;i.forEach(s=>s.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const i=e.layers;if(!(i!=null&&i.length))return!1;for(const r of i)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const i=this._contexts.get(e);if(i)return i;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function G8(t){const e=t.layer;return!(!(e!=null&&e.featureReduction)||e.featureReduction.type!=="selection")}function Xut(t){const e=t.graphics3DGraphics;e&&e.forEach(i=>i.setVisibilityFlag(Po.GRAPHIC,wa.DECONFLICTION,!0))}yX=h([I("esri.views.3d.layers.graphics.GraphicsDeconflictor")],yX);function VOe(t){return"declaredClass"in t}function xde(t){return"declaredClass"in t}function Jut(t){return"declaredClass"in t}function Qut(t,e){return t?Jut(t)?t:new Su({layer:e,sourceLayer:e,visible:t.visible,symbol:Q(t.symbol),attributes:Q(t.attributes),geometry:BOe(t.geometry)}):null}function BOe(t){return t==null?null:VOe(t)?t:C1(Kut(t))}function Kut(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:s}=t.spatialReference,n={wkid:e,wkt:i,wkt2:r,latestWkid:s};switch(t.type){case"point":{const{x:o,y:a,z:l,m:c}=t;return{x:o,y:a,z:l,m:c,spatialReference:n}}case"polygon":{const{rings:o,hasZ:a,hasM:l}=t;return{rings:Sde(o),hasZ:a,hasM:l,spatialReference:n}}case"polyline":{const{paths:o,hasZ:a,hasM:l}=t;return{paths:Sde(o),hasZ:a,hasM:l,spatialReference:n}}case"extent":{const{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:d,mmin:p,mmax:m,hasZ:g,hasM:y}=t;return{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:d,mmin:p,mmax:m,hasZ:g,hasM:y,spatialReference:n}}case"multipoint":{const{points:o,hasZ:a,hasM:l}=t;return{points:jOe(o)?GOe(o):o,hasZ:a,hasM:l,spatialReference:n}}default:return}}function Sde(t){return eht(t)?t.map(e=>GOe(e)):t}function GOe(t){return t.map(e=>Array.from(e))}function eht(t){for(const e of t)if(e.length!==0)return jOe(e);return!1}function jOe(t){return t.length>0&&(N3(t[0])||F3(t[0]))}function tht(t,e){if(!t)return null;let i;if(xde(t)){if(e==null)return t.clone();if(xde(e))return e.copy(t)}return e!=null?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=nb(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function C9t(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:s}=t,n={wkid:e,wkt:i,wkt2:r,latestWkid:s};return We.fromJSON(n)}const ure="__begin__",hre="__end__",iht=new RegExp(ure,"ig"),rht=new RegExp(hre,"ig"),Tde=new RegExp("^"+ure,"i"),Ede=new RegExp(hre+"$","i"),jz='"',sht=jz+" + ",nht=" + "+jz;function oht(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function aht(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function qG(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=oht(t.labelExpression),e.type="conventional"),e}function lht(t){const e=qG(t);if(!e)return null;switch(e.type){case"conventional":return _X(e.expression);case"arcade":return e.expression}return null}function cht(t){const e=qG(t);if(!e)return null;switch(e.type){case"conventional":return hht(e.expression);case"arcade":return dre(e.expression)}return null}function _X(t){let e;return t?(e=VK(t,i=>ure+'$feature["'+i+'"]'+hre),e=Tde.test(e)?e.replace(Tde,""):jz+e,e=Ede.test(e)?e.replace(Ede,""):e+jz,e=e.replaceAll(iht,sht).replaceAll(rht,nht)):e='""',e}const uht=/^\s*\{([^}]+)\}\s*$/i;function hht(t){const e=t==null?void 0:t.match(uht);return(e==null?void 0:e[1].trim())||null}const dht=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,pht=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,fht=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function dre(t){if(!t)return null;let e=dht.exec(t)||pht.exec(t);return e?e[1]||e[3]:(e=fht.exec(t),e?e[2]:null)}const j8=()=>ie.getLogger("esri.layers.support.labelFormatUtils"),H8={type:"simple",evaluate:()=>null},mht={getAttribute:(t,e)=>t.field(e)};async function ght(t,e,i){if(!t||!t.symbol||!e)return H8;const r=t.where,s=qG(t);let n;if(s.type==="arcade"){const o=await QJe(s.expression,i,e);if(o==null)return H8;n={type:"arcade",evaluate(a,l){try{const c="attributes"in a?o.repurposeFeature(a):a;c.contextTimeZone=l??null;const u=o.evaluate({$view:{timeZone:l},$feature:c},o.services);if(u!=null)return u.toString()}catch(c){j8().error(new V("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:a,expression:s}))}return null},needsHydrationToEvaluate:()=>dre(s.expression)==null}}else n={type:"simple",evaluate:o=>s.expression.replaceAll(/{[^}]*}/g,a=>{const l=a.slice(1,-1),c=e.get(l);if(!c)return a;let u=null;return"attributes"in o?o&&o.attributes&&(u=o.attributes[c.name]):u=o.field(c.name),u==null?"":yht(u,c)})};if(r){let o;try{o=await $te(r,e)}catch(l){return j8().error(new V("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:l})),H8}const a=n.evaluate;n.evaluate=(l,c)=>{const u="attributes"in l?void 0:mht;try{if(o.testFeature(l,u))return a(l,c)}catch(d){j8().error(new V("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:l,error:d}))}return null}}return n}function yht(t,e){if(t==null)return"";const i=e.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=t;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const{max:s,min:n}=AEe(e),o=+t;if(n!=null&&s!=null&&n<=o&&o<=s)return i.name}}let r=t;return kEe(e)?r=TB(r,AHe("short-date")):Dte(e)&&(r=OHe(+r)),r||""}function HOe(t,e,i,r,s,n,o,a,l,c,u){const d=Tht[u.mode];let p,m,g=0;if(ns(t,e,i,r,l.spatialReference,s,a))return d.requiresAlignment(u)?(g=d.applyElevationAlignmentBuffer(r,s,n,o,a,l,c,u),p=n,m=o):(p=r,m=s),ns(p,l.spatialReference,m,n,c.spatialReference,o,a)?g:void 0}function W1(t,e,i,r,s){const n=(nz(t)?t.z:M2e(t)?t.array[t.offset+2]:t[2])||0;switch(i.mode){case"on-the-ground":{const o=Qm(e,t,"ground")??0;return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=Qm(e,t,"ground")??0,a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=Qm(e,t,"scene")??0,a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(n,r),a=Qm(e,t,"ground")??0;return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function _ht(t,e,i,r){return W1(t,e,i,r,hC),hC.z}function CL(t,e,i){return e==="on-the-ground"&&i==="on-the-ground"?t.staysOnTheGround:e===i||e!=="on-the-ground"&&i!=="on-the-ground"?e==null||i==null?t.definedChanged:Ds.UPDATE:t.onTheGroundChanged}function qd(t){return t==="relative-to-ground"||t==="relative-to-scene"}function Y1(t){return t!=="absolute-height"}function qOe(t,e,i,r,s){W1(e,i,s,r,hC),WOe(t,hC.verticalDistanceToGround);const n=hC.sampledElevation,o=vn(Eht,t.transformation);return FN[0]=e.x,FN[1]=e.y,FN[2]=hC.z,mu(e.spatialReference,FN,o,r.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function WOe(t,e){for(let i=0;i<t.geometries.length;++i){const r=t.geometries[i].getMutableAttribute(R.CENTEROFFSETANDDISTANCE);r&&r.data[3]!==e&&(r.data[3]=e,t.geometryVertexAttributeUpdated(t.geometries[i],R.CENTEROFFSETANDDISTANCE))}}function vht(t,e,i,r,s,n){let o=0;const a=n.spatialReference;e*=3,r*=3;for(let l=0;l<s;++l){const c=t[e],u=t[e+1],d=t[e+2],p=n.getElevation(c,u,d,a,"ground")??0;o+=p,i[r]=c,i[r+1]=u,i[r+2]=p,e+=3,r+=3}return o/s}function bht(t,e,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,r*=3;for(let p=0;p<s;++p){const m=t[e],g=t[e+1],y=t[e+2],v=n.getElevation(m,g,y,d,"ground")??0;l+=v,i[r]=m,i[r+1]=g,i[r+2]=u==null?y+v+c:v+c,e+=3,r+=3}return l/s}function wht(t,e,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,r*=3;for(let p=0;p<s;++p){const m=t[e],g=t[e+1],y=t[e+2],v=n.getElevation(m,g,y,d,"scene")??0;l+=v,i[r]=m,i[r+1]=g,i[r+2]=u==null?y+v+c:v+c,e+=3,r+=3}return l/s}function xht(t){const e=t.meterUnitOffset,i=t.featureExpressionInfoContext;return e!==0||i!=null}function Sht(t,e,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,r*=3;for(let u=0;u<s;++u){const d=t[e],p=t[e+1],m=t[e+2];i[r]=d,i[r+1]=p,i[r+2]=c==null?m+l:l,e+=3,r+=3}return 0}let ML=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var Ds;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(Ds||(Ds={}));const Tht={"absolute-height":{applyElevationAlignmentBuffer:Sht,requiresAlignment:xht},"on-the-ground":{applyElevationAlignmentBuffer:vht,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:bht,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:wht,requiresAlignment:()=>!0}},Eht=Ee(),hC=new ML,FN=E();function pre(t){return t.mapPositions!=null}function YOe(t,e,i,r,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!pre(l))continue;const{update:c,averageGeometrySampledElevation:u}=XOe(l,e,i,r,s);a+=u,c&&n.geometryVertexAttributeUpdated(l,R.POSITION)}return a/o.length}function TS(t,e,i,r,s,n){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(r(a,yc),WOe(o,yc.verticalDistanceToGround),l=yc.sampledElevation):(r(a,yc),e.mode!=="absolute-height"&&(l=yc.sampledElevation));const c=vn(Cht,n??o.transformation),u=ne(ZOe,c[12],c[13],c[14]);Rr.TESTS_DISABLE_OPTIMIZATIONS?(gc[0]=a.x,gc[1]=a.y,gc[2]=yc.z,mu(a.spatialReference,gc,c,s.spatialReference)&&(n?vn(n,c):o.transformation=c)):s.setAltitudeOfTransformation(yc.z,c);const d=fre/s.unitInMeters;return(Math.abs(c[12]-u[0])>=d||Math.abs(c[13]-u[1])>=d||Math.abs(c[14]-u[2])>=d)&&(n?vn(n,c):o.transformation=c),l}const Cht=Ee();function Mht(t,e,i,r,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const o=e.centerPointInElevationSR;r(o,yc);const a=e.mode!=="absolute-height"?yc.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,u=Pht;l.getGlobalTransform(c,u);const d=ne(ZOe,u[12],u[13],u[14]);Rr.TESTS_DISABLE_OPTIMIZATIONS?(gc[0]=o.x,gc[1]=o.y,gc[2]=yc.z,mu(o.spatialReference,gc,u,s.spatialReference)&&l.setGlobalTransform(c,u)):s.setAltitudeOfTransformation(yc.z,u);const p=fre/s.unitInMeters;return(Rr.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(u[12]-d[0])>=p||Math.abs(u[13]-d[1])>=p||Math.abs(u[14]-d[2])>=p)&&l.setGlobalTransform(c,u),a}function Aht(t,e,i,r,s){const n=t.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,u=!1;for(const d of o){if(!pre(d))continue;const p=d.attributes.get(R.POSITION);if(p!==l){const{update:m,averageGeometrySampledElevation:g}=XOe(d,e,i,r,s);c=g,l=p,u=m}u&&n.geometryVertexAttributeUpdated(d,R.POSITION),a+=c}return a/o.length}const fre=.01,gc=E(),Fh=E(),u2=E(),Pht=Ee(),ZOe=E(),yc=new ML;function XOe(t,e,i,r,s){let n=!1;const o=t.transformation,a=e.requiresSampledElevationInfo;Fh[0]=o[12],Fh[1]=o[13],Fh[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(R.POSITION),c=l.data,u=l.size,d=c.length/u,p=new bte(t.mapPositions,i);let m=0,g=0;for(let y=0;y<d;y++){if(u2[0]=c[m],u2[1]=c[m+1],u2[2]=c[m+2],r(p,yc),a&&(g+=yc.sampledElevation),Rr.TESTS_DISABLE_OPTIMIZATIONS)c[m]=p.array[p.offset],c[m+1]=p.array[p.offset+1],c[m+2]=yc.z,ns(c,i,m,c,s.spatialReference,m,1),c[m]-=Fh[0],c[m+1]-=Fh[1],c[m+2]-=Fh[2],n=!0;else{gc[0]=c[m]+Fh[0],gc[1]=c[m+1]+Fh[1],gc[2]=c[m+2]+Fh[2],s.setAltitude(gc,yc.z),c[m]=gc[0]-Fh[0],c[m+1]=gc[1]-Fh[1],c[m+2]=gc[2]-Fh[2];const v=fre/s.unitInMeters;(Math.abs(u2[0]-c[m])>=v||Math.abs(u2[1]-c[m+1])>=v||Math.abs(u2[2]-c[m+2])>=v)&&(n=!0)}m+=u,p.offset+=3}return g/=d,{update:n,averageGeometrySampledElevation:g}}function Oht(t){return!!t&&nA[t]!=null}function JOe(t){return 1/(nA[t]||1)}function Rht(){const t=Object.keys(nA);return t.sort(),t}const $ht=Rht(),Iht=()=>ie.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Lht(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function A9t(t){const e=t==null?void 0:t.expression;if(typeof e=="string"){const i=eRe(e);if(i!=null)return{cachedResult:i}}return null}async function P9t(t,e,i,r){const s=t==null?void 0:t.expression;if(typeof s!="string")return null;const n=eRe(s);if(n!=null)return{cachedResult:n};const o=await z1();Et(i);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(r!=null&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function QOe(t,e,i){return t.arcadeUtils.createFeature(e.attributes,e.geometry,i)}function WG(t,e){if(t!=null&&!KOe(t)){if(!e||!t.arcade)return void Iht().errorOncePerTick("Arcade support required but not provided");const i=e;i._geometry&&(i._geometry=BOe(i._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function Dht(t){if(t!=null){if(KOe(t))return t.cachedResult;const e=t.arcade;let i=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof i!="number"&&(t.cachedResult=0,i=0),i}return 0}function O9t(t,e=!1){let i=t==null?void 0:t.featureExpressionInfo;const r=i==null?void 0:i.expression;return e||r==="0"||(i=null),i??null}const Nht={cachedResult:0};function KOe(t){return t.cachedResult!=null}function eRe(t){return t==="0"?0:null}let Hz=class tRe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=JOe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:e+r}calculateOffsetRenderUnits(e){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=Dht(r)*this._metersPerElevationInfoUnit),i/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=Oht(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,i,r){if(e==null)return void(this._featureExpressionInfoContext=null);const s=e==null?void 0:e.arcade;s&&i!=null&&r!=null?(this._featureExpressionInfoContext=Lht(e),WG(this._featureExpressionInfoContext,QOe(s.modules,i,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const i=new tRe;return e!=null&&i.setFromElevationInfo(e),i}},Fht=class{constructor(e,i,r){this.graphic=e,this.renderingInfo=i,this.layer=r}};function mre(t,e){if(t.type==="point")return C_(t,e,!1);if(VOe(t))switch(t.type){case"extent":return C_(t.center,e,!1);case"polygon":return C_(t.centroid,e,!1);case"polyline":return C_(Cde(t),e,!0);case"mesh":return C_(t.origin,e,!1)}else switch(t.type){case"extent":return C_(kht(t),e,!0);case"polygon":return C_(Uht(t),e,!0);case"polyline":return C_(Cde(t),e,!0)}}function Cde(t){const e=t.paths[0];if(!e||e.length===0)return null;const i=dwe(e,yee(e)/2);return nb(i[0],i[1],i[2],t.spatialReference)}function kht(t){return nb(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function Uht(t){const e=t.rings[0];if(!e||e.length===0)return null;const i=mwe(t.rings,!!t.hasZ);return nb(i[0],i[1],i[2],t.spatialReference)}function C_(t,e,i){const r=i?t:tht(t);return e&&t?ySe(t,r,e)?r:null:r}function $9t(t,e,i,r=0){if(t){e||(e=Ht());const s=t;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),ds(e,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),e}return null}function tI(t,e,i=null){const r=sL(Md);return t!=null&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),e!=null?r[3]=e:t!=null&&t.length>3&&(r[3]=t[3]),i&&(r[0]*=i,r[1]*=i,r[2]*=i,r[3]*=i),r}function I9t(t,e,i,r,s,n=[0,0,0,0]){for(let o=0;o<3;++o)n[o]=(t==null?void 0:t[o])!=null?t[o]:(i==null?void 0:i[o])!=null?i[o]:s[o];return n[3]=e??r??s[3],n}function Mde(t=s0,e,i,r=1){const s=new Array(3);if(e==null||i==null)s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const u=l!=null,d=a===0&&!n&&!u,p=i[a];l==="symbol-value"||d?c=p!==0?e[a]/p:1:u&&l!=="proportional"&&isFinite(l)&&(c=p!==0?l/p:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=r;return Ol(s)}function zht(t){return t.isPrimitive!=null}function YG(t){return vX(zht(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function vX(t){const e=i=>i==null||i>=0;return Array.isArray(t)?t.every(e):e(t)}function Vht(t,e,i,r=Ee()){return t&&UM(r,r,-t/180*Math.PI),e&&kM(r,r,e/180*Math.PI),i&&PB(r,r,i/180*Math.PI),r}function gre(t,e,i){if(i.minDemResolution!=null)return i.minDemResolution;const r=Gl(e),s=TT(t)*r,n=ET(t)*r,o=ub(t)*(e.isGeographic?1:r);return s===0&&n===0&&o===0?i.minDemResolutionForPoints:.01*Math.max(s,n,o)}var ch;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(ch||(ch={}));let Bht=class{constructor(e,i,r){this.baseMaterial=e,this.edgeMaterials=i,this.properties=r}},Bg=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,i,r,s,n,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const i=e.stage;i.addMany(this._uniqueMaterials),i.addMany(this._uniqueGeometries),i.add(this.stageObject)}destroy(){var i,r;if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),(i=e.renderer.edgeView)==null||i.removeObject(this.stageObject),this.stageObject.dispose(),(r=this._sharedResource)==null||r.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,i){const{stageObject:r,_edgeState:s,_stageLayer:n}=this;if(s==null)return;const o=Ade(s.baseMaterial);let a=!1;for(const l of s.edgeMaterials)l.objectTransparency!==o&&(l.objectTransparency=o,a=!0);a&&this.resetEdgeObject(i),n.stage.renderer.withEdgeView(l=>{l.updateAllComponentOpacities(r,[e])})}slicePlaneEnabledChanged(e,i){const{stageObject:r,_edgeState:s,_stageLayer:n}=this;s!=null&&n.stage.renderer.withEdgeView(o=>{o.updateAllComponentMaterials(r,s.edgeMaterials,{hasSlicePlane:e},!i),s.properties.hasSlicePlane=e})}setVisibility(e){const{_edgeState:i,stageObject:r,_stageLayer:s}=this;s!=null&&this.visible!==e&&(this._visible=e,r.visible=e,e&&!this._addedToStage&&(s.add(r),this._addedToStage=!0),i!=null&&s.stage.renderer.withEdgeView(n=>{n.hasObject(r)?n.updateObjectVisibility(r,e):e&&this._addOrUpdateEdgeObject(i,n,!1)}))}get visible(){return this._visible}alignWithElevation(e,i,r,s){if(this.elevationAligner==null)return;r!=null&&WG(this.elevationContext.featureExpressionInfoContext,r);const n=(o,a)=>W1(o,e,this.elevationContext,i,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,i),this.resetEdgeObject(s)}alignWithAbsoluteElevation(e,i,r){const s=(n,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,i),this.resetEdgeObject(r)}getCenterObjectSpace(e=E()){return ce(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=Jn()){const i=this.stageObject.boundingVolumeObjectSpace;return rCe(e,i.min),sCe(e,i.max),e}computeAttachmentOrigin(e){const i=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=i[12],e.render.origin[1]+=i[13],e.render.origin[2]+=i[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(Kg)&&(He(Kg,Kg,i),me(e.render.origin,e.render.origin,Kg),e.render.num++)}async getProjectedBoundingBox(e,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=Ght,l=qte(o)?1:a.length;for(let u=0;u<l;u++){const d=a[u];M_[0]=o[d[0]],M_[1]=o[d[1]],M_[2]=o[d[2]],He(M_,M_,this.stageObject.transformation),Gb[3*u]=M_[0],Gb[3*u+1]=M_[1],Gb[3*u+2]=M_[2]}if(!e(Gb,0,l))return null;Br(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],Gb[u+d]),o[d+3]=Math.max(o[d+3],Gb[u+d]);c&&r.push({location:Gb.slice(u,u+3),screenSpaceBoundingRect:c})}if(i!=null&&i.service&&this.elevationContext.mode!=="absolute-height"){of(o,Kg);const u=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let d=0;if(i.useViewElevation)d=i.service.getElevation(Kg[0],Kg[1],u)??0;else try{const p=gre(o,i.service.spatialReference,i);d=await i.service.queryElevation(Kg[0],Kg[1],s,p,u)??0}catch{}iCe(o,0,0,-this.alignedSampledElevation+d)}return o}addObjectState(e,i){e===A0.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),e===A0.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){const{_edgeState:i,stageObject:r,_stageLayer:s,_visible:n}=this;i!=null&&s.stage.renderer.withEdgeView(o=>{n?this._addOrUpdateEdgeObject(i,o,e):o.removeObject(r)})}_addOrUpdateEdgeObject(e,i,r){const s=Ade(e.baseMaterial);for(const n of e.edgeMaterials)n.objectTransparency=s;i.addOrUpdateObject3D(this.stageObject,e.edgeMaterials,e.properties,!r).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}};function Ade(t){return t.isVisible()?t.parameters.transparent?ch.TRANSPARENT:ch.OPAQUE:ch.INVISIBLE}const Gb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],M_=E(),Kg=E(),Ght=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let iRe=class{constructor(e,i=null){this.labelText=i,this.elevationOffset=e??0}};const rRe=3,bX=3,sRe=10;let nRe=class{constructor(e,i=null){this.geometry=e,this.textures=i}},oRe=class{constructor(e,i,r){this.components=e,this.minScreenSpaceRadius=i,this.pivotOffset=r;const s=this.geometries;this.numVertices=s.reduce((n,o)=>n+o.attributes.get(R.POSITION).indices.length,0)}get geometries(){return GV(this.components.map(e=>e.geometry))}},aRe=class{constructor(e){this.levels=e,this.levels.sort((i,r)=>i.minScreenSpaceRadius===r.minScreenSpaceRadius?i.numVertices-r.numVertices:i.minScreenSpaceRadius-r.minScreenSpaceRadius)}};function kN(t){const e=[];return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry.material))),GV(e)}function Pde(t){const e=new Array;return t.levels.forEach(i=>i.components.forEach(r=>{r.textures!=null&&e.push(...r.textures)})),GV(e)}function Ode(t){const e=new Array;return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry))),GV(e)}function jht(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function lRe(t,e){const i=(r,s,n=!1)=>new aRe(r.map(o=>{const a=s(o.tesselation);return n&&unt(a),new oRe([new nRe(a)],o.minScreenSpaceRadius)}));switch(t){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>ont(e,.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Jst(e,1));case"cone":return i(q8,r=>Xue(e,1,.5,r,!1),!0);case"inverted-cone":return i(q8,r=>Xue(e,1,.5,r,!0),!0);case"cylinder":return i(q8,r=>lnt(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>nnt(e,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>tnt(e,1),!0);default:return}}const q8=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let yd=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new cRe}},yre=class extends yd{constructor(e){super(e),this.estimated=!0}},Hht=class extends yd{constructor(e,i){super(i),this.numComplexities=e}},qht=class extends yre{constructor(e,i){super(i),this.numComplexities=e}},cRe=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};function Wht(t){return t.type==="fill"}function Yht(t){return t.type==="extrude"}function _re(t,e,i=0){const r=Te(t,0,Jht);for(let s=0;s<4;s++)e[i+s]=Math.floor(256*Qht(r*Zht[s]))}function vre(t,e=0){let i=0;for(let r=0;r<4;r++)i+=t[e+r]*Xht[r];return i}const Zht=[1,256,65536,16777216],Xht=[1/256,1/65536,1/16777216,1/4294967296],Jht=vre(new Uint8ClampedArray([255,255,255,255]));function Qht(t){return t-Math.floor(t)}var yn;function uRe(t){switch(t){case"multiply":default:return yn.Multiply;case"ignore":return yn.Ignore;case"replace":return yn.Replace;case"tint":return yn.Tint}}function hRe(t,e,i){if(t==null||e===yn.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=Te(Math.round(t[3]*qz),0,qz),s=r===0||e===yn.Tint?0:e===yn.Replace?Kht:edt;i[0]=Te(Math.round(t[0]*h2),0,h2),i[1]=Te(Math.round(t[1]*h2),0,h2),i[2]=Te(Math.round(t[2]*h2),0,h2),i[3]=r+s}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(yn||(yn={}));const h2=255,qz=85,Kht=qz,edt=2*qz;function dRe(t){t.vertex.code.add(S`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${S.int(yn.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${S.int(yn.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${S.int(yn.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${S.int(yn.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}let Wz=class extends Fs{constructor(e,i){super(e,"vec4",Hi.Draw,(r,s,n)=>r.setUniform4fv(e,i(s,n)))}},tdt=class extends Fs{constructor(e,i){super(e,"int",Hi.Draw,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};var gg;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(gg||(gg={}));const bre=429496.7296;function idt(t,e){_re(t/bre*.5+.5,e)}function rdt(t,e){switch(e.componentData){case gg.Varying:return sdt(t,e);case gg.Uniform:return ndt(t,e);case gg.COUNT:return;default:e.componentData}}function sdt(t,e){const{vertex:i,fragment:r}=t;i.include(Uf),i.uniforms.add(new dg("componentColorTex",n=>n.componentParameters.texture.texture)),t.attributes.add(R.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const s=e.output===G.ObjectAndLayerIdColor;s&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(dRe),i.constants.add("elevationScale","float",2*bre),i.constants.add("stride","float",re("enable-feature:objectAndLayerId-rendering")?3:2),i.code.add(S`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),i.code.add(S`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?S`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:S`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(S`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?S`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function ndt(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new Wz("externalColor",n=>n.componentParameters.externalColor)),r.uniforms.add(new tdt("externalColorMixMode",n=>n.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),i.code.add(S`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const s=e.output===G.ObjectAndLayerIdColor;r.code.add(S`
  void readExternalColor(out vec4 color, out int colorMixMode) {
    color = vExternalColor;
    colorMixMode = externalColorMixMode;
  }

  void outputObjectAndLayerIdColor() {
    ${s?S`fragColor = vec4(0,0,0,0);`:""}
 }
`)}function QA(t,e){switch(e.normalType){case Ki.Compressed:t.attributes.add(R.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(S`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case Ki.Attribute:t.attributes.add(R.NORMAL,"vec3"),t.vertex.code.add(S`vec3 normalModel() {
return normal;
}`);break;case Ki.ScreenDerivative:t.fragment.code.add(S`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case Ki.COUNT:case Ki.Ground:}}var Ki;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(Ki||(Ki={}));function W9t(t,e){const i=t.vertex;i.include(Uf),t.include(QA,e),i.uniforms.add(new qe("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(S`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(new dg("componentDataTex",r=>r.componentDataTexture)),t.attributes.add(R.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("verticalOffsetScale","float",2*bre),i.code.add(S`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
      vec3 normal = normalModel();
      vec3 normal2 = ${e.silhouette?S`decompressNormal(normal2Compressed)`:S`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),e.legacy?i.code.add(S`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new Sz("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(S`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(R.NORMAL2COMPRESSED,"vec2"),i.code.add(S`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):i.code.add(S`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`),e.legacy?i.code.add(S`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(wie,e),i.uniforms.add(new Jd("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new Sz("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Sh("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new Sh("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Vt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Vt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)),i.code.add(S`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?S`normalize(transformWorldFromModelTL + rotatedModelPosition);`:S`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new ss("transformProjFromView",(r,s)=>s.camera.projectionMatrix)),i.code.add(S`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(S`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function Y9t(t){return t===uA.Sketch||t===uA.Mixed}var uA,Rde;(function(t){t[t.Solid=0]="Solid",t[t.Sketch=1]="Sketch",t[t.Mixed=2]="Mixed",t[t.COUNT=3]="COUNT"})(uA||(uA={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(Rde||(Rde={}));function odt(t){return t&&t.enabled&&(Yht(t)||Wht(t))&&t.edges!=null}function adt(t){return t&&t.enabled&&t.edges||null}function pRe(t,e){return fRe(adt(t),e)}function fRe(t,e){if(t==null)return null;const i=t.color!=null?HI(Oe.toUnitRGBA(t.color)):Wt(0,0,0,0),r=_n(t.size),s=_n(t.extensionLength);switch(t.type){case"solid":return mRe({color:i,size:r,extensionLength:s,...e});case"sketch":return ldt({color:i,size:r,extensionLength:s,...e});default:return}}function mRe(t){return{...cdt,...t,type:uA.Solid}}function ldt(t){return{...udt,...t,type:uA.Sketch}}const cdt={color:Wt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:ch.OPAQUE,hasSlicePlane:!1},udt={color:Wt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:ch.OPAQUE,hasSlicePlane:!1};function gRe(t,e){const i=t.fragment;switch(i.code.add(S`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case xs.None:i.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case xs.View:i.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case xs.WindingOrder:i.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case xs.COUNT:}}var xs;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(xs||(xs={}));let AL=class{constructor(e=!1,i=!0){this.isVerticalRay=e,this.normalRequired=i}};const UN=Jn();function yRe(t,e,i,r,s,n){if(!t.visible)return;const o=Ai(xRe,r,i),a=(c,u,d)=>{n(c,d,u,!1)},l=new AL(!1,e.options.normalRequired);if(t.boundingInfo){ft(t.type===Ls.Mesh);const c=e.tolerance;_Re(t.boundingInfo,i,o,c,s,l,a)}else{const c=t.attributes.get(R.POSITION),u=c.indices;wRe(i,o,0,u.length/3,u,c.data,c.stride,s,l,a)}}const hdt=E();function _Re(t,e,i,r,s,n,o){if(t==null)return;const a=vdt(i,hdt);if(rCe(UN,t.bbMin),sCe(UN,t.bbMax),s!=null&&s.applyToAabb(UN),xre(UN,e,a,r)){const{primitiveIndices:l,position:c}=t,u=l?l.length:c.indices.length/3;if(u>bdt){const d=t.getChildren();if(d!==void 0){for(const p of d)_Re(p,e,i,r,s,n,o);return}}pdt(e,i,0,u,c.indices,c.data,c.stride,l,s,n,o)}}const Xx=E();function vRe(t,e,i,r,s,n,o,a,l){const{data:c,stride:u}=n;wRe(t,Ai(xRe,e,t),i,r,s,c,u,o,a,l)}function bRe(t,e,i,r,s,n,o,a,l,c=null,u=0){const d=t[0],p=t[1],m=t[2],g=e[0],y=e[1],v=e[2];for(let b=i;b<r;++b){const w=u+(c?c[b]:b),x=3*w,T=o*s[x],C=n[T],M=n[T+1],O=n[T+2],D=o*s[x+1],k=n[D],U=n[D+1],H=n[D+2],z=o*s[x+2],Z=k-C,q=U-M,Y=H-O,de=n[z]-C,L=n[z+1]-M,F=n[z+2]-O,j=y*F-L*v,W=v*de-F*g,X=g*L-de*y,K=Z*j+q*W+Y*X;if(Math.abs(K)<=Tre)continue;const te=d-C,he=p-M,we=m-O,De=te*j+he*W+we*X;if(K>0){if(De<0||De>K)continue}else if(De>0||De<K)continue;const at=he*Y-q*we,et=we*Z-Y*te,Ke=te*q-Z*he,Je=g*at+y*et+v*Ke;if(K>0){if(Je<0||De+Je>K)continue}else if(Je>0||De+Je<K)continue;const Xe=(de*at+L*et+F*Ke)/K;Xe>=0&&l(Xe,w,a?wre(Z,q,Y,de,L,F,Xx):null)}}function ddt(t,e,i,r,s,n,o,a,l,c,u,d=null,p=0){const m=t[0],g=t[1],y=t[2],v=e[0],b=e[1],w=e[2];for(let x=i;x<r;++x){const T=p+(d?d[x]:x),C=3*T,M=o*s[C],O=n[M],D=n[M+1],k=n[M+2],U=o*s[C+1],H=n[U],z=n[U+1],Z=n[U+2],q=o*s[C+2],Y=n[q],de=n[q+1],L=n[q+2],F=k-l,j=a/Math.sqrt(O*O+D*D+F*F),W=O+O*j,X=D+D*j,K=k+F*j,te=Z-l,he=a/Math.sqrt(H*H+z*z+te*te),we=H+H*he,De=z+z*he,at=Z+te*he,et=L-l,Ke=a/Math.sqrt(Y*Y+de*de+et*et),Je=we-W,Xe=De-X,si=at-K,ei=Y+Y*Ke-W,Gi=de+de*Ke-X,Ue=L+et*Ke-K,ui=b*Ue-Gi*w,ke=w*ei-Ue*v,Ze=v*Gi-ei*b,bt=Je*ui+Xe*ke+si*Ze;if(Math.abs(bt)<=Tre)continue;const kt=m-W,Qe=g-X,Pt=y-K,Ne=kt*ui+Qe*ke+Pt*Ze;if(bt>0){if(Ne<0||Ne>bt)continue}else if(Ne>0||Ne<bt)continue;const rt=Qe*si-Xe*Pt,Ot=Pt*Je-si*kt,nr=kt*Xe-Je*Qe,xi=v*rt+b*Ot+w*nr;if(bt>0){if(xi<0||Ne+xi>bt)continue}else if(xi>0||Ne+xi<bt)continue;const xr=(ei*rt+Gi*Ot+Ue*nr)/bt;xr>=0&&u(xr,T,c?wre(Je,Xe,si,ei,Gi,Ue,Xx):null)}}function pdt(t,e,i,r,s,n,o,a,l,c,u){const d=t[0],p=t[1],m=t[2],g=e[0],y=e[1],v=e[2],{normalRequired:b}=c;for(let w=i;w<r;++w){const x=a[w],T=3*x,C=o*s[T];let M=n[C],O=n[C+1],D=n[C+2];const k=o*s[T+1];let U=n[k],H=n[k+1],z=n[k+2];const Z=o*s[T+2];let q=n[Z],Y=n[Z+1],de=n[Z+2];l!=null&&([M,O,D]=l.applyToVertex(M,O,D,w),[U,H,z]=l.applyToVertex(U,H,z,w),[q,Y,de]=l.applyToVertex(q,Y,de,w));const L=U-M,F=H-O,j=z-D,W=q-M,X=Y-O,K=de-D,te=y*K-X*v,he=v*W-K*g,we=g*X-W*y,De=L*te+F*he+j*we;if(Math.abs(De)<=Tre)continue;const at=d-M,et=p-O,Ke=m-D,Je=at*te+et*he+Ke*we;if(De>0){if(Je<0||Je>De)continue}else if(Je>0||Je<De)continue;const Xe=et*j-F*Ke,si=Ke*L-j*at,ei=at*F-L*et,Gi=g*Xe+y*si+v*ei;if(De>0){if(Gi<0||Je+Gi>De)continue}else if(Gi>0||Je+Gi<De)continue;const Ue=(W*Xe+X*si+K*ei)/De;Ue>=0&&u(Ue,x,b?wre(L,F,j,W,X,K,Xx):null)}}function wRe(t,e,i,r,s,n,o,a,l,c){const u=e,d=wdt,p=Math.abs(u[0]),m=Math.abs(u[1]),g=Math.abs(u[2]),y=p>=m?p>=g?0:2:m>=g?1:2,v=y,b=u[v]<0?2:1,w=(y+b)%3,x=(y+(3-b))%3,T=u[w]/u[v],C=u[x]/u[v],M=1/u[v],O=fdt,D=mdt,k=gdt,{normalRequired:U}=l;for(let H=i;H<r;++H){const z=3*H,Z=o*s[z];ne(d[0],n[Z+0],n[Z+1],n[Z+2]);const q=o*s[z+1];ne(d[1],n[q+0],n[q+1],n[q+2]);const Y=o*s[z+2];ne(d[2],n[Y+0],n[Y+1],n[Y+2]),a&&(ce(d[0],a.applyToVertex(d[0][0],d[0][1],d[0][2],H)),ce(d[1],a.applyToVertex(d[1][0],d[1][1],d[1][2],H)),ce(d[2],a.applyToVertex(d[2][0],d[2][1],d[2][2],H))),Ai(O,d[0],t),Ai(D,d[1],t),Ai(k,d[2],t);const de=O[w]-T*O[v],L=O[x]-C*O[v],F=D[w]-T*D[v],j=D[x]-C*D[v],W=k[w]-T*k[v],X=k[x]-C*k[v],K=W*j-X*F,te=de*X-L*W,he=F*L-j*de;if((K<0||te<0||he<0)&&(K>0||te>0||he>0))continue;const we=K+te+he;if(we===0)continue;const De=K*(M*O[v])+te*(M*D[v])+he*(M*k[v]);if(De*Math.sign(we)<0)continue;const at=De/we;at>=0&&c(at,H,U?ydt(d):null)}}const fdt=E(),mdt=E(),gdt=E();function wre(t,e,i,r,s,n,o){return ne(Yz,t,e,i),ne(Zz,r,s,n),ot(o,Yz,Zz),ge(o,o),o}function ydt(t){return Ai(Yz,t[1],t[0]),Ai(Zz,t[2],t[0]),ot(Xx,Yz,Zz),ge(Xx,Xx),Xx}const Yz=E(),Zz=E();function _dt(t,e,i){return ne(i,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function vdt(t,e){return ne(e,1/t[0],1/t[1],1/t[2])}function xre(t,e,i,r){return Sre(t,e,i,r,1/0)}function Sre(t,e,i,r,s){const n=(t[0]-r-e[0])*i[0],o=(t[3]+r-e[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(t[1]-r-e[1])*i[1],u=(t[4]+r-e[1])*i[1];if(l=Math.min(l,Math.max(c,u)),l<0||(a=Math.max(a,Math.min(c,u)),a>l))return!1;const d=(t[2]-r-e[2])*i[2],p=(t[5]+r-e[2])*i[2];return l=Math.min(l,Math.max(d,p)),!(l<0)&&(a=Math.max(a,Math.min(d,p)),!(a>l)&&a<s)}const bdt=1e3,Tre=1e-7,xRe=E(),wdt=[E(),E(),E()];let KA=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.attributes.get(R.POSITION).indices.length}write(e,i,r,s,n){COe(r,this.vertexBufferLayout,e,i,s,n)}};function ZG(t,e){switch(e.normalType){case Ki.Attribute:case Ki.Compressed:t.include(QA,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new Sz("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new Jd("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),t.vertex.code.add(S`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case Ki.Ground:t.include(QC,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(S`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?S`normalize(vPositionWorldCameraRelative);`:S`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case Ki.ScreenDerivative:t.vertex.code.add(S`void forwardNormal() {}`);break;default:e.normalType;case Ki.COUNT:}}let SRe=class extends Mst{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Gr()}},TRe=class extends Ast{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Gr(),this.toMapSpace=Qt()}};const Ere={func:fr.LESS},Xz={func:fr.ALWAYS},Mg={mask:255},ERe={mask:0},xdt=t=>({function:{func:fr.NOTEQUAL,ref:t,mask:t},operation:{fail:fs.KEEP,zFail:fs.KEEP,zPass:fs.KEEP}}),Sdt=t=>({function:{func:fr.ALWAYS,ref:t,mask:t},operation:{fail:fs.KEEP,zFail:fs.KEEP,zPass:fs.REPLACE}}),_b={function:{func:fr.ALWAYS,ref:Tc.OutlineVisualElementMask,mask:Tc.OutlineVisualElementMask},operation:{fail:fs.KEEP,zFail:fs.KEEP,zPass:fs.ZERO}},Z1={function:{func:fr.ALWAYS,ref:Tc.OutlineVisualElementMask,mask:Tc.OutlineVisualElementMask},operation:{fail:fs.KEEP,zFail:fs.KEEP,zPass:fs.REPLACE}},CRe={function:{func:fr.EQUAL,ref:Tc.OutlineVisualElementMask,mask:Tc.OutlineVisualElementMask},operation:{fail:fs.KEEP,zFail:fs.KEEP,zPass:fs.KEEP}},MRe={function:{func:fr.NOTEQUAL,ref:Tc.OutlineVisualElementMask,mask:Tc.OutlineVisualElementMask},operation:{fail:fs.KEEP,zFail:fs.KEEP,zPass:fs.KEEP}};function ARe({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||Oo(n,$n))&&o==null&&(r==null||r===1)&&(i==null||i===1)}function K9t({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||Oo(n,$n))&&o==null&&(r==null||r===1)&&(i==null||i===1||i===0)}const XG=[1,1,.5],Cre=[0,.6,.2],Tdt=[0,1,.2];function PRe(t){t.vertex.code.add(S`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let eP=class extends Fs{constructor(e,i){super(e,"int",Hi.Pass,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};function ORe(t,e){e.hasSymbolColors?(t.include(dRe),t.attributes.add(R.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(S`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new eP("colorMixMode",i=>bOe[i.colorMixMode])),t.vertex.code.add(S`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function DT(t,e){e.hasVertexColors?(t.attributes.add(R.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(S`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(S`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(S`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function Mre(t){t.code.add(S`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}function JG(t,e){switch(e.output){case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:case G.ViewshedShadow:t.fragment.include(Mre),t.fragment.code.add(S`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`)}}function Edt(t){t.fragment.code.add(S`
    #define discardOrAdjustAlpha(color) { if (color.a < ${S.float(Xo)}) { discard; } }
  `)}let RRe=class extends Fs{constructor(e,i){super(e,"float",Hi.Draw,(r,s,n)=>r.setUniform1f(e,i(s,n)))}};function dC(t,e){$Re(t,e,new qe("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function Cdt(t,e){$Re(t,e,new RRe("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function $Re(t,e,i){const r=t.fragment;switch(e.alphaDiscardMode!==Cr.Mask&&e.alphaDiscardMode!==Cr.MaskBlend||r.uniforms.add(i),e.alphaDiscardMode){case Cr.Blend:return t.include(Edt);case Cr.Opaque:r.code.add(S`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Cr.Mask:r.code.add(S`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Cr.MaskBlend:t.fragment.code.add(S`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function IRe(t,e){const{vertex:i,fragment:r}=t,s=e.hasColorTexture&&e.alphaDiscardMode!==Cr.Opaque;switch(e.output){case G.Depth:bc(i,e),t.include(Ja,e),t.include(gn,e),t.include(lf,e),s&&r.uniforms.add(new mt("tex",n=>n.texture)),i.code.add(S`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(dC,e),r.code.add(S`
          void main(void) {
            discardBySlice(vpos);
            ${s?S`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
          }
        `);break;case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:case G.ViewshedShadow:case G.ObjectAndLayerIdColor:bc(i,e),t.include(Ja,e),t.include(lf,e),t.include(g0,e),t.include(JG,e),t.include(gn,e),t.include(LT,e),bG(t),t.varyings.add("depth","float"),s&&r.uniforms.add(new mt("tex",n=>n.texture)),i.code.add(S`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`),t.include(dC,e),r.code.add(S`
          void main(void) {
            discardBySlice(vpos);
            ${s?S`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===G.ObjectAndLayerIdColor?S`outputObjectAndLayerIdColor();`:S`outputDepth(depth);`}
          }
        `);break;case G.Normal:{bc(i,e),t.include(Ja,e),t.include(QA,e),t.include(ZG,e),t.include(lf,e),t.include(g0,e),s&&r.uniforms.add(new mt("tex",o=>o.texture)),e.normalType===Ki.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const n=e.normalType===Ki.Attribute||e.normalType===Ki.Compressed;i.code.add(S`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${n?S`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:S`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(gn,e),t.include(dC,e),r.code.add(S`
          void main() {
            discardBySlice(vpos);
            ${s?S`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===Ki.ScreenDerivative?S`vec3 normal = screenDerivativeNormal(vPositionView);`:S`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case G.Highlight:bc(i,e),t.include(Ja,e),t.include(lf,e),t.include(g0,e),s&&r.uniforms.add(new mt("tex",n=>n.texture)),i.code.add(S`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(gn,e),t.include(dC,e),t.include(gb,e),r.code.add(S`
          void main() {
            discardBySlice(vpos);
            ${s?S`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function LRe(t,e){const i=t.fragment;e.hasVertexTangents?(t.attributes.add(R.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===xs.WindingOrder?i.code.add(S`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(S`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):i.code.add(S`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==ps.None&&(t.include(die,e),i.uniforms.add(e.pbrTextureBindType===Hi.Pass?new mt("normalTexture",r=>r.textureNormal):new dg("normalTexture",r=>r.textureNormal)),e.hasNormalTextureTransform&&(i.uniforms.add(new Fr("scale",r=>r.scale??IB)),i.uniforms.add(new Jd("normalTextureTransformMatrix",r=>r.normalTextureTransformMatrix??_T))),i.code.add(S`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),e.hasNormalTextureTransform&&i.code.add(S`mat3 normalTextureRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalTextureRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),i.code.add(S`return tangentSpace * rawNormal;
}`))}let gE=class extends Re{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces="composite-color",this._context=null,this._dirty=!0}initialize(){this.addHandles([ue(()=>this.view.ready,e=>{var i;e&&((i=this.view._stage)==null||i.renderer.addRenderNode(this))},cr)])}destroy(){var e,i;(i=(e=this.view._stage)==null?void 0:e.renderer)==null||i.removeRenderNode(this)}render(){throw new V("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view._stage.renderView.renderingContext.gl}acquireOutputFramebuffer(){var r,s,n;const e=(s=(r=this._frameBuffer)==null?void 0:r.getTexture())==null?void 0:s.descriptor,i=this.view._stage.renderer.fboCache.acquire((e==null?void 0:e.width)??640,(e==null?void 0:e.height)??480,this.produces);return(n=i.fbo)==null||n.initializeAndBind(),i}bindRenderTarget(){var e,i;return(i=(e=this._frameBuffer)==null?void 0:e.fbo)==null||i.initializeAndBind(),this._frameBuffer}requestRender(e){var i;e===tr.UPDATE&&((i=this.view._stage)==null||i.renderView.requestRender(e)),this._dirty=!0}resetWebGLState(){var e;this.renderingContext.resetState(),this.renderingContext.bindFramebuffer((e=this._frameBuffer)==null?void 0:e.fbo)}get fboCache(){return this.view._stage.renderer.fboCache}get bindParameters(){return this._context.bindParameters}get renderingContext(){return this.view._stage.renderView.renderingContext}updateAnimation(){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e,i){this._context=i,this._frameBuffer=e.find(({name:r})=>r===this.produces);try{return this.render(e)}finally{this._frameBuffer=null}}};h([f({constructOnly:!0})],gE.prototype,"view",void 0),h([f({constructOnly:!0})],gE.prototype,"consumes",void 0),h([f()],gE.prototype,"produces",void 0),gE=h([I("esri.views.3d.webgl.RenderNode")],gE);const PL=gE,DRe=3e5,Jz=5e5;let NRe=class extends Fs{constructor(e,i){super(e,"vec2",Hi.Draw,(r,s,n,o)=>r.setUniform2fv(e,i(s,n,o)))}};const W8=4;function FRe(){const t=new Vi,e=t.fragment;t.include(Oa);const i=(W8+1)/2,r=1/(2*i*i);return e.include(Ig),e.uniforms.add(new mt("depthMap",s=>s.depthTexture),new dg("tex",s=>s.colorTexture),new NRe("blurSize",s=>s.blurSize),new qe("projScale",(s,n)=>{const o=wr(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale})),e.code.add(S`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${S.float(r)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.outputs.add("fragBlur","float"),e.code.add(S`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${S.int(W8)}; r <= ${S.int(W8)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `),t}const Mdt=Object.freeze(Object.defineProperty({__proto__:null,build:FRe},Symbol.toStringTag,{value:"Module"}));let kRe=class URe extends Wi{initializeProgram(e){return new Yi(e.rctx,URe.shader.get().build(),wi)}initializePipeline(){return Gt({colorWrite:Kt})}};kRe.shader=new Bi(Mdt,()=>fe(()=>Promise.resolve().then(()=>pUt),void 0));const Adt="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";let Pdt=class extends $r{constructor(){super(...arguments),this.projScale=1}},Odt=class extends Pdt{constructor(){super(...arguments),this.intensity=1}},Rdt=class extends $r{},$dt=class extends Rdt{constructor(){super(...arguments),this.blurSize=lt()}};function OL(t){t.fragment.uniforms.add(new zi("projInfo",(e,i)=>Idt(i.camera))),t.fragment.uniforms.add(new Fr("zScale",(e,i)=>Ldt(i.camera))),t.fragment.code.add(S`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Idt(t){const e=t.projectionMatrix;return e[11]===0?ds($de,2/(t.fullWidth*e[0]),2/(t.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):ds($de,-2/(t.fullWidth*e[0]),-2/(t.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const $de=Qt();function Ldt(t){return t.projectionMatrix[11]===0?Pi(Ide,0,1):Pi(Ide,1,0)}const Ide=lt(),Lde=16;function zRe(){const t=new Vi,e=t.fragment;return t.include(Oa),t.include(OL),e.include(Ig),e.uniforms.add(new qe("radius",(i,r)=>QG(r.camera))).code.add(S`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(S`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new mt("normalMap",i=>i.normalTexture),new mt("depthMap",i=>i.depthTexture),new qe("projScale",i=>i.projScale),new mt("rnm",i=>i.noiseTexture),new Fr("rnmScale",(i,r)=>Pi(Dde,r.camera.fullWidth/i.noiseTexture.descriptor.width,r.camera.fullHeight/i.noiseTexture.descriptor.height)),new qe("intensity",i=>i.intensity),new Fr("screenSize",(i,r)=>Pi(Dde,r.camera.fullWidth,r.camera.fullHeight))),t.outputs.add("fragOcclusion","float"),e.code.add(S`
    void main(void) {
      float depth = depthFromTexture(depthMap, uv);

      // Early out if depth is out of range, such as in the sky
      if (depth >= 1.0 || depth <= 0.0) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      float currentPixelDepth = linearizeDepth(depth);
      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${S.int(Lde)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${S.int(Lde)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `),t}function QG(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const Dde=lt(),Ddt=Object.freeze(Object.defineProperty({__proto__:null,build:zRe,getRadius:QG},Symbol.toStringTag,{value:"Module"}));let VRe=class BRe extends Wi{initializeProgram(e){return new Yi(e.rctx,BRe.shader.get().build(),wi)}initializePipeline(){return Gt({colorWrite:Kt})}};VRe.shader=new Bi(Ddt,()=>fe(()=>Promise.resolve().then(()=>fUt),void 0));const xR=2;let Zw=class extends PL{constructor(e){super(e),this.consumes={required:["normals"]},this.produces="ssao",this.isEnabled=()=>!1,this._enableTime=0,this._passParameters=new Odt,this._drawParameters=new $dt}initialize(){const e=Uint8Array.from(atob(Adt),r=>r.charCodeAt(0)),i=new jr;i.wrapMode=bi.CLAMP_TO_EDGE,i.pixelFormat=Ft.RGB,i.wrapMode=bi.REPEAT,i.hasMipmap=!0,i.width=32,i.height=32,this._passParameters.noiseTexture=new br(this.renderingContext,i,e),this._ssaoTechnique=this.techniques.acquire(VRe),this._blurTechnique=this.techniques.acquire(kRe),this.addHandles(ue(()=>this.isEnabled(),()=>this._enableTime=0))}destroy(){this._passParameters.noiseTexture=It(this._passParameters.noiseTexture),this._blurTechnique.release(),this._ssaoTechnique.release()}render(e){const i=this.bindParameters,r=e.find(({name:C})=>C==="normals"),s=r==null?void 0:r.getTexture(),n=r==null?void 0:r.getTexture(eA),o=this.fboCache,a=i.camera,l=a.fullViewport[2],c=a.fullViewport[3],u=Math.round(l/xR),d=Math.round(c/xR);if(!this._ssaoTechnique.compiled||!this._blurTechnique.compiled)return this._enableTime=performance.now(),this.requestRender(),o.acquire(u,d,"ssao",Xr.RED);this._enableTime===0&&(this._enableTime=performance.now());const p=this.renderingContext,m=this.view.qualitySettings.fadeDuration,g=a.relativeElevation,y=Te((Jz-g)/(Jz-DRe),0,1),v=m>0?Math.min(m,performance.now()-this._enableTime)/m:1,b=v*y;this._passParameters.normalTexture=s,this._passParameters.depthTexture=n,this._passParameters.projScale=1/a.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*Ndt/QG(a)**6*b;const w=o.acquire(l,c,"ssao input",Xr.RG);p.unbindTexture(w.fbo.colorTexture),p.bindFramebuffer(w.fbo),p.setViewport(0,0,l,c),p.bindTechnique(this._ssaoTechnique,i,this._passParameters,this._drawParameters),p.screen.draw();const x=o.acquire(u,d,"ssao blur",Xr.RED);p.unbindTexture(x.fbo.colorTexture),p.bindFramebuffer(x.fbo),this._drawParameters.colorTexture=w.getTexture(),Pi(this._drawParameters.blurSize,0,xR/c),p.bindTechnique(this._blurTechnique,i,this._passParameters,this._drawParameters),p.setViewport(0,0,u,d),p.screen.draw(),w.release();const T=o.acquire(u,d,"ssao",Xr.RED);return p.unbindTexture(T.fbo.colorTexture),p.bindFramebuffer(T.fbo),p.setViewport(0,0,l,c),p.setClearColor(1,1,1,0),p.clear(Lr.COLOR_BUFFER_BIT),this._drawParameters.colorTexture=x.getTexture(),Pi(this._drawParameters.blurSize,xR/l,0),p.bindTechnique(this._blurTechnique,i,this._passParameters,this._drawParameters),p.setViewport(0,0,u,d),p.screen.draw(),p.setViewport4fv(a.fullViewport),x.release(),v<1&&this.requestRender(tr.UPDATE),T}};h([f()],Zw.prototype,"consumes",void 0),h([f()],Zw.prototype,"produces",void 0),h([f({constructOnly:!0})],Zw.prototype,"techniques",void 0),h([f({constructOnly:!0})],Zw.prototype,"isEnabled",void 0),Zw=h([I("esri.views.3d.webgl-engine.effects.ssao.SSAO")],Zw);const Ndt=.5;function RL(t,e){const i=t.fragment;e.receiveAmbientOcclusion?(i.uniforms.add(new mt("ssaoTex",(r,s)=>{var n;return(n=s.ssao)==null?void 0:n.getTexture()})),i.constants.add("blurSizePixelsInverse","float",1/xR),i.code.add(S`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):i.code.add(S`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function Fdt(t){const e=t.fragment.code;e.add(S`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(S`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(S`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function Are(t,e){const i=t.fragment.code;t.include(gL),e.pbrMode!==xt.Normal&&e.pbrMode!==xt.Schematic&&e.pbrMode!==xt.Simplified&&e.pbrMode!==xt.TerrainWithWater||(i.add(S`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(S`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==xt.Normal&&e.pbrMode!==xt.Schematic||(t.include(Fdt),i.add(S`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(S`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(S`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(S`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function kdt(t,e){const i=t.fragment.code;t.include(gL),i.add(S`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),i.add(S`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(S`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(S`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(S`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function $L(t){t.constants.add("ambientBoostFactor","float",wAe)}function tP(t){t.uniforms.add(new qe("lightingGlobalFactor",(e,i)=>i.lighting.globalFactor))}function rT(t,e){const i=t.fragment;switch(t.include(RL,e),e.pbrMode!==xt.Disabled&&t.include(Are,e),t.include(mie,e),t.include(gL),i.code.add(S`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===xt.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),$L(i),tP(i),G0(i),i.code.add(S`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?S`normalize(vPosWorld)`:S`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Lg(i),i.code.add(S`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case xt.Disabled:case xt.WaterOnIntegratedMesh:case xt.Water:t.include(gz),i.code.add(S`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case xt.Normal:case xt.Schematic:i.code.add(S`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(S`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?i.uniforms.add(new pg("hasFillLights",(r,s)=>s.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(S`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add(new qe("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new qe("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)),i.code.add(S`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(S`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode!==xt.Schematic||e.hasColorTexture?S`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:S`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case xt.Simplified:case xt.TerrainWithWater:t.include(gz),i.code.add(S`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case xt.COUNT:}}let Udt=class extends Fs{constructor(e,i,r){super(e,"mat4",Hi.Draw,(s,n,o,a)=>s.setUniformMatrix4fv(e,i(n,o,a)),r)}},wX=class extends Fs{constructor(e,i,r){super(e,"mat4",Hi.Pass,(s,n,o)=>s.setUniformMatrix4fv(e,i(n,o)),r)}},zdt=class extends $r{constructor(){super(...arguments),this.modelTransformation=Vr}},Pre=class extends zdt{constructor(){super(...arguments),this.origin=E()}};function IL(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new wX("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),GRe(t))}function hA(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new Udt("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),GRe(t))}function GRe(t){const e=t.fragment;e.include(Mre),e.uniforms.add(new mt("shadowMap",(i,r)=>r.shadowMap.depthTexture),new eP("numCascades",(i,r)=>r.shadowMap.numCascades),new zi("cascadeDistances",(i,r)=>r.shadowMap.cascadeDistances)),e.code.add(S`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}function Vdt(t,e){e.hasColorTextureTransform?(t.vertex.uniforms.add(new Jd("colorTextureTransformMatrix",i=>i.colorTextureTransformMatrix??_T)),t.varyings.add("colorUV","vec2"),t.vertex.code.add(S`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(S`void forwardColorUV(){}`)}function Bdt(t,e){e.hasNormalTextureTransform&&e.textureCoordinateType!==ps.None?(t.vertex.uniforms.add(new Jd("normalTextureTransformMatrix",i=>i.normalTextureTransformMatrix??_T)),t.varyings.add("normalUV","vec2"),t.vertex.code.add(S`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(S`void forwardNormalUV(){}`)}function Gdt(t,e){e.hasEmissionTextureTransform&&e.textureCoordinateType!==ps.None?(t.vertex.uniforms.add(new Jd("emissiveTextureTransformMatrix",i=>i.emissiveTextureTransformMatrix??_T)),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(S`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(S`void forwardEmissiveUV(){}`)}function jdt(t,e){e.hasOcclusionTextureTransform&&e.textureCoordinateType!==ps.None?(t.vertex.uniforms.add(new Jd("occlusionTextureTransformMatrix",i=>i.occlusionTextureTransformMatrix??_T)),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(S`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(S`void forwardOcclusionUV(){}`)}function Hdt(t,e){e.hasMetallicRoughnessTextureTransform&&e.textureCoordinateType!==ps.None?(t.vertex.uniforms.add(new Jd("metallicRoughnessTextureTransformMatrix",i=>i.metallicRoughnessTextureTransformMatrix??_T)),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(S`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(S`void forwardMetallicRoughnessUV(){}`)}function Ore(t){t.include(Ug),t.code.add(S`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${S.int(yn.Multiply)}) {
        return allMixed;
      }
      if (mode == ${S.int(yn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${S.int(yn.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${S.int(yn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${S.int(yn.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function jRe(t){const e=new Vi,{vertex:i,fragment:r,varyings:s}=e;if(bc(i,t),e.include(yL),s.add("vpos","vec3"),e.include(g0,t),e.include(AAe,t),e.include(fOe,t),e.include(Vdt,t),t.output===G.Color){e.include(Bdt,t),e.include(Gdt,t),e.include(jdt,t),e.include(Hdt,t),Rf(i,t),e.include(QA,t),e.include(Ja,t);const n=t.normalType===Ki.Attribute||t.normalType===Ki.Compressed;n&&t.offsetBackfaces&&e.include(PRe),e.include(LRe,t),e.include(ZG,t),t.instancedColor&&e.attributes.add(R.INSTANCECOLOR,"vec4"),s.add("vPositionLocal","vec3"),e.include(lf,t),e.include(ZA,t),e.include(ORe,t),e.include(DT,t),i.uniforms.add(new zi("externalColor",o=>o.externalColor)),s.add("vcolorExt","vec4"),t.multipassEnabled&&s.add("depth","float"),i.code.add(S`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${S.float(Xo)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${n?S`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${n&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        forwardColorUV();
        forwardNormalUV();
        forwardEmissiveUV();
        forwardOcclusionUV();
        forwardMetallicRoughnessUV();
      }
    `),e.include(gn,t),e.include(rT,t),e.include(RL,t),e.include(dC,t),e.include(t.instancedDoublePrecision?IL:hA,t),e.include(Vg,t),Rf(r,t),r.uniforms.add(i.uniforms.get("localOrigin"),new Vt("ambient",o=>o.ambient),new Vt("diffuse",o=>o.diffuse),new qe("opacity",o=>o.opacity),new qe("layerOpacity",o=>o.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new mt("tex",o=>o.texture)),e.include(fie,t),e.include(Are,t),r.include(Ore),e.include(gRe,t),$L(r),tP(r),Lg(r),t.transparencyPassType===nt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),r.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?S`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===Ki.ScreenDerivative?S`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:S`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===xt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?S`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?S`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?S`normalUV`:"vuv0"});`:S`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?S`normalize(posWorld);`:S`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?S`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===xt.Normal||t.pbrMode===xt.Schematic?S`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?S`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:S`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===nt.ColorAlpha?S`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}
      }
    `)}return e.include(IRe,t),e}const qdt=Object.freeze(Object.defineProperty({__proto__:null,build:jRe},Symbol.toStringTag,{value:"Module"}));let Wdt=class extends SRe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Ol(XG),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Nr.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=$e(0,0,0),this.instancedDoublePrecision=!1,this.normalType=Ki.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=$e(.2,.2,.2),this.diffuse=$e(.8,.8,.8),this.externalColor=Wt(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=E(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=KS.Less,this.textureAlphaMode=Cr.Blend,this.textureAlphaCutoff=Gz,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Ji.Occlude,this.isDecoration=!1}},Ydt=class extends TRe{constructor(){super(...arguments),this.origin=E(),this.slicePlaneLocalOrigin=this.origin}},Rre=class HRe extends Wi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Ge.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,i.textureCoordinateType=i.hasColorTexture||i.hasMetallicRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?ps.Default:ps.None,i.objectAndLayerIdColorInstanced=i.instanced}initializeProgram(e){return this._initializeProgram(e,HRe.shader)}_initializeProgram(e,i){return new Yi(e.rctx,i.get().build(this.configuration),wi)}_makePipeline(e,i){const r=this.configuration,s=e===nt.NONE,n=e===nt.FrontFace;return Gt({blending:r.output===G.Color&&r.transparent?s?gu:Z0(e):null,culling:Xdt(r)?yG(r.cullFace):null,depthTest:{func:yb(e,Zdt(r.customDepthTest))},depthWrite:(s||n)&&r.writeDepth?Tu:null,drawBuffers:r.output===G.Depth?{buffers:[ao.NONE]}:X0(e),colorWrite:Kt,stencilWrite:r.hasOccludees?Mg:null,stencilTest:r.hasOccludees?i?Z1:_b:null,polygonOffset:s||n?null:HG(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function Zdt(t){return t===KS.Lequal?fr.LEQUAL:fr.LESS}function Xdt(t){return t.cullFace!==Nr.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}Rre.shader=new Bi(qdt,()=>fe(()=>Promise.resolve().then(()=>mUt),void 0));let Xt=class extends Ec{constructor(){super(...arguments),this.output=G.Color,this.alphaDiscardMode=Cr.Opaque,this.doubleSidedMode=xs.None,this.pbrMode=xt.Disabled,this.cullFace=Nr.None,this.transparencyPassType=nt.NONE,this.normalType=Ki.Attribute,this.textureCoordinateType=ps.None,this.customDepthTest=KS.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};h([B({count:G.COUNT})],Xt.prototype,"output",void 0),h([B({count:Cr.COUNT})],Xt.prototype,"alphaDiscardMode",void 0),h([B({count:xs.COUNT})],Xt.prototype,"doubleSidedMode",void 0),h([B({count:xt.COUNT})],Xt.prototype,"pbrMode",void 0),h([B({count:Nr.COUNT})],Xt.prototype,"cullFace",void 0),h([B({count:nt.COUNT})],Xt.prototype,"transparencyPassType",void 0),h([B({count:Ki.COUNT})],Xt.prototype,"normalType",void 0),h([B({count:ps.COUNT})],Xt.prototype,"textureCoordinateType",void 0),h([B({count:KS.COUNT})],Xt.prototype,"customDepthTest",void 0),h([B()],Xt.prototype,"spherical",void 0),h([B()],Xt.prototype,"hasVertexColors",void 0),h([B()],Xt.prototype,"hasSymbolColors",void 0),h([B()],Xt.prototype,"hasVerticalOffset",void 0),h([B()],Xt.prototype,"hasSlicePlane",void 0),h([B()],Xt.prototype,"hasSliceHighlight",void 0),h([B()],Xt.prototype,"hasColorTexture",void 0),h([B()],Xt.prototype,"hasMetallicRoughnessTexture",void 0),h([B()],Xt.prototype,"hasEmissionTexture",void 0),h([B()],Xt.prototype,"hasOcclusionTexture",void 0),h([B()],Xt.prototype,"hasNormalTexture",void 0),h([B()],Xt.prototype,"hasScreenSizePerspective",void 0),h([B()],Xt.prototype,"hasVertexTangents",void 0),h([B()],Xt.prototype,"hasOccludees",void 0),h([B()],Xt.prototype,"multipassEnabled",void 0),h([B()],Xt.prototype,"hasModelTransformation",void 0),h([B()],Xt.prototype,"offsetBackfaces",void 0),h([B()],Xt.prototype,"vvSize",void 0),h([B()],Xt.prototype,"vvColor",void 0),h([B()],Xt.prototype,"receiveShadows",void 0),h([B()],Xt.prototype,"receiveAmbientOcclusion",void 0),h([B()],Xt.prototype,"textureAlphaPremultiplied",void 0),h([B()],Xt.prototype,"instanced",void 0),h([B()],Xt.prototype,"instancedColor",void 0),h([B()],Xt.prototype,"objectAndLayerIdColorInstanced",void 0),h([B()],Xt.prototype,"instancedDoublePrecision",void 0),h([B()],Xt.prototype,"doublePrecisionRequiresObfuscation",void 0),h([B()],Xt.prototype,"writeDepth",void 0),h([B()],Xt.prototype,"transparent",void 0),h([B()],Xt.prototype,"enableOffset",void 0),h([B()],Xt.prototype,"cullAboveGround",void 0),h([B()],Xt.prototype,"snowCover",void 0),h([B()],Xt.prototype,"hasColorTextureTransform",void 0),h([B()],Xt.prototype,"hasEmissionTextureTransform",void 0),h([B()],Xt.prototype,"hasNormalTextureTransform",void 0),h([B()],Xt.prototype,"hasOcclusionTextureTransform",void 0),h([B()],Xt.prototype,"hasMetallicRoughnessTextureTransform",void 0),h([B({constValue:!1})],Xt.prototype,"occlusionPass",void 0),h([B({constValue:!0})],Xt.prototype,"hasVvInstancing",void 0),h([B({constValue:!1})],Xt.prototype,"useCustomDTRExponentForWater",void 0),h([B({constValue:!1})],Xt.prototype,"supportsTextureAtlas",void 0),h([B({constValue:!0})],Xt.prototype,"useFillLights",void 0);function qRe(t){const e=new Vi,{vertex:i,fragment:r,varyings:s}=e;return bc(i,t),e.include(yL),s.add("vpos","vec3"),e.include(g0,t),e.include(AAe,t),e.include(fOe,t),t.output===G.Color&&(Rf(e.vertex,t),e.include(QA,t),e.include(Ja,t),t.offsetBackfaces&&e.include(PRe),t.instancedColor&&e.attributes.add(R.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),t.multipassEnabled&&s.add("depth","float"),e.include(lf,t),e.include(ZA,t),e.include(ORe,t),e.include(DT,t),i.uniforms.add(new zi("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),i.code.add(S`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${S.float(Xo)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.multipassEnabled?S`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===G.Color&&(e.include(gn,t),e.include(rT,t),e.include(RL,t),e.include(dC,t),e.include(t.instancedDoublePrecision?IL:hA,t),e.include(Vg,t),Rf(e.fragment,t),G0(r),$L(r),tP(r),r.uniforms.add(i.uniforms.get("localOrigin"),i.uniforms.get("view"),new Vt("ambient",n=>n.ambient),new Vt("diffuse",n=>n.diffuse),new qe("opacity",n=>n.opacity),new qe("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new mt("tex",n=>n.texture)),e.include(fie,t),e.include(Are,t),r.include(Ore),t.transparencyPassType===nt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),Lg(r),r.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?S`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?S`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===xt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?S`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?S`albedo = mix(albedo, vec3(1), 0.9);`:S``}
        ${S`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===xt.Normal||t.pbrMode===xt.Schematic?t.spherical?S`vec3 normalGround = normalize(vpos + localOrigin);`:S`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:S``}
        ${t.pbrMode===xt.Normal||t.pbrMode===xt.Schematic?S`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?S`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:S`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===nt.ColorAlpha?S`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `)),e.include(IRe,t),e}const Jdt=Object.freeze(Object.defineProperty({__proto__:null,build:qRe},Symbol.toStringTag,{value:"Module"}));let WRe=class YRe extends Rre{initializeConfiguration(e,i){super.initializeConfiguration(e,i),i.hasMetallicRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=Ki.Attribute,i.doubleSidedMode=xs.WindingOrder,i.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,YRe.shader)}};WRe.shader=new Bi(Jdt,()=>fe(()=>Promise.resolve().then(()=>gUt),void 0));let If=class extends mb{constructor(e){super(e,ept),this.supportsEdges=!0,this.produces=new Map([[_e.OPAQUE_MATERIAL,i=>(Y$(i)||JC(i))&&!this.parameters.transparent],[_e.TRANSPARENT_MATERIAL,i=>(Y$(i)||JC(i))&&this.parameters.transparent&&this.parameters.writeDepth],[_e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>(Y$(i)||JC(i))&&this.parameters.transparent&&!this.parameters.writeDepth]]),this._configuration=new Xt,this._vertexBufferLayout=tpt(this.parameters)}isVisibleForOutput(e){return e!==G.Shadow&&e!==G.ShadowExcludeHighlight&&e!==G.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:i,hasVertexColors:r,hasSymbolColors:s,vvColor:n}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=i||n||s;return r&&c?o||a:r?o?l:a:c?o||a:o?l:a}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?Nr.None:this.parameters.cullFace,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e===G.Color&&(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=xs.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?xs.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?xs.WindingOrder:xs.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=this.parameters.receiveAmbientOcclusion&&i.ssao!=null,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?xt.Schematic:xt.Normal:xt.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<GG,this._configuration.snowCover=this.hasSnowCover(i),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,i,r,s,n,o){if(this.parameters.verticalOffset!=null){const a=r.camera;ne(Z8,i[12],i[13],i[14]);let l=null;switch(r.viewingMode){case Ge.Global:l=ge(Nde,Z8);break;case Ge.Local:l=ce(Nde,spt)}let c=0;const u=ve(npt,Z8,a.eye),d=Ae(u),p=oe(u,u,1/d);let m=null;this.parameters.screenSizePerspective&&(m=pe(l,p)),c+=_Oe(a,d,this.parameters.verticalOffset,m??0,this.parameters.screenSizePerspective),oe(l,l,c),Qo(Y8,l,r.transform.inverseRotation),s=ve(ipt,s,Y8),n=ve(rpt,n,Y8)}yRe(e,r,s,n,H7(r.verticalOffset),o)}createGLMaterial(e){return new Qdt(e)}createBufferWriter(){return new KA(this._vertexBufferLayout)}},Qdt=class extends pie{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===G.Color&&(this._updateShadowState(e),this._updateOccludeeState(e));const i=this._material.parameters;this.updateTexture(i.textureId);const r=e.camera.viewInverseTransposeMatrix;return ne(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?WRe:Rre,e)}},Kdt=class extends Wdt{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const ept=new Kdt;function tpt(t){const e=Ts().vec3f(R.POSITION);return t.normalType===Ki.Compressed?e.vec2i16(R.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(R.NORMAL),t.hasVertexTangents&&e.vec4f(R.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(R.UV0),t.hasVertexColors&&e.vec4u8(R.COLOR),t.hasSymbolColors&&e.vec4u8(R.SYMBOLCOLOR),re("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),e}const ipt=E(),rpt=E(),spt=$e(0,0,1),Nde=E(),Y8=E(),Z8=E(),npt=E(),ZRe=new yre({});function v7t(t){return t.type==="web-style"?ZRe:$re(t.symbolLayers.toArray().map(e=>XRe(t,e)))}function $re(t){let e=0,i=0,r=0,s=!1,n=0;const o=new cRe;for(const a of t)a!=null&&(e+=a.verticesPerFeature,i+=a.verticesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,s=s||a.estimated,++n);return s?new qht(n,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o}):new Hht(n,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o})}function b7t(t){const e=$re(t);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const X8={};function XRe(t,e){var s,n;const i=JRe(t,e),r=odt(e)?2:0;switch(e.type){case"extrude":return new yd({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:i});case"fill":if(t.type==="mesh-3d")return new yd({drawCallsPerFeature:r,memory:i});if(e.outline!=null&&e.outline.size>0)return new yd({verticesPerFeature:-12,verticesPerCoordinate:9,memory:i});case"water":return new yd({verticesPerFeature:-6,verticesPerCoordinate:3,memory:i});case"line":return new yd({verticesPerFeature:-6,verticesPerCoordinate:6,memory:i});case"object":return(s=e.resource)!=null&&s.href?new yre({verticesPerFeature:100,memory:i}):{...opt(((n=e.resource)==null?void 0:n.primitive)??hCe),memory:i};case"path":{let o=0,a=0;switch(e.profile){case"circle":o=sRe;break;case"quad":o=4;break;default:return void(e.profile,void 0)}switch(e.join){case"round":a=rRe;break;case"miter":case"bevel":a=1;break;default:return}const l=2*o,c=o*a*2,u=c+l;let d=-2*c-l;switch(e.cap){case"none":break;case"butt":case"square":d+=2*(o-1);break;case"round":d+=2*(o*(bX-1)*2+o);break;default:return}return new yd({verticesPerFeature:d,verticesPerCoordinate:u,memory:i})}case"text":case"icon":return new yd({verticesPerFeature:6,memory:i});default:return}}function JRe(t,e){const i=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?Yl.EXTRUDE_EDGES:Yl.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?Yl.FILL_OUTLINE:Yl.FILL;case"water":return Yl.FILL;case"line":return e.join==="round"?Yl.LINE_ROUND:Yl.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return Yl.PATH_ROUND_CIRCLE;case"quad":return Yl.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return Yl.PATH_MITER_CIRCLE;case"quad":return Yl.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return i?Yl.OBJECT_POINT:Yl.OBJECT_POLYGON;case"icon":case"text":return i?Yl.ICON_POINT:Yl.ICON_POLYGON;default:return}}function opt(t){const e=X8[t];if(e)return e;const i=QRe(lRe(t,new If({})).levels);return X8[t]=new yd({verticesPerFeature:i}),X8[t]}function QRe(t){return t.reduce((e,i,r)=>e+i.numVertices*(1/10**r),0)/t.reduce((e,i,r)=>e+1/10**r,0)}const Yl={ICON_POINT:{bytesPerFeature:2379.8272296852992,bytesPerFeatureLabel:852.246235,resourceBytes:0,draped:{bytesPerFeature:1868.2382921559424,bytesPerFeatureLabel:839.205415}},ICON_POLYGON:{bytesPerFeature:2957.8429876524656,bytesPerFeatureLabel:862.5307816666666,resourceBytes:0,draped:{bytesPerFeature:2579.7767085451133,bytesPerFeatureLabel:856.9298550000001}},OBJECT_POINT:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999,resourceBytes:0,draped:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999}},OBJECT_POLYGON:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998,resourceBytes:0,draped:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998}},LINE_MITER:{bytesPerFeature:3081.208408220661,bytesPerFeatureLabel:858.6749016666668,resourceBytes:0,draped:{bytesPerFeature:2682.57863388475,bytesPerFeatureLabel:844.6118016666666}},LINE_ROUND:{bytesPerFeature:3209.3236242927915,bytesPerFeatureLabel:858.1810416666667,resourceBytes:0,draped:{bytesPerFeature:2687.6256038096126,bytesPerFeatureLabel:849.578535}},PATH_MITER_CIRCLE:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415,resourceBytes:0,draped:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415}},PATH_ROUND_CIRCLE:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001,resourceBytes:0,draped:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001}},PATH_MITER_QUAD:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355,resourceBytes:0,draped:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355}},PATH_ROUND_QUAD:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955,resourceBytes:0,draped:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955}},FILL:{bytesPerFeature:3147.43349219103,bytesPerFeatureLabel:850.7598550000001,resourceBytes:0,draped:{bytesPerFeature:2673.7898488975106,bytesPerFeatureLabel:846.6459950000002}},FILL_OUTLINE:{bytesPerFeature:4565.099993465867,bytesPerFeatureLabel:855.334515,resourceBytes:0,draped:{bytesPerFeature:3904.46969705314,bytesPerFeatureLabel:844.7081016666667}},EXTRUDE:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333,resourceBytes:0,draped:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333}},EXTRUDE_EDGES:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335,resourceBytes:0,draped:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335}}};var an;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(an||(an={}));let Ire=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=ah.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,i){return this._loadStatus===ah.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===ah.FAILED?(i&&i(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=ah.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=ah.FAILED,!ms(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,i).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=Ul(this._abortController):this._loadStatus===ah.LOADING&&(this._loadStatus=ah.FAILED),this._loader=null}};var ah;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(ah||(ah={}));const A_=()=>ie.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let Gg=class extends Ire{constructor(e,i,r,s){super(r.schedule),this.symbol=e,this.symbolLayer=i,this._context=r,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this._materials=[],this.usedMemory=0,this.logger=A_(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new Hz,this.complexity=this.computeComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=Fde(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const i=this._drivenProperties,r=Fde(e);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,i,r,s){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${s} geometry failed to be created`;n?!this._logGeometryValidationWarnings(i,r,s)&&o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&A_().warnOncePerTick(`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):A_().warnOncePerTick(`${a} (failed to project geometry to view spatial reference)`)}_logGeometryValidationWarnings(e,i,r){const s=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(A_().warnOncePerTick(`${s} (no ${i} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(A_().warnOncePerTick(`${s} (${i} should be defined as a 2D array)`),!0)}_validateGeometry(e,i=null,r=null){if(i!=null&&!i.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;switch(e.type){case"point":{const s=e;if(!isFinite(s.x)||!isFinite(s.y))return A_().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":vje(e)&&A_().warnOncePerTick("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return apt}_defaultElevationInfoZ(){return lpt}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,i=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,i=new Hz){const r=e.geometry,s=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,i.mode=this.getGeometryElevationMode(r,s),i.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";n&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=n?Nht:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,e,this._context.layer),i}prepareSymbolLayerPatch(e){}updateGeometry(e,i){return!1}updateTransform(e,i,r,s){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,i=kde){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?r*=e.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(e,i=kde){const r=this._getCombinedOpacity(e,i);if(this._drivenProperties.color)return tI(null,r);const s=e!=null?Oe.toUnitRGB(e):s0;return tI(s,r)}_getVertexOpacityAndColor(e,i=null){const r=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=tI(r,s);return i&&(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i),n}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return XRe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,i,r){switch(e){case"opacity":return this.layerOpacityChanged(i,r),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==Ds.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,i,r){let s=Ds.UPDATE;return e.forEach(n=>{const o=i(n);if(o!=null){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else s=Ds.RECREATE}),s}applyRendererDiff(e,i){return an.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const i=this._fastUpdates.visualVariables,r=i.size?_f(i.size.field,e):0,s=i.color?_f(i.color.field,e):0,n=i.opacity?_f(i.opacity.field,e):0;return Wt(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&A_().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var i,r,s,n,o,a,l,c;return{size:((r=(i=this._fastUpdates)==null?void 0:i.visualVariables.size)==null?void 0:r.field)??null,color:((n=(s=this._fastUpdates)==null?void 0:s.visualVariables.color)==null?void 0:n.field)??null,opacity:((a=(o=this._fastUpdates)==null?void 0:o.visualVariables.opacity)==null?void 0:a.field)??null,rotation:((c=(l=this._fastUpdates)==null?void 0:l.visualVariables.rotation)==null?void 0:c.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function Fde(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(i=>{switch(i.type){case"color":if(e.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const s=i.stops[r].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const apt={mode:"on-the-ground",offset:0,unit:"meters"},lpt={mode:"absolute-height",offset:0,unit:"meters"},kde={hasIntrinsicColor:!1};let vb=class extends bL{get geometries(){return this._geometries}get transformation(){return this._transformation??Vr}set transformation(e){this._transformation=vn(this._transformation??Ee(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?vn(this._shaderTransformation??Ee(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=Ls.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new KRe),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){ft(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const i=this._geometries.splice(e,1)[0];i&&(this._emit("geometryRemoved",{object:this,geometry:i}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,i,r=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:i,sync:r}),iit(i)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const i of this._geometries)i.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new Mz(A0.MaskOccludee);for(const i of this._geometries)i.occludees=GZ(i.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const i of this._geometries)i.occludees=jZ(i.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new Mz(A0.Highlight);for(const i of this._geometries)i.highlights=GZ(i.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const i of this._geometries)i.highlights=jZ(i.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,i){return dr(i,this.transformation,e.transformation)}getCombinedShaderTransformation(e,i=Ee()){return dr(i,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new Ude,this._validateBoundingVolume(this._bvWorldSpace,iI.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new Ude,this._validateBoundingVolume(this._bvObjectSpace,iI.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,i){const r=i===iI.ObjectSpace;for(const s of this._geometries){const n=s.boundingInfo;n&&cpt(n,e,r?s.transformation:this.getCombinedShaderTransformation(s))}yr(e.bounds,e.min,e.max,.5);for(const s of this._geometries){const n=s.boundingInfo;if(n==null)continue;const o=r?s.transformation:this.getCombinedShaderTransformation(s),a=VM(o);He(zde,n.center,o);const l=wr(zde,e.bounds),c=n.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){var i;const e=(i=this._bvWorldSpace)==null?void 0:i.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,i){this._parentLayer&&this._parentLayer.events.emit(e,i)}get test(){}},KRe=class{constructor(){this.min=$e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=$e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},Ude=class extends KRe{constructor(){super(...arguments),this.bounds=ln()}};function cpt(t,e,i){const r=t.bbMin,s=t.bbMax;if($B(i)){const n=ne(upt,i[12],i[13],i[14]);me(Lu,r,n),me(cp,s,n);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Lu[o]),e.max[o]=Math.max(e.max[o],cp[o])}else if(He(Lu,r,i),Oo(r,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Lu[n]),e.max[n]=Math.max(e.max[n],Lu[n]);else{He(cp,s,i);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Lu[n],cp[n]),e.max[n]=Math.max(e.max[n],Lu[n],cp[n]);for(let n=0;n<3;++n){ce(Lu,r),ce(cp,s),Lu[n]=s[n],cp[n]=r[n],He(Lu,Lu,i),He(cp,cp,i);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Lu[o],cp[o]),e.max[o]=Math.max(e.max[o],Lu[o],cp[o])}}}const upt=E(),Lu=E(),cp=E(),zde=E();var iI;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(iI||(iI={}));function Lre(t,e,i,r,s){if(t$e(t,e))return null;i.localOrigin=Dre(t,e);const n=new vb({geometries:[i],castShadow:!1,layerUid:t.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:n,sampledElevation:qOe(n,e,t.elevationProvider,t.renderCoordsHelper,r)}}function e$e(t,e,i,r){return t$e(e,i)?null:qOe(t,i,e.elevationProvider,e.renderCoordsHelper,r)}function t$e(t,e){const i=t.clippingExtent;return!!i&&(il(e,Jv,t.elevationProvider.spatialReference),!jte(i,Jv))}function sT(t,e,i){const r=t.elevationContext,s=i.spatialReference;il(e,Jv,s),r.centerPointInElevationSR=nb(Jv[0],Jv[1],e.hasZ?Jv[2]:0,s??null)}function ES(t){switch(t.type){case"point":return t;case"polygon":case"extent":return mre(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const i=dwe(e,yee(e)/2);return nb(i[0],i[1],i[2],t.spatialReference)}case"mesh":return t.origin}return null}function Dre(t,e){return il(e,Jv,t.renderCoordsHelper.spatialReference),t.localOriginFactory.getOrigin(Jv)}const Jv=E();function i$e(){return new Float32Array(2)}function hpt(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function zm(t,e){const i=new Float32Array(2);return i[0]=t,i[1]=e,i}function dpt(t,e){return new Float32Array(t,e,2)}function r$e(){return i$e()}function s$e(){return zm(1,1)}function n$e(){return zm(1,0)}function o$e(){return zm(0,1)}const a$e=r$e(),l$e=s$e(),ppt=n$e(),fpt=o$e();Object.freeze(Object.defineProperty({__proto__:null,ONES:l$e,UNIT_X:ppt,UNIT_Y:fpt,ZEROS:a$e,clone:hpt,create:i$e,createView:dpt,fromValues:zm,ones:s$e,unitX:n$e,unitY:o$e,zeros:r$e},Symbol.toStringTag,{value:"Module"}));function c$e(t){const e=new Vi,{vertex:i,fragment:r}=e;return i.include(VG),e.include(yOe,t),e.include(gn,t),e.attributes.add(R.UV0,"vec2"),i.uniforms.add(new zi("viewport",(s,n)=>n.camera.fullViewport),new qe("lineSize",(s,n)=>s.size>0?Math.max(1,s.size)*n.camera.pixelRatio:0),new Fr("pixelToNDC",(s,n)=>Pi(Bde,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new qe("borderSize",(s,n)=>s.borderColor!=null?n.camera.pixelRatio:0),new Fr("screenOffset",(s,n)=>Pi(Bde,s.horizontalScreenOffset*n.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.multipassEnabled&&e.varyings.add("depth","float"),t.occlusionTestEnabled&&e.include($Oe),t.hasScreenSizePerspective&&zG(i),i.code.add(S`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?S`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?S`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:S`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.multipassEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?S`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:S`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?S`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:S`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add(new zi("uColor",s=>Vde(s.color)),new zi("borderColor",s=>Vde(s.borderColor))),t.multipassEnabled&&(r.include(Wrt,t),r.uniforms.add(new Fr("inverseViewport",(s,n)=>n.inverseViewport))),r.code.add(S`
    void main() {
      ${t.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?S`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:S`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function Vde(t){return t??wh}const Bde=lt(),mpt=Object.freeze(Object.defineProperty({__proto__:null,build:c$e},Symbol.toStringTag,{value:"Module"}));let u$e=class h$e extends Wi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Ge.Global}initializeProgram(e){return new Yi(e.rctx,h$e.shader.get().build(this.configuration),wi)}setPipelineState(e){const i=e?fr.ALWAYS:fr.LESS;return this.configuration.depthHudEnabled?Gt({depthTest:{func:i},depthWrite:Tu}):Gt({blending:sa(Pe.ONE,Pe.SRC_ALPHA,Pe.ONE_MINUS_SRC_ALPHA,Pe.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:Kt})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}};u$e.shader=new Bi(mpt,()=>fe(()=>Promise.resolve().then(()=>yUt),void 0));let Qh=class extends Ec{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.multipassEnabled=!1}};h([B()],Qh.prototype,"screenCenterOffsetUnitsEnabled",void 0),h([B()],Qh.prototype,"spherical",void 0),h([B()],Qh.prototype,"occlusionTestEnabled",void 0),h([B()],Qh.prototype,"hasVerticalOffset",void 0),h([B()],Qh.prototype,"hasScreenSizePerspective",void 0),h([B()],Qh.prototype,"depthHudEnabled",void 0),h([B()],Qh.prototype,"depthHudAlignStartEnabled",void 0),h([B()],Qh.prototype,"hasSlicePlane",void 0),h([B()],Qh.prototype,"multipassEnabled",void 0),h([B({constValue:!0})],Qh.prototype,"hasSliceInVertexProgram",void 0),h([B({constValue:!1})],Qh.prototype,"draped",void 0);let zN=class xX extends mb{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new d$e),this.produces=new Map([[_e.LINE_CALLOUTS,i=>i===G.Color],[_e.LINE_CALLOUTS_HUD_DEPTH,i=>i===G.Color]]),this._configuration=new Qh,this._uniqueMaterialIdentifier=xX.uniqueMaterialIdentifier(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,i){const r=(i==null?void 0:i.slot)!==_e.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=r,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration}intersect(){}createGLMaterial(e){return new gpt(e)}createBufferWriter(){return new _pt}validateParameters(e){const i=xX.uniqueMaterialIdentifier(e);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier({renderOccluded:e,isDecoration:i,horizontalScreenOffset:r,color:s,size:n,occlusionTest:o,shaderPolygonOffset:a,depthHUDAlignStart:l,centerOffsetUnits:c,hasSlicePlane:u,screenSizePerspective:d,verticalOffset:p,borderColor:m}){return ize`${e}:${i}:${r}:[${s}]:${n}:${o}:${a}:${l}:${c}:${u}:${d!=null}:{${p.screenLength}:${p.minWorldLength}:${p.maxWorldLength}}:[${m}]`}},gpt=class extends pb{beginSlot(e){return this.ensureTechnique(u$e,e)}},d$e=class extends ore{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const ypt=Ts().vec3f(R.POSITION).vec3f(R.NORMAL).vec2f(R.UV0).vec4f(R.CENTEROFFSETANDDISTANCE),Gde=[zm(0,0),zm(1,0),zm(0,1),zm(1,0),zm(1,1),zm(0,1)];let _pt=class{constructor(){this.vertexBufferLayout=ypt}elementCount(e){return 6*e.attributes.get(R.POSITION).indices.length}write(e,i,r,s,n){are(r.attributes.get(R.POSITION),e,s.position,n,6),lre(r.attributes.get(R.NORMAL),i,s.normal,n,6),lA(r.attributes.get(R.CENTEROFFSETANDDISTANCE),s.centerOffsetAndDistance,n,6);for(let o=0;o<Gde.length;++o)s.uv0.setVec(n+o,Gde[o])}},p$e=class f$e extends Gg{constructor(e,i){super(e,null,i,wpt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new zN(this._materialParameters),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const i=this._materialParameters;return i.horizontalScreenOffset=e.horizontalScreenOffset??0,i.centerOffsetUnits=e.centerOffsetUnits||"world",i}get _materialParameters(){var o;const e=new d$e,i=this.symbol,r=i.callout;if(e.color=r.color!=null?Oe.toUnitRGBA(r.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=_n(r.size||0),i.verticalOffset){const{screenLength:a,minWorldLength:l,maxWorldLength:c}=i.verticalOffset;e.verticalOffset={screenLength:_n(a),minWorldLength:l||0,maxWorldLength:c??1/0}}e.borderColor=((o=r.border)==null?void 0:o.color)!=null?Oe.toUnitRGBA(r.border.color):null;const s=i.symbolLayers.at(0).type==="object",n=i.type==="label-3d";return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return bpt}createGraphics3DGraphic(e){const i=e.renderingInfo,r=e.graphic,s=this.setGraphicElevationContext(r,new Hz,i.elevationOffset||0),n=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!yCe(l)))return null;const a=mre(r.geometry);return a==null?null:this._createAs3DShape(a,s,i,r.uid)}layerOpacityChanged(){var e;(e=this._materials[0])==null||e.setParameters(this._materialParameters)}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=CL(f$e.elevationModeChangeTypes,r,s);return n!==Ds.UPDATE||e.forEach(o=>{const a=i(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}updateGraphicElevationContext(e,i){this.setGraphicElevationContext(e,i.elevationContext,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=qd(i.elevationContext.mode)}computeComplexity(){return new yd({verticesPerFeature:6})}_getOrCreateMaterial(e){var s;const i=this._perInstanceMaterialParameters(e),r=zN.uniqueMaterialIdentifier(i);if(r===((s=this._materials[0])==null?void 0:s.uniqueMaterialIdentifier))return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let n=e.materialCollection.get(r);return n==null&&(n=new zN(i),e.materialCollection.add(r,n)),{material:n,isUnique:!1}}return{material:new zN(i),isUnique:!0}}_createAs3DShape(e,i,r,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(r),l=new bn(a.material,vpt(r),null,Ls.Point,o),c=Lre(this._context,e,l,i,s);if(c==null)return null;const u=new Bg(this,c.object,[l],a.isUnique?[a.material]:null,null,TS,i);return u.metadata=new iRe(r.elevationOffset),u.alignedSampledElevation=c.sampledElevation,u.needsElevationUpdates=qd(i.mode),sT(u,e,this._context.elevationProvider),u}};function vpt(t){const{translation:e,centerOffset:i}=t,r=new it(e?[e[0],e[1],e[2]]:[0,0,0],J8,3,!0),s=new it(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],J8,4,!0);return[[R.POSITION,r],[R.NORMAL,new it([0,0,1],J8,3,!0)],[R.CENTEROFFSETANDDISTANCE,s]]}p$e.elevationModeChangeTypes={definedChanged:Ds.UPDATE,staysOnTheGround:Ds.UPDATE,onTheGroundChanged:Ds.RECREATE};const J8=[0],bpt={mode:"relative-to-ground",offset:0},wpt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let xpt=class{constructor(e,i,r=E(),s=Qt(),n=0,o="world",a=0,l=null){this.renderer=e,this.symbol=i,this.translation=r,this.centerOffset=s,this.horizontalScreenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},Spt=class extends Fht{};const jde=()=>ie.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function Tpt(t,e){if(!Jte(t))return jde().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const i=Ept[t.callout.type];return i?new i(t,e):(jde().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const Ept={line:p$e};function $7t(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance,1,1]:[1,1,1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax,t.extent.zmin??0,t.extent.mmin??0]:[0,0,0,0]}:null}function Cpt(t){return t.originPosition==="lowerLeft"&&t.scale.length===4&&t.translate.length===4}function LL(t){if(Cpt(t))return t;const{originPosition:e,scale:i,translate:r}=t,s=i[0]??1,n=i[1]??1;return{originPosition:"lowerLeft",scale:[s,e==="lowerLeft"?n:-n,i[2]??1,i[3]??1],translate:[r[0]??0,r[1]??0,r[2]??0,r[3]??0]}}function Mpt({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function Apt({scale:t,translate:e},i){return Math.round((i-e[1])/t[1])}function Ppt({scale:t,translate:e},i){return Math.round(((i??0)-e[2])/t[2])}function Opt({scale:t,translate:e},i){return i?Math.round((i-e[3])/t[3]):0}function DL({scale:t,translate:e},i){return i*t[0]+e[0]}function NL({scale:t,translate:e},i){return i*t[1]+e[1]}function p3({scale:t,translate:e},i){return(i??0)*t[2]+e[2]}function f3({scale:t,translate:e},i){return i?i*t[3]+e[3]:0}function Nre(t,e){return t&&e?Lpt:t&&!e?$pt:!t&&e?Ipt:Rpt}const Rpt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=DL(t,r[0]),n=NL(t,r[1]);i[0]=[s,n];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[d,p]=e[u];s+=l*d,n+=c*p,i[u]=[s,n]}return i},$pt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=DL(t,r[0]),n=NL(t,r[1]);i[0]=[s,n,p3(t,r[2])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[d,p,m]=e[u];s+=l*d,n+=c*p,i[u]=[s,n,p3(t,m)]}return i},Ipt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=DL(t,r[0]),n=NL(t,r[1]);i[0]=[s,n,f3(t,r[2])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[d,p,m]=e[u];s+=l*d,n+=c*p,i[u]=[s,n,f3(t,m)]}return i},Lpt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=DL(t,r[0]),n=NL(t,r[1]);i[0]=[s,n,p3(t,r[2]),f3(t,r[3])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[d,p,m,g]=e[u];s+=l*d,n+=c*p,i[u]=[s,n,p3(t,m),f3(t,g)]}return i};function m$e(t,e,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=e(t,i[s]);return r}function I7t(t,e,i){const r=LL(t);return e.x=Mpt(r,i.x),e.y=Apt(r,i.y),i.z!=null&&(e.z=Ppt(r,i.z)),i.m!=null&&(e.m=Opt(r,i.m)),e}function g$e(t,e,i,r=(i==null?void 0:i.hasZ)??!1,s=(i==null?void 0:i.hasM)??!1){if(i!=null){const n=LL(t);e.points=Nre(r,s)(n,i.points),e.hasZ=r,e.hasM=s}return e}function y$e(t,e,i,r=(i==null?void 0:i.z)!=null,s=(i==null?void 0:i.m)!=null){if(i==null)return e;const n=LL(t);return e.x=DL(n,i.x),e.y=NL(n,i.y),r&&(e.z=p3(n,i.z)),s&&(e.m=f3(n,i.m)),e}function _$e(t,e,i,r=(i==null?void 0:i.hasZ)??!1,s=(i==null?void 0:i.hasM)??!1){if(i!=null){const n=LL(t);e.rings=m$e(n,Nre(r,s),i.rings),e.hasZ=r,e.hasM=s}return e}function v$e(t,e,i,r=(i==null?void 0:i.hasZ)??!1,s=(i==null?void 0:i.hasM)??!1){if(i!=null){const n=LL(t);e.paths=m$e(n,Nre(r,s),i.paths),e.hasZ=r,e.hasM=s}return e}let L7t=class{constructor(e,i,r){this.uid=e,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}};function N7t(t){return t.geometry!=null}let F7t=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function U7t(t,e){var u;const i=Iwe.fromJSON(t.geometryType),r=We.fromJSON(t.spatialReference),s=t.transform,n=t.objectIdFieldName,o=e==null?void 0:e.maxStringAttributeLength,a=e==null?void 0:e.maxStringAttributeFields;let l;const c=t.features.map(d=>{const p=Dpt(d,i,r,t.objectIdFieldName),m=p.geometry;if(zpt(p.attributes,a,o,g=>{l??(l=[]);const y=Upt(p,n);y!=null&&l.push({objectId:y,attribute:g})}),m!=null&&s)switch(m.type){case"point":p.geometry=y$e(s,m,m);break;case"multipoint":p.geometry=g$e(s,m,m);break;case"polygon":p.geometry=_$e(s,m,m);break;case"polyline":p.geometry=v$e(s,m,m);break;case"extent":case"mesh":p.geometry=m}return p});return{geometryType:i,features:c,spatialReference:r,fields:((u=t.fields)==null?void 0:u.map(d=>dG.fromJSON(d)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null,missingAttributes:l}}function Dpt(t,e,i,r){return{uid:_h(),objectId:r&&t.attributes?t.attributes[r]:null,attributes:t.attributes,geometry:Npt(t.geometry,e,i),visible:!0}}function Npt(t,e,i){if(t==null)return null;switch(e){case"point":{const r=t;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=t;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=t;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=t;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function Fpt(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(t.hasZ?1:0)+(t.hasM?1:0),s=t.type==="polyline"?t.paths:t.rings;for(const n of s)i+=n.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32*(s.length+1);break}case"multipoint":{const i=2+(t.hasZ?1:0)+(t.hasM?1:0),r=t.points.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=b0(t.vertexAttributes.position,t.vertexAttributes.normal,t.vertexAttributes.uv,t.vertexAttributes.tangent)}return e}function z7t(t){let e=32;return e+=r1e(t.attributes),e+=3,e+=8+Fpt(t.geometry),e}function V7t(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const i of t.paths)e+=i.length;return e}case"polygon":{let e=0;for(const i of t.rings)e+=i.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function B7t(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function G7t(t,e){switch(Br(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let i=0;i<t.paths.length;i++)I6(e,t.paths[i],!!t.hasZ);break;case"polygon":for(let i=0;i<t.rings.length;i++)I6(e,t.rings[i],!!t.hasZ);break;case"multipoint":I6(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function kpt(t,e){switch(Mc(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let i=0;i<t.paths.length;i++)Qj(e,t.paths[i]);break;case"polygon":for(let i=0;i<t.rings.length;i++)Qj(e,t.rings[i]);break;case"multipoint":Qj(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function Upt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function zpt(t,e,i,r){if(e!=null&&e.size&&i!=null&&t)for(const s in t){if(!e.has(s))continue;const n=t[s];typeof n=="string"&&n.length>i&&(r(s),t[s]="")}}const Q8=2;let Eu=class yE{constructor(e=[],i=[],r=!1){this.lengths=e??[],this.coords=i??[],this.hasIndeterminateRingOrder=r}static fromJSON(e){return new yE(e.lengths,e.coords,e.hasIndeterminateRingOrder)}static fromRect(e){const[i,r,s,n]=e,o=s-i,a=n-r;return new yE([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,i)=>e+i)}forEachVertex(e){let i=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)e(this.coords[Q8*(n+i)],this.coords[Q8*(n+i)+1]);i+=s}}deltaDecode(){const e=this.clone(),{coords:i,lengths:r}=e;let s=0;for(const n of r){for(let o=1;o<n;o++)i[2*(s+o)]+=i[2*(s+o)-2],i[2*(s+o)+1]+=i[2*(s+o)-1];s+=n}return e}clone(e){if(this.lengths.length===0)return new yE([],[this.coords[0],this.coords[1]]);const i=(this.lengths.length===0?1:this.lengths.reduce((s,n)=>s+n))*Q8,r=this.coords.slice(0,i);return e?(e.set(r),new yE(this.lengths,e,this.hasIndeterminateRingOrder)):new yE(Array.from(this.lengths),Array.from(r),this.hasIndeterminateRingOrder)}},dA=class V5{constructor(e=null,i={},r,s){this.geometry=e,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(e,i){const r=e.geometry?Eu.fromJSON(e.geometry):null,s=e.centroid?Eu.fromJSON(e.centroid):null,n=e.attributes[i];return new V5(r,e.attributes,s,n)}weakClone(){const e=new V5(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}clone(){var r,s;const e=(r=this.geometry)==null?void 0:r.clone(),i=new V5(e,{...this.attributes},(s=this.centroid)==null?void 0:s.clone(),this.objectId);return i.displayId=this.displayId,i.geohashX=this.geohashX,i.geohashY=this.geohashY,i}};function j7t(t){var e,i;return!!((i=(e=t.geometry)==null?void 0:e.coords)!=null&&i.length)}let Vpt=class b$e{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new b$e;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};function ol(t,e){return t?e?4:3:e?3:2}const FL=()=>ie.getLogger("esri.layers.graphics.featureConversionUtils"),w$e={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},Bpt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n},Hde=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2]},Gpt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+3]},jpt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2],t[i+3]=e[r+3]};function Fre(t,e,i,r){if(t){if(i)return e&&r?jpt:Hde;if(e&&r)return Gpt}else if(e&&r)return Hde;return Bpt}function K8({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function eH({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function tH({scale:t,translate:e},i,r){return i*t[r]+e[r]}function H7t(t,e,i){return t?e?i?zre(t):kre(t):i?Ure(t):KG(t):null}function KG(t){const e=t.coords;return{x:e[0],y:e[1]}}function x$e(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function kre(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function Hpt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function Ure(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function qpt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function zre(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function Wpt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function Ypt(t,e,i,r){let s=KG;i&&r?s=zre:i?s=kre:r&&(s=Ure);for(const n of e){const{geometry:o,attributes:a}=n,l=o!=null?s(o):null;t.push({attributes:a,geometry:l})}return t}function Vre(t,e){return t&&e?Wpt:t?Hpt:e?qpt:x$e}function Zpt(t,e,i,r,s){const n=Vre(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?n(new Eu,o):null;t.push(new dA(l,a,null,s?a[s]:void 0))}return t}function Xpt(t,e,i=Vre(e.z!=null,e.m!=null)){return i(t,e)}function Jpt(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?S$e(s,i,r):null});return t}function S$e(t,e,i){if(t==null)return null;const r=ol(e,i),s=[];for(let n=0;n<t.coords.length;n+=r){const o=[];for(let a=0;a<r;a++)o.push(t.coords[n+a]);s.push(o)}return e?i?{points:s,hasZ:e,hasM:i}:{points:s,hasZ:e}:i?{points:s,hasM:i}:{points:s}}function Qpt(t,e,i,r,s){const n=ol(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?T$e(new Eu,o,n):null;t.push(new dA(l,a,null,s?a[s]:void 0))}return t}function T$e(t,e,i=ol(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let s=0;for(const n of e.points)for(let o=0;o<i;o++)r[s++]=n[o];return t}function Kpt(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?E$e(s,i,r):null});return t}function E$e(t,e,i){if(!t)return null;const r=ol(e,i),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let u=0;u<l;u++){const d=[];for(let p=0;p<r;p++)d.push(s[a++]);c.push(d)}o.push(c)}return e?i?{paths:o,hasZ:e,hasM:i}:{paths:o,hasZ:e}:i?{paths:o,hasM:i}:{paths:o}}function eft(t,e,i,r,s){const n=ol(i,r);for(const{geometry:o,attributes:a,centroid:l}of e){const c=o!=null?C$e(new Eu,o,n):null,u=l!=null?Xpt(new Eu,l):null;t.push(new dA(c,a,u,s?a[s]:void 0))}return t}function C$e(t,e,i=ol(e.hasZ,e.hasM)){const{lengths:r,coords:s}=t;let n=0;for(const o of e.paths){for(const a of o)for(let l=0;l<i;l++)s[n++]=a[l];r.push(o.length)}return t}function tft(t,e,i,r){for(const{geometry:s,attributes:n,centroid:o}of e){const a=s!=null?M$e(s,i,r):null;if(o!=null){const l=KG(o);t.push({attributes:n,centroid:l,geometry:a})}else t.push({attributes:n,geometry:a})}return t}function M$e(t,e,i){if(!t)return null;const r=ol(e,i),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let u=0;u<l;u++){const d=[];for(let p=0;p<r;p++)d.push(s[a++]);c.push(d)}o.push(c)}return e?i?{rings:o,hasZ:e,hasM:i}:{rings:o,hasZ:e}:i?{rings:o,hasM:i}:{rings:o}}function ift(t,e,i,r,s){for(const{geometry:n,centroid:o,attributes:a}of e){const l=n!=null?A$e(new Eu,n,i,r):null,c=s?a[s]:void 0;o!=null?t.push(new dA(l,a,x$e(new Eu,o),c)):t.push(new dA(l,a,null,c))}return t}function A$e(t,e,i=e.hasZ,r=e.hasM){return rft(t,e.rings,i,r)}function rft(t,e,i,r){const s=ol(i,r),{lengths:n,coords:o}=t;let a=0;y0(t);for(const l of e){for(const c of l)for(let u=0;u<s;u++)o[a++]=c[u];n.push(l.length)}return t}const oM=[],rI=[];function q7t(t,e,i,r,s){oM[0]=t;const[n]=P$e(rI,oM,e,i,r,s);return Lf(oM),Lf(rI),n}function P$e(t,e,i,r,s,n){if(Lf(t),!i){for(const o of e){const a=n?o.attributes[n]:void 0;t.push(new dA(null,o.attributes,null,a))}return t}switch(i){case"esriGeometryPoint":return Zpt(t,e,r,s,n);case"esriGeometryMultipoint":return Qpt(t,e,r,s,n);case"esriGeometryPolyline":return eft(t,e,r,s,n);case"esriGeometryPolygon":return ift(t,e,r,s,n);default:FL().error("convertToFeatureSet:unknown-geometry",new V(`Unable to parse unknown geometry type '${i}'`)),Lf(t)}return t}function W7t(t,e,i,r){rI[0]=t,O$e(oM,rI,e,i,r);const s=oM[0];return Lf(oM),Lf(rI),s}function sft(t,e,i){if(t==null)return null;const r=new Eu;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&i==null&&(i=t.hasM),IM(t)?Vre(e??t.z!=null,i??t.m!=null)(r,t):Ll(t)?A$e(r,t,e,i):Kp(t)?C$e(r,t,ol(e,i)):uS(t)?T$e(r,t,ol(e,i)):void FL().error("convertFromGeometry:unknown-geometry",new V(`Unable to parse unknown geometry type '${t}'`))}function nft(t,e,i,r){const s=t&&("coords"in t?t:t.geometry);if(s==null)return null;switch(e){case"esriGeometryPoint":{let n=KG;return i&&r?n=zre:i?n=kre:r&&(n=Ure),n(s)}case"esriGeometryMultipoint":return S$e(s,i,r);case"esriGeometryPolyline":return E$e(s,i,r);case"esriGeometryPolygon":return M$e(s,i,r);default:return FL().error("convertToGeometry:unknown-geometry",new V(`Unable to parse unknown geometry type '${e}'`)),null}}function oft(t,e){for(const i of e)t.push({attributes:i.attributes});return t}function O$e(t,e,i,r,s){if(Lf(t),i==null)return oft(t,e);switch(i){case"esriGeometryPoint":return Ypt(t,e,r,s);case"esriGeometryMultipoint":return Jpt(t,e,r,s);case"esriGeometryPolyline":return Kpt(t,e,r,s);case"esriGeometryPolygon":return tft(t,e,r,s);default:FL().error("convertToFeatureSet:unknown-geometry",new V(`Unable to parse unknown geometry type '${i}'`))}return t}function Y7t(t){const{objectIdFieldName:e,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:d,queryGeometryType:p}=t,m={features:O$e([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:e,spatialReference:i,uniqueIdField:u,queryGeometry:nft(d,p,!1,!1)};return r&&(m.transform=r),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function Z7t(t,e){const i=new Vpt,{hasM:r,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:u,fields:d}=t;return d&&(i.fields=d),i.geometryType=l??null,i.objectIdFieldName=o??e??null,i.spatialReference=a??null,i.objectIdFieldName?(n&&P$e(i.features,n,l,s,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),s&&(i.hasZ=s),u&&(i.transform=u),i):(FL().error(new V("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function X7t(t){const{transform:e,features:i,hasM:r,hasZ:s}=t;if(!e)return t;for(const n of i)n.geometry!=null&&Wde(n.geometry,n.geometry,r,s,e),n.centroid!=null&&Wde(n.centroid,n.centroid,r,s,e);return t.transform=null,t}function J7t(t,e){const{geometryType:i,features:r,hasM:s,hasZ:n}=e;if(!t)return e;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new Eu,qde(l.geometry,a.geometry,s,n,i,t),a.centroid&&(l.centroid=new Eu,qde(l.centroid,a.centroid,s,n,"esriGeometryPoint",t)),r[o]=l}return e.transform=t,e}function qde(t,e,i,r,s,n,o=i,a=r){if(y0(t),!(e!=null&&e.coords.length))return null;const l=w$e[s],{coords:c,lengths:u}=e,d=ol(i,r),p=ol(i&&o,r&&a),m=Fre(i,r,o,a);if(!u.length)return m(t.coords,c,0,0,K8(n,c[0]),eH(n,c[1])),y0(t,d,0),t;let g,y,v,b,w=0,x=0,T=x;for(const C of u){if(C<l)continue;let M=0;x=T,v=g=K8(n,c[w]),b=y=eH(n,c[w+1]),m(t.coords,c,x,w,v,b),M++,w+=d,x+=p;for(let O=1;O<C;O++,w+=d)v=K8(n,c[w]),b=eH(n,c[w+1]),v===g&&b===y||(m(t.coords,c,x,w,v-g,b-y),x+=p,M++,g=v,y=b);M>=l&&(t.lengths.push(M),T=x)}return Lf(t.coords,T),t.coords.length?t:null}function Q7t(t,e,i,r,s,n,o=i,a=r){if(y0(t),!(e!=null&&e.coords.length))return null;const l=w$e[s],{coords:c,lengths:u}=e,d=ol(i,r),p=ol(i&&o,r&&a),m=Fre(i,r,o,a);if(!u.length)return m(t.coords,c,0,0,c[0],c[1]),y0(t,d,0),t;let g=0;const y=n*n;for(const v of u){if(v<l){g+=v*d;continue}const b=t.coords.length/p,w=g,x=g+(v-1)*d;m(t.coords,c,t.coords.length,w,c[w],c[w+1]),SX(t.coords,c,d,y,m,w,x),m(t.coords,c,t.coords.length,x,c[x],c[x+1]);const T=t.coords.length/p-b;T>=l?t.lengths.push(T):Lf(t.coords,b*p),g+=v*d}return t.coords.length?t:null}function aft(t,e,i,r){const s=t[e],n=t[e+1],o=t[i],a=t[i+1],l=t[r],c=t[r+1];let u=o,d=a,p=l-u,m=c-d;if(p!==0||m!==0){const g=((s-u)*p+(n-d)*m)/(p*p+m*m);g>1?(u=l,d=c):g>0&&(u+=p*g,d+=m*g)}return p=s-u,m=n-d,p*p+m*m}function SX(t,e,i,r,s,n,o){let a,l=r,c=0;for(let u=n+i;u<o;u+=i)a=aft(e,u,n,o),a>l&&(c=u,l=a);l>r&&(c-n>i&&SX(t,e,i,r,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),o-c>i&&SX(t,e,i,r,s,c,o))}function K7t(t,e,i,r){var c;if(!((c=e==null?void 0:e.coords)!=null&&c.length))return null;const s=ol(i,r);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const u=e.coords;for(let d=0;d<u.length;d+=s){const p=u[d],m=u[d+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,m),l=Math.max(l,m)}}return zW(t)?vKe(t,n,o,a,l):Z3(n,o,a,l,t),t}function Wde(t,e,i,r,s){const{coords:n,lengths:o}=e,a=ol(i,r);if(!n.length)return t!==e&&y0(t),t;YV(s);const{originPosition:l,scale:c,translate:u}=s,d=cft;d.originPosition=l;const p=d.scale;p[0]=c[0]??1,p[1]=-(c[1]??1),p[2]=c[2]??1,p[3]=c[3]??1;const m=d.translate;if(m[0]=u[0]??0,m[1]=u[1]??0,m[2]=u[2]??0,m[3]=u[3]??0,!o.length){for(let y=0;y<a;++y)t.coords[y]=tH(d,n[y],y);return t!==e&&y0(t,a,0),t}let g=0;for(let y=0;y<o.length;y++){const v=o[y];t.lengths[y]=v;for(let x=0;x<a;++x)t.coords[g+x]=tH(d,n[g+x],x);let b=t.coords[g],w=t.coords[g+1];g+=a;for(let x=1;x<v;x++,g+=a){b+=n[g]*p[0],w+=n[g+1]*p[1],t.coords[g]=b,t.coords[g+1]=w;for(let T=2;T<a;++T)t.coords[g+T]=tH(d,n[g+T],T)}}return t!==e&&y0(t,n.length,o.length),t}function eWt(t,e,i,r,s,n){if(y0(t),t.lengths.push(...e.lengths),i===s&&r===n)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=ol(i,r),a=Fre(i,r,s,n),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function lft(t,e,i,r){let s=0,n=t[r*e],o=t[r*(e+1)];for(let a=1;a<i;a++){const l=n+t[r*(e+a)],c=o+t[r*(e+a)+1],u=(l-n)*(c+o);n=l,o=c,s+=u}return .5*s}function tWt(t,e){const{coords:i,lengths:r}=t;let s=0,n=0;for(let o=0;o<r.length;o++){const a=r[o];n+=lft(i,s,a,e),s+=a}return Math.abs(n)}function y0(t,e=0,i=0){Lf(t.lengths,i),Lf(t.coords,e)}function Lf(t,e=0){t.length!==e&&(t.length=e)}const cft={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},Yde=new Ca(Array,t=>aG(t,nCe),null,10,5),uft=Ht();let hft=class{get labelLayers(){return this._labelLayers||HUe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e==null?void 0:e.isElevationSource)}constructor(e,i,r,s,n){this.graphic=e,this.graphics3DSymbol=i,this.layers=r,this._visibleFlags=wa.ALL_LABEL,this.deconflictionPriority=0,++i.referenced,this._featureExpressionFeature=n?QOe(n,e,s):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(i=>{i.initialize(e),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,i){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(i),e.setVisibility(this.isVisible(Po.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(e=!0)}),e}isVisible(e=Po.GRAPHIC,i){const r=i?this._visibleFlags|i|Po.LABEL*i:this._visibleFlags;return e===Po.GRAPHIC?(r&wa.ALL_GRAPHIC)===wa.ALL_GRAPHIC:(r&wa.ALL_LABEL)===wa.ALL_LABEL}setVisibilityFlag(e,i,r){const s=this.isVisible(e);r?this._visibleFlags|=e*i:this._visibleFlags&=~(e*i);const n=this.isVisible(e);if(s===n)return!1;if(e===Po.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(Po.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,i){return!!(this._visibleFlags&e*i)}computeExtent(e){if(!this._extent){const i=this.graphic.geometry;if(i==null)return!1;this._extent=Ht(),kpt(i,this._extent);const r=i.spatialReference;if(!gs(r,e)&&!AB(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,i){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,i)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,i,r){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=tb.fromExtent(s.type==="mesh"?s.extent:s)),sft(s,i,r)}get usedMemory(){let e=r1e(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>e+=i.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:E(),num:0},draped:{origin:lt(),num:0}};for(const i of this.layers)i!=null&&i.computeAttachmentOrigin(e);return e.render.num>1&&oe(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&hh(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?Br(n.boundingBox):n.boundingBox=Br(),n.requiresDrapedElevation=!1,await yB(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?i:e,l=Yde.acquire(),c=await o.getProjectedBoundingBox(a,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&JM(n.boundingBox,l),Yde.release(l)}),yKe(n.boundingBox)||l7(Hte(n.boundingBox,uft))?n:null}needsElevationUpdates(){var e;for(const i of this.layers)if(i!=null&&(i.type==="object3d"||i.type==="lod-instance")&&i.needsElevationUpdates)return!0;return((e=this._labelLayers)==null?void 0:e.some(i=>(i==null?void 0:i.needsElevationUpdates)??!1))??!1}alignWithElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,i,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,i,r)})}addObjectStateSet(e,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(e,i))}removeObjectState(e){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(e))}_forEachGraphicList(e,i){e==null||e.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}},rWt=class{constructor(e,i){this.scheduler=e,this.schedule=i,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},dft=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var Zde,Xde,Jde,R$e={exports:{}};Zde=R$e,Xde=function(){function t(L,F,j){j=j||2;var W,X,K,te,he,we,De,at=F&&F.length,et=at?F[0]*j:L.length,Ke=e(L,0,et,j,!0),Je=[];if(!Ke||Ke.next===Ke.prev)return Je;if(at&&(Ke=l(L,F,Ke,j)),L.length>80*j){W=K=L[0],X=te=L[1];for(var Xe=j;Xe<et;Xe+=j)(he=L[Xe])<W&&(W=he),(we=L[Xe+1])<X&&(X=we),he>K&&(K=he),we>te&&(te=we);De=(De=Math.max(K-W,te-X))!==0?1/De:0}return r(Ke,Je,j,W,X,De),Je}function e(L,F,j,W,X){var K,te;if(X===de(L,F,j,W)>0)for(K=F;K<j;K+=W)te=Z(K,L[K],L[K+1],te);else for(K=j-W;K>=F;K-=W)te=Z(K,L[K],L[K+1],te);if(te&&C(te,te.next)){var he=te.next;q(te),te=he}return te}function i(L,F){if(!L)return L;F||(F=L);var j,W=L;do if(j=!1,W.steiner||!C(W,W.next)&&T(W.prev,W,W.next)!==0)W=W.next;else{var X=W.prev;if(q(W),(W=F=X)===W.next)break;j=!0}while(j||W!==F);return F}function r(L,F,j,W,X,K,te){if(L){!te&&K&&g(L,W,X,K);for(var he,we,De=L;L.prev!==L.next;)if(he=L.prev,we=L.next,K?n(L,W,X,K):s(L))F.push(he.i/j),F.push(L.i/j),F.push(we.i/j),q(L),L=we.next,De=we.next;else if((L=we)===De){te?te===1?r(L=o(i(L),F,j),F,j,W,X,K,2):te===2&&a(L,F,j,W,X,K):r(i(L),F,j,W,X,K,1);break}}}function s(L){var F=L.prev,j=L,W=L.next;if(T(F,j,W)>=0)return!1;for(var X=L.next.next;X!==L.prev;){if(w(F.x,F.y,j.x,j.y,W.x,W.y,X.x,X.y)&&T(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function n(L,F,j,W){var X=L.prev,K=L,te=L.next;if(T(X,K,te)>=0)return!1;for(var he=X.x<K.x?X.x<te.x?X.x:te.x:K.x<te.x?K.x:te.x,we=X.y<K.y?X.y<te.y?X.y:te.y:K.y<te.y?K.y:te.y,De=X.x>K.x?X.x>te.x?X.x:te.x:K.x>te.x?K.x:te.x,at=X.y>K.y?X.y>te.y?X.y:te.y:K.y>te.y?K.y:te.y,et=v(he,we,F,j,W),Ke=v(De,at,F,j,W),Je=L.prevZ,Xe=L.nextZ;Je&&Je.z>=et&&Xe&&Xe.z<=Ke;){if(Je!==L.prev&&Je!==L.next&&w(X.x,X.y,K.x,K.y,te.x,te.y,Je.x,Je.y)&&T(Je.prev,Je,Je.next)>=0||(Je=Je.prevZ,Xe!==L.prev&&Xe!==L.next&&w(X.x,X.y,K.x,K.y,te.x,te.y,Xe.x,Xe.y)&&T(Xe.prev,Xe,Xe.next)>=0))return!1;Xe=Xe.nextZ}for(;Je&&Je.z>=et;){if(Je!==L.prev&&Je!==L.next&&w(X.x,X.y,K.x,K.y,te.x,te.y,Je.x,Je.y)&&T(Je.prev,Je,Je.next)>=0)return!1;Je=Je.prevZ}for(;Xe&&Xe.z<=Ke;){if(Xe!==L.prev&&Xe!==L.next&&w(X.x,X.y,K.x,K.y,te.x,te.y,Xe.x,Xe.y)&&T(Xe.prev,Xe,Xe.next)>=0)return!1;Xe=Xe.nextZ}return!0}function o(L,F,j){var W=L;do{var X=W.prev,K=W.next.next;!C(X,K)&&M(X,W,W.next,K)&&U(X,K)&&U(K,X)&&(F.push(X.i/j),F.push(W.i/j),F.push(K.i/j),q(W),q(W.next),W=L=K),W=W.next}while(W!==L);return i(W)}function a(L,F,j,W,X,K){var te=L;do{for(var he=te.next.next;he!==te.prev;){if(te.i!==he.i&&x(te,he)){var we=z(te,he);return te=i(te,te.next),we=i(we,we.next),r(te,F,j,W,X,K),void r(we,F,j,W,X,K)}he=he.next}te=te.next}while(te!==L)}function l(L,F,j,W){var X,K,te,he=[];for(X=0,K=F.length;X<K;X++)(te=e(L,F[X]*W,X<K-1?F[X+1]*W:L.length,W,!1))===te.next&&(te.steiner=!0),he.push(b(te));for(he.sort(c),X=0;X<he.length;X++)j=i(j=d(he[X],j),j.next);return j}function c(L,F){return L.x-F.x}function u(L){if(L.next.prev===L)return L;let F=L;for(;;){const j=F.next;if(j.prev===F||j===F||j===L)break;F=j}return F}function d(L,F){var j=p(L,F);if(!j)return F;var W=z(j,L),X=i(j,j.next);let K=u(W);return i(K,K.next),X=u(X),u(F===j?X:F)}function p(L,F){var j,W=F,X=L.x,K=L.y,te=-1/0;do{if(K<=W.y&&K>=W.next.y&&W.next.y!==W.y){var he=W.x+(K-W.y)*(W.next.x-W.x)/(W.next.y-W.y);if(he<=X&&he>te){if(te=he,he===X){if(K===W.y)return W;if(K===W.next.y)return W.next}j=W.x<W.next.x?W:W.next}}W=W.next}while(W!==F);if(!j)return null;if(X===te)return j;var we,De=j,at=j.x,et=j.y,Ke=1/0;W=j;do X>=W.x&&W.x>=at&&X!==W.x&&w(K<et?X:te,K,at,et,K<et?te:X,K,W.x,W.y)&&(we=Math.abs(K-W.y)/(X-W.x),U(W,L)&&(we<Ke||we===Ke&&(W.x>j.x||W.x===j.x&&m(j,W)))&&(j=W,Ke=we)),W=W.next;while(W!==De);return j}function m(L,F){return T(L.prev,L,F.prev)<0&&T(F.next,L,L.next)<0}function g(L,F,j,W){var X=L;do X.z===null&&(X.z=v(X.x,X.y,F,j,W)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==L);X.prevZ.nextZ=null,X.prevZ=null,y(X)}function y(L){var F,j,W,X,K,te,he,we,De=1;do{for(j=L,L=null,K=null,te=0;j;){for(te++,W=j,he=0,F=0;F<De&&(he++,W=W.nextZ);F++);for(we=De;he>0||we>0&&W;)he!==0&&(we===0||!W||j.z<=W.z)?(X=j,j=j.nextZ,he--):(X=W,W=W.nextZ,we--),K?K.nextZ=X:L=X,X.prevZ=K,K=X;j=W}K.nextZ=null,De*=2}while(te>1);return L}function v(L,F,j,W,X){return(L=1431655765&((L=858993459&((L=252645135&((L=16711935&((L=32767*(L-j)*X)|L<<8))|L<<4))|L<<2))|L<<1))|(F=1431655765&((F=858993459&((F=252645135&((F=16711935&((F=32767*(F-W)*X)|F<<8))|F<<4))|F<<2))|F<<1))<<1}function b(L){var F=L,j=L;do(F.x<j.x||F.x===j.x&&F.y<j.y)&&(j=F),F=F.next;while(F!==L);return j}function w(L,F,j,W,X,K,te,he){return(X-te)*(F-he)-(L-te)*(K-he)>=0&&(L-te)*(W-he)-(j-te)*(F-he)>=0&&(j-te)*(K-he)-(X-te)*(W-he)>=0}function x(L,F){return L.next.i!==F.i&&L.prev.i!==F.i&&!k(L,F)&&(U(L,F)&&U(F,L)&&H(L,F)&&(T(L.prev,L,F.prev)||T(L,F.prev,F))||C(L,F)&&T(L.prev,L,L.next)>0&&T(F.prev,F,F.next)>0)}function T(L,F,j){return(F.y-L.y)*(j.x-F.x)-(F.x-L.x)*(j.y-F.y)}function C(L,F){return L.x===F.x&&L.y===F.y}function M(L,F,j,W){var X=D(T(L,F,j)),K=D(T(L,F,W)),te=D(T(j,W,L)),he=D(T(j,W,F));return X!==K&&te!==he||!(X!==0||!O(L,j,F))||!(K!==0||!O(L,W,F))||!(te!==0||!O(j,L,W))||!(he!==0||!O(j,F,W))}function O(L,F,j){return F.x<=Math.max(L.x,j.x)&&F.x>=Math.min(L.x,j.x)&&F.y<=Math.max(L.y,j.y)&&F.y>=Math.min(L.y,j.y)}function D(L){return L>0?1:L<0?-1:0}function k(L,F){var j=L;do{if(j.i!==L.i&&j.next.i!==L.i&&j.i!==F.i&&j.next.i!==F.i&&M(j,j.next,L,F))return!0;j=j.next}while(j!==L);return!1}function U(L,F){return T(L.prev,L,L.next)<0?T(L,F,L.next)>=0&&T(L,L.prev,F)>=0:T(L,F,L.prev)<0||T(L,L.next,F)<0}function H(L,F){var j=L,W=!1,X=(L.x+F.x)/2,K=(L.y+F.y)/2;do j.y>K!=j.next.y>K&&j.next.y!==j.y&&X<(j.next.x-j.x)*(K-j.y)/(j.next.y-j.y)+j.x&&(W=!W),j=j.next;while(j!==L);return W}function z(L,F){var j=new Y(L.i,L.x,L.y),W=new Y(F.i,F.x,F.y),X=L.next,K=F.prev;return L.next=F,F.prev=L,j.next=X,X.prev=j,W.next=j,j.prev=W,K.next=W,W.prev=K,W}function Z(L,F,j,W){var X=new Y(L,F,j);return W?(X.next=W.next,X.prev=W,W.next.prev=X,W.next=X):(X.prev=X,X.next=X),X}function q(L){L.next.prev=L.prev,L.prev.next=L.next,L.prevZ&&(L.prevZ.nextZ=L.nextZ),L.nextZ&&(L.nextZ.prevZ=L.prevZ)}function Y(L,F,j){this.i=L,this.x=F,this.y=j,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function de(L,F,j,W){for(var X=0,K=F,te=j-W;K<j;K+=W)X+=(L[te]-L[K])*(L[K+1]+L[te+1]),te=K;return X}return t.deviation=function(L,F,j,W){var X=F&&F.length,K=X?F[0]*j:L.length,te=Math.abs(de(L,0,K,j));if(X)for(var he=0,we=F.length;he<we;he++){var De=F[he]*j,at=he<we-1?F[he+1]*j:L.length;te-=Math.abs(de(L,De,at,j))}var et=0;for(he=0;he<W.length;he+=3){var Ke=W[he]*j,Je=W[he+1]*j,Xe=W[he+2]*j;et+=Math.abs((L[Ke]-L[Xe])*(L[Je+1]-L[Ke+1])-(L[Ke]-L[Je])*(L[Xe+1]-L[Ke+1]))}return te===0&&et===0?0:Math.abs((et-te)/te)},t.flatten=function(L){for(var F=L[0][0].length,j={vertices:[],holes:[],dimensions:F},W=0,X=0;X<L.length;X++){for(var K=0;K<L[X].length;K++)for(var te=0;te<F;te++)j.vertices.push(L[X][K][te]);X>0&&(W+=L[X-1].length,j.holes.push(W))}return j},t},(Jde=Xde())!==void 0&&(Zde.exports=Jde);const pA=wL(R$e.exports);function pft(t,e,i){X1(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function X1(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return t;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[4],u=i[5],d=i[6],p=i[8],m=i[9],g=i[10],y=i[12],v=i[13],b=i[14];let w=0,x=0;for(let T=0;T<n;T++){const C=e[w],M=e[w+1],O=e[w+2];t[x]=o*C+c*M+p*O+y,t[x+1]=a*C+u*M+m*O+v,t[x+2]=l*C+d*M+g*O+b,w+=s,x+=r}return t}function $$e(t,e,i){ej(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function ej(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],d=i[5],p=i[6],m=i[7],g=i[8];let y=0,v=0;for(let b=0;b<n;b++){const w=e[y],x=e[y+1],T=e[y+2];t[v]=o*w+c*x+p*T,t[v+1]=a*w+u*x+m*T,t[v+2]=l*w+d*x+g*T,y+=s,v+=r}}function fft(t,e,i){Qz(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function Qz(t,e,i,r=3,s=r){const n=Math.min(t.length/r,e.length/s);let o=0,a=0;for(let l=0;l<n;l++)t[a]=i*e[o],t[a+1]=i*e[o+1],t[a+2]=i*e[o+2],o+=s,a+=r;return t}function mft(t,e,i,r=3,s=r){const n=t.length/r;if(n!==Math.ceil(e.length/s))return t;let o=0,a=0;for(let l=0;l<n;l++)t[a]=e[o]+i[0],t[a+1]=e[o+1]+i[1],t[a+2]=e[o+2]+i[2],o+=s,a+=r;return t}function gft(t,e){fA(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function fA(t,e,i=3,r=i){const s=Math.min(t.length/i,e.length/r);let n=0,o=0;for(let a=0;a<s;a++){const l=e[n],c=e[n+1],u=e[n+2],d=l*l+c*c+u*u;if(d>0){const p=1/Math.sqrt(d);t[o]=p*l,t[o+1]=p*c,t[o+2]=p*u}n+=r,o+=i}}function yft(t,e,i){const r=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let u=0;u<r;u++)s[c]=o[l]>>i,s[c+1]=o[l+1]>>i,s[c+2]=o[l+2]>>i,l+=a,c+=n}Object.freeze(Object.defineProperty({__proto__:null,normalize:fA,normalizeView:gft,scale:Qz,scaleView:fft,shiftRight:yft,transformMat3:ej,transformMat3View:$$e,transformMat4:X1,transformMat4View:pft,translate:mft},Symbol.toStringTag,{value:"Module"}));function _ft(t,e,i){return{objectId:t,target:e,distance:i,type:"vertex"}}function Qde(t,e,i,r,s,n=!1){return{objectId:t,target:e,distance:i,type:"edge",start:r,end:s,draped:n}}var _0,Yo;function pC(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function m3(t){return t!=null&&!isNaN(t)&&isFinite(t)}function I$e(t){return t.valueExpression?_0.Expression:t.field&&typeof t.field=="string"?_0.Field:_0.Unknown}function vft(t,e){const i=e||I$e(t),r=t.valueUnit||"unknown";return i===_0.Unknown?Yo.Constant:t.stops?Yo.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?Yo.ClampedLinear:r==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?Yo.Proportional:Yo.Additive:Yo.Identity:Yo.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(_0||(_0={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(Yo||(Yo={}));const L$e=()=>ie.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),tj=t=>L$e().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${t}`),ij=()=>L$e().error("Use of arcade expressions requires an arcade context"),Kde=new Su,B5=Math.PI,D$e=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function N$e(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="color"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void tj("ColorVariable");const s=typeof e=="number",n=s?null:e,o=n==null?void 0:n.attributes;let a=s?e:null;const l=r.field,{ipData:c,hasExpression:u}=r.cache;let d=r.cache.compiledFunc;if(!l&&!u){const g=r.stops;return g&&g[0]&&g[0].color}if(typeof a!="number")if(u){if((i==null?void 0:i.arcade)==null)return void ij();const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,v=y.getViewInfo(g),b=y.createExecContext(n,v,i.timeZone);if(!d){const w=y.createSyntaxTree(r.valueExpression);d=y.createFunction(w),r.cache.compiledFunc=d}a=y.executeFunction(d,b)}else o&&(a=o[l]);const p=r.normalizationField,m=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const g=Gre(a,c);if(g){const y=g[0],v=g[1],b=y===v?r.stops[y].color:Oe.blendColors(r.stops[y].color,r.stops[v].color,g[2],i!=null?i.color:void 0);return new Oe(b)}}}function F$e(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="opacity"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void tj("OpacityVariable");const s=typeof e=="number",n=s?null:e,o=n==null?void 0:n.attributes;let a=s?e:null;const l=r.field,{ipData:c,hasExpression:u}=r.cache;let d=r.cache.compiledFunc;if(!l&&!u){const g=r.stops;return g&&g[0]&&g[0].opacity}if(typeof a!="number")if(u){if((i==null?void 0:i.arcade)==null)return void ij();const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,v=y.getViewInfo(g),b=y.createExecContext(n,v,i.timeZone);if(!d){const w=y.createSyntaxTree(r.valueExpression);d=y.createFunction(w),r.cache.compiledFunc=d}a=y.executeFunction(d,b)}else o&&(a=o[l]);const p=r.normalizationField,m=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const g=Gre(a,c);if(g){const y=g[0],v=g[1];if(y===v)return r.stops[y].opacity;{const b=r.stops[y].opacity;return b+(r.stops[v].opacity-b)*g[2]}}}}function k$e(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(m=>m.type==="rotation"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void tj("RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,o=s==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a==null?void 0:a.attributes,c=r.field,{hasExpression:u}=r.cache;let d=r.cache.compiledFunc,p=0;if(!c&&!u)return p;if(u){if((i==null?void 0:i.arcade)==null)return void ij();const m={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},g=i.arcade.arcadeUtils,y=g.getViewInfo(m),v=g.createExecContext(a,y,i.timeZone);if(!d){const b=g.createSyntaxTree(r.valueExpression);d=g.createFunction(b),r.cache.compiledFunc=d}p=g.executeFunction(d,v)}else l&&(p=l[c]||0);return p=typeof p!="number"||isNaN(p)?null:n+o*p,p}function bft(t,e,i){const r=typeof e=="number",s=r?null:e,n=s==null?void 0:s.attributes;let o=r?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const u=i!=null?i.scale:void 0,d=i!=null?i.view:void 0;o=u==null||d==="3d"?wft(t):u}else if(!r)switch(t.inputValueType){case _0.Expression:{if((i==null?void 0:i.arcade)==null)return void ij();const u={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},d=i.arcade.arcadeUtils,p=d.getViewInfo(u),m=d.createExecContext(s,p,i.timeZone);if(!l){const g=d.createSyntaxTree(t.valueExpression);l=d.createFunction(g),t.cache.compiledFunc=l}o=d.executeFunction(l,m);break}case _0.Field:n&&(o=n[t.field]);break;case _0.Unknown:o=null}if(!m3(o))return null;if(r||!t.normalizationField)return o;const c=n?parseFloat(n[t.normalizationField]):null;return m3(c)&&c!==0?o/c:null}function wft(t){let e=null,i=null;const r=t.stops;return r?(e=r[0].value,i=r[r.length-1].value):(e=t.minDataValue||0,i=t.maxDataValue||0),(e+i)/2}function rj(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(n=>n.type==="size"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void tj("SizeVariable");const s=z$e(bft(r,e,i),r,e,i,r.cache.ipData);return s==null||isNaN(s)?0:s}function yu(t,e,i){return t==null?null:pC(t)?rj(t,e,i):m3(t)?t:null}function U$e(t,e,i){return m3(i)&&t>i?i:m3(e)&&t<e?e:t}function xft(t,e,i,r){return t+((yu(e.minSize,i,r)||e.minDataValue)??0)}function Sft(t,e,i){const r=t.stops;let s=(r==null?void 0:r.length)&&r[0].size;return s==null&&(s=t.minSize),yu(s,e,i)}function Tft(t,e,i,r){const s=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),n=yu(e.minSize,i,r),o=yu(e.maxSize,i,r),a=r!=null?r.shape:void 0;if(t<=e.minDataValue)return n;if(t>=e.maxDataValue)return o;if(n==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?B5*(n/2)**2:n*n,u=c+s*((l?B5*(o/2)**2:o*o)-c);return l?2*Math.sqrt(u/B5):Math.sqrt(u)}return n+s*(o-n)}function Eft(t,e,i,r){const s=r!=null?r.shape:void 0,n=t/e.minDataValue,o=yu(e.minSize,i,r),a=yu(e.maxSize,i,r);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,U$e(l,o,a)}function Cft(t,e,i,r,s){var l,c,u;const[n,o,a]=Gre(t,s);if(n===o)return yu((l=e.stops)==null?void 0:l[n].size,i,r);{const d=yu((c=e.stops)==null?void 0:c[n].size,i,r);return d+(yu((u=e.stops)==null?void 0:u[o].size,i,r)-d)*a}}function Mft(t,e,i,r){const s=((r==null?void 0:r.resolution)??1)*nA[e.valueUnit],n=yu(e.minSize,i,r),o=yu(e.maxSize,i,r),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/B5)/s:a==="radius"||a==="distance"?2*t/s:t/s,U$e(l,n,o)}function z$e(t,e,i,r,s){switch(e.transformationType){case Yo.Additive:return xft(t,e,i,r);case Yo.Constant:return Sft(e,i,r);case Yo.ClampedLinear:return Tft(t,e,i,r);case Yo.Proportional:return Eft(t,e,i,r);case Yo.Stops:return Cft(t,e,i,r,s);case Yo.RealWorldSize:return Mft(t,e,i,r);case Yo.Identity:return t;case Yo.Unknown:return null}}function Aft(t,e,i){const{isScaleDriven:r}=t.cache;if(!(r&&i==="3d"||e))return null;const s={scale:e,view:i};let n=yu(t.minSize,Kde,s),o=yu(t.maxSize,Kde,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function Bre(t,e,i){if(!t.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=N$e(l,e,i);r.push({variable:l,value:c})}),n.forEach(l=>{const c=F$e(l,e,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=k$e(l,e,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=rj(l,e,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function Gre(t,e){if(!e)return;let i=0,r=e.length-1;return e.some((s,n)=>t<s?(r=n,!0):(i=n,!1)),[i,r,(t-e[i])/(e[r]-e[i])]}function Pft(t,e,i){const r=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":rj(s,e,i);switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}const oWt=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:Pft,getColor:N$e,getOpacity:F$e,getRotationAngle:k$e,getSize:rj,getSizeForValue:z$e,getSizeFromNumberOrVariable:yu,getSizeRangeAtScale:Aft,getVisualVariableValues:Bre,viewScaleRE:D$e},Symbol.toStringTag,{value:"Module"}));function sj(t,e){if(!t||t.symbol)return null;const i=e==null?void 0:e.renderer;return t&&i!=null&&i.getObservationRenderer?i.getObservationRenderer(t):i}function Oft(t,e){if(t.symbol!=null)return t.symbol;const i=sj(t,e);return i!=null&&i.type!=="dot-density"?i.getSymbol(t,e):null}function aWt(t,e){const i=sj(t,e),r=Oft(t,e);if(r==null)return null;const s={renderer:i,symbol:r};if(i==null||!("visualVariables"in i)||!i.visualVariables)return s;const n=Bre(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=u;break;case"depth":o[1]=u;break;case"height":o[2]=u;break;case"width-and-depth":o[0]=o[1]=u;break;default:o[0]=o[1]=o[2]=u}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function Rft(t,e){if(t.symbol!=null)return t.symbol;const i=sj(t,e);return i!=null?i.getSymbolAsync(t,e):null}async function lWt(t,e){const i=sj(t,e),r=await Rft(t,e);if(!r)return null;const s={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return s;const n=Bre(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=Oe.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=u:c==="depth"?o[1]=u:c==="height"?o[2]=u:o[0]=o[1]=c==="width-and-depth"?u:o[2]=u}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function $ft(t,e=0){const i=t[e];return typeof i=="number"&&isFinite(i)?i:null}function Ift(t){for(let e=0;e<3;e++){const i=t[e];if(typeof i=="number")return isFinite(i)?i:0}return 0}function V$e(t,e,i){const r=Lft(epe,t,e,i)?epe:[0,0,1];return Math.abs(r[2])>Math.cos(Rt(80))?hs.Z:Math.abs(r[1])>Math.abs(r[0])?hs.Y:hs.X}function Lft(t,e,i,r){const s=(o=>!Array.isArray(o[0]))(e)?(o,a)=>e[3*o+a]:(o,a)=>e[o][a],n=r?Gl(r)/kS(r):1;return ete(t,(o,a)=>ne(o,s(a,0)*n,s(a,1)*n,s(a,2)),i)}const epe=Qi();function Dft(t,e,i){const r=(e.length>0?e[0]:t.length/3)-1,s=V$e(t,r,i);if(s!==hs.Z){t=t.slice();for(let n=0;n<t.length;n+=3)t[n+s]=t[n+2]}return pA(t,e,3)}function tpe(t){const e=[[R.POSITION,new it(t.attributeData.position,t.indices,3,!0)]],i=fb(t.indices.length);return t.attributeData.colorFeature!=null?e.push([R.COLORFEATUREATTRIBUTE,new it([t.attributeData.colorFeature],i,1,!0)]):t.attributeData.color&&e.push([R.COLOR,new it(t.attributeData.color,i,4,!0)]),t.attributeData.uvMapSpace&&e.push([R.UVMAPSPACE,new it(t.attributeData.uvMapSpace,t.indices,4,!0)]),t.attributeData.boundingRect&&e.push([R.BOUNDINGRECT,new it(t.attributeData.boundingRect,t.indices,9,!0)]),new bn(t.material,e,t.mapPositions,Ls.Mesh,t.attributeData.objectAndLayerIdColor)}function ipe(t,e=null){const i=[[R.POSITION,new it(t.attributeData.position,t.indices,3,!0)],[R.UV0,new it(t.attributeData.uv0,t.indices,2,!0)]];return new bn(t.material,i,t.mapPositions,Ls.Mesh,e)}function g3(t){switch(t.type){case"extent":if(t instanceof gi)return tb.fromExtent(t);break;case"polygon":return t}return null}let nj=class{constructor(e,i,r){this.renderData=e,this.layerUid=i,this.graphicUid=r,this.outGeometries=new Array}};function TX(t,e,i){const r=Array.isArray(t),s=r?t.length/e:t.byteLength/(4*e),n=r?t:new Uint32Array(t,0,s*e),o=(i==null?void 0:i.minReduction)??0,a=(i==null?void 0:i.originalIndices)||null,l=a?a.length:0,c=(i==null?void 0:i.componentOffsets)||null;let u=0;if(c)for(let M=0;M<c.length-1;M++){const O=c[M+1]-c[M];O>u&&(u=O)}else u=s;const d=Math.floor(1.1*u)+1;(Wf==null||Wf.length<2*d)&&(Wf=new Uint32Array(gbe(2*d)));for(let M=0;M<2*d;M++)Wf[M]=0;let p=0;const m=!!c&&!!a,g=m?l:s;let y=Cz(s);const v=new Uint32Array(l),b=1.96;let w=o!==0?Math.ceil(4*b*b/(o*o)*o*(1-o)):g,x=1,T=c?c[1]:g;for(let M=0;M<g;M++){if(M===w){const z=1-p/M;if(z+b*Math.sqrt(z*(1-z)/M)<o)return null;w*=2}if(M===T){for(let z=0;z<2*d;z++)Wf[z]=0;if(a)for(let z=c[x-1];z<c[x];z++)v[z]=y[a[z]];T=c[++x]}const O=m?a[M]:M,D=O*e,k=kft(n,D,e);let U=k%d,H=p;for(;Wf[2*U+1]!==0;){if(Wf[2*U]===k){const z=Wf[2*U+1]-1;if(Nft(n,D,z*e,e)){H=y[z];break}}U++,U>=d&&(U-=d)}H===p&&(Wf[2*U]=k,Wf[2*U+1]=O+1,p++),y[O]=H}if(o!==0&&1-p/s<o)return null;if(m){for(let M=c[x-1];M<v.length;M++)v[M]=y[a[M]];y=fg(v)}const C=r?new Array(p):new Uint32Array(p*e);p=0;for(let M=0;M<g;M++)y[M]===p&&(Fft(n,(m?a[M]:M)*e,C,p*e,e),p++);if(a&&!m){const M=new Uint32Array(l);for(let O=0;O<M.length;O++)M[O]=y[a[O]];y=fg(M)}return{buffer:Array.isArray(C)?C:C.buffer,indices:y,uniqueCount:p}}function Nft(t,e,i,r){for(let s=0;s<r;s++)if(t[e+s]!==t[i+s])return!1;return!0}function Fft(t,e,i,r,s){for(let n=0;n<s;n++)i[r+n]=t[e+n]}function kft(t,e,i){let r=0;for(let s=0;s<i;s++)r=t[e+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let Wf=null;function uWt(t){const e=kL(t.rings,t.hasZ,Ag.CCW_IS_HOLE,t.spatialReference),i=new Array;let r=0,s=0;for(const a of e.polygons){const l=a.count,c=a.index,u=Nd(e.position,3*c,3*l),d=a.holeIndices.map(m=>m-c),p=fg(pA(u,d,3));i.push({position:u,faces:p}),r+=u.length,s+=p.length}const n=Uft(i,r,s),o=Array.isArray(n.position)?TX(n.position,3,{originalIndices:n.faces}):TX(n.position.buffer,6,{originalIndices:n.faces});return n.position=YAe(new Float64Array(o.buffer)),n.faces=o.indices,n}function Uft(t,e,i){if(t.length===1)return t[0];const r=ho(e),s=new Array(i);let n=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)r[n++]=l.position[c];for(const c of l.faces)s[o++]=c+a;a=n/3}return{position:r,faces:fg(s)}}function kL(t,e,i,r){const s=t.length,n=new Array(s),o=new Array(s),a=new Array(s);let l=0;for(let g=0;g<s;++g)l+=t[g].length;let c=0,u=0,d=0;const p=ho(3*l);let m=0;for(let g=s-1;g>=0;g--){const y=t[g],v=i===Ag.CCW_IS_HOLE&&zft(y,e,r);if(v&&s!==1)n[c++]=y;else{let b=y.length;for(let x=0;x<c;++x)b+=n[x].length;const w={index:m,pathLengths:new Array(c+1),count:b,holeIndices:new Array(c)};w.pathLengths[0]=y.length,y.length>0&&(a[d++]={index:m,count:y.length}),m=v?VN(y,y.length-1,-1,p,m,y.length,e):VN(y,0,1,p,m,y.length,e);for(let x=0;x<c;++x){const T=n[x];w.holeIndices[x]=m,w.pathLengths[x+1]=T.length,T.length>0&&(a[d++]={index:m,count:T.length}),m=VN(T,0,1,p,m,T.length,e)}c=0,w.count>0&&(o[u++]=w)}}for(let g=0;g<c;++g){const y=n[g];y.length>0&&(a[d++]={index:m,count:y.length}),m=VN(y,0,1,p,m,y.length,e)}return o.length=u,a.length=d,{position:p,polygons:o,outlines:a}}function VN(t,e,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const l=t[e];r[s++]=l[0],r[s++]=l[1],r[s++]=o?l[2]:0,e+=i}return s/3}function zft(t,e,i){if(!e)return!xO(t);const r=t.length-1;switch(V$e(t,r,i)){case hs.X:return!xO(t,hs.Y,hs.Z);case hs.Y:return!xO(t,hs.X,hs.Z);case hs.Z:return!xO(t,hs.X,hs.Y)}}var Ag;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Ag||(Ag={}));var sI,Kz,EX;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(sI||(sI={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(Kz||(Kz={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(EX||(EX={}));var Mn,Ed,nI,mn;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(Mn||(Mn={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Ed||(Ed={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(nI||(nI={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(mn||(mn={}));let Vft=class{constructor(e,i){this.vec3=e,this.id=i}};function eV(t,e,i,r){return new Vft($e(t,e,i),r)}let rpe=class{constructor(){this._extent=Ht(),this.resolution=0,this.renderLocalOrigin=eV(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new Bft}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const i=.001*e.range;if(this._extent[0]-i<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];DU(this._extent,e.range,0,r)}if(this._extent[2]+i>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];DU(this._extent,-e.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,T0(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const i=this.canvasGeometries.extents[e];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}},Bft=class{constructor(){this.extents=[Ht(),Ht(),Ht()],this.numViews=0}};var Yr;(function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.WaterNormal=3]="WaterNormal",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(Yr||(Yr={}));let Gft=class{constructor(e,i,r){this._fbos=e,this._format=i,this._name=r}get valid(){var e;return((e=this._handle)==null?void 0:e.getTexture())!=null}dispose(){this._handle=ti(this._handle)}get texture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}bind(e,i,r){var s,n,o,a,l,c;this._handle&&((s=this._handle.fbo)==null?void 0:s.width)===i&&((n=this._handle.fbo)==null?void 0:n.height)===r||((o=this._handle)==null||o.release(),this._handle=this._fbos.acquire(i,r,this._name,this._format)),e.unbindTexture((l=(a=this._handle)==null?void 0:a.fbo)==null?void 0:l.colorTexture),e.bindFramebuffer((c=this._handle)==null?void 0:c.fbo)}generateMipMap(){var e,i,r,s,n;(r=(i=(e=this._handle)==null?void 0:e.getTexture())==null?void 0:i.descriptor)!=null&&r.hasMipmap&&((n=(s=this._handle)==null?void 0:s.getTexture())==null||n.generateMipmap())}},d2=class{constructor(e,i,r,s,n=Xr.RGBA_MIPMAP){this.output=r,this.content=s,this.fbo=new Gft(e,n,i)}get valid(){return this.fbo.valid}},jft=class{constructor(e){this.targets=[new d2(e,"overlay color",G.Color,Yr.Color),new d2(e,"overlay IM color",G.Color,Yr.ColorNoRasterImage),new d2(e,"overlay highlight",G.Highlight,Yr.Highlight,Xr.RGBA4),new d2(e,"overlay water",G.Normal,Yr.WaterNormal),new d2(e,"overlay occluded",G.Color,Yr.Occluded)],re("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new d2(e,"overlay oid",G.ObjectAndLayerIdColor,Yr.ObjectAndLayerIdColor))}getTexture(e){var i;return(i=this.targets[e])==null?void 0:i.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce((e,i,r)=>i.valid?e|=1<<r:e,0)}},oj=class extends SRe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=E(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var $l;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight",t[t.ViewshedShadowMap=3]="ViewshedShadowMap"})($l||($l={}));let Hft=class extends oj{constructor(){super(...arguments),this.identifier=$l.Material,this.output=G.Color,this.transparent=!1}},qft=class extends oj{constructor(){super(...arguments),this.identifier=$l.ShadowMap}},Wft=class extends oj{constructor(){super(...arguments),this.identifier=$l.Highlight}},Yft=class extends oj{constructor(){super(...arguments),this.identifier=$l.ViewshedShadowMap}};function Zft(t){t.fragment.code.add(S`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function Xft(t){t.fragment.code.add(S`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function Jft(t,e){const i=t.fragment;i.include(Ig),i.uniforms.add(new Fr("nearFar",(r,s)=>s.camera.nearFar)),i.uniforms.add(new mt("depthMap",(r,s)=>{var n;return(n=s.depth)==null?void 0:n.attachment})),i.uniforms.add(new ss("proj",(r,s)=>s.camera.projectionMatrix)),i.uniforms.add(new qe("invResolutionHeight",(r,s)=>1/s.camera.height)),i.uniforms.add(new ss("reprojectionMatrix",(r,s)=>s.ssr.reprojectionMatrix)),i.code.add(S`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function B$e(t,e){t.include(kdt,e),t.include(gG),t.include(Xft),e.hasCloudsReflections&&t.include(YMe,e),e.hasScreenSpaceReflections&&t.include(Jft,e);const i=t.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",DRe).add("ssrHeightFadeEnd","float",Jz).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(S`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add(new qe("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new qe("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)),i.code.add(S`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&i.code.add(S`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(i.uniforms.add(new ss("view",(r,s)=>s.camera.viewMatrix),new mt("lastFrameColorTexture",(r,s)=>{var n;return(n=s.ssr.lastFrameColor)==null?void 0:n.getTexture()}),new qe("fadeFactorSSR",(r,s)=>s.ssr.fadeFactor)),i.code.add(S`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):i.code.add(S`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?i.code.add(S`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(S`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(S`return waterRenderedColor;
}`)}var ig;function Qft(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new Wz("overlayTexOffset",(s,n)=>Kft(s,n)),new Wz("overlayTexScale",(s,n)=>emt(s,n))),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new mt("ovColorTex",(s,n)=>j$e(s,n))),G$e(t,e)}function WP(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new spe("overlayTexOffset"),new spe("overlayTexScale")),r.uniforms.add(new qe("overlayOpacity",s=>s.overlayOpacity),new mt("ovColorTex",(s,n)=>{var o;return(o=n.overlay)==null?void 0:o.getTexture(s.overlayContent)})),G$e(t,e)}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(ig||(ig={}));let spe=class extends Fs{constructor(e){super(e,"vec4")}};function G$e(t,e){e.pbrMode!==xt.Water&&e.pbrMode!==xt.WaterOnIntegratedMesh&&e.pbrMode!==xt.TerrainWithWater||t.include(B$e,e);const{vertex:i,fragment:r}=t;t.varyings.add("vtcOverlay","vec4"),i.code.add(S`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(S`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(S`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),r.code.add(S`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==xt.Water&&e.pbrMode!==xt.WaterOnIntegratedMesh&&e.pbrMode!==xt.TerrainWithWater||(G0(r),Lg(r),r.code.add(S`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function j$e(t,e){var i,r,s;return t.identifier===$l.Material&&t.output===G.Color?(i=e.overlay)==null?void 0:i.getTexture(Yr.ColorNoRasterImage):t.identifier===$l.Material&&t.output===G.ObjectAndLayerIdColor?(r=e.overlay)==null?void 0:r.getTexture(Yr.ObjectAndLayerIdColor):t.identifier===$l.Highlight?(s=e.overlay)==null?void 0:s.getTexture(Yr.Highlight):null}function Kft(t,e){var s,n,o,a;const i=(n=(s=e.overlay)==null?void 0:s.overlays[Mn.INNER])==null?void 0:n.extent;LU(i)&&(Wm[0]=t.toMapSpace[0]/Xa(i)-i[0]/Xa(i),Wm[1]=t.toMapSpace[1]/_c(i)-i[1]/_c(i));const r=(a=(o=e.overlay)==null?void 0:o.overlays[Mn.OUTER])==null?void 0:a.extent;return LU(r)&&(Wm[2]=t.toMapSpace[0]/Xa(r)-r[0]/Xa(r),Wm[3]=t.toMapSpace[1]/_c(r)-r[1]/_c(r)),Wm}function emt(t,e){var s,n,o,a;const i=(n=(s=e.overlay)==null?void 0:s.overlays[Mn.INNER])==null?void 0:n.extent;LU(i)&&(Wm[0]=t.toMapSpace[2]/Xa(i),Wm[1]=t.toMapSpace[3]/_c(i));const r=(a=(o=e.overlay)==null?void 0:o.overlays[Mn.OUTER])==null?void 0:a.extent;return LU(r)&&(Wm[2]=t.toMapSpace[2]/Xa(r),Wm[3]=t.toMapSpace[3]/_c(r)),Wm}const Wm=Qt();let jre=class extends $r{constructor(){super(...arguments),this.color=$e(1,1,1)}};function H$e(){const t=new Vi;return t.include(Oa),t.fragment.uniforms.add(new mt("tex",e=>e.texture),new Vt("uColor",e=>e.color)),t.fragment.code.add(S`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);
}`),t}const tmt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:jre,build:H$e},Symbol.toStringTag,{value:"Module"}));let q$e=class{constructor(e){this._context=e,this._perConstructorInstances=new q1,this._frameCounter=0,this._keepAliveFrameCount=npe}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,i=rmt){const r=i.key;let s=this._perConstructorInstances.get(e,r);if(s==null){const n=new e(this._context,i,()=>this.release(n));s=new imt(n),this._perConstructorInstances.set(e,r,s)}return++s.refCount,s.technique}releaseAndAcquire(e,i,r){if(r!=null){if(i.key===r.key)return r;this.release(r)}return this.acquire(e,i)}release(e){if(e==null||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(e.constructor,e.key);i!=null&&(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==npe&&this._perConstructorInstances.forEach((e,i)=>{e.forEach((r,s)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,s))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((i,r)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};e.push(s(i,r))}),await Promise.all(e)}},imt=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const npe=-1,rmt=new jl;let W$e=class{constructor(e,i,r,s){this._textures=e,this._techniques=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new q1}dispose(){this._textures.destroy()}acquire(e,i,r){this._ownMaterial(e);const s=e.produces.get(i);if(!(s!=null&&s(r)))return null;let n=this._id2glMaterialRef.get(r,e.id);if(n==null){const o=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:r});n=new smt(o),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,i){const r=this._id2glMaterialRef.get(i,e.id);r!=null&&(r.unref(),r.referenced||(It(r.glMaterial),this._id2glMaterialRef.delete(i,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&ie.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},smt=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,ft(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const nmt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];let tV=class CX{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,i){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new Eo,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}destroy(){this._degenerateObjects.clear(),Eo.clearPool(),MX[0]=null,Xw.prune(),Jw.prune()}add(e,i=e.length){this._objectCount+=i,this._grow(e,i);const r=Eo.acquire();for(let s=0;s<i;s++){const n=e[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}Eo.release(r)}remove(e,i=null){this._objectCount-=e.length;const r=Eo.acquire();for(const s of e){const n=i??WS(this.objectToBoundingSphere(s),fmt);SR(n[3])?(r.init(this._root),omt(s,n,r)):this._degenerateObjects.delete(s)}Eo.release(r),this._shrink()}update(e,i){if(!SR(i[3])&&this._isDegenerate(e))return;const r=pmt(e);this.remove(r,i),this.add(r)}forEachAlongRay(e,i,r){const s=Mh(e,i);jb(this._root,n=>{if(!lmt(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(e,i,r,s){const n=Mh(e,i);jb(this._root,o=>{if(!cmt(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(e){jb(this._root,i=>{const r=i.node;return r.terminals.forAll(e),r.residents!==null&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,i,r,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=iH(e,i),u=d=>{if(--n,!s(d))return;const p=this.objectToBoundingSphere(d);if(!Zv(r,p))return;const m=Pv(e,i,p),g=m-p[3],y=m+p[3];g<o&&(o=g,a=y,l=d)};return ope(this._root,d=>{if(n<=0||!Zv(r,d.bounds)||(oe(kh,c,d.halfSize),me(kh,kh,d.bounds),Pv(e,i,kh)>a))return!1;const p=d.node;return p.terminals.forAll(m=>u(m)),p.residents!==null&&p.residents.forAll(m=>u(m)),!0},e,i),l}forEachInDepthRange(e,i,r,s,n,o,a){let l=-1/0,c=1/0;const u={setRange:y=>{r===CX.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,y.near),c=Math.min(c,y.far)):(l=Math.max(l,-y.far),c=Math.min(c,-y.near))}};u.setRange(s);const d=Pv(i,r,e),p=iH(i,r),m=iH(i,-r),g=y=>{if(!a(y))return;const v=this.objectToBoundingSphere(y),b=v,w=Pv(i,r,b)-d,x=w-v[3],T=w+v[3];x>c||T<l||!Zv(o,v)||n(y,u)};ope(this._root,y=>{if(!Zv(o,y.bounds)||(oe(kh,p,y.halfSize),me(kh,kh,y.bounds),Pv(i,r,kh)-d>c)||(oe(kh,m,y.halfSize),me(kh,kh,y.bounds),Pv(i,r,kh)-d<l))return!1;const v=y.node;return v.terminals.forAll(b=>g(b)),v.residents!==null&&v.residents.forAll(b=>g(b)),!0},i,r)}forEachNode(e){jb(this._root,i=>e(i.node,i.bounds,i.halfSize,i.depth))}forEachNeighbor(e,i){const r=n1(i),s=i,n=l=>{const c=this.objectToBoundingSphere(l),u=n1(c),d=r+u;return!(Ko(c,s)-d*d<=0)||e(l)};let o=!0;const a=l=>{o&&(o=n(l))};jb(this._root,l=>{const c=n1(l.bounds),u=r+c;if(Ko(l.bounds,s)-u*u>0)return!1;const d=l.node;return d.terminals.forAll(a),o&&d.residents!==null&&d.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsObject(e,i){const r=this.objectToBoundingSphere(i);return!(r[3]>0)||I7(r,e)}_intersectsObjectWithOffset(e,i,r){const s=this.objectToBoundingSphere(i);return!(s[3]>0)||I7(r.applyToBoundingSphere(s),e)}_add(e,i){i.advanceTo(this.objectToBoundingSphere(e))?i.node.terminals.push(e):(i.node.residents.push(e),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(e){const i=e.node.residents;e.node.residents=null;for(let r=0;r<i.length;r++){const s=Eo.acquire().init(e);this._add(i.at(r),s),Eo.release(s)}}_grow(e,i){if(i!==0&&(ape(e,i,r=>this.objectToBoundingSphere(r),ey),SR(ey[3])&&!this._fitsInsideTree(ey)))if(Y$e(this._root.node))WS(ey,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const r=this._rootBoundsForRootAsSubNode(ey);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(ey,r):this._growRootAsSubNode(r),Eo.release(r)}}_rebuildTree(e,i){ce(sH,i.bounds),sH[3]=i.halfSize,ape([e,sH],2,s=>s,nH);const r=Eo.acquire().init(this._root);this._root.initFrom(null,nH,nH[3]),this._root.increaseHalfSize(1.25),jb(r,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),Eo.release(r)}_placingRootViolatesMaxDepth(e){const i=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return jb(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const i=e[3],r=e;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(r[l]-i),u=r[l]+i-(n[l]+o),d=Math.max(0,Math.ceil(c/(2*o))),p=Math.max(0,Math.ceil(u/(2*o)))+1,m=2**Math.ceil(Math.log(d+p)*Math.LOG2E);s=Math.max(s,m),BN[l].min=d,BN[l].max=p}for(let l=0;l<3;l++){let c=BN[l].min,u=BN[l].max;const d=(s-(c+u))/2;c+=Math.ceil(d),u+=Math.floor(d);const p=n[l]-o-c*o*2;rH[l]=p+(u+c)*o}const a=s*o;return rH[3]=a*X$e,Eo.acquire().initFrom(null,rH,a,0)}_growRootAsSubNode(e){const i=this._root.node;ce(ey,this._root.bounds),ey[3]=this._root.halfSize,this._root.init(e),e.advanceTo(ey,null,!0),e.node.children=i.children,e.node.residents=i.residents,e.node.terminals=i.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&e==null;)r=s++,e=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(e){return!SR(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const i=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=i[0]-r&&e[0]<=i[0]+r&&e[1]>=i[1]-r&&e[1]<=i[1]+r&&e[2]>=i[2]-r&&e[2]<=i[2]+r}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:i,_objectCount:r}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:i,objectCount:r,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(e){var n,o;const i=e.children.map(a=>a?this._nodeToJSON(a):null),r=(n=e.residents)==null?void 0:n.map(a=>this.objectToBoundingSphere(a)),s=(o=e.terminals)==null?void 0:o.map(a=>this.objectToBoundingSphere(a));return{children:i,residents:r,terminals:s}}static fromJSON(e){const i=new CX(r=>r,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return i._objectCount=e.objectCount,i._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),i}},Eo=class _E{constructor(){this.bounds=ln(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,i,r,s=this.depth){return this.node=e??_E.createEmptyNode(),i&&WS(i,this.bounds),this.halfSize=r,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*X$e}advance(e){let i=this.node.children[e];i||(i=_E.createEmptyNode(),this.node.children[e]=i),this.node=i,this.halfSize/=2,this.depth++;const r=Z$e[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,i,r=!1){for(;;){if(this.isTerminalFor(e))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);i&&i(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const i=this.bounds;return(i[0]<e[0]?1:0)+(i[1]<e[1]?2:0)+(i[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Zt({shrink:!0}),residents:new Zt({shrink:!0})}}static acquire(){return _E._pool.acquire()}static release(e){_E._pool.release(e)}static clearPool(){_E._pool.prune()}};function jb(t,e){let i=Eo.acquire().init(t);const r=[i];for(;r.length!==0;){if(i=r.pop(),e(i)&&!i.isLeaf())for(let s=0;s<i.node.children.length;s++)i.node.children[s]&&r.push(Eo.acquire().init(i).advance(s));Eo.release(i)}}function ope(t,e,i,r=tV.DepthOrder.FRONT_TO_BACK){let s=Eo.acquire().init(t);const n=[s];for(dmt(i,r,cpe);n.length!==0;){if(s=n.pop(),e(s)&&!s.isLeaf())for(let o=7;o>=0;--o){const a=cpe[o];s.node.children[a]&&n.push(Eo.acquire().init(s).advance(a))}Eo.release(s)}}function omt(t,e,i){Xw.clear();const r=i.advanceTo(e,(s,n)=>{Xw.push(s.node),Xw.push(n)})?i.node.terminals:i.node.residents;if(r.removeUnordered(t),r.length===0)for(let s=Xw.length-2;s>=0&&amt(Xw.data[s],Xw.data[s+1]);s-=2);}function amt(t,e){return e>=0&&(t.children[e]=null),!!Y$e(t)&&(t.residents===null&&(t.residents=new Zt({shrink:!0})),!0)}function lmt(t,e){return iV(e.bounds,2*-e.halfSize,sh),iV(e.bounds,2*e.halfSize,nh),bMe(t.origin,t.direction,sh,nh)}function cmt(t,e,i){return iV(e.bounds,2*-e.halfSize,sh),iV(e.bounds,2*e.halfSize,nh),i.applyToMinMax(sh,nh),bMe(t.origin,t.direction,sh,nh)}function Y$e(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let e=0;e<t.children.length;e++)if(t.children[e])return!1;return!0}function umt(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function hmt(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function iV(t,e,i){i[0]=t[0]+e,i[1]=t[1]+e,i[2]=t[2]+e}function ape(t,e,i,r){if(e===1){const s=i(t[0]);WS(s,r)}else{sh[0]=1/0,sh[1]=1/0,sh[2]=1/0,nh[0]=-1/0,nh[1]=-1/0,nh[2]=-1/0;for(let s=0;s<e;s++){const n=i(t[s]);SR(n[3])&&(umt(sh,n),hmt(nh,n))}yr(r,sh,nh,.5),r[3]=Math.max(nh[0]-sh[0],nh[1]-sh[1],nh[2]-sh[2])/2}}function dmt(t,e,i){if(!Jw.length)for(let r=0;r<8;++r)Jw.push({index:0,distance:0});for(let r=0;r<8;++r){const s=Z$e[r];Jw.data[r].index=r,Jw.data[r].distance=Pv(t,e,s)}Jw.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=Jw.data[r].index}function iH(t,e){let i,r=1/0;for(let s=0;s<8;++s){const n=Pv(t,e,lpe[s]);n<r&&(r=n,i=lpe[s])}return i}function Pv(t,e,i){return e*(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])}function SR(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}Eo._pool=new Ca(Eo),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(tV||(tV={}));const Z$e=[$e(-1,-1,-1),$e(1,-1,-1),$e(-1,1,-1),$e(1,1,-1),$e(-1,-1,1),$e(1,-1,1),$e(-1,1,1),$e(1,1,1)],lpe=[$e(-1,-1,-1),$e(-1,-1,1),$e(-1,1,-1),$e(-1,1,1),$e(1,-1,-1),$e(1,-1,1),$e(1,1,-1),$e(1,1,1)],X$e=Math.sqrt(3),MX=[null];function pmt(t){return MX[0]=t,MX}const rH=ln(),kh=E(),sh=E(),nh=E(),Xw=new Zt,fmt=ln(),ey=ln(),sH=ln(),nH=ln(),BN=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],Jw=new Zt,cpe=[0,0,0,0,0,0,0,0],uf=tV;var p1;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(p1||(p1={}));let J$e=class extends bL{get objects(){return this._objects}constructor(e,i,r=""){super(),this.stage=e,this.apiLayerUid=r,this.type=Ls.Layer,this.events=new cn,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new Zt,this._objectsAdded=new Zt,this._handles=new Pg,this.apiLayerUid=r,this.visible=(i==null?void 0:i.visible)??!0,this.pickable=(i==null?void 0:i.pickable)??!0,this.updatePolicy=(i==null?void 0:i.updatePolicy)??p1.ASYNC,this._disableOctree=(i==null?void 0:i.disableOctree)??!1,e.add(this);for(const s of nmt)this._handles.add(this.events.on(s,n=>e.handleEvent(s,n)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const i of e)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const i=new Array;if(this._objects.removeUnorderedMany(e,e.length,i),i.length!==0){for(const r of i)r.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),this._octree!=null){for(let r=0;r<i.length;)this._objectsAdded.removeUnordered(i[r])?(i[r]=i[i.length-1],i.length-=1):++r;this._octree.remove(i)}}}sync(){this.updatePolicy!==p1.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,i){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,i)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new uf(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=Le(this._octree),this._objectsAdded.clear()}};function rV(t){return t!=null&&t.type===Ls.Layer}var Cc,nT;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(Cc||(Cc={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(nT||(nT={}));let bo=class extends Ec{constructor(){super(...arguments),this.output=G.Color,this.transparencyPassType=nt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=Cc.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=nT.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===Cc.Draped}};h([B({count:G.COUNT})],bo.prototype,"output",void 0),h([B({count:nt.COUNT})],bo.prototype,"transparencyPassType",void 0),h([B()],bo.prototype,"occluder",void 0),h([B()],bo.prototype,"hasSlicePlane",void 0),h([B()],bo.prototype,"writeDepth",void 0),h([B({count:Cc.COUNT})],bo.prototype,"space",void 0),h([B()],bo.prototype,"hideOnShortSegments",void 0),h([B()],bo.prototype,"hasCap",void 0),h([B({count:nT.COUNT})],bo.prototype,"anchor",void 0),h([B()],bo.prototype,"hasTip",void 0),h([B()],bo.prototype,"vvSize",void 0),h([B()],bo.prototype,"vvColor",void 0),h([B()],bo.prototype,"vvOpacity",void 0),h([B()],bo.prototype,"hasOccludees",void 0),h([B()],bo.prototype,"multipassEnabled",void 0),h([B()],bo.prototype,"cullAboveGround",void 0),h([B({constValue:!1})],bo.prototype,"occlusionPass",void 0),h([B({constValue:!0})],bo.prototype,"hasVvInstancing",void 0),h([B({constValue:!0})],bo.prototype,"hasSliceTranslatedView",void 0);const upe=8;function Q$e(t,e){const i=t.vertex;i.uniforms.add(new qe("intrinsicWidth",r=>r.width)),e.vvSize?(t.attributes.add(R.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new Vt("vvSizeMinSize",r=>r.vvSize.minSize),new Vt("vvSizeMaxSize",r=>r.vvSize.maxSize),new Vt("vvSizeOffset",r=>r.vvSize.offset),new Vt("vvSizeFactor",r=>r.vvSize.factor)),i.code.add(S`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(R.SIZE,"float"),i.code.add(S`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(R.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add(new Fl("vvOpacityValues",r=>r.vvOpacity.values,upe),new Fl("vvOpacityOpacities",r=>r.vvOpacity.opacityValues,upe)),i.code.add(S`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(S`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(g0,e),t.attributes.add(R.COLORFEATUREATTRIBUTE,"float"),i.code.add(S`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(R.COLOR,"vec4"),i.code.add(S`vec4 getColor(){
return applyOpacity(color);
}`))}let K$e=class{constructor(e,i,r){this._createTexture=e,this._parametersKey=i,this._repository=new Map,this._orphanCache=r.newCache(`procedural-texture-repository:${_h()}`,s=>s.dispose())}destroy(){for(const[e,{texture:i}]of this._repository)i.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,i=null){const r=this._acquire(e);return this.release(i),r}release(e){if(e==null)return;const i=this._parametersKey(e),r=this._repository.get(i);if(r&&(r.refCount--,r.refCount===0)){this._repository.delete(i);const{texture:s}=r,n=s.usedMemory;this._orphanCache.put(i,s,n)}}_acquire(e){if(e==null)return null;const i=this._parametersKey(e),r=this._repository.get(i);if(r)return r.refCount++,r.texture;const s=this._orphanCache.pop(i)??this._createTexture(e),n=new mmt(s);return this._repository.set(i,n),s}},mmt=class{constructor(e){this.texture=e,this.refCount=1}};function gmt(t,e){return new K$e(i=>{const{encodedData:r,textureSize:s}=ymt(i),n=new jr;return n.internalFormat=Ft.RGBA,n.width=s,n.height=1,n.wrapMode=bi.REPEAT,new br(t,n,r)},i=>`${i.pattern.join(",")}-r${i.pixelRatio}`,e)}function ymt(t){const e=Hre(t),i=1/t.pixelRatio,r=eIe(t),s=tIe(t),n=(Math.floor(.5*(s-1))+.5)*i,o=[];let a=1;for(const p of e){for(let m=0;m<p;m++){const g=a*(Math.min(m,p-1-m)+.5)*i/n*.5+.5;o.push(g)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],u=new Uint8Array(4*r);let d=0;for(const p of c)_re(p,u,d),d+=4;return{encodedData:u,textureSize:r}}function Hre(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function eIe(t){if(t==null)return 1;const e=Hre(t);return Math.floor(e.reduce((i,r)=>i+r))}function tIe(t){return Hre(t).reduce((e,i)=>Math.max(e,i))}function _mt(t){return t==null?wh:t.length===4?t:ds(vmt,t[0],t[1],t[2],1)}const vmt=Qt();function bmt(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?wmt(t,e):xmt(t)}function wmt(t,e){const i=!(e.draped&&e.stipplePreferContinuous),{vertex:r,fragment:s}=t;s.include(Uf),e.draped||(Rf(r,e),r.uniforms.add(new qe("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),r.code.add(S`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),t.varyings.add("vStippleDistanceLimits","vec2"),t.varyings.add("vStipplePatternStretch","float"),r.code.add(S`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${Tmt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(S`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(S`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),YA(r),r.code.add(S`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),s.uniforms.add(new mt("stipplePatternTexture",n=>n.stippleTexture),new qe("stipplePatternSDFNormalizer",n=>Smt(n.stipplePattern)),new qe("stipplePatternPixelSizeInv",n=>1/iIe(n))),s.code.add(S`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),e.stippleOffColorEnabled?(s.uniforms.add(new zi("stippleOffColor",n=>_mt(n.stippleOffColor))),s.code.add(S`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(S`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function xmt(t){t.fragment.code.add(S`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function Smt(t){return t?(Math.floor(.5*(tIe(t)-1))+.5)/t.pixelRatio:1}function iIe(t){const e=t.stipplePattern;return e?eIe(t.stipplePattern)/e.pixelRatio:1}const Tmt=S.float(.4);async function R0(t,e){const{data:i}=await Yt(t,{responseType:"image",...e});return i}function Emt(){return hpe??(hpe=(async()=>{const t=await fe(()=>import("./basis_transcoder-B40h2JNH.js"),[]),e=await t.default({locateFile:i=>mr(`esri/libs/basisu/${i}`)});return e.initializeBasis(),e})()),hpe}let hpe;var Rx;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(Rx||(Rx={}));let vf=null,GN=null;async function rIe(){return GN==null&&(GN=Emt(),vf=await GN),GN}function Cmt(t,e){if(vf==null)return t.byteLength;const i=new vf.BasisFile(new Uint8Array(t)),r=nIe(i)?sIe(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),e):0;return i.close(),i.delete(),r}function Mmt(t,e){if(vf==null)return t.byteLength;const i=new vf.KTX2File(new Uint8Array(t)),r=oIe(i)?sIe(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),e):0;return i.close(),i.delete(),r}function sIe(t,e,i,r,s){const n=lie(e?qs.COMPRESSED_RGBA8_ETC2_EAC:qs.COMPRESSED_RGB8_ETC2),o=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(i*r*n*o)}function nIe(t){return t.getNumImages()>=1&&!t.isUASTC()}function oIe(t){return t.getFaces()>=1&&t.isETC1S()}async function Amt(t,e,i){vf==null&&(vf=await rIe());const r=new vf.BasisFile(new Uint8Array(i));if(!nIe(r))return null;r.startTranscoding();const s=aIe(t,e,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,o)=>r.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>r.transcodeImage(a,0,n,o,0,0));return r.close(),r.delete(),s}async function Pmt(t,e,i){vf==null&&(vf=await rIe());const r=new vf.KTX2File(new Uint8Array(i));if(!oIe(r))return null;r.startTranscoding();const s=aIe(t,e,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,o)=>r.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>r.transcodeImage(a,n,0,0,o,0,-1,-1));return r.close(),r.delete(),s}function aIe(t,e,i,r,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[u,d]=l?r?[Rx.ETC2_RGBA,qs.COMPRESSED_RGBA8_ETC2_EAC]:[Rx.ETC1_RGB,qs.COMPRESSED_RGB8_ETC2]:c?r?[Rx.BC3_RGBA,qs.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[Rx.BC1_RGB,qs.COMPRESSED_RGB_S3TC_DXT1_EXT]:[Rx.RGBA32,Ft.RGBA],p=e.hasMipmap?i:Math.min(1,i),m=[];for(let g=0;g<p;g++)m.push(new Uint8Array(o(g,u))),a(g,u,m[g]);return e.internalFormat=d,e.hasMipmap=m.length>1,e.samplingMode=e.hasMipmap?ii.LINEAR_MIPMAP_LINEAR:ii.LINEAR,e.width=s,e.height=n,new br(t,e,{type:"compressed",levels:m})}const jN=()=>ie.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),Omt=542327876,Rmt=131072,$mt=4;function qre(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function Imt(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const Lmt=qre("DXT1"),Dmt=qre("DXT3"),Nmt=qre("DXT5"),Fmt=31,kmt=0,Umt=1,zmt=2,Vmt=3,Bmt=4,Gmt=7,jmt=20,Hmt=21;function qmt(t,e,i){const r=Wmt(i,e.hasMipmap??!1);if(r==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:o,height:a}=r;return e.samplingMode=s.levels.length>1?ii.LINEAR_MIPMAP_LINEAR:ii.LINEAR,e.hasMipmap=s.levels.length>1,e.internalFormat=n,e.width=o,e.height=a,new br(t,e,s)}function Wmt(t,e){const i=new Int32Array(t,0,Fmt);if(i[kmt]!==Omt)return jN().error("Invalid magic number in DDS header"),null;if(!(i[jmt]&$mt))return jN().error("Unsupported format, must contain a FourCC code"),null;const r=i[Hmt];let s,n;switch(r){case Lmt:s=8,n=qs.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Dmt:s=16,n=qs.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Nmt:s=16,n=qs.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return jN().error("Unsupported FourCC code:",Imt(r)),null}let o=1,a=i[Bmt],l=i[Vmt];(3&a||3&l)&&(jN().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let d,p;i[zmt]&Rmt&&e!==!1&&(o=Math.max(1,i[Gmt]));let m=i[Umt]+4;const g=[];for(let y=0;y<o;++y)p=(a+3>>2)*(l+3>>2)*s,d=new Uint8Array(t,m,p),g.push(d),m+=p,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:n,width:c,height:u}}let J1=class extends bL{get parameters(){return this._parameters}constructor(e,i){super(),this._data=e,this.type=Ls.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new cn,this._parameters={...Zmt,...i},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?(this.frameUpdate=i=>this._frameUpdate(e,i),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(TM(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const i=!e.paused;if(e.src=e.src,i&&e.autoplay){const r=()=>{e.removeEventListener("canplay",r),e.play()};e.addEventListener("canplay",r)}}}_startPreloadImageElement(e){Og(e.src)||TM(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const i=new jr;return i.wrapMode=this._parameters.wrap??bi.REPEAT,i.flipped=!this._parameters.noUnpackFlip,i.samplingMode=this._parameters.mipmap?ii.LINEAR_MIPMAP_LINEAR:ii.LINEAR,i.hasMipmap=!!this._parameters.mipmap,i.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,i.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),i}get glTexture(){return this._glTexture}get memoryEstimate(){var e;return((e=this._glTexture)==null?void 0:e.usedMemory)||Ymt(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const i=this._data;return i==null?(this._glTexture=new br(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),typeof i=="string"?this._loadFromURL(e,i):i instanceof Image?this._loadFromImageElement(e,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i):(JE(i)||Gv(i))&&this._parameters.encoding===d0.DDS_ENCODING?this._loadFromDDSData(e,i):(JE(i)||Gv(i))&&this._parameters.encoding===d0.KTX2_ENCODING?this._loadFromKTX2(e,i):(JE(i)||Gv(i))&&this._parameters.encoding===d0.BASIS_ENCODING?this._loadFromBasis(e,i):Gv(i)?this._loadFromPixelData(e,i):JE(i)?this._loadFromPixelData(e,new Uint8Array(i)):null)}_frameUpdate(e,i){return this._glTexture==null||e.readyState<oI.HAVE_CURRENT_DATA||i===e.currentTime?i:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,i){return this._glTexture=qmt(e,this._createDescriptor(e),i),this._glTexture}_loadFromKTX2(e,i){return this._loadAsync(()=>Pmt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(e,i){return this._loadAsync(()=>Amt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(e,i){ft(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat=this._parameters.components===1?Ft.LUMINANCE:this._parameters.components===3?Ft.RGB:Ft.RGBA,r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new br(e,r,i),this._glTexture}_loadFromURL(e,i){return this._loadAsync(async r=>{const s=await R0(i,{signal:r});return Et(r),this._loadFromImage(e,s)})}_loadFromImageElement(e,i){return i.complete?this._loadFromImage(e,i):this._loadAsync(async r=>{const s=await Fbe(i,i.src,!1,r);return Et(r),this._loadFromImage(e,s)})}_loadFromVideoElement(e,i){return i.readyState>=oI.HAVE_CURRENT_DATA?this._loadFromImage(e,i):this._loadFromVideoElementAsync(e,i)}_loadFromVideoElementAsync(e,i){return this._loadAsync(r=>new Promise((s,n)=>{const o=()=>{i.removeEventListener("loadeddata",a),i.removeEventListener("error",l),Or(c)},a=()=>{i.readyState>=oI.HAVE_CURRENT_DATA&&(o(),s(this._loadFromImage(e,i)))},l=u=>{o(),n(u||new V("Failed to load video"))};i.addEventListener("loadeddata",a),i.addEventListener("error",l);const c=Io(r,()=>l(Di()))}))}_loadFromImage(e,i){let r=i;if(!(r instanceof HTMLVideoElement)){const{maxTextureSize:o}=e.parameters;r=this._parameters.downsampleUncompressed?Kit(r,o):ert(r,o)}const s=lIe(r);this._parameters.width=s.width,this._parameters.height=s.height;const n=this._createDescriptor(e);return n.pixelFormat=this._parameters.components===3?Ft.RGB:Ft.RGBA,n.width=s.width,n.height=s.height,this._glTexture=new br(e,n,r),this._glTexture}_loadAsync(e){const i=new AbortController;this._loadingController=i;const r=e(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(s,s),r}unload(){if(this._glTexture=It(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function Ymt(t,e){if(t==null)return 0;if(JE(t)||Gv(t))return e.encoding===d0.KTX2_ENCODING?Mmt(t,!!e.mipmap):e.encoding===d0.BASIS_ENCODING?Cmt(t,!!e.mipmap):t.byteLength;const{width:i,height:r}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?lIe(t):e;return(e.mipmap?4/3:1)*i*r*(e.components||4)||0}function lIe(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var oI;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(oI||(oI={}));const Zmt={wrap:{s:bi.REPEAT,t:bi.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1},sV=128,Wre=.5;function Xmt(t){return t==="cross"||t==="x"}function Jmt(t,e=sV,i=e*Wre,r=0){const s=cIe(t,e,i,r);return new J1(s,{mipmap:!1,wrap:{s:bi.CLAMP_TO_EDGE,t:bi.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0,reloadable:!0})}function cIe(t,e=sV,i=e*Wre,r=0){switch(t){case"circle":default:return Qmt(e,i);case"square":return Kmt(e,i);case"cross":return tgt(e,i,r);case"x":return igt(e,i,r);case"kite":return egt(e,i);case"triangle":return rgt(e,i);case"arrow":return sgt(e,i)}}function Qmt(t,e){const i=t/2-.5;return UL(t,dIe(i,i,e/2))}function Kmt(t,e){return uIe(t,e,!1)}function egt(t,e){return uIe(t,e,!0)}function tgt(t,e,i=0){return hIe(t,e,!1,i)}function igt(t,e,i=0){return hIe(t,e,!0,i)}function rgt(t,e){return UL(t,pIe(t/2,e,e/2))}function sgt(t,e){const i=e,r=e/2,s=t/2,n=.8*i,o=dIe(s,(t-e)/2-n,Math.sqrt(n*n+r*r)),a=pIe(s,i,r);return UL(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function uIe(t,e,i){return i&&(e/=Math.SQRT2),UL(t,(r,s)=>{let n=r-.5*t+.25,o=.5*t-s-.75;if(i){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*e})}function hIe(t,e,i,r=0){e-=r,i&&(e*=Math.SQRT2);const s=.5*e;return UL(t,(n,o)=>{let a,l=n-.5*t,c=.5*t-o-1;if(i){const u=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=u}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=r/2,a})}function dIe(t,e,i){return(r,s)=>{const n=r-t,o=s-e;return Math.sqrt(n*n+o*o)-i}}function pIe(t,e,i){const r=Math.sqrt(e*e+i*i);return(s,n)=>{const o=Math.abs(s-t)-i,a=n-t+e/2+.75,l=(e*o+i*a)/r,c=-a;return Math.max(l,c)}}function UL(t,e){const i=new Uint8Array(4*t*t);for(let r=0;r<t;r++)for(let s=0;s<t;s++){const n=s+t*r;let o=e(s,r);o=o/t+.5,_re(o,i,4*n)}return i}const CS=64,Yre=CS/2,fIe=Yre/5,ngt=CS/fIe,ogt=.25;function agt(t,e){const i=cIe(t,CS,Yre,fIe),r=new jr;return r.internalFormat=Ft.RGBA,r.width=CS,r.height=CS,r.wrapMode=bi.CLAMP_TO_EDGE,new br(e,r,i)}function mIe(t,e){const{vertex:i,constants:r}=t;r.add("markerSizePerLineWidth","float",ngt),YA(i),i.uniforms.get("markerScale")==null&&i.constants.add("markerScale","float",1),i.code.add(S`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===Cc.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new qe("perRenderPixelRatio",(s,n)=>n.camera.perRenderPixelRatio)),i.code.add(S`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var Fd;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(Fd||(Fd={}));let Ms=class extends Ec{constructor(){super(...arguments),this.output=G.Color,this.capType=Fd.BUTT,this.transparencyPassType=nt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};h([B({count:G.COUNT})],Ms.prototype,"output",void 0),h([B({count:Fd.COUNT})],Ms.prototype,"capType",void 0),h([B({count:nt.COUNT})],Ms.prototype,"transparencyPassType",void 0),h([B()],Ms.prototype,"occluder",void 0),h([B()],Ms.prototype,"hasSlicePlane",void 0),h([B()],Ms.prototype,"hasPolygonOffset",void 0),h([B()],Ms.prototype,"writeDepth",void 0),h([B()],Ms.prototype,"draped",void 0),h([B()],Ms.prototype,"stippleEnabled",void 0),h([B()],Ms.prototype,"stippleOffColorEnabled",void 0),h([B()],Ms.prototype,"stipplePreferContinuous",void 0),h([B()],Ms.prototype,"roundJoins",void 0),h([B()],Ms.prototype,"applyMarkerOffset",void 0),h([B()],Ms.prototype,"vvSize",void 0),h([B()],Ms.prototype,"vvColor",void 0),h([B()],Ms.prototype,"vvOpacity",void 0),h([B()],Ms.prototype,"falloffEnabled",void 0),h([B()],Ms.prototype,"innerColorEnabled",void 0),h([B()],Ms.prototype,"hasOccludees",void 0),h([B()],Ms.prototype,"multipassEnabled",void 0),h([B()],Ms.prototype,"cullAboveGround",void 0),h([B()],Ms.prototype,"wireframe",void 0),h([B()],Ms.prototype,"objectAndLayerIdColorInstanced",void 0),h([B({constValue:!1})],Ms.prototype,"occlusionPass",void 0),h([B({constValue:!0})],Ms.prototype,"hasVvInstancing",void 0),h([B({constValue:!0})],Ms.prototype,"hasSliceTranslatedView",void 0);const y3=1;function gIe(t){const e=new Vi,{attributes:i,varyings:r,constants:s,vertex:n,fragment:o}=e;e.include(gL),e.include(Q$e,t),e.include(bmt,t);const a=t.applyMarkerOffset&&!t.draped;a&&(n.uniforms.add(new qe("markerScale",g=>g.markerScale)),e.include(mIe,{space:Cc.World,draped:!1})),e.include(LT,t),bc(n,t),n.uniforms.add(new ss("inverseProjectionMatrix",(g,y)=>y.camera.inverseProjectionMatrix),new Fr("nearFar",(g,y)=>y.camera.nearFar),new qe("miterLimit",g=>g.join!=="miter"?0:g.miterLimit),new zi("viewport",(g,y)=>y.camera.fullViewport)),n.constants.add("LARGE_HALF_FLOAT","float",65500),i.add(R.POSITION,"vec3"),i.add(R.PREVPOSITION,"vec3"),i.add(R.NEXTPOSITION,"vec3"),i.add(R.SUBDIVISIONFACTOR,"float"),i.add(R.UV0,"vec2"),r.add("vColor","vec4"),r.add("vpos","vec3"),r.add("vLineDistance","float"),r.add("vLineWidth","float");const l=t.multipassEnabled&&t.output===G.Color;l&&r.add("depth","float");const c=t.stippleEnabled;c&&r.add("vLineSizeInv","float"),s.add("aaWidth","float",t.stippleEnabled?0:1);const u=t.capType===Fd.ROUND,d=t.stippleEnabled&&u,p=t.falloffEnabled||d;p&&r.add("vLineDistanceNorm","float"),u&&(r.add("vSegmentSDF","float"),r.add("vReverseSegmentSDF","float")),n.code.add(S`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),n.code.add(S`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),n.code.add(S`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${l?"depth = pos.z;":""}

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),YA(n),n.code.add(S`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${c?S`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `),a&&n.code.add(S`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),n.code.add(S`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||u)&&n.code.add(S`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${u?S`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),n.code.add(S`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?n.code.add(S`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?S`min(1.0, subdivisionFactor * ${S.float((y3+2)/(y3+1))})`:S`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):n.code.add(S`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const m=t.capType!==Fd.BUTT;return n.code.add(S`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${m?S`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),n.code.add(S`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${p?S`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),u&&n.code.add(S`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?n.uniforms.add(new qe("worldToScreenRatio",(g,y)=>1/y.screenToPCSRatio)):n.code.add(S`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),n.code.add(S`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?n.code.add(S`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):n.code.add(S`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),n.uniforms.add(new qe("stipplePatternPixelSize",g=>iIe(g))),n.code.add(S`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),n.code.add(S`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),l&&e.include(Vg,t),e.include(gn,t),o.include(Ug),o.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${l?"terrainDepthTest(depth);":""}
  `),t.wireframe?o.code.add(S`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(u&&o.code.add(S`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${S.float(Xo)}) {
          discard;
        }
      `),d?o.code.add(S`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${S.float(Xo)}, stippleCoverage);
      `):o.code.add(S`float stippleAlpha = getStippleAlpha();`),t.output!==G.ObjectAndLayerIdColor&&o.code.add(S`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),o.uniforms.add(new zi("intrinsicColor",g=>g.color)),o.code.add(S`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(o.uniforms.add(new zi("innerColor",g=>g.innerColor??g.color),new qe("innerWidth",(g,y)=>g.innerWidth*y.camera.pixelRatio)),o.code.add(S`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),o.code.add(S`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(o.uniforms.add(new qe("falloff",g=>g.falloff)),o.code.add(S`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),t.stippleEnabled||o.code.add(S`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`)),t.transparencyPassType===nt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),o.code.add(S`
    ${t.output===G.ObjectAndLayerIdColor?S`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${S.float(Xo)}) {
      discard;
    }

    ${t.output===G.Color?S`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===G.Color&&t.transparencyPassType===nt.ColorAlpha?S`
            fragColor = premultiplyAlpha(fragColor);
            fragAlpha = fragColor.a;`:""}
    ${t.output===G.Highlight?S`fragColor = vec4(1.0);`:""}
    ${t.output===G.ObjectAndLayerIdColor?S`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const lgt=Object.freeze(Object.defineProperty({__proto__:null,build:gIe,ribbonlineNumRoundJoinSubdivisions:y3},Symbol.toStringTag,{value:"Module"})),yIe=new Map([[R.POSITION,0],[R.PREVPOSITION,1],[R.NEXTPOSITION,2],[R.SUBDIVISIONFACTOR,3],[R.UV0,4],[R.COLOR,5],[R.COLORFEATUREATTRIBUTE,5],[R.SIZE,6],[R.SIZEFEATUREATTRIBUTE,6],[R.OPACITYFEATUREATTRIBUTE,7],[R.OBJECTANDLAYERIDCOLOR,8]]);let _Ie=class vIe extends Wi{initializeProgram(e){return new Yi(e.rctx,vIe.shader.get().build(this.configuration),yIe)}_makePipelineState(e,i){const r=this.configuration,s=e===nt.NONE,n=e===nt.FrontFace,o=Sst(r.output);return Gt({blending:r.output===G.Color?s?gu:Z0(e):null,depthTest:{func:yb(e)},depthWrite:s?r.writeDepth||o?Tu:null:BG(e),drawBuffers:r.output===G.Depth?{buffers:[ao.NONE]}:X0(e),colorWrite:Kt,stencilWrite:r.hasOccludees?Mg:null,stencilTest:r.hasOccludees?i?Z1:_b:null,polygonOffset:s||n?r.hasPolygonOffset?dpe:null:jG})}initializePipeline(){const e=this.configuration;if(e.occluder){const i=e.hasPolygonOffset?dpe:null;this._occluderPipelineTransparent=Gt({blending:gu,polygonOffset:i,depthTest:Xz,depthWrite:null,colorWrite:Kt,stencilWrite:null,stencilTest:MRe,drawBuffers:e.output===G.Depth?{buffers:[ao.NONE]}:null}),this._occluderPipelineOpaque=Gt({blending:gu,polygonOffset:i,depthTest:Xz,depthWrite:null,colorWrite:Kt,stencilWrite:ERe,stencilTest:CRe,drawBuffers:e.output===G.Depth?{buffers:[ao.NONE]}:null}),this._occluderPipelineMaskWrite=Gt({blending:null,polygonOffset:i,depthTest:Ere,depthWrite:null,colorWrite:null,stencilWrite:Mg,stencilTest:Z1,drawBuffers:e.output===G.Depth?{buffers:[ao.NONE]}:null})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?vi.LINES:vi.TRIANGLE_STRIP}getPipeline(e,i,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:i?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};_Ie.shader=new Bi(lgt,()=>fe(()=>Promise.resolve().then(()=>_Ut),void 0));const dpe={factor:0,units:-4};var Hc;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(Hc||(Hc={}));let fC=class extends mb{constructor(e){super(e,new ugt),this._configuration=new Ms,this.produces=new Map([[_e.OPAQUE_MATERIAL,i=>i===G.Highlight||i===G.ObjectAndLayerIdColor||i===G.Color&&this.parameters.renderOccluded===Ji.OccludeAndTransparentStencil],[_e.OPAQUE_NO_SSAO_DEPTH,i=>h1(i)],[_e.OCCLUDER_MATERIAL,i=>rZ(i)&&this.parameters.renderOccluded===Ji.OccludeAndTransparentStencil],[_e.TRANSPARENT_OCCLUDER_MATERIAL,i=>rZ(i)&&this.parameters.renderOccluded===Ji.OccludeAndTransparentStencil],[_e.TRANSPARENT_MATERIAL,i=>i===G.Color&&this.parameters.writeDepth&&this.parameters.renderOccluded!==Ji.OccludeAndTransparentStencil],[_e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>i===G.Color&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==Ji.OccludeAndTransparentStencil],[_e.DRAPED_MATERIAL,i=>EAe(i)]]),this._vertexAttributeLocations=yIe}getConfiguration(e,i){this._configuration.output=e,this._configuration.draped=i.slot===_e.DRAPED_MATERIAL;const r=this.parameters.stipplePattern!=null&&e!==G.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&dgt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Ji.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,i,r,s,n,o){if(!r.options.selectionMode)return;const a=e.attributes.get(R.POSITION).data,l=e.attributes.get(R.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const y=e.attributes.get(R.SIZEFEATUREATTRIBUTE).data[0];c*=Te(this.parameters.vvSize.offset[0]+y*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=s[0],d=s[1],p=(c/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,g=0;for(let y=0;y<a.length-5;y+=3){const v=a[y],b=a[y+1],w=u-v,x=d-b,T=a[y+3]-v,C=a[y+4]-b,M=Te((T*w+C*x)/(T*T+C*C),0,1),O=T*M-w,D=C*M-x,k=O*O+D*D;k<m&&(m=k,g=y/3)}m<p*p&&n(o.dist,o.normal,g,!1)}intersect(e,i,r,s,n,o){if(!r.options.selectionMode||!e.visible)return;if(!wMe(i))return void ie.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes,l=a.get(R.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const w=a.get(R.SIZEFEATUREATTRIBUTE).data[0];c*=Te(this.parameters.vvSize.offset[0]+w*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(R.SIZE)&&(c*=a.get(R.SIZE).data[0]);const u=r.camera,d=pgt;Aa(d,r.point);const p=c*u.pixelRatio/2+4*u.pixelRatio;ne(YP[0],d[0]-p,d[1]+p,0),ne(YP[1],d[0]+p,d[1]+p,0),ne(YP[2],d[0]+p,d[1]-p,0),ne(YP[3],d[0]-p,d[1]-p,0);for(let w=0;w<4;w++)if(!u.unprojectFromRenderScreen(YP[w],ty[w]))return;qa(u.eye,ty[0],ty[1],aH),qa(u.eye,ty[1],ty[2],lH),qa(u.eye,ty[2],ty[3],cH),qa(u.eye,ty[3],ty[0],uH);let m=Number.MAX_VALUE,g=0;const y=bIe(this.parameters,a)?l.length-2:l.length-5;for(let w=0;w<y;w+=3){Zl[0]=l[w]+i[12],Zl[1]=l[w+1]+i[13],Zl[2]=l[w+2]+i[14];const x=(w+3)%l.length;if(Xl[0]=l[x]+i[12],Xl[1]=l[x+1]+i[13],Xl[2]=l[x+2]+i[14],Er(aH,Zl)<0&&Er(aH,Xl)<0||Er(lH,Zl)<0&&Er(lH,Xl)<0||Er(cH,Zl)<0&&Er(cH,Xl)<0||Er(uH,Zl)<0&&Er(uH,Xl)<0)continue;if(u.projectToRenderScreen(Zl,qb),u.projectToRenderScreen(Xl,Wb),qb[2]<0&&Wb[2]>0){ve(Yf,Zl,Xl);const C=u.frustum,M=-Er(C[_r.NEAR],Zl)/pe(Yf,C[_r.NEAR]);oe(Yf,Yf,M),me(Zl,Zl,Yf),u.projectToRenderScreen(Zl,qb)}else if(qb[2]>0&&Wb[2]<0){ve(Yf,Xl,Zl);const C=u.frustum,M=-Er(C[_r.NEAR],Xl)/pe(Yf,C[_r.NEAR]);oe(Yf,Yf,M),me(Xl,Xl,Yf),u.projectToRenderScreen(Xl,Wb)}else if(qb[2]<0&&Wb[2]<0)continue;qb[2]=0,Wb[2]=0;const T=Yee(_S(qb,Wb,mpe),d);T<m&&(m=T,ce(ppe,Zl),ce(fpe,Xl),g=w/3)}const v=r.rayBegin,b=r.rayEnd;if(m<p*p){let w=Number.MAX_VALUE;if(YSe(_S(ppe,fpe,mpe),_S(v,b,fgt),Hb)){ve(Hb,Hb,v);const x=Ae(Hb);oe(Hb,Hb,1/x),w=x/wr(v,b)}o(w,Hb,g,!1)}}get _layout(){const e=Ts().vec3f(R.POSITION).vec3f(R.PREVPOSITION).vec3f(R.NEXTPOSITION).f32(R.SUBDIVISIONFACTOR).vec2f(R.UV0);return this.parameters.vvSize?e.f32(R.SIZEFEATUREATTRIBUTE):e.f32(R.SIZE),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4f(R.COLOR),this.parameters.vvOpacity&&e.f32(R.OPACITYFEATUREATTRIBUTE),re("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new hgt(this._layout,this.parameters)}createGLMaterial(e){return new cgt(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},cgt=class extends pb{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===G.Color&&this._updateOccludeeState(e);const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(i,this._stipplePattern)}),this._stipplePattern=i),this.ensureTechnique(_Ie,e)}},ugt=class extends EL{constructor(){super(...arguments),this.width=0,this.color=Md,this.join="miter",this.cap=Fd.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},hgt=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i,this.numJoinSubdivisions=0;const r=i.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=y3+r}}_isClosed(e){return bIe(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const r=e.attributes.get(R.POSITION).indices.length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,i,r,s,n){var de,L,F;const o=mgt,a=ggt,l=ygt,c=r.attributes.get(R.POSITION),u=c.indices,d=c.data.length/3,p=(de=r.attributes.get(R.DISTANCETOSTART))==null?void 0:de.data;u&&u.length!==2*(d-1)&&console.warn("RibbonLineMaterial does not support indices");const m=((L=r.attributes.get(R.SIZEFEATUREATTRIBUTE))==null?void 0:L.data[0])??((F=r.attributes.get(R.SIZE))==null?void 0:F.data[0])??1;let g=[1,1,1,1],y=0;const v=this.vertexBufferLayout.fields.has(R.COLORFEATUREATTRIBUTE);v?y=r.attributes.get(R.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(R.COLOR)&&(g=r.attributes.get(R.COLOR).data);const b=re("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null,w=this.vertexBufferLayout.fields.has(R.OPACITYFEATUREATTRIBUTE),x=w?r.attributes.get(R.OPACITYFEATUREATTRIBUTE).data[0]:0,T=new Float32Array(s.buffer),C=re("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,M=this.vertexBufferLayout.stride/4;let O=n*M;const D=O;let k=0;const U=p?(j,W,X)=>k=p[X]:(j,W,X)=>k+=wr(j,W),H=re("enable-feature:objectAndLayerId-rendering"),z=(j,W,X,K,te,he,we)=>{if(T[O++]=W[0],T[O++]=W[1],T[O++]=W[2],T[O++]=j[0],T[O++]=j[1],T[O++]=j[2],T[O++]=X[0],T[O++]=X[1],T[O++]=X[2],T[O++]=K,T[O++]=we,T[O++]=te,T[O++]=m,v)T[O++]=y;else{const De=Math.min(4*he,g.length-4);T[O++]=g[De],T[O++]=g[De+1],T[O++]=g[De+2],T[O++]=g[De+3]}w&&(T[O++]=x),H&&(b!=null&&(C[4*O]=b[0],C[4*O+1]=b[1],C[4*O+2]=b[2],C[4*O+3]=b[3]),O++)};O+=M,ne(a,c.data[0],c.data[1],c.data[2]),e&&He(a,a,e);const Z=this._isClosed(r);if(Z){const j=c.data.length-3;ne(o,c.data[j],c.data[j+1],c.data[j+2]),e&&He(o,o,e)}else ne(l,c.data[3],c.data[4],c.data[5]),e&&He(l,l,e),z(a,a,l,1,Hc.LEFT_CAP_START,0,0),z(a,a,l,1,Hc.RIGHT_CAP_START,0,0),ce(o,a),ce(a,l);const q=Z?0:1,Y=Z?d:d-1;for(let j=q;j<Y;j++){const W=(j+1)%d*3;ne(l,c.data[W],c.data[W+1],c.data[W+2]),e&&He(l,l,e),U(o,a,j),z(o,a,l,0,Hc.LEFT_JOIN_END,j,k),z(o,a,l,0,Hc.RIGHT_JOIN_END,j,k);const X=this.numJoinSubdivisions;for(let K=0;K<X;++K){const te=(K+1)/(X+1);z(o,a,l,te,Hc.LEFT_JOIN_END,j,k),z(o,a,l,te,Hc.RIGHT_JOIN_END,j,k)}z(o,a,l,1,Hc.LEFT_JOIN_START,j,k),z(o,a,l,1,Hc.RIGHT_JOIN_START,j,k),ce(o,a),ce(a,l)}Z?(ne(l,c.data[3],c.data[4],c.data[5]),e&&He(l,l,e),k=U(o,a,Y),z(o,a,l,0,Hc.LEFT_JOIN_END,q,k),z(o,a,l,0,Hc.RIGHT_JOIN_END,q,k)):(k=U(o,a,Y),z(o,a,a,0,Hc.LEFT_CAP_END,Y,k),z(o,a,a,0,Hc.RIGHT_CAP_END,Y,k)),oH(T,D+M,T,D,M),O=oH(T,O-M,T,O,M),this._parameters.wireframe&&this._addWireframeVertices(s,D,O,M)}_addWireframeVertices(e,i,r,s){const n=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=oH(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function oH(t,e,i,r,s){for(let n=0;n<s;n++)i[r++]=t[e++];return r}function bIe(t,e){return t.isClosed?e.get(R.POSITION).indices.length>2:!1}function dgt(t){return t.anchor===nT.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const Zl=E(),Xl=E(),Yf=E(),Hb=E(),pgt=E(),qb=xa(),Wb=xa(),ppe=E(),fpe=E(),mpe=Ff(),fgt=Ff(),mgt=E(),ggt=E(),ygt=E(),YP=[xa(),xa(),xa(),xa()],ty=[E(),E(),E(),E()],aH=Qi(),lH=Qi(),cH=Qi(),uH=Qi();let wIe=class{constructor(e){this._originSR=e,this._rootOriginId="root/"+_h(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const i=this._origins.get(this._rootOriginId);if(i==null){const u=eV(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,u),u}const r=this._gridSize,s=Math.round(e[0]/r),n=Math.round(e[1]/r),o=Math.round(e[2]/r),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*r;if(ve(Uo,e,i.vec3),Uo[0]=Math.abs(Uo[0]),Uo[1]=Math.abs(Uo[1]),Uo[2]=Math.abs(Uo[2]),Uo[0]<c&&Uo[1]<c&&Uo[2]<c){if(l){const u=Math.max(...Uo);if(ve(Uo,e,l.vec3),Uo[0]=Math.abs(Uo[0]),Uo[1]=Math.abs(Uo[1]),Uo[2]=Math.abs(Uo[2]),Math.max(...Uo)<u)return l}return i}return l||(l=eV(s*r,n*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(e,i=Wt(1,1,0,1)){const r=window.view,s=r._stage,n=i.toString();if(!this._objects.has(n)){this._material=new fC({width:2,color:i}),s.add(this._material);const m=new J$e(s,{pickable:!1}),g=new vb({castShadow:!1});s.add(g),m.add(g),this._objects.set(n,g)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),u=new Array,d=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m]=e[0]+(1&a[m]?d:-d),c[3*m+1]=e[1]+(2&a[m]?d:-d),c[3*m+2]=e[2]+(4&a[m]?d:-d),m>0&&u.push(m-1,m);ns(c,this._originSR,0,c,r.renderSpatialReference,0,l);const p=new bn(this._material,[[R.POSITION,new it(c,u,3,!0)]],null,Ls.Line);s.add(p),o.addGeometry(p)}get test(){}};const Uo=E();let xIe=class{constructor(e,i,r=null){this.rctx=e,this.sliceHelper=r,this.lastFrameCamera=new Pr,this.output=G.Color,this.renderOccludedMask=nV,this.bindParameters=new vG(i,r!=null?r.plane:null),this.bindParameters.alignPixelEnabled=!0}},_gt=class extends xIe{constructor(e,i,r,s){super(e,r,s),this.offscreenRenderingHelper=i,this.sliceHelper=s,this.time=0}};const nV=Ji.Occlude|Ji.OccludeAndTransparent|Ji.OccludeAndTransparentStencil;let TR=class extends Pr{constructor(){super(...arguments),this._projectionMatrix=Ee()}get projectionMatrix(){return this._projectionMatrix}};h([f()],TR.prototype,"_projectionMatrix",void 0),h([f({readOnly:!0})],TR.prototype,"projectionMatrix",null),TR=h([I("esri.views.3d.webgl-engine.lib.CascadeCamera")],TR);var oT;(function(t){t[t.Highlight=0]="Highlight",t[t.ExcludeHighlight=1]="ExcludeHighlight"})(oT||(oT={}));let HN=class{constructor(){this.camera=new TR,this.lightMat=Ee()}},vgt=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},Zre=class{constructor(e,i){this._fbos=e,this._viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new vgt,this._projectionView=Ee(),this._projectionViewInverse=Ee(),this._modelViewLight=Ee(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Qt(),this._cascades=[new HN,new HN,new HN,new HN],this._lastOrigin=null,this._maxTextureWidth=Math.min(re("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return ds(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=ti(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=Te(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)dH[e]=this._cascades[e];return dH.length=this._numCascades,dH}start(e,i,r,s,n){ft(this.enabled);const{near:o,far:a}=Egt(r);this._computeCascadeDistances(o,a,s),this._textureHeight=this._computeTextureHeight(e,n,s),this._setupMatrices(e,i);const{viewMatrix:l,projectionMatrix:c}=e;for(let u=0;u<this._numCascades;++u)this._constructCascade(u,c,l,i);this._lastOrigin=null,this.clear()}finish(){var e;ft(this.enabled),(e=this._handle)==null||e.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!Oo(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||E(),ce(this._lastOrigin,e);for(let i=0;i<this._numCascades;++i){rl(wpe,this._cascades[i].lightMat,e);for(let r=0;r<16;++r)xpe[16*i+r]=wpe[r]}}return xpe}moveSnapshot(e){var i,r;ft(this.enabled),(i=this._handle)==null||i.detachDepth(),(r=this._snapshots[e])==null||r.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){var l,c,u,d;const i=(c=(l=this._handle)==null?void 0:l.getTexture())==null?void 0:c.descriptor;if(!this.enabled||!i)return;(u=this._snapshots[e])==null||u.release();const{width:r,height:s}=i,n=e===oT.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(r,s,n,Xr.RGBA4);const o=this._fbos.rctx;this._bindFbo();const a=o.bindTexture((d=this._snapshots[e])==null?void 0:d.getTexture(),br.TEXTURE_UNIT_FOR_UPDATES);o.gl.copyTexSubImage2D(Is.TEXTURE_2D,0,0,0,0,0,r,s),o.bindTexture(a,br.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){var i;return this.enabled?(i=this._snapshots[e])==null?void 0:i.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clear(Lr.COLOR_BUFFER_BIT|Lr.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,i,r){const s=Math.min(window.devicePixelRatio,i)/e.pixelRatio,n=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=c1(Math.floor(Math.max(e.fullWidth,e.fullHeight)*s*n)),a=Math.min(this._maxTextureWidth,this._numCascades*o);return BMe(a/this._numCascades)}_ensureFbo(){var e,i,r,s,n;((i=(e=this._handle)==null?void 0:e.fbo)==null?void 0:i.width)===this._textureWidth&&((r=this._handle)==null?void 0:r.fbo.height)===this._textureHeight||((s=this._handle)==null||s.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",Xr.RGBA4)),(n=this._handle)==null||n.acquireDepth(Ao.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=ti(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){var i;const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer((i=this._handle)==null?void 0:i.fbo)}_constructCascade(e,i,r,s){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);ft(l<c);for(let m=0;m<8;++m){ds(gpe,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const g=dd[m];hu(g,gpe,this._projectionViewInverse),g[0]/=g[3],g[1]/=g[3],g[2]/=g[3]}ea(hH,dd[0]),n.camera.viewMatrix=rl(bgt,this._modelViewLight,hH);for(let m=0;m<8;++m)He(dd[m],dd[m],n.camera.viewMatrix);let u=dd[0][2],d=dd[0][2];for(let m=1;m<8;++m)u=Math.min(u,dd[m][2]),d=Math.max(d,dd[m][2]);u-=200,d+=200,n.camera.near=-d,n.camera.far=-u,Tgt(r,s,u,d,n.camera),dr(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const p=this._textureHeight;n.camera.viewport=[e*p,0,p,p]}_setupMatrices(e,i){dr(this._projectionView,e.projectionMatrix,e.viewMatrix),In(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===Ge.Global?e.eye:ne(hH,0,0,1);OB(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_computeCascadeDistances(e,i,r){const s=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(oit(i/e,4)),s);const n=(i-e)/this._numCascades,o=(i/e)**(1/this._numCascades);let a=e,l=e;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=Dt(a,l,this.settings.splitSchemeLambda),a*=o,l+=n}get test(){}};const bgt=Ee(),gpe=Qt(),dd=[];for(let t=0;t<8;++t)dd.push(Qt());const ype=lt(),_pe=lt(),wgt=lt(),vpe=lt(),bpe=lt(),hH=E(),dH=[],wpe=Ee(),xpe=Vr.concat(Vr,Vr,Vr,Vr),Du=lt(),p2=lt(),Yb=[lt(),lt(),lt(),lt()],Qn=lt(),pH=lt(),P_=lt(),ZP=lt(),f2=lt(),m2=lt(),qN=lt();function xgt(t,e,i,r,s,n,o,a){Pi(Du,0,0);for(let C=0;C<4;++C)Bp(Du,Du,t[C]);hh(Du,Du,.25),Pi(p2,0,0);for(let C=4;C<8;++C)Bp(p2,p2,t[C]);hh(p2,p2,.25),Td(Yb[0],t[4],t[5],.5),Td(Yb[1],t[5],t[6],.5),Td(Yb[2],t[6],t[7],.5),Td(Yb[3],t[7],t[4],.5);let l=0,c=mz(Yb[0],Du);for(let C=1;C<4;++C){const M=mz(Yb[C],Du);M<c&&(c=M,l=C)}Hm(Qn,Yb[l],t[l+4]);const u=Qn[0];let d,p;Qn[0]=-Qn[1],Qn[1]=u,Hm(pH,p2,Du),Gn(pH,Qn)<0&&mMe(Qn,Qn),Td(Qn,Qn,pH,i),r3(Qn,Qn),d=p=Gn(Hm(P_,t[0],Du),Qn);for(let C=1;C<8;++C){const M=Gn(Hm(P_,t[C],Du),Qn);M<d?d=M:M>p&&(p=M)}Aa(r,Du),hh(P_,Qn,d-e),Bp(r,r,P_);let m=-1,g=1,y=0,v=0;for(let C=0;C<8;++C){Hm(ZP,t[C],r),r3(ZP,ZP);const M=Qn[0]*ZP[1]-Qn[1]*ZP[0];M>0?M>m&&(m=M,y=C):M<g&&(g=M,v=C)}XT(m>0,"leftArea"),XT(g<0,"rightArea"),hh(f2,Qn,d),Bp(f2,f2,Du),hh(m2,Qn,p),Bp(m2,m2,Du),qN[0]=-Qn[1],qN[1]=Qn[0];const b=QD(r,t[v],m2,Bp(P_,m2,qN),1,s),w=QD(r,t[y],m2,P_,1,n),x=QD(r,t[y],f2,Bp(P_,f2,qN),1,o),T=QD(r,t[v],f2,P_,1,a);XT(b,"rayRay"),XT(w,"rayRay"),XT(x,"rayRay"),XT(T,"rayRay")}function ki(t,e){return 3*e+t}const Spe=lt();function $c(t,e){return Pi(Spe,t[e],t[e+3]),Spe}const Jl=lt(),dt=Gr();function Sgt(t,e,i,r,s){Hm(Jl,i,r),hh(Jl,Jl,.5),dt[0]=Jl[0],dt[1]=Jl[1],dt[2]=0,dt[3]=Jl[1],dt[4]=-Jl[0],dt[5]=0,dt[6]=Jl[0]*Jl[0]+Jl[1]*Jl[1],dt[7]=Jl[0]*Jl[1]-Jl[1]*Jl[0],dt[8]=1,dt[ki(0,2)]=-Gn($c(dt,0),t),dt[ki(1,2)]=-Gn($c(dt,1),t);let n=Gn($c(dt,0),i)+dt[ki(0,2)],o=Gn($c(dt,1),i)+dt[ki(1,2)],a=Gn($c(dt,0),r)+dt[ki(0,2)],l=Gn($c(dt,1),r)+dt[ki(1,2)];n=-(n+a)/(o+l),dt[ki(0,0)]+=dt[ki(1,0)]*n,dt[ki(0,1)]+=dt[ki(1,1)]*n,dt[ki(0,2)]+=dt[ki(1,2)]*n,n=1/(Gn($c(dt,0),i)+dt[ki(0,2)]),o=1/(Gn($c(dt,1),i)+dt[ki(1,2)]),dt[ki(0,0)]*=n,dt[ki(0,1)]*=n,dt[ki(0,2)]*=n,dt[ki(1,0)]*=o,dt[ki(1,1)]*=o,dt[ki(1,2)]*=o,dt[ki(2,0)]=dt[ki(1,0)],dt[ki(2,1)]=dt[ki(1,1)],dt[ki(2,2)]=dt[ki(1,2)],dt[ki(1,2)]+=1,n=Gn($c(dt,1),e)+dt[ki(1,2)],o=Gn($c(dt,2),e)+dt[ki(2,2)],a=Gn($c(dt,1),i)+dt[ki(1,2)],l=Gn($c(dt,2),i)+dt[ki(2,2)],n=-.5*(n/o+a/l),dt[ki(1,0)]+=dt[ki(2,0)]*n,dt[ki(1,1)]+=dt[ki(2,1)]*n,dt[ki(1,2)]+=dt[ki(2,2)]*n,n=Gn($c(dt,1),e)+dt[ki(1,2)],o=Gn($c(dt,2),e)+dt[ki(2,2)],a=-o/n,dt[ki(1,0)]*=a,dt[ki(1,1)]*=a,dt[ki(1,2)]*=a,s[0]=dt[0],s[1]=dt[1],s[2]=0,s[3]=dt[2],s[4]=dt[3],s[5]=dt[4],s[6]=0,s[7]=dt[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=dt[6],s[13]=dt[7],s[14]=0,s[15]=dt[8]}function Tgt(t,e,i,r,s){const n=1/dd[0][3],o=1/dd[4][3];ft(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(fo(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,xgt(dd,a,l,ype,_pe,wgt,vpe,bpe),Sgt(ype,_pe,vpe,bpe,s.projectionMatrix),s.projectionMatrix[10]=2/(i-r),s.projectionMatrix[14]=-(i+r)/(i-r)}function Egt(t){let{near:e,far:i}=t;return e<2&&(e=2),i<2&&(i=2),e>=i&&(e=2,i=4),{near:e,far:i}}function Cgt(t){return Zd(t)&&t.intersector===Zr.TERRAIN&&!!t.target}let Mgt=class extends oL{constructor(e,i,r){super(e,i),this.triangleNr=r}};function SIe(t){return Zd(t)&&t.intersector===Zr.OVERLAY&&!!t.target}var ls,Wn;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(ls||(ls={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(Wn||(Wn={}));let TIe=class{constructor(e,i){this._material=e,this._repository=i,this._map=new Map}dispose(){this._map.forEach((e,i)=>{e!=null&&this._repository.release(this._material,i)})}load(e,i,r){const s=this._material.produces.get(i);if(!(s!=null&&s(r)))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const n=this._map.get(r);if(n!=null){if(n.ensureResources(e)===B1.LOADED)return n;this._repository.requestRender()}return null}},AX=class extends TRe{constructor(e=E()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},Xre=class{constructor(e=0,i=0){this.from=e,this.to=i}get numElements(){return this.to-this.from}};function Tpe(t){const e=new Map;t.forAll(r=>e.set(r.from,r));let i=!0;for(;i;){i=!1;for(let r=0;r<t.length;++r){const s=t.data[r],n=e.get(s.to);if(!n)return;s.to=n.to,e.delete(n.from),t.removeUnordered(n),i=!0}}}let Epe=class extends Xre{constructor(e,i,r){super(i,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},Agt=class{constructor(){this.first=0,this.count=0}},Pgt=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Zt({allocator:e=>e||new Xre,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=WN(),this.drawCommandsHighlight=WN(),this.drawCommandsOccludees=WN(),this.drawCommandsShadowHighlightRest=WN()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,i){this.deleteInstance(e),this._instances.set(e,i),this._numElements+=i.numElements}deleteInstance(e){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,this._instances.delete(e))}updateInstance(e,i,r){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=i,s.to=r,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const r=this.drawCommandsDefault.pushNew(),s=this.holes.front();return this.vao!=null&&this.holes.length===1&&s.to===Math.floor(this.vao.byteSize/e)?(r.first=0,void(r.count=s.from)):(r.first=1/0,r.count=0,this._instances.forEach(n=>{r.first=Math.min(r.first,n.from),r.count=Math.max(r.count,n.to)}),void(r.count-=r.first))}const i=Array.from(this._instances.values()).sort((r,s)=>r.from===s.from?r.to-s.to:r.from-s.from);for(const r of i)r.isVisible&&(Cpe(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),Cpe(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function Ogt(t){return t.vao!=null}function WN(){return new Zt({allocator:t=>t||new Agt,deallocator:t=>t})}function Cpe(t,e){const i=t.back();if(i==null){const r=t.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(Rgt(i,e)){const r=e.from-i.first+e.numElements;i.count=r}else{const r=t.pushNew();r.first=e.from,r.count=e.numElements}}function Rgt(t,e){return t.first+t.count>=e.from}let $gt=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(i=>i.instances.has(e))}};const PX=-3,EIe=PX-1;var jp;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(jp||(jp={}));let Igt=class{constructor(e,i,r){this.name=e,this._storage=i,this.id=Lgt+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),r&&(this._storage.registerRemoveFunc(this.id,r),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,i,r,s=0){this._storage.put(this,e,i,r,s)}pop(e){const i=this._storage.pop(this,e);return i===void 0?++this._miss:++this._hit,i}get(e){const i=this._storage.get(this,e);return i===void 0?++this._miss:++this._hit,i}peek(e){return this._storage.peek(this,e)}updateSize(e,i,r){this._storage.updateSize(this,e,i,r)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},CIe=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Zt,this._users=new Zt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,i){this._removeFuncs.push([e,i])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(i=>i[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,i){const r=this._db.get(e.id+i);return(r==null?void 0:r.size)??0}put(e,i,r,s,n){i=e.id+i;const o=this._db.get(i);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(i),o.entry!==r&&this._notifyRemove(i,o.entry,o.size,jp.ALL)),s>this._maxSize)return void this._notifyRemove(i,r,s,jp.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return console.warn(`Refusing to cache entry with size ${s} for key ${i}`),void this._notifyRemove(i,r,0,jp.ALL);const a=1+Math.max(n,EIe)-PX;this._db.set(i,new Dgt(r,s,a)),this._size+=s,e.size+=s,this._checkSize()}updateSize(e,i,r,s){i=e.id+i;const n=this._db.get(i);if(n&&n.entry===r){for(this._size-=n.size,e.size-=n.size;s>this._maxSize;){const o=this._notifyRemove(i,r,s,jp.SOME);if(!(o!=null&&o>0))return void this._db.delete(i);s=o}n.size=s,this._size+=s,e.size+=s,this._checkSize()}}pop(e,i){i=e.id+i;const r=this._db.get(i);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(i),++this._hit,r.entry;++this._miss}get(e,i){i=e.id+i;const r=this._db.get(i);if(r!==void 0)return this._db.delete(i),r.lives=r.lifetime,this._db.set(i,r),++this._hit,r.entry;++this._miss}peek(e,i){const r=this._db.get(e.id+i);return r?++this._hit:++this._miss,r==null?void 0:r.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const{id:u,name:d}=c;if(a.startsWith(u)){const p=i[d]||0;i[d]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(i);n.sort((o,a)=>i[a]-i[o]),n.forEach(o=>e[o]=Math.round(i[o]/2**20)+"MB / "+s[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(e["Priority "+(o+PX-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const i=e.id;this._db.forEach((r,s)=>{s.startsWith(i)&&(this._size-=r.size,this._db.delete(s),this._notifyRemove(s,r.entry,r.size,jp.ALL))}),e.size=0}clearAll(){this._db.forEach((e,i)=>this._notifyRemove(i,e.entry,e.size,jp.ALL)),this._users.forAll(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,i,r,s){let n;return this._removeFuncs.some(o=>{if(e.startsWith(o[0])){const a=o[1](i,s,r);return typeof a=="number"&&(n=a),!0}return!1}),n}_checkSize(){this._users.forAll(e=>this._checkSizeLimits(e)),this._checkSizeLimits()}_checkSizeLimits(e){const i=e??this;if(i.maxSize<0||i.size<=i.maxSize)return;const r=e==null?void 0:e.id;let s=!0;for(;s;){s=!1;for(const[n,o]of this._db)if(o.lifetime===0&&(!r||n.startsWith(r))){if(this._purgeItem(n,o,e),i.size<=.9*i.maxSize)return;s||(s=this._db.has(n))}}for(const[n,o]of this._db)if((!r||n.startsWith(r))&&(this._purgeItem(n,o,e),i.size<=.9*i.maxSize))return}_purgeItem(e,i,r=this._users.find(s=>e.startsWith(s.id))){if(this._db.delete(e),i.lives<=1){this._size-=i.size,r&&(r.size-=i.size);const s=this._notifyRemove(e,i.entry,i.size,jp.SOME);s!=null&&s>0&&(this._size+=s,r&&(r.size+=s),i.lives=i.lifetime,i.size=s,this._db.set(e,i))}else--i.lives,this._db.set(e,i)}},Lgt=0,Dgt=class{constructor(e,i,r){this.entry=e,this.size=i,this.lifetime=r,this.lives=r}},zL=class{constructor(e,i){this._cache=e(i,(r,s,n)=>{switch(s){case jp.ALL:return r.forEach(o=>o.dispose()),0;case jp.SOME:{const o=r.shift();return o&&(n-=Math.round(o.usedMemory),o.dispose()),n}}})}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const i=this._cache.peek(e);if(!i)return;const r=i.pop();if(i.length>0){if(r){const s=this._cache.getSize(e)-Math.round(r.usedMemory);this._cache.updateSize(e,i,s)}}else this._cache.pop(e);return r}put(e,i,r=EIe){const s=this._cache.peek(e);if(!s)return void this._cache.put(e,[i],i.usedMemory,r);s.push(i);const n=this._cache.getSize(e)+Math.round(i.usedMemory);this._cache.updateSize(e,s,n)}},Ngt=class{constructor(e,i,r){this._rctx=e,this._locations=i,this._layout=r,this._cache=new zL(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const i=e.toString();let r=this._cache.pop(i);return r||(r=new Fg(this._rctx,this._locations,{geometry:this._layout},{geometry:vr.createVertex(this._rctx,rr.STATIC_DRAW)}),r.vertexBuffers.geometry.setSize(e),r)}deleteVao(e){if(e==null)return;const i=e.byteSize.toString();this._cache.put(i,e)}},aI=class extends lPe{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._produces=new Map,this.drapedPriority=0}destroy(){this._glMaterials=It(this._glMaterials),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache=It(this._vaoCache)}initialize(){this.material.produces.forEach((e,i)=>{this._produces.set(i,r=>!(this._dataByOrigin.size===0||!(r!==G.Highlight&&r!==G.ShadowHighlight||this._hasHighlights))&&e(r))})}get produces(){return this._produces}initializeRenderContext(e,i){const{rctx:r}=e.renderContext;this._glMaterials=new TIe(this.material,i??e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new Ngt(r,this.material.vertexAttributeLocations,Au(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get hasOccludees(){return this._hasOccludees}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get materialReference(){return this.material}get numGeometries(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,s)=>r+s.instances.size,0)),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,s)=>r+s.vao.usedMemory,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(i=>i.buffers.forEach(r=>r.instances.forEach(s=>e(s.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const i=this._bufferWriter;if(i===null)return;const r=i.vertexBufferLayout.stride/4;for(const s of e){const n=s.renderGeometry,o=this._dataByOrigin.get(n.localOrigin.id),a=o==null?void 0:o.findBuffer(n.id);if(a==null)return;const l=a.instances.get(n.id);if(s.updateType&(Wn.GEOMETRY|Wn.TRANSFORMATION)){const c=XN(i.elementCount(l.geometry.geometry)*r),u=i.vertexBufferLayout.createView(c.buffer);this._writeGeometry(n,u,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*r,0,l.numElements*r)}s.updateType&(Wn.HIGHLIGHT|Wn.OCCLUDEE|Wn.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,i){const r=new q1;for(const s of e){const n=s.localOrigin;if(n==null)continue;let o=r.get(n.id,null);o==null&&(o=new Mpe(n.vec3),r.set(n.id,null,o)),o.changes.push(s)}for(const s of i){const n=s.localOrigin;if(n==null)continue;const o=this._dataByOrigin.get(n.id),a=o==null?void 0:o.findBuffer(s.id);if(a==null)continue;let l=r.get(n.id,a);l==null&&(l=new Mpe(n.vec3),r.set(n.id,a,l)),l.changes.push(s)}return r}_addAndRemoveGeometries(e,i){if(this._bufferWriter===null||this._vaoCache===null)return;const{_bufferWriter:r,_dataByOrigin:s}=this,n=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,i);o.forEach((a,l)=>{const c=a.get(null),u=c!=null?c.changes:[];o.delete(l,null);let d=s.get(l);if(a.forEach((p,m)=>{if(o.delete(l,m),m==null)return void ft(!1,"No VAO for removed geometries");if(m.instances.size===p.changes.length)return this._vaoCache.deleteVao(m.vao),PI(d.buffers,m),void(d.buffers.length===0&&u.length===0&&s.delete(l));const g=m.numElements,y=m.vao.byteSize/4,v=u.reduce((T,C)=>T+r.elementCount(C.geometry),0),b=p.changes.reduce((T,C)=>T+r.elementCount(C.geometry),0),w=Math.min((g+v-b)*n,ZN),x=w>y;w>oV&&w<y/2?(p.changes.forEach(({id:T})=>m.deleteInstance(T)),m.instances.forEach(({geometry:T})=>u.push(T)),this._vaoCache.deleteVao(m.vao),PI(d.buffers,m)):x?this._applyAndRebuild(m,u,p):this._applyRemoves(m,p)}),u.length>0)for(d==null&&(d=new $gt(c.origin),s.set(l,d)),d.buffers.forEach(p=>this._applyAdds(p,u));u.length>0;)d.buffers.push(this._applyAndRebuild(new Pgt,u,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(i=>{i.drawCommandsDirty&&(i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,mh(i.instances,r=>(i.updateDrawState(r),i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees)),i.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||i.hasHighlights,this._hasOccludees=this._hasOccludees||i.hasOccludees})})}_applyAndRebuild(e,i,r){if(r!=null)for(const g of r.changes)e.deleteInstance(g.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(ZN/o);let l=e.numElements;for(;i.length>0;){const g=i.pop(),y=s.elementCount(g.geometry);if(l+y>a&&l>0){i.push(g);break}l+=y;const v=new Epe(g,0,0);ft(e.instances.get(g.id)==null),e.addInstance(g.id,v)}const c=l*o,u=XN(c),d=s.vertexBufferLayout.createView(u.buffer);let p=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((g,y)=>{this._writeGeometry(g.geometry,d,p);const v=p;p+=s.elementCount(g.geometry.geometry),e.updateInstance(y,v,p),e.updateDrawState(g)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Ope(c)),e.vao.vertexBuffers.geometry.setSubData(u,0,0,p*o),e.holes.clear();const m=e.holes.pushNew();return m.from=p,m.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,i){if(i.changes.length===0||this._bufferWriter===null)return;for(const a of i.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const u=Zf.back();if(u){if(u.to===c.from){u.to=c.to;continue}if(u.from===c.to){u.from=c.from;continue}}const d=Zf.pushNew();d.from=c.from,d.to=c.to}Tpe(Zf);const r=this._bufferWriter.vertexBufferLayout.stride/4,s=Zf.reduce((a,l)=>Math.max(a,l.numElements),0)*r,n=XN(s);n.fill(0,0,s);const o=e.vao.vertexBuffers.geometry;Zf.forAll(a=>o.setSubData(n,a.from*r,0,a.numElements*r)),e.holes.pushArray(Zf.data,Zf.length),Zf.forAll((a,l)=>Zf.data[l]=null),Zf.clear(),e.drawCommandsDirty=!0}_applyAdds(e,i){if(i.length===0||this._bufferWriter===null)return;if(!Ogt(e))return void this._applyAndRebuild(e,i,null);const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=e.numElements,o=i.reduce((b,w)=>b+r.elementCount(w.geometry),0),a=Math.min((n+o)*s,ZN),l=4*a;if(e.vao.byteSize<Ope(ZN-oV)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,i,null);Tpe(e.holes);const c=new Array;for(const b of i){const w=r.elementCount(b.geometry),x=Fgt(e.holes,w);c.push(x)}const u=e.vao.vertexBuffers.geometry;let d=0,p=0,m=0;const g=XN(a),y=r.vertexBufferLayout.createView(g.buffer);i.forEach((b,w)=>{const x=c[w];if(x==null)return;if(m!==x){const M=m-p;M>0&&u.setSubData(g,p*s,0,M*s),p=x,d=0}const T=r.elementCount(b.geometry);this._writeGeometry(b,y,d),d+=T,m=x+T;const C=new Epe(b,x,x+T);ft(e.instances.get(b.id)==null),e.addInstance(b.id,C),e.drawCommandsDirty=!0});const v=m-p;v>0&&u.setSubData(g,p*s,0,v*s),GUe(i,(b,w)=>c[w]==null)}_writeGeometry(e,i,r){if(this._bufferWriter===null)return;const s=e.localOrigin.vec3;ait(Ape,-s[0],-s[1],-s[2]);const n=dr(kgt,Ape,e.transformation);In(YN,n),bu(YN,YN),this._bufferWriter.write(n,YN,e.geometry,i,r)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:i,bindParameters:r}=e,s=this.material.produces.get(r.slot);if(!(s!=null&&s(i)))return null;const n=i===G.Highlight||i===G.ShadowHighlight;if(n&&!this._hasHighlights)return null;const o=i===G.ShadowExcludeHighlight,a=!(n||o);for(const l of this._dataByOrigin.values())for(const c of l.buffers){if(n&&!c.hasHighlights)continue;const u=(n?c.drawCommandsHighlight:o&&c.needsMultipleCommands()?c.drawCommandsShadowHighlightRest:c.drawCommandsDefault)||null,d=a&&c.drawCommandsOccludees||null;if(u!=null&&u.length||d!=null&&d.length){const p=this._glMaterials.load(e.rctx,r.slot,i),m=p!=null?p.beginSlot(r):null;if(m!=null)return m}}return null}renderNode(e,i){const{output:r,bindParameters:s}=e,n=r===G.Highlight||r===G.ShadowHighlight,o=r===G.ShadowExcludeHighlight,a=!(n||o),l=s.slot===_e.OCCLUDER_MATERIAL,c=s.slot===_e.TRANSPARENT_OCCLUDER_MATERIAL,u=e.rctx;u.runAppleAmdDriverHelper(),u.bindTechnique(i,s,this.material.parameters);for(const d of this._dataByOrigin.values())for(const p of d.buffers){if(n&&!p.hasHighlights)continue;const m=(n?p.drawCommandsHighlight:o&&p.needsMultipleCommands()?p.drawCommandsShadowHighlightRest:p.drawCommandsDefault)||null,g=a&&p.drawCommandsOccludees||null;(m!=null&&m.length||g!=null&&g.length)&&(i.program.bindDraw(new AX(d.origin),s,this.material.parameters),i.ensureAttributeLocations(p.vao),u.bindVAO(p.vao),m!=null&&m.length&&(u.setPipelineState(i.getPipeline(!1,l,c)),m.forAll(y=>u.drawArrays(i.primitiveType,y.first,y.count))),g!=null&&g.length&&(u.setPipelineState(i.getPipeline(!0,l,c)),g.forAll(y=>u.drawArrays(i.primitiveType,y.first,y.count))))}}get test(){}};h([f({constructOnly:!0})],aI.prototype,"material",void 0),aI=h([I("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],aI);let Mpe=class{constructor(e){this.origin=e,this.changes=new Array}};function Fgt(t,e){let i;if(!t.some(s=>!(s.numElements<e)&&(i=s,!0)))return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const Ape=Ee(),kgt=Ee(),YN=Ee(),Zf=new Zt({allocator:t=>t||new Xre,deallocator:null}),oV=65536,fH=4*oV,Ppe=1024,MIe=16777216,ZN=MIe/4;let mH=new Float32Array(oV);function XN(t){return mH.length<t&&(mH=new Float32Array(t)),mH}function Ope(t){const e=4*t;return e<=Ppe?Ppe:e<fH?gbe(e):Math.max(Math.min(Math.ceil(1.5*e/fH)*fH,MIe),e)}let Ju=class extends Re{constructor(e){super(e),this._pending=new Ugt,this._changes=new eZ,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Zt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.destroy()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){return mh(this._materialRenderers,e=>e.numGeometries!==0&&!e.queryRenderOccludedState(Ji.Occlude))}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}getMaterialRenderer(e){return this._materialRenderers.get(e)}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=gAe(this._changes);let i=!1;return e.forEach((r,s)=>{let n=this.getMaterialRenderer(s);if(!n&&r.adds.length>0){const o=new aI({material:s});o.initializeRenderContext(this.rendererContext.pluginContext,this._materials),n=o,this._materialRenderers.set(s,n),i=!0}n&&(n.modify(r),n.numGeometries===0&&(this._materialRenderers.delete(s),n.destroy(),i=!0))}),this._changes.clear(),i&&this._updateSortedMaterialRenderers(),this._hasHighlights=mh(this._materialRenderers,r=>{const s=r.produces.get(_e.DRAPED_MATERIAL);return!!s&&s(G.Highlight)}),this._hasWater=mh(this._materialRenderers,r=>{const s=r.produces.get(_e.DRAPED_WATER);return!!s&&s(G.Normal)}),this.notifyChange("updating"),!0}addGeometries(e,i){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const n of r)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of r)this._pending.adds.add(n);s&&this.notifyChange("updating"),i===ls.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,i){const r=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);r&&!this._pending.empty&&this.notifyChange("updating"),i===ls.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,i){const r=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=i}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),i){case Wn.TRANSFORMATION:case Wn.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Wn.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let i=!1;return this._sortedMaterialRenderers.forAll(r=>i=!!r.updateAnimation&&r.updateAnimation(e)||i),i}shouldRender(e){return this._sortedMaterialRenderers.some(i=>i.prepareTechnique(e))}render(e){this._sortedMaterialRenderers.forAll(i=>{const r=i.prepareTechnique(e);r!=null&&i.renderNode(e,r)})}intersect(e,i,r,s,n){return this._geometries.forEach(o=>{if(s&&!s(o))return;this._intersectRenderGeometry(o,r,i,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,r,i,a.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,r,i,-a.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;for(const i of this._materialRenderers.values())i.drapedPriority=e++,this._sortedMaterialRenderers.push(i);this._sortedMaterialRenderers.sort((i,r)=>{var s,n,o,a;return((s=r.materialReference)==null?void 0:s.renderPriority)===((n=i.materialReference)==null?void 0:n.renderPriority)?i.drapedPriority-r.drapedPriority:(((o=r.materialReference)==null?void 0:o.renderPriority)||0)-(((a=i.materialReference)==null?void 0:a.renderPriority)||0)})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const i=this._changes.updates.data[e];this._pending.has(i.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,i,r,s,n,o){if(!e.visible)return;let a=0;s+=e.transformation[12],a=e.transformation[13],gH[0]=r[0]-s,gH[1]=r[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,gH,(l,c,u)=>{zgt(i,u,o,e.material.renderPriority,n,e.layerUid,e.graphicUid)},i)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let i;for(const r of e){const s=r.graphicUid;s!=null&&s!==i&&(this.drapeSource.notifyGraphicGeometryChanged(s),i=s)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let i;for(const r of e){const s=r.graphicUid;s!=null&&s!==i&&(this.drapeSource.notifyGraphicVisibilityChanged(s),i=s)}}_validateRenderGeometries(e){for(const i of e)this._validateRenderGeometry(i);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){}};h([f()],Ju.prototype,"drapeSource",void 0),h([f()],Ju.prototype,"updating",null),h([f()],Ju.prototype,"rctx",null),h([f({constructOnly:!0})],Ju.prototype,"rendererContext",void 0),h([f()],Ju.prototype,"_materials",null),h([f()],Ju.prototype,"_localOriginFactory",null),h([f({readOnly:!0})],Ju.prototype,"isEmpty",null),h([f()],Ju.prototype,"_materialRenderers",void 0),h([f()],Ju.prototype,"_geometries",void 0),Ju=h([I("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Ju);let Ugt=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function zgt(t,e,i,r,s,n,o){const a=new Mgt(n,o,e),l=c=>{c.set(Zr.OVERLAY,a,t.dist,t.normal,t.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==ta.MIN&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===ta.ALL){const c=_te(s.ray);l(c),s.results.all.push(c)}}const gH=lt();let Jre=class AIe extends Wi{initializeProgram(e){return new Yi(e.rctx,AIe.shader.get().build(),wi)}initializePipeline(){return this.configuration.hasAlpha?Gt({blending:sa(Pe.SRC_ALPHA,Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA,Pe.ONE_MINUS_SRC_ALPHA),colorWrite:Kt}):Gt({colorWrite:Kt})}};Jre.shader=new Bi(tmt,()=>fe(()=>Promise.resolve().then(()=>vUt),void 0));let Qre=class extends jl{constructor(){super(...arguments),this.hasAlpha=!1}};h([B()],Qre.prototype,"hasAlpha",void 0);let Kre=class extends $r{constructor(){super(...arguments),this.overlayIndex=Mn.INNER,this.opacity=1}};function PIe(){const t=new Vi;return t.include(Oa),t.fragment.uniforms.add(new mt("tex",e=>e.texture)),t.fragment.uniforms.add(new eP("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new qe("opacity",e=>e.opacity)),t.fragment.code.add(S`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const Vgt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:Kre,build:PIe},Symbol.toStringTag,{value:"Module"}));let OIe=class RIe extends Wi{initializeProgram(e){return new Yi(e.rctx,RIe.shader.get().build(),wi)}initializePipeline(){return Gt({blending:Ah(Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA),colorWrite:Kt})}};OIe.shader=new Bi(Vgt,()=>fe(()=>Promise.resolve().then(()=>bUt),void 0));let Kh=class extends Lie{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new Kre,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Zt,this._passParameters=new jre,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new Pr,this.worldToPCSRatio=1,this.events=new cn,this.longitudeCyclical=null,this.produces=new Map([[_e.DRAPED_MATERIAL,i=>i!==G.Highlight||this.hasHighlights],[_e.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,i=this.view._stage.renderView,{waterTextures:r,stippleTextures:s,markerTextures:n}=i;this._techniques=new q$e({rctx:this._rctx,viewingMode:Ge.Local,stippleTextures:s,markerTextures:n,waterTextures:r}),this._renderContext=new xIe(this._rctx,new Zre(e,this.view.state.viewingMode),null),this.addHandles([ue(()=>r.updating,()=>this.events.emit("content-changed"),sr),ue(()=>this.spatialReference,o=>this._localOriginFactory=new wIe(o),sr),Ta(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materials=new W$e(i.textures,this._techniques,()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=_e.DRAPED_MATERIAL,this._bindParameters.mainDepth=null,this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=nt.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new vie($e(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(Mt.STAGE,this))}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=ti(this._debugTextureTechnique),this._passParameters.texture=It(this._passParameters.texture),this._techniques=Le(this._techniques),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||mh(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMaterialRenderer(e){for(const i of this._renderers.values()){const r=i.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map(e=>e.drapeSource.layer).filter(e=>!!e)}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Ju)}createDrapeSourceRenderer(e,i,r){const s=this._renderers.get(e);s!=null&&s.destroy();const n=new i({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(ue(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(e==null)return;const i=this._renderers.get(e);i!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),i.destroy())}computeValidity(){var e;return((e=this._renderTargets)==null?void 0:e.computeValidity())??0}releaseRenderTargets(){var e;(e=this._renderTargets)==null||e.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&C4(e,i=>i.drapeTargetType===EX.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=C4(e,i=>i.drapeSourceType===sI.Features),this._hasDrapedRasterSource=C4(e,i=>i.drapeSourceType===sI.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,i,r=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new jft(this.view._stage.renderer.fboCache),this._overlays=[new rpe,new rpe]),this.ensureDrapeTargets(e),this.ensureDrapeSources(i),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=It(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){var i,r;if(e!=null)return e===Yr.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?(i=this._renderTargets)==null?void 0:i.getTexture(Yr.Color):(r=this._renderTargets)==null?void 0:r.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,i){let r=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||i(s))&&n.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=mh(this._renderers,s=>s.hasHighlights),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(lu,e=>e.updatePolicy===p1.SYNC)}get isEmpty(){return!Rr.OVERLAY_DRAW_DEBUG_TEXTURE&&!mh(this._renderers,e=>!e.isEmpty)}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=aV;const i=this._sortedRenderers.some(({renderer:r})=>r.shouldRender(this._renderContext));return this._renderContext.renderOccludedMask=e,i}renders(e){return Rr.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==Yr.Occluded||this._sortedRenderers.some(({renderer:i})=>i.shouldRender(this._renderContext))}get mode(){var e,i;return this.isEmpty?ig.Disabled:(e=this._renderTargets)!=null&&e.getTexture(Yr.WaterNormal)?ig.EnabledWithWater:(i=this._renderTargets)!=null&&i.getTexture(Yr.Color)?ig.Enabled:ig.Disabled}updateAnimation(e){let i=!1;return this._renderers.forEach(r=>i=r.updateAnimation(e)||i),i}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const i of this._overlays)this.longitudeCyclical?i.setupGeometryViewsCyclical(this.longitudeCyclical):i.setupGeometryViewsDirect();for(const i of this._renderTargets.targets){if(i.content===Yr.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=this._drawTarget(Mn.INNER,i,e),s=this._drawTarget(Mn.OUTER,i,e);(r||s)&&i.fbo.generateMipMap()}}}_drawTarget(e,i,r){const s=this._overlays[e],n=s.canvasGeometries;if(n.numViews===0)return!1;const{alignPixelEnabled:o,contentPixelRatio:a}=r;this._screenToWorldRatio=a*s.mapUnitsPerPixel/this._bindParameters.overlayStretch;const l=i.output;if(this.isEmpty||l===G.Highlight&&!this.hasHighlights||l===G.Normal&&!this.hasWater||!s.hasSomeSizedView())return!1;const c=this._rctx;if(this._camera.pixelRatio=s.pixelRatio*a,this._renderContext.output=l,this._bindParameters.alignPixelEnabled=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=l===G.Normal?_e.DRAPED_WATER:_e.DRAPED_MATERIAL,i.content===Yr.Occluded&&(this._renderContext.renderOccludedMask=aV),!this.renders(i.content))return this._renderContext.renderOccludedMask=nV,!1;const u=s.resolution;this._rctx.setViewport(e===Mn.INNER?0:u,0,u,u);const d=2*s.resolution,p=s.resolution,m=i.fbo;if(m.bind(c,d,p),e===Mn.INNER&&(c.setClearColor(0,0,0,0),c.clear(Lr.COLOR_BUFFER_BIT)),Rr.OVERLAY_DRAW_DEBUG_TEXTURE&&i.content!==Yr.Occluded)for(let g=0;g<n.numViews;g++)this._setViewParameters(n.extents[g],s),this._ensureDebugPatternResources(s.resolution,Ggt[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._renderContext.bindParameters,this._passParameters),this._rctx.screen.draw();return this._sortedRenderers.forAll(({drapeSource:g,renderer:y})=>{if(i.content===Yr.ColorNoRasterImage&&g.drapeSourceType===sI.RasterImage)return;const{fullOpacity:v}=g,b=v!=null&&v<1&&l===G.Color?this.bindTemporaryFramebuffer(d,p):null;for(let w=0;w<n.numViews;w++)this._setViewParameters(n.extents[w],s),y.render(this._renderContext);if(b){m.bind(c,d,p),this._overlayParameters.texture=b.getTexture(),this._overlayParameters.opacity=v,this._overlayParameters.overlayIndex=e;const w=this.pluginContext.techniques.acquire(OIe);this._rctx.bindTechnique(w,this._renderContext.bindParameters,this._overlayParameters),this._rctx.screen.draw(),w.release(),b.release()}}),c.bindFramebuffer(null),this._renderContext.renderOccludedMask=nV,!0}bindTemporaryFramebuffer(e,i){var n;const r=this.view._stage.renderer.fboCache,s=r.acquire(e,i,"overlay tmp");return r.rctx.unbindTexture((n=s.fbo)==null?void 0:n.colorTexture),r.rctx.bindFramebuffer(s.fbo),r.rctx.clear(Lr.COLOR_BUFFER_BIT),s}async reloadShaders(){await this._techniques.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,i,r,s){var o;this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let n=0;for(const{renderer:a}of this._sortedRenderers)n=((o=a.intersect)==null?void 0:o.call(a,e,i,r,s,n))??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers,i=e.length;this._renderers.forEach((r,s)=>{const n=e.indexOf(s.layer),o=n>=0,a=s.renderGroup??(o?Kz.MapLayer:Kz.ViewLayer),l=i*a+(o?n:0);this._sortedRenderers.push(new Bgt(s,r,l))}),this._sortedRenderers.sort((r,s)=>r.index-s.index)}_setViewParameters(e,i){const r=this._camera;r.viewport=[0,0,i.resolution,i.resolution],RSe(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),yT(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=mh(this._renderers,i=>i.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_ensureDebugPatternResources(e,i){if(ne(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let s=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),u=Math.floor(a/10);c<2||u<2||10*c>e-20||10*u>e-20?(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=255):(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=1&c&&1&u?1&l^1&a?0:255:1&c^1&u?0:128)}const n=new jr(e);n.samplingMode=ii.NEAREST,this._passParameters.texture=new br(this._rctx,n,r);const o=new Qre;o.hasAlpha=!0,this._debugTextureTechnique=this._techniques.acquire(Jre,o)}get test(){}};h([f()],Kh.prototype,"hasHighlights",void 0),h([f()],Kh.prototype,"_sortedDrapeSourceRenderersDirty",void 0),h([f()],Kh.prototype,"_techniques",void 0),h([f({constructOnly:!0})],Kh.prototype,"view",void 0),h([f()],Kh.prototype,"worldToPCSRatio",void 0),h([f()],Kh.prototype,"spatialReference",void 0),h([f({type:Boolean,readOnly:!0})],Kh.prototype,"updating",null),h([f()],Kh.prototype,"isEmpty",null),h([f({readOnly:!0})],Kh.prototype,"rendersOccludedDraped",null),Kh=h([I("esri.views.3d.terrain.OverlayRenderer")],Kh);let Bgt=class{constructor(e,i,r){this.drapeSource=e,this.renderer=i,this.index=r}};const Ggt=[[1,.5,.5],[.5,.5,1]],ese=-2,aV=Ji.OccludeAndTransparent;function tse(t,e,i,r){const s=kL(t.rings,!!t.hasZ&&r.mode!=="on-the-ground",Ag.CCW_IS_HOLE,t.spatialReference),n=ho(s.position.length),o=HOe(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,i,r),a=o!=null;return new qgt(s.position,n,LIe(s.polygons,s.position,n),IIe(s.outlines,s.position,n),a,o)}function $Ie(t,e){const i=kL(t.rings,!1,Ag.CCW_IS_HOLE),r=ns(i.position,t.spatialReference,0,i.position,e,0,i.position.length/3);for(let s=2;s<i.position.length;s+=3)i.position[s]=ese;return{position:i.position,polygons:LIe(i.polygons,i.position),outlines:IIe(i.outlines,i.position),projectionSuccess:r}}function IIe(t,e,i=null){return t.filter(({count:r})=>r>1).map(({index:r,count:s})=>{const n=3*r,o=3*s;return i!=null?new DIe(r,s,Nd(e,n,o),Nd(i,n,o)):new ise(r,s,Nd(e,n,o))})}function LIe(t,e,i=null){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const l=3*s,c=3*n,u=o.map(p=>p-s),d=i!=null?new jgt(s,n,Nd(e,3*s,3*n),Nd(i,l,c),u,a):new Hgt(s,n,Nd(e,3*s,3*n),u,a);r.push(d)}return r}let ise=class{constructor(e,i,r){this.index=e,this.count=i,this.position=r}},DIe=class extends ise{constructor(e,i,r,s){super(e,i,r),this.mapPositions=s}},jgt=class extends DIe{constructor(e,i,r,s,n,o){super(e,i,r,s),this.holeIndices=n,this.pathLengths=o}},Hgt=class extends ise{constructor(e,i,r,s,n){super(e,i,r),this.holeIndices=s,this.pathLengths=n}},qgt=class{constructor(e,i,r,s,n,o){this.position=e,this.mapPositions=i,this.polygons=r,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}};function Wd(t,e,i,r,s,n=2){const o=1/(Math.abs(i)+Math.abs(r)+Math.abs(s)),a=i*o,l=r*o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,u=s<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,d=e*n;t[d]=Rpe(c),t[d+1]=Rpe(u)}function Wgt(t){const e=t.length/3,i=new Int16Array(2*e);let r=0;for(let s=0;s<e;++s)Wd(i,s,t[r++],t[r++],t[r++]);return i}function yYt(t,e){const i=t.length/3,r=new Int16Array(2*i);let s=0;const n=E();for(let o=0;o<i;++o)n[0]=t[s++],n[1]=t[s++],n[2]=t[s++],Qo(n,n,e),Wd(r,o,n[0],n[1],n[2]);return r}function Ygt(t,e,i,r=2){const s=i*r,n=$pe(e[s]),o=$pe(e[s+1]),a=1-Math.abs(n)-Math.abs(o);t[2]=a,a<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=o),ge(t,t)}function Rpe(t){return Te(Math.round(32767*t),-32767,32767)}function $pe(t){return Te(t/32767,-1,1)}const Zgt=["polygon","extent"];let Xgt=class extends Gg{constructor(e,i,r,s){super(e,i,r,s),this.ensureDrapedStatus(!1)}async doLoad(){var a,l;if(!this._drivenProperties.size){const c=YG(this._getSymbolSize());if(c)throw new V("graphics3dextrudesymbollayer:invalid-size",c)}const e=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,i=this._getCombinedOpacityAndColor(e),r=Ol(i),s=i[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?Nr.None:Nr.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:Ki.Compressed};this._materials[Qu.Main]=new If(o),this._materials[Qu.Bottom]=new If({...o,cullFace:Nr.Back}),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,Zgt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(i);return this._createAs3DShape(i,e.renderingInfo,r,s,i.uid)}layerOpacityChanged(e,i){var a,l,c,u;const r=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;(c=this._materials[Qu.Main])==null||c.setParameters({opacity:s,transparent:n}),(u=this._materials[Qu.Bottom])==null||u.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();e.forEach(d=>{const p=i(d);p!=null&&p.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Y1)}slicePlaneEnabledChanged(e,i){var r,s;return(r=this._materials[Qu.Main])==null||r.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),(s=this._materials[Qu.Bottom])==null||s.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(n=>{const o=i(n);o!=null&&o.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){var i,r;const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return(i=this._materials[Qu.Main])==null||i.setParameters(e),(r=this._materials[Qu.Bottom])==null||r.setParameters(e),!0}_getExtrusionSize(e){let i;return i=e.size&&this._drivenProperties.size?$ft(e.size,2)??0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(e,i){return this._drivenPropertiesChanged(i)?an.RecreateSymbol:an.RecreateGraphics}async queryForSnapping(e,i,r,s){const n=this._getExtrusionSize(r)*this._context.renderCoordsHelper.unitInMeters/kS(i),{objectId:o,target:a}=e,l=Q(a);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:u}=e,d=Q(c),p=Q(u);return d.z=(d.z??0)+n,p.z=(p.z??0)+n,[Qde(o,l,1/0,d,p)]}case"vertex":return[_ft(o,l,1/0),Qde(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,i,r,s,n){const o=g3(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(U=>U.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=tse(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=mre(o);if(l==null)return null;const c=new Array,u=new Array,d=Jn(),p=Ee(),m=E(),g=this._context.renderCoordsHelper.viewingMode===Ge.Global;g||this._context.renderCoordsHelper.worldUpAtPosition(null,m),mu(o.spatialReference,[l.x,l.y,0],p,this._context.renderCoordsHelper.spatialReference);const y=Ee();In(y,p);const v=Gr();D1(v,y);const{polygons:b,mapPositions:w,position:x}=a,T=new Map,C=this._materials[Qu.Main];for(const U of b){const H=U.count;if(this._context.clippingExtent&&(Br(d),yh(d,U.mapPositions),!af(d,this._context.clippingExtent)))continue;const z=pA(U.mapPositions,U.holeIndices,3);if(z.length===0)continue;const Z=z.length,q=6*H,Y=Cz(q+Z),de=Cz(Z),L=ho(3*q),F=ho(3*q),j=ho(3*q),W=ho(q);Jgt(x,w,z,U,L,j,F,W,Y,de,this._getExtrusionSize(i),m,g),X1(L,L,y);const X=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),K=new oyt(L,j,Wgt(F),W),te=Ipe(C,Y,Y.length-de.length,K,r,X),he=H,we=H,De=2*U.count,at=new ayt(he,we,De,Z/3);NIe(te,at,p),T.set(te,at),c.push(te,Ipe(this._materials[Qu.Bottom],de,0,K,r,X)),u.push(K.heights)}if(c.length===0)return null;const M=new vb({geometries:c,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});M.transformation=p;const O=pRe(this.symbolLayer,{opacity:this._getLayerOpacity()}),D=O!=null?{baseMaterial:this._materials[Qu.Main],edgeMaterials:[O],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,k=new Bg(this,M,c,null,null,(U,H,z,Z,q)=>eyt(U,H,z,Z,q,u,T),s,D);return k.alignedSampledElevation=a.sampledElevation,k.needsElevationUpdates=Y1(s.mode),k}};function Ipe(t,e,i,r,s,n){const o=fb(e.length),a=[[R.POSITION,new it(r.positions,e,3,!0)],[R.NORMALCOMPRESSED,new it(r.normals,e,2,!0)],[R.COLOR,new it(s,o,4,!0)]];return new bn(t,a,r.elevation,Ls.Mesh,n,i)}function Jgt(t,e,i,r,s,n,o,a,l,c,u,d,p){{const m=i.length/3,g=2*r.count;Qgt(t,e,r.index,r.count,i,0,m,s,n,o,a,l,c,g,u,d,p)}{let m=0,g=2*r.count,y=0;const v=r.pathLengths[0];Lpe(s,n,a,o,m,v,r.count,g,l,y,u),g+=4*v,y+=2*v,m+=v;for(let b=1;b<r.pathLengths.length;++b){const w=r.pathLengths[b];Lpe(s,n,a,o,m,w,r.count,g,l,y,u),g+=4*w,y+=2*w,m+=w}}}function Qgt(t,e,i,r,s,n,o,a,l,c,u,d,p,m,g,y,v){ce(Gu,y);{const b=g>0?1:-1;let w=3*i,x=0,T=3*x,C=r,M=3*C;for(let O=0;O<r;++O){const D=t[w],k=t[w+1],U=t[w+2];v&&(Gu[0]=D,Gu[1]=k,Gu[2]=U,ge(Gu,Gu)),a[T+0]=D,a[T+1]=k,a[T+2]=U;const H=e[w+0],z=e[w+1],Z=e[w+2];l[T+0]=H,l[T+1]=z,l[T+2]=Z,c[T+0]=-b*Gu[0],c[T+1]=-b*Gu[1],c[T+2]=-b*Gu[2],u[x]=0,a[M+0]=D+g*Gu[0],a[M+1]=k+g*Gu[1],a[M+2]=U+g*Gu[2],l[M+0]=H,l[M+1]=z,l[M+2]=Z,u[C]=g,T+=3,M+=3,w+=3,x+=1,C+=1}}{let b=3*n,w=0,x=3*m;const T=g<0?zpe:Upe,C=g<0?Upe:zpe;for(let M=0;M<o;++M)p[w]=s[b+T[0]],p[w+1]=s[b+T[1]],p[w+2]=s[b+T[2]],d[x]=s[b+C[0]]+r,d[x+1]=s[b+C[1]]+r,d[x+2]=s[b+C[2]]+r,w+=3,x+=3,b+=3}}function JN(t,e,i,r,s,n,o){r[n]=r[o],o*=3,t[n*=3]=t[o],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n]=e[o],e[n+1]=e[o+1],e[n+2]=e[o+2],i[n]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const XP=E();function Lpe(t,e,i,r,s,n,o,a,l,c,u){let d=s,p=s+1,m=s+o,g=s+o+1,y=a,v=a+1,b=a+2*n,w=a+2*n+1;u<0&&(d=s+o+1,g=s);let x=3*c;for(let T=0;T<n;++T)T===n-1&&(p=s,u>0?g=s+o:d=s+o),Kgt(t,d,p,m,XP),JN(t,e,r,i,XP,y,d),JN(t,e,r,i,XP,v,p),JN(t,e,r,i,XP,b,m),JN(t,e,r,i,XP,w,g),l[x]=y,l[x+1]=b,l[x+2]=w,l[x+3]=y,l[x+4]=w,l[x+5]=v,x+=6,d++,p++,m++,g++,y+=2,v+=2,b+=2,w+=2}const yH=E(),Dpe=E(),Npe=E(),Fpe=E(),kpe=E();function Kgt(t,e,i,r,s){e*=3,i*=3,r*=3,ne(yH,t[e++],t[e++],t[e++]),ne(Dpe,t[i++],t[i++],t[i++]),ne(Npe,t[r++],t[r++],t[r++]),ve(Fpe,Dpe,yH),ve(kpe,Npe,yH),ot(s,kpe,Fpe),ge(s,s)}const g2=E();function eyt(t,e,i,r,s,n,o){const a=t.stageObject,l=a.geometries,c=l.length,u=e.mode!=="absolute-height";let d=0;const p=a.transformation,m=rb(Ee(),p);for(let g=0;g<c;g+=2){const y=l[g];if(!pre(y))continue;const v=y.getMutableAttribute(R.POSITION).data,b=n[g/2],w=new bte(y.mapPositions),x=v.length/3;let T=!1,C=0;{let M=0;for(let O=0;O<x;O++){g2[0]=v[M],g2[1]=v[M+1],g2[2]=v[M+2],r(w,QN),u&&(C+=QN.sampledElevation),Rr.TESTS_DISABLE_OPTIMIZATIONS?(ne(Tl,w.array[w.offset],w.array[w.offset+1],QN.z+b[M/3]),i!=null&&s.toRenderCoords(Tl,i,Tl),He(Tl,Tl,m)):(ne(Tl,v[M],v[M+1],v[M+2]),He(Tl,Tl,p),s.setAltitude(Tl,QN.z+b[M/3]),He(Tl,Tl,m)),v[M]=Tl[0],v[M+1]=Tl[1],v[M+2]=Tl[2];const D=tyt/s.unitInMeters;(Math.abs(g2[0]-v[M])>=D||Math.abs(g2[1]-v[M+1])>=D||Math.abs(g2[2]-v[M+2])>=D)&&(T=!0),w.offset+=3,M+=3}}if(T){const M=o.get(y);M&&NIe(y,M,p),a.geometryVertexAttributeUpdated(l[g],R.NORMALCOMPRESSED),y.invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[g],R.POSITION),l[g+1].invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[g+1],R.POSITION)}d+=C/x}return d/c}function NIe(t,e,i){const r=t.getMutableAttribute(R.POSITION),s=t.getMutableAttribute(R.NORMALCOMPRESSED).data,{topVertexStart:n,topVertexCount:o,topFaceStart:a,topFaceCount:l}=e,c=r.data,u=o,d=t.attributes.get(R.POSITION).indices,p=a+l,m=n+o,g=ho(3*u);for(let T=0;T<u;++T){const C=3*T;g[C+0]=0,g[C+1]=0,g[C+2]=0}const y=iyt,v=ryt,b=syt,w=nyt,x=Gu;for(let T=a;T<p;++T){const C=3*T;for(let M=0;M<3;++M){const O=d[C+M];w[M]=O;const D=3*O;ne(Tl,c[D+0],c[D+1],c[D+2]),He(y[M],Tl,i)}Ai(v,y[1],y[0]),Ai(b,y[2],y[0]),ot(x,v,b),ge(x,x);for(let M=0;M<3;++M){const O=3*(w[M]-n);g[O+0]+=x[0],g[O+1]+=x[1],g[O+2]+=x[2]}}for(let T=n;T<m;++T){const C=3*(T-n),M=g[C+0],O=g[C+1],D=g[C+2],k=Math.sqrt(M*M+O*O+D*D);Wd(s,T,M/k,O/k,D/k)}}const Tl=E(),Gu=E(),QN=new ML,Upe=[0,2,1],zpe=[0,1,2],tyt=.01,iyt=[E(),E(),E()],ryt=E(),syt=E(),nyt=[0,0,0];var Qu;(function(t){t[t.Main=0]="Main",t[t.Bottom=1]="Bottom"})(Qu||(Qu={}));let oyt=class{constructor(e,i,r,s){this.positions=e,this.elevation=i,this.normals=r,this.heights=s}},ayt=class{constructor(e,i,r,s){this.topVertexStart=e,this.topVertexCount=i,this.topFaceStart=r,this.topFaceCount=s}};const KN=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["Â«","Â»"],["Â»","Â«"],["â€¹","â€º"],["â€º","â€¹"],["â½","â¾"],["â¾","â½"],["â‚","â‚Ž"],["â‚Ž","â‚"],["â‰¤","â‰¥"],["â‰¥","â‰¤"],["âŒ©","âŒª"],["âŒª","âŒ©"],["ï¹™","ï¹š"],["ï¹š","ï¹™"],["ï¹›","ï¹œ"],["ï¹œ","ï¹›"],["ï¹","ï¹ž"],["ï¹ž","ï¹"],["ï¹¤","ï¹¥"],["ï¹¥","ï¹¤"]],mA=["Ø¢","Ø£","Ø¥","Ø§"],lyt=["ï»µ","ï»·","ï»¹","ï»»"],cyt=["ï»¶","ï»¸","ï»º","ï»¼"],lV=["Ø§","Ø¨","Øª","Ø«","Ø¬","Ø­","Ø®","Ø¯","Ø°","Ø±","Ø²","Ø³","Ø´","Øµ","Ø¶","Ø·","Ø¸","Ø¹","Øº","Ù","Ù‚","Ùƒ","Ù„","Ù…","Ù†","Ù‡","Ùˆ","ÙŠ","Ø¥","Ø£","Ø¢","Ø©","Ù‰","Ù„","Ù…","Ù†","Ù‡","Ùˆ","ÙŠ","Ø¥","Ø£","Ø¢","Ø©","Ù‰","ÛŒ","Ø¦","Ø¤"],uyt=["ïº","ïº","ïº•","ïº™","ïº","ïº¡","ïº¥","ïº©","ïº«","ïº­","ïº¯","ïº±","ïºµ","ïº¹","ïº½","ï»","ï»…","ï»‰","ï»","ï»‘","ï»•","ï»™","ï»","ï»¡","ï»¥","ï»©","ï»­","ï»±","ïº‡","ïºƒ","ïº","ïº“","ï»¯","ï¯¼","ïº‰","ïº…","ï¹°","ï¹²","ï¹´","ï¹¶","ï¹¸","ï¹º","ï¹¼","ï¹¾","ïº€","ïº‰","ïº…"],hyt=["ïºŽ","ïº","ïº–","ïºš","ïºž","ïº¢","ïº¦","ïºª","ïº¬","ïº®","ïº°","ïº²","ïº¶","ïºº","ïº¾","ï»‚","ï»†","ï»Š","ï»Ž","ï»’","ï»–","ï»š","ï»ž","ï»¢","ï»¦","ï»ª","ï»®","ï»²","ïºˆ","ïº„","ïº‚","ïº”","ï»°","ï¯½","ïºŠ","ïº†","ï¹°","ï¹²","ï¹´","ï¹¶","ï¹¸","ï¹º","ï¹¼","ï¹¾","ïº€","ïºŠ","ïº†"],dyt=["ïºŽ","ïº’","ïº˜","ïºœ","ïº ","ïº¤","ïº¨","ïºª","ïº¬","ïº®","ïº°","ïº´","ïº¸","ïº¼","ï»€","ï»„","ï»ˆ","ï»Œ","ï»","ï»”","ï»˜","ï»œ","ï» ","ï»¤","ï»¨","ï»¬","ï»®","ï»´","ïºˆ","ïº„","ïº‚","ïº”","ï»°","ï¯¿","ïºŒ","ïº†","ï¹±","ï¹²","ï¹´","ï¹·","ï¹¹","ï¹»","ï¹½","ï¹¿","ïº€","ïºŒ","ïº†"],pyt=["ïº","ïº‘","ïº—","ïº›","ïºŸ","ïº£","ïº§","ïº©","ïº«","ïº­","ïº¯","ïº³","ïº·","ïº»","ïº¿","ï»ƒ","ï»‡","ï»‹","ï»","ï»“","ï»—","ï»›","ï»Ÿ","ï»£","ï»§","ï»«","ï»­","ï»³","ïº‡","ïºƒ","ïº","ïº“","ï»¯","ï¯¾","ïº‹","ïº…","ï¹°","ï¹²","ï¹´","ï¹¶","ï¹¸","ï¹º","ï¹¼","ï¹¾","ïº€","ïº‹","ïº…"],Vpe=["Ø¡","Ø¢","Ø£","Ø¤","Ø¥","Ø§","Ø©","Ø¯","Ø°","Ø±","Ø²","Ùˆ","Ù‰"],fyt=["Ù‹","Ù‹","ÙŒ","ØŸ","Ù","ØŸ","ÙŽ","ÙŽ","Ù","Ù","Ù","Ù","Ù‘","Ù‘","Ù’","Ù’","Ø¡","Ø¢","Ø¢","Ø£","Ø£","Ø¤","Ø¤","Ø¥","Ø¥","Ø¦","Ø¦","Ø¦","Ø¦","Ø§","Ø§","Ø¨","Ø¨","Ø¨","Ø¨","Ø©","Ø©","Øª","Øª","Øª","Øª","Ø«","Ø«","Ø«","Ø«","Ø¬","Ø¬","Ø¬","Ø¬","Ø­","Ø­","Ø­","Ø­","Ø®","Ø®","Ø®","Ø®","Ø¯","Ø¯","Ø°","Ø°","Ø±","Ø±","Ø²","Ø²","Ø³","Ø³","Ø³","Ø³","Ø´","Ø´","Ø´","Ø´","Øµ","Øµ","Øµ","Øµ","Ø¶","Ø¶","Ø¶","Ø¶","Ø·","Ø·","Ø·","Ø·","Ø¸","Ø¸","Ø¸","Ø¸","Ø¹","Ø¹","Ø¹","Ø¹","Øº","Øº","Øº","Øº","Ù","Ù","Ù","Ù","Ù‚","Ù‚","Ù‚","Ù‚","Ùƒ","Ùƒ","Ùƒ","Ùƒ","Ù„","Ù„","Ù„","Ù„","Ù…","Ù…","Ù…","Ù…","Ù†","Ù†","Ù†","Ù†","Ù‡","Ù‡","Ù‡","Ù‡","Ùˆ","Ùˆ","Ù‰","Ù‰","ÙŠ","ÙŠ","ÙŠ","ÙŠ","ï»µ","ï»¶","ï»·","ï»¸","ï»¹","ï»º","ï»»","ï»¼","ØŸ","ØŸ","ØŸ"],Bpe=["Ø¡","Ù"],myt=["Øº","ÙŠ"],gyt=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],yyt=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],$=0,xe=1,Nt=2,Vn=3,A=4,Um=5,G5=6,P=7,wl=8,Ql=9,up=10,qt=11,ee=12,_yt=13,vyt=14,byt=15,wyt=16,xyt=17,wt=18,Syt=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],Im=100,Tyt=[Im+0,$,$,$,$,Im+1,Im+2,Im+3,xe,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,Im+4,A,A,A,$,A,$,A,$,A,A,A,$,$,A,A,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,A,A,$,$,A,A,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,$,Im+5,P,P,Im+6,Im+7],Eyt=[[wt,wt,wt,wt,wt,wt,wt,wt,wt,G5,Um,G5,wl,Um,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,Um,Um,Um,G5,wl,A,A,qt,qt,qt,A,A,A,A,A,up,Ql,up,Ql,Ql,Nt,Nt,Nt,Nt,Nt,Nt,Nt,Nt,Nt,Nt,Ql,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,wt,wt,wt,wt,wt,wt,Um,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,wt,Ql,A,qt,qt,qt,qt,A,A,A,A,$,A,A,wt,A,A,qt,qt,Nt,Nt,A,$,A,A,A,Nt,$,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,$,$,$,$,$,$,$,$],[$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,$,$,$,$,$,$,$,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,$,A,A,A,A,A,A,A,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,xe,ee,xe,ee,ee,xe,ee,ee,xe,ee,A,A,A,A,A,A,A,A,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,A,A,A,A,A,xe,xe,xe,xe,xe,A,A,A,A,A,A,A,A,A,A,A],[Vn,Vn,Vn,Vn,A,A,A,A,P,qt,qt,P,Ql,P,A,A,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,P,A,A,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,Vn,Vn,Vn,Vn,Vn,Vn,Vn,Vn,Vn,Vn,qt,Vn,Vn,P,P,P,ee,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,ee,ee,ee,ee,ee,ee,ee,Vn,A,ee,ee,ee,ee,ee,ee,P,P,ee,ee,A,ee,ee,ee,ee,P,P,Nt,Nt,Nt,Nt,Nt,Nt,Nt,Nt,Nt,Nt,P,P,P,P,P,P],[P,P,P,P,P,P,P,P,P,P,P,P,P,P,A,P,P,ee,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,A,A,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,P,A,A,A,A,A,A,A,A,A,A,A,A,A,A,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,ee,ee,ee,ee,ee,ee,ee,ee,ee,xe,xe,A,A,A,A,xe,A,A,A,A,A],[wl,wl,wl,wl,wl,wl,wl,wl,wl,wl,wl,wt,wt,wt,$,xe,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,wl,Um,_yt,vyt,byt,wyt,xyt,Ql,qt,qt,qt,qt,qt,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,Ql,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,wl,wt,wt,wt,wt,wt,A,A,A,A,A,wt,wt,wt,wt,wt,wt,Nt,$,A,A,Nt,Nt,Nt,Nt,Nt,Nt,up,up,A,A,A,$,Nt,Nt,Nt,Nt,Nt,Nt,Nt,Nt,Nt,Nt,up,up,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A],[$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,A,$,$,$,$,$,A,A,A,A,A,xe,ee,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,up,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,A,xe,xe,xe,xe,xe,A,xe,A,xe,xe,A,xe,xe,A,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P],[ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,ee,ee,ee,ee,ee,ee,ee,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,Ql,A,Ql,A,A,Ql,A,A,A,A,A,A,A,A,A,qt,A,A,up,up,A,A,A,A,A,qt,qt,A,A,A,A,A,P,P,P,P,P,A,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,A,A,wt],[A,A,A,qt,qt,qt,A,A,A,A,A,up,Ql,up,Ql,Ql,Nt,Nt,Nt,Nt,Nt,Nt,Nt,Nt,Nt,Nt,Ql,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,$,$,$,$,$,$,A,A,$,$,$,$,$,$,A,A,$,$,$,$,$,$,A,A,$,$,$,A,A,A,qt,qt,A,A,A,qt,qt,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A]];let Cyt=class{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(e,i,r){if(this.sourceToTarget=[],this.targetToSource=[],!e)return"";if(Gyt(this.sourceToTarget,this.targetToSource,e.length),!this.checkParameters(i,r))return e;i=this.inputFormat,r=this.outputFormat;let s=e;const n=Hyt,o=Hpe(i.charAt(1)),a=Hpe(r.charAt(1)),l=(i.charAt(0)==="I"?"L":i.charAt(0))+o,c=(r.charAt(0)==="I"?"L":r.charAt(0))+a,u=i.charAt(2)+r.charAt(2);n.defInFormat=l,n.defOutFormat=c,n.defSwap=u;const d=ER(e,l,c,u,n);let p=!1;return r.charAt(1)==="R"?p=!0:r.charAt(1)!=="C"&&r.charAt(1)!=="D"||(p=this.checkContextual(d)==="rtl"),this.sourceToTarget=fh,this.targetToSource=jyt(this.sourceToTarget),uV=this.targetToSource,s=i.charAt(3)===r.charAt(3)?d:r.charAt(3)==="S"?Ayt(p,d):Ryt(d,p,!0),this.sourceToTarget=fh,this.targetToSource=uV,this.levels=aj,s}_inputFormatSetter(e){if(!qpe.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=e}_outputFormatSetter(e){if(!qpe.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=e}checkParameters(e,i){return e?this._inputFormatSetter(e):e=this.inputFormat,i?this._outputFormatSetter(i):i=this.outputFormat,e!==i}checkContextual(e){let i=cV(e);if(i!=="ltr"&&i!=="rtl"){try{i=document.dir.toLowerCase()}catch{}i!=="ltr"&&i!=="rtl"&&(i="ltr")}return i}hasBidiChar(e){return Yyt.test(e)}};function ER(t,e,i,r,s){const n=Myt(t,{inFormat:e,outFormat:i,swap:r},s);if(n.inFormat===n.outFormat)return t;e=n.inFormat,i=n.outFormat,r=n.swap;const o=e.substring(0,1),a=e.substring(1,4),l=i.substring(0,1),c=i.substring(1,4);if(s.inFormat=e,s.outFormat=i,s.swap=r,o==="L"&&i==="VLTR"){if(a==="LTR")return s.dir=y2,O_(t,s);if(a==="RTL")return s.dir=CR,O_(t,s)}if(o==="V"&&l==="V")return s.dir=a==="RTL"?CR:y2,_H(t,s);if(o==="L"&&i==="VRTL")return a==="LTR"?(s.dir=y2,t=O_(t,s)):(s.dir=CR,t=O_(t,s)),_H(t);if(e==="VLTR"&&i==="LLTR")return s.dir=y2,O_(t,s);if(o==="V"&&l==="L"&&a!==c)return t=_H(t),a==="RTL"?ER(t,"LLTR","VLTR",r,s):ER(t,"LRTL","VRTL",r,s);if(e==="VRTL"&&i==="LRTL")return ER(t,"LRTL","VRTL",r,s);if(o==="L"&&l==="L"){const u=s.swap;return s.swap=u.substr(0,1)+"N",a==="RTL"?(s.dir=CR,t=O_(t,s),s.swap="N"+u.substr(1,2),s.dir=y2,t=O_(t,s)):(s.dir=y2,t=O_(t,s),s.swap="N"+u.substr(1,2),t=ER(t,"VLTR","LRTL",s.swap,s)),t}return t}function Myt(t,e,i){if(e.inFormat===void 0&&(e.inFormat=i.defInFormat),e.outFormat===void 0&&(e.outFormat=i.defOutFormat),e.swap===void 0&&(e.swap=i.defSwap),e.inFormat===e.outFormat)return e;const r=e.inFormat.substring(0,1),s=e.outFormat.substring(0,1);let n,o=e.inFormat.substring(1,4),a=e.outFormat.substring(1,4);return o.charAt(0)==="C"&&(n=cV(t),o=n==="ltr"||n==="rtl"?n.toUpperCase():e.inFormat.charAt(2)==="L"?"LTR":"RTL",e.inFormat=r+o),a.charAt(0)==="C"&&(n=cV(t),n==="rtl"?a="RTL":n==="ltr"?(n=Oyt(t),a=n.toUpperCase()):a=e.outFormat.charAt(2)==="L"?"LTR":"RTL",e.outFormat=s+a),e}function Ayt(t,e,i){if(e.length===0)return"";t===void 0&&(t=!0);const r=(e=String(e)).split("");let s=0,n=1,o=r.length;t||(s=r.length-1,n=-1,o=1);const a=Pyt(r,s,n,o);let l="";for(let c=0;c<r.length;c++)Dyt(a,a.length,c)>-1?(UIe(uV,c,!t,-1),fh.splice(c,1)):l+=r[c];return l}function Pyt(t,e,i,r,s){let n=0;const o=[];let a=0;for(let l=e;l*i<r;l+=i)if(kIe(t[l])||_3(t[l])){if(t[l]==="Ù„"&&Nyt(t,l+i,i,r)){t[l]=Byt(t[l+i],n===0?lyt:cyt),l+=i,Vyt(t,l,i,r),o[a]=l,a++,n=0;continue}const c=t[l];n===1?t[l]=Gpe(t,l+i,i,r)?zyt(t[l]):vH(t[l],hyt):Gpe(t,l+i,i,r)===!0?t[l]=vH(t[l],pyt):t[l]=vH(t[l],uyt),_3(c)||(n=1),Uyt(c)===!0&&(n=0)}else n=0;return o}function cV(t){const e=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(t);return e?e[0]<="z"?"ltr":"rtl":""}function Oyt(t){const e=t.split("");return e.reverse(),cV(e.join(""))}function Ryt(t,e,i){if(t.length===0)return"";e===void 0&&(e=!0);let r="";const s=(t=String(t)).split("");for(let n=0;n<t.length;n++){let o=!1;if(s[n]>="ï¹°"&&s[n]<"\uFEFF"){const a=t.charCodeAt(n);s[n]>="ï»µ"&&s[n]<="ï»¼"?(e?(n>0&&i&&s[n-1]===" "?r=r.substring(0,r.length-1)+"Ù„":(r+="Ù„",o=!0),r+=mA[(a-65269)/2]):(r+=mA[(a-65269)/2],r+="Ù„",n+1<t.length&&i&&s[n+1]===" "?n++:o=!0),o&&(UIe(uV,n,!0,1),fh.splice(n,0,fh[n]))):r+=fyt[a-65136]}else r+=s[n]}return r}function O_(t,e){const i=t.split(""),r=[];return FIe(i,r,e),Iyt(i,r,e),jpe(2,i,r,e),jpe(1,i,r,e),aj=r,i.join("")}function FIe(t,e,i){const r=t.length,s=i.dir?yyt:gyt;let n=0,o=-1;const a=[],l=[];i.hiLevel=i.dir,i.lastArabic=!1,i.hasUbatAl=!1,i.hasUbatB=!1,i.hasUbatS=!1;for(let c=0;c<r;c++)a[c]=Lyt(t[c]);for(let c=0;c<r;c++){const u=n,d=Fyt(t,a,l,c,i);l[c]=d,n=s[u][d];const p=240&n;n&=15;const m=s[n][qyt];if(e[c]=m,p>0)if(p===16){for(let g=o;g<c;g++)e[g]=1;o=-1}else o=-1;if(s[n][Wyt])o===-1&&(o=c);else if(o>-1){for(let g=o;g<c;g++)e[g]=m;o=-1}a[c]===Um&&(e[c]=0),i.hiLevel|=m}i.hasUbatS&&$yt(a,e,r,i)}function $yt(t,e,i,r){for(let s=0;s<i;s++)if(t[s]===G5){e[s]=r.dir;for(let n=s-1;n>=0&&t[n]===wl;n--)e[n]=r.dir}}function Iyt(t,e,i){if(i.hiLevel!==0&&i.swap.substr(0,1)!==i.swap.substr(1,2))for(let r=0;r<t.length;r++)e[r]===1&&(t[r]=kyt(t[r]))}function Lyt(t){const e=t.charCodeAt(0),i=Tyt[e>>8];return i<Im?i:Eyt[i-Im][255&e]}function _H(t,e){const i=t.split("");if(e){const r=[];FIe(i,r,e),aj=r}return i.reverse(),fh.reverse(),i.join("")}function Dyt(t,e,i){for(let r=0;r<e;r++)if(t[r]===i)return r;return-1}function kIe(t){for(let e=0;e<Bpe.length;e++)if(t>=Bpe[e]&&t<=myt[e])return!0;return!1}function Gpe(t,e,i,r){for(;e*i<r&&_3(t[e]);)e+=i;return!!(e*i<r&&kIe(t[e]))}function Nyt(t,e,i,r){for(;e*i<r&&_3(t[e]);)e+=i;let s=" ";if(!(e*i<r))return!1;s=t[e];for(let n=0;n<mA.length;n++)if(mA[n]===s)return!0;return!1}function jpe(t,e,i,r){if(r.hiLevel<t)return;if(t===1&&r.dir===CR&&!r.hasUbatB)return e.reverse(),void fh.reverse();const s=e.length;let n,o,a,l,c,u=0;for(;u<s;){if(i[u]>=t){for(n=u+1;n<s&&i[n]>=t;)n++;for(o=u,a=n-1;o<a;o++,a--)l=e[o],e[o]=e[a],e[a]=l,c=fh[o],fh[o]=fh[a],fh[a]=c;u=n}u++}}function Fyt(t,e,i,r,s){const n=e[r];return{UBAT_L:()=>(s.lastArabic=!1,$),UBAT_R:()=>(s.lastArabic=!1,xe),UBAT_ON:()=>A,UBAT_AN:()=>Vn,UBAT_EN:()=>s.lastArabic?Vn:Nt,UBAT_AL:()=>(s.lastArabic=!0,s.hasUbatAl=!0,xe),UBAT_WS:()=>A,UBAT_CS:()=>{let o,a;return r<1||r+1>=e.length||(o=i[r-1])!==Nt&&o!==Vn||(a=e[r+1])!==Nt&&a!==Vn?A:(s.lastArabic&&(a=Vn),a===o?a:A)},UBAT_ES:()=>(r>0?i[r-1]:Um)===Nt&&r+1<e.length&&e[r+1]===Nt?Nt:A,UBAT_ET:()=>{if(r>0&&i[r-1]===Nt)return Nt;if(s.lastArabic)return A;let o=r+1;const a=e.length;for(;o<a&&e[o]===qt;)o++;return o<a&&e[o]===Nt?Nt:A},UBAT_NSM:()=>{if(s.inFormat==="VLTR"){const o=e.length;let a=r+1;for(;a<o&&e[a]===ee;)a++;if(a<o){const l=t[r].charCodeAt(0),c=l>=1425&&l<=2303||l===64286,u=e[a];if(c&&(u===xe||u===P))return xe}}return r<1||e[r-1]===Um?A:i[r-1]},UBAT_B:()=>(s.lastArabic=!0,s.hasUbatB=!0,s.dir),UBAT_S:()=>(s.hasUbatS=!0,A),UBAT_LRE:()=>(s.lastArabic=!1,A),UBAT_RLE:()=>(s.lastArabic=!1,A),UBAT_LRO:()=>(s.lastArabic=!1,A),UBAT_RLO:()=>(s.lastArabic=!1,A),UBAT_PDF:()=>(s.lastArabic=!1,A),UBAT_BN:()=>A}[Syt[n]]()}function kyt(t){let e,i=0,r=KN.length-1;for(;i<=r;)if(e=Math.floor((i+r)/2),t<KN[e][0])r=e-1;else{if(!(t>KN[e][0]))return KN[e][1];i=e+1}return t}function Uyt(t){for(let e=0;e<Vpe.length;e++)if(Vpe[e]===t)return!0;return!1}function zyt(t){for(let e=0;e<lV.length;e++)if(t===lV[e])return dyt[e];return t}function vH(t,e){for(let i=0;i<lV.length;i++)if(t===lV[i])return e[i];return t}function _3(t){return t>="Ù‹"&&t<="Ù•"}function Hpe(t){return t==="L"?"LTR":t==="R"?"RTL":t==="C"?"CLR":t==="D"?"CRL":""}function Vyt(t,e,i,r){for(;e*i<r&&_3(t[e]);)e+=i;return e*i<r&&(t[e]=" ",!0)}function Byt(t,e){for(let i=0;i<mA.length;i++)if(t===mA[i])return e[i];return t}function Gyt(t,e,i){fh=[],aj=[];for(let r=0;r<i;r++)t[r]=r,e[r]=r,fh[r]=r}function jyt(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[t[i]]=i;return e}function UIe(t,e,i,r){for(let s=0;s<t.length;s++)(t[s]>e||!i&&t[s]===e)&&(t[s]+=r)}let fh=[],uV=[],aj=[];const Hyt={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},qyt=5,Wyt=6,y2=0,CR=1,qpe=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,Yyt=/[\u0591-\u06ff\ufb1d-\ufefc]/,bH=new Cyt;function Zyt(t){if(t==null)return["",!1];if(!bH.hasBidiChar(t))return[t,!1];let e;return e=bH.checkContextual(t)==="rtl"?"IDNNN":"ICNNN",[bH.bidiTransform(t,e,"VLYSN"),!0]}let iP=class{constructor(){this.setIdentity()}getAngle(){return(this.rz==null||this.rz===0&&this.rzCos!==1&&this.rzSin!==0)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(e,i){this.tx=e,this.ty=i}setTranslateZ(e){this.tz=e}setRotateCS(e,i){this.rz=void 0,this.rzCos=e,this.rzSin=i}setRotate(e){this.rz=e,this.rzCos=void 0,this.rzSin=void 0}setRotateY(e){this.ry=e}setScale(e){this.s=e}setMeasure(e){this.m=e}};const rse="arial-unicode-ms",Wpe="woff2",Ype=new Map,zIe=new Set;let Xyt=class{constructor(e,i){this.fontFace=e,this.promise=i}};async function Jyt(t){const e=t0t(t),i=e0t(t),r=Ype.get(e);if(r)return r.promise;const s=new FontFace(t.family,`url('${lr.fontsUrl}/woff2/${i}.${Wpe}') format('${Wpe}')`,{style:t.style,weight:t.weight}),n=document.fonts;if(n.has(s)&&s.status==="loading")return s.loaded;const o=s.load().then(()=>(n.add(s),s));return Ype.set(e,new Xyt(s,o)),zIe.add(s),o}function Qyt(t){return zIe.has(t)}function Kyt(t){if(!t)return rse;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function e0t(t){const e=VIe(t)+BIe(t);return Kyt(t.family)+(e.length>0?e:"-regular")}function t0t(t){const e=VIe(t)+BIe(t);return(t.family||rse)+(e.length>0?e:"-regular")}function VIe(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function BIe(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let Xn=class{static fromOptimized(e,i,r=!1,s=!1,n=1){return new OX().initialize(e,i,r,s,n)}static fromJSON(e,i=!1,r=!1){const[s,n]=Zpe(e);return new RX().initialize(s,n,i,r,1)}static fromOptimizedCIM(e,i,r=!1,s=!1,n=1){return new Xpe().initialize(e,i,r,s,n)}static fromJSONCIM(e,i=!1,r=!1,s=1){const[n,o]=Zpe(e);return new Jpe().initialize(n,o,i,r,s)}static fromFeatureSetReader(e){const i=e.readGeometryForDisplay(),r=e.geometryType;return i&&r?this.fromOptimized(i,r):null}static fromFeatureSetReaderCIM(e){const i=e.readGeometryForDisplay(),r=e.geometryType;return i&&r?this.fromOptimizedCIM(i,r):null}static createEmptyOptimized(e,i=!1,r=!1,s=1){return new OX().initialize(new Eu,e,i,r,s)}static createEmptyJSON(e,i=!1,r=!1){return new RX().initialize([],e,i,r,1)}static createEmptyOptimizedCIM(e,i=!1,r=!1,s=1){return new Xpe().initialize(new Eu,e,i,r,s)}static createEmptyJSONCIM(e,i=!1,r=!1,s=1){return new Jpe().initialize([],e,i,r,s)}asJSON(){const e=Y3(this);return this.geometryType==="esriGeometryEnvelope"?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:this.geometryType==="esriGeometryMultipoint"?{points:e.flat()}:this.geometryType==="esriGeometryPoint"?{x:e[0][0][0],y:e[0][0][1]}:this.geometryType==="esriGeometryPolygon"?{rings:e}:{paths:e}}getCurrentRingArea(){if(this.pathSize<3)return 0;let e,i,r=0;if(this.seekPathStart(),!this.nextPoint())return 0;e=this.x,i=this.y;const s=e,n=i;for(;this.nextPoint();)r+=(e-this.x)*(i+this.y),e=this.x,i=this.y;return r+=(e-s)*(i+n),-.5*r}invertY(){this.yFactor*=-1}},OX=class GIe extends Xn{constructor(){super(...arguments),this._end=-1}initialize(e,i,r,s,n){return this.hasZ=r,this.hasM=s,this.geometryType=i,this._stride=2+Number(r)+Number(s),this._geometry=e,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=n,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(e){if(e>=0&&e<this.totalSize){if(this._pathIndex<e)for(;this._pathIndex<e&&this.nextPath(););else if(this._pathIndex>e)for(;this._pathIndex>e&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(e){const i=this._pathOffset+e*this._stride;return i>=0&&i<this._end&&(this._pointOffset=i,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1)&&(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,!0)}prevPath(){return!(this.pathIndex<=0)&&(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,!0)}pathLength(){const e=this._end,i=this._stride,r=this._geometry.coords;let s=0;for(let n=this._pathOffset+i;n<e;n+=i){const o=r[n-i],a=r[n-i+1],l=r[n]-o,c=r[n+1]-a;s+=Math.sqrt(l*l+c*c)}return s}startPath(){this._geometry.lengths.push(0)}pushPath(e){this.startPath(),this.pushPoints(e)}pushPoint(e){for(let i=0;i<this._stride;++i)this._geometry.coords.push(e[i]);this._geometry.lengths[this.totalSize-1]++}pushXY(e,i){this._geometry.coords.push(e,i),this._geometry.lengths[this.totalSize-1]++}pushPoints(e){for(const i of e)for(let r=0;r<this._stride;++r)this._geometry.coords.push(i[r]);this._geometry.lengths[this.totalSize-1]+=e.length}pushCursor(e){const i=e.asOptimized();this._geometry.coords.push(...i.coords),this._geometry.lengths.push(...i.lengths)}asOptimized(){const e=this._geometry.clone();if(this.yFactor!==1)for(let i=1;i<e.coords.length;i+=this._stride)e.coords[i]*=this.yFactor;return this.geometryType==="esriGeometryPoint"&&(e.lengths.length=0),e}isClosed(){const e=this._geometry.coords,i=this._pathOffset,r=this._end-this._stride;for(let s=0;s<this._stride;s++)if(e[i+s]!==e[r+s])return!1;return!0}clone(){return new GIe().initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((e,i)=>e+i)}get pathSize(){const{lengths:e}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>e.length-1?0:e[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(e){this._geometry.coords[this._pointOffset]=e}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(e){this._geometry.coords[this._pointOffset+1]=this.yFactor*e}get z(){return this._geometry.coords[this._pointOffset+2]}set z(e){this._geometry.coords[this._pointOffset+2]=e}get m(){const e=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+e]}set m(e){this._geometry.coords[this._pointOffset+3]=e}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}};function i0t(t){const e=[t.x,t.y];return t.z&&e.push(t.z),t.m&&e.push(t.m),e}function Zpe(t){return Ll(t)?[t.rings,"esriGeometryPolygon"]:Kp(t)?[t.paths,"esriGeometryPolyline"]:uS(t)?[[t.points],"esriGeometryMultipoint"]:Qp(t)?[[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]],"esriGeometryEnvelope"]:IM(t)?[[[i0t(t)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}let RX=class jIe extends Xn{initialize(e,i,r,s,n){return this._paths=e,this.geometryType=i,this.hasZ=r,this.hasM=s,this._pathIndex=this._pointIndex=-1,this.yFactor=n,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(e){return this._pathIndex=e,this._pointIndex=-1,e>=0&&e<this.totalSize&&(this._currentPath=this._paths[e],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(e){return e>=0&&e<this._currentPath.length&&(this._pointIndex=e,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const e=this._currentPath.length,i=this._currentPath;let r=0;for(let s=1;s<e;s++){const n=i[s-1],o=i[s],a=n[0],l=n[1],c=o[0]-a,u=o[1]-l;r+=Math.sqrt(c*c+u*u)}return r}startPath(){this._paths.push([])}pushPath(e){this._paths.push(e)}pushPoint(e){this._paths[this.totalSize-1].push(e)}pushXY(e,i){this._paths[this.totalSize-1].push([e,i])}pushPoints(e){this._paths[this.totalSize-1].push(...e)}pushCursor(e){const i=Y3(e);for(const r of i)this.pushPath(r)}asOptimized(){const e=new Eu;if(this.geometryType==="esriGeometryPoint")e.coords.push(...this._paths[0][0]),e.lengths.length=0;else for(const i of this._paths){for(const r of i)e.coords.push(r[0]),e.coords.push(r[1]*this.yFactor),this.hasZ&&e.coords.push(r[2]),this.hasM&&e.coords.push(r[this._mIndex]);e.lengths.push(i.length)}return e}isClosed(){const e=this._currentPath[0],i=this._currentPath[this._currentPath.length-1];for(let r=0;r<e.length;r++)if(e[r]!==i[r])return!1;return!0}clone(){return new jIe().initialize(Q(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(e=>e.length).reduce((e,i)=>e+i)}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(e){this._currentPoint[0]=e}get y(){return this.yFactor*this._currentPoint[1]}set y(e){this._currentPoint[1]=this.yFactor*e}get z(){return this._currentPoint[2]}set z(e){this._currentPoint[2]=e}get m(){return this._currentPoint[this._mIndex]}set m(e){this._currentPoint[this._mIndex]=e}get pathIndex(){return this._pathIndex}};const eF=4,tF=1;let Xpe=class HIe extends OX{initialize(e,i,r,s,n){return super.initialize(e,i,r,s,n),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map(o=>new Set)),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const e=new HIe().initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return e._controlPoints=this._controlPoints,e}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(e){this._controlPoints[this.pathIndex].add(e)}getControlPointAt(e){return this._controlPoints[this.pathIndex].has(e)}},Jpe=class qIe extends RX{initialize(e,i,r,s,n){return super.initialize(e,i,r,s,n)}clone(){return new qIe().initialize(Q(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][eF]=tF}getControlPoint(){return this._paths[this.pathIndex][this._pointIndex][eF]===tF}setControlPointAt(e){this._paths[this.pathIndex][e][eF]=tF}getControlPointAt(e){return this._paths[this.pathIndex][e][eF]===tF}};const r0t=512;var Kc,ma;(function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon"})(Kc||(Kc={}));let Ba=class j5{constructor(e,i){this.x=e,this.y=i}clone(){return new j5(this.x,this.y)}equals(e,i){return e===this.x&&i===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,i){return this.x=e,this.y=i,this}normalize(){const e=this.x,i=this.y,r=Math.sqrt(e*e+i*i);return this.x/=r,this.y/=r,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,i){return this.x+=e,this.y+=i,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}assignSub(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}rotate(e,i){const r=this.x,s=this.y;return this.x=r*e-s*i,this.y=r*i+s*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,i=this.y;return Math.sqrt(e*e+i*i)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,i){const r=i.x-e.x,s=i.y-e.y;return Math.sqrt(r*r+s*s)}static add(e,i){return new j5(e.x+i.x,e.y+i.y)}static sub(e,i){return new j5(e.x-i.x,e.y-i.y)}},iF=class{constructor(e,i,r){this.ratio=e,this.x=i,this.y=r}},s0t=class{constructor(e,i,r,s=8,n=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=s,this._pixelMargin=n,this._tileSize=r0t*s,this._dz=e,this._yPos=i,this._xPos=r}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let i=this._pixelRatio*this._pixelMargin;i/=this._finalRatio;const r=e>>this._dz;i>r&&(i=r),this._margin=i,this._xmin=r*this._xPos-i,this._ymin=r*this._yPos-i,this._xmax=this._xmin+r+2*i,this._ymax=this._ymin+r+2*i}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,i){this._pushLine(),this._prevIsIn=this._isIn(e,i),this._moveTo(e,i,this._prevIsIn),this._prevPt=new Ba(e,i),this._firstPt=new Ba(e,i),this._dist=0}lineTo(e,i){const r=this._isIn(e,i),s=new Ba(e,i),n=Ba.distance(this._prevPt,s);let o,a,l,c,u,d,p,m;if(r)this._prevIsIn?this._lineTo(e,i,!0):(o=this._prevPt,a=s,l=this._intersect(a,o),this._start=this._dist+n*(1-this._r),this._lineTo(l.x,l.y,!0),this._lineTo(a.x,a.y,!0));else if(this._prevIsIn)a=this._prevPt,o=s,l=this._intersect(a,o),this._lineTo(l.x,l.y,!0),this._lineTo(o.x,o.y,!1);else{const g=this._prevPt,y=s;if(g.x<=this._xmin&&y.x<=this._xmin||g.x>=this._xmax&&y.x>=this._xmax||g.y<=this._ymin&&y.y<=this._ymin||g.y>=this._ymax&&y.y>=this._ymax)this._lineTo(y.x,y.y,!1);else{const v=[];if((g.x<this._xmin&&y.x>this._xmin||g.x>this._xmin&&y.x<this._xmin)&&(c=(this._xmin-g.x)/(y.x-g.x),m=g.y+c*(y.y-g.y),m<=this._ymin?d=!1:m>=this._ymax?d=!0:v.push(new iF(c,this._xmin,m))),(g.x<this._xmax&&y.x>this._xmax||g.x>this._xmax&&y.x<this._xmax)&&(c=(this._xmax-g.x)/(y.x-g.x),m=g.y+c*(y.y-g.y),m<=this._ymin?d=!1:m>=this._ymax?d=!0:v.push(new iF(c,this._xmax,m))),(g.y<this._ymin&&y.y>this._ymin||g.y>this._ymin&&y.y<this._ymin)&&(c=(this._ymin-g.y)/(y.y-g.y),p=g.x+c*(y.x-g.x),p<=this._xmin?u=!1:p>=this._xmax?u=!0:v.push(new iF(c,p,this._ymin))),(g.y<this._ymax&&y.y>this._ymax||g.y>this._ymax&&y.y<this._ymax)&&(c=(this._ymax-g.y)/(y.y-g.y),p=g.x+c*(y.x-g.x),p<=this._xmin?u=!1:p>=this._xmax?u=!0:v.push(new iF(c,p,this._ymax))),v.length===0)u?d?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):d?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(v.length>1&&v[0].ratio>v[1].ratio)this._start=this._dist+n*v[1].ratio,this._lineTo(v[1].x,v[1].y,!0),this._lineTo(v[0].x,v[0].y,!0);else{this._start=this._dist+n*v[0].ratio;for(let b=0;b<v.length;b++)this._lineTo(v[b].x,v[b].y,!0)}this._lineTo(y.x,y.y,!1)}}this._dist+=n,this._prevIsIn=r,this._prevPt=s}close(){if(this._line.length>2){const e=this._firstPt,i=this._prevPt;e.x===i.x&&e.y===i.y||this.lineTo(e.x,e.y);const r=this._line;let s=r.length;for(;s>=4&&(r[0].x===r[1].x&&r[0].x===r[s-2].x||r[0].y===r[1].y&&r[0].y===r[s-2].y);)r.pop(),r[0].x=r[s-2].x,r[0].y=r[s-2].y,--s}}result(e=!0){return this._pushLine(),this._lines.length===0?null:(this._type===Kc.Polygon&&e&&n0t.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==Kc.LineString)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,i=e.length;if(i===0)return null;const r=[];for(let s=0;s<i;s++)r.push({line:e[s],start:this._starts[s]||0});return r}_isIn(e,i){return e>=this._xmin&&e<=this._xmax&&i>=this._ymin&&i<=this._ymax}_intersect(e,i){let r,s,n;if(i.x>=this._xmin&&i.x<=this._xmax)s=i.y<=this._ymin?this._ymin:this._ymax,n=(s-e.y)/(i.y-e.y),r=e.x+n*(i.x-e.x);else if(i.y>=this._ymin&&i.y<=this._ymax)r=i.x<=this._xmin?this._xmin:this._xmax,n=(r-e.x)/(i.x-e.x),s=e.y+n*(i.y-e.y);else{s=i.y<=this._ymin?this._ymin:this._ymax,r=i.x<=this._xmin?this._xmin:this._xmax;const o=(r-e.x)/(i.x-e.x),a=(s-e.y)/(i.y-e.y);o<a?(n=o,s=e.y+o*(i.y-e.y)):(n=a,r=e.x+a*(i.x-e.x))}return this._r=n,new Ba(r,s)}_pushLine(){this._line&&(this._type===Kc.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===Kc.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===Kc.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,i,r){this._type!==Kc.Polygon?r&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new Ba(e,i))):(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new Ba(e,i)),this._isH=!1,this._isV=!1)}_lineTo(e,i,r){let s,n;if(this._type!==Kc.Polygon)if(r){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(s=this._line[this._line.length-1],s.equals(e,i)))return;this._line.push(new Ba(e,i))}else this._line&&this._line.length>0&&this._pushLine();else if(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){s=this._line[this._line.length-1];const o=s.x===e,a=s.y===i;if(o&&a)return;this._isH&&o||this._isV&&a?(s.x=e,s.y=i,n=this._line[this._line.length-2],n.x===e&&n.y===i?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(n=this._line[this._line.length-2],this._isH=n.x===e,this._isV=n.y===i)):(this._isH=n.x===e,this._isV=n.y===i)):(this._line.push(new Ba(e,i)),this._isH=o,this._isV=a)}else this._line.push(new Ba(e,i))}},MYt=class{setExtent(e){this._ratio=e===4096?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,i){this._line&&this._lines.push(this._line),this._line=[];const r=this._ratio;this._line.push(new Ba(e*r,i*r))}lineTo(e,i){const r=this._ratio;this._line.push(new Ba(e*r,i*r))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),this._lines.length===0?null:this._lines}};(function(t){t[t.sideLeft=0]="sideLeft",t[t.sideRight=1]="sideRight",t[t.sideTop=2]="sideTop",t[t.sideBottom=3]="sideBottom"})(ma||(ma={}));let n0t=class av{static simplify(e,i,r){if(!r)return;const s=-i,n=e+i,o=-i,a=e+i,l=[],c=[],u=r.length;for(let p=0;p<u;++p){const m=r[p];if(!m||m.length<2)continue;let g,y=m[0];const v=m.length;for(let b=1;b<v;++b)g=m[b],y.x===g.x&&(y.x<=s&&(y.y>g.y?(l.push(p),l.push(b),l.push(ma.sideLeft),l.push(-1)):(c.push(p),c.push(b),c.push(ma.sideLeft),c.push(-1))),y.x>=n&&(y.y<g.y?(l.push(p),l.push(b),l.push(ma.sideRight),l.push(-1)):(c.push(p),c.push(b),c.push(ma.sideRight),c.push(-1)))),y.y===g.y&&(y.y<=o&&(y.x<g.x?(l.push(p),l.push(b),l.push(ma.sideTop),l.push(-1)):(c.push(p),c.push(b),c.push(ma.sideTop),c.push(-1))),y.y>=a&&(y.x>g.x?(l.push(p),l.push(b),l.push(ma.sideBottom),l.push(-1)):(c.push(p),c.push(b),c.push(ma.sideBottom),c.push(-1)))),y=g}if(l.length===0||c.length===0)return;av.fillParent(r,c,l),av.fillParent(r,l,c);const d=[];av.calcDeltas(d,c,l),av.calcDeltas(d,l,c),av.addDeltas(d,r)}static fillParent(e,i,r){const s=r.length,n=i.length;for(let o=0;o<n;o+=4){const a=i[o],l=i[o+1],c=i[o+2],u=e[a][l-1],d=e[a][l];let p=8092,m=-1;for(let g=0;g<s;g+=4){if(r[g+2]!==c)continue;const y=r[g],v=r[g+1],b=e[y][v-1],w=e[y][v];switch(c){case ma.sideLeft:case ma.sideRight:if(rF(u.y,b.y,w.y)&&rF(d.y,b.y,w.y)){const x=Math.abs(w.y-b.y);x<p&&(p=x,m=g)}break;case ma.sideTop:case ma.sideBottom:if(rF(u.x,b.x,w.x)&&rF(d.x,b.x,w.x)){const x=Math.abs(w.x-b.x);x<p&&(p=x,m=g)}}}i[o+3]=m}}static calcDeltas(e,i,r){const s=i.length;for(let n=0;n<s;n+=4){const o=[],a=av.calcDelta(n,i,r,o);e.push(i[n]),e.push(i[n+1]),e.push(i[n+2]),e.push(a)}}static calcDelta(e,i,r,s){const n=i[e+3];if(n===-1)return 0;const o=s.length;return o>1&&s[o-2]===n?0:(s.push(n),av.calcDelta(n,r,i,s)+1)}static addDeltas(e,i){const r=e.length;let s=0;for(let n=0;n<r;n+=4){const o=e[n+3];o>s&&(s=o)}for(let n=0;n<r;n+=4){const o=i[e[n]],a=e[n+1],l=s-e[n+3];switch(e[n+2]){case ma.sideLeft:o[a-1].x-=l,o[a].x-=l,a===1&&(o[o.length-1].x-=l),a===o.length-1&&(o[0].x-=l);break;case ma.sideRight:o[a-1].x+=l,o[a].x+=l,a===1&&(o[o.length-1].x+=l),a===o.length-1&&(o[0].x+=l);break;case ma.sideTop:o[a-1].y-=l,o[a].y-=l,a===1&&(o[o.length-1].y-=l),a===o.length-1&&(o[0].y-=l);break;case ma.sideBottom:o[a-1].y+=l,o[a].y+=l,a===1&&(o[o.length-1].y+=l),a===o.length-1&&(o[0].y+=l)}}}};const rF=(t,e,i)=>t>=e&&t<=i||t>=i&&t<=e,o0t=512;let iy,a0t=class{constructor(e){this._geometry=e}next(){const e=this._geometry;return this._geometry=null,e}};function lj(t,e){iy||(iy=new s0t(0,0,0,1));const i=t.geometryType==="esriGeometryPolygon",r=i?Kc.Polygon:Kc.LineString,s=i?3:2;let n,o;for(iy.reset(r),iy.setPixelMargin(e+1),iy.setExtent(o0t);t.nextPath();)if(!(t.pathSize<s)){for(t.nextPoint(),n=t.x,o=-t.y,iy.moveTo(n,o);t.nextPoint();)n=t.x,o=-t.y,iy.lineTo(n,o);i&&iy.close()}const a=iy.result(!1);if(a){const l=Xn.createEmptyOptimizedCIM(t.geometryType);for(const c of a){l.startPath();for(const u of c)l.pushXY(u.x,-u.y)}return l.reset(),l}return null}let l0t=class{applyColorSubstituition(e,i){if(!i)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:r,height:s}=e,n=this._rasterizationCanvas,o=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=r,n.height=s,o.drawImage(e,0,0,r,s));const a=o.getImageData(0,0,r,s).data;if(i){for(const c of i)if(c&&c.oldColor&&c.oldColor.length===4&&c.newColor&&c.newColor.length===4){const[u,d,p,m]=c.oldColor,[g,y,v,b]=c.newColor;if(u===g&&d===y&&p===v&&m===b)continue;for(let w=0;w<a.length;w+=4)u===a[w]&&d===a[w+1]&&p===a[w+2]&&m===a[w+3]&&(a[w]=g,a[w+1]=y,a[w+2]=v,a[w+3]=b)}}const l=new ImageData(a,r,s);return o.putImageData(l,0,0),n}tintImageData(e,i){if(!i||i.length<4)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:r,height:s}=e,n=this._rasterizationCanvas,o=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=r,n.height=s,o.drawImage(e,0,0,r,s));const a=o.getImageData(0,0,r,s),l=new Uint8Array(a.data),c=[i[0]/255,i[1]/255,i[2]/255,i[3]/255];for(let d=0;d<l.length;d+=4)l[d]*=c[0],l[d+1]*=c[1],l[d+2]*=c[2],l[d+3]*=c[3];const u=new ImageData(new Uint8ClampedArray(l.buffer),r,s);return o.putImageData(u,0,0),n}},WIe=class MR{static local(){return MR.instance===null&&(MR.instance=new MR),MR.instance}execute(e,i,r,s,n){return new c0t(e,i,r)}};WIe.instance=null;let c0t=class{constructor(e,i,r){this._inputGeometries=e,this._angleTolerance=i.angleTolerance!==void 0?i.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();for(;e;){if(e.geometryType==="esriGeometryPolygon")this._isClosed=!0;else if(e.geometryType==="esriGeometryPolyline")this._isClosed=!1;else{if(e.geometryType!=="esriGeometryEnvelope"){e=this._inputGeometries.next();continue}if(this._maxCosAngle)return e;this._isClosed=!0}for(;e.nextPath();)this._processPath(e);return e.reset(),e}return null}_processPath(e){if(e.nextPoint()){const i=e.x,r=e.y;let s=i,n=r,o=e.pathSize,a=0,l=0,c=0,u=0,d=0,p=0;this._isClosed&&++o;for(let m=1;e.nextPoint()||m<o;++m){let g,y;this._isClosed&&m===o-1?(g=i,y=r):(g=e.x,y=e.y);const v=g-s,b=y-n,w=Math.sqrt(v*v+b*b);m>1&&w>0&&c>0&&(a*v+l*b)/w/c<=this._maxCosAngle&&e.setControlPointAt(m-1),m===1&&(u=v,d=b,p=w),w>0&&(s=g,n=y,a=v,l=b,c=w)}this._isClosed&&c>0&&p>0&&(a*u+l*d)/p/c<=this._maxCosAngle&&e.setControlPointAt(0)}}};function wH(t,e){t[4]=e}let VL=class{constructor(e,i=!0,r=!0,s=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!i&&e.geometryType==="esriGeometryPolygon"||!r&&e.geometryType==="esriGeometryPolyline"?null:e,this.geomUnitsPerPoint=s,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new iP}next(){if(!this.geometryCursor)return null;const e=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&e||(this.geometryCursor=null),e}processMultiPath(e){for(;this.iteratePath||e.pathIndex<e.totalSize-1;){this.iteratePath||e.nextPath(),this.iterateMultiPath=!0;const i=this.processPath(e);if(i)return i}return this.iterateMultiPath=!1,null}},cj=class{constructor(e,i,r,s=0){this.isClosed=!1,this._tileKey=null,this.inputGeometries=e,this.acceptPolygon=i,this.acceptPolyline=r,this.geomUnitsPerPoint=s,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let e=this.inputGeometries.next();for(;e&&(this.isClosed=this.acceptPolygon&&e.geometryType==="esriGeometryPolygon"||e.geometryType==="esriGeometryEnvelope",this.multiPathCursor=e,!this.multiPathCursor);)e=this.inputGeometries.next();if(!this.multiPathCursor)return null;this._tileKey&&this.isClippingRequired(this.multiPathCursor)&&(this.multiPathCursor.reset(),this.multiPathCursor=lj(this.multiPathCursor,256))}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const e=this.processPath(this.multiPathCursor);if(e)return e}this.multiPathCursor=null}}isClippingRequired(e){return!1}};var $X,IX,Qpe,Kpe,rg,efe,LX,DX,NX,tfe,ife,rfe,sfe,nfe,ofe,FX,kX,afe,lfe,aM,ji,$x,cfe,ufe,o0,hfe,dfe,mC,UX,pfe,ffe,mfe,gfe,yfe,_fe,Id,Ua,vfe,bfe,sg,wfe,xfe,Sfe,Tfe,kp,lI,Ix,gC,Efe,Cfe,Mfe,Afe,Pfe,Ofe,Rfe,hV,yC,$fe,zX,Ife,Lfe;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})($X||($X={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(IX||(IX={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(Qpe||(Qpe={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(Kpe||(Kpe={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(rg||(rg={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(efe||(efe={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(LX||(LX={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(DX||(DX={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(NX||(NX={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(tfe||(tfe={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(ife||(ife={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(rfe||(rfe={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(sfe||(sfe={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(nfe||(nfe={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(ofe||(ofe={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(FX||(FX={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(kX||(kX={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(afe||(afe={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(lfe||(lfe={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(aM||(aM={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees",t.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks"}(ji||(ji={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}($x||($x={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(cfe||(cfe={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(ufe||(ufe={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(o0||(o0={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(hfe||(hfe={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(dfe||(dfe={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(mC||(mC={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(UX||(UX={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(pfe||(pfe={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(ffe||(ffe={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(mfe||(mfe={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(gfe||(gfe={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(yfe||(yfe={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(_fe||(_fe={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(Id||(Id={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(Ua||(Ua={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(vfe||(vfe={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(bfe||(bfe={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(sg||(sg={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(wfe||(wfe={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(xfe||(xfe={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(Sfe||(Sfe={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(Tfe||(Tfe={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(kp||(kp={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(lI||(lI={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(Ix||(Ix={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(gC||(gC={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(Efe||(Efe={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(Cfe||(Cfe={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(Mfe||(Mfe={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(Afe||(Afe={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(Pfe||(Pfe={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(Ofe||(Ofe={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(Rfe||(Rfe={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(hV||(hV={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(yC||(yC={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}($fe||($fe={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(zX||(zX={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(Ife||(Ife={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(Lfe||(Lfe={}));const v3=.03;let J0=class{constructor(e=0,i=!1){}isEmpty(e){if(!e.nextPoint())return!0;let i,r,s,n;for(i=e.x,r=e.y;e.nextPoint();i=r,r=n)if(s=e.x,n=e.y,s!==i||n!==r)return e.seekPathStart(),!1;return e.seekPathStart(),!0}normalize(e){const i=Math.sqrt(e[0]*e[0]+e[1]*e[1]);i!==0&&(e[0]/=i,e[1]/=i)}getLength(e,i,r,s){const n=r-e,o=s-i;return Math.sqrt(n*n+o*o)}getSegLength(e){const[[i,r],[s,n]]=e;return this.getLength(i,r,s,n)}getCoord2D(e,i,r,s,n){return[e+(r-e)*n,i+(s-i)*n]}getSegCoord2D(e,i){const[[r,s],[n,o]]=e;return this.getCoord2D(r,s,n,o,i)}getAngle(e,i,r,s,n){const o=r-e,a=s-i;return Math.atan2(a,o)}getAngleCS(e,i,r,s,n){const o=r-e,a=s-i,l=Math.sqrt(o*o+a*a);return l>0?[o/l,a/l]:[1,0]}getSegAngleCS(e,i){const[[r,s],[n,o]]=e;return this.getAngleCS(r,s,n,o,i)}cut(e,i,r,s,n,o){return[n<=0?[e,i]:this.getCoord2D(e,i,r,s,n),o>=1?[r,s]:this.getCoord2D(e,i,r,s,o)]}getSubCurve(e,i,r){const s=Xn.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(s,e,i,r)?s:null}appendSubCurve(e,i,r,s){e.startPath(),i.seekPathStart();let n=0,o=!0;if(!i.nextPoint())return!1;let a=i.x,l=i.y;for(;i.nextPoint();){const c=this.getLength(a,l,i.x,i.y);if(c!==0){if(o){if(n+c>r){const u=(r-n)/c;let d=1,p=!1;n+c>=s&&(d=(s-n)/c,p=!0);const m=this.cut(a,l,i.x,i.y,u,d);if(m&&e.pushPoints(m),p)break;o=!1}}else{if(n+c>s){const u=this.cut(a,l,i.x,i.y,0,(s-n)/c);u&&e.pushPoint(u[1]);break}e.pushXY(i.x,i.y)}n+=c,a=i.x,l=i.y}else a=i.x,l=i.y}return!0}getCIMPointAlong(e,i){if(!e.nextPoint())return null;let r,s,n,o,a=0;for(r=e.x,s=e.y;e.nextPoint();r=n,s=o){n=e.x,o=e.y;const l=this.getLength(r,s,n,o);if(l!==0){if(a+l>i){const c=(i-a)/l;return this.getCoord2D(r,s,n,o,c)}a+=l}}return null}offset(e,i,r,s,n){if(!e||e.length<2)return null;let o=0,a=e[o++],l=o;for(;o<e.length;){const p=e[o];p[0]===a[0]&&p[1]===a[1]||(o!==l&&(e[l]=e[o]),a=e[l++]),o++}const c=e[0][0]===e[l-1][0]&&e[0][1]===e[l-1][1];if(c&&--l,l<(c?3:2))return null;const u=[];a=c?e[l-1]:null;let d=e[0];for(let p=0;p<l;p++){const m=p===l-1?c?e[0]:null:e[p+1];if(a)if(m){const g=[m[0]-d[0],m[1]-d[1]];this.normalize(g);const y=[d[0]-a[0],d[1]-a[1]];this.normalize(y);const v=y[0]*g[1]-y[1]*g[0],b=y[0]*g[0]+y[1]*g[1];if(v===0&&b===1){d=m;continue}if(v>=0==i<=0){if(b<1){const w=[g[0]-y[0],g[1]-y[1]];this.normalize(w);const x=Math.sqrt((1+b)/2);if(x>1/s){const T=-Math.abs(i)/x;u.push([d[0]-w[0]*T,d[1]-w[1]*T])}}}else switch(r){case o0.Mitered:{const w=Math.sqrt((1+b)/2);if(w>0&&1/w<s){const x=[g[0]-y[0],g[1]-y[1]];this.normalize(x);const T=Math.abs(i)/w;u.push([d[0]-x[0]*T,d[1]-x[1]*T]);break}}case o0.Bevelled:u.push([d[0]+y[1]*i,d[1]-y[0]*i]),u.push([d[0]+g[1]*i,d[1]-g[0]*i]);break;case o0.Rounded:if(b<1){u.push([d[0]+y[1]*i,d[1]-y[0]*i]);const w=Math.floor(2.5*(1-b));if(w>0){const x=1/w;let T=x;for(let C=1;C<w;C++,T+=x){const M=[y[1]*(1-T)+g[1]*T,-y[0]*(1-T)-g[0]*T];this.normalize(M),u.push([d[0]+M[0]*i,d[1]+M[1]*i])}}u.push([d[0]+g[1]*i,d[1]-g[0]*i])}break;case o0.Square:default:if(v<0)u.push([d[0]+(y[1]+y[0])*i,d[1]+(y[1]-y[0])*i]),u.push([d[0]+(g[1]-g[0])*i,d[1]-(g[0]+g[1])*i]);else{const w=Math.sqrt((1+Math.abs(b))/2),x=[g[0]-y[0],g[1]-y[1]];this.normalize(x);const T=i/w;u.push([d[0]-x[0]*T,d[1]-x[1]*T])}}}else{const g=[d[0]-a[0],d[1]-a[1]];this.normalize(g),u.push([d[0]+g[1]*i,d[1]-g[0]*i])}else{const g=[m[0]-d[0],m[1]-d[1]];this.normalize(g),u.push([d[0]+g[1]*i,d[1]-g[0]*i])}a=d,d=m}return u.length<(c?3:2)?null:(c&&u.push([u[0][0],u[0][1]]),u)}};const xH=1.7320508075688772,u0t=5,h0t=aM.OpenEnded;let YIe=class AR{static local(){return AR.instance===null&&(AR.instance=new AR),AR.instance}execute(e,i,r,s,n){return new d0t(e,i,r)}};YIe.instance=null;let d0t=class extends cj{constructor(e,i,r){super(e,!1,!0),this._curveHelper=new J0,this._width=(i.width!==void 0?i.width:u0t)*r,this._arrowType=i.geometricEffectArrowType!==void 0?i.geometricEffectArrowType:i.arrowType!==void 0?i.arrowType:h0t,this._offsetFlattenError=v3*r}processPath(e){const i=Xn.createEmptyOptimizedCIM(e.geometryType);switch(this._arrowType){case aM.OpenEnded:default:this._constructSimpleArrow(i,e,!0);break;case aM.Block:this._constructSimpleArrow(i,e,!1);break;case aM.Crossed:this._constructCrossedArrow(i,e)}return i}_constructSimpleArrow(e,i,r){const s=i.pathLength();let n=this._width;s<2*n&&(n=s/2);const o=this._curveHelper.getSubCurve(i,0,s-n);if(!o||!o.nextPath())return;o.seekPathStart();const a=n/2;if(this._curveHelper.isEmpty(o))return;const l=i1(o),c=this._constructOffset(l,-a);if(!c)return;const u=this._constructOffset(l,a);if(!u)return;const d=this._constructArrowBasePoint(c,-a/2);if(!d)return;const p=this._constructArrowBasePoint(u,a/2);if(!p)return;i.seekInPath(i.pathSize-1);const m=[i.x,i.y];e.pushPath(u),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(p),e.nextPoint(),e.setControlPoint(),e.pushPoint(m),e.nextPoint(),e.setControlPoint(),e.pushPoint(d),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.setControlPoint(),r||(e.setControlPointAt(0),e.setControlPointAt(e.pathSize-1),e.pushPoint(u[0])),e.reset()}_constructCrossedArrow(e,i){const r=i.pathLength();let s=this._width;r<s*(1+xH+1)&&(s=r/(1+xH+1)),i.seekPathStart();const n=this._curveHelper.getSubCurve(i,0,r-s*(1+xH));if(!n)return;n.nextPath();const o=s/2;if(this._curveHelper.isEmpty(n))return;const a=i1(n),l=this._constructOffset(a,o);if(!l)return;const c=this._constructOffset(a,-o);if(!c)return;const u=this._curveHelper.getSubCurve(i,0,r-s);if(!u||(u.nextPath(),this._curveHelper.isEmpty(u)))return;const d=i1(u),p=this._constructOffset(d,o);if(!p)return;const m=this._constructOffset(d,-o);if(!m)return;const g=p[p.length-1],y=this._constructArrowBasePoint(p,o/2);if(!y)return;const v=m[m.length-1],b=this._constructArrowBasePoint(m,-o/2);if(!b)return;i.seekInPath(i.pathSize-1);const w=[i.x,i.y];e.pushPath(l),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(v),e.nextPoint(),e.setControlPoint(),e.pushPoint(b),e.nextPoint(),e.setControlPoint(),e.pushPoint(w),e.nextPoint(),e.setControlPoint(),e.pushPoint(y),e.nextPoint(),e.setControlPoint(),e.pushPoint(g),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.nextPoint(),e.setControlPoint(),e.reset()}_constructOffset(e,i){return this._curveHelper.offset(e,i,o0.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(e,i){if(!e||e.length<2)return null;const r=e[e.length-2],s=e[e.length-1],n=[s[0]-r[0],s[1]-r[1]];return this._curveHelper.normalize(n),[s[0]+n[1]*i,s[1]-n[0]*i]}},ZIe=class PR{static local(){return PR.instance===null&&(PR.instance=new PR),PR.instance}execute(e,i,r,s,n,o){return new p0t(e,i,r,s,n,o)}};ZIe.instance=null;let p0t=class{constructor(e,i,r,s,n,o){this._inputGeometries=e,this._tileKey=s,this._geometryEngine=n,this._curveHelper=new J0,this._size=(i.size!==void 0?i.size:1)*r,this._maxInflateSize=o*r,this._offsetFlattenError=v3*r}next(){let e;for(;e=this._inputGeometries.next();){if(this._size===0)return e;if(e.geometryType==="esriGeometryEnvelope"){if(this._size>0){const n=Xn.createEmptyOptimizedCIM(e.geometryType),o=Y3(e)[0],a=this._curveHelper.offset(o,this._size,o0.Rounded,4,this._offsetFlattenError);if(a)return n.pushPath(a),n}else if(this._size<0){const n=e.asJSON();if(Math.min(n.xmax-n.xmin,n.ymax-n.ymin)+2*this._size>0)return Xn.fromJSONCIM({xmin:n.xmin-this._size,xmax:n.xmax+this._size,ymin:n.ymin-this._size,ymax:n.ymax+this._size})}}const i=this._geometryEngine;if(i==null)return null;const r=this._tileKey?lj(e,this._maxInflateSize):e;if(!r)continue;const s=i.buffer(We.WebMercator,r.asJSON(),this._size,1);return s?Xn.fromJSONCIM(s):null}return null}},XIe=class OR{static local(){return OR.instance===null&&(OR.instance=new OR),OR.instance}execute(e,i,r,s,n){return new f0t(e,i,r)}};XIe.instance=null;let f0t=class{constructor(e,i,r){this._defaultPointSize=20,this._inputGeometries=e,this._geomUnitsPerPoint=r,this._rule=i.rule??ji.FullGeometry,this._defaultSize=this._defaultPointSize*r}next(){let e;for(;e=this._inputGeometries.next();){const i=this._processGeom(Y3(e));if(i!=null&&i.length)return Xn.fromJSONCIM({paths:i})}return null}_clone(e){return[e[0],e[1]]}_mid(e,i){return[(e[0]+i[0])/2,(e[1]+i[1])/2]}_mix(e,i,r,s){return[e[0]*i+r[0]*s,e[1]*i+r[1]*s]}_add(e,i){return[e[0]+i[0],e[1]+i[1]]}_add2(e,i,r){return[e[0]+i,e[1]+r]}_sub(e,i){return[e[0]-i[0],e[1]-i[1]]}_dist(e,i){return Math.sqrt((e[0]-i[0])*(e[0]-i[0])+(e[1]-i[1])*(e[1]-i[1]))}_norm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}_normalize(e,i=1){const r=i/this._norm(e);e[0]*=r,e[1]*=r}_leftPerpendicular(e){const i=-e[1],r=e[0];e[0]=i,e[1]=r}_leftPerp(e){return[-e[1],e[0]]}_rightPerpendicular(e){const i=e[1],r=-e[0];e[0]=i,e[1]=r}_rightPerp(e){return[e[1],-e[0]]}_dotProduct(e,i){return e[0]*i[0]+e[1]*i[1]}_crossProduct(e,i){return e[0]*i[1]-e[1]*i[0]}_rotateDirect(e,i,r){const s=e[0]*i-e[1]*r,n=e[0]*r+e[1]*i;e[0]=s,e[1]=n}_makeCtrlPt(e){const i=[e[0],e[1]];return wH(i,1),i}_addAngledTicks(e,i,r,s){const n=this._sub(r,i);this._normalize(n);const o=this._crossProduct(n,this._sub(s,i));let a;a=o>0?this._rightPerp(n):this._leftPerp(n);const l=Math.abs(o)/2,c=[];c.push([i[0]+(a[0]-n[0])*l,i[1]+(a[1]-n[1])*l]),c.push(i),c.push(r),c.push([r[0]+(a[0]+n[0])*l,r[1]+(a[1]+n[1])*l]),e.push(c)}_addBezier2(e,i,r,s,n){if(n--==0)return void e.push(s);const o=this._mid(i,r),a=this._mid(r,s),l=this._mid(o,a);this._addBezier2(e,i,o,l,n),this._addBezier2(e,l,a,s,n)}_addBezier3(e,i,r,s,n,o){if(o--==0)return void e.push(n);const a=this._mid(i,r),l=this._mid(r,s),c=this._mid(s,n),u=this._mid(a,l),d=this._mid(l,c),p=this._mid(u,d);this._addBezier3(e,i,a,u,p,o),this._addBezier3(e,p,d,c,n,o)}_add90DegArc(e,i,r,s,n){const o=n??this._crossProduct(this._sub(r,i),this._sub(s,i))>0,a=this._mid(i,r),l=this._sub(a,i);o?this._leftPerpendicular(l):this._rightPerpendicular(l),a[0]+=l[0],a[1]+=l[1],this._addBezier3(e,i,this._mix(i,.33333,a,.66667),this._mix(r,.33333,a,.66667),r,4)}_addArrow(e,i,r){const s=i[0],n=i[1],o=i[i.length-1],a=this._sub(s,n),l=this._norm(a);this._normalize(a);const c=Math.abs(this._crossProduct(a,this._sub(o,n)));let u=this._dotProduct(a,this._sub(o,n));u<.05*l?u=.05*l:u>.95*l&&(u=.95*l);const d=.5*c,p=this._leftPerp(a),m=[n[0]+a[0]*u,n[1]+a[1]*u],g=i.length-1,y=[];y.push(r?[-p[0],-p[1]]:p);let v=[-a[0],-a[1]];for(let b=1;b<g-1;b++){const w=this._sub(i[b+1],i[b]);this._normalize(w);const x=this._dotProduct(w,v),T=this._crossProduct(w,v),C=Math.sqrt((1+x)/2),M=this._sub(w,v);this._normalize(M),M[0]/=C,M[1]/=C,y.push(T<0?[-M[0],-M[1]]:M),v=w}y.push(this._rightPerp(v));for(let b=y.length-1;b>0;b--)e.push([i[b][0]+y[b][0]*d,i[b][1]+y[b][1]*d]);e.push([m[0]+y[0][0]*d,m[1]+y[0][1]*d]),e.push([m[0]+y[0][0]*c,m[1]+y[0][1]*c]),e.push(s),e.push([m[0]-y[0][0]*c,m[1]-y[0][1]*c]),e.push([m[0]-y[0][0]*d,m[1]-y[0][1]*d]);for(let b=1;b<y.length;b++)e.push([i[b][0]-y[b][0]*d,i[b][1]-y[b][1]*d])}_cp2(e,i,r){return e.length>=2?e[1]:this._add2(e[0],i*this._defaultSize,r*this._defaultSize)}_cp3(e,i,r,s){if(e.length>=3)return e[2];const n=this._mix(e[0],1-r,i,r),o=this._sub(i,e[0]);return this._normalize(o),this._rightPerpendicular(o),[n[0]+o[0]*s*this._defaultSize,n[1]+o[1]*s*this._defaultSize]}_arrowPath(e){if(e.length>2)return e;const i=e[0],r=this._cp2(e,-4,0),s=this._sub(i,r);this._normalize(s);const n=this._rightPerp(s);return[i,r,[i[0]+(n[0]-s[0])*this._defaultSize,i[1]+(n[1]-s[1])*this._defaultSize]]}_arrowLastSeg(e){const i=e[0],r=this._cp2(e,-4,0);let s;if(e.length>=3)s=e[e.length-1];else{const n=this._sub(i,r);this._normalize(n);const o=this._rightPerp(n);s=[i[0]+(o[0]-n[0])*this._defaultSize,i[1]+(o[1]-n[1])*this._defaultSize]}return[r,s]}_processGeom(e){if(!e)return null;const i=[];for(const r of e){if(!r||r.length===0)continue;const s=r.length;let n=r[0];switch(this._rule){case ji.PerpendicularFromFirstSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,4),l=[];l.push(a),l.push(this._mid(n,o)),i.push(l);break}case ji.ReversedFirstSegment:{const o=this._cp2(r,0,-1);i.push([o,n]);break}case ji.PerpendicularToSecondSegment:{if(r.length<3)return[];const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=[];l.push(this._mid(o,a)),l.push(n),i.push(l);break}case ji.SecondSegmentWithTicks:{if(r.length<3)return[];const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=this._sub(a,o);let c;c=this._crossProduct(l,this._sub(n,o))>0?this._rightPerp(l):this._leftPerp(l);const u=[];u.push([o[0]+(c[0]-l[0])/3,o[1]+(c[1]-l[1])/3]),u.push(o),u.push(a),u.push([a[0]+(c[0]+l[0])/3,a[1]+(c[1]+l[1])/3]),i.push(u);break}case ji.DoublePerpendicular:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,3),l=this._mid(n,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(n,a));this._leftPerpendicular(c);const d=[];d.push(n),d.push([a[0]+c[0]*u,a[1]+c[1]*u]),i.push(d);const p=[];p.push([a[0]-c[0]*u,a[1]-c[1]*u]),p.push(o),i.push(p);break}case ji.OppositeToFirstSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,3),l=this._mid(n,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(n,a));this._leftPerpendicular(c);const d=[];d.push([a[0]+c[0]*u,a[1]+c[1]*u]),d.push([a[0]-c[0]*u,a[1]-c[1]*u]),i.push(d);break}case ji.TriplePerpendicular:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,4),l=this._mid(n,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(n,a));this._leftPerpendicular(c);const d=[];d.push([a[0]+c[0]*u*.8,a[1]+c[1]*u*.8]),d.push([l[0]+.8*(n[0]-l[0]),l[1]+.8*(n[1]-l[1])]),i.push(d),i.push([a,l]);const p=[];p.push([a[0]-c[0]*u*.8,a[1]-c[1]*u*.8]),p.push([l[0]+.8*(o[0]-l[0]),l[1]+.8*(o[1]-l[1])]),i.push(p);break}case ji.HalfCircleFirstSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,4),l=this._mid(n,o);let c=this._sub(o,n);const u=Math.cos(Math.PI/18),d=Math.sin(Math.PI/18),p=Math.sqrt((1+u)/2),m=Math.sqrt((1-u)/2),g=[];let y;this._crossProduct(c,this._sub(a,n))>0?(g.push(n),c=this._sub(n,l),y=o):(g.push(o),c=this._sub(o,l),y=n),this._rotateDirect(c,p,m),c[0]/=p,c[1]/=p;for(let v=1;v<=18;v++)g.push(this._add(l,c)),this._rotateDirect(c,u,d);g.push(y),i.push(g);break}case ji.HalfCircleSecondSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,1,-1);let l=this._sub(n,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,o))/2;this._leftPerpendicular(l);const u=[o[0]+l[0]*c,o[1]+l[1]*c];l=this._sub(o,u);const d=Math.cos(Math.PI/18);let p=Math.sin(Math.PI/18);c>0&&(p=-p);const m=[o];for(let g=1;g<=18;g++)this._rotateDirect(l,d,p),m.push(this._add(u,l));i.push(m);break}case ji.HalfCircleExtended:{const o=this._cp2(r,0,-2),a=this._cp3(r,o,1,-1);let l;if(s>=4)l=r[3];else{const g=this._sub(n,o);l=this._add(a,g)}const c=this._dist(o,a)/2/.75,u=this._sub(o,n);this._normalize(u,c);const d=this._sub(a,l);this._normalize(d,c);const p=[l,a];i.push(p);const m=[this._clone(a)];this._addBezier3(m,a,this._add(a,d),this._add(o,u),o,4),m.push(n),i.push(m);break}case ji.OpenCircle:{const o=this._cp2(r,-2,0),a=this._sub(o,n),l=Math.cos(Math.PI/18),c=-Math.sin(Math.PI/18),u=[o];for(let d=1;d<=33;d++)this._rotateDirect(a,l,c),u.push(this._add(n,a));i.push(u);break}case ji.CoverageEdgesWithTicks:{const o=this._cp2(r,0,-1);let a,l;if(s>=3)a=r[2];else{const p=this._sub(o,n),m=this._leftPerp(p);a=[n[0]+m[0]-.25*p[0],n[1]+m[1]-.25*p[1]]}if(s>=4)l=r[3];else{const p=this._mid(n,o),m=this._sub(n,o);this._normalize(m),this._leftPerpendicular(m);const g=this._crossProduct(m,this._sub(a,p));this._rightPerpendicular(m),l=[a[0]+m[0]*g*2,a[1]+m[1]*g*2]}const c=this._sub(o,n);let u,d;u=this._crossProduct(c,this._sub(a,n))>0?this._rightPerp(c):this._leftPerp(c),d=[],d.push(a),d.push(n),d.push([n[0]+(u[0]-c[0])/3,n[1]+(u[1]-c[1])/3]),i.push(d),u=this._crossProduct(c,this._sub(l,o))>0?this._rightPerp(c):this._leftPerp(c),d=[],d.push([o[0]+(u[0]+c[0])/3,o[1]+(u[1]+c[1])/3]),d.push(o),d.push(l),i.push(d);break}case ji.GapExtentWithDoubleTicks:{const o=this._cp2(r,0,2),a=this._cp3(r,o,0,1);let l;if(s>=4)l=r[3];else{const c=this._sub(o,n);l=this._add(a,c)}this._addAngledTicks(i,n,o,this._mid(a,l)),this._addAngledTicks(i,a,l,this._mid(n,o));break}case ji.GapExtentMidline:{const o=this._cp2(r,2,0),a=this._cp3(r,o,0,1);let l;if(s>=4)l=r[3];else{const u=this._sub(o,n);l=this._add(a,u)}const c=[];c.push(this._mid(n,a)),c.push(this._mid(o,l)),i.push(c);break}case ji.Chevron:{const o=this._cp2(r,-1,-1);let a;if(s>=3)a=r[2];else{const l=this._sub(o,n);this._leftPerpendicular(l),a=this._add(n,l)}i.push([o,this._makeCtrlPt(n),a]);break}case ji.PerpendicularWithArc:{const o=this._cp2(r,0,-2),a=this._cp3(r,o,.5,-1),l=this._sub(o,n),c=this._norm(l);l[0]/=c,l[1]/=c;const u=this._crossProduct(l,this._sub(a,n));let d=this._dotProduct(l,this._sub(a,n));d<.05*c?d=.05*c:d>.95*c&&(d=.95*c);const p=[n[0]+l[0]*d,n[1]+l[1]*d];let m=this._leftPerp(l),g=[];if(g.push([p[0]-m[0]*u,p[1]-m[1]*u]),g.push([p[0]+m[0]*u,p[1]+m[1]*u]),i.push(g),s>=4){const w=r[3];let x=this._dotProduct(l,this._sub(w,n));x<.1*c?x=.1*c:x>.9*c&&(x=.9*c);const T=[n[0]+l[0]*x,n[1]+l[1]*x],C=this._crossProduct(l,this._sub(w,n)),M=[];M.push([T[0]-m[0]*C,T[1]-m[1]*C]),M.push([T[0]+m[0]*C,T[1]+m[1]*C]),i.push(M)}const y=[o[0]+m[0]*u,o[1]+m[1]*u];m=this._sub(o,y);const v=Math.cos(Math.PI/18);let b=Math.sin(Math.PI/18);u<0&&(b=-b),g=[n,o];for(let w=1;w<=9;w++)this._rotateDirect(m,v,b),g.push(this._add(y,m));i.push(g);break}case ji.ClosedHalfCircle:{const o=this._cp2(r,2,0),a=this._mid(n,o),l=this._sub(o,a),c=Math.cos(Math.PI/18),u=Math.sin(Math.PI/18),d=[n,o];for(let p=1;p<=18;p++)this._rotateDirect(l,c,u),d.push(this._add(a,l));i.push(d);break}case ji.TripleParallelExtended:{const o=this._cp2(r,0,-2),a=this._cp3(r,o,1,-2),l=this._mid(n,o),c=this._sub(a,o);this._normalize(c);const u=Math.abs(this._crossProduct(c,this._sub(l,o)))/2,d=this._dist(o,a),p=[o,n];p.push([n[0]+c[0]*d*.5,n[1]+c[1]*d*.5]),i.push(p);const m=[];m.push([l[0]-c[0]*u,l[1]-c[1]*u]),m.push([l[0]+c[0]*d*.375,l[1]+c[1]*d*.375]),wH(m[m.length-1],1),m.push([l[0]+c[0]*d*.75,l[1]+c[1]*d*.75]),i.push(m);const g=[o,a];i.push(g);break}case ji.ParallelWithTicks:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(a,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l),this._addAngledTicks(i,n,o,a),this._addAngledTicks(i,this._mix(n,1,l,c),this._mix(o,1,l,c),this._mid(n,o));break}case ji.Parallel:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._leftPerp(l),u=this._crossProduct(l,this._sub(a,n));let d=[n,o];i.push(d),d=[],d.push([n[0]+c[0]*u,n[1]+c[1]*u]),d.push([o[0]+c[0]*u,o[1]+c[1]*u]),i.push(d);break}case ji.PerpendicularToFirstSegment:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._mid(n,o),c=this._sub(o,n);this._normalize(c);const u=this._crossProduct(c,this._sub(a,n));this._leftPerpendicular(c);const d=[];d.push([l[0]-c[0]*u*.25,l[1]-c[1]*u*.25]),d.push([l[0]+c[0]*u*1.25,l[1]+c[1]*u*1.25]),i.push(d);break}case ji.ParallelOffset:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l);const u=[];u.push([n[0]-l[0]*c,n[1]-l[1]*c]),u.push([o[0]-l[0]*c,o[1]-l[1]*c]),i.push(u);const d=[];d.push([n[0]+l[0]*c,n[1]+l[1]*c]),d.push([o[0]+l[0]*c,o[1]+l[1]*c]),i.push(d);break}case ji.OffsetOpposite:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l);const u=[];u.push([n[0]-l[0]*c,n[1]-l[1]*c]),u.push([o[0]-l[0]*c,o[1]-l[1]*c]),i.push(u);break}case ji.OffsetSame:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l);const u=[];u.push([n[0]+l[0]*c,n[1]+l[1]*c]),u.push([o[0]+l[0]*c,o[1]+l[1]*c]),i.push(u);break}case ji.CircleWithArc:{let o=this._cp2(r,3,0);const a=this._cp3(r,o,.5,-1);let l,c;if(s>=4)l=r[3],c=this._crossProduct(this._sub(l,o),this._sub(a,o))>0;else{l=o,c=this._crossProduct(this._sub(l,n),this._sub(a,n))>0;const g=24*this._geomUnitsPerPoint,y=this._sub(l,n);this._normalize(y,g);const v=Math.sqrt(2)/2;this._rotateDirect(y,v,c?v:-v),o=this._add(n,y)}const u=this._sub(o,n),d=Math.cos(Math.PI/18),p=Math.sin(Math.PI/18),m=[o];for(let g=1;g<=36;g++)this._rotateDirect(u,d,p),m.push(this._add(n,u));this._add90DegArc(m,o,l,a,c),wH(m[m.length-8],1),i.push(m);break}case ji.DoubleJog:{let o,a=this._cp2(r,-3,1),l=this._cp3(r,a,-1,-.5);if(s>=4)o=r[3];else{const b=n;n=a,o=l;const w=this._dist(n,b),x=this._dist(o,b);let T=30*this._geomUnitsPerPoint;.5*w<T&&(T=.5*w),.5*x<T&&(T=.5*x),a=this._mix(n,T/w,b,(w-T)/w),l=this._mix(o,T/x,b,(x-T)/x)}const c=this._mid(n,a),u=this._mid(o,l),d=this._dist(n,a),p=this._dist(l,o);let m=Math.min(d,p)/8;m=Math.min(m,24*this._geomUnitsPerPoint);const g=Math.cos(Math.PI/4);let y=this._sub(n,a);this._normalize(y,m),this._crossProduct(y,this._sub(o,a))>0?this._rotateDirect(y,g,-g):this._rotateDirect(y,g,g);let v=[];v.push(a),v.push(this._add(c,y)),v.push(this._sub(c,y)),v.push(n),i.push(v),y=this._sub(o,l),this._normalize(y,m),this._crossProduct(y,this._sub(n,l))<0?this._rotateDirect(y,g,g):this._rotateDirect(y,g,-g),v=[],v.push(l),v.push(this._add(u,y)),v.push(this._sub(u,y)),v.push(o),i.push(v);break}case ji.PerpendicularOffset:{const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=this._sub(a,o);this._crossProduct(l,this._sub(n,o))>0?this._rightPerpendicular(l):this._leftPerpendicular(l);const c=[l[0]/8,l[1]/8],u=this._sub(this._mid(o,a),c);i.push([u,n]);break}case ji.LineExcludingLastSegment:{const o=this._arrowPath(r),a=[];let l=o.length-2;for(;l--;)a.push(o[l]);i.push(a);break}case ji.MultivertexArrow:{const o=this._arrowPath(r),a=[];this._addArrow(a,o,!1),i.push(a);break}case ji.CrossedArrow:{const o=this._arrowPath(r),a=[];this._addArrow(a,o,!0),i.push(a);break}case ji.ChevronArrow:{const[o,a]=this._arrowLastSeg(r),l=10*this._geomUnitsPerPoint,c=this._sub(n,o),u=this._norm(c);this._normalize(c);const d=this._crossProduct(c,this._sub(a,o));let p=this._dotProduct(c,this._sub(a,o));p<.05*u?p=.05*u:p>.95*u-l&&(p=.95*u-l);const m=[o[0]+c[0]*p,o[1]+c[1]*p],g=this._leftPerp(c),y=[];y.push([m[0]+g[0]*d+c[0]*l,m[1]+g[1]*d+c[1]*l]),y.push(n),y.push([m[0]-g[0]*d+c[0]*l,m[1]-g[1]*d+c[1]*l]),i.push(y);break}case ji.ChevronArrowOffset:{const[o,a]=this._arrowLastSeg(r),l=this._sub(n,o),c=this._norm(l);this._normalize(l);const u=this._crossProduct(l,this._sub(a,o));let d=this._dotProduct(l,this._sub(a,o));d<.05*c?d=.05*c:d>.95*c&&(d=.95*c);const p=[o[0]+l[0]*d,o[1]+l[1]*d];this._leftPerpendicular(l);const m=[];m.push([p[0]+l[0]*u*.5,p[1]+l[1]*u*.5]),m.push(this._mid(p,n)),m.push([p[0]-l[0]*u*.5,p[1]-l[1]*u*.5]),i.push(m);break}case ji.PartialFirstSegment:{const[o,a]=this._arrowLastSeg(r),l=this._sub(n,o),c=this._norm(l);this._normalize(l);let u=this._dotProduct(l,this._sub(a,o));u<.05*c?u=.05*c:u>.95*c&&(u=.95*c);const d=[o[0]+l[0]*u,o[1]+l[1]*u];i.push([o,d]);break}case ji.Arch:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,1),l=this._sub(n,o),c=this._mix(a,1,l,.55),u=this._mix(a,1,l,-.55),d=[n];this._addBezier2(d,n,c,a,4),this._addBezier2(d,a,u,o,4),i.push(d);break}case ji.CurvedParallelTicks:{const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=this._sub(a,o);this._crossProduct(l,this._sub(n,o))>0?this._rightPerpendicular(l):this._leftPerpendicular(l);const c=[l[0]/8,l[1]/8],u=this._sub(this._mid(o,a),c),d=this._sub(this._mix(o,.75,a,.25),c),p=this._sub(this._mix(o,.25,a,.75),c),m=[o];this._addBezier2(m,o,d,u,3),this._addBezier2(m,u,p,a,3),i.push(m);for(let g=0;g<8;g++){const y=m[2*g+1],v=[this._clone(y)];v.push(this._add(y,[l[0]/4,l[1]/4])),i.push(v)}break}case ji.Arc90Degrees:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,1),l=[o];this._add90DegArc(l,o,n,a),i.push(l);break}case ji.TipWithPerpendicularAndTicks:{const[o,a]=this._arrowLastSeg(r),l=10*this._geomUnitsPerPoint,c=this._sub(n,o),u=this._norm(c);this._normalize(c);let d=this._crossProduct(c,this._sub(a,o)),p=this._dotProduct(c,this._sub(a,o));p<.05*u?p=.05*u:p>.95*u-l&&(p=.95*u-l);const m=this._leftPerp(c),g=[n[0]-c[0]*l,n[1]-c[1]*l],y=.5*Math.max(u-p-l,l);d=Math.abs(d);const v=[];v.push([g[0]+m[0]*(d+y)-c[0]*y,g[1]+m[1]*(d+y)-c[1]*y]),v.push([g[0]+m[0]*d,g[1]+m[1]*d]),v.push([g[0]-m[0]*d,g[1]-m[1]*d]),v.push([g[0]-m[0]*(d+y)-c[0]*y,g[1]-m[1]*(d+y)-c[1]*y]),i.push(v),i.push([g,n]);break}case ji.FullGeometry:default:i.push(r)}}return i}},JIe=class RR{static local(){return RR.instance===null&&(RR.instance=new RR),RR.instance}execute(e,i,r,s,n){return new m0t(e,i,r)}};JIe.instance=null;let m0t=class extends cj{constructor(e,i,r){super(e,!0,!0),this._curveHelper=new J0,this._beginCut=(i.beginCut!==void 0?i.beginCut:1)*r,this._endCut=(i.endCut!==void 0?i.endCut:1)*r,this._middleCut=(i.middleCut!==void 0?i.middleCut:0)*r,this._invert=i.invert!==void 0&&i.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){const{_beginCut:i,_endCut:r,_middleCut:s}=this,n=e.pathLength(),o=Xn.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(i!==0||r!==0||s!==0)if(i+r+s>=n)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else this._curveHelper.appendSubCurve(o,e,0,i),this._curveHelper.appendSubCurve(o,e,.5*(n-s),.5*(n+s)),this._curveHelper.appendSubCurve(o,e,n-r,r)}else if(i===0&&r===0&&s===0)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else i+r+s<n&&(s===0?this._curveHelper.appendSubCurve(o,e,i,n-r):(this._curveHelper.appendSubCurve(o,e,i,.5*(n-s)),this._curveHelper.appendSubCurve(o,e,.5*(n+s),n-r)));return o.totalSize===0?null:o}};const Dfe=1e-7;let uj=class{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return this._values.length===0}size(){return this._values.length}init(e,i,r=!0){if(this._setEmpty(),!e||e.length===0)return!1;for(let s=0;s<e.length;s++){let n=Math.abs(e[s]);r&&n<Dfe&&(n=Dfe),this._values.push(n),this._length+=n}return i&&1&e.length&&(this._length*=2),this._length!==0&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){const i=this._values?this._values.length:0;for(let r=0;r<i;++r)this._values[r]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}},jy=class{constructor(){this.pt=null,this.ca=0,this.sa=0}};var Fv;(function(t){t[t.FAIL=0]="FAIL",t[t.END=1]="END",t[t.CONTINUE=2]="CONTINUE"})(Fv||(Fv={}));let sF=class{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return this.segment!==null}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}},hj=class extends J0{constructor(e=0,i=!1){super(e,i),this._tolerance=v3,this._currentPosition=new sF}updateTolerance(e){this._tolerance=v3*e}init(e,i,r=!0){return r?(this._patternLength=i.length(),this._partExtPtGap=i.extPtGap,this._partCtrlPtGap=i.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=e,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,i=Fv.FAIL){const r=new sF;return!!this._nextPosition(e,r,null,i)&&(r.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);const[i,r]=this._getAngleCS(this._currentPosition);e.ca=i,e.sa=r}nextPointAndAngle(e,i,r=Fv.FAIL){const s=new sF;if(!this._nextPosition(e,s,null,r))return!1;s.copyTo(this._currentPosition),i.pt=this._getPoint(s);const[n,o]=this._getAngleCS(s);return i.ca=n,i.sa=o,!0}nextCurve(e){if(e===0)return null;const i=Xn.createEmptyOptimizedCIM("esriGeometryPolyline");i.startPath(),i.nextPath();const r=new sF;return this._nextPosition(e,r,i,Fv.END)?(r.copyTo(this._currentPosition),i):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(e){return this._pathCursor.seekInPath(e),[this._pathCursor.x,this._pathCursor.y]}getSeg(e){return[this.getPt(e),this.getPt(e+1)]}_nextPosition(e,i,r,s){if(this._currentPosition.isPathEnd)return!1;let n=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(n/=this._currentPosition.segmentLength),this._currentPosition.copyTo(i);i.abscissa+e*this._partLengthRatio>i.segmentLength+this._tolerance;){if(r){if(r.pathSize===0)if(n===0){const a=i.segment[0];r.pushXY(a[0],a[1])}else r.pushPoint(this.getSegCoord2D(i.segment,n));const o=i.segment[1];r.pushXY(o[0],o[1])}if(n=0,e-=(i.segmentLength-i.abscissa)/this._partLengthRatio,this._partSegCount)i.segment=this._nextSegment(),i.segmentLength=this.getSegLength(i.segment),i.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return s!==Fv.FAIL&&(i.segmentLength=this.getSegLength(i.segment),i.isPartEnd=!0,s===Fv.END?(i.abscissa=i.segmentLength,i.isPathEnd=!0):i.abscissa=i.segmentLength+e,!0);this._currentPosition.copyTo(i)}}if(i.abscissa+=e*this._partLengthRatio,r){r.pathSize===0&&(n===0?r.pushPoint(i.segment[0]):r.pushPoint(this.getSegCoord2D(i.segment,n)));const o=i.abscissa/i.segmentLength;o===1?r.pushPoint(i.segment[1]):r.pushPoint(this.getSegCoord2D(i.segment,o))}return this._partSegCount||Math.abs(i.abscissa-i.segmentLength)<this._tolerance&&(i.isPathEnd=this._partIsLast,i.isPartEnd=!0),!0}_getPoint(e){const i=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,i)}_getAngleCS(e){const i=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(this._currentPosition.segment,i)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let e=this._partSegCount;for(;e;)this._previousSegment(),--e;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const i=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(i);let r=i+this._partSegCount+1;if(r>=this._pathCursor.pathSize&&(r=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(r),this._patternLength>0){const s=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,n=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let o=Math.round((this._partLength-(s+n))/this._patternLength);o<=0&&(o=s+n>0?0:1),this._partLengthRatio=this._partLength/(s+n+o*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}};const lM={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:"Loop",repeatdelay:0}};function g0t(t){return typeof t=="function"}function y0t(t,e,i,r){return g0t(t)?t(e,i,r):t}const _0t=` /-,
`;function Nfe(t){let e=t.length;for(;e--;)if(!_0t.includes(t.charAt(e)))return!1;return!0}function v0t(t,e){const i=[];let r=0,s=-1;do if(s=t.indexOf("[",r),s>=r){if(s>r){const n=t.substr(r,s-r);i.push([n,null,Nfe(n)])}if(r=s+1,s=t.indexOf("]",r),s>=r){if(s>r){const n=e[t.substr(r,s-r)];n&&i.push([null,n,!1])}r=s+1}}while(s!==-1);if(r<t.length-1){const n=t.substr(r);i.push([n,null,Nfe(n)])}return i}function b0t(t,e,i,r){let s="",n=null;for(const o of e){const[a,l,c]=o;if(a)c?n=a:(n&&(s+=n,n=null),s+=a);else{let u=l;i!=null&&(u=i3e(l,i));const d=t.attributes[u];d&&(n&&(s+=n,n=null),s+=d)}}return w0t(s,r)}function w0t(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function x0t(t){return t?[t[0],t[1],t[2],t[3]/255]:[0,0,0,0]}function S0t(t){var e;return((e=t.data)==null?void 0:e.symbol)??null}function T0t(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function E0t(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function QIe(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const $i=(t,e=0)=>t==null||isNaN(t)?e:t,C0t=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function M0t(){return fe(()=>import("./geometryEngineJSON-CWlCA2jv.js").then(t=>t.g),__vite__mapDeps([8,9,10]))}function A0t(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function P0t(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function KIe(t){let e="normal",i="normal";if(t){const r=t.toLowerCase();r.includes("italic")?e="italic":r.includes("oblique")&&(e="oblique"),r.includes("bold")?i="bold":r.includes("light")&&(i="lighter")}return{style:e,weight:i}}function e3e(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function cI(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=cI(e);if(i!=null)return i}break;case"CIMTextSymbol":return cI(t.symbol);case"CIMSolidFill":return t.color}return null}function VX(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const i of e){const r=VX(i);if(r!=null)return r}break}case"CIMTextSymbol":return VX(t.symbol);case"CIMSolidStroke":return t.color}}function BX(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=BX(e);if(i!==void 0)return i}break;case"CIMTextSymbol":return BX(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function O0t(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function R0t(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function $0t(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const _2=t=>t.includes("data:image/svg+xml");function GYt(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function sse(t){return t&&t.charAt(0).toLowerCase()+t.substring(1)}function jYt(t,e,i,r,s,n){const{infos:o}=n;let a=1,l=0,c=0,u=0;for(const{offsetX:m,offsetY:g,rotation:y,size:v,frameHeight:b,rotateClockWise:w}of o)c=Ufe(m,g,l,a,c),u=kfe(m,g,l,a,u),b&&(a*=v/b),l=zfe(y,w,l);const d=Ufe(r,s,l,a,c),p=kfe(r,s,l,a,u);return{size:t*a,rotation:zfe(e,i,l),offsetX:d,offsetY:p}}function t3e(t){return t!=null&&t.dashTemplate&&typeof t.dashTemplate=="string"&&(t.dashTemplate=t.dashTemplate.split(" ").map(Number)),t}function GX(t){if(t==null)return"Normal";switch(t.type){case"CIMTextSymbol":return t.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const e=t.symbolLayers;if(!e)return"Normal";for(const i of e)if(i.type==="CIMVectorMarker")return GX(i)}break;case"CIMVectorMarker":{const e=t.markerGraphics;if(!e)return"Normal";for(const i of e)if(i.symbol)return GX(i.symbol)}}return"Normal"}function i3e(t,e){if(e!==null){const i=e.get(t);return i?i.name:t}return t}function I0t(t){return t.map(e=>({...e,propertyName:sse(e.propertyName)}))}function Ffe(t){const e={};for(const i in t){const r=t[i];e[sse(i)]=r}return e}function kfe(t,e,i,r,s){const n=i*Math.PI/180;if(n){const o=Math.cos(n);return(Math.sin(n)*t+o*e)*r+s}return e*r+s}function Ufe(t,e,i,r,s){const n=i*Math.PI/180;return n?(Math.cos(n)*t-Math.sin(n)*e)*r+s:t*r+s}function zfe(t,e,i){return e?i-t:i+t}const L0t=1e3,Vfe=1e-7;let r3e=class $R{static local(){return $R.instance===null&&($R.instance=new $R),$R.instance}execute(e,i,r,s,n){return new D0t(e,i,r,s)}};r3e.instance=null;let D0t=class extends cj{constructor(e,i,r,s){super(e,!0,!0),this._firstCurve=null,this._walker=new hj,this._walker.updateTolerance(r),this._endings=i.lineDashEnding,this._customDashPos=-(i.offsetAlongLine??0)*r,this._offsetAtEnd=(i.customEndingOffset??0)*r,this._tileKey=s;let n=t3e(i).dashTemplate;n==null&&(n=[]),n.length%2&&(n=[...n,...n]);let o=0;for(let a=0;a<n.length;a++){let l=Math.abs(n[a]);l<Vfe&&(l=Vfe),o+=l}this._patternLength=o,this._numOfDashesPerPattern=n.length/2,this._pattern=new uj,this._pattern.init(n,!0),this._pattern.scale(r)}processPath(e){if(this._pattern.length()===0){this.iteratePath=!1;const s=i1(e);return Xn.fromJSONCIM({paths:[s]})}if(!this.iteratePath){let s=!0;switch(this._endings){case Ua.HalfPattern:case Ua.HalfGap:default:this._pattern.extPtGap=0;break;case Ua.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case Ua.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case Ua.NoConstraint:this.isClosed||(s=!1);break;case Ua.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const n=e.pathLength();if(this._pattern.isEmpty()||n<.1*this._pattern.length()){const o=i1(e);return Xn.fromJSONCIM({paths:[o]})}if(!this._walker.init(e,this._pattern,s)){const o=i1(e);return Xn.fromJSONCIM({paths:[o]})}}let i;if(this.iteratePath)i=this._pattern.nextValue();else{let s;switch(this._endings){case Ua.HalfPattern:default:s=.5*this._pattern.firstValue();break;case Ua.HalfGap:s=.5*-this._pattern.lastValue();break;case Ua.FullGap:s=-this._pattern.lastValue();break;case Ua.FullPattern:s=0;break;case Ua.NoConstraint:case Ua.Custom:s=-this._customDashPos}let n=s/this._pattern.length();n-=Math.floor(n),s=n*this._pattern.length(),this._pattern.reset(),i=this._pattern.nextValue();let o=!1;for(;s>=i;)s-=i,i=this._pattern.nextValue(),o=!o;i-=s,o?(this._walker.nextPosition(i),i=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(i),i=this._pattern.nextValue(),this._walker.nextPosition(i),i=this._pattern.nextValue())}let r=this._walker.nextCurve(i);if(r)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)r.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else i=this._pattern.nextValue(),!this._walker.nextPosition(i)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(r.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,r=this._firstCurve,this._firstCurve=null;return r==null||r.reset(),r}isClippingRequired(e){const i=Y3(e);let r=0;for(const s of i)r+=yee(s);return Math.round(this._numOfDashesPerPattern*(r/this._patternLength))>L0t}},s3e=class IR{static local(){return IR.instance===null&&(IR.instance=new IR),IR.instance}execute(e,i,r,s,n,o){return new N0t(e,i,r,s,n,o)}};s3e.instance=null;let N0t=class{constructor(e,i,r,s,n,o){switch(this._inputGeometries=e,this._tileKey=s,this._geometryEngine=n,this._maxInflateSize=o*r,this._width=(i.width!==void 0?i.width:2)*r,i.method){case $x.Mitered:case $x.Bevelled:case $x.Rounded:case $x.TrueBuffer:case $x.Square:}this._option=i.option}next(){let e;for(;e=this._inputGeometries.next();){if(e.geometryType==="esriGeometryEnvelope"&&this._width>0){const i=e.asJSON();return Math.min(i.xmax-i.xmin,i.ymax-i.ymin)-2*this._width<0?e:Xn.fromJSONCIM({paths:[[[i.xmin+this._width,i.ymin+this._width],[i.xmax-this._width,i.ymin+this._width],[i.xmax-this._width,i.ymax-this._width],[i.xmin+this._width,i.ymax-this._width],[i.xmin+this._width,i.ymin+this._width]],[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]]]})}if(e.geometryType==="esriGeometryPolygon"){if(this._width===0)return e.clone();const i=this._geometryEngine;if(i==null)return null;const r=this._tileKey?lj(e,this._maxInflateSize):e.clone();if(!r)continue;const s=i.buffer(We.WebMercator,r.asJSON(),-this._width,1);if(s){for(const n of s.rings)if(n){r.startPath();for(const o of n.reverse())r.pushXY(o[0],r.yFactor*o[1])}}return r}}return null}},n3e=class LR{static local(){return LR.instance===null&&(LR.instance=new LR),LR.instance}execute(e,i,r,s,n){return new F0t(e,i,r)}};n3e.instance=null;let F0t=class extends cj{constructor(e,i,r){super(e,!1,!0),this._curveHelper=new J0,this._length=(i.length!==void 0?i.length:20)*r,this._angle=i.angle!==void 0?i.angle:225,this._position=i.position!==void 0?i.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){const i=Xn.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(e))return null;e.seekInPath(0);const r=e.x,s=e.y;e.seekInPath(e.pathSize-1);const n=e.x,o=e.y,a=[n-r,o-s];this._curveHelper.normalize(a);const l=r+(n-r)*this._position/100,c=s+(o-s)*this._position/100,u=Math.cos((90-this._angle)/180*Math.PI);let d=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(d=-d),this._mirror=!this._mirror;const p=[l-this._length/2*u,c-this._length/2*d],m=[l+this._length/2*u,c+this._length/2*d];return i.pushPath([[r,s],p,m,[n,o]]),i}},o3e=class DR{static local(){return DR.instance===null&&(DR.instance=new DR),DR.instance}execute(e,i,r,s,n){return new k0t(e,i,r)}};o3e.instance=null;let k0t=class{constructor(e,i,r){this._inputGeometries=e,this._offsetX=i.offsetX!==void 0?i.offsetX*r:0,this._offsetY=i.offsetY!==void 0?i.offsetY*r:0}next(){let e=this._inputGeometries.next();for(;e;){if(e.totalSize>0)return this._move(e.clone(),this._offsetX,this._offsetY);e=this._inputGeometries.next()}return null}_move(e,i,r){for(;e.nextPath();)for(;e.nextPoint();)e.x=e.x+i,e.y=e.y+r;return e.reset(),e}};const U0t=10;let a3e=class NR{static local(){return NR.instance===null&&(NR.instance=new NR),NR.instance}execute(e,i,r,s,n,o){return new z0t(e,i,r,s,n,o)}};a3e.instance=null;let z0t=class{constructor(e,i,r,s,n,o){this._inputGeometries=e,this._tileKey=s,this._geometryEngine=n,this._curveHelper=new J0,this._offset=(i.offset??1)*r,this._method=i.method,this._maxInflateSize=Math.max(Math.abs(o*r),U0t),this._option=i.option,this._offsetFlattenError=v3*r}next(){let e;for(;e=this._inputGeometries.next();){if(this._offset===0)return e.clone();if(e.geometryType==="esriGeometryEnvelope"){if(this._method===o0.Rounded&&this._offset>0){const o=i1(e),a=this._curveHelper.offset(o,-this._offset,this._method,4,this._offsetFlattenError);if(a){const l=Xn.createEmptyOptimizedCIM(e.geometryType);return l.pushPath(a),l}return null}const n=e.asJSON();if(Qp(n)&&Math.min(n.xmax-n.xmin,n.ymax-n.ymin)+2*this._offset>0)return Xn.fromJSONCIM({xmin:n.xmin-this._offset,xmax:n.xmax+this._offset,ymin:n.ymin-this._offset,ymax:n.ymax+this._offset})}const i=this._geometryEngine;if(i==null)continue;const r=this._tileKey?lj(e,this._maxInflateSize):e.clone();if(!r)continue;const s=i.offset(We.WebMercator,r.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return s?Xn.fromJSONCIM(s):null}return null}},l3e=class FR{static local(){return FR.instance===null&&(FR.instance=new FR),FR.instance}execute(e,i,r,s,n){return new V0t(e,i,r)}};l3e.instance=null;let V0t=class{constructor(e,i,r){this._inputGeometries=e,this._reverse=i.reverse===void 0||i.reverse}next(){let e=this._inputGeometries.next();for(;e;){if(!this._reverse)return e;if(e.geometryType==="esriGeometryPolyline")return B0t(e.clone());e=this._inputGeometries.next()}return null}};function B0t(t){for(;t.nextPath();)for(let e=0;e<t.pathSize/2;e++){t.seekInPath(e);const i=t.x,r=t.y;t.seekInPath(t.pathSize-e-1);const s=t.x,n=t.y;t.x=i,t.y=r,t.seekInPath(e),t.x=s,t.y=n}return t.reset(),t}let c3e=class kR{static local(){return kR.instance===null&&(kR.instance=new kR),kR.instance}execute(e,i,r,s,n){return new G0t(e,i,r)}};c3e.instance=null;let G0t=class{constructor(e,i,r){this._inputGeometries=e,this._rotateAngle=i.angle!==void 0?i.angle*Math.PI/180:0}next(){let e=this._inputGeometries.next();for(;e;){if(this._rotateAngle===0||e.geometryType==="esriGeometryPoint")return e;if(e.totalSize>0){const i=mB(e),r=(i[2]+i[0])/2,s=(i[3]+i[1])/2;return e.reset(),this._rotate(e.clone(),r,s)}e=this._inputGeometries.next()}return null}_rotate(e,i,r){const s=Math.cos(this._rotateAngle),n=Math.sin(this._rotateAngle);for(;e.nextPath();)for(;e.nextPoint();){const o=e.x-i,a=e.y-r;e.x=i+o*s-a*n,e.y=r+o*n+a*s}return e.reset(),e}},u3e=class UR{static local(){return UR.instance===null&&(UR.instance=new UR),UR.instance}execute(e,i,r,s,n){return new j0t(e,i,r)}};u3e.instance=null;let j0t=class{constructor(e,i,r){this._inputGeometries=e,this._xFactor=i.xScaleFactor!==void 0?i.xScaleFactor:1.15,this._yFactor=i.yScaleFactor!==void 0?i.yScaleFactor:1.15}next(){const e=this._inputGeometries.next();if(e){if(this._xFactor===1&&this._yFactor===1||e.geometryType==="esriGeometryPoint")return e;if(e.totalSize>0){const i=mB(e),r=(i[2]+i[0])/2,s=(i[3]+i[1])/2;return e.reset(),this._scaleCursor(e.clone(),r,s)}}return null}_scaleCursor(e,i,r){for(;e.nextPath();)for(;e.nextPoint();)e.x=i+(e.x-i)*this._xFactor,e.y=r+(e.y-r)*this._yFactor;return e.reset(),e}},h3e=class zR{static local(){return zR.instance===null&&(zR.instance=new zR),zR.instance}execute(e,i,r,s,n){return new H0t(e,i,r)}};h3e.instance=null;let H0t=class{constructor(e,i,r){this._inputGeometries=e,this._height=(i.amplitude!==void 0?i.amplitude:2)*r,this._period=(i.period!==void 0?i.period:3)*r,this._style=i.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new uj,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new hj,this._walker.updateTolerance(r)}next(){let e=this._inputGeometries.next();for(;e;){if(this._height===0||this._period===0)return e;const i=this._processGeom(e);if(i)return i;e=this._inputGeometries.next()}return null}_processGeom(e){const i=Xn.createEmptyOptimizedCIM(e.geometryType);for(;e.nextPath();){i.startPath();const r=e.pathLength();if(this._walker.init(e,this._pattern))switch(this._style){case mC.Sinus:default:this._constructCurve(i,r,!1);break;case mC.Square:this._constructSquare(i,r);break;case mC.Triangle:this._constructTriangle(i,r);break;case mC.Random:this._constructCurve(i,r,!0)}else for(;e.nextPoint();)i.pushXY(e.x,e.y)}return i}_constructCurve(e,i,r){let s=Math.round(i/this._period);s===0&&(s=1);const n=s*16+1,o=i/s,a=this._period/16,l=1/n,c=2*Math.PI*i/o,u=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),p=2*Math.PI*Math.random(),m=.75-Math.random()/2,g=.75-Math.random()/2,y=new jy;this._walker.curPointAndAngle(y),e.pushPoint(y.pt);let v=0;for(;;){if(!this._walker.nextPointAndAngle(a,y)){e.pushPoint(this._walker.getPathEnd());break}{const b=v;let w;if(v+=l,r){const x=this._height/2*(1+.3*Math.sin(m*c*b+u));w=x*Math.sin(c*b+d),w+=x*Math.sin(g*c*b+p),w/=2}else w=.5*this._height*Math.sin(.5*c*b);e.pushXY(y.pt[0]-w*y.sa,y.pt[1]+w*y.ca)}}}_constructSquare(e,i){Math.round(i/this._period);let r=!0;for(;;){let s=!1;if(this._walker.curPositionIsValid()){const n=new jy;this._walker.curPointAndAngle(n);const o=new jy;if(this._walker.nextPointAndAngle(this._period,o)){const a=new jy;this._walker.nextPointAndAngle(this._period,a)&&(r?(e.pushPoint(n.pt),r=!1):e.pushPoint(n.pt),e.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),e.pushXY(o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),e.pushXY(a.pt[0]+this._height/2*a.sa,a.pt[1]-this._height/2*a.ca),s=!0)}}if(!s){e.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(e,i){Math.round(i/this._period);let r=!0;for(;;){let s=!1;if(this._walker.curPositionIsValid()){const n=new jy;this._walker.curPointAndAngle(n);const o=new jy;if(this._walker.nextPointAndAngle(this._period/2,o)){const a=new jy;this._walker.nextPointAndAngle(this._period,a)&&(this._walker.nextPosition(this._period/2)&&(r?(e.pushPoint(n.pt),r=!1):e.pushPoint(n.pt),e.pushXY(o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca),e.pushXY(a.pt[0]+this._height/2*a.sa,a.pt[1]-this._height/2*a.ca)),s=!0)}}if(!s){e.pushPoint(this._walker.getPathEnd());break}}}},d3e=class VR{static local(){return VR.instance===null&&(VR.instance=new VR),VR.instance}execute(e,i,r,s,n){return new q0t(e,i,r)}};d3e.instance=null;let q0t=class extends VL{constructor(e,i,r){super(e),this._geometryWalker=new hj,this._geometryWalker.updateTolerance(r),this._angleToLine=i.angleToLine??!0,this._offset=(i.offset?i.offset:0)*r,this._originalEndings=i.endings,this._offsetAtEnd=(i.customEndingOffset?i.customEndingOffset:0)*r,this._position=-(i.offsetAlongLine?i.offsetAlongLine:0)*r,this._pattern=new uj,this._pattern.init(i.placementTemplate,!1),this._pattern.scale(r),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;let i;if(this.iteratePath)i=this._pattern.nextValue();else{this._originalEndings===kp.WithFullGap&&this.isClosed?this._endings=kp.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let s,n=!0;switch(this._endings){case kp.NoConstraint:s=-this._position,s=this._adjustPosition(s),n=!1;break;case kp.WithHalfGap:default:s=-this._pattern.lastValue()/2;break;case kp.WithFullGap:s=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case kp.WithMarkers:s=0;break;case kp.Custom:s=-this._position,s=this._adjustPosition(s),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,n))return null;this._pattern.reset();let o=0;for(;s>o;)s-=o,o=this._pattern.nextValue();o-=s,i=o,this.iteratePath=!0}const r=new jy;return this._geometryWalker.nextPointAndAngle(i,r)?this._endings===kp.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===kp.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(r.pt[0]-this._offset*r.sa,r.pt[1]+this._offset*r.ca),this._angleToLine&&this.internalPlacement.setRotateCS(r.ca,r.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){let i=e/this._pattern.length();return i-=Math.floor(i),i*this._pattern.length()}},p3e=class BR{static local(){return BR.instance===null&&(BR.instance=new BR),BR.instance}execute(e,i,r,s,n){return new W0t(e,i,r)}};p3e.instance=null;let W0t=class extends VL{constructor(e,i,r){super(e,!1,!0),this._curveHelper=new J0,this._placePerPart=i.placePerPart??!1,this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._type=i.extremityPlacement,this._position=i.offsetAlongLine!==void 0?i.offsetAlongLine*r:0,this._beginProcessed=!1}processMultiPath(e){return this._placePerPart?super.processMultiPath(e):this.processPath(e)}processPath(e){let i;switch(this._type){case rg.Both:default:this._beginProcessed?(i=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(i=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case rg.JustBegin:i=this._atExtremities(e,this._position,!0);break;case rg.JustEnd:i=this._atExtremities(e,this._position,!1);case rg.None:}return i}_atExtremities(e,i,r){if(this._placePerPart||(r?e.seekPath(0):e.seekPath(e.totalSize-1)),r||e.seekPathEnd(),r?e.nextPoint():e.prevPoint()){let s=0,[n,o]=[0,0],[a,l]=[e.x,e.y];for(;r?e.nextPoint():e.prevPoint();){n=a,o=l,a=e.x,l=e.y;const c=this._curveHelper.getLength(n,o,a,l);if(s+c>i){const u=(i-s)/c,[d,p]=this._curveHelper.getAngleCS(n,o,a,l,u),m=this._curveHelper.getCoord2D(n,o,a,l,u);return this.internalPlacement.setTranslate(m[0]-this._offset*p,m[1]+this._offset*d),this._angleToLine&&this.internalPlacement.setRotateCS(-d,-p),this.internalPlacement}s+=c}}return null}},f3e=class GR{static local(){return GR.instance===null&&(GR.instance=new GR),GR.instance}execute(e,i,r,s,n){return new Y0t(e,i,r)}};f3e.instance=null;let Y0t=class extends VL{constructor(e,i,r){super(e),this._walker=new hj,this._walker.updateTolerance(r),this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._beginGap=i.beginPosition!==void 0?i.beginPosition*r:0,this._endGap=i.endPosition!==void 0?i.endPosition*r:0,this._flipFirst=i.flipFirst===void 0||i.flipFirst,this._pattern=new uj,this._pattern.init(i.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;let i;if(this.iteratePath){const a=this._pattern.nextValue()*this._subPathLen,l=this._beginGap+a;i=l-this._prevPos,this._prevPos=l}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=e.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();const a=this._pattern.nextValue()*this._subPathLen,l=this._beginGap+a;i=l-this._prevPos,this._prevPos=l,this.iteratePath=!0}const r=new jy;if(!this._walker.nextPointAndAngle(i,r,Fv.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(r.pt[0]-this._offset*r.sa,r.pt[1]+this._offset*r.ca);const s=this._isFirst&&this._flipFirst;let n,o;return this._angleToLine?(n=r.ca,o=r.sa):(n=1,o=0),s&&(n=-n,o=-o),this.internalPlacement.setRotateCS(n,o),this._isFirst=!1,this._posCount--,this._posCount===0&&(this.iteratePath=!1),this.internalPlacement}};const R_=512,Z0t=10,Xf=24,dV=1e-6;let m3e=class jR{static local(){return jR.instance===null&&(jR.instance=new jR),jR.instance}execute(e,i,r,s,n){return new X0t(e,i,r,s,n)}};m3e.instance=null;let X0t=class Qw{constructor(e,i,r,s,n){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(i.stepX??16)*r,this._stepY=Math.abs(i.stepY??16)*r,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,this._stepX!==0&&this._stepY!==0){if(this._gridType=i.gridType??lI.Fixed,this._gridType===lI.Random){const o=i.seed??13,a=1;this._randomLCG=new nS(o*a),this._randomness=(i.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=i.gridAngle??0,this._shiftOddRows=i.shiftOddRows??!1,this._offsetX=(i.offsetX??0)*r,this._offsetY=(i.offsetY??0)*r,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,s!=null){const[o,a,l,c]=s.split("/"),u=parseFloat(o),d=parseFloat(a),p=parseFloat(l),m=parseFloat(c);this._graphicOriginX=-(m*2**u+p)*R_,this._graphicOriginY=d*R_,this._testInsidePolygon=!0}this._internalPlacement=new iP,this._calculateMinMax(e),this._geometryCursor=e}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!Qw._randValues){Qw._randValues=[];for(let e=0;e<Xf;e++)for(let i=0;i<Xf;i++)Qw._randValues.push(this._randomLCG.getFloat()),Qw._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(e){let i,r,s,n,o,a,l,c,u,d,p,m,g,y;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=c=g=p=Number.MAX_VALUE,u=d=y=m=-Number.MAX_VALUE;const v=this._cosAngle!==1;for(e.reset();e.nextPath();)for(;e.nextPoint();)a=e.x,o=e.y,i=a-this._graphicOriginX-this._offsetX,r=o-this._graphicOriginY-this._offsetY,v?(s=this._cosAngle*i-this._sinAngle*r,n=this._sinAngle*i+this._cosAngle*r):(s=i,n=r),l=Math.min(l,s),u=Math.max(u,s),c=Math.min(c,n),d=Math.max(d,n),p=Math.min(p,o),m=Math.max(m,o),g=Math.min(g,a),y=Math.max(y,a);p=p!==Number.MAX_VALUE?p:-R_-this._stepY,m=m!==-Number.MAX_VALUE?m:this._stepY,g=g!==Number.MAX_VALUE?g:-this._stepX,y=y!==-Number.MAX_VALUE?y:R_+this._stepX;const b=m-p,w=y-g;if(this._verticalSubdivision=b>=w,this._polygonMin=this._verticalSubdivision?p:g,this._testInsidePolygon){let x=0-this._graphicOriginX-this._offsetX-this._stepX,T=R_-this._graphicOriginX-this._offsetX+this._stepX,C=-R_-this._graphicOriginY-this._offsetY-this._stepY,M=0-this._graphicOriginY-this._offsetY+this._stepY;if(v){const O=[[x,C],[x,M],[T,C],[T,M]];x=C=Number.MAX_VALUE,T=M=-Number.MAX_VALUE;for(const D of O){const k=this._cosAngle*D[0]-this._sinAngle*D[1],U=this._sinAngle*D[0]+this._cosAngle*D[1];x=Math.min(x,k),T=Math.max(T,k),C=Math.min(C,U),M=Math.max(M,U)}}l=l!==Number.MAX_VALUE?Math.max(l,x):x,c=c!==Number.MAX_VALUE?Math.max(c,C):C,u=u!==-Number.MAX_VALUE?Math.min(u,T):T,d=d!==-Number.MAX_VALUE?Math.min(d,M):M}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(u/this._stepX),this._yMin=Math.round(c/this._stepY),this._yMax=Math.round(d/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(e,g,y,p,m)}_buildAccelerationMap(e,i,r,s,n){e.reset();const o=new Map,a=this._verticalSubdivision,l=a?n-s:r-i;let c=Math.ceil(l/Z0t);if(c<=1)return;const u=Math.floor(l/c);let d,p,m,g,y,v,b,w,x,T,C;for(c++,this._delta=u,a?(x=-R_-2*this._stepY,T=2*this._stepY,C=s):(x=-2*this._stepX,T=R_+2*this._stepX,C=i);e.nextPath();)if(!(e.pathSize<2)&&e.nextPoint())for(d=e.x,p=e.y;e.nextPoint();d=m,p=g){if(m=e.x,g=e.y,a){if(p===g||p<x&&g<x||p>T&&g>T)continue;y=Math.min(p,g),v=Math.max(p,g)}else{if(d===m||d<x&&m<x||d>T&&m>T)continue;y=Math.min(d,m),v=Math.max(d,m)}for(;y<v;)b=Math.floor((y-C)/u),Bfe(b,d,p,m,g,o),y+=u;w=Math.floor((v-C)/u),w>b&&Bfe(w,d,p,m,g,o)}this._accelerationMap=o}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);const i=this._currentY*this._stepY+this._offsetY;let r,s;if(this._currentX++,this._gridType===lI.Random){const n=(this._currentX%Xf+Xf)%Xf,o=(this._currentY%Xf+Xf)%Xf;r=this._graphicOriginX+e+this._stepX*this._randomness*(.5-Qw._randValues[o*Xf+n])*2/3,s=this._graphicOriginY+i+this._stepY*this._randomness*(.5-Qw._randValues[o*Xf+n+1])*2/3}else r=this._graphicOriginX+this._cosAngle*e+this._sinAngle*i,s=this._graphicOriginY-this._sinAngle*e+this._cosAngle*i;if(!this._testInsidePolygon||this._isInsidePolygon(r,s,this._geometryCursor))return this._internalPlacement.setTranslate(r,s),this._internalPlacement}}_isInsidePolygon(e,i,r){if(this._accelerationMap==null)return J0t(e,i,r);e+=dV,i+=dV;const s=this._verticalSubdivision,n=s?i:e,o=Math.floor((n-this._polygonMin)/this._delta),a=this._accelerationMap.get(o);if(!a)return!1;let l,c,u,d=0;for(const p of a){if(l=p[0],c=p[1],s){if(l[1]>i==c[1]>i)continue;u=(c[0]-l[0])*(i-l[1])-(c[1]-l[1])*(e-l[0])}else{if(l[0]>e==c[0]>e)continue;u=(c[1]-l[1])*(e-l[0])-(c[0]-l[0])*(i-l[1])}u>0?d++:d--}return d!==0}};function J0t(t,e,i){let r,s,n,o,a=0;for(t+=dV,e+=dV,i.reset();i.nextPath();)if(i.nextPoint())for(r=i.x,s=i.y;i.nextPoint();r=n,s=o)n=i.x,o=i.y,s>e!=o>e&&((n-r)*(e-s)-(o-s)*(t-r)>0?a++:a--);return a!==0}function Bfe(t,e,i,r,s,n){let o=n.get(t);o||(o=[],n.set(t,o)),o.push([[e,i],[r,s]])}const Q0t=.001;let g3e=class HR{static local(){return HR.instance===null&&(HR.instance=new HR),HR.instance}execute(e,i,r,s,n){return new K0t(e,i,r)}};g3e.instance=null;let K0t=class extends VL{constructor(e,i,r){super(e),this._curveHelper=new J0,this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._relativeTo=i.relativeTo,this._position=i.startPointOffset!==void 0?i.startPointOffset*r:0,this._epsilon=Q0t*r}processPath(e){const i=this._position;if(this._relativeTo===Ix.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),e.nextPoint()){let[s,n]=[e.x,e.y],[o,a]=[0,0];for(;e.nextPoint();){o=e.x,a=e.y;const l=this._curveHelper.getLength(s,n,o,a);if(l<this._epsilon){s=o,n=a;continue}const c=.5+this._position/l,[u,d]=this._curveHelper.getAngleCS(s,n,o,a,c),p=this._curveHelper.getCoord2D(s,n,o,a,c);return this.internalPlacement.setTranslate(p[0]-this._offset*d,p[1]+this._offset*u),this._angleToLine&&this.internalPlacement.setRotateCS(u,d),this.internalPlacement}}return this.iteratePath=!1,null}const r=this._relativeTo===Ix.LineEnd;return this.onLine(e,i,r)}onLine(e,i,r){let s,n=!1;switch(this._relativeTo){case Ix.LineMiddle:default:e.seekPathStart(),s=e.pathLength()/2+i;break;case Ix.LineBeginning:s=i;break;case Ix.LineEnd:s=i,n=!0}r?e.seekPathEnd():e.seekPathStart();let o=0;if(r?e.prevPoint():e.nextPoint()){let[a,l]=[e.x,e.y],[c,u]=[0,0];for(;r?e.prevPoint():e.nextPoint();){c=e.x,u=e.y;const d=this._curveHelper.getLength(a,l,c,u);if(o+d>s){const p=(s-o)/d,[m,g]=this._curveHelper.getAngleCS(a,l,c,u,p),y=this._curveHelper.getCoord2D(a,l,c,u,p),v=n?-this._offset:this._offset;return this.internalPlacement.setTranslate(y[0]-v*g,y[1]+v*m),this._angleToLine&&(n?this.internalPlacement.setRotateCS(-m,-g):this.internalPlacement.setRotateCS(m,g)),this.internalPlacement}a=c,l=u,o+=d}}return null}};const e_t=1e-15;let y3e=class qR{static local(){return qR.instance===null&&(qR.instance=new qR),qR.instance}execute(e,i,r,s,n){return new t_t(e,i,r)}};y3e.instance=null;let t_t=class extends VL{constructor(e,i,r){super(e),this._curveHelper=new J0,this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._endPoints=i.placeOnEndPoints===void 0||i.placeOnEndPoints,this._controlPoints=i.placeOnControlPoints===void 0||i.placeOnControlPoints,this._regularVertices=i.placeOnRegularVertices===void 0||i.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const i=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(i[2]);let r=i[0],s=i[1];if(this._offset!==0){const n=Math.cos(i[2]),o=Math.sin(i[2]);r-=this._offset*o,s+=this._offset*n}return this.internalPlacement.setTranslate(r,s),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0,e.seekPathStart();const i=e.isClosed();let r=0,s=!1,n=0,o=0;if(e.seekPathStart(),e.nextPoint()){let a=e.x,l=e.y,c=e.getControlPoint(),u=!0,d=e.nextPoint();for(;d;){const p=e.x,m=e.y,g=e.getControlPoint();(this._angleToLine||this._offset!==0)&&(n=this._curveHelper.getAngle(a,l,p,m,0)),u?(u=!1,i?(r=n,s=c):(this._endPoints||this._controlPoints&&c)&&this._tags.push([a,l,n])):c?this._controlPoints&&this._tags.push([a,l,nF(o,n)]):this._regularVertices&&this._tags.push([a,l,nF(o,n)]),(this._angleToLine||this._offset!==0)&&(o=this._curveHelper.getAngle(a,l,p,m,1)),d=e.nextPoint(),d||(i?g||s?this._controlPoints&&this._tags.push([p,m,nF(o,r)]):this._regularVertices&&this._tags.push([p,m,nF(o,r)]):(this._endPoints||this._controlPoints&&g)&&this._tags.push([p,m,o])),a=p,l=m,c=g}}this._tagIterator=0}};function nF(t,e){const i=Math.PI;for(;Math.abs(e-t)>i+2*e_t;)e-t>i?e-=2*i:e+=2*i;return(t+e)/2}const i_t=100*222045e-21;function r_t(t){if(t.totalSize===0)return null;const e=mB(t);if(!e)return null;const i=4*(Math.abs(e[0])+Math.abs(e[2])+Math.abs(e[1])+Math.abs(e[3])+1)*i_t;let r=0,s=0;t.reset();for(let k=0;t.nextPath();k++){const U=t.getCurrentRingArea();U>s&&(s=U,r=k)}if(t.seekPath(r),t.pathSize===0)return null;t.seekPathStart();const n=Ewe(t);if(Math.abs(s)<=2*i*i)return[(n[0]+n[2])/2,(n[1]+n[3])/2];t.seekPathStart();const o=xje(t,Ht());if(o===null)return null;if(t.totalPoints<4)return o;const a=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],l=[NaN,NaN,NaN,NaN],c=[NaN,NaN,NaN,NaN];let u=!1,d=JP(o,t,!0);d.distance===0&&(u=!0,a[0][0]=o[0],a[0][1]=o[1],d=JP(o,t,!1)),l[0]=d.distance,c[0]=0;const p=[NaN,NaN];let m=!1,g=.25,y=-1,v=NaN;do if(v=NaN,a[1]=SH(t,TH(n[0],n[2],g),i,e),isNaN(a[1][0])||isNaN(a[1][1])||(d=JP(a[1],t,!1),v=d.distance),!isNaN(v)&&v>i&&H5(a[1],t))m=!0,l[1]=v,c[1]=Kw(a[1],o);else if(!isNaN(v)&&v>y&&(y=v,p[0]=a[1][0],p[1]=a[1][1]),g-=.01,g<.1){if(!(y>=0))break;m=!0,l[1]=y,a[1][0]=p[0],a[1][1]=p[1],c[1]=Kw(a[1],o)}while(!m);m=!1,g=.5,y=-1;let b=.01,w=1;do if(v=NaN,a[2]=SH(t,TH(n[0],n[2],g),i,e),isNaN(a[2][0])||isNaN(a[2][1])||(d=JP(a[2],t,!1),v=d.distance),!isNaN(v)&&v>i&&H5(a[2],t))m=!0,l[2]=v,c[2]=Kw(a[2],o);else if(!isNaN(v)&&v>y)y=v,p[0]=a[2][0],p[1]=a[2][1];else if(v>y&&(y=v,p[0]=a[2][0],p[1]=a[2][1]),g=.5+b*w,b+=.01,w*=-1,g<.3||g>.7){if(!(y>=0))break;m=!0,l[2]=y,a[2][0]=p[0],a[2][1]=p[1],c[2]=Kw(a[2],o)}while(!m);m=!1,g=.75,y=-1;do if(v=NaN,a[3]=SH(t,TH(n[0],n[2],g),i,e),isNaN(a[3][0])||isNaN(a[3][1])||(d=JP(a[3],t,!1),v=d.distance),!isNaN(v)&&v>i&&H5(a[3],t))m=!0,l[3]=v,c[3]=Kw(a[3],o);else if(v>y&&(y=v,p[0]=a[3][0],p[1]=a[3][1]),g+=.01,g>.9){if(!(y>=0))break;m=!0,l[3]=y,a[3][0]=p[0],a[3][1]=p[1],c[3]=Kw(a[3],o)}while(!m);const x=[0,1,2,3],T=u?0:1;let C;for(let k=T;k<4;k++)for(let U=T;U<3;U++){const H=c[U],z=c[U+1];o_t(H,z)>0&&(C=x[U],x[U]=x[U+1],x[U+1]=C,c[U]=z,c[U+1]=H)}let M=T,O=0,D=0;for(let k=T;k<4;k++){switch(k){case 0:D=2*l[x[k]];break;case 1:D=1.66666666*l[x[k]];break;case 2:D=1.33333333*l[x[k]];break;case 3:D=l[x[k]]}D>O&&(O=D,M=x[k])}return a[M]}function H5(t,e){let i,r,s,n,o=0;for(e.reset();e.nextPath()&&e.nextPoint();)for(i=e.x,r=e.y;e.nextPoint();i=s,r=n)s=e.x,n=e.y,r>t[1]!=n>t[1]&&((s-i)*(t[1]-r)-(n-r)*(t[0]-i)>0?o++:o--);return o!==0}function JP(t,e,i){if(i&&H5(t,e))return{coord:t,distance:0};let r=1/0,s=0,n=0,o=[0,0],a=[0,0];const l=[0,0];for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(o[0]=e.x,o[1]=e.y;e.nextPoint();o=a){a=[e.x,e.y],yje(l,t,o,a);const c=Kw(t,l);c<r&&(r=c,s=l[0],n=l[1])}return{coord:[s,n],distance:Math.sqrt(r)}}function SH(t,e,i,r){const s=[e,0];let n=1/0,o=1/0,a=!1,l=!1;const c=[[e,r[1]-1],[e,r[3]+1]],u=[0,0],d=[0,0],p=[0,0],m=[[0,0],[0,0]],g=Ht();for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(m[0][0]=t.x,m[0][1]=t.y;t.nextPoint();m[0][0]=m[1][0],m[0][1]=m[1][1]){if(m[1][0]=t.x,m[1][1]=t.y,s_t(g,m)===null||(d[0]=c[0][0],d[1]=c[0][1],p[0]=c[1][0],p[1]=c[1][1],n_t(g,d,p)===0)||!IU(c[0],c[1],m[0],m[1],u))continue;const y=u[1];n>o?y<n&&(n=y,a=!0):y<o&&(o=y,l=!0)}return a&&l?s[1]=(n+o)/2:s[0]=s[1]=NaN,s}function s_t(t,e){if(e.length<2)return null;t||(t=Ht());const[i,r]=e[0],[s,n]=e[1];return t[0]=Math.min(i,s),t[1]=Math.min(r,n),t[2]=Math.max(i,s),t[3]=Math.max(r,n),t}const oF=1,aF=4,Gfe=3,jfe=12;function n_t(t,e,i){let r=Jf(e,t),s=Jf(i,t);const n=t[0],o=t[1],a=t[2],l=t[3];if(r&s)return 0;if(!(r|s))return 4;const c=(r?1:0)|(s?2:0);do{const u=i[0]-e[0],d=i[1]-e[1];if(u>d)r&Gfe?(r&oF?(e[1]+=d*(n-e[0])/u,e[0]=n):(e[1]+=d*(a-e[0])/u,e[0]=a),r=Jf(e,t)):s&Gfe?(s&oF?(i[1]+=d*(n-i[0])/u,i[0]=n):(i[1]+=d*(a-i[0])/u,i[0]=a),s=Jf(i,t)):r?(r&aF?(e[0]+=u*(o-e[1])/d,e[1]=o):(e[0]+=u*(l-e[1])/d,e[1]=l),r=Jf(e,t)):(s&aF?(i[0]+=u*(o-i[1])/d,i[1]=o):(i[0]+=u*(l-i[1])/d,i[1]=l),s=Jf(i,t));else if(r&jfe?(r&aF?(e[0]+=u*(o-e[1])/d,e[1]=o):(e[0]+=u*(l-e[1])/d,e[1]=l),r=Jf(e,t)):s&jfe?(s&aF?(i[0]+=u*(o-i[1])/d,i[1]=o):(i[0]+=u*(l-i[1])/d,i[1]=l),s=Jf(i,t)):r?(r&oF?(e[1]+=d*(n-e[0])/u,e[0]=n):(e[1]+=d*(a-e[0])/u,e[0]=a),r=Jf(e,t)):(s&oF?(i[1]+=d*(n-i[0])/u,i[0]=n):(i[1]+=d*(a-i[0])/u,i[0]=a),s=Jf(i,t)),r&s)return 0}while(r|s);return c}function Jf(t,e){return(t[0]<e[0]?1:0)|(t[0]>e[2]?1:0)<<1|(t[1]<e[1]?1:0)<<2|(t[1]>e[3]?1:0)<<3}function TH(t,e,i){return t+(e-t)*i}function Kw(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}function o_t(t,e){if(t<e)return-1;if(t>e)return 1;if(t===e)return 0;const i=isNaN(t),r=isNaN(e);return i<r?-1:i>r?1:0}let _3e=class WR{static local(){return WR.instance===null&&(WR.instance=new WR),WR.instance}execute(e,i,r,s,n){return new a_t(e,i,r)}};_3e.instance=null;let a_t=class{constructor(e,i,r){this._geometryCursor=e,this._offsetX=i.offsetX!==void 0?i.offsetX*r:0,this._offsetY=i.offsetY!==void 0?i.offsetY*r:0,this._method=i.method!==void 0?i.method:gC.OnPolygon,this._internalPlacement=new iP}next(){const e=this._geometryCursor;return this._geometryCursor=null,e?this._polygonCenter(e):null}_polygonCenter(e){let i=!1;switch(this._method){case gC.CenterOfMass:{const r=Mje(e);r&&(this._internalPlacement.setTranslate(r[0]+this._offsetX,r[1]+this._offsetY),i=!0)}break;case gC.BoundingBoxCenter:{const r=mB(e);r&&(this._internalPlacement.setTranslate((r[2]+r[0])/2+this._offsetX,(r[3]+r[1])/2+this._offsetY),i=!0)}break;case gC.OnPolygon:default:{const r=r_t(e);r!==null&&(this._internalPlacement.setTranslate(r[0]+this._offsetX,r[1]+this._offsetY),i=!0)}}return i?this._internalPlacement:null}};function l_t(t){if(!t)return null;switch(t.type){case"CIMGeometricEffectAddControlPoints":return WIe.local();case"CIMGeometricEffectArrow":return YIe.local();case"CIMGeometricEffectBuffer":return ZIe.local();case"CIMGeometricEffectControlMeasureLine":return XIe.local();case"CIMGeometricEffectCut":return JIe.local();case"CIMGeometricEffectDashes":return r3e.local();case"CIMGeometricEffectDonut":return s3e.local();case"CIMGeometricEffectJog":return n3e.local();case"CIMGeometricEffectMove":return o3e.local();case"CIMGeometricEffectOffset":return a3e.local();case"CIMGeometricEffectReverse":return l3e.local();case"CIMGeometricEffectRotate":return c3e.local();case"CIMGeometricEffectScale":return u3e.local();case"CIMGeometricEffectWave":return h3e.local()}return null}function c_t(t){if(!t)return null;switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":return d3e.local();case"CIMMarkerPlacementAtExtremities":return p3e.local();case"CIMMarkerPlacementAtRatioPositions":return f3e.local();case"CIMMarkerPlacementInsidePolygon":return m3e.local();case"CIMMarkerPlacementOnLine":return g3e.local();case"CIMMarkerPlacementOnVertices":return y3e.local();case"CIMMarkerPlacementPolygonCenter":return _3e.local()}return null}function EH(t){const e=t.getFrame(0);if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement)return e;const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const r=i.getContext("2d");return e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0),i}let u_t=class v3e{constructor(e=0,i=0,r=0,s=0){this.x=e,this.y=i,this.width=r,this.height=s}static fromExtent(e){return new v3e(e.xmin,-e.ymax,e.xmax-e.xmin,e.ymax-e.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}};function h_t(t){return`rgb(${t.slice(0,3).toString()})`}function CH(t){return`rgba(${t.slice(0,3).toString()},${t[3]})`}let b3e=class{constructor(e){e&&(this._textRasterizationCanvas=e)}rasterizeText(e,i){var H,z;this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const r=this._textRasterizationCanvas,s=r.getContext("2d",{willReadFrequently:!0});lF(s,i),this._parameters=i,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:n,weight:o}=i.font;this._lineThroughWidthOffset=n&&n==="line-through"?.1*this._lineHeight:0;const a=i.backgroundColor!=null||i.borderLine!=null,l=a?$Ke:0,c=this._computeTextWidth(s,i)+2*l,u=this._lineHeight*this._textLines.length+2*l;if(r.width=c+2*this._lineThroughWidthOffset,r.height=u,r.width===0||r.height===0)return r.width=r.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:r};this._renderedLineHeight=Math.round(this._lineHeight*i.pixelRatio),this._renderedHaloSize=_n(i.halo.size)*i.pixelRatio,this._renderedWidth=c*i.pixelRatio,this._renderedHeight=u*i.pixelRatio,this._lineThroughWidthOffset*=i.pixelRatio;const d=i.color??[0,0,0,0],p=i.halo&&i.halo.color?i.halo.color:[0,0,0,0];this._fillStyle=CH(d),this._haloStyle=h_t(p);const m=this._renderedLineHeight,g=this._renderedHaloSize;s.save(),s.clearRect(0,0,r.width,r.height),lF(s,i);const y=l*i.pixelRatio,v=d_t(s.textAlign,this._renderedWidth-2*y)+g+y,b=g+y,w=g>0;let x=this._lineThroughWidthOffset,T=0;if(a){s.save();const Z=i.backgroundColor??[0,0,0,0],q=((H=i.borderLine)==null?void 0:H.color)??[0,0,0,0],Y=2*_n(((z=i.borderLine)==null?void 0:z.size)??0);s.fillStyle=CH(Z),s.strokeStyle=CH(q),s.lineWidth=Y,s.fillRect(0,0,r.width,r.height),s.strokeRect(0,0,r.width,r.height),s.restore()}w&&this._renderHalo(s,v,b,x,T,i),T+=b,x+=v;for(const Z of this._textLines)w?(s.globalCompositeOperation="destination-out",s.fillStyle="rgb(0, 0, 0)",s.fillText(Z,x,T),s.globalCompositeOperation="source-over",s.fillStyle=this._fillStyle,s.fillText(Z,x,T)):(s.fillStyle=this._fillStyle,s.fillText(Z,x,T)),n&&n!=="none"&&this._renderDecoration(s,x,T,n,o),T+=m;s.restore();const C=this._renderedWidth+2*this._lineThroughWidthOffset,M=this._renderedHeight,O=s.getImageData(0,0,C,M),D=new Uint8Array(O.data);if(i.premultiplyColors){let Z;for(let q=0;q<D.length;q+=4)Z=D[q+3]/255,D[q]=D[q]*Z,D[q+1]=D[q+1]*Z,D[q+2]=D[q+2]*Z}let k,U;switch(i.horizontalAlignment){case"left":k=-.5;break;case"right":k=.5;break;default:k=0}switch(i.verticalAlignment){case"bottom":U=-.5;break;case"top":U=.5;break;case"baseline":U=-1/6;break;default:U=0}return{size:[C,M],image:new Uint32Array(D.buffer),sdf:!1,simplePattern:!1,anchorX:k,anchorY:U,canvas:r}}_renderHalo(e,i,r,s,n,o){const a=this._renderedWidth,l=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=a,this._haloRasterizationCanvas.height=l;const c=this._haloRasterizationCanvas,u=c.getContext("2d");u.clearRect(0,0,a,l),lF(u,o);const{decoration:d,weight:p}=o.font;u.fillStyle=this._haloStyle,u.strokeStyle=this._haloStyle,u.lineJoin="round",this._renderHaloNative(u,i,r,d,p),e.globalAlpha=this._parameters.halo.color[3],e.drawImage(c,0,0,a,l,s,n,a,l),e.globalAlpha=1}_renderHaloNative(e,i,r,s,n){const o=this._renderedLineHeight,a=this._renderedHaloSize;for(const l of this._textLines){const c=2*a,u=5,d=.1;for(let p=0;p<u;p++){const m=(1-(u-1)*d+p*d)*c;e.lineWidth=m,e.strokeText(l,i,r),s&&s!=="none"&&this._renderDecoration(e,i,r,s,n,m)}r+=o}}computeTextSize(e,i){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const r=this._textRasterizationCanvas,s=r.getContext("2d");lF(s,i),this._parameters=i,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const n=this._computeTextWidth(s,i),o=this._lineHeight*this._textLines.length;return r.width=n,r.height=o,[n*i.pixelRatio,o*i.pixelRatio]}_computeTextWidth(e,i){let r=0;for(const n of this._textLines)r=Math.max(r,e.measureText(n).width);const s=i.font;return(s.style==="italic"||s.style==="oblique"||typeof s.weight=="string"&&(s.weight==="bold"||s.weight==="bolder")||typeof s.weight=="number"&&s.weight>600)&&(r+=.3*e.measureText("w").width),r+=2*_n(this._parameters.halo.size),Math.round(r)}_computeLineHeight(){let e=1.275*this._parameters.size;const i=this._parameters.font.decoration;return i&&i==="underline"&&(e*=1.3),Math.round(e+2*_n(this._parameters.halo.size))}_renderDecoration(e,i,r,s,n,o){const a=.9*this._lineHeight,l=n==="bold"?.06:n==="bolder"?.09:.04;switch(e.textAlign){case"center":i-=this._renderedWidth/2;break;case"right":i-=this._renderedWidth}const c=e.textBaseline;if(s==="underline")switch(c){case"top":r+=a;break;case"middle":r+=a/2}else if(s==="line-through")switch(c){case"top":r+=a/1.5;break;case"middle":r+=a/3}const u=o?1.5*o:Math.ceil(a*l);e.save(),e.beginPath(),e.strokeStyle=e.fillStyle,e.lineWidth=u,e.moveTo(i-this._lineThroughWidthOffset,r),e.lineTo(i+this._renderedWidth+2*this._lineThroughWidthOffset,r),e.stroke(),e.restore()}};function lF(t,e){const i=Math.max(e.size,.5),r=e.font,s=`${r.style} ${r.weight} ${_n(i*e.pixelRatio).toFixed(1)}px ${r.family}, sans-serif`;let n;switch(t.font=s,t.textBaseline="top",e.horizontalAlignment){case"left":default:n="left";break;case"right":n="right";break;case"center":n="center"}t.textAlign=n}function d_t(t,e){return t==="center"?.5*e:t==="right"?e:0}const aZt=512,lZt=29,cZt=24;var Hfe;(function(t){t[t.FilterFlags=0]="FilterFlags",t[t.Animation=1]="Animation",t[t.GPGPU=2]="GPGPU",t[t.VV=3]="VV",t[t.DD0=4]="DD0",t[t.DD1=5]="DD1",t[t.DD2=6]="DD2"})(Hfe||(Hfe={}));const p_t=1.05,uZt=5,hZt=6,dZt=1.15,pZt=2,fZt=10,f_t=1024,mZt=256,gZt=32,yZt=512;function m_t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function g_t(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function y_t(t,e,i,r,s,n,o){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t}function __t(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=i*n-r*s;return l?(l=1/l,t[0]=n*l,t[1]=-r*l,t[2]=-s*l,t[3]=i*l,t[4]=(s*a-n*o)*l,t[5]=(r*o-i*a)*l,t):null}function v_t(t){return t[0]*t[3]-t[1]*t[2]}function w3e(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1],d=i[2],p=i[3],m=i[4],g=i[5];return t[0]=r*c+n*u,t[1]=s*c+o*u,t[2]=r*d+n*p,t[3]=s*d+o*p,t[4]=r*m+n*g+a,t[5]=s*m+o*g+l,t}function b_t(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(i),u=Math.cos(i);return t[0]=r*u+n*c,t[1]=s*u+o*c,t[2]=r*-c+n*u,t[3]=s*-c+o*u,t[4]=a,t[5]=l,t}function w_t(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1];return t[0]=r*c,t[1]=s*c,t[2]=n*u,t[3]=o*u,t[4]=a,t[5]=l,t}function x_t(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=r*c+n*u+a,t[5]=s*c+o*u+l,t}function S_t(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t}function T_t(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function E_t(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function C_t(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function M_t(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function A_t(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t}function x3e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}function P_t(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t}function O_t(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t}function R_t(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function $_t(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=e[0],c=e[1],u=e[2],d=e[3],p=e[4],m=e[5],g=Lo();return Math.abs(i-l)<=g*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=g*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-u)<=g*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(n-d)<=g*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-p)<=g*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-m)<=g*Math.max(1,Math.abs(a),Math.abs(m))}const I_t=w3e,L_t=x3e;Object.freeze(Object.defineProperty({__proto__:null,add:A_t,copy:m_t,determinant:v_t,equals:$_t,exactEquals:R_t,frob:M_t,fromRotation:S_t,fromScaling:T_t,fromTranslation:E_t,identity:g_t,invert:__t,mul:I_t,multiply:w3e,multiplyScalar:P_t,multiplyScalarAndAdd:O_t,rotate:b_t,scale:w_t,set:y_t,str:C_t,sub:L_t,subtract:x3e,translate:x_t},Symbol.toStringTag,{value:"Module"}));function D_t(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function N_t(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function F_t(t,e,i,r,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function k_t(t,e){return new Float32Array(t,e,6)}function S3e(t,e,i,r){const s=e[r],n=e[r+1];t[r]=i[0]*s+i[2]*n+i[4],t[r+1]=i[1]*s+i[3]*n+i[5]}function U_t(t,e,i,r=0,s=0,n=2){const o=s||e.length/n;for(let a=r;a<o;a++)S3e(t,e,i,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:N_t,create:D_t,createView:k_t,fromValues:F_t,transform:S3e,transformMany:U_t},Symbol.toStringTag,{value:"Module"}));const z_t=()=>ie.getLogger("esri.views.2d.engine.webgl.alignmentUtils");var Ym,rf;function _Zt(t){if(!t)return Ym.Center;switch(t){case"Left":case"left":return Ym.Left;case"Right":case"right":return Ym.Right;case"Justify":return z_t().warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),Ym.Center;case"Center":case"center":return Ym.Center}}function vZt(t){if(!t)return rf.Center;switch(t){case"Top":case"top":return rf.Top;case"Center":case"middle":return rf.Center;case"Baseline":case"baseline":return rf.Baseline;case"Bottom":case"bottom":return rf.Bottom}}function bZt(t){switch(t){case Ym.Right:case"right":return-1;case Ym.Center:case"center":return 0;case Ym.Left:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${t}`),0}}function wZt(t){switch(t){case rf.Top:case"top":return 1;case rf.Center:case"middle":return 0;case rf.Bottom:case rf.Baseline:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${t}`),0}}(function(t){t[t.Left=-1]="Left",t[t.Center=0]="Center",t[t.Right=1]="Right"})(Ym||(Ym={})),function(t){t[t.Top=1]="Top",t[t.Center=0]="Center",t[t.Bottom=-1]="Bottom",t[t.Baseline=2]="Baseline"}(rf||(rf={}));const Lx=Math.PI/180,T3e=.5,V_t=()=>ie.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");let ex=class Tm{constructor(e){this._t=e}static createIdentity(){return new Tm([1,0,0,0,1,0])}clone(){const e=this._t;return new Tm(e.slice())}transform(e){const i=this._t;return[i[0]*e[0]+i[1]*e[1]+i[2],i[3]*e[0]+i[4]*e[1]+i[5]]}static createScale(e,i){return new Tm([e,0,0,0,i,0])}scale(e,i){const r=this._t;return r[0]*=e,r[1]*=e,r[2]*=e,r[3]*=i,r[4]*=i,r[5]*=i,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(e,i){return new Tm([0,0,e,0,0,i])}translate(e,i){const r=this._t;return r[2]+=e,r[5]+=i,this}static createRotate(e){const i=Math.cos(e),r=Math.sin(e);return new Tm([i,-r,0,r,i,0])}rotate(e){return Tm.multiply(this,Tm.createRotate(e),this)}angle(){const e=this._t[0],i=this._t[3],r=Math.sqrt(e*e+i*i);return[e/r,i/r]}static multiply(e,i,r){const s=e._t,n=i._t,o=s[0]*n[0]+s[3]*n[1],a=s[1]*n[0]+s[4]*n[1],l=s[2]*n[0]+s[5]*n[1]+n[2],c=s[0]*n[3]+s[3]*n[4],u=s[1]*n[3]+s[4]*n[4],d=s[2]*n[3]+s[5]*n[4]+n[5],p=r._t;return p[0]=o,p[1]=a,p[2]=l,p[3]=c,p[4]=u,p[5]=d,r}invert(){const e=this._t;let i=e[0]*e[4]-e[1]*e[3];if(i===0)return new Tm([0,0,0,0,0,0]);i=1/i;const r=(e[1]*e[5]-e[2]*e[4])*i,s=(e[2]*e[3]-e[0]*e[5])*i,n=e[4]*i,o=-e[1]*i,a=-e[3]*i,l=e[0]*i;return new Tm([n,o,r,a,l,s])}},E3e=class{constructor(e,i){this._resourceManager=e,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new Ca(iP,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(i||ex.createIdentity()),this._sizeTransfos.push(i?i.scaleRatio():1)}setTransform(e,i){this._transfos=[e||ex.createIdentity()],this._sizeTransfos=[i||(e?e.scaleRatio():1)]}setGeomUnitsPerPoint(e){this._geomUnitsPerPoint=e}transformPt(e){return this._transfos[this._transfos.length-1].transform(e)}transformSize(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(e){return this._transfos[this._transfos.length-1].invert().transform(e)}reverseTransformSize(e){return e/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(e){return e/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(e,i){const r=i?e.scaleRatio():1;ex.multiply(e,this.back(),e),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*r)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(e,i,r){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,i);break;case"CIMTextSymbol":this.drawTextSymbol(e,i,r)}}drawMultiLayerSymbol(e,i){if(!e||!i)return;const r=e.symbolLayers;if(!r)return;const s=e.effects;if(s&&s.length>0){const n=this.executeEffects(s,i);if(n){let o=n.next();for(;o;)this.drawSymbolLayers(r,o.asJSON()),o=n.next()}}else this.drawSymbolLayers(r,i)}executeEffects(e,i){const r=this._resourceManager.geometryEngine;let s=new a0t(Xn.fromJSONCIM(i));for(const n of e){const o=l_t(n);o&&(s=o.execute(s,n,this.geomUnitsPerPoint(),null,r))}return s}drawSymbolLayers(e,i){let r=e.length;for(;r--;){const s=e[r];if(!s||s.enable===!1)continue;const n=s.effects;if(n&&n.length>0){const o=this.executeEffects(n,i);if(o){let a=null;for(;(a=o.next())&&(this.drawSymbolLayer(s,a.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(s,i);if(this._earlyReturn)return}}drawSymbolLayer(e,i){switch(e.type){case"CIMSolidFill":this.drawSolidFill(i,e.color);break;case"CIMHatchFill":this.drawHatchFill(i,e);break;case"CIMPictureFill":this.drawPictureFill(i,e);break;case"CIMGradientFill":this.drawGradientFill(i,e);break;case"CIMSolidStroke":this.drawSolidStroke(i,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit);break;case"CIMPictureStroke":this.drawPictureStroke(i,e);break;case"CIMGradientStroke":this.drawGradientStroke(i,e);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,i)}}drawHatchFill(e,i){const r=j_t(i,e,this.geomUnitsPerPoint());r&&(this.pushClipPath(e),this.drawMultiLayerSymbol(i.lineSymbol,r),this.popClipPath())}drawPictureFill(e,i){}drawGradientFill(e,i){}drawPictureStroke(e,i){}drawGradientStroke(e,i){}drawMarkerLayer(e,i){const r=e.markerPlacement;if(r){const s=c_t(r);if(s){const n=r.type==="CIMMarkerPlacementInsidePolygon"||r.type==="CIMMarkerPlacementPolygonCenter"&&r.clipAtBoundary;n&&this.pushClipPath(i);const o=s.execute(Xn.fromJSONCIM(i),r,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(o){let a=null;for(;(a=o.next())&&(this.drawMarker(e,a),!this._earlyReturn););}n&&this.popClipPath()}}else{const s=this._placementPool.acquire();if(IM(i))s.tx=i.x,s.ty=i.y,this.drawMarker(e,s);else if(Ll(i)){const n=fwe(i);n&&([s.tx,s.ty]=n,this.drawMarker(e,s))}else for(const n of i.points)if(s.tx=n[0],s.ty=n[1],this.drawMarker(e,s),this._earlyReturn)break;this._placementPool.release(s)}}drawMarker(e,i){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,i);break;case"CIMVectorMarker":this.drawVectorMarker(e,i)}}drawPictureMarker(e,i){if(!e)return;const r=this._resourceManager.getResource(e.url),s=$i(e.size,lM.CIMPictureMarker.size);if(r==null||s<=0)return;const n=r.width,o=r.height;if(!n||!o)return;const a=n/o,l=$i(e.scaleX,1),c=ex.createIdentity(),u=e.anchorPoint;if(u){let v=u.x,b=u.y;e.anchorPointUnits!=="Absolute"&&(v*=s*a*l,b*=s),c.translate(-v,-b)}let d=$i(e.rotation);e.rotateClockwise&&(d=-d),this._mapRotation&&(d+=this._mapRotation),d&&c.rotate(d*Lx);let p=$i(e.offsetX),m=$i(e.offsetY);if(p||m){if(this._mapRotation){const v=Lx*this._mapRotation,b=Math.cos(v),w=Math.sin(v),x=p*w+m*b;p=p*b-m*w,m=x}c.translate(p,m)}const g=this.geomUnitsPerPoint();g!==1&&c.scale(g,g);const y=i.getAngle();y&&c.rotate(y),c.translate(i.tx,i.ty),this.push(c,!1),this.drawImage(e,s),this.pop()}drawVectorMarker(e,i){if(!e)return;const r=e.markerGraphics;if(!r)return;const s=$i(e.size,lM.CIMVectorMarker.size),n=e.frame,o=n?n.ymax-n.ymin:0,a=s&&o?s/o:1,l=ex.createIdentity();n&&l.translate(.5*-(n.xmax+n.xmin),.5*-(n.ymax+n.ymin));const c=e.anchorPoint;if(c){let y=c.x,v=c.y;e.anchorPointUnits!=="Absolute"?n&&(y*=n.xmax-n.xmin,v*=n.ymax-n.ymin):(y/=a,v/=a),l.translate(-y,-v)}a!==1&&l.scale(a,a);let u=$i(e.rotation);e.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*Lx);let d=$i(e.offsetX),p=$i(e.offsetY);if(d||p){if(this._mapRotation){const y=Lx*this._mapRotation,v=Math.cos(y),b=Math.sin(y),w=d*b+p*v;d=d*v-p*b,p=w}l.translate(d,p)}const m=this.geomUnitsPerPoint();m!==1&&l.scale(m,m);const g=i.getAngle();g&&l.rotate(g),l.translate(i.tx,i.ty),this.push(l,e.scaleSymbolsProportionally);for(const y of r){y!=null&&y.symbol&&y.geometry||V_t().error("Invalid marker graphic",y);let v=y.textString;if(typeof v=="number"&&(v=v.toString()),this.drawSymbol(y.symbol,y.geometry,v),this._earlyReturn)break}this.pop()}drawTextSymbol(e,i,r){if(!e||!IM(i)||$i(e.height,lM.CIMTextSymbol.height)<=0)return;const s=ex.createIdentity();let n=$i(e.angle);n=-n,n&&s.rotate(n*Lx);const o=$i(e.offsetX),a=$i(e.offsetY);(o||a)&&s.translate(o,a);const l=this.geomUnitsPerPoint();l!==1&&s.scale(l,l),s.translate(i.x,i.y),this.push(s,!1),this.drawText(e,r),this.pop()}},B_t=class extends E3e{constructor(e,i){super(e,i),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new u_t(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return Z3(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(e){if(e&&!(this._clipCount>0))if(Ll(e))this._processPath(e.rings,0);else if(Kp(e))this._processPath(e.paths,0);else if(Qp(e)){const i=Dx(e);i&&this._processPath(i.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(e,i,r){if(!e||this._clipCount>0||r==null||r<=0)return;const s=Math.max(.5*this.transformSize($i(r,lM.CIMSolidStroke.width)),.5*T3e);if(Ll(e))this._processPath(e.rings,s);else if(Kp(e))this._processPath(e.paths,s);else if(Qp(e)){const n=Dx(e);n&&this._processPath(n.rings,s)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(e,i){Ll(i)&&e.markerPlacement&&(e.markerPlacement.type==="CIMMarkerPlacementInsidePolygon"||e.markerPlacement.type==="CIMMarkerPlacementPolygonCenter"&&e.markerPlacement.clipAtBoundary)?this._processPath(i.rings,0):super.drawMarkerLayer(e,i)}drawHatchFill(e,i){this.drawSolidFill(e)}drawPictureFill(e,i){this.drawSolidFill(e)}drawGradientFill(e,i){this.drawSolidFill(e)}drawPictureStroke(e,i){this.drawSolidStroke(e,null,i.width)}drawGradientStroke(e,i){this.drawSolidStroke(e,null,i.width)}pushClipPath(e){this.drawSolidFill(e),this._clipCount++}popClipPath(){this._clipCount--}drawImage(e,i){const{url:r}=e,s=$i(e.scaleX,1);let n=s*i,o=i;const a=this._resourceManager.getResource(r);if(a!=null){const l=a.height/a.width;n=s*(i?l>1?i:i/l:a.width),o=i?l>1?i*l:i:a.height}this._merge(this.transformPt([-n/2,-o/2]),0),this._merge(this.transformPt([-n/2,o/2]),0),this._merge(this.transformPt([n/2,-o/2]),0),this._merge(this.transformPt([n/2,o/2]),0)}drawText(e,i){if(!i||i.length===0)return;this._textRasterizer||(this._textRasterizer=new b3e);const r=C3e(e);let[s,n]=this._textRasterizer.computeTextSize(i,r);s=Do(s),n=Do(n);let o=0;switch(e.horizontalAlignment){case"Left":o=s/2;break;case"Right":o=-s/2}let a=0;switch(e.verticalAlignment){case"Bottom":a=n/2;break;case"Top":a=-n/2;break;case"Baseline":a=n/6}this._merge(this.transformPt([-s/2+o,-n/2+a]),0),this._merge(this.transformPt([-s/2+o,n/2+a]),0),this._merge(this.transformPt([s/2+o,-n/2+a]),0),this._merge(this.transformPt([s/2+o,n/2+a]),0)}_processPath(e,i){if(e)for(const r of e){const s=r?r.length:0;if(s>1){this._merge(this.transformPt(r[0]),i);for(let n=1;n<s;n++)this._merge(this.transformPt(r[n]),i)}}}_merge(e,i){e[0]-i<this._xmin&&(this._xmin=e[0]-i),e[0]+i>this._xmax&&(this._xmax=e[0]+i),e[1]-i<this._ymin&&(this._ymin=e[1]-i),e[1]+i>this._ymax&&(this._ymax=e[1]+i)}},G_t=class extends E3e{constructor(e,i,r,s){super(i,r),this._applyAdditionalRenderProps=s,this._colorSubstitutionHelper=new l0t,this._ctx=e}drawSolidFill(e,i){if(!e)return;if(Ll(e))this._buildPath(e.rings,!0);else if(Kp(e))this._buildPath(e.paths,!0);else if(Qp(e))this._buildPath(Dx(e).rings,!0);else{if(!uS(e))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const r=this._ctx;r.fillStyle=typeof i=="string"?i:"rgba("+Math.round(i[0])+","+Math.round(i[1])+","+Math.round(i[2])+","+(i[3]??255)/255+")",r.fill("evenodd")}drawSolidStroke(e,i,r,s,n,o){if(!e||!i||r===0)return;if(Ll(e))this._buildPath(e.rings,!0);else if(Kp(e))this._buildPath(e.paths,!1);else{if(!Qp(e))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(Dx(e).rings,!0)}const a=this._ctx;a.strokeStyle=typeof i=="string"?i:"rgba("+Math.round(i[0])+","+Math.round(i[1])+","+Math.round(i[2])+","+(i[3]??255)/255+")",a.lineWidth=Math.max(this.transformSize(r),T3e),this._setCapStyle(s),this._setJoinStyle(n),a.miterLimit=o,a.stroke()}pushClipPath(e){if(this._ctx.save(),Ll(e))this._buildPath(e.rings,!0);else if(Kp(e))this._buildPath(e.paths,!0);else{if(!Qp(e))return;this._buildPath(Dx(e).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(e,i){const{colorSubstitutions:r,url:s,tintColor:n}=e,o=$i(e.scaleX,1),a=this._resourceManager.getResource(s);if(a==null)return;let l=i*(a.width/a.height),c=i;i||(l=a.width,c=a.height);const u=_2(s)||"src"in a&&_2(a.src);let d="getFrame"in a?EH(a):a;r&&(d=this._colorSubstitutionHelper.applyColorSubstituition(d,r)),this._applyAdditionalRenderProps&&!u&&n&&(d=this._colorSubstitutionHelper.tintImageData(d,n));const p=this.transformPt([0,0]),[m,g]=this.getTransformAngle(),y=this.transformSize(1),v=this._ctx;v.save(),v.setTransform({m11:o*y*m,m12:o*y*g,m21:-y*g,m22:y*m,m41:p[0],m42:p[1]}),v.drawImage(d,-l/2,-c/2,l,c),v.restore()}drawText(e,i){if(!i||i.length===0)return;this._textRasterizer||(this._textRasterizer=new b3e);const r=C3e(e);r.size*=this.transformSize(Do(1));const s=this._textRasterizer.rasterizeText(i,r);if(!s)return;const{size:n,anchorX:o,anchorY:a,canvas:l}=s,c=n[0]*(o+.5),u=n[1]*(a-.5),d=this._ctx,p=this.transformPt([0,0]),[m,g]=this.getTransformAngle(),y=1;d.save(),d.setTransform({m11:y*m,m12:y*g,m21:-y*g,m22:y*m,m41:p[0]-y*c,m42:p[1]+y*u}),d.drawImage(l,0,0),d.restore()}drawPictureFill(e,i){if(!e)return;let{colorSubstitutions:r,height:s,offsetX:n,offsetY:o,rotation:a,scaleX:l,tintColor:c,url:u}=i;const d=this._resourceManager.getResource(u);if(d==null)return;if(Ll(e))this._buildPath(e.rings,!0);else if(Kp(e))this._buildPath(e.paths,!0);else if(Qp(e))this._buildPath(Dx(e).rings,!0);else{if(!uS(e))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const p=this._ctx,m=_2(u)||"src"in d&&_2(d.src);let g,y="getFrame"in d?EH(d):d;if(r&&(y=this._colorSubstitutionHelper.applyColorSubstituition(y,r)),this._applyAdditionalRenderProps){m||c&&(y=this._colorSubstitutionHelper.tintImageData(y,c)),g=p.createPattern(y,"repeat");const v=this.transformSize(1);a||(a=0),n?n*=v:n=0,o?o*=v:o=0,s&&(s*=v);const b=s?s/d.height:1,w=l&&s?l*s/d.width:1;if(a!==0||b!==1||w!==1||n!==0||o!==0){const x=new DOMMatrix;x.rotateSelf(0,0,-a).translateSelf(n,o).scaleSelf(w,b,1),g.setTransform(x)}}else g=p.createPattern(y,"repeat");p.save(),p.fillStyle=g,p.fill("evenodd"),p.restore()}drawPictureStroke(e,i){if(!e)return;let{colorSubstitutions:r,capStyle:s,joinStyle:n,miterLimit:o,tintColor:a,url:l,width:c}=i;const u=this._resourceManager.getResource(l);if(u==null)return;let d;if(Ll(e))d=e.rings;else if(Kp(e))d=e.paths;else{if(!Qp(e))return uS(e)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;d=Dx(e).rings}c||(c=u.width);const p=_2(l)||"src"in u&&_2(u.src);let m="getFrame"in u?EH(u):u;r&&(m=this._colorSubstitutionHelper.applyColorSubstituition(m,r)),this._applyAdditionalRenderProps&&(p||a&&(m=this._colorSubstitutionHelper.tintImageData(m,a)));const g=Math.max(this.transformSize(_n(c)),.5),y=g/m.width,v=this._ctx,b=v.createPattern(m,"repeat-y");let w,x;v.save(),this._setCapStyle(s),this._setJoinStyle(n),o!==void 0&&(v.miterLimit=o),v.lineWidth=g;for(let T of d)if(T=Q(T),W_t(T),T&&!(T.length<=1)){w=this.transformPt(T[0]);for(let C=1;C<T.length;C++){x=this.transformPt(T[C]);const M=H_t(w,x),O=new DOMMatrix;O.translateSelf(0,w[1]-g/2).scaleSelf(y,y,1).rotateSelf(0,0,90-M),b.setTransform(O),v.strokeStyle=b,v.beginPath(),v.moveTo(w[0],w[1]),v.lineTo(x[0],x[1]),v.stroke(),w=x}}v.restore()}_buildPath(e,i){const r=this._ctx;if(r.beginPath(),e)for(const s of e){const n=s?s.length:0;if(n>1){let o=this.transformPt(s[0]);r.moveTo(o[0],o[1]);for(let a=1;a<n;a++)o=this.transformPt(s[a]),r.lineTo(o[0],o[1]);i&&r.closePath()}}}_setCapStyle(e){switch(e){case Id.Butt:this._ctx.lineCap="butt";break;case Id.Round:this._ctx.lineCap="round";break;case Id.Square:this._ctx.lineCap="square"}}_setJoinStyle(e){switch(e){case sg.Bevel:this._ctx.lineJoin="bevel";break;case sg.Round:this._ctx.lineJoin="round";break;case sg.Miter:this._ctx.lineJoin="miter"}}};function j_t(t,e,i){let r=$i(t.separation,lM.CIMHatchFill.separation)*i,s=$i(t.rotation);if(r===0)return null;r<0&&(r=-r);let n=0;const o=.5*r;for(;n>o;)n-=r;for(;n<-o;)n+=r;const a=Ht();Lje(a,e),a[0]-=o,a[1]-=o,a[2]+=o,a[3]+=o;const l=[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]];for(;s>180;)s-=180;for(;s<0;)s+=180;const c=Math.cos(s*Lx),u=Math.sin(s*Lx),d=-r*u,p=r*c;let m,g,y,v;n=$i(t.offsetX)*i*u-$i(t.offsetY)*i*c,m=y=Number.MAX_VALUE,g=v=-Number.MAX_VALUE;for(const O of l){const D=O[0],k=O[1],U=c*D+u*k,H=-u*D+c*k;m=Math.min(m,U),y=Math.min(y,H),g=Math.max(g,U),v=Math.max(v,H)}y=Math.floor(y/r)*r;let b=c*m-u*y-d*n/r,w=u*m+c*y-p*n/r,x=c*g-u*y-d*n/r,T=u*g+c*y-p*n/r;const C=1+Math.round((v-y)/r),M=[];for(let O=0;O<C;O++)b+=d,w+=p,x+=d,T+=p,M.push([[b,w],[x,T]]);return{paths:M}}function H_t(t,e){const i=e[0]-t[0],r=e[1]-t[1];return 180/Math.PI*Math.atan2(r,i)}const Dx=t=>t?{spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:null;function C3e(t,e=1){var b;const i=e3e(t),r=KIe(t.fontStyleName),s=t.fontFamilyName??rse,{weight:n,style:o}=r,a=e*(t.height||5),l=O0t(t.horizontalAlignment),c=R0t(t.verticalAlignment),u=cI(t),d=cI(t.haloSymbol),p=d!=null?e*(t.haloSize??0):0,m=((b=t.callout)==null?void 0:b.type)==="CIMBackgroundCallout"?t.callout.backgroundSymbol:null,g=cI(m),y=BX(m),v=VX(m);return{color:u,size:a,horizontalAlignment:l,verticalAlignment:c,font:{family:s,style:A0t(o),weight:P0t(n),decoration:i},halo:{size:p||0,color:d,style:o},backgroundColor:g,borderLine:y!=null&&v!=null?{size:y,color:v}:null,pixelRatio:1,premultiplyColors:!0}}const q_t=1e-4;function W_t(t){let e,i,r,s,n,o=t[0],a=1;for(;a<t.length;)e=t[a][0]-o[0],i=t[a][1]-o[1],s=e!==0?i/e:Math.PI/2,r!==void 0&&s-r<=q_t?(t.splice(a-1,1),o=n):(n=o,o=t[a],a++),r=s}const nse=[252,146,31,255],Y_t=[153,153,153,255],Z_t={type:"esriSMS",style:"esriSMSCircle",size:6,color:nse,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},X_t={type:"esriSLS",style:"esriSLSSolid",width:.75,color:nse},J_t={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},Q_t={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},K_t={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},evt={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},tvt={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},M3e=kf.fromJSON(Z_t),ose=Mu.fromJSON(X_t),A3e=db.fromJSON(J_t),ivt=qA.fromJSON(Q_t);function EZt(t){if(t==null)return null;switch(t.type){case"mesh":return null;case"point":case"multipoint":return M3e;case"polyline":return ose;case"polygon":case"extent":return A3e}return null}kf.fromJSON(K_t);Mu.fromJSON(evt);db.fromJSON(tvt);const CZt=Number.POSITIVE_INFINITY,ase=Math.PI,MZt=2*ase,rvt=128/ase,svt=256/360,AZt=ase/180,nvt=1/Math.LN2;function P3e(t,e){return(t%=e)>=0?t:t+e}function PZt(t){return P3e(t*rvt,256)}function OZt(t){return P3e(t*svt,256)}function RZt(t){return Math.log(t)*nvt}function uc(t,e,i){return t*(1-i)+e*i}const ovt=8,avt=14,lvt=16;function $Zt(t){return ovt+Math.max((t-avt)*lvt,0)}function cvt(t,e,i){let r,s,n,o=0;for(const a of i){r=a.length;for(let l=1;l<r;++l)s=a[l-1],n=a[l],s.y>e!=n.y>e&&((n.x-s.x)*(e-s.y)-(n.y-s.y)*(t-s.x)>0?o++:o--)}return o!==0}function O3e(t,e,i,r){let s,n,o,a;const l=r*r;for(const c of i){const u=c.length;if(!(u<2)){s=c[0].x,n=c[0].y;for(let d=1;d<u;++d){if(o=c[d].x,a=c[d].y,_je(t,e,s,n,o,a)<l)return!0;s=o,n=a}}}return!1}function uvt(t,e,i,r,s,n,o){const a=Math.max(r,Math.min(e,n))-e,l=Math.max(s,Math.min(i,o))-i;return a*a+l*l<=t*t}function hvt(t,e){if(e===0||Number.isNaN(e))return t;const i=[],r=new Ba(0,0),s=new Ba(0,0),n=new Ba(0,0);for(let o=0;o<t.length;o++){const a=t[o],l=[];for(let c=0;c<a.length;c++){const u=a[c-1],d=a[c],p=a[c+1];c===0?r.setCoords(0,0):r.assignSub(d,u).normalize().rightPerpendicular(),c===a.length-1?s.setCoords(0,0):s.assignSub(p,d).normalize().rightPerpendicular(),n.assignAdd(r,s).normalize();const m=n.x*s.x+n.y*s.y;m!==0&&n.scale(1/m),l.push(Ba.add(d,n.scale(e)))}i.push(l)}return i}function lse(t,e,i,r){const s=new Ba(t[0],t[1]);if(s.scale(r),e==="viewport"){const n=-i*(Math.PI/180),o=Math.cos(n),a=Math.sin(n);s.rotate(o,a)}return s}const R3e=Math.PI,dvt=R3e/2,Qf=96/72,qfe=4,pV=()=>ie.getLogger("esri.symbols.cim.CIMSymbolHelper");function q5(t,e,i){switch(e.type){case"CIMSymbolReference":return q5(t,e.symbol,i);case"CIMPointSymbol":i==null&&(i={x:0,y:0}),t.drawSymbol(e,i);break;case"CIMLineSymbol":i==null&&(i={paths:[[[0,0],[10,0]]]}),t.drawSymbol(e,i);break;case"CIMPolygonSymbol":i==null&&(i={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),t.drawSymbol(e,i);break;case"CIMTextSymbol":{const r={x:0,y:0};t.drawSymbol(e,r);break}case"CIMVectorMarker":{const r=new iP;t.drawMarker(e,r);break}}return t.envelope()}function pvt(t){if(!t)return 0;switch(t.type){case"CIMGeometricEffectArrow":return Math.abs(.5*t.width);case"CIMGeometricEffectBuffer":return Math.abs(t.size);case"CIMGeometricEffectControlMeasureLine":return 500;case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(t.length);case"CIMGeometricEffectJog":return Math.abs(.5*t.length);case"CIMGeometricEffectMove":return Math.max(Math.abs($i(t.offsetX)),Math.abs($i(t.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(t.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(t.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return .5*Math.max(Math.abs(t.fromWidth),Math.abs(t.toWidth));case"CIMGeometricEffectWave":return Math.abs(t.amplitude);case"CIMGeometricEffectDonut":return Math.abs(t.width)}}function IZt(t){if(!t)return 0;let e=0;for(const i of t)e+=pvt(i);return e}let MH=class W5{static getEnvelope(e,i,r){if(!e)return null;const s=new B_t(r);if(Array.isArray(e)){let n;for(const o of e)n?n.union(q5(s,o,i)):n=q5(s,o,i);return n}return q5(s,e,i)}static getTextureAnchor(e,i){const r=this.getEnvelope(e,null,i);if(!r)return[0,0,0];const s=(r.x+.5*r.width)*Qf,n=(r.y+.5*r.height)*Qf,o=r.width*Qf+2,a=r.height*Qf+2;return[-s/o,-n/a,a]}static rasterize(e,i,r,s,n=!0){const o=r||this.getEnvelope(i,null,s);if(!o)return[null,0,0,0,0];const a=(o.x+.5*o.width)*Qf,l=(o.y+.5*o.height)*Qf;e.width=o.width*Qf,e.height=o.height*Qf,r||(e.width+=2,e.height+=2);const c=e.getContext("2d",{willReadFrequently:!0}),u=ex.createScale(Qf,-Qf);u.translate(.5*e.width-a,.5*e.height+l);const d=new G_t(c,s,u);switch(i.type){case"CIMPointSymbol":{const g={type:"point",x:0,y:0};d.drawSymbol(i,g);break}case"CIMVectorMarker":{const g=new iP;d.drawMarker(i,g);break}}const p=c.getImageData(0,0,e.width,e.height),m=new Uint8Array(p.data);if(n){let g;for(let y=0;y<m.length;y+=4)g=m[y+3]/255,m[y]=m[y]*g,m[y+1]=m[y+1]*g,m[y+2]=m[y+2]*g}return[m,e.width,e.height,-a/e.width,-l/e.height]}static fromTextSymbol(e){const{text:i}=e;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:W5.createCIMTextSymbolfromTextSymbol(e),textString:i}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(e){const{height:i,outline:r,width:s,xoffset:n,xscale:o,yoffset:a,yscale:l}=e,c=[],u={type:"CIMPolygonSymbol",symbolLayers:c};if(r){const y=Wfe(r);y&&c.push(y)}let d=e.url;e.type==="esriPFS"&&e.imageData&&(d=e.imageData);const p="angle"in e?e.angle??0:0,m=(s??0)*(o||1),g=(i??0)*(l||1);return c.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:yC.Picture,tintColor:null,url:d,height:g,width:m,offsetX:$i(n),offsetY:$i(a),rotation:$i(-p),colorSubstitutions:null}),u}static fromSimpleFillSymbol(e){const{color:i,style:r,outline:s}=e,n=[],o={type:"CIMPolygonSymbol",symbolLayers:n};if(s){const a=Wfe(s);a&&n.push(a)}if(r&&r!=="solid"&&r!=="none"&&r!=="esriSFSSolid"&&r!=="esriSFSNull"){const a={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:ju(i),capStyle:Id.Butt,joinStyle:sg.Miter,width:.75}]};let l=0;const c=Do(vvt(r)?8:10);switch(r){case"vertical":case"esriSFSVertical":l=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":l=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":l=45;break;case"cross":case"esriSFSCross":l=0}n.push({type:"CIMHatchFill",lineSymbol:a,offsetX:0,offsetY:0,rotation:l,separation:c}),r==="cross"||r==="esriSFSCross"?n.push({type:"CIMHatchFill",lineSymbol:Q(a),offsetX:0,offsetY:0,rotation:90,separation:c}):r!=="diagonal-cross"&&r!=="esriSFSDiagonalCross"||n.push({type:"CIMHatchFill",lineSymbol:Q(a),offsetX:0,offsetY:0,rotation:45,separation:c})}else!r||r!=="solid"&&r!=="esriSFSSolid"||n.push({type:"CIMSolidFill",enable:!0,color:ju(i)});return o}static fromSimpleLineSymbol(e){const{cap:i,color:r,join:s,marker:n,miterLimit:o,style:a,width:l}=e;let c=null;a!=="solid"&&a!=="none"&&a!=="esriSLSSolid"&&a!=="esriSLSNull"&&(c=[{type:"CIMGeometricEffectDashes",dashTemplate:jX(a,i),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const u=[];if(n){let d;switch(n.placement){case"begin-end":d=rg.Both;break;case"begin":d=rg.JustBegin;break;case"end":d=rg.JustEnd;break;default:d=rg.None}const p=W5.fromSimpleMarker(n,l,r).symbolLayers[0];p.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:d,offsetAlongLine:0},u.push(p)}return u.push({type:"CIMSolidStroke",color:a!=="none"&&a!=="esriSLSNull"?ju(r):[0,0,0,0],capStyle:I3e(i),joinStyle:L3e(s),miterLimit:o,width:l,effects:c}),{type:"CIMLineSymbol",symbolLayers:u}}static fromPictureMarker(e){const{angle:i,height:r,width:s,xoffset:n,yoffset:o}=e;let a=e.url;return e.type==="esriPMS"&&e.imageData&&(a=e.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:yC.Picture,tintColor:null,url:a,size:r,width:s,offsetX:$i(n),offsetY:$i(o),rotation:$i(-i)}]}}static createCIMTextSymbolfromTextSymbol(e){const{angle:i,color:r,font:s,haloColor:n,haloSize:o,horizontalAlignment:a,kerning:l,lineWidth:c,text:u,verticalAlignment:d,xoffset:p,yoffset:m,backgroundColor:g,borderLineColor:y,borderLineSize:v}=e;let b,w,x,T,C,M;s&&(b=s.family,w=s.style,x=s.weight,T=s.size,C=s.decoration);let O=!1;return u&&(O=Zyt(u)[1]),(g||v)&&(M={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:ju(g)},{type:"CIMSolidStroke",color:ju(y),width:v}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:i,blockProgression:FX.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:LX.Normal,fontEncoding:DX.Unicode,fontFamilyName:b||"Arial",fontStyleName:gvt(w,x),fontType:NX.Unspecified,haloSize:o,height:T,hinting:UX.Default,horizontalAlignment:fvt(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:c,offsetX:$i(p),offsetY:$i(m),strikethrough:C==="line-through",underline:C==="underline",symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:ju(r)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:ju(n)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:O?hV.RTL:hV.LTR,verticalAlignment:mvt(d??"baseline"),verticalGlyphOrientation:zX.Right,wordSpacing:100,billboardMode3D:kX.FaceNearPlane,callout:M}}static createPictureMarkerRasterizationParam(e){var l,c;const{angle:i,height:r,width:s,xoffset:n,yoffset:o}=e,a=e.url??((l=e.source)==null?void 0:l.url)??((c=e.source)==null?void 0:c.imageData);return a?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:yC.Picture,tintColor:null,url:a,size:r,width:s,offsetX:$i(n),offsetY:$i(o),rotation:$i(-i)}}:null}static createPictureFillRasterizationParam(e){const{width:i,height:r,xoffset:s,yoffset:n,url:o}=e;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:yC.Picture,tintColor:null,url:o,width:i,height:r,offsetX:$i(s),offsetY:$i(n),rotation:0}}:null}static fromSimpleMarker(e,i,r){const{style:s}=e,n=e.color??r;if(s==="path"||s==="esriSMSPath"){const d=[];if("outline"in e&&e.outline){const g=e.outline;d.push({type:"CIMSolidStroke",enable:!0,width:g.width,color:ju(g.color),path:e.path})}d.push({type:"CIMSolidFill",enable:!0,color:ju(n),path:e.path});const[p,m]=QP("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-$i(e.angle),size:$i(e.size||6),offsetX:$i(e.xoffset),offsetY:$i(e.yoffset),scaleSymbolsProportionally:!1,frame:p,markerGraphics:[{type:"CIMMarkerGraphic",geometry:m,symbol:{type:"CIMPolygonSymbol",symbolLayers:d}}]}]}}const o=[];let a,l,c=e.size;if("outline"in e&&e.outline&&e.outline.style!=="none"&&e.outline.style!=="esriSLSNull"){const d=e.outline,p=d.style!=="solid"&&d.style!=="esriSLSSolid";[a,l]=p?QP(s,e.size):QP(s);const m=d.width??ose.width;if(p){const v=m/e.size,b=(a.xmax-a.xmin)*v/2,w=(a.ymax-a.ymin)*v/2;a.xmin-=b,a.xmax+=b,a.ymin-=w,a.ymax+=w,c&&(c+=m)}const g=e.style!=="cross"&&e.style!=="x"||(e==null?void 0:e.outline.style)==="dot"||(e==null?void 0:e.outline.style)==="short-dot"?Ua.HalfGap:Ua.FullPattern,y=p?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:jX(d.style,null).map(v=>d.width&&d.width>0?v*d.width:v),lineDashEnding:g,controlPointEnding:Ua.FullPattern}]:void 0;o.push({type:"CIMSolidStroke",capStyle:p?Id.Round:Id.Butt,enable:!0,width:m,color:ju(d.color),effects:y})}else!i||e.type!=="line-marker"||e.style!=="cross"&&e.style!=="x"?[a,l]=QP(s):([a,l]=QP(s),o.push({type:"CIMSolidStroke",enable:!0,width:i,color:ju(n)}));o.push({type:"CIMSolidFill",enable:!0,color:ju(n)});const u={type:"CIMPolygonSymbol",symbolLayers:o};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:$i(-e.angle),size:$i(c||6*i),offsetX:$i(e.xoffset),offsetY:$i(e.yoffset),scaleSymbolsProportionally:!1,frame:a,markerGraphics:[{type:"CIMMarkerGraphic",geometry:l,symbol:u}]}]}}static fromCIMHatchFill(e,i){var l;const r=i*(e.separation??lM.CIMHatchFill.separation),s=r/2,n=Q(e.lineSymbol);(l=n.symbolLayers)==null||l.forEach(c=>{var u;switch(c.type){case"CIMSolidStroke":c.width!=null&&(c.width*=i),(u=c.effects)==null||u.forEach(d=>{if(d.type==="CIMGeometricEffectDashes"){const p=d.dashTemplate;d.dashTemplate=p==null?void 0:p.map(m=>m*i)}});break;case"CIMVectorMarker":{c.size!=null&&(c.size*=i);const d=c.markerPlacement;d!=null&&"placementTemplate"in d&&(d.placementTemplate=d.placementTemplate.map(p=>p*i));break}}});let o=this._getLineSymbolPeriod(n)||qfe;for(;o<qfe;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-s,ymax:s},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:n}],size:r}}static fetchResources(e,i,r,s=null){return e&&i&&$3e(e,n=>{bvt(n,i,r),"url"in n&&n.url&&r.push(i.fetchResource(n.url,{signal:s}))}),r}static fetchFonts(e,i,r){if(e&&i){if("symbolLayers"in e&&e.symbolLayers){for(const s of e.symbolLayers)if(s.type==="CIMVectorMarker"&&s.markerGraphics)for(const n of s.markerGraphics)n!=null&&n.symbol&&W5.fetchFonts(n.symbol,i,r)}else if(e.type==="CIMTextSymbol"){const{fontFamilyName:s,fontStyleName:n}=e;if(!s||s.toLowerCase()==="calcitewebcoreicons")return;const{style:o,weight:a}=KIe(n),l=e3e(e),c=new hL({family:s,style:o,weight:a,decoration:l});r.push(i.loadFont(c).catch(()=>{pV().error(`Unsupported font ${s} in CIM symbol`)}))}}}static _getLineSymbolPeriod(e){if(e){const i=this._getEffectsRepeat(e.effects);if(i)return i;if(e.symbolLayers){for(const r of e.symbolLayers)if(r){const s=this._getEffectsRepeat(r.effects);if(s)return s;switch(r.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const n=this._getPlacementRepeat(r.markerPlacement);if(n)return n}}}}}return 0}static _getEffectsRepeat(e){if(e){for(const i of e)if(i)switch(i.type){case"CIMGeometricEffectDashes":{const r=i.dashTemplate;if(r&&r.length){let s=0;for(const n of r)s+=n;return 1&r.length&&(s*=2),s}break}case"CIMGeometricEffectWave":return i.period;default:pV().error(`unsupported geometric effect type ${i.type}`)}}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const i=e.placementTemplate;if(i&&i.length){let r=0;for(const s of i)r+=+s;return 1&i.length&&(r*=2),r}break}}return 0}static fromCIMInsidePolygon(e){const i=e.markerPlacement,r={...e};r.markerPlacement=null,r.anchorPoint=null;const s=Math.abs(i.stepX),n=Math.abs(i.stepY),o=(i.randomness??100)/100;let a,l,c,u;if(i.gridType==="Random"){const d=Do(f_t),p=Math.max(Math.floor(d/s),1),m=Math.max(Math.floor(d/n),1);a=p*s/2,l=m*n/2,c=2*l;const g=new nS(i.seed),y=o*s/1.5,v=o*n/1.5;u=[];for(let b=0;b<p;b++)for(let w=0;w<m;w++){const x=b*s-a+y*(.5-g.getFloat()),T=w*n-l+v*(.5-g.getFloat());u.push({x,y:T}),b===0&&u.push({x:x+2*a,y:T}),w===0&&u.push({x,y:T+2*l})}}else i.shiftOddRows===!0?(a=s/2,l=n,c=2*n,u=[{x:-a,y:0},{x:a,y:0},{x:0,y:l},{x:0,y:-l}]):(a=s/2,l=n/2,c=n,u=[{x:-s,y:0},{x:0,y:-n},{x:-s,y:-n},{x:0,y:0},{x:s,y:0},{x:0,y:n},{x:s,y:n},{x:-s,y:n},{x:s,y:-n}]);return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-l,ymax:l},markerGraphics:u.map(d=>({type:"CIMMarkerGraphic",geometry:d,symbol:{type:"CIMPointSymbol",symbolLayers:[r]}})),size:c}}};function $3e(t,e){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const i=t.symbolLayers;if(!i)return;for(const r of i)if(e(r),r.type==="CIMVectorMarker"){const s=r.markerGraphics;if(!s)continue;for(const n of s)if(n){const o=n.symbol;o&&$3e(o,e)}}break}}}const I3e=t=>{if(!t)return Id.Butt;switch(t){case"butt":return Id.Butt;case"square":return Id.Square;case"round":return Id.Round}},L3e=t=>{if(!t)return sg.Miter;switch(t){case"miter":return sg.Miter;case"round":return sg.Round;case"bevel":return sg.Bevel}},fvt=t=>{if(t==null)return"Center";switch(t){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},mvt=t=>{if(t==null)return"Center";switch(t){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},ju=t=>{if(!t)return[0,0,0,0];const{r:e,g:i,b:r,a:s}=t;return[e,i,r,255*s]},gvt=(t,e)=>{const i=yvt(e),r=_vt(t);return i&&r?`${i}-${r}`:`${i}${r}`},yvt=t=>{if(!t)return"";switch(t.toLowerCase()){case"bold":case"bolder":return"bold"}return""},_vt=t=>{if(!t)return"";switch(t.toLowerCase()){case"italic":case"oblique":return"italic"}return""},jX=(t,e)=>{const i=re("safari")?.001:0,r=e==="butt";switch(t){case"dash":case"esriSLSDash":return r?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return r?[4,3,1,3]:[3,4,i,4];case"dot":case"esriSLSDot":return r?[1,3]:[i,4];case"long-dash":case"esriSLSLongDash":return r?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return r?[8,3,1,3]:[7,4,i,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return r?[8,3,1,3,1,3]:[7,4,i,4,i,4];case"short-dash":case"esriSLSShortDash":return r?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return r?[4,1,1,1]:[3,2,i,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return r?[4,1,1,1,1,1]:[3,2,i,2,i,2];case"short-dot":case"esriSLSShortDot":return r?[1,1]:[i,2];case"solid":case"esriSLSSolid":case"none":return pV().error("Unexpected: style does not require rasterization"),[0,0];default:return pV().error(`Tried to rasterize SLS, but found an unexpected style: ${t}!`),[0,0]}},QP=(t,e=100)=>{const i=e/2;let r,s;const n=t;if(n==="circle"||n==="esriSMSCircle"){let a=Math.acos(1-.25/i),l=Math.ceil(R3e/a/4);l===0&&(l=1),a=dvt/l,l*=4;const c=[];c.push([i,0]);for(let u=1;u<l;u++)c.push([i*Math.cos(u*a),-i*Math.sin(u*a)]);c.push([i,0]),r={rings:[c]},s={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if(n==="cross"||n==="esriSMSCross")r={paths:[[[0,i],[0,-i]],[[i,0],[-i,0]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="diamond"||n==="esriSMSDiamond")r={rings:[[[-i,0],[0,i],[i,0],[0,-i],[-i,0]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="square"||n==="esriSMSSquare")r={rings:[[[-i,-i],[-i,i],[i,i],[i,-i],[-i,-i]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="x"||n==="esriSMSX")r={paths:[[[i,i],[-i,-i]],[[i,-i],[-i,i]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="triangle"||n==="esriSMSTriangle"){const o=e*.5773502691896257,a=-o,l=2/3*e,c=l-e;r={rings:[[[a,c],[0,l],[o,c],[a,c]]]},s={xmin:a,ymin:c,xmax:o,ymax:l}}else n==="arrow"&&(r={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i});return[s,r]},vvt=t=>t==="vertical"||t==="horizontal"||t==="cross"||t==="esriSFSCross"||t==="esriSFSVertical"||t==="esriSFSHorizontal";function bvt(t,e,i){if(!(!t.effects||e.geometryEngine!=null)){if(e.geometryEnginePromise)return void i.push(e.geometryEnginePromise);C0t(t.effects)&&(e.geometryEnginePromise=M0t(),i.push(e.geometryEnginePromise),e.geometryEnginePromise.then(r=>e.geometryEngine=r))}}function Wfe(t){if(!t)return null;let e=null;const{cap:i,color:r,join:s,miterLimit:n,style:o,width:a}=t;return o!=="solid"&&o!=="none"&&o!=="esriSLSSolid"&&o!=="esriSLSNull"&&(e=[{type:"CIMGeometricEffectDashes",dashTemplate:jX(o,i),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:o!=="esriSLSNull"&&o!=="none"?ju(r):[0,0,0,0],capStyle:I3e(i),joinStyle:L3e(s),miterLimit:n,width:a,effects:e}}function D3e(t,e,i,r,s){if(t==null)return null;const n=t.referencesGeometry()&&s?wvt(e,r,s):e,o=t.repurposeFeature(n);try{return t.evaluate({...i,$feature:o},t.services)}catch(a){return ie.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const AH=new Map;function wvt(t,e,i){const{transform:r,hasZ:s,hasM:n}=i;AH.has(e)||AH.set(e,xvt(e));const o=AH.get(e)(t.geometry,r,s,n);return{...t,geometry:o}}function xvt(t){const e={};switch(t){case"esriGeometryPoint":return(i,r,s,n)=>y$e(r,e,i,s,n);case"esriGeometryPolygon":return(i,r,s,n)=>_$e(r,e,i,s,n);case"esriGeometryPolyline":return(i,r,s,n)=>v$e(r,e,i,s,n);case"esriGeometryMultipoint":return(i,r,s,n)=>g$e(r,e,i,s,n);default:return ie.getLogger("esri.views.2d.support.arcadeOnDemand").error(new V("mapview-arcade",`Unable to handle geometryType: ${t}`)),i=>i}}const Svt=t=>{if(!t)return[0,0,0,0];const{r:e,g:i,b:r,a:s}=t;return[e,i,r,255*s]};let _C=class dn{static findApplicableOverrides(e,i,r){if(e&&i){if(e.primitiveName){let s=!1;for(const n of r)if(n.primitiveName===e.primitiveName){s=!0;break}if(!s)for(const n of i)n.primitiveName===e.primitiveName&&r.push(n)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const s of e.effects)dn.findApplicableOverrides(s,i,r);if(e.symbolLayers)for(const s of e.symbolLayers)dn.findApplicableOverrides(s,i,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const s of e.effects)dn.findApplicableOverrides(s,i,r);if(e.markerPlacement&&dn.findApplicableOverrides(e.markerPlacement,i,r),e.type==="CIMVectorMarker"){if(e.markerGraphics)for(const s of e.markerGraphics)dn.findApplicableOverrides(s,i,r),dn.findApplicableOverrides(s.symbol,i,r)}else e.type==="CIMCharacterMarker"?dn.findApplicableOverrides(e.symbol,i,r):e.type==="CIMHatchFill"?dn.findApplicableOverrides(e.lineSymbol,i,r):e.type==="CIMPictureMarker"&&dn.findApplicableOverrides(e.animatedSymbolProperties,i,r)}}}static findEffectOverrides(e,i){if(!e)return null;if(e.type==="CIMGeometricEffectDashes"&&t3e(e),!i||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const r=Ffe(e),s=e.primitiveName,n=[];for(const o of i)o.primitiveName===s&&n.push(Ffe(o));return{type:"cim-effect-param",effect:r,overrides:I0t(n)}}static async resolveSymbolOverrides(e,i,r,s,n,o,a){if(!(e!=null&&e.symbol))return null;let{symbol:l,primitiveOverrides:c}=e;const u=!!c;if(!u&&!s)return l;l=Q(l),c=Q(c);let d=!0;if(i||(i={attributes:{}},d=!1),u){if(d||(c=c.filter(p=>{var m;return!((m=p.valueExpressionInfo)!=null&&m.expression.includes("$feature"))})),a||(c=c.filter(p=>{var m;return!((m=p.valueExpressionInfo)!=null&&m.expression.includes("$view"))})),c.length>0){const p={spatialReference:r,fields:$0t(i.attributes),geometryType:n};await dn.createRenderExpressions(c,p),dn.evaluateOverrides(c,i,n??"esriGeometryPoint",o,a)}dn.applyOverrides(l,c)}return s&&dn.applyDictionaryTextOverrides(l,i,s,null),l}static async createRenderExpressions(e,i){const r=[];for(const s of e){const n=s.valueExpressionInfo;if(!n||dn._expressionToRenderExpression.has(n.expression))continue;const o=PEe(n.expression,i.spatialReference,i.fields);r.push(o),o.then(a=>dn._expressionToRenderExpression.set(n.expression,a))}r.length>0&&await Promise.all(r)}static evaluateOverrides(e,i,r,s,n){const o={$view:{scale:n==null?void 0:n.scale}};for(const a of e){a.value&&typeof a.value=="object"&&sMe(a.value)&&(a.propertyName==="Color"||a.propertyName==="StrokeColor")&&(a.value=Svt(a.value));const l=a.valueExpressionInfo;if(!l)continue;const c=dn._expressionToRenderExpression.get(l.expression);c&&(a.value=D3e(c,i,o,r,s))}}static applyDictionaryTextOverrides(e,i,r,s,n="Normal"){if(e!=null&&e.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const o=e.symbolLayers;if(!o)return;for(const a of o)a&&a.type==="CIMVectorMarker"&&dn.applyDictionaryTextOverrides(a,i,r,s,e.type==="CIMTextSymbol"?e.textCase:n)}break;case"CIMVectorMarker":{const o=e.markerGraphics;if(!o)return;for(const a of o)a&&dn.applyDictionaryTextOverrides(a,i,r,s)}break;case"CIMMarkerGraphic":{const o=e.textString;if(o&&o.includes("[")){const a=v0t(o,r);e.textString=b0t(i,a,s,n)}}}}static applyOverrides(e,i,r,s){if(e.primitiveName){for(const n of i)if(n.primitiveName===e.primitiveName){const o=sse(n.propertyName);if(s&&s.push({cim:e,nocapPropertyName:o,value:e[o]}),r){let a=!1;for(const l of r)l.primitiveName===e.primitiveName&&(a=!0);a||r.push(n)}n.value!=null&&(e[o]=n.value)}}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const n of e.effects)dn.applyOverrides(n,i,r,s);if(e.symbolLayers)for(const n of e.symbolLayers)dn.applyOverrides(n,i,r,s);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const n of e.effects)dn.applyOverrides(n,i,r,s);if(e.type==="CIMVectorMarker"&&e.markerGraphics)for(const n of e.markerGraphics)dn.applyOverrides(n,i,r,s),dn.applyOverrides(n.symbol,i,r,s)}}static restoreOverrides(e){for(const i of e)i.cim[i.nocapPropertyName]=i.value}static buildOverrideKey(e){let i="";for(const r of e)r.value!==void 0&&(i+=`${r.primitiveName}${r.propertyName}${JSON.stringify(r.value)}`);return i}static toValue(e,i){if(e==="DashTemplate")return i.split(" ").map(r=>Number(r));if(e==="Color"){const r=new Oe(i).toRgba();return r[3]*=255,r}return i}};_C._expressionToRenderExpression=new Map;function cse(t,e,i,r){if(t)if(t.type!=="CIMTextSymbol"){if(t.effects)for(const s of t.effects)Cvt(s,e);if(t.symbolLayers)for(const s of t.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":Tvt(s,e,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!(r!=null&&r.preserveOutlineWidth)&&s.width&&(s.width*=e);break;case"CIMPictureFill":s.height&&(s.height*=e),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e);break;case"CIMHatchFill":cse(s.lineSymbol,e,!0,{...r,preserveOutlineWidth:!1}),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e),s.separation&&(s.separation*=e)}}else t.height!=null&&(t.height*=e)}function Tvt(t,e,i){if(t&&(t.markerPlacement&&Evt(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const r of t.markerGraphics)t.scaleSymbolsProportionally||cse(r.symbol,e,!0,i)}function Evt(t,e){switch(QIe(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map(r=>r*e);t.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map(r=>r*e);t.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function Cvt(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const i=t.dashTemplate.map(r=>r*e);t.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function Mvt(t){const e=[];return HX(S0t(t),e),e.length?new Oe(x0t(e[0])):null}function HX(t,e){var s;if(!t)return;let i;i=t.type==="CIMTextSymbol"?t.symbol:t;const r=t.type==="CIMPolygonSymbol";if(i!=null&&i.symbolLayers){for(const n of i.symbolLayers)if(!(n.colorLocked||r&&(E0t(n)||T0t(n)&&n.markerPlacement&&QIe(n.markerPlacement))))switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor&&Yfe(e,n.tintColor);break;case"CIMVectorMarker":(s=n.markerGraphics)==null||s.forEach(o=>{HX(o.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":Yfe(e,n.color);break;case"CIMHatchFill":HX(n.lineSymbol,e)}}}function Yfe(t,e){for(const i of t)if(i.join(".")===e.join("."))return;t.push(e)}var Zfe,Xfe,N3e={exports:{}};Xfe=function(){function t(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function e(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function i(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function r(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:Hg},u=Hg,d="none",p=")",m=",",g="(",y="%",v="px",b="cm",w="mm",x="in",T="pt",C="pc",M="deg",O="rad",D="grad",k="turn",U="#",H=".",z="e",Z=/^[ \t\n\r]/,q=/^[a-z\-]/,Y=/^[0-9a-fA-F]/,de=/^[+\-]/,L=/^[0-9]/,F=Hl("none"),j=yo("none",!1),W=yo(")",!1),X=yo(",",!1),K=Hl("whitespace"),te=xb([" ","	",`
`,"\r"],!1,!1),he=Hl("function"),we=yo("(",!1),De=Hl("identifier"),at=xb([["a","z"],"-"],!1,!1),et=Hl("percentage"),Ke=yo("%",!1),Je=Hl("length"),Xe=yo("px",!1),si=yo("cm",!1),ei=yo("mm",!1),Gi=yo("in",!1),Ue=yo("pt",!1),ui=yo("pc",!1),ke=Hl("angle"),Ze=yo("deg",!1),bt=yo("rad",!1),kt=yo("grad",!1),Qe=yo("turn",!1),Pt=Hl("number"),Ne=Hl("color"),rt=yo("#",!1),Ot=xb([["0","9"],["a","f"],["A","F"]],!1,!1),nr=xb(["+","-"],!1,!1),xi=xb([["0","9"]],!1,!1),xr=yo(".",!1),Zi=yo("e",!1),or=function(){return[]},Si=function(J,be){return{type:"function",name:J,parameters:be||[]}},Xi=function(J,be){return be.length>0?cP(J,be,3):[J]},Oi=function(J){return{type:"quantity",value:J.value,unit:J.unit}},hr=function(J){return{type:"color",colorType:J.type,value:J.value}},$t=function(J){return J},fi=function(){return Pc()},Ri=function(J){return{value:J,unit:"%"}},Sr=function(J){return{value:J,unit:"px"}},un=function(J){return{value:J,unit:"cm"}},yi=function(J){return{value:J,unit:"mm"}},Hr=function(J){return{value:J,unit:"in"}},ks=function(J){return{value:J,unit:"pt"}},Fo=function(J){return{value:J,unit:"pc"}},cl=function(J){return{value:J,unit:"deg"}},ul=function(J){return{value:J,unit:"rad"}},ko=function(J){return{value:J,unit:"grad"}},xn=function(J){return{value:J,unit:"turn"}},Us=function(J){return{value:J,unit:null}},Ti=function(){return{type:"hex",value:Pc()}},es=function(J){return{type:"function",value:J}},Dn=function(){return{type:"named",value:Pc()}},mo=function(){return parseFloat(Pc())},le=0,er=0,tp=[{line:1,column:1}],go=0,ip=[],vt=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');u=c[n.startRule]}function Pc(){return s.substring(er,le)}function yo(J,be){return{type:"literal",text:J,ignoreCase:be}}function xb(J,be,Ie){return{type:"class",parts:J,inverted:be,ignoreCase:Ie}}function Sb(){return{type:"end"}}function Hl(J){return{type:"other",description:J}}function jg(J){var be,Ie=tp[J];if(Ie)return Ie;for(be=J-1;!tp[be];)be--;for(Ie={line:(Ie=tp[be]).line,column:Ie.column};be<J;)s.charCodeAt(be)===10?(Ie.line++,Ie.column=1):Ie.column++,be++;return tp[J]=Ie,Ie}function Tb(J,be,Ie){var Ei=jg(J),Sn=jg(be);return{source:l,start:{offset:J,line:Ei.line,column:Ei.column},end:{offset:be,line:Sn.line,column:Sn.column}}}function ni(J){le<go||(le>go&&(go=le,ip=[]),ip.push(J))}function e_(J,be,Ie){return new e(e.buildMessage(J,be),J,be,Ie)}function Hg(){var J;return(J=t_())===a&&(J=hl()),J}function t_(){var J,be;return vt++,J=le,Es(),s.substr(le,4)===d?(be=d,le+=4):(be=a,vt===0&&ni(j)),be!==a?(Es(),er=J,J=or()):(le=J,J=a),vt--,J===a&&vt===0&&ni(F),J}function hl(){var J,be;if(J=[],(be=Oc())!==a)for(;be!==a;)J.push(be),be=Oc();else J=a;return J}function Oc(){var J,be,Ie,Ei;return J=le,Es(),(be=i_())!==a?(Es(),(Ie=zf())===a&&(Ie=null),Es(),s.charCodeAt(le)===41?(Ei=p,le++):(Ei=a,vt===0&&ni(W)),Ei!==a?(Es(),er=J,J=Si(be,Ie)):(le=J,J=a)):(le=J,J=a),J}function zf(){var J,be,Ie,Ei,Sn,zs,dl,Ab;if(J=le,(be=_o())!==a){for(Ie=[],Ei=le,Sn=Es(),s.charCodeAt(le)===44?(zs=m,le++):(zs=a,vt===0&&ni(X)),zs===a&&(zs=null),dl=Es(),(Ab=_o())!==a?Ei=Sn=[Sn,zs,dl,Ab]:(le=Ei,Ei=a);Ei!==a;)Ie.push(Ei),Ei=le,Sn=Es(),s.charCodeAt(le)===44?(zs=m,le++):(zs=a,vt===0&&ni(X)),zs===a&&(zs=null),dl=Es(),(Ab=_o())!==a?Ei=Sn=[Sn,zs,dl,Ab]:(le=Ei,Ei=a);er=J,J=Xi(be,Ie)}else le=J,J=a;return J}function _o(){var J,be;return J=le,(be=Cb())===a&&(be=NT())===a&&(be=Mb())===a&&(be=r_()),be!==a&&(er=J,be=Oi(be)),(J=be)===a&&(J=le,(be=KL())!==a&&(er=J,be=hr(be)),J=be),J}function Es(){var J,be;for(vt++,J=[],Z.test(s.charAt(le))?(be=s.charAt(le),le++):(be=a,vt===0&&ni(te));be!==a;)J.push(be),Z.test(s.charAt(le))?(be=s.charAt(le),le++):(be=a,vt===0&&ni(te));return vt--,be=a,vt===0&&ni(K),J}function i_(){var J,be,Ie;return vt++,J=le,(be=Eb())!==a?(s.charCodeAt(le)===40?(Ie=g,le++):(Ie=a,vt===0&&ni(we)),Ie!==a?(er=J,J=$t(be)):(le=J,J=a)):(le=J,J=a),vt--,J===a&&(be=a,vt===0&&ni(he)),J}function Eb(){var J,be,Ie;if(vt++,J=le,be=[],q.test(s.charAt(le))?(Ie=s.charAt(le),le++):(Ie=a,vt===0&&ni(at)),Ie!==a)for(;Ie!==a;)be.push(Ie),q.test(s.charAt(le))?(Ie=s.charAt(le),le++):(Ie=a,vt===0&&ni(at));else be=a;return be!==a&&(er=J,be=fi()),vt--,(J=be)===a&&(be=a,vt===0&&ni(De)),J}function Cb(){var J,be,Ie;return vt++,J=le,Es(),(be=ql())!==a?(s.charCodeAt(le)===37?(Ie=y,le++):(Ie=a,vt===0&&ni(Ke)),Ie!==a?(er=J,J=Ri(be)):(le=J,J=a)):(le=J,J=a),vt--,J===a&&vt===0&&ni(et),J}function NT(){var J,be,Ie;return vt++,J=le,Es(),(be=ql())!==a?(s.substr(le,2)===v?(Ie=v,le+=2):(Ie=a,vt===0&&ni(Xe)),Ie!==a?(er=J,J=Sr(be)):(le=J,J=a)):(le=J,J=a),J===a&&(J=le,Es(),(be=ql())!==a?(s.substr(le,2)===b?(Ie=b,le+=2):(Ie=a,vt===0&&ni(si)),Ie!==a?(er=J,J=un(be)):(le=J,J=a)):(le=J,J=a),J===a&&(J=le,Es(),(be=ql())!==a?(s.substr(le,2)===w?(Ie=w,le+=2):(Ie=a,vt===0&&ni(ei)),Ie!==a?(er=J,J=yi(be)):(le=J,J=a)):(le=J,J=a),J===a&&(J=le,Es(),(be=ql())!==a?(s.substr(le,2)===x?(Ie=x,le+=2):(Ie=a,vt===0&&ni(Gi)),Ie!==a?(er=J,J=Hr(be)):(le=J,J=a)):(le=J,J=a),J===a&&(J=le,Es(),(be=ql())!==a?(s.substr(le,2)===T?(Ie=T,le+=2):(Ie=a,vt===0&&ni(Ue)),Ie!==a?(er=J,J=ks(be)):(le=J,J=a)):(le=J,J=a),J===a&&(J=le,Es(),(be=ql())!==a?(s.substr(le,2)===C?(Ie=C,le+=2):(Ie=a,vt===0&&ni(ui)),Ie!==a?(er=J,J=Fo(be)):(le=J,J=a)):(le=J,J=a)))))),vt--,J===a&&vt===0&&ni(Je),J}function Mb(){var J,be,Ie;return vt++,J=le,(be=ql())!==a?(s.substr(le,3)===M?(Ie=M,le+=3):(Ie=a,vt===0&&ni(Ze)),Ie!==a?(er=J,J=cl(be)):(le=J,J=a)):(le=J,J=a),J===a&&(J=le,(be=ql())!==a?(s.substr(le,3)===O?(Ie=O,le+=3):(Ie=a,vt===0&&ni(bt)),Ie!==a?(er=J,J=ul(be)):(le=J,J=a)):(le=J,J=a),J===a&&(J=le,(be=ql())!==a?(s.substr(le,4)===D?(Ie=D,le+=4):(Ie=a,vt===0&&ni(kt)),Ie!==a?(er=J,J=ko(be)):(le=J,J=a)):(le=J,J=a),J===a&&(J=le,(be=ql())!==a?(s.substr(le,4)===k?(Ie=k,le+=4):(Ie=a,vt===0&&ni(Qe)),Ie!==a?(er=J,J=xn(be)):(le=J,J=a)):(le=J,J=a)))),vt--,J===a&&(be=a,vt===0&&ni(ke)),J}function r_(){var J,be;return vt++,J=le,Es(),(be=ql())!==a?(er=J,J=Us(be)):(le=J,J=a),vt--,J===a&&vt===0&&ni(Pt),J}function KL(){var J,be,Ie,Ei;if(vt++,J=le,s.charCodeAt(le)===35?(be=U,le++):(be=a,vt===0&&ni(rt)),be!==a){if(Ie=[],Y.test(s.charAt(le))?(Ei=s.charAt(le),le++):(Ei=a,vt===0&&ni(Ot)),Ei!==a)for(;Ei!==a;)Ie.push(Ei),Y.test(s.charAt(le))?(Ei=s.charAt(le),le++):(Ei=a,vt===0&&ni(Ot));else Ie=a;Ie!==a?(er=J,J=Ti()):(le=J,J=a)}else le=J,J=a;return J===a&&(J=le,(be=Oc())!==a&&(er=J,be=es(be)),(J=be)===a&&(J=le,(be=Eb())!==a&&(er=J,be=Dn()),J=be)),vt--,J===a&&(be=a,vt===0&&ni(Ne)),J}function ql(){var J,be,Ie,Ei,Sn,zs,dl;for(J=le,de.test(s.charAt(le))?(s.charAt(le),le++):vt===0&&ni(nr),be=le,Ie=[],L.test(s.charAt(le))?(Ei=s.charAt(le),le++):(Ei=a,vt===0&&ni(xi));Ei!==a;)Ie.push(Ei),L.test(s.charAt(le))?(Ei=s.charAt(le),le++):(Ei=a,vt===0&&ni(xi));if(s.charCodeAt(le)===46?(Ei=H,le++):(Ei=a,vt===0&&ni(xr)),Ei!==a){if(Sn=[],L.test(s.charAt(le))?(zs=s.charAt(le),le++):(zs=a,vt===0&&ni(xi)),zs!==a)for(;zs!==a;)Sn.push(zs),L.test(s.charAt(le))?(zs=s.charAt(le),le++):(zs=a,vt===0&&ni(xi));else Sn=a;Sn!==a?be=Ie=[Ie,Ei,Sn]:(le=be,be=a)}else le=be,be=a;if(be===a)if(be=[],L.test(s.charAt(le))?(Ie=s.charAt(le),le++):(Ie=a,vt===0&&ni(xi)),Ie!==a)for(;Ie!==a;)be.push(Ie),L.test(s.charAt(le))?(Ie=s.charAt(le),le++):(Ie=a,vt===0&&ni(xi));else be=a;if(be!==a){if(Ie=le,s.charCodeAt(le)===101?(Ei=z,le++):(Ei=a,vt===0&&ni(Zi)),Ei!==a){if(de.test(s.charAt(le))?(Sn=s.charAt(le),le++):(Sn=a,vt===0&&ni(nr)),Sn===a&&(Sn=null),zs=[],L.test(s.charAt(le))?(dl=s.charAt(le),le++):(dl=a,vt===0&&ni(xi)),dl!==a)for(;dl!==a;)zs.push(dl),L.test(s.charAt(le))?(dl=s.charAt(le),le++):(dl=a,vt===0&&ni(xi));else zs=a;zs!==a?Ie=Ei=[Ei,Sn,zs]:(le=Ie,Ie=a)}else le=Ie,Ie=a;Ie===a&&(Ie=null),er=J,J=mo()}else le=J,J=a;return J}function lP(J,be){return J.map(function(Ie){return Ie[be]})}function cP(J,be,Ie){return[J].concat(lP(be,Ie))}if((o=u())!==a&&le===s.length)return o;throw o!==a&&le<s.length&&ni(Sb()),e_(ip,go<s.length?s.charAt(go):null,go<s.length?Tb(go,go+1):Tb(go,go))}return t(e,Error),e.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,u=this.location.source+":"+c.line+":"+c.column;if(a){var d=this.location.end,p=i("",c.line.toString().length," "),m=a[l.line-1],g=(l.line===d.line?d.column:m.length+1)-l.column||1;n+=`
 --> `+u+`
`+p+` |
`+c.line+" | "+m+`
`+p+" | "+i("",l.column-1," ")+i("",g,"^")}else n+=`
 at `+u}return n},e.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var g=m.parts.map(function(y){return Array.isArray(y)?c(y[0])+"-"+c(y[1]):c(y)});return"["+(m.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function u(m){return o[m.type](m)}function d(m){var g,y,v=m.map(u);if(v.sort(),v.length>0){for(g=1,y=1;g<v.length;g++)v[g-1]!==v[g]&&(v[y]=v[g],y++);v.length=y}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function p(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+d(s)+" but "+p(n)+" found."},{SyntaxError:e,parse:r}},(Zfe=N3e).exports&&(Zfe.exports=Xfe());var Avt=N3e.exports;function F3e(t){if(!t||t.length===0)return null;if(typeof t=="string"){const i=Jfe(t);return i&&i.length!==0?i:null}const e=t.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new V("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:Jfe(i.value)}});e.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<e.length-1;i++){if(!OJe(e[i].effects,e[i+1].effects))throw new V("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[i].effects,b:e[i+1].effects});RJe(e[i].effects,e[i+1].effects)}return e.sort((i,r)=>r.scale-i.scale),e}function Jfe(t){let e;if(!t)return[];try{e=Avt.parse(t)}catch(i){throw new V("effect:invalid-syntax","Invalid effect syntax",{value:t,error:i})}return e.map(i=>Pvt(i))}function Pvt(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return Ovt(t);case"opacity":return Rvt(t);case"hue-rotate":return $vt(t);case"blur":return Ivt(t);case"drop-shadow":return Lvt(t);case"bloom":return Dvt(t)}}catch(e){throw e.details.filter=t,e}throw new V("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function Ovt(t){let e=1;return rP(t.parameters,1),t.parameters.length===1&&(e=Hp(t.parameters[0])),new sW(t.name,e)}function Rvt(t){let e=1;return rP(t.parameters,1),t.parameters.length===1&&(e=Hp(t.parameters[0])),new vEe(e)}function $vt(t){let e=0;return rP(t.parameters,1),t.parameters.length===1&&(e=Vvt(t.parameters[0])),new yEe(e)}function Ivt(t){let e=0;return rP(t.parameters,1),t.parameters.length===1&&(e=dse(t.parameters[0]),BL(e,t.parameters[0])),new dEe(e)}function Lvt(t){const e=[];let i=null;for(const r of t.parameters)if(r.type==="color"){if(e.length&&Object.freeze(e),i)throw new V("effect:type-error","Accepts only one color",{});i=Bvt(r)}else{const s=dse(r);if(Object.isFrozen(e))throw new V("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&BL(s,r)}if(e.length<2||e.length>3)throw new V("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new mEe(e[0],e[1],e[2]||0,i||k3e("black"))}function Dvt(t){let e=1,i=0,r=0;return rP(t.parameters,3),t.parameters[0]&&(e=Hp(t.parameters[0])),t.parameters[1]&&(i=dse(t.parameters[1]),BL(i,t.parameters[1])),t.parameters[2]&&(r=Hp(t.parameters[2])),new uEe(e,i,r)}function rP(t,e){if(t.length>e)throw new V("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function dj(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in hse)return"<length>";if(t.unit in use)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function BL(t,e){if(t<0)throw new V("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function Nvt(t){if(t.type!=="quantity"||t.unit!==null)throw new V("effect:type-error",`Expected <double>, Actual: ${dj(t)}`,{term:t})}function Fvt(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new V("effect:type-error",`Expected <double> or <percentage>, Actual: ${dj(t)}`,{term:t})}const use={deg:1,grad:.9,rad:180/Math.PI,turn:360};function kvt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&use[t.unit]!=null))throw new V("effect:type-error",`Expected <angle>, Actual: ${dj(t)}`,{term:t})}const hse={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function Uvt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&hse[t.unit]!=null))throw new V("effect:type-error",`Expected <length>, Actual: ${dj(t)}`,{term:t})}function Hp(t){Fvt(t);const e=t.value;return BL(e,t),t.unit==="%"?.01*e:e}function zvt(t){return Nvt(t),BL(t.value,t),t.value}function Vvt(t){return kvt(t),t.value*use[t.unit]||0}function dse(t){return Uvt(t),t.value*hse[t.unit]||0}function Bvt(t){switch(t.colorType){case"hex":return pJe(t.value);case"named":return k3e(t.value);case"function":return Hvt(t.value)}}function k3e(t){if(!aEe(t))throw new V("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return dJe(t)}const Gvt=/^rgba?/i,jvt=/^hsla?/i;function Hvt(t){if(rP(t.parameters,4),Gvt.test(t.name))return[Hp(t.parameters[0]),Hp(t.parameters[1]),Hp(t.parameters[2]),t.parameters[3]?Hp(t.parameters[3]):1];if(jvt.test(t.name))return lEe(zvt(t.parameters[0]),Hp(t.parameters[1]),Hp(t.parameters[2]),t.parameters[3]?Hp(t.parameters[3]):1);throw new V("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function b3(t,e,i){var r;try{return Wvt(t)}catch(s){(r=i==null?void 0:i.messages)==null||r.push(s)}return null}function w3(t,e,i,r){try{const s=qvt(t);kl(i,s,e)}catch(s){r.messages&&r.messages.push(s)}}function qvt(t){const e=F3e(t);return e?$Je(e)?e.map(i=>i.toJSON()):e.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function Wvt(t){if(!t||t.length===0)return null;if(Yvt(t)){const e=[];for(const i of t)e.push({scale:i.scale,value:Qfe(i.value)});return e}return Qfe(t)}function Yvt(t){const e=t[0];return!!e&&"scale"in e}function Qfe(t){if(!(t!=null&&t.length))return"";const e=[];for(const i of t){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[ry(i,"amount")];break;case"blur":r=[ry(i,"radius","pt")];break;case"hue-rotate":r=[ry(i,"angle","deg")];break;case"drop-shadow":r=[ry(i,"xoffset","pt"),ry(i,"yoffset","pt"),ry(i,"blurRadius","pt"),Zvt(i,"color")];break;case"bloom":r=[ry(i,"strength"),ry(i,"radius","pt"),ry(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;F3e(s),e.push(s)}return e.join(" ")}function ry(t,e,i){if(t[e]==null)throw new V("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return i?t[e]+i:""+t[e]}function Zvt(t,e){if(t[e]==null)throw new V("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const i=t[e];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}let pse=class{constructor(e,i){this._storage=new CIe,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),i&&this._storage.registerRemoveFunc("",i)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,i,r=1){this._storage.put(this,e,i,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};new pse(1e3);new Oe([128,128,128]);const Xvt=new Oe("white");function DZt(t){if(t==null||!("symbolLayers"in t)||t.symbolLayers==null)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(e=>e.type==="object");case"line-3d":return t.symbolLayers.some(e=>e.type==="path");case"polygon-3d":return t.symbolLayers.some(e=>e.type==="object"||e.type==="extrude");default:return!1}}function Jvt(t){var e;return((e=t.resource)==null?void 0:e.href)??""}function NZt(t,e){if(!t)return null;let i=null;return JS(t)?i=Qvt(t):cG(t)&&(i=t.type==="cim"?Mvt(t):t.color?new Oe(t.color):null),i?x3(i,e):null}function Qvt(t){const e=t.symbolLayers;if(!e)return null;let i=null;return e.forEach(r=>{var s;r.type==="object"&&((s=r.resource)!=null&&s.href)||(i=r.type==="water"?r.color:r.material?r.material.color:null)}),i?new Oe(i):null}function x3(t,e){if(e==null||t==null)return t;const i=t.toRgba();return i[3]=i[3]*e,new Oe(i)}function Kvt(t,e,i){const r=t.symbolLayers;if(!r)return;const s=n=>x3(e=e??n??(i!=null?Xvt:null),i);r.forEach(n=>{var o,a;if(n.type!=="object"||!((o=n.resource)!=null&&o.href)||e)if(n.type==="water")n.color=s(n.color);else{const l=n.material!=null?n.material.color:null,c=s(l);n.material==null?n.material=new xh({color:c}):n.material.color=c,i!=null&&"outline"in n&&((a=n.outline)==null?void 0:a.color)!=null&&(n.outline.color=x3(n.outline.color,i))}})}function e1t(t,e,i){var r;(e=e??t.color)&&(t.color=x3(e,i)),i!=null&&"outline"in t&&((r=t.outline)!=null&&r.color)&&(t.outline.color=x3(t.outline.color,i))}function FZt(t,e,i){t&&(e||i!=null)&&(e&&(e=new Oe(e)),JS(t)?Kvt(t,e,i):cG(t)&&e1t(t,e,i))}async function t1t(t,e){const i=t.symbolLayers;i&&await yB(i,async r=>i1t(r,e))}async function i1t(t,e){switch(t.type){case"extrude":s1t(t,e);break;case"icon":case"line":case"text":r1t(t,e);break;case"path":o1t(t,e);break;case"object":await n1t(t,e)}}function r1t(t,e){const i=U3e(e);i!=null&&(t.size=i)}function U3e(t){for(const e of t)if(typeof e=="number")return e;return null}function s1t(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function n1t(t,e){const{resourceSize:i,symbolSize:r}=await a1t(t),s=z3e(e,i,r);t.width=uI(e[0],r[0],i[0],s),t.depth=uI(e[1],r[1],i[1],s),t.height=uI(e[2],r[2],i[2],s)}function o1t(t,e){const i=z3e(e,s0,[t.width,void 0,t.height]);t.width=uI(e[0],t.width,1,i),t.height=uI(e[2],t.height,1,i)}function z3e(t,e,i){for(let r=0;r<3;r++){const s=t[r];switch(s){case"symbol-value":{const n=i[r];return n!=null?n/e[r]:1}case"proportional":break;default:if(s&&e[r])return s/e[r]}}return 1}async function a1t(t){const{computeObjectLayerResourceSize:e}=await fe(()=>import("./symbolLayerUtils-BLz298AM.js"),[]),i=await e(t,10),{width:r,height:s,depth:n}=t,o=[r,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/i[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function uI(t,e,i,r){switch(t){case"proportional":return i*r;case"symbol-value":return e??i;default:return t}}function l1t(t,e){const i=U3e(e);if(i!=null)switch(t.type){case"simple-marker":t.size=i;break;case"picture-marker":{const r=t.width/t.height;r>1?(t.width=i,t.height=i*r):(t.width=i*r,t.height=i);break}case"simple-line":t.width=i;break;case"text":t.font.size=i}}async function kZt(t,e){if(t&&e)return JS(t)?t1t(t,e):void(cG(t)&&l1t(t,e))}function UZt(t,e,i){if(t&&e!=null)if(JS(t)){const r=t.symbolLayers;r&&r.forEach(s=>{if(s&&s.type==="object")switch(i){case"tilt":s.tilt=(s.tilt??0)+e;break;case"roll":s.roll=(s.roll??0)+e;break;default:s.heading=(s.heading??0)+e}})}else cG(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle+=e))}function zZt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function VZt(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}const BZt=1.2,c1t=wh,u1t=4;let pj=class{constructor(e,i,r,s){this.graphics3DSymbolLayer=e,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,ls.ADD);if(e||this._addedToStage){for(const i of this.renderGeometries)i.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Wn.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,ls.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=E()){return ne(e,0,0,0)}getBoundingBoxObjectSpace(e=Jn()){return Br(e)}addObjectState(e,i){e===A0.Highlight&&(this.renderGeometries.forEach(r=>{const s=r.geometry.addHighlight();i.addRenderGeometry(r,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Wn.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(i=>{e.removeRenderGeometry(i)})}removeRenderGeometryObjectState(e,i){e.geometry.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Wn.HIGHLIGHT)}computeAttachmentOrigin(e){for(const i of this.renderGeometries)i.geometry.computeAttachmentOrigin(v2)&&(e.draped.origin[0]+=v2[0],e.draped.origin[1]+=v2[1],e.draped.num++)}async getProjectedBoundingBox(e,i,r,s,n){Br(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,Kfe,r),gKe(n,Kfe)}if(i){let o;of(n,v2);const a=gre(n,i.service.spatialReference,i);try{o=await i.service.queryElevation(v2[0],v2[1],s,a,"ground")}catch{}o!=null&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(e,i,r,s){if(this.boundingBox)aG(Kf,this.boundingBox);else{const n=e.boundingSphere,o=n[3];Kf[0]=n[0]-o,Kf[1]=n[1]-o,Kf[2]=n[2]-o,Kf[3]=n[0]+o,Kf[4]=n[1]+o,Kf[5]=n[2]+o}return i(Kf,0,2),this.calculateRelativeScreenBounds&&s.push({location:of(Kf),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),Hte(Kf,r)}};const Kfe=Ht(),Kf=Jn(),v2=E();function fV(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}function V3e(t){const{size:e}=t.definition,i=t.fontString(e);let r=eme.get(i);if(!r){const s=fV(d1t,0,0).getContext("2d");t.setFontProperties(s,e);const n=s.measureText(p1t);r=new h1t(n.actualBoundingBoxAscent,n.actualBoundingBoxDescent),eme.set(i,r)}return r}const eme=new Map;let h1t=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,i){this.maxAscent=e,this.maxDescent=i}};const d1t={canvas:null},p1t=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})(),mV=1;let B3e=class{constructor(e,i,r,s){this.text=e,this._alignment=i,this._parameters=r,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.replaceAll(" ","Â ").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let i=0;i<this._lines.length-1;i++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=fV(tme,cF,cF).getContext("2d"),i=this._parameters.definition.pixelRatio,r=this._fontSize*i;this._parameters.setFontProperties(e,r);let s=2*this._haloSize;const n=this._parameters.definition.font;n.style!=="italic"&&n.style!=="oblique"&&n.weight!=="bold"&&n.weight!=="bolder"||(s+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let o=0,a=0,l=0,c=0,u=0;this._lines.forEach((b,w)=>{const x=e.measureText(b),T=x.width/i,C=T+s;this._textWidths.push(T),this._lineWidths.push(C),o=Math.max(o,C),c=Math.max(c,x.actualBoundingBoxAscent/i),u=Math.max(u,x.actualBoundingBoxDescent/i),w===0&&(a=x.actualBoundingBoxAscent/i),w===this._lines.length-1&&(l=x.actualBoundingBoxDescent/i)});const d=V3e(this._parameters),p=Math.max(c,d.maxAscent),m=Math.max(u,d.maxDescent),g=a,y=this._parameters.definition.font.decoration==="underline"?m:l,v=o;this._metricsCached=new m1t(g,y,p,m,v)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*f1t}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,mV)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case f1.Left:return this._horizontalPadding;case f1.Center:return(this.displayWidth-this._lineWidths[e])/2;case f1.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,i,r){e.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;i+=o,r+=a;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,o,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const u=this._lines[c],d=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,u,i+d,r),this._renderLineDecoration(e,i+d,r,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,u,i+this._getLineXOffset(c),r),this._renderLineDecoration(e,i+d,r,this._textWidths[c]),r+=this._lineSpacing}if(Rr.TEXT_SHOW_BASELINE){e.strokeStyle=ime,e.setLineDash([2,2]),e.lineWidth=1;let c=n+a;for(let u=0;u<this._lines.length;++u)this._drawLine(e,[s,c],[s+this.displayWidth,c]),c+=this._lineSpacing}if(Rr.TEXT_SHOW_BORDER&&(e.strokeStyle=ime,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this._midLineAscent}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=Te(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(i,r+s),e.arcTo(i,r,i+s,r,s),e.lineTo(i+n-s,r),e.arcTo(i+n,r,i+n,r+s,s),e.lineTo(i+n,r+o-s),e.arcTo(i+n,r+o,i+n-s,r+o,s),e.lineTo(i+s,r+o),e.arcTo(i,r+o,i,r+o-s,s),e.closePath()):e.rect(i,r,n,o)}_renderHalo(e,i,r,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=fV(tme,Math.max(o,cF),Math.max(a,cF)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._parameters.setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let d=n;for(let p=0;p<this._lines.length;++p){const m=this._getLineXOffset(p);this._renderLineDecoration(c,s+m,d,this._textWidths[p],!0),d+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),e.globalAlpha=1}_renderHaloEmulated(e,i,r){for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of G3e)this._fillText(e,n,i+o+this._haloSize*a,r+this._haloSize*l);r+=this._lineSpacing}}_renderHaloNative(e,i,r){const s=2*this._haloSize;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let u=0;u<l;u++){const d=1-(l-1)*c+u*c;e.lineWidth=this._toRenderUnit(d*s),this._strokeText(e,o,i+a,r)}r+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,i,r,s){e.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(e,i,r,s){e.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(e,i,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,u=Math.floor(n)+.5,d=Math.ceil(n+a)-.5;e.beginPath(),e.moveTo(l,u),e.lineTo(c,u),e.lineTo(c,d),e.lineTo(l,d),e.lineTo(l,u),e.stroke()}};const G3e=[];for(let e=0;e<360;e+=360/16)G3e.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var f1;(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(f1||(f1={}));const tme={canvas:null},f1t=.2,cF=512,ime="rgb(255, 0, 255, 0.5)";let m1t=class{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,i,r,s,n){this.firstLineAscent=e,this.lastLineDescent=i,this.maxLineAscent=r,this.maxLineDescent=s,this.displayWidth=n}};const g1t=Object.freeze({left:0,center:.5,right:1}),Y5=Object.freeze({"bottom-left":_i(0,0),bottom:_i(.5,0),"bottom-right":_i(1,0),left:_i(0,.5),center:_i(.5,.5),right:_i(1,.5),"top-left":_i(0,1),top:_i(.5,1),"top-right":_i(1,1)});function j3e(t){switch(t){case"left":return f1.Left;case"right":return f1.Right;default:return f1.Center}}function rme(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function y1t(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function _1t(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function v1t(t){return t==="middle"?"center":t}function b1t(t,e){switch(t){case"top":return Pi(e,0,mV);case"bottom":return Pi(e,0,-mV);default:return Aa(e,jS)}}let gA=class{constructor(e,i={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=Ee(),this._shaderTransformation=null,this._boundingSphere=null,this.id=_h(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.castShadow=i.castShadow??!1,i.objectShaderTransformation!=null&&this.objectShaderTransformationChanged(i.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){vn(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=Ee()),dr(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??(this._boundingSphere=ln()),He(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*VM(this.shaderTransformation)),this._boundingSphere):bTe}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const sme=$e(0,0,1),w1t=16,x1t=1.5,Jx=Wre,S1t=[Jx/2,Jx/2,1-Jx/2,1-Jx/2],T1t=[sV*Jx,sV*Jx];let qX=class H3e extends Gg{getCachedSize(){return{size:this._getIconSize()}}constructor(e,i,r,s){super(e,i,r,s),this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._patchTask=null,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(r!=null)this._prepareResourcesPrimitive(i,r);else{const s=Jvt(this.symbolLayer),n=nme(s);n!=null?await this._prepareResourcesCIM(i,JSON.parse(n),e):await this._prepareResourcesHref(i,s,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=YG(this._getIconSize());if(e)throw new V("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,i=Math.round(e.size!=null?_n(e.size):w1t);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(e){let i=this._cimData;if(i&&i.symbol||this.logger.error("Can't create texture, CIM data is undefined"),i.primitiveOverrides){i=Q(i);const c=i.primitiveOverrides;_C.evaluateOverrides(c,e,this._arcadeInfo.geometryType,null,null),_C.applyOverrides(i.symbol,c)}const r=BK(JSON.stringify(i));let s=this._cimSymbolTextures.get(r);if(s)return s;const n=this._context.sharedResources.cimSymbolRasterizer,o=this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null;o&&_C.applyDictionaryTextOverrides(i.symbol,e,o,null);const a=this._cimScaleFactorOrFunction!=null?y0t(this._cimScaleFactorOrFunction,e):1;a!==1&&i.symbol&&cse(i.symbol,a);const l=MH.getEnvelope(i,null,n.resourceManager);if(l!=null&&l.width&&l.height){const c=l.x+l.width/2,u=l.y+l.height/2,d=n.rasterize({type:"cim",data:i},l.width,l.height,c,u,1,"esriGeometryPoint"),p=new Wx({x:-l.x/l.width-.5,y:(l.height+l.y)/l.height-.5});this._cimMaterialParametersInfo.anchorPosition=ome("relative",p),s=new J1(d,{width:(d==null?void 0:d.width)??1,height:(d==null?void 0:d.height)??1,reloadable:!0})}else s=new J1(new ImageData(1,1),{width:1,height:1,reloadable:!0});return this._cimSymbolTextures.set(r,s),this._context.stage.add(s),s}_prepareMaterialParameters(){const e={anchorPosition:ome(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(E1t(i)){const{screenLength:r,minWorldLength:s,maxWorldLength:n}=i.verticalOffset;e.verticalOffset={screenLength:_n(r),minWorldLength:s||0,maxWorldLength:n??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!re("enable-feature:non-occluded-hud"),e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,i){const r=this._getOutlineSize();if(PH(i)&&r===0)throw new Error("Nothing to render");if(this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const n=this._context.sharedResources.textures.fromData(`${i}-icon`,()=>Jmt(i));this._textureHandle=n,e.textureId=n.texture.id}e.textureIsSignedDistanceField=!0,e.sampleSignedDistanceFieldTexelCenter=Xmt(i),e.distanceFieldBoundingBox=S1t;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/Jx,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,i,r){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await Vd(this._context.sharedResources.textures.fromUrl(i,n,{signal:r}));if(o.ok===!1)throw Pn(o.error),new V("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._textureHandle=o.value;const a=o.value.texture;this._size=ame(a,s),e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,i,r){if(this._cimData=i,!this._context.sharedResources.cimSymbolRasterizer){const u=(await fe(async()=>{const{CIMSymbolRasterizer:d}=await import("./CIMSymbolRasterizer-CtOAqd4Q.js");return{CIMSymbolRasterizer:d}},[])).CIMSymbolRasterizer;Et(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new u(this._context.renderCoordsHelper.spatialReference))}const s=this._context.sharedResources.cimSymbolRasterizer,n=[],o=i,a=o==null?void 0:o.symbol;MH.fetchResources(a,s.resourceManager,n,r),MH.fetchFonts(a,s.resourceManager,n);const l=this._context.layer.fields?this._context.layer.fields.map(u=>u.toJSON()):[],c=this._context.renderCoordsHelper.spatialReference;if(this._arcadeInfo={spatialReference:c,fields:l,geometryType:"esriGeometryPoint"},o!=null&&o.primitiveOverrides&&n.push(_C.createRenderExpressions(o.primitiveOverrides,this._arcadeInfo)),n.length>0&&(await Promise.all(n),Et(r)),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const u=this._context.renderer;if(u.scaleExpression){const d=u.scaleExpression,p=await PEe(d,this._context.layer.spatialReference,l);this._cimScaleFactorOrFunction=(m,g,y)=>{const v=D3e(p,m,{$view:y},"esriGeometryPoint",g);return v!==null?v:1}}}Et(r),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){var e,i;return(e=this.symbolLayer.resource)!=null&&e.href?null:((i=this.symbolLayer.resource)==null?void 0:i.primitive)??LKe}_getOutlineSize(){var r;let e=0;const i=this.symbolLayer;return((r=i.outline)==null?void 0:r.size)!=null?Math.max(_n(i.outline.size),0):(e=PH(this._getPrimitive())?x1t:0,Math.max(e,0))}_getOutlineColor(){var s;const e=this._getLayerOpacity(),i=this.symbolLayer,r=(s=i==null?void 0:i.outline)==null?void 0:s.color;if(r!=null){const n=Oe.toUnitRGB(r),o=r.a*e;return[n[0],n[1],n[2],o]}return[0,0,0,0]}_getFillColor(){var r,s;if(PH(this._getPrimitive()))return c1t;const e=this._getPrimitive()==null,i=(s=(r=this.symbolLayer)==null?void 0:r.material)==null?void 0:s.color;return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:e})}_createMaterialAndAddToStage(e,i){if(this._cimData){this._fastUpdates=null;let r=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return r||(r=new cA(e),this._cimSymbolMaterials.set(e.textureId??0,r),i.add(r)),r}return this._fastUpdates=oA(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._materials[0]=new cA(e),i.add(this._materials[0]),this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,draped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._patchTask=Ul(this._patchTask),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._textureHandle=ti(this._textureHandle)}_getScaleFactor(e,i){if(this._drivenProperties.size&&e.size){for(let r=0;r<3;r++){const s=e.size[r];s&&s!=="symbol-value"&&s!=="proportional"&&(e.size[r]=_n(s))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/i;if(isFinite(+e.size[2]))return+e.size[2]/i}return 1}createGraphics3DGraphic(e){var d;const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;let r,s=[0,0];if(this._cimData){if(!this._cimData.symbol)return null;const p=this._generateTextureCIM(i),m={textureId:p.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(m,this._context.stage);const g=window.devicePixelRatio||1;s=[p.parameters.width/g,p.parameters.height/g]}else s=this._size,r=this._materials[0];const n=ES(i.geometry);if(n==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!((d=this._fastUpdates)!=null&&d.visualVariables.size)){const p=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=_i(s[0]*l,s[1]*l),u=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(u.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,n,r,a,c,e.layer.uid):this._createAs3DShape(i,n,r,a,c,u,i.uid)}layerOpacityChanged(){const e=this._getFillColor(),i=this._getOutlineColor();this._forEachMaterial(r=>{r.setParameters({color:e}),r.setParameters({outlineColor:i})})}updateGeometry(e,i){if(this.draped||!this._validateGeometry(i))return!1;const{elevationContext:r,stageObject:s}=e;if(r.mode!==this.getGeometryElevationMode(i))return!1;const n=ES(i);if(!n)return!1;const o=e$e(s,this._context,n,r);if(o==null)return!1;const a=Dre(this._context,n);return s.geometries[0].localOrigin===a&&(e.alignedSampledElevation=o,sT(e,n,this._context.elevationProvider),!0)}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=CL(H3e.elevationModeChangeTypes,r,s);if(n!==Ds.UPDATE)return n;const o=qd(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,i){var r;for(const s in e.diff){if(s!=="visualVariables"||!aA(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return an.RecreateSymbol;(r=this._materials[0])==null||r.setParameters(this._fastUpdates.materialParameters)}return an.FastUpdate}prepareSymbolLayerPatch(e){var r;if((r=this._patchTask)==null||r.abort(),e.diff.type!=="partial")return;const i=e.diff.diff;this._preparePatchResource(e,i)}_preparePatchResource(e,i){var l;if(!i.resource||i.resource.type!=="partial")return;const r=i.resource.diff;if(((l=r==null?void 0:r.href)==null?void 0:l.type)!=="complete")return;const s=r.href.newValue,{textures:n}=this._context.sharedResources;if(s==null||n==null||nme(s)!=null)return;const o=this._getIconSize(),a=o*this._context.graphicsCoreOwner.view.state.pixelRatio;e.symbolLayerStatePatches.push(()=>{this._patchTask=Ul(this._patchTask),this._patchTask=Nf(c=>this._context.schedule(async(u,d)=>{const p=await Vd(n.fromUrl(s,a,{signal:d}));Et(d);const m=!p.ok;if(m&&Pn(p.error),this._textureHandle=ti(this._textureHandle),this._patchTask=null,m){this._forEachMaterial(v=>{v.visible=!1,v.setParameters({textureId:null})});const y=`Failed to load (Request for icon resource failed: ${s})`;return void this.logger.error(new V("graphics3diconsymbollayer:request-failed",y))}this._textureHandle=p.value;const g=p.value.texture;this._size=ame(g,o),this._forEachMaterial(y=>{y.setParameters({textureId:g.id}),y.visible=!0})},c))}),delete r.href}_defaultElevationInfoNoZ(){return C1t}_createAs3DShape(e,i,r,s,n,o,a){const l=this.getFastUpdateAttrValues(e),c=this._context.layer.uid,u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:c}),d=HZ(r,sme,null,s,n,M1t,null,l,u),p=Lre(this._context,i,d,o,a);if(p==null)return null;const m=new Bg(this,p.object,[d],null,null,TS,o);return m.alignedSampledElevation=p.sampledElevation,m.needsElevationUpdates=qd(o.mode)||o.mode==="absolute-height",m.getScreenSize=this._createScreenSizeGetter(n,l),m.calculateRelativeScreenBounds=g=>r.calculateRelativeScreenBounds(m.getScreenSize(),1,g),sT(m,i,this._context.elevationProvider),m}_createAsOverlay(e,i,r,s,n,o){r.renderPriority=this._renderPriority;const a=E();il(i,a,this._context.overlaySR),a[2]=ese;const l=this._context.clippingExtent;if(l!=null&&!jte(l,a))return null;const c=this.getFastUpdateAttrValues(e),u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),d=HZ(r,sme,a,s,n,null,null,c,u),p=new gA(d,{layerUid:o,graphicUid:e.uid}),m=new pj(this,[p],null,this._context.drapeSourceRenderer);return m.getScreenSize=this._createScreenSizeGetter(n,c),m.calculateRelativeScreenBounds=g=>r.calculateRelativeScreenBounds(m.getScreenSize(),1,g),m}_createScreenSizeGetter(e,i){const r=this._outlineSize+2;if(this._fastUpdates&&i){const o=e[0]/this._symbolTextureRatio,a=e[1]/this._symbolTextureRatio;return(l=lt())=>{const[c,u]=sre(A1t,this._fastUpdates.materialParameters,i);return l[0]=c*o+r,l[1]=u*a+r,l}}const s=e[0]/this._symbolTextureRatio+r,n=e[1]/this._symbolTextureRatio+r;return(o=lt())=>(o[0]=s,o[1]=n,o)}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),i=$e(e,e,e),r=Do(1),s=e*r,n=$e(s,s,s);return new TL({size:!0,color:!0,rotation:!0,opacity:!1},i,n,r)}_forEachMaterial(e){this._materials.forEach(e),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._materials[0]}}};function E1t(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function PH(t){return t!=null&&(t==="cross"||t==="x")}function nme(t){const e=T1(t);return(e==null?void 0:e.mediaType)==="application/json"?e.data:void 0}function ome(t,e){return t==="relative"?_i((e.x||0)+.5,.5-(e.y||0)):t in Y5?Y5[t]:Y5.center}function ame({parameters:t},e){const i=(t.width??1)/(t.height??1);return i>1?[e,Math.round(e/i)]:[Math.round(e*i),e]}qX.PRIMITIVE_SIZE=T1t,qX.elevationModeChangeTypes={definedChanged:Ds.UPDATE,staysOnTheGround:Ds.NONE,onTheGroundChanged:Ds.RECREATE};const C1t={mode:"relative-to-ground",offset:0},M1t=Wt(0,0,0,1),A1t=E();function WX(t){switch(t){case"butt":return Fd.BUTT;case"square":return Fd.SQUARE;case"round":return Fd.ROUND;default:return null}}function lme(t){return t==="diamond"?"kite":t}function YX(t,e,i=null){const r=[],s=e.mapPositions;P1t(e,r);const n=r[0][1].data,o=r[0][1].indices.length,a=fb(o);return O1t(e,r,a),I1t(e,r,a),R1t(e,r,a),$1t(e,r,a),L1t(e,r,a),D1t(e,r,a),N1t(e,r,n),new bn(t,r,s,Ls.Line,i)}function P1t(t,e){const{attributeData:{position:i},removeDuplicateStartEnd:r}=t,s=F1t(i)&&r,n=i.length/3-(s?1:0),o=new Array(2*(n-1)),a=s?i.slice(0,-3):i;let l=0;for(let c=0;c<n-1;c++)o[l++]=c,o[l++]=c+1;e.push([R.POSITION,new it(a,o,3,s)])}function O1t(t,e,i){if(t.attributeData.colorFeature!=null)return;const r=t.attributeData.color;e.push([R.COLOR,new it(r??Md,i,4)])}function R1t(t,e,i){t.attributeData.normal&&e.push([R.NORMAL,new it(t.attributeData.normal,i,3)])}function $1t(t,e,i){t.attributeData.colorFeature!=null&&e.push([R.COLORFEATUREATTRIBUTE,new it([t.attributeData.colorFeature],i,1,!0)])}function I1t(t,e,i){t.attributeData.sizeFeature==null&&e.push([R.SIZE,new it([t.attributeData.size??1],i,1,!0)])}function L1t(t,e,i){t.attributeData.sizeFeature!=null&&e.push([R.SIZEFEATUREATTRIBUTE,new it([t.attributeData.sizeFeature],i,1,!0)])}function D1t(t,e,i){t.attributeData.opacityFeature!=null&&e.push([R.OPACITYFEATUREATTRIBUTE,new it([t.attributeData.opacityFeature],i,1,!0)])}function N1t(t,e,i){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==Ge.Global||!t.overlayInfo.spatialReference.isGeographic)return;const r=ho(i.length),s=ur(t.overlayInfo.spatialReference);for(let d=0;d<r.length;d+=3)kee(i,d,r,d,s);const n=i.length/3,o=ws(n+1);let a=k1t,l=U1t,c=0,u=0;Pi(a,r[u++],r[u++]),u++,o[0]=0;for(let d=1;d<n+1;++d)d===n&&(u=0),Pi(l,r[u++],r[u++]),u++,c+=vMe(a,l),o[d]=c,[a,l]=[l,a];e.push([R.DISTANCETOSTART,new it(o,e[0][1].indices,1,!0)])}function F1t(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const k1t=lt(),U1t=lt();function YZt(t,e){if(t==null||t.length===0)return[];const i=[];return t.forEach(r=>{const s=r.length,n=ho(3*s);r.forEach((a,l)=>{n[3*l]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};i.push(o)}),i}function z1t(t,e,i,r){const s=t.type==="polygon"?Ag.CCW_IS_HOLE:Ag.NONE,n=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=kL(n,!!t.hasZ,s,t.spatialReference),l=ho(o.length),c=HOe(o,t.spatialReference,0,l,0,o,0,o.length/3,e,i,r),u=c!=null;return{lines:u?q3e(a,o,l):[],projectionSuccess:u,sampledElevation:c}}function V1t(t,e){const i=t.type==="polygon"?Ag.CCW_IS_HOLE:Ag.NONE,r=t.type==="polygon"?t.rings:t.paths,{position:s,outlines:n}=kL(r,!1,i),o=ns(s,t.spatialReference,0,s,e,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=ese;return{lines:o?q3e(n,s):[],projectionSuccess:o}}function q3e(t,e,i=null){const r=new Array;for(const{index:s,count:n}of t){if(n<=1)continue;const o=3*s,a=3*n;r.push({position:Nd(e,3*s,3*n),mapPositions:i!=null?Nd(i,o,a):void 0})}return r}function W3e(t){const e=new Vi,i=t.multipassEnabled&&t.output===G.Color,r=t.space===Cc.World;e.include(Q$e,t),e.include(mIe,t);const{vertex:s,fragment:n}=e;return n.include(Uf),bc(s,t),e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.PREVPOSITION,"vec3"),e.attributes.add(R.UV0,"vec2"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),i&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),s.uniforms.add(new Fr("nearFar",(o,a)=>a.camera.nearFar),new zi("viewport",(o,a)=>a.camera.fullViewport)),s.code.add(S`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(S`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),r?(e.attributes.add(R.NORMAL,"vec3"),iA(s),s.constants.add("tiltThreshold","float",.7),s.code.add(S`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(S`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(S`
      #define vecN ${r?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${r?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===nT.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===Cc.Screen&&(s.uniforms.add(new ss("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(S`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(S`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new qe("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(S`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),YA(s),s.code.add(S`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position, 1.0);
vec4 prev = view * vec4(prevPosition, 1.0);
clip(pos, prev);`),r?(t.hideOnShortSegments&&s.code.add(S`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(S`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(S`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===Cc.Screen&&s.code.add(S`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(S`
        ${i?"depth = pos.z;":""}

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${r?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&e.include(Vg,t),e.include(gn,t),n.uniforms.add(new zi("intrinsicColor",o=>o.color),new mt("tex",o=>o.markerTexture)),n.include(Ug),e.constants.add("texelSize","float",1/CS),n.code.add(S`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",Yre/CS),e.constants.add("relativeTipLineWidth","float",ogt),n.code.add(S`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${r?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),t.transparencyPassType===nt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),e.constants.add("symbolAlphaCutoff","float",Xo),n.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${r?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===G.ObjectAndLayerIdColor?S`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===G.Color?S`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===G.Color&&t.transparencyPassType===nt.ColorAlpha?S`
            fragColor = premultiplyAlpha(fragColor);
            fragAlpha = fragColor.a;`:""}
    ${t.output===G.Highlight?S`fragColor = vec4(1.0);`:""}
  }
  `),e}const B1t=Object.freeze(Object.defineProperty({__proto__:null,build:W3e},Symbol.toStringTag,{value:"Module"})),Y3e=new Map([[R.POSITION,0],[R.PREVPOSITION,1],[R.UV0,2],[R.NORMAL,3],[R.COLOR,4],[R.COLORFEATUREATTRIBUTE,4],[R.SIZE,5],[R.SIZEFEATUREATTRIBUTE,5],[R.OPACITYFEATUREATTRIBUTE,6]]);let Z3e=class X3e extends Wi{initializeProgram(e){return new Yi(e.rctx,X3e.shader.get().build(this.configuration),Y3e)}_makePipelineState(e,i){const r=this.configuration,s=e===nt.NONE;return Gt({blending:r.output===G.Color?s?gu:Z0(e):null,depthTest:r.space===Cc.Draped?null:{func:yb(e)},depthWrite:r.space===Cc.Draped?null:s?r.writeDepth?Tu:null:BG(e),drawBuffers:r.output===G.Depth?{buffers:[ao.NONE]}:X0(e),colorWrite:Kt,stencilWrite:r.hasOccludees?Mg:null,stencilTest:r.hasOccludees?i?Z1:_b:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Gt({blending:gu,depthTest:Xz,depthWrite:null,colorWrite:Kt,stencilWrite:null,stencilTest:MRe}),this._occluderPipelineOpaque=Gt({blending:gu,depthTest:Xz,depthWrite:null,colorWrite:Kt,stencilWrite:ERe,stencilTest:CRe}),this._occluderPipelineMaskWrite=Gt({blending:null,depthTest:Ere,depthWrite:null,colorWrite:null,stencilWrite:Mg,stencilTest:Z1})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e,i,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:i?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};Z3e.shader=new Bi(B1t,()=>fe(()=>Promise.resolve().then(()=>wUt),void 0));let G1t=class extends mb{constructor(e){super(e,new H1t),this.produces=new Map([[_e.OPAQUE_MATERIAL,i=>i===G.Highlight||f0(i)&&this.parameters.renderOccluded===Ji.OccludeAndTransparentStencil],[_e.OPAQUE_NO_SSAO_DEPTH,i=>h1(i)],[_e.OCCLUDER_MATERIAL,i=>Gue(i)&&this.parameters.renderOccluded===Ji.OccludeAndTransparentStencil],[_e.TRANSPARENT_OCCLUDER_MATERIAL,i=>Gue(i)&&this.parameters.renderOccluded===Ji.OccludeAndTransparentStencil],[_e.TRANSPARENT_MATERIAL,i=>f0(i)&&this.parameters.writeDepth],[_e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>f0(i)&&!this.parameters.writeDepth],[_e.DRAPED_MATERIAL,i=>i===G.Color||i===G.Highlight]]),this._vertexAttributeLocations=Y3e,this._configuration=new bo,this._layout=this.createLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.space=i.slot===_e.DRAPED_MATERIAL?Cc.Draped:this.parameters.worldSpace?Cc.World:Cc.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Fd.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===Ji.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=Ts().vec3f(R.POSITION).vec3f(R.PREVPOSITION).vec2f(R.UV0);return this.parameters.worldSpace&&e.vec3f(R.NORMAL),this.parameters.vvSize?e.f32(R.SIZEFEATUREATTRIBUTE):e.f32(R.SIZE),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4f(R.COLOR),this.parameters.vvOpacity&&e.f32(R.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new q1t(this._layout,this.parameters)}createGLMaterial(e){return new j1t(e)}},j1t=class extends pie{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextures.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const i=this._material.parameters.markerPrimitive;return i!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextures.swap(i,this._markerPrimitive)}),this._markerPrimitive=i),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(Z3e,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===G.Color&&this._updateOccludeeState(e),this._updateParameters(e)}},H1t=class extends EL{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=Fd.BUTT,this.anchor=nT.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},q1t=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,i,r,s,n){const o=r.attributes.get(R.POSITION).data,a=o.length/3;let l=[1,0,0];const c=r.attributes.get(R.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let u=1,d=0;this._parameters.vvSize?d=r.attributes.get(R.SIZEFEATUREATTRIBUTE).data[0]:r.attributes.has(R.SIZE)&&(u=r.attributes.get(R.SIZE).data[0]);let p=[1,1,1,1],m=0;this._parameters.vvColor?m=r.attributes.get(R.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(R.COLOR)&&(p=r.attributes.get(R.COLOR).data);let g=0;this._parameters.vvOpacity&&(g=r.attributes.get(R.OPACITYFEATUREATTRIBUTE).data[0]);const y=new Float32Array(s.buffer);let v=n*(this.vertexBufferLayout.stride/4);const b=(C,M,O,D)=>{if(y[v++]=C[0],y[v++]=C[1],y[v++]=C[2],y[v++]=M[0],y[v++]=M[1],y[v++]=M[2],y[v++]=O[0],y[v++]=O[1],this._parameters.worldSpace&&(y[v++]=l[0],y[v++]=l[1],y[v++]=l[2]),this._parameters.vvSize?y[v++]=d:y[v++]=u,this._parameters.vvColor)y[v++]=m;else{const k=Math.min(4*D,p.length-4);y[v++]=p[k],y[v++]=p[k+1],y[v++]=p[k+2],y[v++]=p[k+3]}this._parameters.vvOpacity&&(y[v++]=g)};let w;(function(C){C[C.ASCENDING=1]="ASCENDING",C[C.DESCENDING=-1]="DESCENDING"})(w||(w={}));const x=(C,M)=>{const O=ne(W1t,o[3*C],o[3*C+1],o[3*C+2]),D=Y1t;let k=C+M;do ne(D,o[3*k],o[3*k+1],o[3*k+2]),k+=M;while(LS(O,D)&&k>=0&&k<a);e&&(He(O,O,e),He(D,D,e)),b(O,D,[-1,-1],C),b(O,D,[1,-1],C),b(O,D,[1,1],C),b(O,D,[-1,-1],C),b(O,D,[1,1],C),b(O,D,[-1,1],C)},T=this._parameters.placement;T!=="begin"&&T!=="begin-end"||x(0,w.ASCENDING),T!=="end"&&T!=="begin-end"||x(a-1,w.DESCENDING)}};const W1t=E(),Y1t=E(),Ia={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},Z1t={dash:Ia.dash,"dash-dot":[...Ia.dash,...Ia.dot],dot:Ia.dot,"long-dash":Ia["long-dash"],"long-dash-dot":[...Ia["long-dash"],...Ia.dot],"long-dash-dot-dot":[...Ia["long-dash"],...Ia.dot,...Ia.dot],none:null,"short-dash":Ia["short-dash"],"short-dash-dot":[...Ia["short-dash"],...Ia["short-dot"]],"short-dash-dot-dot":[...Ia["short-dash"],...Ia["short-dot"],...Ia["short-dot"]],"short-dot":Ia["short-dot"],solid:null},X1t=8;function J1t(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function KZt(t){return{pattern:[t,t],pixelRatio:2}}function J3e(t){return t!=null&&t.type==="style"?Q1t(t.style):null}function Q1t(t){return t!=null?J1t(Z1t[t],X1t):null}const K1t=["polyline","polygon","extent"],cme=new TL({size:!0,color:!0,rotation:!1,opacity:!0});let Q3e=class K3e extends Gg{constructor(e,i,r,s){super(e,i,r,s)}async doLoad(){if(this._fastUpdates=oA(this._context.renderer,cme),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:Do(1))<0)throw new V("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,i=!1){var n,o;const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:WX(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:J3e(this.symbolLayer.pattern)};return(o=this._fastUpdates)!=null&&o.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){var e;return(e=this.symbolLayer.material)==null?void 0:e.color}get _markerColor(){var e;return(e=this.symbolLayer.marker)==null?void 0:e.color}get _lineMaterial(){return this._materials[js.Line]==null&&(this._materials[js.Line]=new fC(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[js.Line])),this._materials[js.Line]}get _ringMaterial(){return this._materials[js.Ring]==null&&(this._materials[js.Ring]=new fC(this._getMaterialParameters(!0)),this._context.stage.add(this._materials[js.Ring])),this._materials[js.Ring]}get _wireframeLineMaterial(){return this._materials[js.LineWireframe]==null&&(this._materials[js.LineWireframe]=new fC({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[js.LineWireframe])),this._materials[js.LineWireframe]}get _wireframeRingMaterial(){return this._materials[js.RingWireframe]==null&&(this._materials[js.RingWireframe]=new fC({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._materials[js.RingWireframe])),this._materials[js.RingWireframe]}get _markerMaterial(){return this._materials[js.Marker]==null&&this.symbolLayer.marker!=null&&(this._materials[js.Marker]=new G1t({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:lme(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[js.Marker])),this._materials[js.Marker]}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0}_getDrivenSize(e){return this._drivenProperties.size&&e.size?_n(Ift(e.size)):1}_getDrivenColor(e){const i=Wt(1,1,1,1);return this._drivenProperties.color&&e.color&&(i[0]=e.color[0],i[1]=e.color[1],i[2]=e.color[2],e.color.length>0&&(i[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(i[3]=e.opacity),i}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,K1t,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,i.uid)}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables")return an.RecreateSymbol;{const s=this._fastUpdates;if(!aA(s,i,cme))return an.RecreateSymbol;this._forEachMaterial(n=>n==null?void 0:n.setParameters(s.materialParameters))}}return an.FastUpdate}prepareSymbolLayerPatch(e){var n,o;if(e.diff.type!=="partial")return;const i=e.diff.diff,r={};((n=i.size)==null?void 0:n.type)==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),((o=i.cap)==null?void 0:o.type)==="complete"&&(r.cap=WX(i.cap.newValue??"butt"),delete i.cap);const s=this._prepareMarkerPatch(e,i);this._prepareMaterialPatch(e,i,s),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a==null?void 0:a.setParameters(r)))}layerOpacityChanged(){this._forEachMaterial((e,i)=>this._updateMaterialLayerOpacity(e,i===js.Marker))}_forEachMaterial(e){this._materials.forEach(e)}_updateMaterialLayerOpacity(e,i=!1){var a,l;if(e==null)return;const r=e.parameters.color,s=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,n=this._patternHidesLine&&!i?0:this._getCombinedOpacity(s),o=Wt(r[0],r[1],r[2],n);e.setParameters({color:o})}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=CL(K3e.elevationModeChangeTypes,r,s);if(n!==Ds.UPDATE)return n;const o=qd(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i==null?void 0:i.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){const s=ume(e.graphic.geometry),n=s.type==="polygon"?s.rings:s.paths,o=new Array,a=Jn(),l=z1t(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),c=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(l,n,c,"LineSymbol3DLayer");for(let p=0;p<l.lines.length;p++){const m=l.lines[p],g=m.position,y=m.mapPositions;if(this._context.clippingExtent!=null&&(Br(a),yh(a,y),!af(a,this._context.clippingExtent)))continue;const v=this._createGeometry(s.type==="polygon"?this._ringMaterial:this._lineMaterial,e,g,y,s.type,hI.ELEVATED,r);o.push(v),Rr.LINE_WIREFRAMES&&o.push(v.instantiate({material:s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&o.push(v.instantiate({material:this._markerMaterial}))}if(o.length===0)return null;const u=new vb({geometries:o,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),d=new Bg(this,u,o,null,null,Aht,i);return d.alignedSampledElevation=l.sampledElevation,d.needsElevationUpdates=qd(i.mode),d}_createGeometry(e,i,r,s,n,o,a){var y,v,b;const l=o===hI.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=n==="polygon",u=(y=this._fastUpdates)==null?void 0:y.visualVariables.color,d=(v=this._fastUpdates)==null?void 0:v.visualVariables.size,p=(b=this._fastUpdates)==null?void 0:b.visualVariables.opacity,m=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),g={position:r,size:d?null:this._getDrivenSize(i.renderingInfo),color:u?null:this._getDrivenColor(i.renderingInfo),sizeFeature:d?_f(d.field,i.graphic):null,colorFeature:u?_f(u.field,i.graphic):null,opacityFeature:p?_f(p.field,i.graphic):null};return YX(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:s,attributeData:g},m)}_createAsOverlay(e,i){const r=e.graphic,s=ume(r.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=Rr.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,u=Jn(),d=Br(),p=V1t(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,n,m,"LineSymbol3DLayer");for(const g of p.lines){if(Br(u),yh(u,g.position),!af(u,this._context.clippingExtent))continue;JM(d,u);const y=v=>{const b=this._createGeometry(v,e,g.position,void 0,s.type,hI.DRAPED,r.uid),w=new gA(b,{layerUid:i,graphicUid:r.uid});c.push(w)};if(l!=null){y(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||yh(u,g.position,0,1),v!=="end"&&v!=="begin-end"||yh(u,g.position,g.position.length-3,1)}y(o),Rr.LINE_WIREFRAMES&&y(a)}return new pj(this,c,d,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){var i;return e=e??Do(1),this._drivenProperties.size?(i=this._fastUpdates)!=null&&i.visualVariables.size?_n(1):1:_n(e)}_prepareMaterialPatch(e,i,r){var a,l;const s=i.material;if(s==null)return void(r.changed&&r.useMaterialColor&&uF(this._getCombinedOpacityAndColor(this._materialColor),this._materials[js.Marker],e));if(s.type==="collection")return;const n=s.type==="complete"?(a=s.newValue)==null?void 0:a.color:((l=s.diff.color)==null?void 0:l.type)==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);r.useMaterialColor&&uF(sL(o),this._materials[js.Marker],e),this._patternHidesLine&&(o[3]=0),uF(o,this._materials[js.Line],e),delete i.material}_prepareMarkerPatch(e,i){var u;const r=i.marker,s=this._markerMaterial;if(r==null||r.type!=="partial"||r.diff==null||r.diff.placement!=null||r.diff.style!=null&&r.diff.style.type!=="complete"||r.diff.color!=null&&r.diff.color.type!=="complete"||s==null)return{changed:!1,useMaterialColor:this._markerColor==null};const n=r.diff.color,o=n!=null,a=o?n.newValue:null,l=a==null&&this._markerColor==null;a&&uF(this._getCombinedOpacityAndColor(a),s,e);const c=(u=r.diff.style)==null?void 0:u.newValue;return c&&e.symbolLayerStatePatches.push(()=>s.setParameters({markerPrimitive:lme(c)})),delete i.marker,{changed:o,useMaterialColor:l}}};function ume(t){switch(t.type){case"extent":if(t instanceof gi)return tb.fromExtent(t);break;case"polygon":case"polyline":return t}return null}function uF(t,e,i){e!=null&&i.symbolLayerStatePatches.push(()=>e.setParameters({color:t}))}var hI,js;Q3e.elevationModeChangeTypes={definedChanged:Ds.RECREATE,staysOnTheGround:Ds.NONE,onTheGroundChanged:Ds.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(hI||(hI={})),function(t){t[t.Line=0]="Line",t[t.Ring=1]="Ring",t[t.LineWireframe=2]="LineWireframe",t[t.RingWireframe=3]="RingWireframe",t[t.Marker=4]="Marker"}(js||(js={}));let KP=null,gV=!0;function OH(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(gV)try{return new ImageData(t,e)}catch{gV=!1}return eLe(t,e,i)}function ebt(t,e,i,r){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(gV)try{return new ImageData(t,e,i)}catch{gV=!1}const s=eLe(e,i,r);return s.data.set(t,0),s}function tbt(){return KP||(KP=document.createElement("canvas"),KP.width=1,KP.height=1),KP}function eLe(t,e,i){return i||(i=tbt()),i.getContext("2d").createImageData(t,e)}async function ibt(t,e){const i=window.URL.createObjectURL(t);try{const{data:r}=await Yt(i,{...e,responseType:"image"});return r}catch(r){throw ms(r)?r:new V("invalid-image",`Could not fetch requested image at ${i}`)}finally{window.URL.revokeObjectURL(i)}}async function eXt(t,e){const{arrayBuffer:i,mediaType:r}=await rbt(t,e),s=r==="image/png";if(r==="image/gif"){const{isAnimatedGIF:n,parseGif:o}=await fe(()=>import("./gif-DYXfBm7C.js"),[]);if(n(i))return o(i,e)}if(s){const{isAnimatedPNG:n,parseApng:o}=await fe(()=>import("./apng-Bh-VmGW3.js"),[]);if(n(i))return o(i,e)}return ibt(new Blob([i],{type:r}),e)}async function rbt(t,e){var s;const i=T1(t);if(i!=null&&i.isBase64)return{arrayBuffer:Ebe(i.data),mediaType:i.mediaType};const r=await Yt(t,{responseType:"array-buffer",...e});return{arrayBuffer:r.data,mediaType:((s=r.getHeader)==null?void 0:s.call(r,"Content-Type"))??""}}var vE;const RH=new WeakMap;let sbt=0,Em=vE=class extends ye{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,i,r){if(t instanceof HTMLImageElement){const s={type:"image-element",src:YS(t.src,r),crossOrigin:t.crossOrigin};e[i]=s}else if(t instanceof HTMLCanvasElement){const s={type:"canvas-element",imageData:hme(t.getContext("2d").getImageData(0,0,t.width,t.height))};e[i]=s}else if(t instanceof HTMLVideoElement){const s={type:"video-element",src:YS(t.src,r),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[i]=s}else if(t instanceof ImageData){const s={type:"image-data",imageData:hme(t)};e[i]=s}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=dme(t.imageData),i=document.createElement("canvas");return i.width=e.width,i.height=e.height,i.getContext("2d").putImageData(e,0,0),i}case"image-data":return dme(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return pme(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return pme(t);if(e){const i=e.substr(e.length-4,4).toLowerCase(),r=e.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(i="")=>`d:${i},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(RH.has(this.data)||RH.set(this.data,++sbt),e(RH.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new vE(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const i=this.clone();return t.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}static from(t){return typeof t=="string"?new vE({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new vE({data:t}):$S(vE,t)}};function hme(t){let e="";for(let i=0;i<t.data.length;i++)e+=String.fromCharCode(t.data[i]);return{data:btoa(e),width:t.width,height:t.height}}function dme(t){const e=atob(t.data),i=new Uint8ClampedArray(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return ebt(i,t.width,t.height)}function pme(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}h([f({type:String,json:{write:U1}})],Em.prototype,"url",null),h([f({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),f()],Em.prototype,"data",null),h([Ve("data")],Em.prototype,"writeData",null),h([Ce("data")],Em.prototype,"readData",null),h([f({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Em.prototype,"transparent",null),h([f({json:{write:!0}})],Em.prototype,"wrap",void 0),h([f({readOnly:!0})],Em.prototype,"contentHash",null),Em=vE=h([I("esri.geometry.support.MeshTexture")],Em);const dI=Em;let bE=class extends Kr(ye){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};h([f({type:[Number],nonNullable:!0,json:{write:!0}})],bE.prototype,"offset",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0}})],bE.prototype,"rotation",void 0),h([f({type:[Number],nonNullable:!0,json:{write:!0}})],bE.prototype,"scale",void 0),bE=h([I("esri.geometry.support.MeshTextureTransform")],bE);const cM=bE;var ZX;let Ap=ZX=class extends ye{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=t!=null?t.get(this):null;if(i)return i;const r=new ZX(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,r),r}clonePropertiesWithDeduplication(t){var e,i,r,s;return{color:this.color!=null?this.color.clone():null,colorTexture:(e=this.colorTexture)==null?void 0:e.cloneWithDeduplication(t),normalTexture:(i=this.normalTexture)==null?void 0:i.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:(r=this.colorTextureTransform)==null?void 0:r.clone(),normalTextureTransform:(s=this.normalTextureTransform)==null?void 0:s.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};h([f({type:Oe,json:{write:!0}})],Ap.prototype,"color",void 0),h([f({type:dI,json:{write:!0}})],Ap.prototype,"colorTexture",void 0),h([f({type:cM,json:{write:!0}})],Ap.prototype,"colorTextureTransform",void 0),h([f({type:dI,json:{write:!0}})],Ap.prototype,"normalTexture",void 0),h([f({type:cM,json:{write:!0}})],Ap.prototype,"normalTextureTransform",void 0),h([f({nonNullable:!0,json:{write:!0}})],Ap.prototype,"alphaMode",void 0),h([f({nonNullable:!0,json:{write:!0}})],Ap.prototype,"alphaCutoff",void 0),h([f({nonNullable:!0,json:{write:!0}})],Ap.prototype,"doubleSided",void 0),Ap=ZX=h([I("esri.geometry.support.MeshMaterial")],Ap);const fse=Ap;var XX;let ed=XX=class extends fse{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=t!=null?t.get(this):null;if(i)return i;const r=new XX(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,r),r}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){var e,i,r,s,n,o,a;return{...super.clonePropertiesWithDeduplication(t),emissiveColor:(e=this.emissiveColor)==null?void 0:e.clone(),emissiveTexture:(i=this.emissiveTexture)==null?void 0:i.cloneWithDeduplication(t),emissiveTextureTransform:(r=this.emissiveTextureTransform)==null?void 0:r.clone(),occlusionTexture:(s=this.occlusionTexture)==null?void 0:s.cloneWithDeduplication(t),occlusionTextureTransform:(n=this.occlusionTextureTransform)==null?void 0:n.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(o=this.metallicRoughnessTexture)==null?void 0:o.cloneWithDeduplication(t),metallicRoughnessTextureTransform:(a=this.metallicRoughnessTextureTransform)==null?void 0:a.clone()}}};h([f({type:Oe,json:{write:!0}})],ed.prototype,"emissiveColor",void 0),h([f({type:dI,json:{write:!0}})],ed.prototype,"emissiveTexture",void 0),h([f({type:cM,json:{write:!0}})],ed.prototype,"emissiveTextureTransform",void 0),h([f({type:dI,json:{write:!0}})],ed.prototype,"occlusionTexture",void 0),h([f({type:cM,json:{write:!0}})],ed.prototype,"occlusionTextureTransform",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],ed.prototype,"metallic",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],ed.prototype,"roughness",void 0),h([f({type:dI,json:{write:!0}})],ed.prototype,"metallicRoughnessTexture",void 0),h([f({type:cM,json:{write:!0}})],ed.prototype,"metallicRoughnessTextureTransform",void 0),ed=XX=h([I("esri.geometry.support.MeshMaterialMetallicRoughness")],ed);const tLe=ed;var Z5;let Uh=Z5=class extends ye{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return wE(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},ie.getLogger(this))}castPosition(t){return t&&t instanceof Float32Array&&ie.getLogger(this).warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),wE(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},ie.getLogger(this))}castUv(t){return wE(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},ie.getLogger(this))}castNormal(t){return wE(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},ie.getLogger(this))}castTangent(t){return wE(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},ie.getLogger(this))}clone(){const t={position:Q(this.position),uv:Q(this.uv),normal:Q(this.normal),tangent:Q(this.tangent),color:Q(this.color)};return new Z5(t)}clonePositional(){const t={position:Q(this.position),normal:Q(this.normal),tangent:Q(this.tangent),uv:this.uv,color:this.color};return new Z5(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function $H(t,e,i,r){const{loggerTag:s,stride:n}=e;return t.length%n!=0?(r.error(s,`Invalid array length, expected a multiple of ${n}`),new i([])):t}function wE(t,e,i,r,s){if(!t)return t;if(t instanceof e)return $H(t,r,e,s);for(const n of i)if(t instanceof n)return $H(new e(t),r,e,s);if(Array.isArray(t))return $H(new e(t),r,e,s);{const n=i.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${t.constructor.name}`),new e([])}}function eO(t,e,i){e[i]=nbt(t)}function nbt(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i];return e}h([f({json:{write:eO}})],Uh.prototype,"color",void 0),h([Li("color")],Uh.prototype,"castColor",null),h([f({nonNullable:!0,json:{write:eO}})],Uh.prototype,"position",void 0),h([Li("position")],Uh.prototype,"castPosition",null),h([f({json:{write:eO}})],Uh.prototype,"uv",void 0),h([Li("uv")],Uh.prototype,"castUv",null),h([f({json:{write:eO}})],Uh.prototype,"normal",void 0),h([Li("normal")],Uh.prototype,"castNormal",null),h([f({json:{write:eO}})],Uh.prototype,"tangent",void 0),h([Li("tangent")],Uh.prototype,"castTangent",null),Uh=Z5=h([I("esri.geometry.support.MeshVertexAttributes")],Uh);var YR;let Cm=YR=class extends ye{static from(t){return $S(YR,t)}constructor(t){super(t),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return wE(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},ie.getLogger(this))}castMaterial(t){return $S(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?tLe:fse,t)}clone(){return new YR({faces:Q(this.faces),shading:this.shading,material:Q(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(t,e){const i={faces:Q(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new YR(i)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};h([f({json:{write:!0}})],Cm.prototype,"faces",void 0),h([Li("faces")],Cm.prototype,"castFaces",null),h([f({type:fse,json:{write:!0}})],Cm.prototype,"material",void 0),h([Li("material")],Cm.prototype,"castMaterial",null),h([f()],Cm.prototype,"name",void 0),h([f({type:String,json:{write:!0}})],Cm.prototype,"shading",void 0),h([f({type:Boolean})],Cm.prototype,"trustSourceNormals",void 0),Cm=YR=h([I("esri.geometry.support.MeshComponent")],Cm);const obt=Cm;let ZR=class extends Kr(ye){constructor(e){super(e),this.type="georeferenced",this.origin=null}};h([ct({georeferenced:"georeferenced"},{readOnly:!0})],ZR.prototype,"type",void 0),h([f({type:[Number],nonNullable:!1,json:{write:!0}})],ZR.prototype,"origin",void 0),ZR=h([I("esri.geometry.support.MeshGeoreferencedVertexSpace")],ZR);const abt=ZR;let XR=class extends Kr(ye){constructor(e){super(e),this.type="local",this.origin=E()}};h([ct({local:"local"},{readOnly:!0})],XR.prototype,"type",void 0),h([f({type:[Number],nonNullable:!0,json:{write:!0}})],XR.prototype,"origin",void 0),XR=h([I("esri.geometry.support.MeshLocalVertexSpace")],XR);const lbt=XR;function fme(){return ie.getLogger("esri.geometry.Mesh")}function cbt(t){return!fj(t)}function fj(t){return t.origin!=null}function sXt(t){return fj(t.vertexSpace)}function nXt(t,e){if(!fj(t))return null;const[i,r,s]=t.origin;return new _t({x:i,y:r,z:s,spatialReference:e})}function oXt(t,e){const{x:i,y:r,z:s,spatialReference:n}=t,o=[i,r,s??0];return(e==null?void 0:e.geographic)!==void 0&&(b1(fme(),"option: geographic",{replacement:"Use the `vertexSpace` option instead.",version:"4.29",warnOnce:!0}),e.vertexSpace&&fme().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),((e==null?void 0:e.vertexSpace)??hbt(e==null?void 0:e.geographic)??ubt(n))==="local"?new lbt({origin:o}):new abt({origin:o})}function ubt(t){return t.isGeographic||t.isWebMercator?"local":"georeferenced"}function hbt(t){return t==null?void 0:t?"local":"georeferenced"}function aXt(t,e){return t.type===e.type&&(t.origin===e.origin||t.origin!=null&&e.origin!=null&&Oo(t.origin,e.origin))}const dbt=()=>ie.getLogger("esri.views.3d.support.buffer.math");function pbt(t,e,i){if(t.count!==e.count)return;const r=t.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],u=i[6],d=i[7],p=i[8],m=i[9],g=i[10],y=i[11],v=i[12],b=i[13],w=i[14],x=i[15],T=t.typedBuffer,C=t.typedBufferStride,M=e.typedBuffer,O=e.typedBufferStride;for(let D=0;D<r;D++){const k=D*C,U=D*O,H=M[U],z=M[U+1],Z=M[U+2],q=M[U+3];T[k]=s*H+l*z+p*Z+v*q,T[k+1]=n*H+c*z+m*Z+b*q,T[k+2]=o*H+u*z+g*Z+w*q,T[k+3]=a*H+d*z+y*Z+x*q}}function fbt(t,e,i,r=4,s=r){if(t.length/r!=e.length/s)return void dbt().error("source and destination buffers need to have the same number of elements");const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],d=i[5],p=i[6],m=i[7],g=i[8],y=i[9],v=i[10],b=i[11],w=i[12],x=i[13],T=i[14],C=i[15];let M=0,O=0;for(let D=0;D<n;D++){const k=e[M],U=e[M+1],H=e[M+2],z=e[M+3];t[O]=o*k+u*U+g*H+w*z,t[O+1]=a*k+d*U+y*H+x*z,t[O+2]=l*k+p*U+v*H+T*z,t[O+3]=c*k+m*U+b*H+C*z,M+=s,O+=r}}function mbt(t,e,i){mj(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function mj(t,e,i,r=4,s=r){if(t.length/r!=e.length/s)return;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],d=i[5],p=i[6],m=i[7],g=i[8];let y=0,v=0;for(let b=0;b<n;b++){const w=e[y],x=e[y+1],T=e[y+2],C=e[y+3];t[v]=o*w+c*x+p*T,t[v+1]=a*w+u*x+m*T,t[v+2]=l*w+d*x+g*T,t[v+3]=C,y+=s,v+=r}}function gbt(t,e){const i=Math.min(t.count,e.count),r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,u=n[c],d=n[c+1],p=n[c+2],m=u*u+d*d+p*p;if(m>0){const g=1/Math.sqrt(m);r[l]=g*u,r[l+1]=g*d,r[l+2]=g*p}}}function ybt(t,e,i){yV(t.typedBuffer,e,i,t.typedBufferStride)}function yV(t,e,i,r=4){const s=Math.min(t.length/r,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=i*n[a],t[l+1]=i*n[a+1],t[l+2]=i*n[a+2],t[l+3]=i*n[a+3],a+=o,l+=r}Object.freeze(Object.defineProperty({__proto__:null,normalize:gbt,scale:yV,scaleView:ybt,transformMat3:mj,transformMat3View:mbt,transformMat4:fbt,transformMat4View:pbt},Symbol.toStringTag,{value:"Module"}));const _bt="Projection may be possible after calling projection.load().";function vbt(t,e,i,r){t.error(`Failed to project from (wkid:${e.wkid}) to (wkid:${i.wkid}).${r?" ":""}${r}`)}function iLe(t,e,i,r,s){return gj($0.TO_PCPF,po.fromTypedArray(t),Ka.NORMAL,Hd.fromTypedArray(e),Hd.fromTypedArray(i),r,po.fromTypedArray(s))?s:null}function bbt(t,e,i,r,s){return gj($0.FROM_PCPF,po.fromTypedArray(t),Ka.NORMAL,Hd.fromTypedArray(e),Hd.fromTypedArray(i),r,po.fromTypedArray(s))?s:null}function wbt(t,e,i){return ns(t,e,0,i,xu(e),0,t.length/3)?i:null}function xbt(t,e,i){return ns(t,xu(i),0,e,i,0,t.length/3)?e:null}function JX(t,e,i){return D1(io,i),ej(e,t,io),vU(io)&&fA(e,e),e}function QX(t,e,i){return Xd(io,i),mj(e,t,io),vU(io)&&fA(e,e,4),e}function KX(t,e,i,r){const s=e===Ka.NORMAL;return rLe(t,e,i,(n,o)=>{const a=Math.cos(Rt(n));o[0]=s?a:1/a,o[1]=1},r)}function eJ(t,e,i,r){const s=e===Ka.NORMAL;return rLe(t,e,i,(n,o)=>{const a=Math.cosh(-n/ir.radius);o[0]=1,o[1]=s?a:1/a},r)}function rLe(t,e,i,r,s){const n=e===Ka.NORMAL?3:4,o=[0,0];for(let a=0,l=1;a<t.length;a+=n,l+=3){r(i[l],o);const c=t[a]*o[0],u=t[a+1]*o[1],d=t[a+2],p=1/Math.sqrt(c*c+u*u+d*d);s[a]=c*p,s[a+1]=u*p,s[a+2]=d*p,n===4&&(s[a+3]=t[a+3])}return s}function sLe(t,e,i,r,s){if(!gj($0.TO_PCPF,po.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),Ka.TANGENT,Hd.fromTypedArray(e),Hd.fromTypedArray(i),r,po.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function Sbt(t,e,i,r,s){if(!gj($0.FROM_PCPF,po.fromTypedArray(t,16),Ka.TANGENT,Hd.fromTypedArray(e),Hd.fromTypedArray(i),r,po.fromTypedArray(s,16)))return null;for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}var Ka,$0;function mme(t,e,i,r,s){switch(mu(r,i,t0,r),t===$0.FROM_PCPF&&In(t0,t0),e){case Ka.NORMAL:return D1(s,t0);case Ka.TANGENT:return Xd(s,t0)}}function gj(t,e,i,r,s,n,o){if(!e)return;const a=r.count,l=xu(n);if(Cbt(n))for(let c=0;c<a;c++)s.getVec(c,hF),e.getVec(c,em),Qo(em,em,mme(t,i,hF,l,io)),o.setVec(c,em);else for(let c=0;c<a;c++){s.getVec(c,hF),e.getVec(c,em);const u=RU(r.get(c,1));let d=Math.cos(u);i===Ka.TANGENT!=(t===$0.TO_PCPF)&&(d=1/d),mme(t,i,hF,l,io),t===$0.TO_PCPF?(io[0]*=d,io[1]*=d,io[2]*=d,io[3]*=d,io[4]*=d,io[5]*=d):(io[0]*=d,io[3]*=d,io[6]*=d,io[1]*=d,io[4]*=d,io[7]*=d),Qo(em,em,io),ge(em,em),o.setVec(c,em)}return o}function nLe(t){return t.vertexSpace.type==="local"?Tbt(t):Ebt(t)}function Tbt({vertexSpace:t,transform:e,inSpatialReference:i,outSpatialReference:r,localMode:s,outPositions:n,positions:o}){const a=t.origin??$n,l=t.origin!=null?(e==null?void 0:e.localMatrix)??Vr:Vr,c=xu(i),u=r.isWebMercator&&s||!Ac(i,c)?i:c;mu(i,a,t0,u),dr(t0,t0,l);const d=n??ho(o.length);return X1(d,o,t0),ns(d,u,0,d,r,0,d.length/3),d}function Ebt({vertexSpace:t,transform:e,outPositions:i,positions:r,inSpatialReference:s,outSpatialReference:n}){const o=t.origin!=null?(e==null?void 0:e.localMatrix)??Vr:Vr,a=i??ho(r.length);RB(o,Vr)?Nst(a,r):X1(a,r,o);const l=t.origin??$n;if(!Oo(l,$n)){const[c,u,d]=l;for(let p=0;p<a.length;p+=3)a[p]+=c,a[p+1]+=u,a[p+2]+=d}return ns(a,s,0,a,n,0,a.length/3)?a:null}function Cbt(t){return t.isWGS84||MM(t)||dT(t)||pT(t)}(function(t){t[t.NORMAL=0]="NORMAL",t[t.TANGENT=1]="TANGENT"})(Ka||(Ka={})),function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"}($0||($0={}));const hF=E(),em=E(),t0=Ee(),io=Gr(),lXt=Object.freeze(Object.defineProperty({__proto__:null,get VectorType(){return Ka},loadProjectErrorMessage:_bt,logProjectionError:vbt,project:nLe,projectFromPCPF:xbt,projectNormalFromPCPF:bbt,projectNormalToPCPF:iLe,projectTangentFromPCPF:Sbt,projectTangentToPCPF:sLe,projectToPCPF:wbt,transformNormal:JX,transformTangent:QX,transformVectorENUPlateCarree:KX,transformVectorWMPlateCarree:eJ},Symbol.toStringTag,{value:"Module"}));var Lm;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(Lm||(Lm={}));let oLe=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=d0.KTX2_ENCODING}};function pI(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function Mbt(t){const e=new Blob([t]),i=await e.text();return JSON.parse(i)}async function Abt(t,e){if(e===d0.KTX2_ENCODING)return new oLe(t);const i=new Blob([t],{type:e}),r=URL.createObjectURL(i),s=new Image;if(re("esri-iPhone"))return new Promise((n,o)=>{const a=()=>{c(),n(s)},l=u=>{c(),o(u)},c=()=>{URL.revokeObjectURL(r),s.removeEventListener("load",a),s.removeEventListener("error",l)};s.addEventListener("load",a),s.addEventListener("error",l),s.src=r});try{s.src=r,await s.decode()}catch{console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(r),s}function Zm(t){if(t==null)return null;const e=t.offset!=null?t.offset:a$e,i=t.rotation!=null?t.rotation:0,r=t.scale!=null?t.scale:l$e,s=U$(1,0,0,0,1,0,e[0],e[1],1),n=U$(Math.cos(i),-Math.sin(i),0,Math.sin(i),Math.cos(i),0,0,0,1),o=U$(r[0],0,0,0,r[1],0,0,0,1),a=Gr();return jM(a,n,o),jM(a,s,a),a}const Pbt={disableDelayMs:2e3};let Obt=class extends Bg{constructor(){super(...arguments),this.fastTransformUpdatesAllowed=!1,this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1,this._autoDisableFastUpdatesTimeoutId=0}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}destroy(){super.destroy(),this._cancelAutoDisableFastUpdates()}enableFastTransformUpdates(e,i){if(!this.fastTransformUpdatesAllowed||this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!0;const{stageObject:r}=this,s=r.geometries.slice();r.removeAllGeometries();const n=WU(IH,r.transformation),o=i.getOrigin(n);for(const a of s){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,r.addGeometry(c)}this._originalGeometries=s}autoDisableFastTransformUpdates(e){this._cancelAutoDisableFastUpdates(),this._autoDisableFastUpdatesTimeoutId=setTimeout(()=>{this._autoDisableFastUpdatesTimeoutId=0,e()},Pbt.disableDelayMs)}updateAutoDisableFastTransformUpdates(e){this._autoDisableFastUpdatesTimeoutId&&this.autoDisableFastTransformUpdates(e)}_cancelAutoDisableFastUpdates(){clearTimeout(this._autoDisableFastUpdatesTimeoutId),this._autoDisableFastUpdatesTimeoutId=0}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!1;const{stageObject:i}=this,r=i.geometries.map(s=>e(s.material));i.removeAllGeometries();for(let s=0;s<this._originalGeometries.length;s++){const n=this._originalGeometries[s],o=r[s];o.setParameters({modelTransformation:null}),o===n.material?i.addGeometry(n):i.addGeometry(n.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,i,r){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:s}=this;if(s.geometries.length===0)return;const n=s.geometries[0].localOrigin,o=WU(IH,e),a=r.getOrigin(o);if(a===n)return;const l=(i==null?void 0:i.localMatrix)??Vr;s.shaderTransformation=null,s.transformation=e,s.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,i,r){const{stageObject:s}=this,n=(i==null?void 0:i.localMatrix)??Vr;if(!this._fastTransformUpdatesEnabled)return s.shaderTransformation=null,s.transformation=e,s.geometries.forEach(m=>m.transformation=n),void this._updateEdgeTransform(r);const o=s.transformation,a=s.geometries[0].transformation,l=e,c=n,u=dr(gme,o,a),d=dr(yme,l,c),p=dr(_me,d,In(_me,a));s.shaderTransformation=p,this._setFastMaterialTransformation({matA:u,matB:d}),this._updateEdgeTransform(r)}alignWithElevation(e,i,r,s){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,i,r,s);r!=null&&WG(this.elevationContext.featureExpressionInfoContext,r);const n=(g,y)=>W1(g,e,this.elevationContext,i,y),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=dr(gme,a,l),u=o.effectiveTransformation,d=vn(Rbt,u);this.alignedSampledElevation=TS(this,this.elevationContext,e.spatialReference,n,i,d),o.shaderTransformation=d;const p=o.geometries[0].transformation,m=dr(yme,d,p);this._setFastMaterialTransformation({matA:c,matB:m}),this._updateEdgeTransform(s)}_setFastMaterialTransformation({matA:e,matB:i}){const{stageObject:r}=this;if(r.geometries.length===0)return;const s=r.geometries[0].localOrigin,n=yT($bt,oe(IH,s.vec3,-1)),o=dr(vme,n,e),a=dr(bme,n,i),l=In(vme,o),c=dr(bme,a,l);for(const u of r.geometries)u.material.setParameters({modelTransformation:c})}_updateEdgeTransform(e){const{stageObject:i,_stageLayer:r}=this;r.stage.renderer.withEdgeView(s=>{s.fastUpdateObject3DEdgesTransform(i)||this.resetEdgeObject(e)})}};const IH=E(),gme=Ee(),yme=Ee(),Rbt=Ee(),_me=Ee(),vme=Ee(),bme=Ee(),$bt=Ee();let Ibt=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,i,r){e.enableFastTransformUpdates(s=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(s))return s;const o=i.byMaterial(s);return this._fastTransformOriginalMaterials.set(s,o),i.delete(s),s}const n=new If(s.parameters);return r.stage.add(n),this._fastTransformClonedMaterials.set(n,s),n},r.localOriginFactory)}disable(e,i,r){const s=new Set,n=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,u=this._fastTransformOriginalMaterials.get(c);return i.has(u.uid)?(s.add(c),i.byUid(u.uid).material):(n.add(c),u.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),r.stage.remove(a),l});for(const o of s)this._fastTransformOriginalMaterials.delete(o),r.stage.remove(o);for(const o of n){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),i.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,i,r){this._graphicReferenceCount--,this.disable(e,i,r)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:i})=>i)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},Lbt=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,i){this._byUid.set(e,i),this._byMaterial.set(i.material,i)}delete(e){var r;const i=(r=this._byMaterial.get(e))==null?void 0:r.uid;i&&(this._byUid.delete(i),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};const Dbt=Ts().vec3f(R.POSITION),Nbt=Ts().vec3f(R.POSITION).vec2f(R.UV0),Fbt=Ts().vec3f(R.POSITION).vec4u8(R.COLOR),kbt=Ts().vec3f(R.POSITION).vec2f(R.UV0).vec4u8(R.OBJECTANDLAYERIDCOLOR);function aLe(t){const e=new Vi,{vertex:i,fragment:r}=e;return e.include(Ja,t),e.include(DT,t),bc(i,t),e.attributes.add(R.POSITION,"vec3"),e.varyings.add("vpos","vec3"),i.code.add(S`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`),t.output===G.Highlight&&e.include(gb,t),e.include(gn,t),r.uniforms.add(new qe("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),t.hasVertexColors||r.uniforms.add(new zi("constantColor",s=>s.color)),r.code.add(S`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    ${t.output===G.ObjectAndLayerIdColor?S`color.a = 1.0;`:""}

    if (color.a < ${S.float(Xo)}) {
      discard;
    }

    ${t.output===G.Color?S`fragColor = highlightSlice(color, vpos);`:""}
    ${t.output===G.Highlight?S`outputHighlight();`:""}
  }
  `),e}const Ubt=Object.freeze(Object.defineProperty({__proto__:null,build:aLe},Symbol.toStringTag,{value:"Module"}));let lLe=class cLe extends Wi{initializeProgram(e){return new Yi(e.rctx,cLe.shader.get().build(this.configuration),wi)}initializePipeline(){const e=this.configuration,i=sa(Pe.SRC_ALPHA,Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA,Pe.ONE_MINUS_SRC_ALPHA),r=(s,n=null,o=null)=>Gt({blending:n,depthTest:Ere,depthWrite:o,colorWrite:Kt,stencilWrite:e.hasOccludees?Mg:null,stencilTest:e.hasOccludees?s?Z1:_b:null});return e.output===G.Color?(this._occludeePipelineState=r(!0,e.transparent?i:null,Tu),r(!1,e.transparent?i:null,Tu)):r(!1)}get primitiveType(){return vi.LINES}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};lLe.shader=new Bi(Ubt,()=>fe(()=>Promise.resolve().then(()=>xUt),void 0));let xE=class extends Ec{constructor(){super(...arguments),this.output=G.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.hasOccludees=!1}};h([B({count:G.COUNT})],xE.prototype,"output",void 0),h([B()],xE.prototype,"hasSlicePlane",void 0),h([B()],xE.prototype,"hasVertexColors",void 0),h([B()],xE.prototype,"transparent",void 0),h([B()],xE.prototype,"hasOccludees",void 0);let LH=class extends mb{constructor(e){super(e,new Vbt),this._configuration=new xE,this.produces=new Map([[_e.OPAQUE_MATERIAL,i=>i===G.Color||i===G.Highlight||i===G.ObjectAndLayerIdColor]])}getConfiguration(e){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration}intersect(e,i,r,s,n,o){if(!r.options.selectionMode||!e.visible)return;if(!wMe(i))return void ie.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes.get(R.POSITION).data,l=r.camera,c=Gbt;Aa(c,r.point);const u=2;ne(tO[0],c[0]-u,c[1]+u,0),ne(tO[1],c[0]+u,c[1]+u,0),ne(tO[2],c[0]+u,c[1]-u,0),ne(tO[3],c[0]-u,c[1]-u,0);for(let y=0;y<4;y++)if(!l.unprojectFromRenderScreen(tO[y],sy[y]))return;qa(l.eye,sy[0],sy[1],DH),qa(l.eye,sy[1],sy[2],NH),qa(l.eye,sy[2],sy[3],FH),qa(l.eye,sy[3],sy[0],kH);let d=Number.MAX_VALUE,p=0;for(let y=0;y<a.length-5;y+=3){if(Kl[0]=a[y]+i[12],Kl[1]=a[y+1]+i[13],Kl[2]=a[y+2]+i[14],ec[0]=a[y+3]+i[12],ec[1]=a[y+4]+i[13],ec[2]=a[y+5]+i[14],Er(DH,Kl)<0&&Er(DH,ec)<0||Er(NH,Kl)<0&&Er(NH,ec)<0||Er(FH,Kl)<0&&Er(FH,ec)<0||Er(kH,Kl)<0&&Er(kH,ec)<0)continue;if(l.projectToRenderScreen(Kl,Xb),l.projectToRenderScreen(ec,Jb),Xb[2]<0&&Jb[2]>0){ve(tm,Kl,ec);const b=l.frustum,w=-Er(b[_r.NEAR],Kl)/pe(tm,b[_r.NEAR]);oe(tm,tm,w),me(Kl,Kl,tm),l.projectToRenderScreen(Kl,Xb)}else if(Xb[2]>0&&Jb[2]<0){ve(tm,ec,Kl);const b=l.frustum,w=-Er(b[_r.NEAR],ec)/pe(tm,b[_r.NEAR]);oe(tm,tm,w),me(ec,ec,tm),l.projectToRenderScreen(ec,Jb)}else if(Xb[2]<0&&Jb[2]<0)continue;Xb[2]=0,Jb[2]=0;const v=Yee(_S(Xb,Jb,Sme),c);v<d&&(d=v,ce(wme,Kl),ce(xme,ec),p=y/3)}const m=r.rayBegin,g=r.rayEnd;if(d<u*u){let y=Number.MAX_VALUE;if(YSe(_S(wme,xme,Sme),_S(m,g,Bbt),Zb)){ve(Zb,Zb,m);const v=Ae(Zb);oe(Zb,Zb,1/v),y=v/wr(m,g)}o(y,Zb,p,!1)}}intersectDraped(e,i,r,s,n,o){if(!r.options.selectionMode)return;const a=e.attributes.get(R.POSITION).data,l=e.attributes.get(R.SIZE),c=l?l.data[0]:0,u=s[0],d=s[1],p=((c+1)/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,g=0;for(let y=0;y<a.length-5;y+=3){const v=a[y],b=a[y+1],w=u-v,x=d-b,T=a[y+3]-v,C=a[y+4]-b,M=Te((T*w+C*x)/(T*T+C*C),0,1),O=T*M-w,D=C*M-x,k=O*O+D*D;k<m&&(m=k,g=y/3)}m<p*p&&n(o.dist,o.normal,g,!1)}createGLMaterial(e){return new zbt(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?Fbt:Dbt;return new KA(e)}},zbt=class extends pb{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===G.Color&&this._updateOccludeeState(e),this.ensureTechnique(lLe,e)}},Vbt=class extends ore{constructor(){super(...arguments),this.color=Md,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.hasOccludees=!1}};const Kl=E(),ec=E(),tm=E(),Zb=E(),Xb=xa(),Jb=xa(),wme=E(),xme=E(),Sme=Ff(),Bbt=Ff(),Gbt=E(),tO=[xa(),xa(),xa(),xa()],sy=[E(),E(),E(),E()],DH=Qi(),NH=Qi(),FH=Qi(),kH=Qi(),jbt=["mesh"];let Hbt=class extends Gg{constructor(e,i,r,s){super(e,i,r,s),this._materialInfoCache=new Lbt,this._fastUpdateProcessor=new Ibt,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Rr.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new LH({color:[1,0,1,1]}),this._debugTangentNormalMaterial=new LH({color:[1,.5,0,1]}),this._debugFaceNormalMaterial=new LH({color:[0,1,1,1]}))}destroy(){super.destroy(),this._textures.forEach(e=>e.unload()),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,jbt,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i),s=e.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,i){const r=this._getLayerOpacity();this._updateMaterialParameters(s=>{s.material.setParameters({layerOpacity:r});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),e.forEach(s=>{var n;return(n=i(s))==null?void 0:n.layerOpacityChanged(r,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Y1)}slicePlaneEnabledChanged(e,i){return this._updateMaterialParameters(({material:r})=>{r.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(r=>{var s;return(s=i(r))==null?void 0:s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:i})=>i.setParameters({usePBR:e})),!0}updateTransform(e,i,r,s){if(!e.fastTransformUpdatesAllowed)return!1;const n=e.fastTransformUpdatesEnabled;switch(s){case Lm.EnableFastUpdates:if(n)return!0;break;case Lm.DisableFastUpdates:if(!n)return!0;break;default:if(!n)return!!this.updateTransform(e,i,r,Lm.EnableFastUpdates)&&(e.autoDisableFastTransformUpdates(()=>this.updateTransform(e,i,r,Lm.DisableFastUpdates)),!0)}const o=this._context.renderCoordsHelper.spatialReference,a=rwt,{origin:l,transform:c}=r;if(!mu(i,ne(Wr,l.x,l.y,l.z??0),a,o))return!1;switch(s){case Lm.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case Lm.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case Lm.UpdateFastLocalOrigin:e.updateFastLocalOrigin(a,c,this._context.localOriginFactory)}const{elevationContext:u}=e;u.centerPointInElevationSR=this._getCenterPointInElevationSR(a);const{elevationProvider:d,renderCoordsHelper:p}=this._context,m=(g,y)=>W1(g,d,u,p,y);return e.alignedSampledElevation=TS(e,u,d.spatialReference,m,p,a),e.updateTransform(a,c,this._context.isAsync),e.updateAutoDisableFastTransformUpdates(()=>this.updateTransform(e,i,r,Lm.DisableFastUpdates)),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_materialPropertiesDefault(e,i){const r=this._requiresSymbolVertexColors(),s=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${i},svc:${r}`}}_materialProperties(e,i,r){const s=this._materialPropertiesDefault(e,r);if(!i.material)return s;const{color:n,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:u,alphaCutoff:d,alphaMode:p}=i.material,m=Qb(n),g=Qb(o),y=rO(a),v=Qb(l),b=rO(c);if(s.color=n,s.colorTexture=o,s.normalTexture=l,s.uid=`${s.uid},cmuid:${m},ctmuid:${g},cttuid:${y},ntmuid:${v},nttuid:${b},ds:${u},ac:${d},am:${p}`,i.material instanceof tLe){const{metallic:w,roughness:x,metallicRoughnessTexture:T,metallicRoughnessTextureTransform:C,emissiveColor:M,emissiveTexture:O,emissiveTextureTransform:D,occlusionTexture:k,occlusionTextureTransform:U}=i.material,H=Qb(T),z=rO(C),Z=Qb(M),q=Qb(O),Y=rO(D),de=Qb(k),L=rO(U);s.metallic=w,s.roughness=x,s.metallicRoughnessTexture=T,s.emissiveColor=M,s.emissiveTexture=O,s.occlusionTexture=k,s.colorTextureTransform=iO(a),s.normalTextureTransform=iO(c),s.emissiveTextureTransform=iO(D),s.occlusionTextureTransform=iO(U),s.metallicRoughnessTextureTransform=iO(C),s.uid=`${s.uid},mrm:${w},mrr:${x},mrt:${H},mrtt:${z},emuid:${Z},etmuid:${q},ett:${Y},otmuid:${de},ott:${L}`}return s}_getInternalTextureId(e){const i=this._getInternalTexture(e,Cr.Opaque);return i==null?void 0:i.id}_getInternalTexture(e,i){const r=ewt(e);if(!r)return null;const s=`${e.contentHash}/${i}`;let n=this._textures.get(s);if(!n){let o=null;const a=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,l={wrap:Jbt(e.wrap),noUnpackFlip:!0,maxAnisotropy:a,mipmap:a>1};pI(r)?(o=r.data,l.preMultiplyAlpha=!1,l.encoding=r.encoding):(o=r,l.preMultiplyAlpha=i!==Cr.Opaque,l.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),n=new J1(o,l),this._textures.set(s,n),n.load(this._context.stage.renderView.renderingContext),this._context.stage.add(n)}return n}_setInternalMaterialParameters(e,i){var s,n;if(e.color!=null&&Kbt(e.color,i),e.colorTexture!=null){const o=this._getInternalTexture(e.colorTexture,i.textureAlphaMode);o?(i.textureId=o.id,i.textureAlphaPremultiplied=!!o.parameters.preMultiplyAlpha):i.textureId=void 0}e.normalTexture&&(i.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor&&(i.emissiveFactor=Oe.toUnitRGB(e.emissiveColor)),e.emissiveTexture&&(i.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture&&(i.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture&&(i.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),i.colorTextureTransformMatrix=Zm(e.colorTextureTransform),i.normalTextureTransformMatrix=Zm(e.normalTextureTransform);const r=((s=e.normalTextureTransform)==null?void 0:s.scale)!=null?(n=e.normalTextureTransform)==null?void 0:n.scale:IB;i.scale=[r[0],r[1]],i.occlusionTextureTransformMatrix=Zm(e.occlusionTextureTransform),i.emissiveTextureTransformMatrix=Zm(e.emissiveTextureTransform),i.metallicRoughnessTextureTransformMatrix=Zm(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){var s,n;const i=this._drivenProperties.color;let r=((s=this.symbolLayer.material)==null?void 0:s.colorMixMode)??null;if(i)e.externalColor=Md;else{const o=((n=this.symbolLayer.material)==null?void 0:n.color)??null;o?e.externalColor=Oe.toUnitRGBA(o):(r=null,e.externalColor=Md)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}_getOrCreateMaterial(e,i){var g,y,v;const r=(g=i.material)==null?void 0:g.color,s=(y=i.material)==null?void 0:y.colorTexture,n=(v=i.material)==null?void 0:v.alphaMode,o=n==="blend",a=n!=="opaque"&&(Qbt(e)||r!=null&&r.a<1||(s==null?void 0:s.transparent)||o),l=this._materialProperties(e,i,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const u={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:i.material?i.material.alphaMode:"opaque"},d=ARe({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:Oe.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),p={usePBR:this._usePBR(),isSchematic:d,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:$n,diffuse:s0,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Nr.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p.mrrFactors=d?[...Cre]:[l.metallic,l.roughness,XG[2]],i.material&&(p.doubleSided=i.material.doubleSided,p.cullFace=i.material.doubleSided?Nr.None:Nr.Back,p.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(p),this._setMaterialTransparentParameter(p,u),this._setInternalMaterialParameters(l,p);const m=new If(p);return u.material=m,this._materialInfoCache.set(l.uid,u),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,i){e.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,i.alphaMode==="auto"?e.textureAlphaMode=e.transparent?Cr.MaskBlend:Cr.Opaque:e.textureAlphaMode=i.alphaMode==="opaque"?Cr.Opaque:i.alphaMode==="mask"?Cr.Mask:Cr.Blend}_createFaceDebugNormals(e,i){const r=i.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),o=[],a=[],l=i[0].transformation,c=D1(Gr(),l);for(let u=0;u<r;u++){const d=i[u].attributes.get(R.POSITION);if(!d)continue;const p=d.data,m=d.indices;for(let g=0;g<m.length;g+=3)yj(p,m,g,Vm),hLe(p,m,g,Wr,pd,vC),me(Wr,Wr,pd),me(Wr,Wr,vC),oe(Wr,Wr,1/3),He(Wr,Wr,l),o.push(...Wr),Qo(Vm,Vm,c),ge(Vm,Vm),On(Wr,Wr,Vm,n),o.push(...Wr),a.push(a.length),a.push(a.length)}return o.length?new bn(this._debugFaceNormalMaterial,[[R.POSITION,new it(o,a,3,!0)]],null,Ls.Line):null}_createPerVertexDebugVectors(e,i,r,s,n){const o=i.length,a=e.spatialReference.isGeographic?20015077/180:1,l=.1*n*Math.max(e.extent.width*a,e.extent.height*a,e.extent.zmax-e.extent.zmin),c=[],u=[],d=i[0].transformation,p=D1(Gr(),d);r===R.TANGENT&&Xd(p,d);for(let m=0;m<o;m++){const g=i[m],y=g.attributes.get(R.POSITION),v=g.attributes.get(r);if(!y||!v)continue;const b=y.data,w=y.indices,x=v.data,T=v.indices;for(let C=0;C<w.length;C++){const M=3*w[C],O=T[C]*v.stride;ne(Wr,b[M+0],b[M+1],b[M+2]),He(Wr,Wr,d),c.push(...Wr),ne(pd,x[O+0],x[O+1],x[O+2]),Qo(pd,pd,p),ge(pd,pd),On(Wr,Wr,pd,l),c.push(...Wr),u.push(u.length),u.push(u.length)}}return c.length?new bn(s,[[R.POSITION,new it(c,u,3,!0)]],null,Ls.Line):null}_createAs3DShape(e,i,r,s){const n=e.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,i,s);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;if(Rr.DRAW_MESH_GEOMETRY_NORMALS){const v=this._createPerVertexDebugVectors(n,a,R.NORMAL,this._debugVertexNormalMaterial,1),b=this._createPerVertexDebugVectors(n,a,R.TANGENT,this._debugTangentNormalMaterial,.5),w=this._createFaceDebugNormals(n,a);v&&a.push(v),b&&a.push(b),w&&a.push(w)}const c=new vb({geometries:a,layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0});c.transformation=l;const u=pRe(this.symbolLayer,{opacity:this._getLayerOpacity()}),d=u?new Bht(a[0].material,[u],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,p=new Obt(this,c,a,null,null,TS,r,d);this._fastUpdateProcessor.onAddGraphic(),p.needsElevationUpdates=Y1(r.mode),p.useObjectOriginAsAttachmentOrigin=!0,p.fastTransformUpdatesAllowed=this._fastTransformUpdatesAllowed(n),r.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:m,renderCoordsHelper:g}=this._context,y=(v,b)=>W1(v,m,r,g,b);return p.alignedSampledElevation=TS(p,r,m.spatialReference,y,g),p}_fastTransformUpdatesAllowed(e){const{vertexSpace:i,spatialReference:r}=e;if(!fj(i))return!1;const{type:s}=i,{view:n}=this._context.graphicsCoreOwner,{viewingMode:o}=n.state,a=n.spatialReference;return o===Ge.Global&&s==="local"||o===Ge.Local&&gs(a,r)&&s==="georeferenced"&&!r.isGeographic}_getCenterPointInElevationSR(e){const i=nb(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return ob([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,i),i}_passthroughReprojectionInfo(e){return e.reprojection===qc.NONE&&!!e.objectTransformation}_createPositionBuffer(e,i){const r=e.vertexAttributes.position;let s=r,n=null;if(i.reprojection===qc.NONE)return{position:s,georeferencedPositionBuffer:n};const o=i.reprojection===qc.RENDER?i.transformBeforeProject:null;o&&(s=X1(new Float64Array(s.length),s,o));const{normal:a,tangent:l}=e.vertexAttributes;this._passthroughReprojectionInfo(i)||!a&&!l||(n=s);const c=s===r||s===n?new Float64Array(s.length):s;return ns(s,e.spatialReference,0,c,this._context.renderCoordsHelper.spatialReference,0,s.length/3),{position:c,georeferencedPositionBuffer:n}}_createNormalBuffer(e,i,r,s){const n=e.vertexAttributes.normal;if(n==null)return null;let o=n;const a=s.reprojection===qc.RENDER?s.transformBeforeProject:null;a&&(o=JX(o,new Float32Array(o.length),a));const l=this._context.graphicsCoreOwner.view.viewingMode;if(s.reprojection===qc.NONE)return o;if(l==="local"){if(!NS(this._context.renderCoordsHelper.spatialReference))return o;if(r==null)return null;if(e.spatialReference.isGeographic){const u=o===n?new Float32Array(o.length):o;return KX(o,Ka.NORMAL,r,u)}if(e.spatialReference.isWebMercator){const u=o===n?new Float32Array(o.length):o;return eJ(o,Ka.NORMAL,r,u)}return o}if(r==null)return null;const c=o===n?new Float32Array(o.length):o;return iLe(o,r,i,e.spatialReference,c)}_createTangentBuffer(e,i,r,s){const n=e.vertexAttributes.tangent;if(n==null)return null;let o=n;const a=s.reprojection===qc.RENDER?s.transformBeforeProject:null;a&&(o=QX(o,new Float32Array(o.length),a));const l=this._context.graphicsCoreOwner.view.viewingMode;if(s.reprojection===qc.NONE)return o;if(l==="local"){if(!NS(this._context.renderCoordsHelper.spatialReference))return o;if(r==null)return null;if(e.spatialReference.isGeographic){const u=o===n?new Float32Array(o.length):o;return KX(o,Ka.TANGENT,r,u)}if(e.spatialReference.isWebMercator){const u=o===n?new Float32Array(o.length):o;return eJ(o,Ka.TANGENT,r,u)}return o}if(r==null)return null;const c=o===n?new Float32Array(o.length):o;return sLe(o,r,i,e.spatialReference,c)}_createSymbolColorBuffer(e){var i,r;if(this._requiresSymbolVertexColors()){const s=this._getVertexOpacityAndColor(e),n=uRe((r=(i=this.symbolLayer)==null?void 0:i.material)==null?void 0:r.colorMixMode),o=new Uint8Array(4);return hRe(s,n,o),o}return null}_createBuffers(e,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=e.vertexAttributes.normal,n=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(s&&s.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(n&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),{position:l,georeferencedPositionBuffer:c}=this._createPositionBuffer(e,a),u=twt(e),d=this._createSymbolColorBuffer(i),p=this._createNormalBuffer(e,l,c,a),m=this._createTangentBuffer(e,l,c,a),g=n,{transformation:y,position:v,normal:b,tangent:w}=this._passthroughReprojectionInfo(a)?{transformation:a.objectTransformation,position:l,normal:p,tangent:m}:this._transformOriginLocal(e,l,p,m);return{positionBuffer:v,normalBuffer:b,tangentBuffer:w,uvBuffer:g,colorBuffer:u,symbolColorBuffer:d,objectTransformation:y,geometryTransformation:a.reprojection===qc.NONE&&a.geometryTransformation?a.geometryTransformation:Ee()}}_computeReprojectionInfo(e){var l;const{vertexSpace:i}=e,r=i.type==="georeferenced"?gs(this._context.renderCoordsHelper.spatialReference,e.spatialReference)?qc.NONE:qc.RENDER:qc.NONE;if(cbt(i))return{reprojection:r};const s=i.origin,n=Ee(),o=((l=e.transform)==null?void 0:l.localMatrix)??Vr;if(r===qc.NONE)return mu(e.spatialReference,s,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:zM(o)};const a=yT(Ee(),s);return dr(a,a,o),{reprojection:r,transformBeforeProject:a}}_transformOriginLocal(e,i,r,s){const n=this._context.renderCoordsHelper.spatialReference,o=e.anchor;dF[0]=o.x,dF[1]=o.y,dF[2]=o.z??0;const a=Ee();mu(e.spatialReference,dF,a,n),In(pF,a);const{position:l,normal:c,tangent:u}=e.vertexAttributes,d=i===l?new Float64Array(i.length):i;X1(d,i,pF);const p=r?r===c?new Float32Array(r.length):r:null,m=s?s===u?new Float32Array(s.length):s:null;return r&&p&&JX(r,p,pF),s&&m&&QX(s,m,pF),{transformation:a,position:d,normal:p,tangent:m}}_validateFaces(e,i){const r=e.vertexAttributes.position.length/3,s=i.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(r<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_isOutsideClippingArea(e){var o;if(!this._context.clippingExtent)return!1;const i=(o=e.vertexAttributes)==null?void 0:o.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference,s=nLe({positions:i,transform:e.transform,vertexSpace:e.vertexSpace,inSpatialReference:e.spatialReference,outSpatialReference:r??e.spatialReference,localMode:this._context.stage.viewingMode===Ge.Local});if(!s)return!1;const n=s.length/3;return Br(zH),yh(zH,s,0,n),!af(zH,this._context.clippingExtent)}_createGeometryInfo(e,i,r){if(!Ac(e.spatialReference,this._context.renderCoordsHelper.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(!this._validateVertexSpace(e)||this._isOutsideClippingArea(e))return null;const s=this._createBuffers(e,i);if(s==null)return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:u,objectTransformation:d,geometryTransformation:p}=s,m=Xbt(e),g=new Array;let y=!1;const v=WU(Wr,d),b=this._context.localOriginFactory.getOrigin(v);for(const w of m){if(!this._validateFaces(e,w))return null;const x=qbt(e,w);if(x.length===0)continue;const T=Wbt(n,c,w,x);T.didFlipNormals&&(y=!0);const C=[[R.POSITION,new it(n,x,3,!0)],[R.NORMAL,new it(T.normals,T.indices,3,!0)]];a&&C.push([R.COLOR,new it(a,x,4,!0)]),l&&C.push([R.SYMBOLCOLOR,new it(l,fb(x.length),4,!0)]),o&&C.push([R.UV0,new it(o,x,2,!0)]),u&&C.push([R.TANGENT,new it(u,x,4,!0)]);const M=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),O=this._getOrCreateMaterial(e,w),D=new bn(O,C,null,Ls.Mesh,M);D.transformation=p,D.localOrigin=b,g.push(D)}return y&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:g,objectTransformation:d}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((i,r)=>{r.setParameters(i.parameters)})}_validateVertexSpace(e){const{_context:{graphicsCoreOwner:{view:{state:{viewingMode:i}}}}}=this,{vertexSpace:r}=e;return i!==Ge.Local||r.type!=="local"||(this.logger.warn("Displaying a mesh with a local vertex space in a view in local viewing mode is not supported."),!1)}test(){return{...super.test(),materials:this._materialInfoCache.materials}}},mse=class{constructor(e,i,r){this.normals=e,this.indices=i,this.didFlipNormals=r}};function qbt(t,e){return e.faces??RT(t.vertexAttributes.position.length/3)}function Wbt(t,e,i,r){switch(i.shading||"flat"){default:case"source":return Ybt(t,e,i,r);case"flat":return uLe(t,r);case"smooth":return Zbt(t,r)}}function uLe(t,e){const i=ws(e.length),r=new Array(3*e.length);for(let s=0;s<e.length;s+=3){const n=yj(t,e,s,Vm);for(let o=0;o<3;o++)i[s+o]=n[o],r[s+o]=s/3}return new mse(i,r,!1)}function Ybt(t,e,i,r){if(e==null)return uLe(t,r);let s=!1;if(!i.trustSourceNormals)for(let n=0;n<r.length;n+=3){yj(t,r,n,Vm);for(let o=0;o<3;o++){const a=3*r[n+o];Wr[0]=e[a],Wr[1]=e[a+1],Wr[2]=e[a+2],pe(Vm,Wr)<0&&(e[a]=-e[a],e[a+1]=-e[a+1],e[a+2]=-e[a+2],s=!0)}}return new mse(e,r,s)}function Zbt(t,e){const i={};for(let n=0;n<e.length;n+=3){const o=yj(t,e,n,Vm);for(let a=0;a<3;a++){const l=e[n+a];let c=i[l];c||(c={normal:E(),count:0},i[l]=c),me(c.normal,c.normal,o),c.count++}}const r=ws(3*e.length),s=new Array(3*e.length);for(let n=0;n<e.length;n++){const o=i[e[n]];o.count!==1&&(ge(o.normal,o.normal),o.count=1);for(let a=0;a<3;a++)r[3*n+a]=o.normal[a];s[n]=n}return new mse(r,s,!1)}function hLe(t,e,i,r,s,n){const o=3*e[i],a=3*e[i+1],l=3*e[i+2];r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],s[0]=t[a],s[1]=t[a+1],s[2]=t[a+2],n[0]=t[l],n[1]=t[l+1],n[2]=t[l+2]}function yj(t,e,i,r){return hLe(t,e,i,Wr,pd,vC),ve(pd,pd,Wr),ve(vC,vC,Wr),ot(Wr,pd,vC),ge(r,Wr),r}function Xbt(t){return t.components??swt}function iO(t){if(!t)return null;const{scale:e,offset:i,rotation:r}=t;return{scale:e,offset:i,rotation:Rt(r)}}function Jbt(t="repeat"){if(typeof t=="string"){const e=UH(t);return{s:e,t:e}}return{s:UH(t.horizontal),t:UH(t.vertical)}}function UH(t){switch(t){case"clamp":return bi.CLAMP_TO_EDGE;case"mirror":return bi.MIRRORED_REPEAT;default:return bi.REPEAT}}function Qbt(t){const e=t.vertexAttributes.color;if(e==null)return!1;for(let i=3;i<e.length;i+=4)if(e[i]!==255)return!0;return!1}function Kbt(t,e){e.diffuse=Oe.toUnitRGB(t),e.opacity=t.a}function ewt(t){return t.data??t.url}function Qb(t){return t==null?"-":t instanceof Oe?t.toHex():t.contentHash}function rO(t){const{offset:e,scale:i,rotation:r}=t??iwt;return`${e[0]},${e[1]},${r},${i[0]},${i[1]}`}function twt(t){return t.vertexAttributes.color}const iwt=new cM,dF=E(),Wr=E(),pd=E(),vC=E(),Vm=E(),pF=Ee(),rwt=Ee(),zH=Jn(),swt=[new obt];var qc;(function(t){t[t.NONE=0]="NONE",t[t.RENDER=1]="RENDER"})(qc||(qc={}));let nwt=class{constructor(e,i,r,s){this.graphics3DSymbolLayer=e,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const i=this._lodRenderer.instanceData;e!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,i,r){if(this.elevationAligner){WG(this.elevationContext.featureExpressionInfoContext,r);const s=(o,a)=>W1(o,e,this.elevationContext,i,a),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,i);n!=null&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(e=E()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,im),He(e,this._lodRenderer.baseBoundingSphere.center,im)}getBoundingBoxObjectSpace(e=Jn()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,im);const i=this._lodRenderer.baseBoundingBox;Br(e);for(let r=0;r<8;++r)ne(zh,1&r?i[3]:i[0],2&r?i[4]:i[1],4&r?i[5]:i[2]),He(zh,zh,im),Af(e,zh);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,im),e.render.origin[0]+=im[12],e.render.origin[1]+=im[13],e.render.origin[2]+=im[14],e.render.num++}async getProjectedBoundingBox(e,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=owt,l=qte(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,im);for(let u=0;u<l;u++){const d=a[u];zh[0]=o[d[0]],zh[1]=o[d[1]],zh[2]=o[d[2]],He(zh,zh,im),Kb[3*u]=zh[0],Kb[3*u+1]=zh[1],Kb[3*u+2]=zh[2]}if(!e(Kb,0,l))return null;Br(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],Kb[u+d]),o[d+3]=Math.max(o[d+3],Kb[u+d]);c&&r.push({location:Kb.slice(u,u+3),screenSpaceBoundingRect:c})}if(i&&(of(o,VH),this.elevationContext.mode!=="absolute-height")){let u;const d=gre(o,i.service.spatialReference,i);try{u=await i.service.queryElevation(VH[0],VH[1],s,d,"ground")}catch{}u!=null&&iCe(o,0,0,-this.alignedSampledElevation+u)}return o}addObjectState(e,i){if(e===A0.Highlight){const r=new Mz(e);this._addHighlightId(r),i.addExternal(s=>{this._removeHighlightId(s)},r)}}removeObjectState(e){this._highlights.forEach(i=>e.remove(i))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const Kb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],zh=E(),VH=E(),owt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],im=Ee();function awt(t,e){const i=t.stageResources.geometries.map(s=>new nRe(s,t.stageResources.textures)),r=t.lodThreshold==null||t.lodThreshold===0&&e>0?cwt(i):t.lodThreshold;return new oRe(i,r,t.pivotOffset)}function lwt(t){return new aRe(t.map((e,i)=>awt(e,i)))}function cwt(t){const e=t.reduce((i,{geometry:r})=>i+r.indexCount/3,0);return Math.sqrt(e*uwt/Math.PI)}const uwt=20;function hwt(t){return t=t||globalThis.location.hostname,dwt.some(e=>(t==null?void 0:t.match(e))!=null)}function tJ(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(dLe)!=null||e.match(fLe)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(pLe)!=null||e.match(mLe)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const dLe=/^devext\.arcgis\.com$/,pLe=/^qaext\.arcgis\.com$/,fLe=/^[\w-]*\.mapsdevext\.arcgis\.com$/,mLe=/^[\w-]*\.mapsqa\.arcgis\.com$/,dwt=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local\.esri\.com$/,dLe,pLe,/^jsapps\.esri\.com$/,fLe,mLe];function pwt(t,e){gse(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function gse(t,e,i=2,r=i){const s=e.length/2;let n=0,o=0;if(wg(e)||ZUe(e)){for(let l=0;l<s;++l)t[n]=e[o],t[n+1]=e[o+1],n+=i,o+=r;return}const a=XUe(e);if(YUe(e))for(let l=0;l<s;++l)t[n]=Math.max(e[o]/a,-1),t[n+1]=Math.max(e[o+1]/a,-1),n+=i,o+=r;else for(let l=0;l<s;++l)t[n]=e[o]/a,t[n+1]=e[o+1]/a,n+=i,o+=r}function fwt(t,e,i,r){const s=t.typedBuffer,n=t.typedBufferStride,o=(r==null?void 0:r.count)??t.count;let a=((r==null?void 0:r.dstIndex)??0)*n;for(let l=0;l<o;++l)s[a]=e,s[a+1]=i,a+=n}Object.freeze(Object.defineProperty({__proto__:null,fill:fwt,normalizeIntegerBuffer:gse,normalizeIntegerBufferView:pwt},Symbol.toStringTag,{value:"Module"}));function mwt(t,e){_j(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function _j(t,e,i=3,r=i){const s=e.length/r;let n=0,o=0;for(let a=0;a<s;++a)t[n]=e[o],t[n+1]=e[o+1],t[n+2]=e[o+2],n+=i,o+=r}function gwt(t,e,i,r,s){const n=t.typedBuffer,o=t.typedBufferStride,a=(s==null?void 0:s.count)??t.count;let l=((s==null?void 0:s.dstIndex)??0)*o;for(let c=0;c<a;++c)n[l]=e,n[l+1]=i,n[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:_j,copyView:mwt,fill:gwt},Symbol.toStringTag,{value:"Module"}));function ywt(t,e){yse(t.typedBuffer,e,t.typedBufferStride)}function yse(t,e,i=4){const r=e.typedBuffer,s=e.typedBufferStride,n=e.count;let o=0,a=0;for(let l=0;l<n;++l)t[o]=r[a],t[o+1]=r[a+1],t[o+2]=r[a+2],t[o+3]=r[a+3],o+=i,a+=s}function _wt(t,e,i,r,s,n){const o=t.typedBuffer,a=t.typedBufferStride,l=(n==null?void 0:n.count)??t.count;let c=((n==null?void 0:n.dstIndex)??0)*a;for(let u=0;u<l;++u)o[c]=e,o[c+1]=i,o[c+2]=r,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:yse,copyView:ywt,fill:_wt},Symbol.toStringTag,{value:"Module"}));let gLe=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,i){return this._load("json",e,i)}async loadBinary(e,i){return Og(e)?(Et(i),cee(e)):this._load("binary",e,i)}async loadImage(e,i){return this._load("image",e,i)}async _load(e,i,r){if(this._streamDataRequester==null)return(await Yt(i,{responseType:vwt[e]})).data;const s=await Vd(this._streamDataRequester.request(i,e,r));if(s.ok===!0)return s.value;throw Pn(s.error),new V("",`Request for resource failed: ${s.error}`)}};const vwt={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function bwt(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function wwt(t,e={}){return{data:t,parameters:{wrap:{s:bi.REPEAT,t:bi.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}let GL=class iJ{constructor(e,i,r=""){this.major=e,this.minor=i,this._context=r}lessThan(e,i){return this.major<e||e===this.major&&this.minor<i}since(e,i){return!this.lessThan(e,i)}validate(e){if(this.major!==e.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new V(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new iJ(this.major,this.minor,this._context)}static parse(e,i=""){const[r,s]=e.split("."),n=/^\s*\d+\s*$/;if(!(r!=null&&r.match)||!n.test(r))throw new V((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!(s!=null&&s.match)||!n.test(s))throw new V((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(r,10),a=parseInt(s,10);return new iJ(o,a,i)}};function X5(t,e){const i=t.count;e||(e=new t.TypedArrayConstructor(i));for(let r=0;r<i;r++)e[r]=t.get(r);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:X5},Symbol.toStringTag,{value:"Module"}));let Tme=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const i=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,i,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var fI,Eme;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(fI||(fI={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(Eme||(Eme={}));const yLe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},xwt={pbrMetallicRoughness:yLe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},Swt={ESRI_externalColorMixMode:"tint",ESRI_receiveShadows:!0,ESRI_receiveAmbientOcclusion:!0},Cme=(t={})=>{const e={...yLe,...t.pbrMetallicRoughness},i=Twt({...Swt,...t.extras});return{...xwt,...t,pbrMetallicRoughness:e,extras:i}};function Twt(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode="tint"}return t}const Ewt={magFilter:ii.LINEAR,minFilter:ii.LINEAR_MIPMAP_LINEAR,wrapS:bi.REPEAT,wrapT:bi.REPEAT},Cwt=t=>({...Ewt,...t});function Mwt(t){let e,i;return t.replace(/^(.*\/)?([^/]*)$/,(r,s,n)=>(e=s||"",i=n||"","")),{dirPart:e,filePart:i}}const fF={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let Awt=class lv{constructor(e,i,r,s){if(this._context=e,this.uri=i,this.json=r,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu","KHR_texture_transform"],this._baseUri=Mwt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),r.scenes==null)throw new V("gltf-loader-unsupported-feature","Scenes must be defined.");if(r.meshes==null)throw new V("gltf-loader-unsupported-feature","Meshes must be defined");if(r.nodes==null)throw new V("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,i,r){if(Og(i)){const o=T1(i);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new lv(e,i,l)}catch{}const a=cee(i);if(lv._isGLBData(a))return this._fromGLBData(e,i,a)}if(Lwt.test(i)||(r==null?void 0:r.expectedType)==="gltf"){const o=await e.loadJSON(i,r);return new lv(e,i,o)}const s=await e.loadBinary(i,r);if(lv._isGLBData(s))return this._fromGLBData(e,i,s);if(Dwt.test(i)||(r==null?void 0:r.expectedType)==="glb")throw new V("gltf-loader-invalid-glb","This is not a valid glb file.");const n=await e.loadJSON(i,r);return new lv(e,i,n)}static _isGLBData(e){if(e==null)return!1;const i=new Tme(e);return i.remainingBytes()>=4&&i.readUint32()===fF.MAGIC}static async _fromGLBData(e,i,r){const s=await lv._parseGLBData(r);return new lv(e,i,s.json,s.binaryData)}static async _parseGLBData(e){const i=new Tme(e);if(i.remainingBytes()<12)throw new V("gltf-loader-error","glb binary data is insufficiently large.");const r=i.readUint32(),s=i.readUint32(),n=i.readUint32();if(r!==fF.MAGIC)throw new V("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(e.byteLength<n)throw new V("gltf-loader-error","glb binary data is smaller than header specifies.");if(s!==2)throw new V("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");let o,a,l=0;for(;i.remainingBytes()>=8;){const c=i.readUint32(),u=i.readUint32();if(l===0){if(u!==fF.CHUNK_TYPE_JSON)throw new V("gltf-loader-error","First glb chunk must be JSON.");if(c<0)throw new V("gltf-loader-error","No JSON data found.");o=await Mbt(i.readUint8Array(c))}else if(l===1){if(u!==fF.CHUNK_TYPE_BIN)throw new V("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");a=i.readUint8Array(c)}else ie.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");l+=1}if(!o)throw new V("gltf-loader-error","No glb JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,i){const r=this.json.buffers[e];if(r.uri==null){if(this._glbBuffer==null)throw new V("gltf-loader-error","glb buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(e,i);if(s.byteLength!==r.byteLength)throw new V("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(e,i){const r=this._bufferLoaders.get(e);if(r)return r;const s=this.json.buffers[e].uri,n=this._context.loadBinary(this._resolveUri(s),i).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,n),n}async getAccessor(e,i){if(!this.json.accessors)throw new V("gltf-loader-unsupported-feature","Accessors missing.");const r=this.json.accessors[e];if((r==null?void 0:r.bufferView)==null)throw new V("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(r.type in[fI.MAT2,fI.MAT3,fI.MAT4])throw new V("gltf-loader-unsupported-feature",`AttributeType ${r.type} is not supported`);const s=this.json.bufferViews[r.bufferView],n=await this.getBuffer(s.buffer,i),o=Rwt[r.type],a=$wt[r.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,i){if(e.indices==null)return;const r=await this.getAccessor(e.indices,i);if(r.isDenselyPacked)switch(r.componentType){case Me.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case Me.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case Me.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case Me.UNSIGNED_BYTE:return X5(Vh(rA,r));case Me.UNSIGNED_SHORT:return X5(Vh(CG,r));case Me.UNSIGNED_INT:return X5(Vh(AG,r))}}async getPositionData(e,i){if(e.attributes.POSITION==null)throw new V("gltf-loader-unsupported-feature","No POSITION vertex data found.");const r=await this.getAccessor(e.attributes.POSITION,i);if(r.componentType!==Me.FLOAT)throw new V("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+Me[r.componentType]);if(r.componentCount!==3)throw new V("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return Vh(po,r)}async getNormalData(e,i){if(e.attributes.NORMAL==null)throw new V("gltf-loader-error","No NORMAL vertex data found.");const r=await this.getAccessor(e.attributes.NORMAL,i);if(r.componentType!==Me.FLOAT)throw new V("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+Me[r.componentType]);if(r.componentCount!==3)throw new V("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return Vh(po,r)}async getTangentData(e,i){if(e.attributes.TANGENT==null)throw new V("gltf-loader-error","No TANGENT vertex data found.");const r=await this.getAccessor(e.attributes.TANGENT,i);if(r.componentType!==Me.FLOAT)throw new V("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+Me[r.componentType]);if(r.componentCount!==4)throw new V("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+r.componentCount.toFixed());return new $f(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*r.entryCount)}async getTextureCoordinates(e,i){if(e.attributes.TEXCOORD_0==null)throw new V("gltf-loader-error","No TEXCOORD_0 vertex data found.");const r=await this.getAccessor(e.attributes.TEXCOORD_0,i);if(r.componentCount!==2)throw new V("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+r.componentCount.toFixed());if(r.componentType===Me.FLOAT)return Vh(OT,r);if(!r.normalized)throw new V("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return Iwt(r)}async getVertexColors(e,i){if(e.attributes.COLOR_0==null)throw new V("gltf-loader-error","No COLOR_0 vertex data found.");const r=await this.getAccessor(e.attributes.COLOR_0,i);if(r.componentCount!==4&&r.componentCount!==3)throw new V("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+r.componentCount.toFixed());if(r.componentCount===4){if(r.componentType===Me.FLOAT)return Vh($f,r);if(r.componentType===Me.UNSIGNED_BYTE)return Vh(nl,r);if(r.componentType===Me.UNSIGNED_SHORT)return Vh(_L,r)}else if(r.componentCount===3){if(r.componentType===Me.FLOAT)return Vh(po,r);if(r.componentType===Me.UNSIGNED_BYTE)return Vh(EG,r);if(r.componentType===Me.UNSIGNED_SHORT)return Vh(MG,r)}throw new V("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+Me[r.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,i,r){var n,o,a,l,c,u,d,p,m,g;let s=e.material?this._materialCache.get(e.material):void 0;if(!s){const y=e.material!=null?Cme(this.json.materials[e.material]):Cme(),v=y.pbrMetallicRoughness,b=this.hasVertexColors(e),w=this.getTexture(v.baseColorTexture,i),x=this.getTexture(y.normalTexture,i),T=r?this.getTexture(y.occlusionTexture,i):void 0,C=r?this.getTexture(y.emissiveTexture,i):void 0,M=r?this.getTexture(v.metallicRoughnessTexture,i):void 0,O=e.material!=null?e.material:-1;s={alphaMode:y.alphaMode,alphaCutoff:y.alphaCutoff,color:v.baseColorFactor,doubleSided:!!y.doubleSided,colorTexture:await w,normalTexture:await x,name:y.name,id:O,occlusionTexture:await T,emissiveTexture:await C,emissiveFactor:y.emissiveFactor,metallicFactor:v.metallicFactor,roughnessFactor:v.roughnessFactor,metallicRoughnessTexture:await M,hasVertexColors:b,ESRI_externalColorMixMode:y.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(n=v==null?void 0:v.baseColorTexture)==null?void 0:n.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=y.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(u=(c=y.occlusionTexture)==null?void 0:c.extensions)==null?void 0:u.KHR_texture_transform,emissiveTextureTransform:(p=(d=y.emissiveTexture)==null?void 0:d.extensions)==null?void 0:p.KHR_texture_transform,metallicRoughnessTextureTransform:(g=(m=v==null?void 0:v.metallicRoughnessTexture)==null?void 0:m.extensions)==null?void 0:g.KHR_texture_transform,receiveAmbientOcclusion:y.extras.ESRI_receiveAmbientOcclusion,receiveShadows:y.extras.ESRI_receiveShadows}}return s}async getTexture(e,i){if(!e)return;if((e.texCoord||0)!==0)throw new V("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const r=e.index,s=this.json.textures[r],n=Cwt(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=Mme(s),a=this.json.images[o],l=await this._loadTextureImageData(r,s,i);return V3(this._textureCache,r,()=>{const c=d=>d===33071||d===33648||d===10497,u=d=>{throw new V("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${d}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:u(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:u(n.wrapT),minFilter:n.minFilter,name:a.name,id:r}})}getNodeTransform(e){if(e===void 0)return Pwt;let i=this._nodeTransformCache.get(e);if(!i){const r=this.getNodeTransform(this._getNodeParent(e)),s=this.json.nodes[e];s.matrix?i=dr(Ee(),r,s.matrix):s.translation||s.rotation||s.scale?(i=zM(r),s.translation&&rl(i,i,s.translation),s.rotation&&(mF[3]=ZB(mF,s.rotation),uu(i,i,mF[3],mF)),s.scale&&rL(i,i,s.scale)):i=zM(r),this._nodeTransformCache.set(e,i)}return i}_resolveUri(e){return uh(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=GL.parse(this.json.asset.version,"glTF");Owt.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(i=>this._supportedExtensions.includes(i)))throw new V("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,i)=>{e.children&&e.children.forEach(r=>{this._nodeParentMap.set(r,i)})})}async _loadTextureImageData(e,i,r){const s=this._textureLoaders.get(e);if(s)return s;const n=this._createTextureLoader(i,r);return this._textureLoaders.set(e,n),n}async _createTextureLoader(e,i){const r=Mme(e),s=this.json.images[r];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),i);return new oLe(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),i)}if(s.bufferView==null)throw new V("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new V("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,i);if(n.byteStride!=null)throw new V("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return Abt(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await A9(Array.from(this._bufferLoaders.values())),i=await A9(Array.from(this._textureLoaders.values()));return e.reduce((r,s)=>r+((s==null?void 0:s.byteLength)??0),0)+i.reduce((r,s)=>r+(s?pI(s)?s.data.byteLength:s.width*s.height*4:0),0)}};const Pwt=ESe(Ee(),Math.PI/2),Owt=new GL(2,0,"glTF"),mF=Oh(),Rwt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},$wt={[Me.BYTE]:1,[Me.UNSIGNED_BYTE]:1,[Me.SHORT]:2,[Me.UNSIGNED_SHORT]:2,[Me.HALF_FLOAT]:2,[Me.FLOAT]:4,[Me.INT]:4,[Me.UNSIGNED_INT]:4};function Iwt(t){switch(t.componentType){case Me.BYTE:return new PG(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Me.UNSIGNED_BYTE:return new TG(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Me.SHORT:return new vL(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Me.UNSIGNED_SHORT:return new Oie(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Me.UNSIGNED_INT:return new Rie(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Me.FLOAT:return new OT(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}function Vh(t,e){return new t(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*(e.entryCount-1)+e.componentByteSize*e.componentCount)}function Mme(t){var e;if(((e=t.extensions)==null?void 0:e.KHR_texture_basisu)!=null)return t.extensions.KHR_texture_basisu.source;if(t.source!==null)return t.source;throw new V("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}const Lwt=/\.gltf$/i,Dwt=/\.glb$/i;let Nwt=0;async function _Le(t,e,i={},r=!0){var d,p;const s=await Awt.load(t,e,i),n="gltf_"+Nwt++,o={lods:[],materials:new Map,textures:new Map,meta:Fwt(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=(p=(d=s.json.asset.extras)==null?void 0:d.ESRI_webstyleSymbol)==null?void 0:p.webstyle,c=new Map;await kwt(s,async(m,g,y,v)=>{var Z;const b=c.get(y)??0;c.set(y,b+1);const w=m.mode!==void 0?m.mode:vi.TRIANGLES,x=w===vi.TRIANGLES||w===vi.TRIANGLE_STRIP||w===vi.TRIANGLE_FAN?w:null;if(x==null)return void ie.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+vi[w]+"). Skipping primitive.");if(!s.hasPositions(m))return void ie.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const T=s.getPositionData(m,i),C=s.getMaterial(m,i,r),M=s.hasNormals(m)?s.getNormalData(m,i):null,O=s.hasTangents(m)?s.getTangentData(m,i):null,D=s.hasTextureCoordinates(m)?s.getTextureCoordinates(m,i):null,k=s.hasVertexColors(m)?s.getVertexColors(m,i):null,U=s.getIndexData(m,i),H={name:v,transform:zM(g),attributes:{position:await T,normal:M?await M:null,texCoord0:D?await D:null,color:k?await k:null,tangent:O?await O:null},indices:await U,primitiveType:x,material:zwt(o,await C,n)};let z=null;((Z=o.meta)==null?void 0:Z.ESRI_lod)!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(z=o.meta.ESRI_lod.thresholds[y]),o.lods[y]=o.lods[y]||{parts:[],name:v,lodThreshold:z},o.lods[y].parts[b]=H});for(const m of o.lods)m.parts=m.parts.filter(g=>!!g);const u=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri,ESRI_webstyle:l},customMeta:{},size:u}}function Fwt(t){const e=t.json;let i=null;return e.nodes.forEach(r=>{const s=r.extras;s!=null&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(i=s)}),i}async function kwt(t,e){const i=t.json,r=i.scenes[i.scene||0].nodes,s=r.length>1,n=[];for(const a of r){const l=i.nodes[a];n.push(o(a,0)),Uwt(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,u)=>o(c,u+1))}async function o(a,l){const c=i.nodes[a],u=t.getNodeTransform(a);if(c.weights!=null&&ie.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const d=i.meshes[c.mesh];for(const p of d.primitives)n.push(e(p,u,l,d.name))}for(const d of c.children||[])n.push(o(d,l))}await Promise.all(n)}function Uwt(t){var e;return((e=t.extensions)==null?void 0:e.MSFT_lod)&&Array.isArray(t.extensions.MSFT_lod.ids)}function zwt(t,e,i){const r=n=>{const o=`${i}_tex_${n&&n.id}${n!=null&&n.name?"_"+n.name:""}`;if(n&&!t.textures.has(o)){const a=wwt(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:Vwt.has(n.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},s=`${i}_mat_${e.id}_${e.name}`;if(!t.materials.has(s)){const n=bwt({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?r(e.colorTexture):void 0,textureNormal:e.normalTexture?r(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?r(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?r(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?r(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor,receiveShadows:e.receiveShadows,receiveAmbientOcclustion:e.receiveAmbientOcclusion});t.materials.set(s,n)}return s}const Vwt=new Set([ii.LINEAR_MIPMAP_LINEAR,ii.LINEAR_MIPMAP_NEAREST]);function Bwt(t,e){switch(e){case vi.TRIANGLES:return Gwt(t);case vi.TRIANGLE_STRIP:return jwt(t);case vi.TRIANGLE_FAN:return Hwt(t)}}function Gwt(t){return typeof t=="number"?RT(t):Gv(t)?new Uint16Array(t):t}function jwt(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const i=e-2,r=Cz(3*i);if(typeof t=="number"){let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=n,r[s++]=n+1,r[s++]=n+2):(r[s++]=n+1,r[s++]=n,r[s++]=n+2)}else{let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=t[n],r[s++]=t[n+1],r[s++]=t[n+2]):(r[s++]=t[n+1],r[s++]=t[n],r[s++]=t[n+2])}return r}function Hwt(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const i=e-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof t=="number"){let a=0;for(let l=0;l<i;++l)r[a++]=0,r[a++]=l+1,r[a++]=l+2;return r}const s=t[0];let n=t[1],o=0;for(let a=0;a<i;++a){const l=t[a+2];r[o++]=s,r[o++]=n,r[o++]=l,n=l}return r}let qwt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},Wwt=class{constructor(e,i,r){this.name=e,this.lodThreshold=i,this.pivotOffset=r,this.stageResources=new qwt,this.numberOfVertices=0}};const Ty=()=>ie.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function vLe(t,e){const i=await Ywt(t,e),r=await Kwt(i.textureDefinitions??{},e);let s=0;for(const n in r)if(r.hasOwnProperty(n)){const o=r[n];s+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:i,textures:r,size:s+s1e(i)}}async function Ywt(t,e){const i=e==null?void 0:e.streamDataRequester;if(i)return Zwt(t,i,e);const r=await Vd(Yt(t,e));if(r.ok===!0)return r.value.data;Pn(r.error),bLe(r.error)}async function Zwt(t,e,i){const r=await Vd(e.request(t,"json",i));if(r.ok===!0)return r.value;Pn(r.error),bLe(r.error.details.url)}function bLe(t){throw new V("",`Request for object resource failed: ${t}`)}function Xwt(t){const e=t.params,i=e.topology;let r=!0;switch(e.vertexAttributes||(Ty().warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=n[o];a!=null&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(Ty().warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(Ty().warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(Ty().warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else Ty().warn("Indexed geometries must specify faces"),r=!1;break}default:Ty().warn(`Unsupported topology '${i}'`),r=!1}t.params.material||(Ty().warn("Geometry requires material"),r=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(Ty().warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function Jwt(t,e){var g,y;const i=new Array,r=new Array,s=new Array,n=new q1,o=t.resource,a=GL.parse(o.version||"1.0","wosr");txt.validate(a);const l=o.model.name,c=o.model.geometries,u=o.materialDefinitions??{},d=t.textures;let p=0;const m=new Map;for(let v=0;v<c.length;v++){const b=c[v];if(!Xwt(b))continue;const w=ext(b),x=b.params.vertexAttributes,T=[],C=Y=>{if(b.params.topology==="PerAttributeArray")return null;const de=b.params.faces;for(const L in de)if(L===Y)return de[L].values;return null},M=x[R.POSITION],O=M.values.length/M.valuesPerElement;for(const Y in x){const de=x[Y],L=de.values,F=C(Y)??RT(O);T.push([Y,new it(L,F,de.valuesPerElement,!0)])}const D=w.texture,k=d&&d[D];if(k&&!m.has(D)){const{image:Y,parameters:de}=k,L=new J1(Y,de);r.push(L),m.set(D,L)}const U=m.get(D),H=U?U.id:void 0,z=w.material;let Z=n.get(z,D);if(Z==null){const Y=u[z.substring(z.lastIndexOf("/")+1)].params;Y.transparency===1&&(Y.transparency=0);const de=k&&k.alphaChannelUsage,L=Y.transparency>0||de==="transparency"||de==="maskAndTransparency",F=k?wLe(k.alphaChannelUsage):void 0,j={ambient:Ol(Y.diffuse),diffuse:Ol(Y.diffuse),opacity:1-(Y.transparency||0),transparent:L,textureAlphaMode:F,textureAlphaCutoff:.33,textureId:H,initTextureTransparent:!0,doubleSided:!0,cullFace:Nr.None,colorMixMode:Y.externalColorMixMode||"tint",textureAlphaPremultiplied:(k==null?void 0:k.parameters.preMultiplyAlpha)??!1};e!=null&&e.materialParameters&&Object.assign(j,e.materialParameters),Z=new If(j),n.set(z,D,Z)}s.push(Z);const q=new bn(Z,T);p+=((y=(g=T.find(Y=>Y[0]===R.POSITION))==null?void 0:g[1])==null?void 0:y.indices.length)??0,i.push(q)}return{engineResources:[{name:l,stageResources:{textures:r,materials:s,geometries:i},pivotOffset:o.model.pivotOffset,numberOfVertices:p,lodThreshold:null}],referenceBoundingBox:Qwt(i)}}function Qwt(t){const e=Br();return t.forEach(i=>{const r=i.boundingInfo;r!=null&&(Af(e,r.bbMin),Af(e,r.bbMax))}),e}async function Kwt(t,e){const i=new Array;for(const n in t){const o=t[n],a=o.images[0].data;if(!a){Ty().warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,u=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",d={noUnpackFlip:!0,wrap:{s:bi.REPEAT,t:bi.REPEAT},preMultiplyAlpha:wLe(u)!==Cr.Opaque},p=e!=null&&e.disableTextures?Promise.resolve(null):R0(l,e);i.push(p.then(m=>({refId:c,image:m,parameters:d,alphaChannelUsage:u})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function wLe(t){switch(t){case"mask":return Cr.Mask;case"maskAndTransparency":return Cr.MaskBlend;case"none":return Cr.Opaque;default:return Cr.Blend}}function ext(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const txt=new GL(1,2,"wosr"),b2=2.1;async function xLe(t,e){var d;const i=SLe(tJ(t));if(i.fileType==="wosr"){const p=await(e.cache?e.cache.loadWOSR(i.url,e):vLe(i.url,e)),{engineResources:m,referenceBoundingBox:g}=Jwt(p,e);return{lods:m,referenceBoundingBox:g,isEsriSymbolResource:!1,isWosr:!0}}const r=await(e.cache?e.cache.loadGLTF(i.url,e,!!e.usePBR):_Le(new gLe(e.streamDataRequester),i.url,e,e.usePBR)),s=(d=r.model.meta)==null?void 0:d.ESRI_proxyEllipsoid,n=r.meta.isEsriSymbolResource&&s!=null&&r.meta.ESRI_webstyle==="EsriRealisticTreesStyle";n&&!r.customMeta.esriTreeRendering&&(r.customMeta.esriTreeRendering=!0,nxt(r,s));const o=!!e.usePBR,a=r.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[...Tdt]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...XG]},l={...e.materialParameters,treeRendering:n},{engineResources:c,referenceBoundingBox:u}=TLe(r,a,l,e.skipHighLods&&i.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:i.specifiedLodIndex});return{lods:c,referenceBoundingBox:u,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1}}function SLe(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function TLe(t,e,i,r){const s=t.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=Br();return s.lods.forEach((u,d)=>{const p=r.skipHighLods===!0&&(l>1&&d===0||l>3&&d===1)||r.skipHighLods===!1&&r.singleLodIndex!=null&&d!==r.singleLodIndex;if(p&&d!==0)return;const m=new Wwt(u.name,u.lodThreshold,[0,0,0]);u.parts.forEach(g=>{const y=p?new If({}):ixt(s,g,m,e,i,o,a),{geometry:v,vertexCount:b}=rxt(g,y??new If({})),w=v.boundingInfo;w!=null&&d===0&&(Af(c,w.bbMin),Af(c,w.bbMax)),y!=null&&(m.stageResources.geometries.push(v),m.numberOfVertices+=b)}),p||n.push(m)}),{engineResources:n,referenceBoundingBox:c}}function ixt(t,e,i,r,s,n,o){var m,g;const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,u=e.attributes.normal!=null;if(l==null)return null;const d=sxt(l.alphaMode);if(!n.has(a)){if(c){const D=(k,U=!1)=>{if(k!=null&&!o.has(k)){const H=t.textures.get(k);if(H!=null){const z=H.data;o.set(k,new J1(pI(z)?z.data:z,{...H.parameters,preMultiplyAlpha:!pI(z)&&U,encoding:pI(z)&&z.encoding!=null?z.encoding:void 0}))}}};D(l.textureColor,d!==Cr.Opaque),D(l.textureNormal),D(l.textureOcclusion),D(l.textureEmissive),D(l.textureMetallicRoughness)}const y=l.color[0]**(1/b2),v=l.color[1]**(1/b2),b=l.color[2]**(1/b2),w=l.emissiveFactor[0]**(1/b2),x=l.emissiveFactor[1]**(1/b2),T=l.emissiveFactor[2]**(1/b2),C=l.textureColor!=null&&c?o.get(l.textureColor):null,M=ARe({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion}),O=((m=l.normalTextureTransform)==null?void 0:m.scale)!=null?(g=l.normalTextureTransform)==null?void 0:g.scale:IB;n.set(a,new If({...r,transparent:d===Cr.Blend,customDepthTest:KS.Lequal,textureAlphaMode:d,textureAlphaCutoff:l.alphaCutoff,diffuse:[y,v,b],ambient:[y,v,b],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?Nr.None:Nr.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:u?Ki.Attribute:Ki.ScreenDerivative,castShadows:!0,receiveShadows:l.receiveShadows,receiveAmbientOcclusion:l.receiveAmbientOcclustion,textureId:C!=null?C.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:C!=null&&!!C.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[w,x,T],mrrFactors:M?[...Cre]:[l.metallicFactor,l.roughnessFactor,r.mrrFactors[2]],isSchematic:M,colorTextureTransformMatrix:Zm(l.colorTextureTransform),normalTextureTransformMatrix:Zm(l.normalTextureTransform),scale:[O[0],O[1]],occlusionTextureTransformMatrix:Zm(l.occlusionTextureTransform),emissiveTextureTransformMatrix:Zm(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:Zm(l.metallicRoughnessTextureTransform),...s}))}const p=n.get(a);if(i.stageResources.materials.push(p),c){const y=v=>{v!=null&&i.stageResources.textures.push(o.get(v))};y(l.textureColor),y(l.textureNormal),y(l.textureOcclusion),y(l.textureEmissive),y(l.textureMetallicRoughness)}return p}function rxt(t,e){const i=t.attributes.position.count,r=Bwt(t.indices||i,t.primitiveType),s=ws(3*i),{typedBuffer:n,typedBufferStride:o}=t.attributes.position;X1(s,n,t.transform,3,o);const a=[[R.POSITION,new it(s,r,3,!0)]];if(t.attributes.normal!=null){const c=ws(3*i),{typedBuffer:u,typedBufferStride:d}=t.attributes.normal;D1(w2,t.transform),ej(c,u,w2,3,d),vU(w2)&&fA(c,c),a.push([R.NORMAL,new it(c,r,3,!0)])}if(t.attributes.tangent!=null){const c=ws(4*i),{typedBuffer:u,typedBufferStride:d}=t.attributes.tangent;Xd(w2,t.transform),mj(c,u,w2,4,d),vU(w2)&&fA(c,c,4),a.push([R.TANGENT,new it(c,r,4,!0)])}if(t.attributes.texCoord0!=null){const c=ws(2*i),{typedBuffer:u,typedBufferStride:d}=t.attributes.texCoord0;gse(c,u,2,d),a.push([R.UV0,new it(c,r,2,!0)])}const l=t.attributes.color;if(l!=null){const c=new Uint8Array(4*i);l.elementCount===4?l instanceof $f?yV(c,l,255):l instanceof nl?yse(c,l):l instanceof _L&&yV(c,l,1/256):(c.fill(255),l instanceof po?Qz(c,l.typedBuffer,255,4,l.typedBufferStride):t.attributes.color instanceof EG?_j(c,l.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof MG&&Qz(c,l.typedBuffer,1/256,4,l.typedBufferStride)),a.push([R.COLOR,new it(c,r,4,!0)])}return{geometry:new bn(e,a),vertexCount:i}}const w2=Gr();function sxt(t){switch(t){case"BLEND":return Cr.Blend;case"MASK":return Cr.Mask;case"OPAQUE":case null:case void 0:return Cr.Opaque}}function nxt(t,e){for(let i=0;i<t.model.lods.length;++i){const r=t.model.lods[i];for(const s of r.parts){const n=s.attributes.normal;if(n==null)return;const o=s.attributes.position,a=o.count,l=E(),c=E(),u=E(),d=new Uint8Array(4*a),p=new Float64Array(3*a),m=In(Ee(),s.transform);let g=0,y=0;for(let v=0;v<a;v++){o.getVec(v,c),n.getVec(v,l),He(c,c,s.transform),ve(u,c,e.center),gU(u,u,e.radius);const b=u[2],w=Ae(u),x=Math.min(.45+.55*w*w,1);gU(u,u,e.radius),m!==null&&He(u,u,m),ge(u,u),i+1!==t.model.lods.length&&t.model.lods.length>1&&yr(u,u,l,b>-1?.2:Math.min(-4*b-3.8,1)),p[g]=u[0],p[g+1]=u[1],p[g+2]=u[2],g+=3,d[y]=255*x,d[y+1]=255*x,d[y+2]=255*x,d[y+3]=255,y+=4}s.attributes.normal=new po(p),s.attributes.color=new nl(d)}}}const TXt=Object.freeze(Object.defineProperty({__proto__:null,fetch:xLe,gltfToEngineResources:TLe,parseUrl:SLe},Symbol.toStringTag,{value:"Module"})),oxt=()=>!!re("enable-feature:force-wosr"),EXt=()=>!!re("enable-feature:direct-3d-object-feature-layer-display"),axt=()=>re.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),lxt=()=>re.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),CXt=()=>!!re("enable-i3s-patching"),cxt=()=>re.add("enable-i3s-patching",!0,!0,!0),uxt=()=>re.add("enable-i3s-patching",!1,!0,!0),MXt=()=>!!re("enable-feature:SceneLayer-editing"),hxt=(t="i3s-patching")=>{switch(uxt(),lxt(),re.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":axt();break;case"i3s-patching":cxt()}};hxt("i3s-patching");let BH={};async function dxt(t,e){try{return{data:(await vse(t,e)).data,baseUrl:aB(t),styleUrl:t}}catch(i){return Pn(i),null}}function pxt(t,e,i){var o;const r=e.portal!=null?e.portal:No.getDefault();let s;const n=`${r.url} - ${(o=r.user)==null?void 0:o.username} - ${t}`;return BH[n]||(BH[n]=fxt(t,r,i).then(a=>(s=a,a.fetchData())).then(a=>({data:a,baseUrl:s.itemUrl??"",styleName:t}))),BH[n]}function fxt(t,e,i){return e.load(i).then(()=>{const r=new jm({disableExtraQuery:!0,query:`owner:${Ame} AND type:${Pme} AND typekeywords:"${t}"`});return e.queryItems(r,i)}).then(({results:r})=>{var o;let s=null;const n=t.toLowerCase();if(r&&Array.isArray(r)){for(const a of r)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===n))&&a.type===Pme&&a.owner===Ame){s=a;break}}if(!s)throw new V("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(i)})}function _se(t,e,i){return(t==null?void 0:t.styleUrl)!=null?dxt(t.styleUrl,i):(t==null?void 0:t.styleName)!=null?pxt(t.styleName,e,i):Promise.reject(new V("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function ELe(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function CLe(t,e,i=["gltf"]){if(e==="cimRef")return encodeURI(t.cimRef);if(t.formatInfos&&!oxt())for(const r of i){const s=t.formatInfos.find(n=>n.type===r);if(s)return s.href}return encodeURI(t.webRef)}function vse(t,e){const i={responseType:"json",query:{f:"json"},...e};return Yt(vh(t),i)}const Ame="esri_en",Pme="Style",mxt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",gxt=Km.fromSimpleMarkerSymbol(M3e),yxt=AT.fromSimpleLineSymbol(ose),_xt=hb.fromSimpleFillSymbol(A3e),vxt=new dL({symbolLayers:new tt([new CT({material:{color:nse},edges:new WEe({size:Do(1),color:new Oe(Y_t)})})])}),bxt=new AT({symbolLayers:new tt([new jA({material:{color:new Oe([0,0,0])},size:Do(1)})])}),wxt=new hb({symbolLayers:new tt([new CT({outline:{color:new Oe([0,0,0]),size:Do(1)}})])});function AXt(t){if(t==null)return null;switch(t.type){case"mesh":return vxt;case"point":case"multipoint":return gxt;case"polyline":return yxt;case"polygon":case"extent":return _xt}return null}const x2={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function xxt(t,e=x2){var l,c,u,d;if(!t)return{symbol:null};const{retainId:i=x2.retainId,ignoreDrivers:r=x2.ignoreDrivers,hasLabelingContext:s=x2.hasLabelingContext,retainCIM:n=x2.retainCIM,cimFallbackEnabled:o=x2.cimFallbackEnabled}=e;let a=null;if(JS(t)||t instanceof PT)a=t.clone();else if(t.type==="cim"){const p=(c=(l=t.data)==null?void 0:l.symbol)==null?void 0:c.type;switch(p){case"CIMPointSymbol":a=n?t.clone():Km.fromCIMSymbol(t);break;case"CIMLineSymbol":o&&(a=bxt.clone(),(u=e==null?void 0:e.logWarning)==null||u.call(e,"Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":o&&(a=wxt.clone(),(d=e==null?void 0:e.logWarning)==null||d.call(e,"Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!a)return{error:new V("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${p||"unknown"}' is unsupported in 3D`,{symbol:t})}}else if(t instanceof Mu)a=AT.fromSimpleLineSymbol(t);else if(t instanceof kf)a=Km.fromSimpleMarkerSymbol(t);else if(t instanceof pL)a=Km.fromPictureMarkerSymbol(t);else if(t instanceof db)a=e.geometryType&&e.geometryType==="mesh"?dL.fromSimpleFillSymbol(t):hb.fromSimpleFillSymbol(t);else{if(!(t instanceof qA))return{error:new V("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};a=s?lG.fromTextSymbol(t):Km.fromTextSymbol(t)}return i&&a&&a.type!=="cim"&&(a.id=t.id),r&&JS(a)&&a.symbolLayers.forEach(p=>p.ignoreDrivers=!0),{symbol:a}}function _V(t,e,i,r){const s=MLe(t,{},{context:r,isLabelSymbol:!1});s!=null&&(e[i]=s)}function Ome(t,e,i,r){const s=MLe(t,{},{context:r,isLabelSymbol:!0});s!=null&&(e[i]=s)}function Rme(t){return t instanceof HA||t instanceof PT}function MLe(t,e,i){if(t==null)return null;const{context:r,isLabelSymbol:s}=i,n=r==null?void 0:r.origin,o=r==null?void 0:r.messages;if(n==="web-scene"&&!Rme(t)){const a=xxt(t,{retainCIM:!0,hasLabelingContext:s});return a.symbol!=null?a.symbol.write(e,r):(o==null||o.push(new V("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:r,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!OTe(r==null?void 0:r.layer))&&Rme(t)?(o==null||o.push(new V("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:r})),null):t.write(e,r)}function ALe(t,e){return qKe(t,null,e)}function Sxt(t,e,i,r){const s=t.name;return s==null?Promise.reject(new V("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?Txt(s,e,r):_se(t,e,r).then(n=>wse(n,s,e,i,CLe,r))}function bse(t,e){return e.items.find(i=>i.name===t)}function wse(t,e,i,r,s,n){var m,g;const o=(i==null?void 0:i.portal)!=null?i.portal:No.getDefault(),a={portal:o,url:Ns(t.baseUrl),origin:"portal-item"},l=bse(e,t.data);if(!l){const y=`The symbol name '${e}' could not be found`;return Promise.reject(new V("symbolstyleutils:symbol-name-not-found",y,{symbolName:e}))}let c=k1(s(l,r),a),u=((m=l.thumbnail)==null?void 0:m.href)??null;const d=(g=l.thumbnail)==null?void 0:g.imageData;hwt()&&(c=tJ(c)??"",u=tJ(u));const p={portal:o,url:Ns(aB(c)),origin:"portal-item"};return vse(c,n).then(y=>{const v=r==="cimRef"?ELe(y.data):y.data,b=ALe(v,p);if(b&&JS(b)){if(u){const w=k1(u,a);b.thumbnail=new vS({url:w})}else d&&(b.thumbnail=new vS({url:`data:image/png;base64,${d}`}));t.styleUrl?b.styleOrigin=new KI({portal:i.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(b.styleOrigin=new KI({portal:i.portal,styleName:t.styleName,name:e}))}return b})}function Txt(t,e,i){const r=mxt.replaceAll(/\{SymbolName\}/gi,t),s=e.portal!=null?e.portal:No.getDefault();return vse(r,i).then(n=>{const o=ELe(n.data);return ALe(o,{portal:s,url:Ns(aB(r)),origin:"portal-item"})})}const Ext=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:wse,getStyleItemFromStyle:bse,resolveWebStyleSymbol:Sxt},Symbol.toStringTag,{value:"Module"}));async function Cxt(t){var a;if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new V("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const i={portal:t.portal},r=await _se(t,i).catch(()=>null);if(r===null)return null;const s=bse(e,r.data);if(s&&!((a=s.formatInfos)!=null&&a.some(l=>l.type==="gltf_basisu")))return null;const n=await wse(r,e,i,"webRef",(l,c)=>CLe(l,c,["gltf_basisu","gltf"])).catch(()=>null);if(n===null||n.type!=="point-3d")return null;const o=n.symbolLayers.items[0];return o.type==="object"?o.resource:null}let Mxt=class{constructor(e,i,r){this._elementSize=i,this._buffer=vr.createVertex(e,rr.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,i,r,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(i-e)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,i){const r=e*this._elementSize,s=i*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,s)}resize(e){const i=e*this._elementSize,r=new ArrayBuffer(i);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=e}},Axt=class{constructor(e){this.modelOriginHi=e.getField(R.INSTANCEMODELORIGINHI,po),this.modelOriginLo=e.getField(R.INSTANCEMODELORIGINLO,po),this.model=e.getField(R.INSTANCEMODEL,G1),this.modelNormal=e.getField(R.INSTANCEMODELNORMAL,G1),this.featureAttribute=e.getField(R.INSTANCEFEATUREATTRIBUTE,$f),this.color=e.getField(R.INSTANCECOLOR,nl),this.objectAndLayerIdColor=e.getField(R.INSTANCEOBJECTANDLAYERIDCOLOR,nl)}},$me=class{constructor(e,i){this._rctx=e,this._instanceBufferLayout=i,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,i=this._tailIndex;return e>=i?e-i:e+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){var e;return((e=this._buffer)==null?void 0:e.usedMemory)??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){ft(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){ft(this._updating,"not updating"),this.size<kUe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){ft(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),ft(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){ft(this._updating,"not updating"),ft(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(vV,Math.floor(this._capacity*BV));this._resize(e)}_shrink(){const e=Math.max(vV,Math.floor(this._capacity*FUe));this._resize(e)}_resize(e){if(ft(this._updating,"not updating"),e===this._capacity)return;const i=new Mxt(this._rctx,this._instanceBufferLayout.stride,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(i);ft(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=i,this._view=new Axt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,e),i-r):r>i?(this._buffer.copyRange(r,this._capacity,e),i>0&&this._buffer.copyRange(0,i,e,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,i){e<i?this._buffer.transferRange(e,i):e>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(e,this._capacity))}};const vV=64;var ts;function Pxt(t){let e=Ts().mat4f64(R.LOCALTRANSFORM).mat4f64(R.GLOBALTRANSFORM).vec4f64(R.BOUNDINGSPHERE).vec3f64(R.MODELORIGIN).mat3f(R.INSTANCEMODEL).mat3f(R.INSTANCEMODELNORMAL).vec2f(R.MODELSCALEFACTORS);return t.includes(R.FEATUREATTRIBUTE)&&(e=e.vec4f(R.FEATUREATTRIBUTE)),t.includes(R.COLOR)&&(e=e.vec4u8(R.COLOR)),t.includes(R.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(R.OBJECTANDLAYERIDCOLOR)),e=e.u8(R.STATE).u8(R.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(ts||(ts={}));let Ime=class{constructor(e){this.localTransform=e.getField(R.LOCALTRANSFORM,n3),this.globalTransform=e.getField(R.GLOBALTRANSFORM,n3),this.modelOrigin=e.getField(R.MODELORIGIN,Hd),this.model=e.getField(R.INSTANCEMODEL,G1),this.modelNormal=e.getField(R.INSTANCEMODELNORMAL,G1),this.modelScaleFactors=e.getField(R.MODELSCALEFACTORS,OT),this.boundingSphere=e.getField(R.BOUNDINGSPHERE,SG),this.featureAttribute=e.getField(R.FEATUREATTRIBUTE,$f),this.color=e.getField(R.COLOR,nl),this.objectAndLayerIdColor=e.getField(R.OBJECTANDLAYERIDCOLOR,nl),this.state=e.getField(R.STATE,rA),this.lodLevel=e.getField(R.LODLEVEL,rA)}},SE=class extends Re{constructor(e,i){super(e),this.events=new cn,this._capacity=0,this._size=0,this._next=0,this._layout=Pxt(i),this._capacity=vV,this._buffer=this._layout.createBuffer(this._capacity),this._view=new Ime(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,ts.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const i=this._view.state;ft(e>=0&&e<this._capacity&&!!(i.get(e)&ts.ALLOCATED),"invalid instance handle"),this._getStateFlag(e,ts.ACTIVE)?this._setStateFlags(e,ts.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const i=this._view.state;ft(e>=0&&e<this._capacity&&!!(i.get(e)&ts.ALLOCATED),"invalid instance handle"),i.set(e,0),this._size--}setLocalTransform(e,i,r=!0){this._view.localTransform.setMat(e,i),r&&this.updateModelTransform(e)}getLocalTransform(e,i){this._view.localTransform.getMat(e,i)}setGlobalTransform(e,i,r=!0){this._view.globalTransform.setMat(e,i),r&&this.updateModelTransform(e)}getGlobalTransform(e,i){this._view.globalTransform.getMat(e,i)}updateModelTransform(e){const i=this._view,r=Ic,s=hp;i.localTransform.getMat(e,Lme),i.globalTransform.getMat(e,GH);const n=dr(GH,GH,Lme);ne(r,n[12],n[13],n[14]),i.modelOrigin.setVec(e,r),Xd(s,n),i.model.setMat(e,s);const o=w9e(Ic,n);o.sort(),i.modelScaleFactors.set(e,0,o[1]),i.modelScaleFactors.set(e,1,o[2]),aL(s,s),xT(s,s),i.modelNormal.setMat(e,s),this._setStateFlags(e,ts.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,i){const r=this._view;r.model.getMat(e,hp),r.modelOrigin.getVec(e,Ic),i[0]=hp[0],i[1]=hp[1],i[2]=hp[2],i[3]=0,i[4]=hp[3],i[5]=hp[4],i[6]=hp[5],i[7]=0,i[8]=hp[6],i[9]=hp[7],i[10]=hp[8],i[11]=0,i[12]=Ic[0],i[13]=Ic[1],i[14]=Ic[2],i[15]=1}applyShaderTransformation(e,i){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedModelTransform(e,i){return this.getModelTransform(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i),i}getCombinedLocalTransform(e,i){this._view.localTransform.getMat(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedMaxScaleFactor(e){let i=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Ic,this,e),i*=Math.max(Ic[0],Ic[1],Ic[2])),i}getCombinedMedianScaleFactor(e){let i=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Ic,this,e),i*=Oxt(Ic[0],Ic[1],Ic[2])),i}getModel(e,i){this._view.model.getMat(e,i)}setFeatureAttribute(e,i){this._view.featureAttribute.setVec(e,i)}getFeatureAttribute(e,i){this._view.featureAttribute.getVec(e,i)}setColor(e,i){this._view.color.setVec(e,i)}setObjectAndLayerIdColor(e,i){this._view.objectAndLayerIdColor.setVec(e,i)}setVisible(e,i){i!==this.getVisible(e)&&(this._setStateFlag(e,ts.VISIBLE,i),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,ts.VISIBLE)}setHighlight(e,i){i!==this.getHighlight(e)&&(this._setStateFlag(e,ts.HIGHLIGHT,i),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,ts.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++i;return i}_setStateFlags(e,i){const r=this._view.state;i=r.get(e)|i,r.set(e,i)}_clearStateFlags(e,i){const r=this._view.state;i=r.get(e)&~i,r.set(e,i)}_setStateFlag(e,i,r){r?this._setStateFlags(e,i):this._clearStateFlags(e,i)}_getStateFlag(e,i){return!!(this._view.state.get(e)&i)}_grow(){this._capacity=Math.max(vV,Math.floor(this._capacity*BV)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new Ime(this._buffer)}_findSlot(){const e=this._view.state;let i=this._next;for(;e.get(i)&ts.ALLOCATED;)i=i+1===this._capacity?0:i+1;return this._next=i+1===this._capacity?0:i+1,i}};function Oxt(t,e,i){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),i))}h([f({constructOnly:!0})],SE.prototype,"shaderTransformation",void 0),h([f()],SE.prototype,"_size",void 0),h([f({readOnly:!0})],SE.prototype,"size",null),SE=h([I("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],SE);const Ic=E(),hp=Gr(),Lme=Ee(),GH=Ee();let Rxt=class extends uf{constructor(e,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=i,this._tmpSphere=ln(),this._tmpMat4=Ee()}addInstance(e){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);He(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*VM(r),i.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},$xt=class{constructor(e,i){this._worldSpaceRadius=e,this._minScreenSpaceRadii=i}selectLevel(e,i,r){const s=r.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*i/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}},Ixt=class extends oL{constructor(e,i,r,s,n,o){super(e,i),this.layerUid=e,this.graphicUid=i,this.geometryId=r,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}};function xse(t){return Zd(t)&&t.intersector===Zr.LOD&&!!t.target}let Lxt=class{constructor(e,i){const r=e.renderContext.rctx,s=i.geometry;this._materials=e.materials,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=o.createBuffer(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new TIe(s.material,this._materials),this.vertexBufferLayout=o,this.vbo=vr.createVertex(r,rr.STATIC_DRAW,l.buffer),this.vao=new Fg(r,wi,{geometry:Au(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,i,r,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,s,(u,d,p,m,g)=>{if(u>=0){if(i!=null&&!i(e.rayBegin,e.rayEnd,u))return;const y=new Ixt(o.layerUid,o.graphicUid(n),c,p,a,l);if((e.results.min.drapedLayerOrder==null||g>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||u<e.results.min.dist)&&e.results.min.set(Zr.LOD,y,u,d,e.transform.transform,g),e.options.store!==ta.MIN&&(e.results.max.drapedLayerOrder==null||g>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||u>e.results.max.dist)&&e.results.max.set(Zr.LOD,y,u,d,e.transform.transform,g),e.options.store===ta.ALL){const v=_te(e.results.min.ray);v.set(Zr.LOD,y,u,d,e.transform.transform,g),e.results.all.push(v)}}})}},Dxt=class PLe{static async create(e,i,r){const s=await Promise.allSettled(i.components.map(o=>e.controller.schedule(()=>new Lxt(e,o),r))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(K1);if(Yn(r)||n.length!==s.length){n.forEach(o=>o.destroy()),Et(r);for(const o of s)if(o.status==="rejected")throw o.reason}return new PLe(i.minScreenSpaceRadius,n)}constructor(e,i){this.minScreenSpaceRadius=e,this.components=i}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,i,r,s,n,o,a){this.components.forEach(l=>l.intersect(e,i,r,s,n,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=Br();this.components.forEach(i=>{i.boundingInfo!=null&&(Af(e,i.boundingInfo.bbMin),Af(e,i.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,i=E();of(e,i),this._boundingSphere={center:i,radius:.5*tCe(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,i)=>e+i.triangleCount,0)}};const Nxt=t=>{const e=t.baseBoundingSphere.radius,i=t.levels.map(r=>r.minScreenSpaceRadius);return new $xt(e,i)};let td=class extends Vnt{constructor(e,i){super(e),this.type=Zr.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new Pr,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[_e.OPAQUE_MATERIAL,r=>this._produces(r)],[_e.TRANSPARENT_MATERIAL,r=>!!this._hasTransparentLevels()&&this._produces(r)]]),this._instanceData=new SE({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(i.registerTask(Mt.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=kxt(this.optionalFields),this._glInstanceBufferLayout=Au(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce((e,i)=>i.reduce((r,s)=>r+s.usedMemory,e),0)}get renderStats(){const e=this._instanceData.size,i=[];return this._levels.forEach((r,s)=>{const n=this._allRenderInstanceData[0][s].size+this._allRenderInstanceData[1][s].size,o=r.triangleCount;i.push({renderedInstances:n,renderedTriangles:n*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:i.reduce((r,s)=>r+s.renderedInstances,0),renderedTriangles:i.reduce((r,s)=>r+s.renderedTriangles,0),levels:i}}async initializeRenderContext(e,i){this._context=e;const r=e.renderContext.rctx,s=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new $me(r,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new $me(r,this._instanceBufferLayout)),Dxt.create(e,o,i)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(K1);if(Yn(i)||n.length!==s.length){n.forEach(o=>o.destroy()),Et(i);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=Nxt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}_hasTransparentLevels(){return this._levels.some(e=>e.components.some(i=>{const r=i.material.produces.get(_e.TRANSPARENT_MATERIAL);return r==null?void 0:r(G.Color)}))}hasHighlights(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}_produces(e){return e!==G.Highlight&&e!==G.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!Rr.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const i=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),i||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(lu),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const i=this._getInstanceDatas(e.output);if(!i)return null;const r=new Array;return i.forEach(s=>this.levels.forEach((n,o)=>{n.components.forEach(a=>r.push(this._beginComponent(e,s[o],a)))})),r}renderNode(e,i){const r=this._getInstanceDatas(e.output);if(!r||i==null)return;let s=0;e.rctx.bindVAO(),r.forEach(n=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,i[s++],n[a],l,a))}))}_getInstanceDatas(e){const i=e!==G.Highlight&&e!==G.ShadowHighlight,r=e!==G.ShadowExcludeHighlight;return i&&r?this._allRenderInstanceData:i?this._defaultRenderInstanceData:r?this._highlightRenderInstanceData:null}intersect(e,i,r,s){if(!this.baseMaterial.isVisible()||this._octree==null)return;const n=E();ve(n,s,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,Fme),e.transform.set(Fme),He(kme,r,e.transform.inverse),He(Ume,s,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),u=this._levels.length;ft(!!(l&ts.ACTIVE),"invalid instance state"),ft(c>=0&&c<u,"invaid lod level"),this._levels[c].intersect(e,i,kme,Ume,a,this.metadata,u)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(r,n,o)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(this._octreeCached==null){const i=this._instanceData,r=(e=i.view)==null?void 0:e.state;if(!r)return null;this._octreeCached=new Rxt(i,this.baseBoundingSphere);for(let s=0;s<i.capacity;++s)r.get(s)&ts.ACTIVE&&this._octreeCached.addInstance(s)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Le(this._octreeCached)}queryDepthRange(e){if(this._octree==null)return{near:1/0,far:-1/0};const i=e.viewForward,r=this._octree.findClosest(i,uf.DepthOrder.FRONT_TO_BACK,e.frustum),s=this._octree.findClosest(i,uf.DepthOrder.BACK_TO_FRONT,e.frustum);if(r==null||s==null)return{near:1/0,far:-1/0};const n=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(r,rm),ve(rm,rm,n);const a=pe(rm,i)-rm[3];o.boundingSphere.getVec(s,rm),ve(rm,rm,n);const l=pe(rm,i)+rm[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(i=>i.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:i,_camera:r,_levelSelector:s}=this;this._allRenderInstanceData.forEach(d=>d.forEach(p=>p.beginUpdate()));const n=this._instanceData,o=n.view;let a=n.size;const l=n.capacity;let c=this._instanceIndex;const u=Math.ceil(l/500);for(let d=0;d<a&&!e.done;++d){c===this._cycleStartIndex&&this._startUpdateCycle();const p=o.state.get(c);let m=0;if(!(p&ts.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const g=o.lodLevel.get(c);if(p&ts.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][g].freeTail(),p&ts.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][g].freeTail(),p&ts.REMOVE)n.freeInstance(c);else if(p&ts.VISIBLE){let y=0;i&&(o.modelOrigin.getVec(c,Nme),y=s.selectLevel(Nme,n.getCombinedMedianScaleFactor(c),r)),m=p&~(ts.ACTIVE|ts.TRANSFORM_CHANGED),y>=0&&(p&ts.HIGHLIGHT?(Dme(this._highlightRenderInstanceData[0][y],o,c),m|=ts.HIGHLIGHT_ACTIVE):(Dme(this._defaultRenderInstanceData[0][y],o,c),m|=ts.DEFAULT_ACTIVE)),o.state.set(c,m),o.lodLevel.set(c,y)}else m=p&~(ts.ACTIVE|ts.TRANSFORM_CHANGED),o.state.set(c,m);if(this._octreeCached!=null){const y=!!(p&ts.ACTIVE),v=!!(m&ts.ACTIVE);!y&&v?this._octreeCached.addInstance(c):y&&!v?this._octreeCached.removeInstance(c):y&&v&&p&ts.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,c%u==0&&e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(d=>d.forEach(p=>p.endUpdate())),this._context.requestRender()}_beginComponent(e,i,r){if(i.size===0)return null;const s=r.glMaterials.load(e.rctx,e.bindParameters.slot,e.output);return s!=null?s.beginSlot(e.bindParameters):null}_renderComponent(e,i,r,s,n){if(!i)return;const{bindParameters:o,rctx:a}=e;a.runAppleAmdDriverHelper();const l=a.bindTechnique(i,o,s.material.parameters,Uxt);a.bindVAO(s.vao),i.ensureAttributeLocations(s.vao),Rr.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===G.Color&&(l.setUniform4fv("externalColor",zme[Math.min(n,zme.length-1)]),l.setUniform1i("colorMixMode",bOe.replace));const c=r.capacity,u=r.headIndex,d=r.tailIndex,p=r.firstIndex,m=this._glInstanceBufferLayout,g=(y,v)=>{aie(a,wi,r.buffer,m,y),a.drawArraysInstanced(i.primitiveType,0,s.vertexCount,v-y),UMe(a,wi,r.buffer,m)};s.material.parameters.transparent&&p!=null?u>d?(ft(p>=d&&p<=u,"invalid firstIndex"),g(p,u),g(d,p)):u<d&&(p<=u?(ft(p>=0&&p<=u,"invalid firstIndex"),g(p,u),g(d,c),g(0,p)):(ft(p>=d&&p<=c,"invalid firstIndex"),g(p,c),g(0,u),g(d,p))):u>d?g(d,u):u<d&&(g(0,u),g(d,c)),a.bindVAO(null)}};function Dme(t,e,i){const r=t.allocateHead();Fxt(e,i,t.view,r)}function Fxt(t,e,i,r){qst(t.modelOrigin,e,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,t.model,e),i.modelNormal.copyFrom(r,t.modelNormal,e),t.color&&i.color&&i.color.copyFrom(r,t.color,e),t.objectAndLayerIdColor&&i.objectAndLayerIdColor&&i.objectAndLayerIdColor.copyFrom(r,t.objectAndLayerIdColor,e),t.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,t.featureAttribute,e)}function kxt(t){let e=Ts().vec3f(R.INSTANCEMODELORIGINHI).vec3f(R.INSTANCEMODELORIGINLO).mat3f(R.INSTANCEMODEL).mat3f(R.INSTANCEMODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(R.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(R.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(R.INSTANCEOBJECTANDLAYERIDCOLOR)),e}h([f({constructOnly:!0})],td.prototype,"symbol",void 0),h([f({constructOnly:!0})],td.prototype,"optionalFields",void 0),h([f({constructOnly:!0})],td.prototype,"metadata",void 0),h([f({constructOnly:!0})],td.prototype,"shaderTransformation",void 0),h([f()],td.prototype,"_instanceData",void 0),h([f()],td.prototype,"_cycleStartIndex",void 0),h([f({readOnly:!0})],td.prototype,"_enableLevelSelection",null),h([f()],td.prototype,"_updateCyclesWithStaticCamera",void 0),h([f({readOnly:!0})],td.prototype,"running",null),td=h([I("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],td);const Nme=E(),rm=Qt(),Fme=Ee(),kme=E(),Ume=E(),zme=[Wt(1,0,1,1),Wt(0,0,1,1),Wt(0,1,0,1),Wt(1,1,0,1),Wt(1,0,0,1)],Uxt=new Ydt;let Vme=class{constructor(e,i,r,s,n,o,a,l,c,u,d,p){this.lodResources=e,this.lodRenderer=i,this.stageResources=r,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=u,this.physicalBasedRenderingEnabled=d,this.pivotOffset=p}},zxt=class extends Gg{getCachedSize(){const[e,i,r]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:i,height:r}}constructor(e,i,r,s){super(e,i,r,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}async doLoad(e){var i;if(!this._drivenProperties.size&&YG(this.symbolLayer))throw new Error;if(this._isPrimitive){const r=this.symbolLayer.resource,s=r&&jht(r==null?void 0:r.primitive)?r.primitive:hCe;this._resources=await this._createResourcesForPrimitive(s,e)}else{const r=await Cxt(this.symbol.styleOrigin),s=(r==null?void 0:r.href)??((i=this.symbolLayer.resource)==null?void 0:i.href);this._resources=await this._createResourcesForUrl(s,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){var e;return!((e=this.symbolLayer.resource)!=null&&e.href)}get lodRenderer(){var e;return(e=this._resources)==null?void 0:e.lodRenderer}get materials(){var e;return((e=this._resources)==null?void 0:e.stageResources.materials)??[]}_setMaterialTransparencyParameters(e,i=(s=>(s=(r=>(r=this.symbolLayer)==null?void 0:r.material)())==null?void 0:s.color)()){const n=this._getCombinedOpacity(i),o=n<1||this.needsDrivenTransparentPass;return e.transparent=o,e.opacity=n,e.cullFace=o?Nr.None:Nr.Back,e}async _createResourcesForPrimitive(e,i){const r=this.symbolLayer,s=Jn(EKe(e)),n=Ol(c5(s)),o=Ol(L6(n,r)),a=Ae(o),l=!1,c=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...Cre],ambient:s0,diffuse:s0,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},d=!!u.usePBR;this._setMaterialTransparencyParameters(u);const p=this.symbol;if(p.type==="point-3d"&&p.verticalOffset){const{screenLength:w,minWorldLength:x,maxWorldLength:T}=p.verticalOffset;u.verticalOffset={screenLength:_n(w),minWorldLength:x||0,maxWorldLength:T??1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=Md;else{const w=r.material!=null?r.material.color:null,x=w!=null?Oe.toUnitRGBA(w):Md;u.externalColor=x}this._fastUpdates=oA(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,null)),u.isInstanced=!0,this._fastUpdates?(Object.assign(u,this._fastUpdates.materialParameters),this._optionalFields.push(R.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(u.hasInstancedColor=!0,this._optionalFields.push(R.COLOR)),re("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(R.OBJECTANDLAYERIDCOLOR);const m=new If(u),g=lRe(e,m);if(!g)throw new Error(`Unknown object symbol primitive: ${e}`);const y=kN(g).map(w=>({opacity:1,transparent:w.parameters.transparent})),v=await this._createStageResources(g,d,i),b=await this._createLodRenderer(g,i);return new Vme(g,b,v,y,n,l,c,s,o,a,d,null)}async _createResourcesForUrl(e,i){var U,H;const r={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=oA(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(r.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(R.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(r.materialParameters.hasInstancedColor=!0,this._optionalFields.push(R.COLOR)),re("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(R.OBJECTANDLAYERIDCOLOR);const s=this.symbol;if(s.type==="point-3d"&&s.verticalOffset){const{screenLength:z,minWorldLength:Z,maxWorldLength:q}=s.verticalOffset;r.materialParameters.verticalOffset={screenLength:_n(z),minWorldLength:Z||0,maxWorldLength:q??1/0},r.materialParameters.castShadows=!1}const n=this._context.physicalBasedRenderingEnabled;r.signal=i,r.usePBR=n,r.skipHighLods=this._context.skipHighSymbolLods;const o=await xLe(e,r),a=o.isEsriSymbolResource,l=o.isWosr,c=lwt(o.lods),u=this._context,d=this.symbolLayer.material,p=this._getExternalColorParameters(d),m=(H=(U=this.symbolLayer)==null?void 0:U.material)==null?void 0:H.color,g=this._getCombinedOpacity(m,{hasIntrinsicColor:!0}),y=this.needsDrivenTransparentPass,v=kN(c),b=kN(c).map(z=>({opacity:z.parameters.opacity||1,transparent:z.parameters.transparent}));v.forEach(z=>{const Z=z.parameters;z.setParameters(p);const q=Z.opacity*g,Y=q<1||y||Z.transparent;z.setParameters({opacity:q,transparent:Y}),u.screenSizePerspectiveEnabled&&z.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings})});const w=o.referenceBoundingBox,x=Ol(c5(w)),T=Ol(c.levels[0].pivotOffset),C=Ol(L6(x,this.symbolLayer)),M=Ae(C),O=this._fastUpdates;aA(O,this._context.renderer,this._fastVisualVariableConvertOptions(w,C,x,T))&&v.forEach(z=>z.setParameters(O.materialParameters));const D=await this._createStageResources(c,n,i),k=await this._createLodRenderer(c,i);return new Vme(c,k,D,b,x,a,l,w,C,M,n,T)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,i,r){const s=this._context.stage,n=kN(e);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=Pde(e);s.addMany(o),this._addDisposeResource(()=>{o.forEach(l=>l.unload()),s.removeMany(o)}),await Promise.all(o.map(l=>this._context.stage.schedule(()=>l.load(s.renderView.renderingContext),r))),Et(r);const a=Ode(e);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(e,i){const r=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},n=this._fastUpdates,o=n?{applyTransform:(l,c,u)=>{l.getFeatureAttribute(c,gF),vn(u,rut(n.materialParameters,gF,u))},scaleFactor:(l,c,u)=>{c.getFeatureAttribute(u,gF),sre(l,n.materialParameters,gF)}}:null,a=new td({symbol:e,optionalFields:this._optionalFields,metadata:s,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(a),a.destroy()}),await r.addRenderPlugin(a,i),a}_getExternalColorParameters(e){const i={};return this._drivenProperties.color?i.externalColor=Md:(e==null?void 0:e.color)!=null?i.externalColor=Oe.toUnitRGBA(e.color):(i.externalColor=Md,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;const r=ES(i.geometry);if(r==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const s=this.setGraphicElevationContext(i),n=e.renderingInfo;return this._createAs3DShape(i,r,n,s,i.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){var n,o;if(this._resources==null)return;const e=this._drivenProperties.opacity,i=!this._isPrimitive,r=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let a=0;a<r.length;a++){const l=r[a],c=(o=(n=this.symbolLayer)==null?void 0:n.material)==null?void 0:o.color,u=s[a],d=this._getCombinedOpacity(c,{hasIntrinsicColor:i})*u.opacity,p=d<1||e||u.transparent;l.setParameters({opacity:d,transparent:p}),this._isPrimitive&&l.setParameters({cullFace:p?Nr.None:Nr.Back})}}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Y1)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:i}=this._resources;for(const r of e.materials)this._isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,i){if(this._resources==null)return an.RecreateSymbol;const{stageResources:{materials:r},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!aA(this._fastUpdates,i,this._fastVisualVariableConvertOptions(n,o,a,l)))return an.RecreateSymbol;for(const u of r)u.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return an.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,i=QRe(e.levels),r=a=>Array.from(a.attributes.values()).reduce((l,c)=>l+b0(c.data,c.indices),0),s=Ode(e).reduce((a,l)=>a+r(l),0),n=Pde(e).reduce((a,l)=>a+l.memoryEstimate,0)+s,o={...JRe(this.symbol,this.symbolLayer),resourceBytes:n};return new yd({verticesPerFeature:i,memory:o})}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,i,r,s,n,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(il(i,S2,this._context.elevationProvider.spatialReference),l!=null&&!jte(l,S2))return null;const c=Gme(s),u=this._computeGlobalTransform(i,s,jH,yF),d=this._computeLocalTransform(this._resources,this.symbolLayer,r,jme),p=this._resources.lodRenderer.instanceData,m=p.addInstance();this._instanceIndexToGraphicUid.set(m,n),p.setLocalTransform(m,d,!1),p.setGlobalTransform(m,u),a&&p.setFeatureAttribute(m,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&p.setColor(m,tI(r.color,r.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&p.setObjectAndLayerIdColor(m,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const g=new nwt(this,m,Mht,s);return c&&(g.alignedSampledElevation=yF.sampledElevation),g.needsElevationUpdates=Y1(s.mode),sT(g,i,this._context.elevationProvider),g}_computeGlobalTransform(e,i,r,s){return W1(e,this._context.elevationProvider,i,this._context.renderCoordsHelper,s),S2[0]=e.x,S2[1]=e.y,S2[2]=s.z,mu(e.spatialReference,S2,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(e,i,r,s){return Gd(s),this._applyObjectRotation(r,!1,s),this._applyObjectRotation(i,!0,s),this._applyObjectScale(e,r,s),this._applyAnchor(e,i,s),s}_applyObjectScale(e,i,r){var o;if((o=this._fastUpdates)!=null&&o.requiresShaderTransformation)return;const s=this._drivenProperties.size&&i.size?i.size:e.symbolSize,n=Mde(s,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||rL(r,r,n)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const i=e.diff.diff;this._preparePatchTransform(e,i),this._preparePatchColor(e,i)}updateGeometry(e,i){if(this._resources==null)return!0;const r=i&&ES(i);if(r==null)return!1;const s=this.getGeometryElevationMode(i);return e.elevationContext.mode===s&&(this._computeGlobalTransform(r,e.elevationContext,jH,yF),Gme(e.elevationContext)&&(e.alignedSampledElevation=yF.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,jH,!0),sT(e,r,this._context.elevationProvider),!0)}_preparePatchTransform(e,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||this._resources==null)return;const r=(g,y,v)=>(g!=null&&g.type==="complete"?g.newValue:y)??v,s=r(i.heading,this.symbolLayer.heading,0),n=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),u=r(i.anchor,this.symbolLayer.anchor,void 0),d=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const p={heading:s,tilt:n,roll:o,anchor:u,anchorPosition:d},m=this._resources;this.loadStatus===ah.LOADED&&e.symbolLayerStatePatches.push(()=>{m.symbolSize=Ol(L6(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((g,y)=>{const v=this._computeLocalTransform(m,p,y,jme),b=g.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(b,v,!0)})}_preparePatchColor(e,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const s=r.color.newValue,n=s!=null?Oe.toUnitRGBA(s):Md;delete r.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParameters({},s)):l=this._setMaterialTransparencyParameters({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_applyObjectRotation(e,i,r){var s;if(!((s=this._fastUpdates)!=null&&s.requiresShaderTransformation)||!i)return Vht(e.heading,e.tilt,e.roll,r)}_applyAnchor(e,i,r){var n;if((n=this._fastUpdates)!=null&&n.requiresShaderTransformation)return;const s=Bme(e.resourceBoundingBox,e.pivotOffset,i);s&&rl(r,r,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,i,r,s){const n=e!=null?Ol(c5(e)):s0,o=e!=null?Bme(e,s,this.symbolLayer):$n,a=this._context.renderCoordsHelper.unitInMeters,l=Mde(i??void 0,i,r,a),c=$e(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new TL({size:!0,color:!0,rotation:!0,opacity:!1},n,i??s0,a,o,l,c)}};function Bme(t,e,i){const r=E();switch(i.anchor){case"center":ce(r,of(t)),ea(r,r);break;case"top":{const s=of(t);ne(r,-s[0],-s[1],-t[5]);break}case"bottom":{const s=of(t);ne(r,-s[0],-s[1],-t[2]);break}case"relative":{const s=of(t),n=c5(t),o=i.anchorPosition,a=o?$e(o.x,o.y,o.z):$n;nB(r,n,a),me(r,r,s),ea(r,r);break}default:e!=null?ea(r,e):ce(r,$n)}return r}function Gme(t){return t.mode!=="absolute-height"}const S2=E(),jme=Ee(),jH=Ee(),gF=Qt(),yF=new ML;let Vxt=class{constructor(e,i,r,s){this.vertices=e,this.positionsES=i,this.offset=s;const n=e.length,o=Math.floor(n/2),a=this.offset+3*o,l=r[a],c=r[a+1],u=r[a+2];this.origin=$e(l,c,u),this.positions=ws(3*n);const d=this.offset+3*n;for(let p=this.offset;p<d;p+=3)this.positions[p]=r[p]-l,this.positions[p+1]=r[p+1]-c,this.positions[p+2]=r[p+2]-u;this.updatePathVertexInformation()}get usedMemory(){return b0(this.positions)}updatePathVertexInformation(){const e=this.vertices.length,i=this.vertices[0];let r=this.offset;const s=this.positions;i.vRight[0]=s[r+3]-s[r],i.vRight[1]=s[r+4]-s[r+1],i.vRight[2]=s[r+5]-s[r+2],r+=3;let n=Ae(i.vRight);i.vMinSiblingLength=n,ge(i.vRight,i.vRight);let o=i;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=s[r+3]-s[r],l.vRight[1]=s[r+4]-s[r+1],l.vRight[2]=s[r+5]-s[r+2];const c=Ae(l.vRight);l.vMinSiblingLength=Math.min(n,c),n=c,ge(l.vRight,l.vRight)}else ce(l.vRight,l.vLeft),l.vMinSiblingLength=n;o=l,r+=3}}},Bxt=class{constructor(e,i,r,s,n,o={}){this.path=e,this.profile=i,this.extruder=r,this.startCap=s,this.endCap=n,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=kst(1*this.numVerticesTotal),this.profileRightAxes=ws(4*this.numVerticesTotal),this.profileUpAxes=ws(4*this.numVerticesTotal),this.profileVertexAndNormals=ws(4*this.numVerticesTotal),this.positions=Ez(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}get usedMemory(){return b0(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(e,i,r,s,n){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=i.right[0],this.profileRightAxes[o+1]=i.right[1],this.profileRightAxes[o+2]=i.right[2],this.profileUpAxes[o]=i.up[0],this.profileUpAxes[o+1]=i.up[1],this.profileUpAxes[o+2]=i.up[2],this.profileVertexAndNormals[o]=r[0],this.profileVertexAndNormals[o+1]=r[1],this.profileVertexAndNormals[o+2]=s[0],this.profileVertexAndNormals[o+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,i,r,s,n,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=i.right[0],this.profileRightAxes[a+1]=i.right[1],this.profileRightAxes[a+2]=i.right[2],this.profileRightAxes[a+3]=n,this.profileUpAxes[a]=i.up[0],this.profileUpAxes[a+1]=i.up[1],this.profileUpAxes[a+2]=i.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=r[0],this.profileVertexAndNormals[a+1]=r[1],this.profileVertexAndNormals[a+2]=s[0],this.profileVertexAndNormals[a+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:i,vertices:r}=this.path;this.positions=Ez(e,i,3*r.length);let s=0;const n=(a,l,c,u,d)=>this.emitCapVertex(s,a,l,c,u,d),o=(a,l,c,u)=>this.emitVertex(s,a,l,c,u);for(this.startCap.rebuildConnectingProfileGeometry(r[s],this.profile,n),s=1;s<r.length-1;++s)this.extruder.extrude(r[s],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(r[s],this.profile,n),s=0,this.startCap.rebuildCapGeometry(r[s],n),s=r.length-1,this.endCap.rebuildCapGeometry(r[s],n)}buildTopology(){const e=this.profile.vertices.length,i=this.profile.numSegments,r=this.numExtrusionProfiles-1;let s=3*(2*(i*r));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.numIndices,this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,u,d)=>{n.push(c),n.push(u),n.push(d),o.push(c),o.push(u),o.push(d),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[u]),a.push(this.pathVertexData[d])};for(let c=0;c<i;++c){const u=this.profile.indices[2*c],d=this.profile.indices[2*c+1];for(let p=0;p<r;++p){const m=p*e+u,g=(p+1)*e+d,y=p*e+d;l(m,(p+1)*e+u,g),l(m,g,y)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=fg(n),this.normalIndices=fg(o),this.pathVertexIndices=fg(a)}onPathChanged(){this._rebuildGeometry()}},Sse=class{rebuildConnectingProfileGeometry(e,i,r){for(let s=0;s<i.vertices.length;++s)r(e.frame,i.vertices[s],i.normals[s],0,0)}},Hme=class extends Sse{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},_F=class extends Sse{constructor(e,i=0,r=!1){super(),this.profile=e,this.profilePlaneOffset=i,this.flip=r}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,i,r){const s=this.profilePlaneOffset;for(let n=0;n<i.vertices.length;++n)r(e.frame,i.vertices[n],i.normals[n],s,0)}rebuildCapGeometry(e,i){const r=this.profile,s=this.flip?1:-1,n=this.profilePlaneOffset,o=OLe;Pi(o,0,0);for(let a=0;a<r.vertices.length;++a)i(e.frame,r.vertices[a],o,n,s)}buildTopology(e,i){const r=this.profile,s=this.vertexBufferStart+r.indices[0];for(let n=1;n<r.numSegments;++n){const o=r.indices[2*n],a=r.indices[2*n+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?i(c,l,s):i(s,l,c)}}},qme=class extends Sse{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const i=this.profile;e+=2*i.numSegments*(this.numSegments-1);for(let r=0;r<i.numSegments;++r){const s=i.indices[2*r],n=i.indices[2*r+1];i.poleIndices[s]===i.poleIndices[n]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,i){const r=this.profile,s=e.frame,n=.5*this.sign,o=Gxt,a=OLe;Pi(a,0,0);for(const l of r.poles)l.normal?i(s,l.position,l.normal,n,0):i(s,l.position,a,n,this.sign);if(this.breakNormals)for(let l=0;l<r.vertices.length;++l)i(s,r.vertices[l],r.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,u=Math.sin(c),d=Math.cos(c);for(let p=0;p<r.vertices.length;++p){const m=r.poles[r.poleIndices[p]];Hm(o,r.vertices[p],m.position),hh(o,o,u),m.normal?(Bp(o,o,m.position),i(s,o,m.normal,n*d,0)):(r3(a,o),hh(a,a,u),Bp(o,o,m.position),i(s,o,a,n*d,this.sign*d))}}}buildTopology(e,i){const r=this.profile,s=this.breakNormals?this.vertexBufferStart+r.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+r.poles.length+r.vertices.length:this.vertexBufferStart+r.poles.length;for(let o=0;o<r.numSegments;++o){const a=r.indices[2*o],l=r.indices[2*o+1],c=this.vertexBufferStart+r.poleIndices[a],u=this.vertexBufferStart+r.poleIndices[l];let d=s+a,p=s+l;for(let m=0;m<this.numSegments-1;++m){const g=n+m*r.vertices.length+a,y=n+m*r.vertices.length+l;this.flip?(i(g,p,d),i(p,g,y)):(i(d,p,g),i(y,g,p)),d=g,p=y}this.flip?(i(c,p,d),c!==u&&i(c,u,p)):(i(d,p,c),c!==u&&i(p,u,c))}}};const Gxt=lt(),OLe=lt();let jxt=class{numProfilesPerJoin(){return 1}extrude(e,i,r){for(let s=0;s<i.vertices.length;++s)r(e.frame,i.vertices[s],i.normals[s],!1)}},HH=class{constructor(e,i){this.cutoffAngle=e,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,i,r){const s=qxt,{rotationAngle:n,rotationRight:o,frame:a}=e;if(Math.abs(n)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){wu(Yme,.5*-n+c*n/this.numBendSubdivisions,l),Hxt(s,a,Yme);for(let u=0;u<i.vertices.length;++u)Gn(i.vertices[u],o)*n>=0?r(s,i.vertices[u],i.normals[u],!1):r(a,e.applyMiterStretch(Wme,i.vertices[u]),i.normals[u],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<i.vertices.length;++c){const u=Gn(i.vertices[c],o)*n>=0;r(a,e.applyMiterStretch(Wme,i.vertices[c]),i.normals[c],!u)}}},RLe=class{constructor(){this.up=E(),this.right=E()}};function Hxt(t,e,i){He(t.up,e.up,i),He(t.right,e.right,i)}const Wme=lt(),Yme=Ee(),qxt=new RLe;let Wxt=class extends bn{constructor(e,i,r,s,n,o){super(e,i,null,Ls.Mesh,o),this.path=r,this.geometrySR=s,this.stencilWidth=n}};var yg;function $Le(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(yg||(yg={}));let ILe=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},LLe=class extends ILe{constructor(e){super(e),this.vertexAttributeColor=Wt(255,255,255,255),this.size=new Array,this.vertexAttributePosition=ws(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:i,pathVertexData:r,path:s,positions:n,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<i;++c){let u=r[c];const d=u===0||u===s.vertices.length-1;u*=3;const p=Qxt;let m=0,g=0;const y=4*c,v=ne(Kxt,o[y],o[y+1],o[y+2]),b=ne(eSt,a[y],a[y+1],a[y+2]),w=Pi(Zme,l[y]*e[0],l[y+1]*e[1]);if(d)ot(p,b,v),m=o[y+3]*e[0],g=a[y+3];else{const M=Zxt,O=Xxt;Pi(M,o[y+3],a[y+3]);const D=iie(M);r3(M,M);const k=Gn(w,M);if(Math.abs(k)>D){Pi(O,-M[1],M[0]);const U=Gn(w,O);hh(M,M,D*Math.sign(k)),hh(O,O,U),Bp(w,M,O)}ne(p,0,0,0)}const x=ne(Jxt,v[0]*w[0]+b[0]*w[1],v[1]*w[0]+b[1]*w[1],v[2]*w[0]+b[2]*w[1]),T=3*c;this.vertexAttributePosition[T]=n[u]+x[0]+p[0]*m,this.vertexAttributePosition[T+1]=n[u+1]+x[1]+p[1]*m,this.vertexAttributePosition[T+2]=n[u+2]+x[2]+p[2]*m;const C=Pi(Zme,l[y+2],l[y+3]);Wd(this.vertexAttributeNormal,c,v[0]*C[0]+b[0]*C[1]+p[0]*g,v[1]*C[0]+b[1]*C[1]+p[1]*g,v[2]*C[0]+b[2]*C[1]+p[2]*g)}}createGeometryData(){const e=this.builder.vertexIndices.length,{normalIndices:i,vertexIndices:r}=this.builder;return[[R.POSITION,new it(this.vertexAttributePosition,r,3,!0)],[R.NORMALCOMPRESSED,new it(this.vertexAttributeNormal,i,2,!0)],[R.COLOR,new it(this.vertexAttributeColor,fb(e),4)]]}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,i,r,s){const n=this.builder.vertexIndices,o=new cL(this.vertexAttributePosition,3),a=n.length/3;vRe(e,i,0,a,n,o,void 0,r,(l,c,u)=>{s(l,u,c,!1)})}},Yxt=class extends ILe{constructor(e,i,r,s){super(e),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=s,this.vvData=null,this.baked=new LLe(e),this.vvData=ws(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n]=i,this.vvData[4*n+1]=r,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){const{positions:e,profileRightAxes:i,profileUpAxes:r,profileVertexAndNormals:s,pathVertexIndices:n,vertexIndices:o}=this.builder;return[[R.POSITION,new it(e,n,3,!0)],[R.PROFILERIGHT,new it(i,o,4,!0)],[R.PROFILEUP,new it(r,o,4,!0)],[R.PROFILEVERTEXANDNORMAL,new it(s,o,4,!0)],[R.FEATUREVALUE,new it(this.vvData,n,4,!0)]]}onPathChanged(e){super.onPathChanged(e);const i=e.getMutableAttribute(R.POSITION);i&&(i.data=this.builder.positions)}};const Zme=lt(),Zxt=lt(),Xxt=lt(),Jxt=E(),Qxt=E(),Kxt=E(),eSt=E();function tSt(t,e){let i=null;const r=t.vertices.length,s=.99619469809,n=E(),o=E(),a=E(),l=E(),c=E(),u=E(),d=Qi();let p=t.vertices[0];ce(o,e),ne(n,0,1,0),Az(p.vRight,o,n,n,a,o,s),ce(p.frame.up,o),ce(p.frame.right,a);const m=t.positions;let g=t.offset;i=p;for(let y=1;y<r;++y){p=t.vertices[y],me(c,p.vLeft,p.vRight);let v=Ae(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=p.vRight[0],c[1]=p.vRight[1],c[2]=p.vRight[2]),u[0]=m[g]+i.frame.up[0],u[1]=m[g+1]+i.frame.up[1],u[2]=m[g+2]+i.frame.up[2],g+=3;const b=ne(iSt,m[g],m[g+1],m[g+2]);nL(b,c,d),vT(d,Mh(u,p.vLeft),l)?(l[0]-=m[g],l[1]-=m[g+1],l[2]-=m[g+2],ge(o,l),ot(a,c,o),ge(a,a)):Az(c,i.frame.up,i.frame.right,n,a,o,s),ce(p.frame.up,o),ce(p.frame.right,a),i=p}}const iSt=E();let DLe=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,i){return this.vertices.push(AO(e)),this.normals.push(AO(i)),this.vertices.length-1}addPole(e,i=null){return this.poles.push({position:AO(e),normal:i?AO(i):null}),this.poles.length-1}addSegment(e,i=null){this.indices.push(e.v0),this.indices.push(e.v1),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.indices.length/2}translate(e,i){for(const r of this.vertices)r[0]+=e,r[1]+=i;for(const r of this.poles)r.position[0]+=e,r.position[1]+=i}get usedMemory(){return this.vertices.length*b0(this.vertices[0])*2+b0(this.indices)}};const NLe={top:[0,-.5],bottom:[0,.5]};function qH(t){const i=sRe,r=new DLe,s={v0:0,v1:0};r.addPole(_i(0,0));for(let o=0;o<i;++o){const a=2*o*Math.PI/i,l=Math.cos(a),c=Math.sin(a),u=_i(l*.5,c*.5),d=_i(l,c);r.addVertex(u,d)}for(let o=0;o<i-1;++o){const a={v0:o,v1:o+1};r.addSegment(a,s)}const n={v0:i-1,v1:0};if(r.addSegment(n,s),t!=="center"){const o=NLe[t];r.translate(o[0],o[1])}return r}const rSt={center:qH("center"),top:qH("top"),bottom:qH("bottom")},sSt={center:WH("center"),top:WH("top"),bottom:WH("bottom")};function WH(t){const r=new DLe,s=_i(.5*-1,.5*-1),n=_i(.5*1,.5*-1),o=_i(.5*1,.5*1),a=_i(.5*-1,.5*1),l=_i(0,-1),c=_i(1,0),u=_i(0,1),d=_i(-1,0);if(r.addPole(_i(0,.5*1),u),r.addPole(_i(0,.5*1)),r.addPole(_i(0,.5*-1)),r.addPole(_i(0,.5*-1),l),r.addVertex(s,l),r.addVertex(n,l),r.addSegment({v0:0,v1:1},{v0:3,v1:3}),r.addVertex(n,c),r.addVertex(o,c),r.addSegment({v0:2,v1:3},{v0:2,v1:1}),r.addVertex(o,u),r.addVertex(a,u),r.addSegment({v0:4,v1:5},{v0:0,v1:0}),r.addVertex(a,d),r.addVertex(s,d),r.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const p=NLe[t];r.translate(p[0],p[1])}return r}function nSt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function oSt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function FLe(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function aSt(t,e){if(t===e){const i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function lSt(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let o=i*n-s*r;return o?(o=1/o,t[0]=n*o,t[1]=-r*o,t[2]=-s*o,t[3]=i*o,t):null}function cSt(t,e){const i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t}function uSt(t){return t[0]*t[3]-t[2]*t[1]}function kLe(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*a+n*l,t[1]=s*a+o*l,t[2]=r*c+n*u,t[3]=s*c+o*u,t}function hSt(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+n*a,t[1]=s*l+o*a,t[2]=r*-a+n*l,t[3]=s*-a+o*l,t}function dSt(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1];return t[0]=r*a,t[1]=s*a,t[2]=n*l,t[3]=o*l,t}function pSt(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t}function fSt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function mSt(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function gSt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function ySt(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]}function _St(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function ULe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function vSt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function bSt(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=Lo();return Math.abs(i-o)<=u*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))}function wSt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function xSt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}const SSt=kLe,TSt=ULe;Object.freeze(Object.defineProperty({__proto__:null,LDU:ySt,add:_St,adjoint:cSt,copy:nSt,determinant:uSt,equals:bSt,exactEquals:vSt,frob:gSt,fromRotation:pSt,fromScaling:fSt,identity:oSt,invert:lSt,mul:SSt,multiply:kLe,multiplyScalar:wSt,multiplyScalarAndAdd:xSt,rotate:hSt,scale:dSt,set:FLe,str:mSt,sub:TSt,subtract:ULe,transpose:aSt},Symbol.toStringTag,{value:"Module"}));function zLe(){return[1,0,0,1]}function ESt(t){return[t[0],t[1],t[2],t[3]]}function CSt(t,e,i,r){return[t,e,i,r]}function MSt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:ESt,create:zLe,createView:MSt,fromValues:CSt},Symbol.toStringTag,{value:"Module"}));let VLe=class{constructor(){this.vLeft=E(),this.vRight=E(),this.vMinSiblingLength=0,this.frame=new RLe}setFrameFromUpVector(e){ce(this.frame.up,e),me(nO,this.vLeft,this.vRight),ge(nO,nO),oe(Qme,this.frame.up,pe(nO,this.frame.up)),ve(vF,nO,Qme),ge(vF,vF),ot(this.frame.right,vF,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},ASt=class extends VLe{get rotationFrameUp(){return this.frame.up}get rotationRight(){return VSe}get rotationAngle(){return oe($_,this.frame.up,pe(this.frame.up,this.vLeft)),ve($_,this.vLeft,$_),ea($_,$_),ge($_,$_),oe(E2,this.frame.up,pe(this.frame.up,this.vRight)),ve(E2,this.vRight,E2),ge(E2,E2),ot(bV,this.rotationFrameUp,this.vLeft),Math.sign(pe(bV,this.vRight))*(Math.PI-fo(pe($_,E2)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,i){const r=this.rotationAngle;if(Math.abs(r)<=0)return i;const s=G9(Math.cos(.5*r));return Pi(e,(s-1+1)*i[0],i[1])}},PSt=class extends VLe{get rotationFrameUp(){const e=Math.sign(pe(this.frame.right,this.vRight));return ot(sO,this.vRight,this.vLeft),oe(sO,sO,e),ge(sO,sO)}get rotationRight(){const e=this.rotationFrameUp,i=pe(e,this.frame.up),r=pe(e,this.frame.right);return oe(T2,this.frame.up,-r),oe(Jme,this.frame.right,i),me(T2,T2,Jme),ge(T2,T2),OSt(Xme,this.frame,T2),Xme}get rotationAngle(){const e=Math.sign(pe(this.frame.right,this.vRight));return ea(bV,this.vLeft),-e*(Math.PI-fo(pe(bV,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*G9(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,i){const r=this.rotationAngle;if(Math.abs(r)===0)return i;const s=G9(Math.cos(.5*r)),n=this.rotationRight,o=FLe($St,1+(s-1)*n[0]*n[0],(s-1)*n[0]*n[1],(s-1)*n[0]*n[1],1+(s-1)*n[1]*n[1]);return gMe(e,i,o)}};function OSt(t,e,i){Pi(t,pe(i,e.right),pe(i,e.up))}function RSt(t){switch(t){case yg.World:return new ASt;case yg.Path:return new PSt}}const sO=E(),Xme=lt(),T2=E(),Jme=E(),bV=E(),$_=E(),E2=E(),Qme=E(),nO=E(),vF=E(),$St=zLe(),YH=8;function ISt(t,e){const i=R.FEATUREVALUE;t.attributes.add(i,"vec4");const r=t.vertex;r.code.add(S`
  bool isCapVertex() {
    return ${i}.w == 1.0;
  }
  `),r.uniforms.add(new Fr("size",s=>s.size)),e.vvSize?(r.uniforms.add(new Vt("vvSizeMinSize",s=>s.vvSize.minSize),new Vt("vvSizeMaxSize",s=>s.vvSize.maxSize),new Vt("vvSizeOffset",s=>s.vvSize.offset),new Vt("vvSizeFactor",s=>s.vvSize.factor)),r.code.add(S`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${i}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):r.code.add(S`vec2 getSize(){
return size;
}`),e.vvOpacity?(r.constants.add("vvOpacityNumber","int",YH),r.uniforms.add(new Fl("vvOpacityValues",s=>s.vvOpacity.values,YH),new Fl("vvOpacityOpacities",s=>s.vvOpacity.opacityValues,YH)),r.code.add(S`
    vec4 applyOpacity(vec4 color) {
      float value = ${i}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):r.code.add(S`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(r.constants.add("vvColorNumber","int",nM),r.uniforms.add(new Fl("vvColorValues",s=>s.vvColor.values,nM),new LOe("vvColorColors",s=>s.vvColor.colors,nM)),r.code.add(S`
    vec4 getColor() {
      float value = ${i}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):r.code.add(S`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(yL),t.attributes.add(R.PROFILERIGHT,"vec4"),t.attributes.add(R.PROFILEUP,"vec4"),t.attributes.add(R.PROFILEVERTEXANDNORMAL,"vec4"),r.code.add(S`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),r.code.add(S`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),r.code.add(S`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),r.code.add(S`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let LSt=class extends EL{constructor(){super(...arguments),this.size=_i(1,1)}};function S3(t,e){e.spherical?t.vertex.code.add(S`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(S`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(S`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(S`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function BLe(t){const e=new Vi,{vertex:i,fragment:r}=e;switch(bc(i,t),e.varyings.add("vpos","vec3"),e.include(ISt,t),t.output!==G.Color&&t.output!==G.ObjectAndLayerIdColor||(e.include(Ja,t),e.include(hA,t),e.include(ZA,t),e.include(LT,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.multipassEnabled&&e.varyings.add("depth","float"),i.code.add(S`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===G.Color?"forwardLinearDepth();":""}
        forwardObjectAndLayerIdColor();

        vcolor = getColor();
      }
    `)),e.include(Vg,t),t.output){case G.Color:e.include(gn,t),e.include(rT,t),e.include(RL,t),e.include(hA,t),e.include(gRe,t),Rf(r,t),$L(r),tP(r),r.uniforms.add(i.uniforms.get("localOrigin"),new Vt("ambient",s=>s.ambient),new Vt("diffuse",s=>s.diffuse),new Vt("specular",s=>s.specular),new qe("opacity",s=>s.opacity)),r.include(Ug),t.transparencyPassType===nt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),Lg(r),r.code.add(S`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===nt.ColorAlpha?S`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}
        }
      `);break;case G.Depth:e.include(Ja,t),i.code.add(S`void main() {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(gn,t),r.code.add(S`void main() {
discardBySlice(vpos);
}`);break;case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:case G.ViewshedShadow:e.include(Ja,t),bG(e),e.varyings.add("depth","float"),i.code.add(S`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(gn,t),e.include(JG,t),r.code.add(S`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case G.ObjectAndLayerIdColor:e.include(gn,t),r.code.add(S`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`);break;case G.Normal:e.include(Ja,t),e.include(S3,t),iA(i),e.varyings.add("vnormal","vec3"),i.code.add(S`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(gn,t),r.code.add(S`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case G.Highlight:e.include(Ja,t),e.include(S3,t),e.varyings.add("vnormal","vec3"),i.code.add(S`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(gn,t),e.include(gb,t),r.code.add(S`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const DSt=Object.freeze(Object.defineProperty({__proto__:null,build:BLe},Symbol.toStringTag,{value:"Module"})),GLe=new Map([[R.POSITION,0],[R.PROFILERIGHT,1],[R.PROFILEUP,2],[R.PROFILEVERTEXANDNORMAL,3],[R.FEATUREVALUE,4],[R.OBJECTANDLAYERIDCOLOR,5]]);let NSt=class extends LSt{constructor(){super(...arguments),this.ambient=$e(.2,.2,.2),this.diffuse=$e(.8,.8,.8),this.specular=$e(0,0,0),this.opacity=1,this.origin=E(),this.modelTransformation=null}},jLe=class HLe extends Wi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Ge.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Yi(e.rctx,HLe.shader.get().build(this.configuration),GLe)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===nt.NONE,s=e===nt.FrontFace;return Gt({blending:i.output===G.Color&&i.transparent?r?gu:Z0(e):null,culling:i.hasSlicePlane&&!i.transparent&&i.doubleSidedMode!==xs.None?EMe:null,depthTest:{func:yb(e)},depthWrite:r||s?Tu:null,drawBuffers:i.output===G.Depth?{buffers:[ao.NONE]}:X0(e),colorWrite:Kt,stencilWrite:i.hasOccludees?Mg:null,stencilTest:i.hasOccludees?_b:null,polygonOffset:r||s?null:jG})}};jLe.shader=new Bi(DSt,()=>fe(()=>Promise.resolve().then(()=>SUt),void 0));let Fn=class extends Ec{constructor(){super(...arguments),this.output=G.Color,this.doubleSidedMode=xs.None,this.transparencyPassType=nt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1,this.objectAndLayerIdColorInstanced=!1}};h([B({count:G.COUNT})],Fn.prototype,"output",void 0),h([B({count:xs.COUNT})],Fn.prototype,"doubleSidedMode",void 0),h([B({count:nt.COUNT})],Fn.prototype,"transparencyPassType",void 0),h([B()],Fn.prototype,"spherical",void 0),h([B()],Fn.prototype,"receiveShadows",void 0),h([B()],Fn.prototype,"receiveAmbientOcclusion",void 0),h([B()],Fn.prototype,"vvSize",void 0),h([B()],Fn.prototype,"vvColor",void 0),h([B()],Fn.prototype,"vvOpacity",void 0),h([B()],Fn.prototype,"hasSlicePlane",void 0),h([B()],Fn.prototype,"transparent",void 0),h([B()],Fn.prototype,"hasOccludees",void 0),h([B()],Fn.prototype,"multipassEnabled",void 0),h([B()],Fn.prototype,"cullAboveGround",void 0),h([B()],Fn.prototype,"doublePrecisionRequiresObfuscation",void 0),h([B({constValue:!1})],Fn.prototype,"occlusionPass",void 0),h([B({constValue:xt.Disabled})],Fn.prototype,"pbrMode",void 0),h([B({constValue:!0})],Fn.prototype,"hasVvInstancing",void 0),h([B({constValue:!1})],Fn.prototype,"useCustomDTRExponentForWater",void 0),h([B({constValue:!1})],Fn.prototype,"useFillLights",void 0),h([B({constValue:!1})],Fn.prototype,"hasColorTexture",void 0);let FSt=class qLe extends mb{constructor(e){super(e,new USt),this.supportsEdges=!0,this.produces=new Map([[_e.OPAQUE_MATERIAL,i=>(this.parameters.castShadows&&JC(i)||Y$(i))&&!this.parameters.transparent],[_e.TRANSPARENT_MATERIAL,i=>(this.parameters.castShadows&&JC(i)||Y$(i))&&this.parameters.transparent]]),this._vertexAttributeLocations=GLe,this._configuration=new Fn,this._vertexBufferLayout=qLe.getVertexBufferLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e===G.Color&&(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?xs.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?xs.WindingOrder:xs.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=i.ssao!=null),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==G.Shadow&&e!==G.ShadowExcludeHighlight&&e!==G.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,i,r,s,n,o){const a=e;if(!$Le(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:b,factor:w,minSize:x,maxSize:T}=this.parameters.vvSize,C=l.sizeAttributeValue;c[0]*=Te(b[0]+C*w[0],x[0],T[0]),c[1]*=Te(b[2]+C*w[2],x[2],T[2])}const u=new AL(!1,r.options.normalRequired),d=Math.max(c[0],c[1]),p=e.boundingInfo;if(p==null)return void Kme(l,c,s,n,u,o);const m=XS(p.bbMin[0]-d,p.bbMin[1]-d,p.bbMin[2]-d,p.bbMax[0]+d,p.bbMax[1]+d,p.bbMax[2]+d),g=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],y=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]),v=[y/g[0],y/g[1],y/g[2]];xre(m,s,v,r.tolerance)&&Kme(l,c,s,n,u,o)}createBufferWriter(){return new KA(this._vertexBufferLayout)}createGLMaterial(e){return new kSt(e)}static getVertexBufferLayout(){const e=Ts().vec3f(R.POSITION).vec4f(R.PROFILERIGHT).vec4f(R.PROFILEUP).vec4f(R.PROFILEVERTEXANDNORMAL).vec4f(R.FEATUREVALUE);return re("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),e}},kSt=class extends pb{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output===G.Color&&(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(jLe,e)}};function Kme(t,e,i,r,s,n){t.baked.size&&t.baked.size[0]===e[0]&&t.baked.size[1]===e[1]||t.baked.bake(e),t.baked.intersect(i,r,s,n)}let USt=class extends NSt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const zSt=["polyline"];let VSt=class extends Gg{constructor(e,i,r,s){super(e,i,r,s),this._intrinsicSize=_i(1,1),this._upVectorAlignment=yg.Path,this._stencilWidth=.1,this.usedMemory=0,this.ensureDrapedStatus(!1)}async doLoad(){var p,m,g,y,v;const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,i=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new TL({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,i],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=((m=(p=this._context.renderer)==null?void 0:p.visualVariables)==null?void 0:m.length)>0?oA(this._context.renderer,this._vvConvertOptions):null;const r=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?yg.World:yg.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=rSt[r];break;case"quad":this._profile=sSt[r]}switch(this.symbolLayer.join){case"round":this._extruder=new HH(0,rRe);break;case"bevel":this._extruder=new HH(0,1);break;case"miter":this._extruder=new HH(.8*Math.PI,1);break;default:this._extruder=new jxt}const n=this.symbolLayer.cap||"butt";switch(n){case"none":this._startCap=new Hme,this._endCap=new Hme;break;case"butt":default:this._startCap=new _F(this._profile,0),this._endCap=new _F(this._profile,0,!0);break;case"square":this._startCap=new _F(this._profile,-.5),this._endCap=new _F(this._profile,.5,!0);break;case"round":{const b=s==="quad";this._startCap=new qme({profile:this._profile,flip:!1,breakNormals:b,subdivisions:bX}),this._endCap=new qme({profile:this._profile,flip:!0,breakNormals:b,subdivisions:bX});break}}const o=(y=(g=this.symbolLayer)==null?void 0:g.material)==null?void 0:y.color,a=this._getCombinedOpacityAndColor(o),l=Ol(a),c=a[3],u=c<1||this.needsDrivenTransparentPass,d={diffuse:l,ambient:l,opacity:c,transparent:u,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:u||n==="none"?Nr.None:Nr.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(Pi(this._intrinsicSize,e,i),!vX(this._intrinsicSize[0])||!vX(this._intrinsicSize[1])))throw new V("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if((v=this._fastUpdates)!=null&&v.visualVariables.size||hh(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const b={...d,...this._fastUpdates.materialParameters,size:NSe(this._intrinsicSize)};this._materials[0]=new FSt(b)}else d.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,d.normalType=Ki.Compressed,this._materials[0]=new If(d);this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials[0]=null,this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,zSt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i),s=e.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(){var s,n,o;const e=(n=(s=this.symbolLayer)==null?void 0:s.material)==null?void 0:n.color,i=this._getCombinedOpacity(e),r=i<1||this.needsDrivenTransparentPass;(o=this._materials[0])==null||o.setParameters({opacity:i,transparent:r})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Y1)}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){var e;return(e=this._materials[0])==null||e.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,i){var r;for(const s in e.diff){if(s!=="visualVariables"||!aA(this._fastUpdates,i,this._vvConvertOptions))return an.RecreateSymbol;(r=this._materials[0])==null||r.setParameters(this._fastUpdates.materialParameters)}return an.FastUpdate}_getVertexData(e){let i=0;const r=e.paths,s=[],n=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const d of r)i+=d.length;const l=ho(3*i);let c,u=0;for(const d of r){s.push({offset:u,numVertices:d.length});for(const p of d)l[u++]=p[0],l[u++]=p[1],l[u++]=e.hasZ?p[2]:0}return o==null||n.equals(o)||ns(l,n,0,l,o,0,i)?(o==null||o.equals(a)?c=YAe(l):(c=ho(3*i),ns(l,o,0,c,a,0,i)),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,i,r,s){var g,y,v;this.usedMemory=0;const n=e.geometry,o=this._getVertexData(n);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(b=>b.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=n.spatialReference,c=Jn(),u=this._context.renderCoordsHelper,d=new bte(o.vertexDataES);for(const b of o.pathVertexDataInfos){const w=b.numVertices;if(w<2)continue;const x=b.offset;if(this._context.clippingExtent!=null&&(Br(c),yh(c,o.vertexDataES,x,w),!af(c,this._context.clippingExtent)))continue;const T=new Array,C=x+3*w;for(let z=x;z<C;z+=3){d.offset=z;const Z=_ht(d,this._context.elevationProvider,r,u);ne(Ys,o.vertexDataRS[z],o.vertexDataRS[z+1],o.vertexDataRS[z+2]),u.setAltitude(Ys,Z),o.vertexDataRS[z]=Ys[0],o.vertexDataRS[z+1]=Ys[1],o.vertexDataRS[z+2]=Ys[2],T.push(RSt(this._upVectorAlignment))}const M=new Vxt(T,o.vertexDataES,o.vertexDataRS,x);WLe(M,this._upVectorAlignment,this._context.renderCoordsHelper);const O=new Bxt(M,this._profile,this._extruder,this._startCap,this._endCap);let D=null;if(this._fastUpdates){const z=this._fastUpdates.visualVariables,Z=_f((g=z.size)==null?void 0:g.field,e)??0,q=_f((y=z.color)==null?void 0:y.field,e)??0,Y=_f((v=z.opacity)==null?void 0:v.field,e)??0;D=new Yxt(O,Z,q,Y)}else{const z=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const Y=i.size;z[0]*=ege(Y[0],Y[2]==="symbol-value"?this.symbolLayer.height||0:Y[2],this.symbolLayer.width||0),z[1]*=ege(Y[2],Y[0]==="symbol-value"?this.symbolLayer.width||0:Y[0],this.symbolLayer.height||0)}let Z;this._drivenProperties.color&&(Z=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(Z=Z?[Z[0],Z[1],Z[2],i.opacity]:[1,1,1,i.opacity]);const q=new LLe(O);q.bake(z),Z&&q.bakeVertexColors(Z),D=q}const k=D.createGeometryData(),U=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),H=new Wxt(this._materials[0],k,D,l,this._stencilWidth,U);H.transformation=rl(Ee(),Vr,O.path.origin),a.push(H),this.usedMemory+=O.usedMemory}if(a.length===0)return null;const p=new vb({geometries:a,layerUid:this._context.layer.uid,graphicUid:s}),m=new Bg(this,p,a,null,null,(b,w,x,T,C)=>GSt(b,w,T,C,this._upVectorAlignment),r);return m.alignedSampledElevation=0,m.needsElevationUpdates=Y1(r.mode),m}};function WLe(t,e,i){const{origin:r,positions:s}=t;let n=t.offset;switch(e){default:case yg.World:for(const o of t.vertices)Ys[0]=s[n++]+r[0],Ys[1]=s[n++]+r[1],Ys[2]=s[n++]+r[2],i.worldUpAtPosition(Ys,Ys),o.setFrameFromUpVector(Ys);break;case yg.Path:Ys[0]=s[n]+r[0],Ys[1]=s[n+1]+r[1],Ys[2]=s[n+2]+r[2],i.worldUpAtPosition(Ys,Ys),tSt(t,Ys)}}function ege(t,e,i){switch(t){case"symbol-value":return i;case"proportional":return e;default:return t}}function BSt(t,e,i,r){let s=0;const{origin:n,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let u=t.offset;u<c;u+=3)ne(Ys,l[u],l[u+1],l[u+2]),i(Ys,ZH),s+=ZH.sampledElevation,Ys[0]=a[u]+n[0],Ys[1]=a[u+1]+n[1],Ys[2]=a[u+2]+n[2],r.setAltitude(Ys,ZH.z),a[u]=Ys[0]-n[0],a[u+1]=Ys[1]-n[1],a[u+2]=Ys[2]-n[2];return t.updatePathVertexInformation(),s/o.length}function GSt(t,e,i,r,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!$Le(l))continue;const c=l.path,u=c.builder.path;a+=BSt(u,e,i,r),s!==yg.World&&WLe(u,s,r),c.onPathChanged(l),l.invalidateBoundingInfo(),n.geometryVertexAttributeUpdated(l,R.POSITION)}return a/o.length}const Ys=E(),ZH=new ML;function jSt(t,e,i,r,s=1){if(i.isGeographic&&r===Ge.Global){const c=ho(e.length),u=e.length,d=ur(i);for(let p=0;p<u;p+=3)kee(e,p,c,p,d);e=c}Pi(Hn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)Hn[0]=Math.min(Hn[0],e[c]),Hn[1]=Math.min(Hn[1],e[c+1]);const n=Hn[0]%s,o=Hn[1]%s,a=Hn[0]-n,l=Hn[1]-o;for(let c=0;c<e.length;c+=3){const u=c/3*4;t[u]=(e[c]-a)/s,t[u+1]=(e[c+1]-l)/s,t[u+2]=a/s,t[u+3]=l/s}}function YLe(t,e,i,r,s=1){ne(ew,1,0,0),ne(tw,0,1,0),ne(M2,0,0,1),qSt(XH,i),C9e(tge,i)&&HSt(tge,ew,tw,M2,r,XH),Pi(Hn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Pi(iw,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u=0;u<i.length;u+=3){ne(C2,i[u],i[u+1],i[u+2]);const d=pe(ew,C2),p=pe(tw,C2);Hn[0]=Math.min(Hn[0],d),Hn[1]=Math.min(Hn[1],p),iw[0]=Math.max(iw[0],d),iw[1]=Math.max(iw[1],p)}const n=pe(M2,XH);QH(I_,Hn[0],Hn[1],n,ew,tw,M2),QH(rw,iw[0],Hn[1],n,ew,tw,M2),QH(sw,Hn[0],iw[1],n,ew,tw,M2),ve(rw,rw,I_),oe(rw,rw,.5),ve(sw,sw,I_),oe(sw,sw,.5),me(I_,I_,rw),me(I_,I_,sw);const o=Hn[0]%s,a=Hn[1]%s,l=Hn[0]-o,c=Hn[1]-a;for(let u=0;u<i.length;u+=3){ne(C2,i[u],i[u+1],i[u+2]);const d=u/3,p=4*d;t[p]=(pe(ew,C2)-l)/s,t[p+1]=(pe(tw,C2)-c)/s,t[p+2]=l/s,t[p+3]=c/s;const m=9*d;for(let g=0;g<3;g++)e[m+g]=I_[g],e[m+g+3]=rw[g],e[m+g+6]=sw[g]}}const XH=E(),C2=E(),tge=Qi(),ew=E(),tw=E(),M2=E(),Hn=lt(),iw=lt(),I_=E(),rw=E(),sw=E();function HSt(t,e,i,r,s,n){s!=null?(s.basisMatrixAtPosition(n,sm),ne(bF,sm[0],sm[1],sm[2]),ne(wF,sm[4],sm[5],sm[6]),ne(JH,sm[8],sm[9],sm[10])):(ne(bF,1,0,0),ne(wF,0,1,0),ne(JH,0,0,1));const o=t;pe(o,JH)<0&&oe(o,o,-1),ce(r,o);const a=pe(o,wF),l=pe(o,bF);Math.abs(a)>Math.abs(l)?(On(e,bF,o,-l),ge(e,e),ot(i,e,o),ge(i,i),oe(i,i,-1)):(On(i,wF,o,-a),ge(i,i),ot(e,i,o),ge(e,e))}const sm=Ee(),bF=E(),wF=E(),JH=E();function qSt(t,e){ne(oO,0,0,0);for(let i=0;i<e.length-3;i+=3)oO[0]+=e[i],oO[1]+=e[i+1],oO[2]+=e[i+2];oe(t,oO,1/(e.length/3-1))}const oO=E();function QH(t,e,i,r,s,n,o){ne(t,e*s[0]+i*n[0]+r*o[0],e*s[1]+i*n[1]+r*o[1],e*s[2]+i*n[2]+r*o[2])}let Tse=class extends mb{intersect(e,i,r,s,n,o){return yRe(e,r,s,n,void 0,o)}};function ZLe(t){const e=new Vi,{vertex:i,fragment:r,attributes:s,varyings:n}=e;bc(i,t),e.include(Ja,t),e.include(DT,t),e.include(g0,t),e.include(LT,t),s.add(R.POSITION,"vec3"),t.vvColor&&s.add(R.COLORFEATUREATTRIBUTE,"float"),n.add("vColor","vec4"),n.add("vpos","vec3");const o=t.multipassEnabled&&t.output===G.Color;o&&n.add("depth","float"),i.uniforms.add(new zi("eColor",l=>l.color)),i.code.add(S`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),e.include(gn,t),o&&e.include(Vg,t),r.include(Ug);const a=t.output===G.Highlight;return a&&e.include(gb,t),t.transparencyPassType===nt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),r.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${t.output===G.ObjectAndLayerIdColor?S`fColor.a = 1.0;`:""}

    if (fColor.a < ${S.float(Xo)}) {
      discard;
    }

    ${t.output===G.Color?S`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===nt.ColorAlpha?S`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}`:""}
    ${a?S`outputHighlight();`:""};
    ${t.output===G.ObjectAndLayerIdColor?S`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const WSt=Object.freeze(Object.defineProperty({__proto__:null,build:ZLe},Symbol.toStringTag,{value:"Module"}));let XLe=class JLe extends Wi{initializeProgram(e){return new Yi(e.rctx,JLe.shader.get().build(this.configuration),wi)}_createPipeline(e,i){const r=this.configuration,s=e===nt.NONE,n=e===nt.FrontFace;return Gt({blending:r.output===G.Color&&r.transparent?s?gu:Z0(e):null,culling:yG(r.cullFace),depthTest:r.draped?null:{func:yb(e)},depthWrite:r.draped?null:(s||n)&&r.writeDepth?Tu:null,drawBuffers:r.output===G.Depth?{buffers:[ao.NONE]}:X0(e),colorWrite:Kt,stencilWrite:r.hasOccludees?Mg:null,stencilTest:r.hasOccludees?i?Z1:_b:null,polygonOffset:s||n?r.polygonOffset?YSt:null:HG(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};XLe.shader=new Bi(WSt,()=>fe(()=>Promise.resolve().then(()=>TUt),void 0));const YSt={factor:1,units:1};let wo=class extends Ec{constructor(){super(...arguments),this.output=G.Color,this.cullFace=Nr.None,this.transparencyPassType=nt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1}};h([B({count:G.COUNT})],wo.prototype,"output",void 0),h([B({count:Nr.COUNT})],wo.prototype,"cullFace",void 0),h([B({count:nt.COUNT})],wo.prototype,"transparencyPassType",void 0),h([B()],wo.prototype,"hasSlicePlane",void 0),h([B()],wo.prototype,"hasVertexColors",void 0),h([B()],wo.prototype,"transparent",void 0),h([B()],wo.prototype,"polygonOffset",void 0),h([B()],wo.prototype,"enableOffset",void 0),h([B()],wo.prototype,"writeDepth",void 0),h([B()],wo.prototype,"hasOccludees",void 0),h([B()],wo.prototype,"multipassEnabled",void 0),h([B()],wo.prototype,"cullAboveGround",void 0),h([B()],wo.prototype,"objectAndLayerIdColorInstanced",void 0),h([B()],wo.prototype,"vvColor",void 0),h([B()],wo.prototype,"draped",void 0),h([B({constValue:!1})],wo.prototype,"occlusionPass",void 0),h([B({constValue:!0})],wo.prototype,"hasVvInstancing",void 0),h([B({constValue:!1})],wo.prototype,"vvSize",void 0),h([B({constValue:!1})],wo.prototype,"vvOpacity",void 0);let ige=class extends Tse{constructor(e){super(e,new XSt),this.supportsEdges=!0,this.produces=new Map([[_e.OPAQUE_MATERIAL,i=>i===G.Highlight||K6(i)&&!this._isTransparent],[_e.OPAQUE_NO_SSAO_DEPTH,i=>h1(i)&&this.parameters.writeLinearDepth&&!this._isTransparent],[_e.TRANSPARENT_MATERIAL,i=>K6(i)&&this._isTransparent&&this.parameters.writeDepth],[_e.TRANSPARENT_NO_SSAO_DEPTH,i=>h1(i)&&this.parameters.writeLinearDepth&&this._isTransparent&&this.parameters.writeDepth],[_e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>(K6(i)||h1(i)&&this.parameters.writeLinearDepth)&&this._isTransparent&&!this.parameters.writeDepth],[_e.DRAPED_MATERIAL,i=>EAe(i)]]),this._configuration=new wo}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<GG,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}createGLMaterial(e){return new ZSt(e)}createBufferWriter(){const e=Ts().vec3f(R.POSITION);return re("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4u8(R.COLOR),new KA(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}},ZSt=class extends pb{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===G.Color&&this._updateOccludeeState(e),this.ensureTechnique(XLe,e)}},XSt=class extends EL{constructor(){super(...arguments),this.color=wh,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Nr.None,this.hasOccludees=!1,this.draped=!1}};var Zo;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(Zo||(Zo={}));const rJ=.70710678118,rge=rJ,JSt=.08715574274;function QLe(t){const e=new Vi,i=t.multipassEnabled&&t.output===G.Color,{vertex:r,fragment:s,attributes:n,varyings:o}=e;bc(r,t),e.include(Ja,t),e.include(DT,t),e.include(g0,t),e.include(LT,t),t.draped?r.uniforms.add(new qe("worldToScreenRatio",(l,c)=>1/c.screenToPCSRatio)):n.add(R.BOUNDINGRECT,"mat3"),n.add(R.POSITION,"vec3"),n.add(R.UVMAPSPACE,"vec4"),t.vvColor&&n.add(R.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),i&&o.add("depth","float"),r.uniforms.add(new zi("uColor",l=>l.color));const a=t.style===Zo.ForwardDiagonal||t.style===Zo.BackwardDiagonal||t.style===Zo.DiagonalCross;return a&&r.code.add(S`
      const mat2 rotate45 = mat2(${S.float(rJ)}, ${S.float(-rge)},
                                 ${S.float(rge)}, ${S.float(rJ)});
    `),t.draped||(Rf(r,t),r.uniforms.add(new qe("worldToScreenPerDistanceRatio",(l,c)=>1/c.camera.perScreenPixelRatio)),r.code.add(S`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),r.code.add(S`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),r.code.add(S`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${S.float(JSt)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),r.code.add(S`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":S`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${S.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),r.code.add(S`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),e.include(gn,t),s.include(Ug),t.draped&&s.uniforms.add(new qe("texelSize",(l,c)=>1/c.camera.pixelRatio)),t.output===G.Highlight&&e.include(gb,t),i&&e.include(Vg,t),t.output!==G.Highlight&&(s.code.add(S`
      const float lineWidth = ${S.float(t.lineWidth)};
      const float spacing = ${S.float(t.patternSpacing)};
      const float spacingINV = ${S.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||s.code.add(S`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),t.transparencyPassType===nt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),s.code.add(S`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==G.Highlight?S`color.a *= ${QSt(t)};`:""}

      ${t.output===G.ObjectAndLayerIdColor?S`color.a = 1.0;`:""}

      if (color.a < ${S.float(Xo)}) {
        discard;
      }

      ${t.output===G.Color?S`fragColor = color; ${t.transparencyPassType===nt.ColorAlpha?S`
                    fragColor = premultiplyAlpha(fragColor);
                    fragAlpha = fragColor.a;`:""}`:""}
      ${t.output===G.Highlight?S`outputHighlight();`:""}
      ${t.output===G.ObjectAndLayerIdColor?S`outputObjectAndLayerIdColor();`:""}
    }
  `),e}function QSt(t){function e(i){return t.draped?S`coverage(vuv.${i}, texelSize)`:S`sampleAA(vuv.${i})`}switch(t.style){case Zo.ForwardDiagonal:case Zo.Horizontal:return e("y");case Zo.BackwardDiagonal:case Zo.Vertical:return e("x");case Zo.DiagonalCross:case Zo.Cross:return S`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const KSt=Object.freeze(Object.defineProperty({__proto__:null,build:QLe},Symbol.toStringTag,{value:"Module"}));let KLe=class eDe extends Wi{initializeProgram(e){return new Yi(e.rctx,eDe.shader.get().build(this.configuration),re("enable-feature:objectAndLayerId-rendering")?iDe:tDe)}_setPipelineState(e,i){const r=this.configuration,s=e===nt.NONE,n=e===nt.FrontFace;return Gt({blending:r.output===G.Color?s?gu:Z0(e):null,culling:yG(r.cullFace),depthTest:r.draped?null:{func:yb(e)},depthWrite:r.draped?null:s?Tu:BG(e),drawBuffers:r.output===G.Depth?{buffers:[ao.NONE]}:X0(e),colorWrite:Kt,stencilWrite:r.hasOccludees?Mg:null,stencilTest:r.hasOccludees?i?Z1:_b:null,polygonOffset:s||n?r.polygonOffset?eTt:null:HG(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};KLe.shader=new Bi(KSt,()=>fe(()=>Promise.resolve().then(()=>EUt),void 0));const eTt={factor:1,units:1};let eo=class extends Ec{constructor(){super(...arguments),this.output=G.Color,this.cullFace=Nr.None,this.transparencyPassType=nt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasOccludees=!1,this.enableOffset=!0,this.multipassEnabled=!1,this.cullAboveGround=!1,this.vvColor=!1,this.objectAndLayerIdColorInstanced=!1}};h([B({count:G.COUNT})],eo.prototype,"output",void 0),h([B({count:Nr.COUNT})],eo.prototype,"cullFace",void 0),h([B({count:Zo.COUNT})],eo.prototype,"style",void 0),h([B({count:nt.COUNT})],eo.prototype,"transparencyPassType",void 0),h([B()],eo.prototype,"hasSlicePlane",void 0),h([B()],eo.prototype,"hasVertexColors",void 0),h([B()],eo.prototype,"polygonOffset",void 0),h([B()],eo.prototype,"hasOccludees",void 0),h([B()],eo.prototype,"patternSpacing",void 0),h([B()],eo.prototype,"lineWidth",void 0),h([B()],eo.prototype,"enableOffset",void 0),h([B()],eo.prototype,"draped",void 0),h([B()],eo.prototype,"multipassEnabled",void 0),h([B()],eo.prototype,"cullAboveGround",void 0),h([B()],eo.prototype,"vvColor",void 0),h([B({constValue:!0})],eo.prototype,"writeDepth",void 0),h([B({constValue:!1})],eo.prototype,"occlusionPass",void 0),h([B({constValue:!1})],eo.prototype,"hasVvInstancing",void 0),h([B({constValue:!1})],eo.prototype,"vvSize",void 0),h([B({constValue:!1})],eo.prototype,"vvOpacity",void 0);const tDe=new Map([[R.POSITION,0],[R.COLOR,3],[R.UVMAPSPACE,4],[R.COLORFEATUREATTRIBUTE,5],[R.BOUNDINGRECT,6]]),iDe=new Map([[R.POSITION,0],[R.COLOR,3],[R.UVMAPSPACE,4],[R.COLORFEATUREATTRIBUTE,5],[R.BOUNDINGRECT,6],[R.OBJECTANDLAYERIDCOLOR,9]]);let Ese=class extends Tse{constructor(e){super(e,new sTt),this.supportsEdges=!0,this.produces=new Map([[_e.OPAQUE_MATERIAL,i=>xS(i)],[_e.TRANSPARENT_MATERIAL,i=>f0(i)],[_e.TRANSPARENT_NO_SSAO_DEPTH,i=>h1(i)&&this.parameters.writeLinearDepth],[_e.DRAPED_MATERIAL,i=>this.parameters.draped&&i===G.Color||xS(i)]]),this._vertexAttributeLocations=re("enable-feature:objectAndLayerId-rendering")?iDe:tDe,this._configuration=new eo}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<GG,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}createGLMaterial(e){return new tTt(e)}createBufferWriter(){const e=Ts().vec3f(R.POSITION).vec4f(R.UVMAPSPACE);return this.parameters.draped||e.mat3f(R.BOUNDINGRECT),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4u8(R.COLOR),re("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),new iTt(e)}},tTt=class extends pb{_updateParameters(e){return this.ensureTechnique(KLe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===G.Color&&this._updateOccludeeState(e),this._updateParameters(e)}},iTt=class extends KA{write(e,i,r,s,n){COe(r,this.vertexBufferLayout,e,i,s,n);for(const o of this.vertexBufferLayout.fields.keys()){const a=r.attributes.get(o),l=a==null?void 0:a.indices;if(a&&l)switch(o){case R.UVMAPSPACE:{ft(a.size===4);const c=s.getField(o,$f);c&&lA(a,c,n);break}case R.BOUNDINGRECT:{ft(a.size===9);const c=s.getField(o,G1);c&&rTt(a,e,c,n);break}}}}};function rTt(t,e,i,r){const{data:s,indices:n}=t,o=e,a=i.typedBuffer,l=i.typedBufferStride,c=n.length;r*=l;for(let u=0;u<c;++u){const d=9*n[u],p=s[d],m=s[d+1],g=s[d+2];a[r]=o[0]*p+o[4]*m+o[8]*g+o[12],a[r+1]=o[1]*p+o[5]*m+o[9]*g+o[13],a[r+2]=o[2]*p+o[6]*m+o[10]*g+o[14];for(let y=3;y<9;++y)a[r+y]=s[d+y];r+=l}}let sTt=class extends EL{constructor(){super(...arguments),this.color=Wt(1,1,1,1),this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Nr.None,this.hasOccludees=!1,this.style=Zo.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function nTt(t,e){const i=(t==null?void 0:t.pattern)??null;return i==null?new ige(e):i.style==="none"||i.style==="solid"?(i.style==="none"&&(e.color=Wt(0,0,0,0),e.forceTransparentMode=!0),new ige(e)):(e.style=oTt(i.style),new Ese(e))}function oTt(t){switch(t){case"horizontal":return Zo.Horizontal;case"vertical":return Zo.Vertical;case"cross":return Zo.Cross;case"forward-diagonal":return Zo.ForwardDiagonal;case"backward-diagonal":return Zo.BackwardDiagonal;case"diagonal-cross":return Zo.DiagonalCross;default:return}}function aTt(t){return t.material instanceof Ese&&!t.material.parameters.draped}function lTt(t,e){if(aTt(t)){const i=t.attributes.get(R.POSITION).data,r=t.getMutableAttribute(R.UVMAPSPACE).data,s=t.getMutableAttribute(R.BOUNDINGRECT).data;YLe(r,s,i,e)}}function cTt(t,e,i,r,s){const n=YOe(t,e,i,r,s),o=t.stageObject.geometries;for(const a of o)lTt(a,s);return n}const uTt=["polyline","polygon","extent"],sge=new TL({size:!1,color:!0,rotation:!1,opacity:!1});let rDe=class sDe extends Gg{constructor(e,i,r,s){super(e,i,r,s),this._needsUV=!1}async doLoad(){this._fastUpdates=oA(this._context.renderer,sge)}_createMaterials(){var s,n,o;if(this._materials.length>0)return;const e=(n=(s=this.symbolLayer)==null?void 0:s.material)==null?void 0:n.color,i=this._getCombinedOpacityAndColor(e);this._materials[Hs.Fill]=nTt(this.symbolLayer,{color:i,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...(o=this._fastUpdates)==null?void 0:o.materialParameters}),this._needsUV=this._materials[Hs.Fill]instanceof Ese;const r=this.symbolLayer.outline;if(pTt(r)){const a=J3e(r.pattern);this._materials[Hs.Outline]=new fC({width:_n(r.size),color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:a,cap:WX(r.patternCap||"butt")})}this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,uTt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._createMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,s)}applyRendererDiff(e,i){var r;for(const s in e.diff){if(s!=="visualVariables"||!aA(this._fastUpdates,i,sge))return an.RecreateSymbol;(r=this._materials[Hs.Fill])==null||r.setParameters(this._fastUpdates.materialParameters)}return an.FastUpdate}layerOpacityChanged(){var e,i;if(this._materials[Hs.Fill]!=null){const r=this._materials[Hs.Fill].parameters.color,s=(i=(e=this.symbolLayer)==null?void 0:e.material)==null?void 0:i.color,n=this._getCombinedOpacity(s);this._materials[Hs.Fill].setParameters({color:[r[0],r[1],r[2],n],forceTransparentMode:this.needsDrivenTransparentPass})}if(this._materials[Hs.Outline]!=null){const r=this._materials[Hs.Outline].parameters.color;this._materials[Hs.Outline].setParameters({color:[r[0],r[1],r[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=CL(sDe.elevationModeChangeTypes,r,s);if(n!==Ds.UPDATE)return n;const o=qd(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){var e;if((e=this._materials[Hs.Fill])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Hs.Outline]){const i={hasSlicePlane:this._context.slicePlaneEnabled};this._materials[Hs.Outline].setParameters(i)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){var u;const s=g3(e.geometry);if(!s)return null;const n=tse(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=new hTt(n,i,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=ws(4*a,!0),o.boundingRect=ho(9*a,!0),YLe(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(u=this._context.stage.renderView)==null?void 0:u.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._materials[Hs.Outline]&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new vb({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new Bg(this,l,o.outGeometries,null,null,cTt,r);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=qd(r.mode),c}_createAs3DShapeFill(e,i){var s;const r=i.renderData.polygons;for(const{position:n,mapPositions:o,holeIndices:a,index:l,count:c}of r){if(this._context.clippingExtent!=null&&(Br(dp),yh(dp,o),!af(dp,this._context.clippingExtent)))continue;const u=Dft(o,a,this._context.elevationProvider.spatialReference);if(u.length===0)continue;const d=(s=this._fastUpdates)==null?void 0:s.visualVariables.color,p=tpe({material:this._materials[Hs.Fill],indices:u,mapPositions:o,attributeData:{position:n,color:d?null:i.color,colorFeature:d?_f(d.field,e):null,uvMapSpace:this._needsUV?Ez(i.uvMapSpace,4*l,4*c):null,boundingRect:this._needsUV?Nd(i.boundingRect,9*l,9*c):null,objectAndLayerIdColor:i.objectAndLayerIdColor}});i.outGeometries.push(p)}}_createAs3DShapeOutline(e){if(this._materials[Hs.Outline]==null)return;const i=e.renderData.outlines;for(const{mapPositions:r,position:s}of i){if(this._context.clippingExtent!=null&&(Br(dp),yh(dp,r),!af(dp,this._context.clippingExtent)))continue;const n=YX(this._materials[Hs.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:r,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(n)}}_createAsOverlay(e,i){var a;const r=g3(e.geometry);if(r==null)return null;this._materials[Hs.Fill].renderPriority=this._renderPriority+this._renderPriorityStep/2,this._materials[Hs.Outline]!=null&&(this._materials[Hs.Outline].renderPriority=this._renderPriority);const s=$Ie(r,this._context.overlaySR),n=new dTt(s,i,this._context.layer.uid,e.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=ws(4*o,!0),jSt(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=Br(),n.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(n),this._createAsOverlayFill(e,n),this._materials[Hs.Outline]&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,r.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new pj(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,i){var s;const r=i.renderData.polygons;for(const{position:n,holeIndices:o,index:a,count:l}of r){const c=Br(dp);if(yh(c,n),!af(c,this._context.clippingExtent))continue;const u=pA(n,o,3);if(u.length===0)continue;JM(i.outBoundingBox,c);const d=(s=this._fastUpdates)==null?void 0:s.visualVariables.color,p=tpe({material:this._materials[Hs.Fill],indices:u,attributeData:{position:n,color:d?null:i.color,colorFeature:d?_f(d.field,e):null,uvMapSpace:this._needsUV?Ez(i.uvMapSpace,4*a,4*l):null,objectAndLayerIdColor:i.objectAndLayerIdColor}});i.outGeometries.push(new gA(p,i))}}_createAsOverlayOutline(e){if(this._materials[Hs.Outline]==null)return;const i=e.renderData.outlines;for(let r=0;r<i.length;++r){const{position:s}=i[r];if(Br(dp),yh(dp,s),!af(dp,this._context.clippingExtent))continue;JM(e.outBoundingBox,dp);const n=YX(this._materials[Hs.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(new gA(n,e))}}_getOutlineOpacity(){var i,r;const e=(r=(i=this.symbolLayer)==null?void 0:i.outline)==null?void 0:r.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){var r,s;const e=(s=(r=this.symbolLayer)==null?void 0:r.outline)==null?void 0:s.color,i=this._getOutlineOpacity();return tI(e!=null?Oe.toUnitRGB(e):null,i)}test(){return{...super.test(),createAsOverlay:(e,i)=>this._createAsOverlay(e,i),createAs3DShape:(e,i,r)=>this._createAs3DShape(e,i,r)}}};rDe.elevationModeChangeTypes={definedChanged:Ds.RECREATE,staysOnTheGround:Ds.NONE,onTheGroundChanged:Ds.RECREATE};const dp=Jn();let hTt=class extends nj{constructor(e,i,r,s){super(e,r,s),this.color=i}},dTt=class extends nj{constructor(e,i,r,s){super(e,r,s),this.color=i}};var Hs;function pTt(t){return(t==null?void 0:t.size)!=null&&t.size>0&&t.color!=null&&(t.pattern==null||t.pattern.type!=="style"||t.pattern.style!=="none")}(function(t){t[t.Fill=0]="Fill",t[t.Outline=1]="Outline"})(Hs||(Hs={}));let nDe=class{constructor(e,i="center",r=!1,s=lt(),n=Wt(0,0,0,-1),o="world",a=E(),l=0){this.verticalOffset=e,this.anchor=i,this.hasLabelVerticalOffset=r,this.screenOffset=s,this.centerOffset=n,this.centerOffsetUnits=o,this.translation=a,this.elevationOffset=l}},oDe=class{constructor(e,i="center",r="center",s=null,n=lt()){this.placement=e,this.horizontalPlacement=i,this.verticalPlacement=r,this.text=s,this.displaySize=n}},aDe=class lDe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=nge(e.color),this.haloStyle=fTt(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?nge(e.background.color):null}fontString(e){const i=this.definition.font;return`${i.style} ${i.weight} ${e}px ${i.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(e,i){e.font=this.fontString(i),e.textAlign="left",e.textBaseline="alphabetic"}static async fromSymbol(e,i){var p,m,g,y,v;const r=(p=e==null?void 0:e.material)==null?void 0:p.color,s=Oe.toUnitRGBA(r)??wh,n=e.size!=null?_n(e.size):12,o=e.lineHeight,a=e.background!=null?Oe.toUnitRGBA(e.background.color):wh,l={family:((m=e.font)==null?void 0:m.family)??"sans-serif",decoration:((g=e.font)==null?void 0:g.decoration)??"none",weight:((y=e.font)==null?void 0:y.weight)??"normal",style:((v=e.font)==null?void 0:v.style)??"normal"},c=e.halo,u=(c==null?void 0:c.color)!=null&&c.size>0?{size:_n(c.size),color:Oe.toUnitRGBA(c.color)}:{size:0,color:wh},d=new lDe({color:s,size:n,background:{color:a,padding:e.background!=null?[.65*n,.5*n]:[0,0],borderRadius:e.background!=null?n*(6/16):0},lineSpacingFactor:o,font:l,halo:u,pixelRatio:i});if(e.font){let b=!1;const w=d.fontString(n);try{b=(await document.fonts.load(w)).some(x=>!Qyt(x))}catch{ie.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${w}'. Some text symbology may be rendered using the default browser font.`)}if(!b&&!mTt.has(e.font.family))try{await Jyt(e.font)}catch{}}return d}};function fTt(t){return`rgb(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()})`}function nge(t){return`rgba(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()},${t[3]})`}const mTt=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),L_=4096;let Qx=class extends Re{constructor(e){super(e),this.type=Ls.Texture,this.id=_h(),this.events=new cn,this._glTexture=null,this._atlas=new _Tt(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=It(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return mI=0,[L_-D_-mI,L_-D_-mI-oge]}load(e){if(this._glTexture)return this._glTexture;const i=new jr;return i.wrapMode=bi.CLAMP_TO_EDGE,i.samplingMode=ii.LINEAR_MIPMAP_LINEAR,i.hasMipmap=!0,i.preMultiplyAlpha=!0,i.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new br(e,i,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(Mt.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=Or(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=It(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.width.toString()),this._canvas.setAttribute("height",e.height.toString())}_resizeAtlas(e,i){var n,o;const{width:r,height:s}=this._atlas;r===e&&s===i||(this._atlas.width=e,this._atlas.height=i,(n=this._glTexture)==null||n.resize(e,i),(o=this._glTexture)==null||o.updateData(0,0,0,r,s,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(a=>{const l=this._stageObjects.get(a.textRenderer.key);l==null||l.forEach(c=>KH(c,a))}),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,i,r,s){const n=this._atlas;if(n.width<r||n.height<s)return!1;let o=n.cursors.get(s);if(!o){if(n.height<n.nextY+s)return!1;o=[new age(n.nextY)],n.cursors.set(s,o),n.nextY+=s}let a=o.find(l=>n.width>=l.x+r);if(a==null){if(n.height<n.nextY+s)return!1;a=new age(n.nextY),n.nextY+=s,o.push(a)}return e.setNewPosition(a),this._elements.set(i,e),this._elementsToRender.set(i,e),a.x+=r,!0}_ensureStageObjects(e){const i=this._stageObjects.get(e);if(i)return i;const r=new Set;return this._stageObjects.set(e,r),r}_addStageObject(e,i){this._ensureStageObjects(e).add(i)}_removeStageObject(e,i){const r=this._stageObjects.get(e);r!=null&&r.delete(i)&&(i.geometries[0].setAttributeData(R.SIZE,[0,0]),i.geometryVertexAttributeUpdated(i.geometries[0],R.SIZE),this._elementsToRender.delete(e))}_processAddition(e){const i=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(i,e);const r=this._atlas,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+D_,a=n+D_+oge;if(!this._addAtlasElement(e,i,o,a)){if(this._canRepack)this._reset();else if(r.width<o){const l=Math.min(c1(Math.max(o,1.5*r.width)),L_);this._resizeAtlas(l,r.height)}else{const l=r.nextY+a,c=Math.min(c1(Math.max(l,1.5*r.height)),L_);if(c>r.height)this._resizeAtlas(r.width,c);else if(r.width<L_){const u=Math.min(c1(1.5*r.width),L_);this._resizeAtlas(u,r.height)}}this._elements.set(i,e)}}_renderElement(e){const i=e.commitNewPosition(),r=e.textRenderer;this._ctx.clearRect(i[0]-D_,i[1]-D_,r.renderedWidth+2*D_,r.renderedHeight+2*D_),r.render(this._ctx,i[0],i[1]);const s=this._stageObjects.get(r.key);s==null||s.forEach(n=>KH(n,e))}get running(){return this.updating}runTask(e){if(this._glTexture==null)return ia;for(;this._needsRepack&&(this._canRepack||this._atlas.height<L_&&this._atlas.height<L_);){this._canRepack=this._needsRepack=!1;const i=this._elements;this._elements=new Map,i.forEach(r=>this._processAddition(r)),e.madeProgress()}if(this._elementsToRender.size>0){for(const[i,r]of this._elementsToRender){if(e.done)break;this._renderElement(r),this._elementsToRender.delete(i),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addTextTexture(e,i){const r=e.key;this._addStageObject(r,i);let s=this._elements.get(r);s==null&&(s=new yTt(this._atlas,e),this._processAddition(s),this.setDirty()),gTt(i,s),KH(i,s)}removeTextTexture(e,i){const r=e.key;if(!this._elements.get(r))return;this._removeStageObject(r,i);const s=this._stageObjects.get(r);s&&s.size!==0||this._elements.delete(r),(s==null?void 0:s.size)===0&&this._stageObjects.delete(r),this._canRepack=!0}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}};function gTt(t,e){t.geometries[0].setAttributeData(R.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),t.geometryVertexAttributeUpdated(t.geometries[0],R.SIZE)}function KH(t,e){t.geometries[0].setAttributeData(R.UV0,e.uv),t.geometryVertexAttributeUpdated(t.geometries[0],R.UV0,!0)}h([f({constructOnly:!0})],Qx.prototype,"view",void 0),h([f({type:Boolean})],Qx.prototype,"updating",void 0),Qx=h([I("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],Qx);const D_=2,oge=2;let yTt=class{constructor(e,i){this._atlas=e,this.textRenderer=i,this._uv=Qt(),this._newPosition=[0,0]}get uv(){if(this._xOffset==null||this._yOffset==null)return wh;const{renderedWidth:e,renderedHeight:i}=this.textRenderer;return ds(this._uv,this._xOffset/this._atlas.width,(this._yOffset+i)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}},_Tt=class{constructor(e,i){this.width=e,this.height=i,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=mI}},age=class{constructor(e){this.y=e,this.x=mI}},mI=0,vTt=class{constructor(e,i,r){this._renderer=new B3e(e,i,r,Qx.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=fV(bTt,this._renderer.renderedWidth,this._renderer.renderedHeight),i=e.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new J1(e,{wrap:{s:bi.CLAMP_TO_EDGE,t:bi.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const bTt={canvas:null},wTt=$e(0,0,1);let xTt=class extends Gg{constructor(e,i,r,s){super(e,i,r,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=YG(this.symbolLayer.size);if(e)throw new V("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await aDe.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const i=e.graphic,r=ES(i.geometry);if(r==null)return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const s=this.symbolLayer.text;if(s==null||s==="")return null;const n=Jte(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(n!=null&&!yCe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const{verticalAlignment:o}=this.symbolLayer,a=new nDe(n);b1t(o,a.screenOffset);const l=new oDe(a,this.symbolLayer.horizontalAlignment,v1t(o));return this._createAs3DShape(i,r,s,l)}createLabel(e,i,r,s,n){const o=e.graphic,a=ES(o.geometry);if(a==null)return this.logger.warn(`unsupported geometry type for label: ${o.geometry.type}`),null;const l=i.text;return!l||/^\s+$/.test(l)?null:this._createAs3DShape(o,a,l,i,r,s,n)}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,i){return lge(e,i,(r,s)=>{this.updateGraphicElevationContext(s,r)}),Ds.UPDATE}slicePlaneEnabledChanged(e,i){return lge(e,i,r=>{for(const s of r.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,i){const r=i.elevationContext;this.setGraphicElevationContext(e,r,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=qd(r.mode)||r.mode==="absolute-height"}updateGeometry(e,i){if(this.draped||!this._validateGeometry(i))return!1;const{elevationContext:r,stageObject:s}=e;if(r.mode!==this.getGeometryElevationMode(i))return!1;const n=ES(i);if(!n)return!1;const o=e$e(s,this._context,n,r);if(o==null)return!1;const a=Dre(this._context,n);return s.geometries[0].localOrigin===a&&(e.alignedSampledElevation=o,sT(e,n,this._context.elevationProvider),!0)}_defaultElevationInfoNoZ(){return TTt}_createAs3DShape(e,i,r,s,n=null,o=null,a=()=>s.placement.elevationOffset){var z;const l=this.setGraphicElevationContext(e,new Hz,s.placement.elevationOffset),c=((z=e.geometry)==null?void 0:z.type)==="polyline",u=e.uid;let d=null,p=null;if(o==null){const Z=j3e(s.horizontalPlacement);d=new vTt(r,Z,this._textRenderParameters);let q=null;if(this._context.sharedResources.textures!=null){p=this._context.sharedResources.textures.fromData(d.key,()=>d.create()),p.texture.events.on("unloaded",()=>q=ti(q));const Y=this._context.stage.renderView.textures.acquire(p.texture.id);if(Y==null||Cu(Y))return p.release(),null;q=Y}}const m=STt(d,s),g={occlusionTest:!re("enable-feature:non-occluded-hud"),screenOffset:s.placement.screenOffset,anchorPosition:m,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.placement.centerOffsetUnits,drawInSecondSlot:!0};if(c&&(g.shaderPolygonOffset=1e-4),o?g.textureId=o.id:p&&(g.textureId=p.texture.id),s.placement.verticalOffset!=null){const{screenLength:Z,minWorldLength:q,maxWorldLength:Y}=s.placement.verticalOffset;g.verticalOffset={screenLength:_n(Z),minWorldLength:q||0,maxWorldLength:Y??1/0}}const y={screenOffset:g.screenOffset,anchorPosition:m,centerOffsetUnits:g.centerOffsetUnits,verticalOffset:g.verticalOffset,shaderPolygonOffset:g.shaderPolygonOffset};if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:Z,screenSizePerspectiveSettingsLabels:q}=this._context.sharedResources,Y=V3e(this._textRenderParameters);g.screenSizePerspective=q.overrideFontHeight(Y.maxHeight),g.screenSizePerspectiveAlignment=Z,y.fontHeight=Y.maxHeight}g.hasSlicePlane=this._context.slicePlaneEnabled;const v=(Z,q,Y)=>{let de=Z.get(Y);return de==null&&(de=new cA(q),Z.add(Y,de)),de},b=n?v(n,g,JSON.stringify(y)):new cA(g),w=s.placement.translation,x=d?_i(d.displayWidth,d.displayHeight):jS,T=s.placement.centerOffset,C=wTt,M=lt(),O=HZ(b,C,w,null,x,T,M,null),D=Lre(this._context,i,O,l,u);if(D==null)return null;const k=(Z,q,Y,de,L,F)=>{const j=a()||s.placement.elevationOffset,W=this.setGraphicElevationContext(e,q,j);return TS(Z,W,Y,de,L,F)},U=new Bg(this,D.object,[O],n==null?[b]:null,p,k,l);U.alignedSampledElevation=D.sampledElevation,U.needsElevationUpdates=qd(l.mode)||l.mode==="absolute-height",U.getScreenSize=(Z=lt())=>(Z[0]=d?d.displayWidth:s.displaySize[0],Z[1]=d?d.displayHeight:s.displaySize[1],Z);const H=new iRe(s.placement.elevationOffset,r);return U.metadata=H,sT(U,i,this._context.elevationProvider),U}};function lge(t,e,i){t&&t.forEach(r=>{const s=e(r);s!=null&&i(s,r.graphic)})}function STt(t,e){if(e.verticalPlacement==="baseline"){const r=g1t[e.horizontalPlacement],s=t!=null?t.baselineAnchorY:0;return _i(r,s)}const i=_1t(e.horizontalPlacement,e.verticalPlacement);return Y5[i]}const TTt={mode:"relative-to-ground",offset:0};function cge(t){t.fragment.uniforms.add(new mt("texWaveNormal",e=>e.waveNormal),new mt("texWavePerturbation",e=>e.wavePerturbation),new zi("waveParams",e=>ds(ETt,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new Fr("waveDirection",e=>Pi(CTt,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(Zft),t.fragment.code.add(S`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const ETt=Qt(),CTt=lt();function cDe(t){const e=new Vi,{vertex:i,fragment:r}=e;bc(i,t),e.include(Ja,t),e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.UV0,"vec2");const s=new zi("waterColor",n=>n.color);if(t.output===G.Color&&t.draped)return e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(S`
        void main(void) {
          if (waterColor.a < ${S.float(Xo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(s),r.code.add(S`void main() {
fragColor = waterColor;
}`),e;switch(t.output===G.Color&&(e.include(S3,t),e.include(ZA,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.multipassEnabled&&e.varyings.add("depth","float"),i.uniforms.add(s),i.code.add(S`
      void main(void) {
        if (waterColor.a < ${S.float(Xo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===G.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(Vg,t),t.output){case G.Color:e.include(gz),e.include(mie,{pbrMode:xt.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(cge),e.include(gn,t),e.include(hA,t),e.include(B$e,t),r.uniforms.add(s,new qe("timeElapsed",n=>n.timeElapsed),i.uniforms.get("view"),i.uniforms.get("localOrigin")),Rf(r,t),r.include(Ug),t.transparencyPassType===nt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),G0(r),Lg(r),r.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?S`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===nt.ColorAlpha?S`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `);break;case G.Normal:e.include(S3,t),e.include(cge,t),e.include(gn,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),i.uniforms.add(s),i.code.add(S`
        void main(void) {
          if (waterColor.a < ${S.float(Xo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new qe("timeElapsed",n=>n.timeElapsed)),r.code.add(S`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case G.Highlight:e.include(gb,t),e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(S`
      void main(void) {
        if (waterColor.a < ${S.float(Xo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(gn,t),r.code.add(S`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case G.ObjectAndLayerIdColor:e.include(LT,t),e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(S`
      void main(void) {
        if (waterColor.a < ${S.float(Xo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(gn,t),r.code.add(S`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const MTt=Object.freeze(Object.defineProperty({__proto__:null,build:cDe},Symbol.toStringTag,{value:"Module"}));let uDe=class hDe extends Wi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Ge.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Yi(e.rctx,hDe.shader.get().build(this.configuration),wi)}_setPipelineState(e){const i=this.configuration,r=e===nt.NONE,s=e===nt.FrontFace;return Gt({blending:i.output!==G.Normal&&i.output!==G.Highlight&&i.output!==G.ObjectAndLayerIdColor&&i.transparent?r?gu:Z0(e):null,depthTest:i.draped?null:{func:yb(e)},depthWrite:i.draped?null:r?i.writeDepth?Tu:null:BG(e),drawBuffers:X0(e),colorWrite:Kt,polygonOffset:r||s?null:HG(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};uDe.shader=new Bi(MTt,()=>fe(()=>Promise.resolve().then(()=>CUt),void 0));let to=class extends Ec{constructor(){super(...arguments),this.output=G.Color,this.transparencyPassType=nt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}};h([B({count:G.COUNT})],to.prototype,"output",void 0),h([B({count:nt.COUNT})],to.prototype,"transparencyPassType",void 0),h([B()],to.prototype,"spherical",void 0),h([B()],to.prototype,"receiveShadows",void 0),h([B()],to.prototype,"hasSlicePlane",void 0),h([B()],to.prototype,"transparent",void 0),h([B()],to.prototype,"enableOffset",void 0),h([B()],to.prototype,"writeDepth",void 0),h([B()],to.prototype,"hasScreenSpaceReflections",void 0),h([B()],to.prototype,"doublePrecisionRequiresObfuscation",void 0),h([B()],to.prototype,"hasCloudsReflections",void 0),h([B()],to.prototype,"objectAndLayerIdColorInstanced",void 0),h([B()],to.prototype,"draped",void 0),h([B()],to.prototype,"multipassEnabled",void 0),h([B()],to.prototype,"cullAboveGround",void 0),h([B({constValue:!1})],to.prototype,"occlusionPass",void 0),h([B({constValue:xt.Water})],to.prototype,"pbrMode",void 0),h([B({constValue:!0})],to.prototype,"useCustomDTRExponentForWater",void 0),h([B({constValue:!0})],to.prototype,"highStepCount",void 0),h([B({constValue:!1})],to.prototype,"useFillLights",void 0);let ATt=class extends pb{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){const i=e.ssr.lastFrameColor!=null;i!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:i})}_updateCloudsReflectionState(e){const i=e.cloudsFade.data!=null;i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(e){return this._techniques.constructionContext.waterTextures.ensureResources(e)}beginSlot(e){return this._output===G.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniques.constructionContext.waterTextures.passParameters),this.ensureTechnique(uDe,e)}},PTt=class extends Tse{constructor(e){super(e,new dDe),this._configuration=new to,this._animation=new rPe,this.produces=new Map([[_e.OPAQUE_MATERIAL,i=>f0(i)&&!this.parameters.transparent||xS(i)],[_e.TRANSPARENT_MATERIAL,i=>f0(i)&&this.parameters.transparent||xS(i)],[_e.DRAPED_MATERIAL,i=>this.parameters.draped&&i===G.Color||xS(i)],[_e.DRAPED_WATER,i=>i===G.Normal]])}getConfiguration(e,i){return this._configuration.output=e,this._configuration.writeDepth=!0,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<GG,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}update(e){const i=Math.min(e.camera.relativeElevation,e.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<OTt;const r=this._animation.advance(e);return this.setParameters({timeElapsed:jK(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&r}createGLMaterial(e){return new ATt(e)}createBufferWriter(){return new KA(re("enable-feature:objectAndLayerId-rendering")?kbt:Nbt)}get test(){}},dDe=class extends ore{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=_i(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Wt(0,0,0,0),this.transparent=!0,this.hasSlicePlane=!1,this.draped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=E(),this.modelTransformation=null}};const OTt=35e3,RTt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},$Tt=["polyline","polygon","extent"];let Kx=class sJ extends Gg{constructor(e,i,r,s){super(e,i,r,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,$Tt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(this._materials[0])return;const e=new dDe,i=this.symbolLayer.color;i!=null&&(e.color=Oe.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],r],e.transparent=r<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?sJ.headingVectorFromAngle(this.symbolLayer.waveDirection):_i(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=RTt[s];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.draped=this.draped,this._materials[0]=new PTt(e),this._context.stage.add(this._materials[0])}layerOpacityChanged(){if(this._materials[0]==null)return;const e=this._materials[0].parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;this._materials[0].setParameters({color:[e[0],e[1],e[2],i],transparent:r})}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=CL(sJ.elevationModeChangeTypes,r,s);if(n!==Ds.UPDATE)return n;const o=qd(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){var d;const s=g3(e.geometry);if(s==null)return null;const n=tse(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=n.position.length/3,a=ho(2*o);uge(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new ITt(n,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=(d=this._context.stage.renderView)==null?void 0:d.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new vb({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),u=new Bg(this,c,l.outGeometries,null,null,YOe,i);return u.alignedSampledElevation=l.renderData.sampledElevation,u.needsElevationUpdates=qd(i.mode),u}_create3DShapeGeometries(e){const i=e.renderData.polygons,r=e.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of i){if(this._context.clippingExtent!=null&&(Br(nw),yh(nw,a),!af(nw,this._context.clippingExtent)))continue;const c=pA(a,l,3);if(c.length===0)continue;const u=Nd(r,2*n,2*s),d=ipe({material:this._materials[0],indices:c,mapPositions:a,attributeData:{position:o,uv0:u}},e.objectAndLayerIdColor);e.outGeometries.push(d)}}_createAsOverlay(e){var a;const i=g3(e.geometry);if(i==null)return null;this._materials[0].renderPriority=this._renderPriority;const r=$Ie(i,this._context.overlaySR),s=r.position.length/3,n=ho(2*s);uge(n,r.position,s,this._context.overlaySR);const o=new LTt(r,n,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(o),o.outBoundingBox=Br(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,i.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new pj(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const i=e.uvCoords,r=e.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of r){if(Br(nw),yh(nw,s),!af(nw,this._context.clippingExtent))continue;JM(e.outBoundingBox,nw);const l=pA(s,n,3);if(l.length===0)continue;const c=Nd(i,2*o,2*a),u=ipe({material:this._materials[0],indices:l,attributeData:{position:s,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new gA(u,e))}}static headingVectorFromAngle(e){const i=lt(),r=sB(e);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};function uge(t,e,i,r){const s=Gl(r);Mc(N_);for(let a=0;a<i;a++)Pi(hge,e[3*a],e[3*a+1]),DC(N_,hge);HS(N_,N_,s);const n=N_[0]%Kx.unitSizeOfTexture,o=N_[1]%Kx.unitSizeOfTexture;xF[0]=N_[0]-n,xF[1]=N_[1]-o;for(let a=0;a<i;a++)t[2*a]=(e[3*a]*s-xF[0])/Kx.unitSizeOfTexture,t[2*a+1]=(e[3*a+1]*s-xF[1])/Kx.unitSizeOfTexture}Kx.unitSizeOfTexture=100,Kx.elevationModeChangeTypes={definedChanged:Ds.RECREATE,staysOnTheGround:Ds.NONE,onTheGroundChanged:Ds.RECREATE};const xF=lt(),N_=Ht(),hge=lt(),nw=Jn();let ITt=class extends nj{constructor(e,i,r,s){super(e,r,s),this.uvCoords=i}},LTt=class extends nj{constructor(e,i,r,s){super(e,r,s),this.uvCoords=i}};function DTt(t,e,i,r){var n;const s=((n=FTt[t.type])==null?void 0:n[e.type])||NTt[e.type];return s?new s(t,e,i,r):(ie.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const NTt={icon:qX,object:zxt,line:Q3e,path:VSt,fill:rDe,extrude:Xgt,text:xTt,water:Kx},FTt={"mesh-3d":{fill:Hbt}};let kTt=class extends Ire{set symbol(e){this._symbol=e,e.symbolLayers.forEach((i,r)=>{const s=this.symbolLayers[r];s!=null&&(s.symbol=e,s.symbolLayer=i)})}get symbol(){return this._symbol}constructor(e,i,r){super(i.schedule),this._symbol=e,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[];for(let n=0;n<r;n++){const o=i.at(n);if(o.enabled===!1)continue;SF.renderPriority=1-(1+n)/r,SF.renderPriorityStep=1/r,SF.ignoreDrivers=o.ignoreDrivers;const a=DTt(this.symbol,o,this._context,SF),l=QV(e,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await yB(this.symbolLayers,async(n,o)=>{if(n!=null)try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),Et(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const i=this.symbolLayers[e];return i!=null?i.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e==null?void 0:e.queryForSnapping)}createGraphics3DGraphic(e,i){var o,a;const r=e.graphic,s=this.symbolLayers.map(l=>(l==null?void 0:l.createGraphics3DGraphic(e))??null),n=this._context.arcade||((a=(o=this._context.featureExpressionInfoContext)==null?void 0:o.arcade)==null?void 0:a.modules)||null;return new hft(r,i||this,s,e.layer,n)}get complexity(){return $re(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof Bg?l:null};if(n!=null&&!n.globalPropertyChanged(e,i,o))return!1}return!0}applyRendererDiff(e,i){return this.loadStatus!==ah.LOADED?an.RecreateSymbol:this.symbolLayers.reduce((r,s)=>r!==an.RecreateSymbol&&s!=null?Math.min(r,s.applyRendererDiff(e,i)):r,an.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===ah.FAILED||e.diff.type!=="partial")return;const i=e.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(s==null)return;const o=r[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const u=l.layers[n];u!=null&&a.graphics3DGraphicPatches.forEach(d=>d(u,c))})}})}updateGeometry(e,i){return this._updateGeometryOrTransform(e,(r,s)=>r.updateGeometry(s,i))}updateTransform(e,i,r,s){return this._updateGeometryOrTransform(e,(n,o)=>n.updateTransform(o,i,r,s))}_updateGeometryOrTransform(e,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(s==null)continue;const n=e.layers[r];if(!n||!i(s,n))return!1}return!0}onRemoveGraphic(e){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(r==null)continue;const s=e.layers[i];s!=null&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=0,i=0,r=0;return this.symbolLayers.forEach(s=>{s!=null&&(s.loadStatus===ah.LOADING?e++:s.isFastUpdatesEnabled()?r++:i++)}),{loading:e,slow:i,fast:r}}async queryForSnapping(e,i,r,s){const n=this.symbolLayers.filter(K1).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,i,r,s)),o=await Promise.all(n);return Et(s),o.flat()}destroy(){if(!this.destroyed){super.destroy();for(const e of this.symbolLayers)e!=null&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const SF=new dft;let UTt=class extends Ire{constructor(e,i,r){super(i),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const i=await this.symbol.fetchSymbol({signal:e});i.id=this.symbol.id,this.graphics3DSymbol=this._convert(i),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:ZRe}globalPropertyChanged(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,i)}applyRendererDiff(e,i){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,i):an.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,i)}updateTransform(e,i,r,s){var n;return((n=this.graphics3DSymbol)==null?void 0:n.updateTransform(e,i,r,s))??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function Cse(t){return t instanceof UTt?t.graphics3DSymbol:t instanceof kTt?t:null}const T3=()=>ie.getLogger("esri.views.3d.layers.graphics.labelPlacement");let zTt=class{constructor(e,i,r,s=null){this.graphics3DGraphic=e,this.labelSymbol=i,this.labelClass=r,this.disablePlacement=s}};function dge(t){const e=ZTt(t);if(e==null)return null;const i=VTt(t,e);if(i==null)return null;const r=i.anchor,s=!!e.hasLabelVerticalOffset,n=e.verticalOffset;return GTt(new nDe(n,r,s),i,t)}function VTt(t,e){if(e.anchor)return e;const i=t.labelClass.labelPlacement,r=hf[i],s=r||wV(t);return i&&!r&&T3().warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),BTt(s,t)}function Mse(t){const e=t.graphics3DGraphic.graphics3DSymbol,i=Cse(e);return i!=null?i.symbol.symbolLayers.at(0):null}function BTt(t,e){const i=e.graphics3DGraphic.graphic.geometry;if(i==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(T3().warnOncePerTick(pge(t==null?void 0:t.placement,e.disablePlacement.logEntityDescription)),wV(e)):t;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return T3().warnOncePerTick(pge(t==null?void 0:t.placement,`'${r}' geometries`)),wV(e);break;case"point":case"mesh":return t}return t}function pge(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function wV(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:$n,anchor:"center"};case"polygon":{const i=Mse(t);return i!=null&&i.type==="extrude"?hf["above-center"]:{placement:"center-center",normalizedOffset:$n,anchor:"center"}}case"point":case"mesh":return hf["above-center"];default:return}}function GTt(t,e,i){const r=i.graphics3DGraphic.graphic.geometry;if(r==null)return null;switch(r.type){case"point":case"mesh":HTt(t,e,i);break;case"polygon":jTt(t,e,i)}const s=u1t-mV;return t.screenOffset[0]+=s*e.normalizedOffset[0],t.screenOffset[1]+=s*e.normalizedOffset[1],t}function jTt(t,e,i){const r=Mse(i);if(r!=null)switch(r.type){case"extrude":{const s=i.graphics3DGraphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace(gI),of(gI,t.translation),t.translation[2]=ub(gI)/2):ne(t.translation,0,0,0),pDe(t,e,s);break}}}function HTt(t,e,i){const r=Mse(i);if(r==null)return;const s=i.graphics3DGraphic.layers[0];switch(s!=null?s.getCenterObjectSpace(t.translation):ne(t.translation,0,0,0),r.type){case"icon":case"text":qTt(t,e,i,s);break;case"object":case"fill":pDe(t,e,s)}}function qTt(t,e,i,r){const{graphics3DGraphic:s}=i,n=r!=null?r.getScreenSize():null;if(s.isDraped||n==null)t.hasLabelVerticalOffset||t.anchor==="center"||(hf[i.labelClass.labelPlacement]&&T3().warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=WTt(i);t.screenOffset[0]=n[0]/2*(e.normalizedOffset[0]-o[0]);const a=n[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function WTt(t,e=XTt){const{graphics3DGraphic:i}=t,r=i.layers[0],s=(r==null?void 0:r.stageObject.geometries[0].material)??null;if(s&&s instanceof cA){const n=s.parameters.anchorPosition;e[0]=2*(n[0]-.5),e[1]=2*(n[1]-.5)}else e[0]=0,e[1]=0;return e}function pDe(t,e,i){const r=i!=null?i.getBoundingBoxObjectSpace(gI):gI,s=$e(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const o=t.translation[2],a=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Ae(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function YTt(t){return t==="above-center"}function ZTt(t){const e=t.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=t,s=Cse(r.graphics3DSymbol),n=(s==null?void 0:s.symbol.type)==="point-3d"?s.symbol:null,o=hf[e]||wV(t);return n!=null&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:n.verticalOffset.clone(),anchor:null,normalizedOffset:null}:!i||!i.hasVisibleVerticalOffset()||n!=null&&n.supportsCallout()&&n.verticalOffset&&!r.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&YTt(o.placement)?{placement:"above-center",verticalOffset:i.verticalOffset.clone(),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(T3().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}const hf={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},fge={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in fge){const e=fge[t],i=hf[t];e.forEach(r=>{hf[r]=i})}Object.freeze&&(Object.freeze(hf),Object.keys(hf).forEach(t=>{var e;Object.freeze(hf[t]),Object.freeze((e=hf[t])==null?void 0:e.normalizedOffset)}));const XTt=[0,0],gI=Jn();let mge=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,i){this._materials.set(e,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}},gge=class{constructor(e,i){this.labelingContext=e,this.graphics3DGraphic=i,this.hasGraphics3DResources=!1,this.visible=!1,this.addedToTextureAtlas=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},JTt=class{constructor(e,i,r,s,n){this.labelClass=e,this.graphics3DSymbol=i,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},QTt=class{constructor(e,i,r,s,n,o,a,l){this.layer=i,this.graphics3DCore=r,this.scaleVisibility=s,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new J$e(e,{pickable:!0,disableOctree:!0},i.uid)}destroy(){this.stageLayer.destroy()}},tx=class extends Re{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([ue(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),ue(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(Mt.LABELER,this)]),this._textTextureAtlas=new Qx({view:this.view}),this._hudMaterialCollection=new mge(this.view._stage),this._calloutMaterialCollection=new mge(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=It(this._textTextureAtlas),this._hudMaterialCollection=It(this._hudMaterialCollection),this._calloutMaterialCollection=It(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),pp.graphic=null,pp.renderingInfo=null,pp.layer=null}_activateLabelingContext(e){e.graphics.forEach((i,r)=>{const s=new gge(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s),i.setVisibilityFlag(Po.LABEL,wa.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((i,r)=>{i.setVisibilityFlag(Po.LABEL,wa.USER,!1),this.setLabelGraphicVisibility(i,!1),i.clearLabelGraphics(),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r&&(this._textTextureAtlas.addTextTexture(r,i.stageObject),e.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r!=null&&(this._textTextureAtlas.removeTextTexture(r,i.stageObject),e.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),ia}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const i of this._labelingContexts)if(i.active)if(eq(i))this._dirty=!0;else if(tq(i.labelClassContexts)){if(i.labelClassContexts===null){this._deactivateLabelingContext(i);continue}this._createLabelClassContext(i),this._dirty=!0}else mh(i.labelsToInitialize,(r,s)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(s,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textInitialized||!r.visible&&r.hasGraphics3DResources)&&(i.labelsToInitialize.delete(s),e.madeProgress()),e.done))&&(this._dirty=!0);this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a,l;const i=(o=e.labelClassAbortController)==null?void 0:o.signal;e.layer.when&&await e.layer.when(),Et(i),(a=e.scaleVisibility)==null||a.updateScaleRangeActive();const r=e.graphics3DCore,s=r.layer,n=(l=s.labelingInfo)==null?void 0:l.filter(c=>!!c.symbol);!n||n.length===0||(await yB(n,async(c,u)=>{const d=c.symbol,p=Cse(r.getOrCreateGraphics3DSymbol(d));if(p==null)return void ie.getLogger(this).error("Failed to create Graphics3DSymbol for label");await p.load(),Et(i);let m=null;Jte(d)&&d.hasVisibleCallout()&&(m=Tpt(d,r.symbolCreationContext),await m.load(),Et(i));const g=await Vd(ght(c,e.layer.fieldsIndex,this.view.spatialReference));if(Et(i),g.ok===!0){const y=await this._createTextRenderParameters(p.symbol);Et(i),e.labelClassContexts[u]=new JTt(c,p,m,y,g.value)}else ie.getLogger(this).error(`Label expression failed to evaluate: ${g.error}`)}),Et(i))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(i=>{if(ms(i))throw i;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const i=e.symbolLayers.at(0);return(i==null?void 0:i.type)!=="text"?null:aDe.fromSymbol(i,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const i=e.labelClassAbortController;e.labelClassAbortController=new AbortController,Ul(i),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,i,r,s,n,o){const a=new oDe(r,rme(r.anchor),y1t(r.anchor),e.text,_i(e.displayWidth,e.displayHeight));return pp.graphic=i,pp.renderingInfo=null,pp.layer=s,n.createLabel(pp,a,this._hudMaterialCollection,this._textTextureAtlas,()=>{const l=dge(o);return l?l.elevationOffset:null})}_createLineCalloutGraphic(e,i,r,s,n){pp.graphic=e,pp.layer=n;const o=s.screenOffset[0];return pp.renderingInfo=new xpt(null,i,s.translation,s.centerOffset,o,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(pp)}_ensureGraphics3DResources(e){var c,u;if(e.hasGraphics3DResources)return!1;const i=e.graphics3DGraphic;if(i.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,s=r.labelClassContexts;if(tq(s)||!r.emptySymbolLabelSupported&&i.layers.length===0)return!1;let n=!1;const o=i.graphic,a=r.layer,l=TF(r.layer);for(let d=0;d<s.length;d++){const p=e.textRenderers[d],m=e.textLabelPlacements[d];if(p==null||m==null)continue;const g=s[d],y=g.graphics3DSymbol,v=y.symbol&&y.symbol.type==="label-3d"?y.symbol:null,b=y.symbolLayers[0];if(!b)continue;b.setElevationInfoOverride(r.elevationInfoOverride);const w=new zTt(i,v,g.labelClass),x=this._createTextSymbolGraphic(p,o,m,a,b,w);if(x==null)return!1;x._labelClass=g.labelClass,x._labelIndex=d,i.addLabelGraphic(x,r.stageLayer),i.deconflictionPriority=((c=g.textRenderParameters)==null?void 0:c.definition.size)??0,i.setVisibilityFlag(Po.LABEL,wa.USER,l),i.setVisibilityFlag(Po.LABEL,wa.SCALE_RANGE,!0),i.setVisibilityFlag(Po.LABEL,wa.DECONFLICTION,!1),n=!0;const T=g.graphics3DCalloutSymbolLayer;if(T&&m.hasLabelVerticalOffset){T.setElevationInfoOverride(r.elevationInfoOverride);const C=this._createLineCalloutGraphic(o,v,T,m,a);C!=null&&(g.calloutSymbolLayerIndex=i.labelLayers.length,i.addLabelGraphic(C,r.stageLayer))}break}return n&&((u=r.scaleVisibility)==null||u.updateGraphicLabelScaleVisibility(i)),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const i=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;const s=i[r._labelIndex].graphics3DSymbol.symbolLayers[0];s==null||s.onRemoveGraphic(r)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var n;if(e.textInitialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(tq(r))return;const s=e.graphics3DGraphic.graphic;for(let o=0;o<r.length;o++){const a=r[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,(a==null?void 0:a.textRenderParameters)==null)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const w=l.needsHydrationToEvaluate()?Qut(s,i.layer):s;c=l.evaluate(w)}catch{c=null}else c=l.evaluate(s);if(c==null||c===""||/^\s+$/.test(c))continue;const u=a.graphics3DSymbol,d=((n=u.symbol)==null?void 0:n.type)==="label-3d"?u.symbol:null;if(!u.symbolLayers[0])continue;const p=e.graphics3DGraphic,m=a.labelClass,g=i.disablePlacement,y=dge({graphics3DGraphic:p,labelSymbol:d,labelClass:m,disablePlacement:g});if(y==null)continue;const v=rme(y.anchor),b=j3e(v);e.textRenderers[o]=new B3e(c,b,a.textRenderParameters,Qx.maxSize),e.textLabelPlacements[o]=y}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,i){const r=i.graphic.uid;if(e.graphics.set(r,i),e.active){const s=new gge(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s)}this.setDirty(),this.deconflictor.setDirty()}_updateGraphicGeometry(e,i){const r=i.graphic.uid,s=this._labels.get(r);if(!s)return!0;for(const n of s.graphics3DGraphic.labelLayers)if(n._labelClass!=null&&!e.labelClassContexts[n._labelIndex].graphics3DSymbol.symbolLayers[0].updateGeometry(n,i.graphic.geometry))return!1;return this.setDirty(),this.deconflictor.setDirty(),!0}_removeGraphic(e,i){const r=i.graphic.uid,s=this._labels.get(r);e.graphics.delete(r),s&&(this._destroyGraphic(s,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,i){this._labels.delete(i),e.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,i){if(!i)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of i){const s=e.graphics.get(r);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,i){for(const r of i.labelClassContexts){const s=new Map;i.graphics.forEach(o=>s.set(o.graphic.uid,o));const n=o=>o.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),r.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,o)}}}_visibilityInfoChange(e){const i=TF(e.layer);i&&!e.active&&this._activateLabelingContext(e),!i&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((i,r)=>{const s=this._labels.get(r);s&&(this._destroyGraphic(s,r),s.visible=!1,e.labelsToInitialize.set(r,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const i of this._labelingContexts)if(i.graphics3DCore===e)return i;return null}addGraphicsOwner(e,i,r){const s=(r==null?void 0:r.emptySymbolLabelSupported)||!1,n=(r==null?void 0:r.elevationInfoOverride)||null,o=(r==null?void 0:r.disablePlacement)||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new QTt(this.view._stage,a,e,i,s,n,o,TF(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),updateGraphicGeometry:c=>this._updateGraphicGeometry(l,c),layerLabelsEnabled:()=>TF(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._findLabelingContext(e);if(!i)return;const r=this._labelingContexts.indexOf(i);this._labelingContexts.splice(r,1),i.graphics.forEach(s=>this._removeGraphic(i,s)),i.destroy(),this.setDirty()}setLabelGraphicVisibility(e,i){const r=e.graphic.uid,s=this._labels.get(r);s&&s.visible!==i&&(i&&!s.addedToTextureAtlas?(this._addLabelTextureToAtlas(s),s.textInitialized||s.labelingContext.labelsToInitialize.set(r,s)):!i&&s.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(s),s.visible=i,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(i=>eq(i))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((i,r)=>i+(eq(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){}};function eq(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function tq(t){return!t||t.length===0}function TF(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(i=>!!i.symbol))}h([f({constructOnly:!0})],tx.prototype,"view",void 0),h([f({constructOnly:!0})],tx.prototype,"deconflictor",void 0),h([f()],tx.prototype,"_textTextureAtlas",void 0),h([f({type:Boolean,readOnly:!0})],tx.prototype,"updating",null),tx=h([I("esri.views.3d.layers.graphics.Labeler")],tx);const pp=new Spt(null,null,null);let JR=class TE{constructor(e,i,r,s=null){this.lij=[0,0,0],this.extent=Ht(),this.resolution=0,this.loadPriority=0,this.measures={visibility:mc.VISIBLE_ON_SURFACE,screenRect:Ht(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,i,r,s)}acquire(e,i,r,s){this.tilingScheme=s,this.id=TE.id(e,i,r),this.lij[0]=e,this.lij[1]=i,this.lij[2]=r,s.getExtent(e,i,r,this.extent),this.resolution=s.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return e?(e[0].acquire(i,r,s,this.tilingScheme),e[1].acquire(i,r+1,s,this.tilingScheme),e[2].acquire(i,r,s+1,this.tilingScheme),e[3].acquire(i,r+1,s+1,this.tilingScheme),e):[new TE(i,r,s,this.tilingScheme),new TE(i,r+1,s,this.tilingScheme),new TE(i,r,s+1,this.tilingScheme),new TE(i,r+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,T0(e.measures.screenRect,this.measures.screenRect)}static id(e,i,r){return`${e}/${i}/${r}`}};var mc;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(mc||(mc={}));function KTt(t,e,i,r,s,n,o=1){const a=R1(e,s,EB);if(a==null)return!1;if(a===Ps){if(t===r&&i===n)return!0;const c=i+o;for(let u=i,d=n;u<c;++u,++d)ce(r[d],t[u]);return!0}const l=i+o;for(let c=i,u=n;c<l;++c,++u)a(t[c],0,r[u],0);return!0}const fDe=.5*Math.PI,e2t=fDe/Math.PI*180;let t2t=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:E(),direction:E()};for(let i=0;i<4;i++)this._extent[i]={origin:E(),direction:E(),cap:{next:null,direction:E()}},this._planes[i]=Qi();this._planes[_r.NEAR]=Qi(),this._planes[_r.FAR]=Qi(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,i,r,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,i,r),me(this._center.origin,n[0].origin,n[2].origin),oe(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||oe(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,k0(a.cap.direction,a.origin,l.origin),qI(a.direction,a.cap.direction,a.origin,this._planes[o]),s||oe(a.direction,a.direction,-1)}qI(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[_r.NEAR]),s?R7(this._planes[_r.NEAR],this._planes[_r.FAR]):(DB(this._planes[_r.FAR],this._planes[_r.NEAR]),R7(this._planes[_r.NEAR],this._planes[_r.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=i,this._minGlobalAltitude=.9*ur(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,i,r=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===Ge.Global){const n=this._maxSpanSpatialReference.isGeographic?e2t:fDe*i;if(this._maxSpan>n)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const n=this._extent[0];return!(r||!e.intersectsRay(Mh(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!r&&e.intersectsRay(Mh(o.origin,o.direction))||e.intersectsLineSegment(_S(o.origin,o.cap.next,r2t),o.cap.direction))return!0}const s=r?this._planes:this._planesWithoutFar;for(let n=0;n<e.lines.length;n++){const o=e.lines[n];if(uot(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,i,r){_ee(e,fp),fp[2]=r,mu(i,fp,iq,this._renderCoordsHelper.spatialReference),In(yge,iq),Br(Lc);for(const{x0:n,x1:o,y0:a,y1:l}of i2t)for(let c=0;c<5;c++){const u=c/4;fp[0]=Dt(e[n],e[o],u),fp[1]=Dt(e[a],e[l],u),fp[2]=r,Zn(fp,i,fp,this._renderCoordsHelper.spatialReference),He(fp,fp,yge),Af(Lc,fp)}ne(this._extent[0].origin,Lc[0],Lc[1],Lc[2]),ne(this._extent[1].origin,Lc[3],Lc[1],Lc[2]),ne(this._extent[2].origin,Lc[3],Lc[4],Lc[2]),ne(this._extent[3].origin,Lc[0],Lc[4],Lc[2]);for(let n=0;n<4;++n)He(this._extent[n].origin,this._extent[n].origin,iq)}_toRenderBoundingExtentLocal(e,i,r){AB(e,i,ny,this._renderCoordsHelper.spatialReference),ne(this._extent[0].origin,ny[0],ny[1],r),ne(this._extent[1].origin,ny[2],ny[1],r),ne(this._extent[2].origin,ny[2],ny[3],r),ne(this._extent[3].origin,ny[0],ny[3],r)}_toRenderBoundingExtent(e,i,r){switch(this._renderCoordsHelper.viewingMode){case Ge.Global:this._toRenderBoundingExtentGlobal(e,i,r);break;case Ge.Local:this._toRenderBoundingExtentLocal(e,i,r);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(Er(e.planes[_r.NEAR],this._center.origin)<0&&pe(this._center.direction,e.direction)<0)return!0;for(let i=0;i<4;i++){const r=this._extent[i];if(Er(e.planes[_r.NEAR],r.origin)<0&&pe(r.direction,e.direction)<0)return!0}return!1}};const i2t=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],fp=E(),iq=Ee(),yge=Ee(),Lc=Jn(),ny=Ht(),r2t=Ff();let s2t=class{constructor(e,i){this._renderCoordsHelper=e,this._getIsGroundOpaque=i,this._surfaceElevation=0,this._isGroundOpaque=!1,this._cache=new Map,this._frustumBoundingSphereCenter=E(),this._frustumBoundingSphereRadius=0,this._frustum=new Xv(e),this._extendedFrustum=new Xv(e),this._intersector=new t2t({renderCoordsHelper:e}),this._renderSR=e.spatialReference;const r=xu(this._renderSR);this._renderSREllipsoidRadius=ur(r).radius,this._renderCoordsHelper=e}begin(e,i){this._surfaceElevation=i,this._aboveGround=e.aboveGround,this._isGroundOpaque=this._getIsGroundOpaque(),this._frustum.update(e),xge(this._frustum),this._updateExtendedFrustum(e),this._updateFrustumBoundingSphere()}end(){this._cache.clear()}calculate(e){const i=this._renderCoordsHelper.viewingMode===Ge.Global&&e.lij[0]>=n2t&&e.lij[0]<o2t,r=this._getOrCalculateSingleTileVisibility(e,!i);return r!==mc.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(e):r}_calculateAggregatedChildrenVisibility(e){let i=mc.INVISIBLE;const r=this._cache.get(e.id);if(r!=null)return r;const s=wge.acquire();e.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==mc.INVISIBLE&&(i=o,o===mc.VISIBLE_ON_SURFACE))break}return wge.release(s),this._cache.set(e.id,i),i}_getOrCalculateSingleTileVisibility(e,i){const r=this._cache.get(e.id);if(r!=null)return r;const s=this._calculateSingleTileVisibility(e);return i&&this._cache.set(e.id,s),s}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Ge.Global&&e.lij[0]<a2t?this._calculateSingleTileVisibilitySided(e,!1)===mc.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_isTileVisibleInFrustum(e){return this._renderCoordsHelper.viewingMode===Ge.Local?this._isTileVisibleInFrustumLocal(e):this._isTileVisibleInFrustumGlobal(e)}_updateFrustumBoundingSphere(){const e=this._frustum,i=e.origin,r=v2t;ge(r,e.direction);const s=e.points,n=b2t;Ai(n,s[4],i);const o=.5*pe(n,n)/pe(r,n),a=this._frustumBoundingSphereCenter;On(a,i,r,o);const l=1+o;this._frustumBoundingSphereRadius=l}_isTileVisibleInFrustumLocal(e){const i=e.tilingScheme.spatialReference,r=e.extent,s=this._renderSR,n=p2t;if(n[0]=r[0],n[1]=r[1],n[2]=0,n[3]=r[2],n[4]=r[3],n[5]=0,!ns(n,i,0,n,s,0,2))return!1;const o=Tge;ne(o[0],n[0],n[1],0),ne(o[1],n[3],n[1],0),ne(o[2],n[3],n[4],0),ne(o[3],n[0],n[4],0);const a=Ege;ne(a,.5*(n[0]+n[3]),.5*(n[1]+n[4]),.5*(n[2]+n[5]));const l=f2t;ne(l,0,0,1);const c=.5*e1(o[0],o[2]),u=this._frustum,d=this._frustumBoundingSphereRadius,p=this._frustumBoundingSphereCenter,m=x2t;Ai(m,p,a);const g=pe(l,m),y=w2t;if(On(y,a,l,g),e1(y,p)>c+d)return!1;const v=d2t,b=this._isGroundOpaque&&this._aboveGround,w=this._isGroundOpaque&&!this._aboveGround,x=Math.min(w?lO:1/0,g+d),T=Math.max(b?-lO:-1/0,g-d);for(let C=0;C<4;++C)On(v[C],o[C],l,x),On(v[C+4],o[C],l,T);return!nJ(u.planes,v,8)}_isTileVisibleInFrustumGlobal(e){const i=e.tilingScheme.spatialReference,r=e.extent,s=this._isGroundOpaque&&this._aboveGround,n=this._isGroundOpaque&&!this._aboveGround;if(e.lij[0]<mDe)return!0;const o=Tge,a=.5*(r[0]+r[2]);if(ne(o[0],r[0],r[1],0),ne(o[1],r[2],r[1],0),ne(o[2],r[2],r[3],0),ne(o[3],r[0],r[3],0),ne(o[4],a,r[1],0),ne(o[5],a,r[3],0),!KTt(o,i,0,o,this._renderSR,0,6))return!1;const l=o[0][2]>0,c=o[3][2]<0,u=l||c,d=this._renderSREllipsoidRadius;if(u){const K=$e(0,0,1),te=m2t;cv(te,K,o[0]);const he=g2t;if(cv(he,K,o[1]),l){const we=Cge,De=o[4],at=Mge;cv(at,De,K),cv(we,at,De);const et=o[0];ot(et,te,we),aO(et,d);const Ke=o[1];ot(Ke,he,we),aO(Ke,d)}else if(c){const we=Cge,De=o[5],at=Mge;cv(at,De,K),cv(we,De,at);const et=o[3];ot(et,we,te),aO(et,d);const Ke=o[2];ot(Ke,we,he),aO(Ke,d)}}const p=Ege;{const K=Ai(C2t,o[3],o[0]);ge(K,K);const te=me(M2t,o[0],o[3]);oe(te,te,.5);const he=-pe(te,K),we=me(A2t,o[0],o[1]);oe(we,we,.5);const De=me(P2t,o[2],o[3]);oe(De,De,.5);const at=Ai(O2t,De,we);ge(at,at);const et=-(he+pe(K,we))/pe(K,at);On(p,we,at,et),aO(p,d)}const m=this._frustumBoundingSphereRadius,g=this._frustumBoundingSphereCenter,y=this._frustum,v=y.planes,b=y2t;ge(b,p);const w=pe(o[0],b)/Ml(o[0]),x=y.origin,T=y.points;let C=!1;if(s){{C=!0;const te=ge(E(),x);for(let he=0;he<4;++he){const we=T[4+he],De=Ai(E(),we,x);ge(De,De);const at=ot(E(),te,De);ge(at,at);const et=ot(E(),De,at);if(ge(et,et),pe(x,et)>d){C=!1;break}}}if(C&&pe(x,b)<d*w-lO)return!1;const K=ge(q2t,y.origin);if(pe(K,b)<0)return!1;{const te=ge(W2t,y.direction);if(pe(te,b)>Y2t)return!1}}const M=Math.sqrt(1-w*w);if(M>.9)return!0;let O=!1;{const K=pe(b,g),te=Ml(g);if(te<=m&&!v.some(De=>Er(De,rq)>0)){if(!s)return!0;O=!0}const he=K/te;if(!O&&K<=0&&-K>m)return!1;const we=m/te;if(Math.sqrt(1-he*he)*Math.sqrt(1-we*we)-we*he>M)return!1}if(!C&&(o.some(K=>y.intersectsPoint(K))||y.intersectsPoint(p)))return!0;const D=S2t;Ai(D,g,rq);const k=pe(D,b),U=_2t;oe(U,b,k);const H=e1(U,g),z=i.isWGS84,Z=e.lij,q=z&&Z[2]===2**Z[0]-1,Y=z&&Z[2]===0,de=Y?z2t:q?k2t:N2t,L=Y?V2t:q?U2t:F2t;if(!O){const K=o,te=B2t,he=R2t,we=$2t,De=rq;for(const at of de){const et=K[at];if(Sge(he,K[(at+1)%4],et),Sge(we,De,et),cv(te,we,he),h2t(te,T,1))return!1}}let F=null;if(!s&&k<1.01*m){const K=2.5*m;if(H>w*K+m)return!1;const te=E2t,he=K/w;for(let we=0;we<4;++we)oe(te[we],o[we],he/d);ne(te[4],0,0,0),F=te}else{const K=(n?d+lO:k+m)/w,te=s?d-lO:(k-m)/w,he=T2t;for(let we=0;we<4;++we){const De=o[we];oe(he[we],De,te/d),oe(he[we+4],De,K/d)}F=he}if(nJ(v,F,F.length))return!1;const j=y.lines,W=I2t,X=L2t;for(const K of j){ge(X,K.direction);for(const te of L){const he=F[te];if(ge(W,he),sq(X,W,F,T))return!1;const we=(te+1)%4;if(s){const De=F[we];if(Ai(W,De,he),ge(W,W),sq(X,W,F,T))return!1}if(n){const De=F[4+te],at=F[4+we];if(Ai(W,at,De),ge(W,W),sq(X,W,F,T))return!1}}}return!0}_calculateSingleTileVisibilitySided(e,i){return this._isTileVisibleInFrustum(e)?(this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,i),this._intersector.isVisibleInFrustum(this._frustum,this._renderSREllipsoidRadius,!0)?mc.VISIBLE_ON_SURFACE:mc.VISIBLE_WHEN_EXTENDED):mc.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),xge(this._extendedFrustum);const i=this._renderCoordsHelper.worldUpAtPosition(e.eye,th);this._aboveGround||ea(i,i);const r=fo(-pe(i,e.viewForward));if(this._hasExtendedFrustum=r>e.fovY/2,!this._hasExtendedFrustum)return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,th),a){case pt.FAR_BOTTOM_LEFT:case pt.FAR_TOP_LEFT:case pt.NEAR_BOTTOM_LEFT:case pt.NEAR_TOP_LEFT:$7(this._extendedFrustum.planes[_r.LEFT],th,th);break;case pt.FAR_BOTTOM_RIGHT:case pt.FAR_TOP_RIGHT:case pt.NEAR_BOTTOM_RIGHT:case pt.NEAR_TOP_RIGHT:$7(this._extendedFrustum.planes[_r.RIGHT],th,th)}oe(th,th,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(Mh(l,th),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),qa(n[pt.NEAR_BOTTOM_LEFT],n[pt.NEAR_BOTTOM_RIGHT],n[pt.NEAR_TOP_RIGHT],vge),qa(n[pt.NEAR_BOTTOM_RIGHT],n[pt.NEAR_TOP_RIGHT],n[pt.NEAR_TOP_LEFT],bge),pe(vge,bge)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[pt.NEAR_BOTTOM_LEFT],o[pt.NEAR_BOTTOM_RIGHT]]=[o[pt.NEAR_BOTTOM_RIGHT],o[pt.NEAR_BOTTOM_LEFT]]:[o[pt.NEAR_TOP_LEFT],o[pt.NEAR_TOP_RIGHT]]=[o[pt.NEAR_TOP_RIGHT],o[pt.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-_ge;return{zWithMargin:e,pointIndices:Xv.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+_ge;return{zWithMargin:e,pointIndices:Xv.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<e}}};const n2t=2,o2t=6,a2t=12,l2t=.95,_ge=1,th=E(),vge=Qi(),bge=Qi(),wge=new Ca(Array,t=>{t.length!==4&&(t[0]=new JR,t[1]=new JR,t[2]=new JR,t[3]=new JR)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});function xge(t){const e=Xv.nearFarLineIndices,i=t.mutablePoints;for(const r of e){const[s,n]=r,o=i[s],a=i[n];ve(th,a,o),oe(th,th,l2t),me(i[n],o,th)}t.updatePoints(i)}function cv(t,e,i){return ot(t,e,i),ge(t,t),t}function Sge(t,e,i){return Ai(t,e,i),ge(t,t),t}function aO(t,e){return oe(t,t,e/Ml(t)),t}const c2t=[_r.LEFT,_r.RIGHT,_r.BOTTOM,_r.TOP,_r.FAR];function u2t(t,e,i){for(let r=0;r<i;++r)if(Er(t,e[r])<=0)return!1;return!0}function nJ(t,e,i){for(const r of c2t)if(u2t(t[r],e,i))return!0;return!1}const mDe=4;function h2t(t,e,i){for(const r of e)if(pe(r,t)<i)return!1;return!0}const d2t=[E(),E(),E(),E(),E(),E(),E(),E()],p2t=[0,0,0,0,0,0],Tge=[E(),E(),E(),E(),E(),E()],Ege=E(),f2t=E(),Cge=E(),m2t=E(),g2t=E(),Mge=E(),y2t=E(),_2t=E(),v2t=E(),b2t=E(),w2t=E(),x2t=E(),rq=$e(0,0,0),S2t=E(),T2t=[E(),E(),E(),E(),E(),E(),E(),E()],E2t=[E(),E(),E(),E(),E()],C2t=E(),M2t=E(),A2t=E(),P2t=E(),O2t=E(),R2t=E(),$2t=E(),I2t=E(),L2t=E(),D2t=E(),N2t=[0,1,2,3],F2t=[0,1,2,3],k2t=[0,1,3],U2t=[0,1,3],z2t=[1,2,3],V2t=[1,2,3],B2t=E();function G2t(t,e,i){let r=1/0,s=-1/0;for(const n of i){const o=pe(e,n);r=Math.min(r,o),s=Math.max(s,o)}t[0]=r,t[1]=s}function j2t(t,e,i,r){let s=1/0,n=-1/0;for(const o of r){const a=pe(i,o);if(s=Math.min(s,a),n=Math.max(n,a),s<=e&&n>=t)return!1}return!0}const H2t=[0,0];function sq(t,e,i,r){if(i.length===0||r.length===0)return!0;const s=D2t;cv(s,t,e);const n=r[0]<i[0],o=n?i:r,a=H2t;return G2t(a,s,n?r:i),j2t(a[0],a[1],s,o)}const lO=430,q2t=E(),W2t=E(),Y2t=Math.cos(.25*Math.PI);let Z2t=class{constructor(e){this._camera=new Pr,this._focusOnMap=[0,0],this._screenRect=Ht(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new s2t(e.renderCoordsHelper,e.getIsGroundOpaque)}begin(e,i,r){this._camera.copyFrom(e),this._surfaceElevation=r,this._focusOnMap[0]=i.x,this._focusOnMap[1]=i.y,Z3(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,r)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=Rje(e.extent,this._focusOnMap),e.measures.visibility!==mc.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const i=X2t,r=1<<i,s=e.measures.screenRect;Mc(s);let n=0;const o=e.lij,a=o[0],l=a+i,c=o[1]<<i,u=o[2]<<i,d=this._tileSizeWithBias(e),p=d*d,m=this._camera,{frustum:g,viewport:y}=m;if(this._renderCoordsHelper.viewingMode===Ge.Local||a>mDe){const v=Age;this._tilingScheme.getExtent(o[0],o[1],o[2],v);const b=A2,w=K2t,x=Mc();for(let M=0;M<4;++M)this._toRenderCoords(v,Rge[M][0],Rge[M][1],w[M]),m.projectToScreen(w[M],b[M]),DC(x,b[M]);const T=nJ(g,w,4),C=x[0]>y[2]||x[1]>y[3]||x[2]<y[0]||x[3]<y[1];if(T||C)return void(e.measures.shouldSplit=!1)}for(let v=0;v<r;v++)for(let b=0;b<r;b++)if(n+=this._computeScreenArea(l,c+v,u+b,s),n>p)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===mc.VISIBLE_WHEN_EXTENDED?this._tileSize*J2t:this._tileSize}_computeScreenArea(e,i,r,s){this._tilingScheme.ensureMaxLod(e);const n=Age;this._tilingScheme.getExtent(e,i,r,n);const o=Q2t;return this._toRenderCoords(n,0,3,o[0]),this._toRenderCoords(n,2,3,o[1]),this._toRenderCoords(n,2,1,o[2]),this._toRenderCoords(n,0,1,o[3]),this._computeTriangleScreenArea([o[0],o[1],o[2]],s)+this._computeTriangleScreenArea([o[2],o[1],o[3]],s)}_computeTriangleScreenArea(e,i){const r=this._camera.frustum[_r.NEAR];let s=0,n=-1,o=-1;for(let a=0;a<3;++a)Er(r,e[a])>0?(s++,n===-1&&(n=a)):o===-1&&(o=a);if(s===0)return this._computeTriangleScreenAreaInside(e,i);if(s===1){const a=Oge,l=(n+1)%3,c=(n+2)%3,u=n;ce(a[0],e[l]),ce(a[1],e[c]),CF(a[2],e[c],e[u],r);const d=this._computeTriangleScreenAreaInside(a,i);return CF(a[1],e[l],e[u],r),d+this._computeTriangleScreenAreaInside(a,i)}if(s===2){const a=Oge,l=o;ce(a[0],e[l]);const c=(o+1)%3,u=(o+2)%3;return CF(a[1],e[l],e[c],r),CF(a[2],e[l],e[u],r),this._computeTriangleScreenAreaInside(a,i)}return 0}_computeTriangleScreenAreaInside(e,i){for(let r=0;r<3;r++)this._camera.projectToRenderScreen(e[r],Pge),this._camera.renderToScreen(Pge,A2[r]),r1(i,A2[r],i);return Vst(A2[0],A2[1],A2[2])}_toRenderCoords(e,i,r,s){return EF[0]=e[i],EF[1]=e[r],EF[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(EF,this._tilingScheme.spatialReference,s),s}};const X2t=2,J2t=5,A2=[vs(),vs(),vs(),vs()],Age=Ht(),EF=E(),Q2t=[E(),E(),E(),E()],Pge=xa(),Oge=[E(),E(),E()];function CF(t,e,i,r){const s=Er(r,e),n=Er(r,i),o=Math.abs(n-s);oe(t,e,Math.abs(n)/o),On(t,t,i,Math.abs(s)/o)}const K2t=[E(),E(),E(),E()],Rge=[[0,3],[2,3],[2,1],[0,1]];function WJt(t,e,i){if(t==null||i==null)return!1;let r=!0;return jn[0]=t.xmin!=null?t.xmin:0,jn[1]=t.ymin!=null?t.ymin:0,jn[2]=t.zmin!=null?t.zmin:0,r=r&&ns(jn,t.spatialReference,0,e,i,0,1),jn[0]=t.xmax!=null?t.xmax:0,jn[1]=t.ymax!=null?t.ymax:0,jn[2]=t.zmax!=null?t.zmax:0,r=r&&ns(jn,t.spatialReference,0,e,i,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),r}function gDe(t,e,i){if(t==null||i==null)return!1;let r=!0;return jn[0]=t.xmin!=null?t.xmin:0,jn[1]=t.ymin!=null?t.ymin:0,jn[2]=t.zmin!=null?t.zmin:0,r=r&&ns(jn,t.spatialReference,0,jn,i,0,1),e[0]=jn[0],e[1]=jn[1],jn[0]=t.xmax!=null?t.xmax:0,jn[1]=t.ymax!=null?t.ymax:0,jn[2]=t.zmax!=null?t.zmax:0,r=r&&ns(jn,t.spatialReference,0,jn,i,0,1),e[2]=jn[0],e[3]=jn[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),r}const jn=E();let qo=class extends Re{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void ie.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const i=this._get("filterExtent");if(i===e||i!=null&&e&&i.equals(e))return;const r=e!=null?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=Ht();return gDe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new tt,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Zt}initialize(){this.addHandles([ue(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),ar),ue(()=>{var e,i,r;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(i=this.viewState)==null?void 0:i.contentCamera,(r=this.focus)==null?void 0:r.location]},()=>this._setDirty(),sr),ue(()=>{var e;return((e=this.terrain)==null?void 0:e.baseOpacity)??1},()=>this._setDirty())]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(Mt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Or(this._frameWorker)}addClient(){const e=_h();return this._clients.add(e),this._clients.size===1&&this._setDirty(),Ni(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(lu))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=Mt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=Mt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new Z2t({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,getIsGroundOpaque:()=>{var i;return(((i=this.terrain)==null?void 0:i.baseOpacity)??1)===1}}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(i=>new JR(i[0],i[1],i[2],e))}_purgeHorizonTiles(e){if(e.sort((i,r)=>{const s=i.measures.screenRect,n=r.measures.screenRect;return s[1]+s[3]-(n[1]+n[3])}),!(e.length>tEt))return e.toArray();Mc(MF);for(let i=0;i<e.length;i++)if(r1(MF,e.data[i].measures.screenRect,MF),_c(MF)>eEt)return e.data.slice(i,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:i}=this;for(;this._pendingTiles.length>0&&!e.done;){const r=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!X3(this._filterExtentRect,r.extent)||(this._tileMeasurements.updateTile(r),r.measures.visibility!==mc.INVISIBLE&&(r.measures.shouldSplit?(i.ensureMaxLod(r.lij[0]+1),this._pendingTiles.push(...r.getChildren())):this._newTiles.push(r)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const i=e.filter(s=>{const n=this._idToTile.get(s.id);return n?(n.copyMeasurementsFrom(s),n.used=!0):this._idToTile.set(s.id,s),!n}),r=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(r),this.tiles.addMany(i),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,i)=>e.measures.visibility!==i.measures.visibility?e.measures.visibility===mc.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-i.measures.distance),this.tiles.forEach((e,i)=>e.loadPriority=i)}};h([f({constructOnly:!0})],qo.prototype,"scheduler",void 0),h([f({constructOnly:!0})],qo.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],qo.prototype,"tilingSchemeOwner",void 0),h([f({constructOnly:!0})],qo.prototype,"cameraOnSurface",void 0),h([f({constructOnly:!0})],qo.prototype,"focus",void 0),h([f({constructOnly:!0})],qo.prototype,"viewState",void 0),h([f({constructOnly:!0})],qo.prototype,"terrain",void 0),h([f()],qo.prototype,"tiles",void 0),h([f()],qo.prototype,"tileSize",void 0),h([f({readOnly:!0})],qo.prototype,"tilingScheme",null),h([f()],qo.prototype,"filterExtent",null),h([f({readOnly:!0})],qo.prototype,"_filterExtentRect",null),h([f({readOnly:!0})],qo.prototype,"_rootTileIds",null),h([f({value:!1})],qo.prototype,"suspended",null),h([f({readOnly:!0})],qo.prototype,"updating",null),qo=h([I("esri.views.3d.layers.support.FeatureTileTree3D")],qo);const MF=Ht(),eEt=10,tEt=50;let As=class extends Re{constructor(){super(...arguments),this._propertiesPool=new C0({camera:Pr},this),this._lastSeenCameraProjectionValues=new Pr,this.mode=Mi.ANIMATING,this._cssCamera=new Pr,this._camera=new Pr,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new cn,this.viewingMode=Ge.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,i){this._set("viewingMode",e),this._set("spatialReference",i),this._set("constraints",new Sy({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new C0({camera:Pr},this)}destroy(){var e;this.cameraController=null,(e=this._propertiesPool)==null||e.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Ge.Global){const e=ur(this.spatialReference).radius;this.camera=new Pr({eye:$e(4*e,0,0),center:$e(e,0,0),up:$e(0,0,1)})}else this.camera=new Pr({eye:$e(0,0,100),center:$e(0,0,0),up:$e(0,1,0)})}get animation(){return this.cameraController instanceof l3&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:i,width:r,pixelRatio:s}=this.camera;return e.pixelRatio=1,e.height=Math.round(i/s),e.width=Math.round(r/s),e}get camera(){return this._camera}set camera(e){e!==Bh&&Bh.copyFrom(e),Bh.computeUp(this.viewingMode),this.events.emit("before-camera-change",Bh);const i=this._camera;if(rEt(this._lastSeenCameraProjectionValues,Bh)&&(this._lastSeenCameraProjectionValues.copyFrom(Bh),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!i.equals(Bh)&&(this._camera=this._propertiesPool.get("camera").copyFrom(Bh),this._cameraChanged=!i.almostEquals(Bh),this._cameraChanged)){const r=G1e(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===Mi.IDLE}get updating(){return this.mode!==Mi.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Ge.Global}get isLocal(){return this.viewingMode===Ge.Local}get navigating(){var e;return!!((e=this.cameraController)!=null&&e.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){var i;this.stopActiveCameraController()?((i=this.cameraController)==null||i.destroy(),e&&(this.removeHandles($ge),this.addHandles(vu(()=>e.state===us.Finished||e.state===us.Stopped,()=>{this._set("cameraController",null),this.updateCamera(r=>e.onControllerEnd(r))},{sync:!0,once:!0}),$ge),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=us.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==us.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();Bh.copyFrom(this._get("camera")),e(Bh),this.camera=Bh,this._processingUpdates=!1,this._processUpdateQueue()}};h([f()],As.prototype,"mode",void 0),h([f({readOnly:!0,type:QM})],As.prototype,"animation",null),h([f({type:Pr})],As.prototype,"cssCamera",null),h([f()],As.prototype,"_cssCamera",void 0),h([f({type:Pr})],As.prototype,"camera",null),h([f()],As.prototype,"_camera",void 0),h([f({readOnly:!0})],As.prototype,"pixelRatio",null),h([f()],As.prototype,"rasterPixelRatio",void 0),h([f()],As.prototype,"contentPixelRatio",void 0),h([f({readOnly:!0})],As.prototype,"alignPixelEnabled",null),h([f({readOnly:!0})],As.prototype,"updating",null),h([f({})],As.prototype,"_contentCamera",void 0),h([f({type:Pr})],As.prototype,"contentCamera",null),h([f({readOnly:!0})],As.prototype,"fixedContentCamera",null),h([f({readOnly:!0})],As.prototype,"constraints",void 0),h([f({readOnly:!0})],As.prototype,"events",void 0),h([f({readOnly:!0})],As.prototype,"isGlobal",null),h([f({readOnly:!0})],As.prototype,"isLocal",null),h([f({readOnly:!0})],As.prototype,"viewingMode",void 0),h([f({readOnly:!0})],As.prototype,"spatialReference",void 0),h([f()],As.prototype,"navigating",null),h([f()],As.prototype,"stationary",null),h([f()],As.prototype,"_cameraChanged",void 0),h([f()],As.prototype,"cameraController",null),As=h([I("esri.views.3d.state.ViewState")],As);const iEt=As;function rEt(t,e){return t.fov!==e.fov||t.fullViewport[0]!==e.fullViewport[0]||t.fullViewport[1]!==e.fullViewport[1]||t.fullViewport[2]!==e.fullViewport[2]||t.fullViewport[3]!==e.fullViewport[3]||t.padding[ai.TOP]!==e.padding[ai.TOP]||t.padding[ai.RIGHT]!==e.padding[ai.RIGHT]||t.padding[ai.BOTTOM]!==e.padding[ai.BOTTOM]||t.padding[ai.LEFT]!==e.padding[ai.LEFT]}const Bh=new Pr,$ge="ViewStateHandles";function yDe(t){return t?dEt:pEt}function sEt(t,e){return e!=null&&e.mode?e.mode:yDe(t).mode}function nEt(t,e){return e??yDe(t)}function _De(t,e){return sEt(t!=null&&t.hasZ,e)}function XJt(t,e){return nEt(t!=null&&!!t.hasZ,e)}function JJt(t){const e=vDe(t);return _De(t.geometry,e)}function QJt(t){const e=vDe(t),i=_De(t.geometry,e),r=e!=null&&i!=="on-the-ground"?wDe(e):0,s=e==null?void 0:e.featureExpressionInfo;return{mode:i,offset:r,featureExpressionInfo:s}}function KJt(t){return aEt(t)||oEt(t)}function oEt(t){var e;return((e=t==null?void 0:t.featureExpressionInfo)==null?void 0:e.expression)==="0"}function aEt(t){if(!t||t.mode==="on-the-ground")return!1;const e=t!=null&&t.featureExpressionInfo?t.featureExpressionInfo.expression:null;return!(!e||e==="0")}function vDe(t){return t.layer&&"elevationInfo"in t.layer?t.layer.elevationInfo:null}function Ase(t,e){if(!(t!=null&&t.offset))return 0;const{offset:i,unit:r}=t;if(r==="decimal-degrees")return 0;const s=r!=="unknown"&&r?r:"meters",n=iwe(e);return n?ro(i,s,n):0}function eQt(t,e,i){if(!(i!=null&&i.mode))return;const r=t.hasZ?t.z:0,s=Ase(i,t.spatialReference);switch(i.mode){case"absolute-height":return r-s;case"on-the-ground":return 0;case"relative-to-ground":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"ground")??0)+s);case"relative-to-scene":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"scene")??0)+s)}}function tQt(t,e,i,r=null){return bDe(t,e.x,e.y,e.hasZ?e.z:0,e.spatialReference,i,r)}function iQt(t,e,i,r,s=null){return bDe(t,e[0],e[1],e.length>2?e[2]:0,i,r,s)}function bDe(t,e,i,r,s,n,o=null){if(n==null)return;const a=o!=null?o.mode:"absolute-height";if(a==="on-the-ground")return 0;const{absoluteZ:l}=lEt(e,i,r,s,t,n);return cEt(l,e,i,r,s,t,o,a)}function lEt(t,e,i,r,s,n){const o=Ase(n,r);switch(n.mode){case"absolute-height":return{absoluteZ:i+o,elevation:0};case"on-the-ground":{const a=s.elevationProvider.getElevation(t,e,0,r,"ground")??0;return{absoluteZ:a,elevation:a}}case"relative-to-ground":{const a=s.elevationProvider.getElevation(t,e,i,r,"ground")??0;return{absoluteZ:i+a+o,elevation:a}}case"relative-to-scene":{const a=s.elevationProvider.getElevation(t,e,i,r,"scene")??0;return{absoluteZ:i+a+o,elevation:a}}}}function cEt(t,e,i,r,s,n,o,a){const l=Ase(o,s);switch(a){case"absolute-height":return t-l;case"relative-to-ground":return t-((n.elevationProvider.getElevation(e,i,r,s,"ground")??0)+l);case"relative-to-scene":return t-((n.elevationProvider.getElevation(e,i,r,s,"scene")??0)+l)}}function rQt(t,e){if(e==null)return!1;const{mode:i}=e;return i!=null&&(t==="scene"&&i==="relative-to-scene"||t==="ground"&&i!=="absolute-height")}function uEt(t,e,i){return i&&i.mode!==e?`${t} only support ${e} elevation mode`:null}function sQt(t,e,i){return(i==null?void 0:i.mode)===e?`${t} do not support ${e} elevation mode`:null}function hEt(t,e){return(e==null?void 0:e.featureExpressionInfo)!=null&&e.featureExpressionInfo.expression!=="0"?`${t} do not support featureExpressionInfo`:null}function Ige(t,e){e&&t.warn(".elevationInfo=",e)}function wDe(t){return((t==null?void 0:t.offset)??0)*JOe(t==null?void 0:t.unit)}const dEt={mode:"absolute-height",offset:0},pEt={mode:"on-the-ground",offset:null},fEt="OBJECTID";let nQt=class extends oL{constructor(e,i,r,s){super(i,r),this.point=e,this.createGraphic=s}};function xDe(t){return Zd(t)&&t.intersector===Zr.PCL&&!!t.target}let aQt=class extends t2e{constructor(e,i,r,s,n){super(e),this.layerUid=e,this.sublayerUid=i,this.nodeIndex=r,this.componentIndex=s,this.triangleNr=n}},cQt=class extends oL{constructor(e,i,r){super(i,null),this.point=e,this.createVoxelGraphic=r}},hQt=class extends oL{constructor(e,i){super(e,null),this.createTiles3DGraphic=i}};function vj(t){return Zd(t)&&t.intersector===Zr.I3S&&!!t.target}function SDe(t){return Zd(t)&&t.intersector===Zr.VOXEL&&!!t.target}function mEt(t){return Zd(t)&&t.intersector===Zr.TILES3D&&!!t.target}function TDe(t,e){var i,r;return HB(t)||qB(t)?E3((i=t.target)==null?void 0:i.object,e):Cgt(t)?(r=e.map)==null?void 0:r.ground:xDe(t)||vj(t)||SIe(t)||SDe(t)?E3(t.target,e):null}function pQt(t,e){const i=Pse(t,e);return i!=null&&i.type==="graphic"?i.graphic:null}function Pse(t,e){var i;if(t==null)return null;if(HB(t)||qB(t))return Lge((i=t.target)==null?void 0:i.object,e);if(xDe(t)){const r=t.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(SDe(t)){const r=t.target.createVoxelGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(mEt(t)){const r=t.target.createTiles3DGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return SIe(t)||xse(t)?Lge(t.target,e):vj(t)?gEt(t.target,e):null}function Lge(t,e){if((t==null?void 0:t.graphicUid)==null)return null;const i=E3(t,e);if(i==null)return null;if(i===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const r=e.allLayerViews.find(s=>s.layer===i);return!r||r.suspended||t.graphicUid==null?null:"getHit"in r?r.getHit(t.graphicUid):null}function gEt(t,e){const i=E3(t,e);if(i==null)return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?_Et(r.getGraphicFromIntersectorTarget(t)):null}function yEt(t,e){const i=E3(t,e);if(i==null)return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(t):null}function _Et(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function E3(t,e){return(t==null?void 0:t.layerUid)==null?null:e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.allLayers.find(i=>i.uid===t.layerUid)}function fQt(t,e){if(HB(t)||qB(t))return n1(t.target.object.boundingVolumeWorldSpace.bounds);if(xse(t)){ASe(AF,t.transformation);const i=Math.max(AF[0],AF[1],AF[2]);return t.target.baseBoundingSphere.radius*i}if(vj(t)){const i=yEt(t.target,e);return i?.5*tCe(i):null}return null}function mQt(t){return!HB(t)&&!qB(t)&&(xse(t)?t.target.numLodLevels>1:!!vj(t))}const AF=E();async function vEt(t,e,i,r){const s=i?MDe(t,i):r,n=vs(e.x,e.y);s.requiresGroundFeedback=!0,s.enableDraped=!0;const o=jd(t.state.viewingMode);o.options.selectionMode=!0,o.options.store=ta.ALL,t.sceneIntersectionHelper.intersectIntersectorScreen(n,o,s);const a=wEt(t,o.results.all,s.graphics),l=o.results.ground,c=TDe(l,t),u=c!=null&&"type"in c&&WI(c.type)?c:null,d={screenPoint:e,results:a,ground:{mapPoint:bC(t,l),distance:Zd(l)?l.distanceInRenderSpace:0,layer:u}};return Rr.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(d.intersector=o),d}function bEt(t,e,i,r){var u,d,p,m,g;const s=i?MDe(t,i):r,n=!(!((u=s.graphics)!=null&&u.include)&&!((d=s.graphics)!=null&&d.exclude)),o=!(!((p=s.mediaElements)!=null&&p.include)&&!((m=s.mediaElements)!=null&&m.exclude)),a=ef(e);s.enableDraped=s.include&&!s.include.has(N1)||((g=s.exclude)==null?void 0:g.has(N1));const l=t.sceneIntersectionHelper,c=jd(t.state.viewingMode);if(c.options.selectionMode=!0,c.options.store=n||o?ta.ALL:ta.MIN,c.options.hud=!(i!=null&&i.excludeHud),l.intersectIntersectorScreen(a,c,s),n||o){for(const y of c.results.all){const v=Pse(y,t);if(v==null||n&&(v.type!=="graphic"||EDe(s.graphics,v.graphic))||o&&(v.type!=="media"||CDe(s.mediaElements,v.element)))return bC(t,y)}return null}return bC(t,c.results.min)}function wEt(t,e,i){const r=new Array;let s=null;for(let n=0;n<e.length;n++){const o=e[n],a=TDe(o,t);if(a!=null&&(a===t.map.ground||"type"in a&&WI(a.type)))break;const l=Pse(o,t);if(l==null)continue;if(l.type==="graphic"){if(s==null&&n!==e.length-1&&(s=new Set),s!=null){const d=Ose(l.graphic);if(s.has(d))continue;s.add(d)}if(!EDe(i,l.graphic))continue}const c=bC(t,o),u=o.distanceInRenderSpace;if(l.type==="media"){const d=l.element.toSource(c);r.push({...l,mapPoint:c,distance:u,sourcePoint:d})}else r.push({...l,mapPoint:c,distance:u})}return r}function bC(t,e,i){return e.getIntersectionPoint(wC)?(i=oJ(t,wC,i),e.intersector===Zr.TERRAIN&&t.basemapTerrain&&(i.z=Qm(t.basemapTerrain,i)??0),i):null}function Ose(t){var s;const e=t.sourceLayer,i=t.layer,r=e&&"objectIdField"in e?e:i&&"objectIdField"in i?i:e;if(r){const n=r.objectIdField??fEt,o=(s=t.attributes)==null?void 0:s[n];if(o)return`o-${r.id}-${o}`}return`u-${t.uid}`}function EDe(t,e){return CDe(t,Ose(e))}function CDe(t,e){return t==null||(t.include==null||t.include.has(e))&&(t.exclude==null||!t.exclude.has(e))}function oJ(t,e,i){let r=t.spatialReference||We.WGS84;return Zn(e,t.renderSpatialReference,wC,r)?e=wC:(r=We.WGS84,Zn(e,t.renderSpatialReference,wC,r)&&(e=wC)),i?(i.x=e[0],i.y=e[1],i.z=e[2],i.spatialReference=r):i=new _t(e,r),i}function MDe(t,e){const i=aJ(t,e.include,yA.INCLUDE),r=aJ(t,e.exclude,yA.EXCLUDE);return{include:i.layerUids,exclude:r.layerUids,graphics:{include:i.graphicUids,exclude:r.graphicUids},mediaElements:{include:i.mediaElements,exclude:r.mediaElements}}}function aJ(t,e,i,r={layerUids:void 0,graphicUids:void 0,mediaElements:void 0}){if(!e)return r;if(e instanceof Su)xEt(r,Ose(e)),i===yA.INCLUDE&&(t.graphicsView!=null&&e.layer===t?P2(r,t.graphicsView.processor.layer.id):e.layer&&P2(r,e.layer.uid));else if("layer"in e&&"element"in e)SEt(r,e.element),i===yA.INCLUDE&&P2(r,e.layer.uid);else if(w9(e))for(const s of e)s===t.graphics&&t.graphicsView!=null?P2(r,t.graphicsView.processor.layer.id):s===t.map.ground?P2(r,N1):aJ(t,s,i,r);else"uid"in e&&P2(r,e.uid);return r}function P2(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function xEt(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function SEt(t,e){t.mediaElements||(t.mediaElements=new Set),t.mediaElements.add(e)}const wC=E();var yA;(function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"})(yA||(yA={}));let TEt=class{constructor(e,i,r){this.viewingMode=e,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new Zt,this._tolerance=WM,this._tmpRay=uo(),this._tmpRegion=Ht(),this._validateHUDIntersector=jd(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,i,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),Dge(this.viewingMode),i,r)}intersectScreenFreePointFallback(e,i,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),i,r)}intersectRayFreePointFallback(e,i,r){return this.intersectRay(e,Dge(this.viewingMode),i,r)||this._intersectRayFreePointLocal(e,i)}intersectRay(e,i,r,s){return i.options.selectionMode=!1,i.options.store=ta.MIN,this.computeIntersection(e,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,i,r=.5,s=.5){return e.getRenderCenter(OF,r,s),OF[0]+=.0466,OF[1]-=.0123,Yie(e,OF,i)}intersectIntersectorScreen(e,i,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),i,r)}intersectToolIntersectorScreen(e,i,r){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(e,i,r){i.options.selectionMode=!0,this.computeIntersection(e,i,r);const s=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||Zd(s)&&s.intersector!==Zr.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(e,i,r))}setTolerance(e=WM){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((i,r)=>i.type===Zr.TERRAIN?1:r.type===Zr.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===Zr.TERRAIN?1:r.type===Zr.TERRAIN?-1:0)}_getPickRay(e,i){const r=this._view.state.camera;return Wie(r,e,i)}_intersectRayFreePointLocal(e,i){return this.viewingMode!==Ge.Local||e==null||me(i,e.origin,ge(Ye.get(),e.direction)),!1}intersectElevationFromScreen(e,i,r=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),i,r,s)}_intersectElevation(e,i,r=0,s=null){if(e==null)return null;const n=this._view,{renderCoordsHelper:o}=n,a=kS(n.spatialReference),l=i!=null?i.mode:"absolute-height",c=wDe(i)/a,u=(l!=="on-the-ground"?c+r:0)*a/o.unitInMeters,{camera:d}=n.state;if(l==="absolute-height"){const T=o==null?void 0:o.getAltitude(d.eye),C=pe(ge(cO,e.direction),o.worldUpAtPosition(d.eye,MEt));if(T<u&&C<0||T>=u&&C>0)return null;if(o.intersectInfiniteManifold(e,u,cO)){const M=oJ(n,cO);return M.z??(M.z=0),M.z-=c,M}return null}const p=Ye.get();d.projectToRenderScreen(e.origin,p);const m=new Nge(null,this._forEachLayer),{slicePlane:g}=n,y=g!=null?qle(g):null,v=jd(this.viewingMode);v.options.store=ta.MIN,v.options.verticalOffset=u,v.options.normalRequired=!1;const b=e.origin,w=me(Ye.get(),b,e.direction);v.reset(b,w,d),v.point=p;const x=s?"type"in s&&s.type==="graphics"?T=>T.layerUid!==s.uid:T=>T.graphicUid!==s.uid:null;switch(l){case"relative-to-scene":{const T=C=>(!x||x(C))&&!!C.lastValidElevationBB;v.intersect(m.layers,p,this._tolerance,null,T),this._externalIntersectionHandlers.forAll(C=>{if(C.type===Zr.I3S||C.type===Zr.TERRAIN||C.type===Zr.TILES3D){const M=C.slicePlaneEnabled?y:null;C.intersect(v,M,v.rayBegin,v.rayEnd,p)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(T=>{if(T.isGround){const C=T.slicePlaneEnabled?y:null;T.intersect(v,C,v.rayBegin,v.rayEnd,p)}})}if(v.results.min.getIntersectionPoint(cO)){const T=oJ(n,cO);return T.z=r,T}return null}computeIntersection(e,i,r,s){var y;if(e==null)return;const n=this._view.state.camera,o=Ye.get();n.projectToRenderScreen(e.origin,o);const a=new Nge(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const l=e.origin,c=me(Ye.get(),e.origin,e.direction);i.reset(l,c,n),i.intersect(a.layers,o,this._tolerance);const u=this._view.slicePlane,d=u!=null?qle(u):null;i.intersect(a.sliceableLayers,o,this._tolerance,d);const p=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(v=>{const b=v.layerUid,w=Array.isArray(b),x=w?b:[b];w&&(i.options.filteredLayerUids=[]);let T=!1;for(const C of x)a.filterLayerUid(C)?T=!0:w&&i.options.filteredLayerUids.push(C);if(i.options.isFiltered=!T,v.isGround&&p||!i.options.isFiltered){const C=v.slicePlaneEnabled?d:null;v.intersect(i,C,l,c,o,s)}});const m=Ye.get(),g=this._view.basemapTerrain;if(r&&r.enableDraped&&g.spatialReference!=null&&i.results.ground.getIntersectionPoint(m)){const v=g.overlayManager.renderer,b=this._view.renderCoordsHelper.spatialReference,w=Ye.get();this._view.renderCoordsHelper.fromRenderCoords(m,w,g.spatialReference),w[2]=((y=this._view.elevationProvider)==null?void 0:y.getElevation(m[0],m[1],m[2],b,"ground"))??0,v.intersect(i,w,i.results.ground,x=>a.filterRenderGeometry(x))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(e){const i=e.results.hud;T0(this._tmpRegion,h7);const r=this._view.state.camera,s=[],n=this._tmpRegion,o=b=>{const w=new CEt(b);r.projectToRenderScreen(b.target.center,w.screenPoint),w.screenPoint[0]=Math.floor(w.screenPoint[0]),w.screenPoint[1]=Math.floor(w.screenPoint[1]),s.push(w),DC(n,w.screenPoint)};e.sortResults(i.all),i.min.dist!=null&&o(i.min);for(const b of i.all)i.min.target.object!==b.target.object&&i.max.target.object!==b.target.object&&o(b);if(i.max.dist!=null&&i.max.target.object!==i.min.target.object&&o(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-QR),u=Math.max(0,n[1]-QR),d=Math.min(Xa(n)+2*QR,a-c),p=Math.min(_c(n)+2*QR,l-u);if(d<=0||p<=0)return;const m=new Uint8Array(d*p*4);this._view._stage.renderer.readHUDVisibility(c,u,d,p,m);let g=!0;const y=e.results.max.dist==null;let v=0;for(const b of s)for(const w of EEt){const x=4*(Math.min(b.screenPoint[0]+w[0],a)-n[0]+(Math.min(b.screenPoint[1]+w[1],l)-n[1])*d);if(!(x<0||x>=m.length)&&m[x]){g&&(e.results.min.copy(b.result),g=!1),y&&e.results.max.copy(b.result),e.options.store===ta.ALL&&e.results.all.splice(v++,0,b.result);break}}}};const QR=1,EEt=(()=>{const t=[],e=QR;for(let i=-e;i<=e;i++)for(let r=-e;r<=e;r++)t.push([r+e,i+e]);return t})();let CEt=class{constructor(e){this.result=e,this.screenPoint=xa()}},PF;function Dge(t){return PF&&PF.viewingMode===t||(PF=jd(t)),PF}let Nge=class{constructor(e,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,i(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(e){const{include:i,exclude:r}=this;return e==null?i==null&&r==null:(i==null||i.has(e))&&(r==null||!r.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function Fge(t){return typeof t=="object"&&"intersect"in t}const cO=E(),MEt=E(),OF=xa();let vQt=class{constructor(e,i){this.spatialReference=e,this._view=i}getElevation(e,i,r){return this._view.elevationProvider.getElevation(e,i,0,this.spatialReference,r)}async queryElevation(e,i,r,s,n){return this._view.elevationProvider.queryElevation(e,i,0,this.spatialReference,n,r,s)}},AEt=class{constructor(e,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(Mt.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(lu);else for(const i of this._queries)i.result.reject(Di())}queryElevation(e,i,r,s=0){const n=ra(),o={x:e,y:i,minDemResolution:s,result:n,signal:r};return this._queries.push(o),Io(r,()=>{t1e(this._queries,o),n.reject(Di())}),n.promise}get running(){return this._queries.length>0}runTask(e){const i=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return i.forEach(u=>u.result.reject()),void e.madeProgress();const s=i.map(u=>[u.x,u.y]),n=i.reduce((u,d)=>Math.min(u,d.minDemResolution),1/0),o=new $A({points:s,spatialReference:this.spatialReference}),a=i.length>1&&i.some(u=>!!u.signal)?new AbortController:null,l=a!=null?a.signal:i[0].signal;if(a!=null){let u=0;i.forEach(d=>Io(d.signal,()=>{u++,d.result.reject(Di()),u===i.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};r.queryElevation(o,c).then(u=>{i.forEach((d,p)=>{d.signal!=null&&d.signal.aborted?d.result.reject(Di()):d.result.resolve(u.geometry.points[p][2])})}).catch(u=>{i.forEach(d=>d.result.reject(u))}),e.madeProgress()}get test(){}},xV=class{constructor(e=1/0,i=-1/0){this.elevationRangeMin=e,this.elevationRangeMax=i}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(e,i){this.elevationRangeMin=Math.min(this.elevationRangeMin,e),this.elevationRangeMax=Math.max(this.elevationRangeMax,i)}expandElevationRange(e){this.elevationRangeMin=Math.min(this.elevationRangeMin,e.elevationRangeMin),this.elevationRangeMax=Math.max(this.elevationRangeMax,e.elevationRangeMax)}setElevationRange(e){this.elevationRangeMin=e.elevationRangeMin,this.elevationRangeMax=e.elevationRangeMax}},KR=class extends cn.EventedMixin(Re){get spatialReference(){var e,i;return(i=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:i.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this._cacheEnabled=!1}destroy(){this._cachedQuery=Le(this._cachedQuery)}enableCache(e){e||(this.lastElevationQuery=null),this._cacheEnabled=e}getElevation(e,i,r,s,n){if(this._cacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&i===a.y&&r===a.z&&gs(s,a.spatialReference)&&n===a.queryContext)return a.result}let o=null;return o=RF(o,this._im,e,i,r,s,n),o==null&&(o=RF(o,this._ground,e,i,r,s,n)),n==="scene"&&(o=RF(o,this._scene,e,i,r,s,n)),this._cacheEnabled&&(this.lastElevationQuery={x:e,y:i,z:r,spatialReference:s,queryContext:n,result:o}),o}getSphereElevationBounds(e,i,r){const s=new xV;function n(o){for(const a of o)if(a.getSphereElevationBounds){const l=a.getSphereElevationBounds(e,i,r);l!=null&&s.expandElevationRangeValues(l.elevationRangeMin,l.elevationRangeMax)}}return n(this._ground),n(this._im),r==="scene"&&n(this._scene),s}getRootElevationBounds(){const e=new xV;for(const i of[this._im,this._ground,this._scene])i.forEach(r=>{if(r.getRootElevationBounds){const s=r.getRootElevationBounds();s!=null&&e.expandElevationRangeValues(s.elevationRangeMin,s.elevationRangeMax)}});return e}async queryElevation(e,i,r,s,n,o=null,a=0){const l=this._getElevationQuery(s);try{const c=await l.queryElevation(e,i,o,a);return n==="scene"?RF(c,this._scene,e,i,r,s,n):c}catch(c){return Pn(c),this.getElevation(e,i,r,s,n)}}register(e,i){this.addHandles(i.on("elevation-change",r=>this.emit("elevation-change",r)),i),this._providersFromContext(e).push(i)}unregister(e){this.removeHandles(e);for(const i of[this._im,this._ground,this._scene]){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){const i=this._cachedQuery;if(i!=null&&gs(e,i.spatialReference))return i;i==null||i.destroy({completeTasks:!0});const{wkid:r,wkt:s,wkt2:n,latestWkid:o}=e,a=new AEt(this.view.resourceController.scheduler,new We({wkid:r,wkt:s,wkt2:n,latestWkid:o}),()=>{var l;return(l=this.view.map)==null?void 0:l.ground},{maximumAutoTileRequests:4});return this._cachedQuery=a,a}};function RF(t,e,i,r,s,n,o){for(const a of e){const l=a.getElevation(i,r,s,n,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}h([f({constructOnly:!0})],KR.prototype,"view",void 0),h([f()],KR.prototype,"spatialReference",null),KR=h([I("esri.views.3d.support.CombinedElevationProvider")],KR);let C3=class lJ{static isValidProfile(e){return e in lJ.profiles}static getDefaultProfile(){return re("esri-iPhone")?"low":"medium"}static apply(e,i){const r=lJ.profiles[e];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxNumberOfDrawCalls=r.graphics3D.maxNumberOfDrawCalls,i.graphics3D.maxTotalNumberOfVertices=r.graphics3D.maxTotalNumberOfVertices,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,i.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods,i.graphics3D.uncompressedTextureDownsamplingEnabled=r.graphics3D.uncompressedTextureDownsamplingEnabled;const s=i.sceneService.object,n=r.sceneService.object;s.lodFactor=n.lodFactor,i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.vtlContentZoom=r.tiledSurface.vtlContentZoom,i.tiledSurface.elevationLevelDelta=r.tiledSurface.elevationLevelDelta,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.fadeDuration=r.fadeDuration,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.highResolutionAtmosphere=r.highResolutionAtmosphere,i.reflections=r.reflections,i.ambientOcclusion=r.ambientOcclusion,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumPixelRatio=r.maximumPixelRatio}};C3.test={reset(){const t=ADe();for(const e of Object.keys(t))C3.profiles[e]=t[e]}};const uO={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function ADe(){const t=!!re("esri-mobile"),e=!!re("ios"),i=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,elevationLevelDelta:3,reduceTileLevelDifferences:!0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+uO.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:3,reduceTileLevelDifferences:!re("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600+uO.GalaxyS20:750+uO.FullHD,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:2,reduceTileLevelDifferences:!re("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900+uO.SurfacePro7:1500+uO.FullHDRetina,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}(function(t){t.profiles=ADe()})(C3||(C3={}));const J5=C3,PDe=new Oe([0,255,255]),ODe=1,RDe=.25,$De=new Oe([0,0,0]),IDe=.4,LDe=.2;let Mm=class extends Re{constructor(){super(...arguments),this.color=PDe.clone(),this.haloColor=null,this.haloOpacity=ODe,this.fillOpacity=RDe,this.shadowOpacity=IDe,this.shadowColor=$De.clone(),this.shadowDifference=LDe}};h([f({type:Oe})],Mm.prototype,"color",void 0),h([f({type:Oe})],Mm.prototype,"haloColor",void 0),h([f()],Mm.prototype,"haloOpacity",void 0),h([f()],Mm.prototype,"fillOpacity",void 0),h([f()],Mm.prototype,"shadowOpacity",void 0),h([f({type:Oe})],Mm.prototype,"shadowColor",void 0),h([f()],Mm.prototype,"shadowDifference",void 0),Mm=h([I("esri.views.3d.support.HighlightOptions")],Mm);const DDe=Mm;function PEt(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function OEt(t){return typeof t=="string"?Ns(t):Q(t)}function REt(t,e,i){const r={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n))r[s]=n.map(o=>REt(o));else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(i==null?void 0:i[s]);r[s]=JSON.stringify(o)}else r[s]=JSON.stringify(n);else r[s]=n}return r}function EQt(t){return{geometryType:xee(t[0]),geometries:t.map(e=>e.toJSON())}}function $Et(t,e,i){const r=jje(e);return t.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}let ix=class extends ye{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),i=this.geometries[0],r={};return r.outSR=cae(this.outSpatialReference),r.inSR=cae(i.spatialReference),r.geometries=JSON.stringify({geometryType:xee(i),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};h([f()],ix.prototype,"geometries",void 0),h([f({json:{read:{source:"outSR"}}})],ix.prototype,"outSpatialReference",void 0),h([f()],ix.prototype,"transformation",void 0),h([f()],ix.prototype,"transformForward",void 0),ix=h([I("esri.rest.support.ProjectParameters")],ix);const Rse=ix,IEt=Ln(Rse);async function NDe(t,e,i){e=IEt(e);const r=OEt(t),s={...r.query,f:"json",...e.toJSON()},n=e.outSpatialReference,o=xee(e.geometries[0]),a=PEt(s,i);return Yt(r.path+"/project",a).then(({data:{geometries:l}})=>$Et(l,o,n))}async function $se(t=null,e){var s,n;if(lr.geometryServiceUrl)return lr.geometryServiceUrl;if(!t)throw new V("internal:geometry-service-url-not-configured");let i;i="portal"in t?t.portal||No.getDefault():t,await i.load({signal:e});const r=(n=(s=i.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!r)throw new V("internal:geometry-service-url-not-configured");return r}async function LEt(t,e,i=null,r){const s=await $se(i,r),n=new Rse({geometries:[t],outSpatialReference:e}),o=await NDe(s,n,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new V("internal:geometry-service-projection-failed")}const DEt=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:$se,projectGeometry:LEt},Symbol.toStringTag,{value:"Module"}));let NEt=class{constructor(e,i){this.spatialReference=i,this.unitInMeters=Gl(this.spatialReference,ur(this.spatialReference).metersPerDegree);const r=e&&"portalItem"in e?e.portalItem:void 0;this._geometryServiceURLPromise=$se(r).catch(()=>{throw new V("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const i=await this._geometryServiceURLPromise;let r,s=!0;Array.isArray(e[0])&&typeof e[0]!="number"?r=e:(r=[e],s=!1);const n=r.map(l=>l instanceof _t?l:new _t(l,this.spatialReference)),o=new Rse({geometries:n,outSpatialReference:We.WGS84}),a=(await NDe(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}};var jt;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(jt||(jt={}));const rx=[jt.ELEVATION,jt.MAP];async function FEt(t,e){if(t.type==="2d")return t.hitTest(e);const i=await t.hitTest(e);if(i.results.length===0)return i;const r=i.results[0],s=(r.distance??0)*(1+kEt),n=i.results.findIndex(o=>(o.distance??0)>s);return n!==-1&&(i.results=i.results.slice(0,n)),r&&i.ground.distance>s&&(i.ground.mapPoint=null),i}const kEt=.05;async function UEt(t,e){var p,m,g,y,v;const{results:i,ground:r}=await FEt(t,e),s=(!r.layer||!WI(r.layer.type))&&r.mapPoint,n=[],o=BEt(t),a=s?zEt(t,o):VEt;let l=0,c=0;const u=()=>{const b=a.layerViews[c];s&&b&&"fetchPopupFeaturesAtLocation"in b&&n.push({mapPoint:r.mapPoint,layerView:b}),++c};let d=null;for(;l<i.length||c<a.layerViews.length;){const b=i[l];if(b&&b.type!=="graphic")++l;else if(((p=b==null?void 0:b.layer)==null?void 0:p.type)!=="scene"||((m=b==null?void 0:b.layer)==null?void 0:m.parent)!==((g=t==null?void 0:t.map)==null?void 0:g.basemap))if(b){const w=(y=b.layer)==null?void 0:y.uid,x=a.layerUids.has(w)&&b.distance===r.distance,T=o.get((v=b.layer)==null?void 0:v.uid);if(d??(d=b.mapPoint),c<a.layerViews.length&&(x||(b.distance??0)>r.distance)&&a.layerViews[c]!==T){u();continue}n.push({graphic:b.graphic,layerView:T}),++l}else u();else++l}return d??(d=r.mapPoint),{hits:n,location:d}}function zEt(t,e){const i=new Set,r=[];for(let n=t.basemapTerrain.numLayers(jt.MAP)-1;n>=0;n--){const o=t.basemapTerrain.layerViewByIndex(n,jt.MAP);i.add(o.layer.uid),r.push(o)}const s=t.basemapTerrain.overlayManager.renderer.layers;for(const{uid:n}of s){const o=e.get(n);o&&(i.add(n),r.push(o))}return r.reverse(),{layerUids:i,layerViews:r}}const VEt={layerUids:new Set,layerViews:[]};function BEt(t){const e=new Map;for(const i of t.allLayerViews){const r=i.layer.uid;e.set(r,i)}return e}let Ku=class extends Re{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};h([f()],Ku.prototype,"minTotalNumberOfFeatures",void 0),h([f()],Ku.prototype,"maxTotalNumberOfFeatures",void 0),h([f()],Ku.prototype,"maxNumberOfDrawCalls",void 0),h([f()],Ku.prototype,"maxTotalNumberOfVertices",void 0),h([f()],Ku.prototype,"snapshotAvailable",void 0),h([f()],Ku.prototype,"polygonLodFactor",void 0),h([f()],Ku.prototype,"polylineLodFactor",void 0),h([f()],Ku.prototype,"skipHighSymbolLods",void 0),h([f()],Ku.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Ku=h([I("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Ku);let df=class extends Re{constructor(){super(...arguments),this.lodFactor=1}};h([f()],df.prototype,"lodFactor",void 0),df=h([I("esri.views.3d.support.QualitySettings.LoDFactorSettings")],df);let Hy=class extends Re{constructor(){super(...arguments),this.object=new df,this.point=new df,this.integratedMesh=new df,this.pointCloud=new df,this.uncompressedTextureDownsamplingEnabled=!1}};h([f({type:df})],Hy.prototype,"object",void 0),h([f({type:df})],Hy.prototype,"point",void 0),h([f({type:df})],Hy.prototype,"integratedMesh",void 0),h([f({type:df})],Hy.prototype,"pointCloud",void 0),h([f()],Hy.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Hy=h([I("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Hy);let qy=class extends Re{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.elevationLevelDelta=3,this.reduceTileLevelDifferences=!0}};h([f()],qy.prototype,"lodBias",void 0),h([f()],qy.prototype,"angledSplitBias",void 0),h([f()],qy.prototype,"vtlContentZoom",void 0),h([f()],qy.prototype,"elevationLevelDelta",void 0),h([f()],qy.prototype,"reduceTileLevelDifferences",void 0),qy=h([I("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],qy);let xC=class extends Re{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};h([f()],xC.prototype,"pixelRatio",void 0),h([f()],xC.prototype,"maxTotalNumberOfFeatures",void 0),xC=h([I("esri.views.3d.support.QualitySettings.HeatmapSettings")],xC);let ca=class extends Re{constructor(){super(...arguments),this.graphics3D=new Ku,this.sceneService=new Hy,this.tiledSurface=new qy,this.heatmap=new xC,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};h([f({type:Ku})],ca.prototype,"graphics3D",void 0),h([f({type:Hy})],ca.prototype,"sceneService",void 0),h([f({type:qy})],ca.prototype,"tiledSurface",void 0),h([f({type:xC})],ca.prototype,"heatmap",void 0),h([f()],ca.prototype,"fadeDuration",void 0),h([f()],ca.prototype,"antialiasingEnabled",void 0),h([f()],ca.prototype,"physicallyBasedRenderingEnabled",void 0),h([f()],ca.prototype,"highQualityTransparency",void 0),h([f()],ca.prototype,"highResolutionAtmosphere",void 0),h([f()],ca.prototype,"reflections",void 0),h([f()],ca.prototype,"ambientOcclusion",void 0),h([f()],ca.prototype,"memoryLimit",void 0),h([f()],ca.prototype,"additionalCacheMemory",void 0),h([f()],ca.prototype,"frameRate",void 0),h([f()],ca.prototype,"maximumPixelRatio",void 0),ca=h([I("esri.views.3d.support.QualitySettings")],ca);const kge=ca;let GEt=class cJ{constructor(e,i,r,s){this.viewingMode=e,this.spatialReference=i,this.unitInMeters=r,this._coordinateSystem=s,this._tmpCoordinateSystem=_7e(s),this.referenceEllipsoid=ur(i),this.sphericalPCPF=xu(i)}set extent(e){e&&v7e(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return M7e(this._coordinateSystem,e)}setAltitude(e,i,r=e){return PTe(this._coordinateSystem,r,i,e)}setAltitudeOfTransformation(e,i){A7e(this._coordinateSystem,i,e,i)}worldUpAtPosition(e,i){return S7e(this._coordinateSystem,e,i)}worldBasisAtPosition(e,i,r){return T7e(this._coordinateSystem,e,i,r)}basisMatrixAtPosition(e,i){const r=this.worldBasisAtPosition(e,hs.X,Ye.get()),s=this.worldBasisAtPosition(e,hs.Y,Ye.get()),n=this.worldBasisAtPosition(e,hs.Z,Ye.get());return Rg(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}headingAtPosition(e,i){const r=this.worldUpAtPosition(e,Ye.get()),s=this.worldBasisAtPosition(e,hs.Y,Ye.get()),n=rTe(i,s,r);return Ma(n)}intersectManifoldClosestSilhouette(e,i,r){return y6(this._coordinateSystem,i,this._tmpCoordinateSystem),C7e(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,i,r){y6(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=Ye.get();return E7e(this._tmpCoordinateSystem,e,s)?ce(r,s):null}intersectInfiniteManifold(e,i,r){if(this.viewingMode===Ge.Global)return this.intersectManifold(e,i,r);y6(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=Ye.get();return vT(s.plane,e,n)?ce(r,n):null}toRenderCoords(e,i,r){return nz(e)?il(e,i,this.spatialReference):Zn(e,i,r,this.spatialReference)}fromRenderCoords(e,i,r=null){return nz(i)?(r!=null&&(i.spatialReference=r),ob(e,this.spatialReference,i)?i:null):Zn(e,this.spatialReference,i,r)?i:null}static create(e,i){switch(e){case Ge.Local:return new cJ(Ge.Local,i,Gl(i),x7e());case Ge.Global:return new cJ(Ge.Global,i,1,w7e(i))}}static renderUnitScaleFactor(e,i){return hae(e)/hae(i)}};var Xm;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(Xm||(Xm={}));const jEt=(()=>{const t=new Array;return t[Xm.ELEVATION]=10,t[Xm.BASEMAP]=10,t[Xm.I3S_INDEX]=10,t[Xm.I3S_DATA]=10,t[Xm.SYMBOLOGY]=5,t})(),HEt=30;function qEt(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function WEt(t){return new xl({view:t})}const Uge=.1,$F=1,nq=1,YEt=.75,ZEt=.6,zge=1.3;let xl=class extends Re{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new CIe,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles(RS({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality($F),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,i){return new Igt(e,this._cacheStorage,i)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();this._memoryPredicted<ZEt&&this._canFastRecover?(this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality($F)):e?(this._memoryPredicted>1.1*nq||this._usedMemory>nq)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>Uge&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/zge),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1)):(this._downscaleMemoryUsed=0,this._usedMemory>nq?(this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/zge),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(this._usedMemory<YEt&&this._quality<$F?(this._stableQuality=this._quality,e=this._updateQuality(this._quality+.05)):this._quality<1&&(this._canFastRecover=!0))),this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,Uge),$F))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){var a,l,c,u,d;if(!this.view)return;(l=(a=this.view._stage)==null?void 0:a.renderer)==null||l.tick();const e=(u=(c=this.view._stage)==null?void 0:c.renderer)==null?void 0:u.usedMemory;let i=(((d=this.view.basemapTerrain)==null?void 0:d.usedMemory)??0)+(e?e.fbos+e.edges+e.plugins:0),r=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(p=>{if(qEt(p)){const m=p.ignoresMemoryFactor?this._quality:1;i+=p.usedMemory*m,r+=p.unloadedMemory*m}});const s=this._warnMemoryUsage==null||Math.round(10*i)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(i>n&&s){this._warnMemoryUsage=i;const p=g=>(g/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",m=Math.round(100*this._quality);ie.getLogger(this).warn(`Memory Limit exceeded! Limit: ${p(n)} Current: ${p(i)} Projected: ${p(i+r)} Quality: ${m}%`)}this._usedMemory=i/n,this._memoryPredicted=(i+r)/n;const o=n-i;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){}};h([f({constructOnly:!0})],xl.prototype,"view",void 0),h([f()],xl.prototype,"maxMemory",null),h([f()],xl.prototype,"additionalCacheMemory",null),h([f({readOnly:!0})],xl.prototype,"memoryFactor",null),h([f({readOnly:!0})],xl.prototype,"updating",null),h([f({readOnly:!0})],xl.prototype,"usedMemory",null),h([f({readOnly:!0})],xl.prototype,"usedCacheMemory",null),h([f()],xl.prototype,"_quality",void 0),h([f()],xl.prototype,"_usedMemory",void 0),h([f()],xl.prototype,"_updating",void 0),h([f()],xl.prototype,"_stableQuality",void 0),h([f()],xl.prototype,"_maxMemory",void 0),h([f()],xl.prototype,"_additionalCacheMemory",void 0),xl=h([I("esri.views.3d.support.MemoryController")],xl);let XEt=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},JEt=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new QEt}},QEt=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},KEt=class{constructor(e,i,r,s){this._workerFunc=e,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new JEt(n))}destroy(){this._clients.length=0}hasQuota(e){const i=this._clients[e];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(e){const i=this._clients[e.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(r,s)=>this._taskCallback(r,s))):i.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const i=this._clients[e.client];this._totalNumWorkers--,i&&(i.numWorkers--,i.statistics.requests++,i.statistics.size+=e.size||0,i.statistics.duration+=e.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,ft(i.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,i){e._cancelled||(this._callbackFunc(e,i),this._taskFinished(e))}getStatsForType(e){const i=this._clients[e];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){}},eCt=class{constructor(e,i){this.element=e,this.type="image+type",this.isOpaque=i==="image/jpeg"}};function EE(t){return t!=null&&"type"in t&&t.type==="vector-tile"}function FDe(t){return t!=null&&"type"in t&&t.type==="raster-tile"}function kDe(t){return t!=null&&"type"in t&&t.type==="tile-texture"}function bj(t){return t!=null&&"type"in t&&t.type==="image+type"}let Q5=class extends Re{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,i,r){this._loadQueue=new KEt((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,i),r&&(this._frameTask=r.registerTask(Mt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Or(this._frameTask),this._tasks.forEach(e=>Ul(e.abortController)),this._loadQueue=Le(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,i,r,s={}){const n=ra();n.__signal=s!=null?s.signal:null;const o=this._createOrUpdateTask(e,i,r,s,n);return Io(s,()=>this._cancelRequest(o,n)),n.promise}_createTask(e,i,r,s,n,o){const a=new rCt(e,i,r,s,n);return this._updateTask(a,o),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,i){var r;PI(e.resolvers,i),i.reject(Di()),e.resolvers.length===0&&(e.status===ld.DOWNLOADING&&(e.status=ld.CANCELLED,this._loadQueue.cancel(e),(r=e.abortController)==null||r.abort(),e.request=null,e.abortController=null),e.status=ld.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,i){e.resolvers.push(i)}_createOrUpdateTask(e,i,r,s,n){const o=sCt((s==null?void 0:s.uid)||e,i,r),a=this._tasks.get(o);return a?(this._updateTask(a,n),a):this._createTask(e,s,i,r,o,n)}_doneLoadingCB(e,i){this._loadQueue&&(ft(e.status===ld.DOWNLOADING),e.status=ld.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:i}):this._doneLoading(e,i))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const i=this._onLoadQueue.shift();Et(i.task.abortController),i.task.abortController=null,i.callback(i.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const i=this._doneQueue.shift();i.task.status!==ld.DOWNLOADED&&(i.err=i.err||Di()),this._doneLoading(i.task,i.err),e.madeProgress()}}_doneLoading(e,i){if(i&&!ms(i)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=bj(e.result)||e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(i)ms(i)?s.reject(i):s.reject(new V("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${i}`,{url:e.url,error:i}));else{--r;const n=r>0?Q(e.result):e.result;s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,i){if(e.status===ld.CANCELLED)return!1;let r,s;switch(e.startTime=performance.now(),e.status=ld.DOWNLOADING,e.docType){case"binary":s="array-buffer",r=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=Yt(e.url,{...e.options,responseType:s,timeout:r,signal:n});const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:i,task:e}):(e.abortController=null,i(e))},a=l=>{e.status===ld.DOWNLOADING&&i(e,l)};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,u=iCt(c);if(s="image",e.size=c.byteLength,u==="unknown")return e.request=Yt(e.url,{responseType:s,timeout:r,signal:n}),void e.request.then(m=>o(m.data),a);const d=new Blob([c],{type:u}),p=window.URL.createObjectURL(d);e.request=Yt(p,{responseType:s,timeout:r,signal:n}),e.request.then(m=>o(new eCt(m.data,u)),a).finally(()=>window.URL.revokeObjectURL(p))},a),!0)}get test(){}};h([f({readOnly:!0})],Q5.prototype,"updating",void 0),Q5=h([I("esri.views.3d.support.StreamDataLoader")],Q5);const tCt={numRetries:0};function iCt(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let rCt=class extends XEt{constructor(e,i,r,s,n){super(s),this.url=e,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=ld.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=tCt.numRetries}};function sCt(t,e,i){return`${t}:${e}:${i}`}var ld;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(ld||(ld={}));let K5=class extends Re{constructor(){super(...arguments),this.updating=!1}};function nCt(t){return new Pp({view:t})}h([f({readOnly:!0})],K5.prototype,"updating",void 0),K5=h([I("esri.views.3d.support.ResourceController.ResourceControllerMain")],K5);let Pp=class extends K5{constructor(){super(...arguments),this._immediateTask=tA,this._normalTask=tA,this._updatingObjects=hg([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=cst(),this._memoryController=WEt(this.view),this._streamDataLoader=new Q5,this._streamDataLoader.setup(HEt,jEt,this._scheduler),this.addHandles([ue(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},ar),ue(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=RS({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(Mt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(Mt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Or(this._frameTask),this._streamDataLoader=Le(this._streamDataLoader),this._memoryController=Le(this._memoryController),this._scheduler=Le(this._scheduler),this.view=null}get updating(){var e,i,r,s;return!!((e=this._memoryController)!=null&&e.updating||(i=this._streamDataLoader)!=null&&i.updating||(r=this._immediateTask)!=null&&r.updating)||((s=this._updatingObjects)==null?void 0:s.value.some(n=>n.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const i=this._streamDataLoader;return{request:(r,s,n)=>i.request(r,s,e,n),get busy(){return!i.hasDownloadSlots(e)}}}addUpdatingObject(e){const i=this._updatingObjects;return i.value=[...i.value,e],Ni(()=>{i.value=i.value.filter(r=>r!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(jK(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.updateBudget(e)&&this._scheduler.frame())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){}};h([f()],Pp.prototype,"view",void 0),h([f()],Pp.prototype,"_scheduler",void 0),h([f()],Pp.prototype,"_memoryController",void 0),h([f()],Pp.prototype,"_streamDataLoader",void 0),h([f()],Pp.prototype,"_immediateTask",void 0),h([f()],Pp.prototype,"_normalTask",void 0),h([f()],Pp.prototype,"_updatingObjects",void 0),h([f({readOnly:!0})],Pp.prototype,"updating",null),Pp=h([I("esri.views.3d.support.ResourceController")],Pp);var SV;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(SV||(SV={}));let jQt=class{constructor(e,i=0,r=0,s=0,n=0,o=null){this.usedMemory=e,this.displayedFeatures=i,this.totalFeatures=r,this.maximumFeatures=s,this.nodes=n,this.core=o}};function oCt(t){return"performanceInfo"in t}let aCt=class{constructor(e){this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer;const i=e.performanceInfo;this.memory=i.usedMemory,this.displayedNumberOfFeatures=i.displayedFeatures,this.maximumNumberOfFeatures=i.maximumFeatures,this.totalNumberOfFeatures=i.totalFeatures}},lCt=class{constructor(e){var i,r,s,n;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,e.resourceController!=null){const o=e.resourceController.memoryController;this.totalMemory=(o.maxMemory??0)*SV.MEGABYTES,this.usedMemory=Math.round(o.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=o.usedCacheMemory}this.terrainMemory=((i=e.basemapTerrain)==null?void 0:i.usedMemory)??0,this.edgesMemory=((r=e._stage)==null?void 0:r.renderer.usedMemory.edges)??0,this.fboMemory=((s=e._stage)==null?void 0:s.renderer.usedMemory.fbos)??0,(n=e.allLayerViews)==null||n.items.forEach(o=>{oCt(o)&&this.layerPerformanceInfos.push(new aCt(o))}),this.layerPerformanceInfos.sort((o,a)=>a.memory-o.memory)}},cCt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,i,r){const s=r?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return n!=null?Promise.resolve(n):Vge(this._gltfLoading,this._gltfMemCache,s,o=>_Le(new gLe(o.streamDataRequester),e,o,r),i)}loadWOSR(e,i){const r=`wosr:${e}:${i.disableTextures}`,s=this._wosrMemCache.get(r);return s!=null?Promise.resolve(s):Vge(this._wosrLoading,this._wosrMemCache,r,n=>vLe(e,n),i)}};async function Vge(t,e,i,r,s){Et(s);const n=Io(s,()=>uCt(t,i));let o=t.get(i);if(o)o.refCount++;else{const a=new AbortController;o={refCount:1,abortController:a,promise:r({...s,signal:a.signal})},t.set(i,o)}try{const a=await o.promise;return e.put(i,a,a.size),t.delete(i),Et(s),a}finally{Or(n)}}function uCt(t,e){const i=t.get(e);i!=null&&--i.refCount>0||(t.delete(e),i!=null&&i.abortController.abort())}let SC=class extends Re{constructor(e,i){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(i==null?void 0:i.registerTask(Mt.TEXTURE_UNLOAD))??tA}normalizeCtorArgs(){return{}}destroy(){var e,i,r;super.destroy(),(e=this._frameTask)==null||e.remove(),(i=this._textureRequests)==null||i.forEach(s=>this._releaseTextureRequest(s)),(r=this._textureRequests)==null||r.clear()}get updating(){return this._frameTask.updating}fromData(e,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);if(!s){const n=new zDe;n.texture=i(),this._stage&&(n.texture.load(this._stage.renderView.renderingContext),this._stage.add(n.texture)),this._textureRequests.set(r,n),s=n}return s.referenceCount++,new UDe(r,s.texture,()=>this._release(r))}_release(e){const i=this._textureRequests.get(e);i?(i.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),i.referenceCount--,i.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){}_releaseNow(e){var r;if(!this._textureRequests)return;const i=this._textureRequests.get(e);!i||i.referenceCount>0||((r=i.texture)==null||r.unload(),this._releaseTextureRequest(i),this._textureRequests.delete(e))}_releaseTextureRequest(e){var i;e.texture?(i=this._stage)==null||i.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,i=null){return i!=null?`${e}.${i}px`:e}};h([f()],SC.prototype,"_frameTask",void 0),h([f()],SC.prototype,"updating",null),SC=h([I("esri.views.3d.support.TextureCollection")],SC);let UDe=class{constructor(e,i,r){this.uid=e,this.texture=i,this.release=r}},zDe=class{constructor(){this.referenceCount=0}},hCt=class extends SC{constructor(e,i,r){super(i,r),this._streamDataRequester=e}async fromUrl(e,i,r){Et(r);const s=r==null?void 0:r.signal,n=this.makeUid(e,i);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:a.signal});o=new zDe,o.abortController=a;const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async u=>{const d=this._createTexture(e,u,i);return c.texture=d,c.abortController=null,await d.load(this._stage.renderView.renderingContext),this._stage.add(d),new UDe(n,d,()=>this._release(n))},u=>{throw c.abortController=null,u})}o.referenceCount++;try{return await $1e(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(e,i,r){var n;const s={width:i.width,height:i.height,wrap:{s:bi.CLAMP_TO_EDGE,t:bi.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if($be(e)){if(r||i.width===0&&i.height===0){const o=i.width?i.height/i.width:1;r=r||64,o>1?(i.width=Math.round(r/o),i.height=r):(i.width=r,i.height=Math.round(r*o))}(n=this._stage.renderView)!=null&&n.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new J1(i,s)}},dCt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(Xm.SYMBOLOGY),this.objectResourceCache=new cCt((r,s)=>e.resourceController.memoryController.newCache(r,s)),this.textures=new hCt(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const i=ur(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=sOe(e.viewingMode,i),this.screenSizePerspectiveSettingsLabels=Fct(e.viewingMode,i)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return Ni();this._graphicsOwners.push(e);const i=ue(()=>{var r;return(r=e.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Ni(()=>{i.remove(),PI(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(i=>{var r;return((r=i.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Pg;const i=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([ue(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,i,ar),this._viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Le(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;IF.distance=e.centerOnSurfaceInfrequent.distance,IF.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(IF),this.screenSizePerspectiveSettingsLabels.update(IF),this._view._stage.renderView.requestRender()}get test(){}};const IF={distance:0,fovY:0};let CE=class{constructor(e,i,r=""){this.graphics=e,this._symbol=new Km({symbolLayers:new tt([new Yv({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new MT({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})])})}show(e,i){if(i==null)return;this.hide();const r=new _t({x:e[0],y:e[1],z:e[2],spatialReference:i});this._graphic=new Su({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},kv=class extends Re{constructor(e){super(e)}};h([f({constructOnly:!0})],kv.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],kv.prototype,"surface",void 0),h([f({constructOnly:!0})],kv.prototype,"state",void 0),kv=h([I("esri.views.3d.support.pointsOfInterest.PointOfInterest")],kv);const pCt=Array;let Op=class extends kv{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new C0({location:_t,renderLocation:pCt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=E(),this._tmpPoint=new _t}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles(Ta(()=>{var i,r;return(r=(i=this.map)==null?void 0:i.ground)==null?void 0:r.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Le(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get scale(){const e=this._camera,i=wr(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return F1(r,i,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){var s;if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!((s=this.map)!=null&&s.ground))return this._updateSurfaceAltitude(0),ia;const e=this.state.spatialReference;this._tmpPoint.spatialReference=e,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);const i=(this._tmpPoint.z??0)>fCt&&this.renderCoordsHelper.viewingMode===Ge.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:i?mCt:0}).then(n=>this._updateSurfaceAltitude(n.geometry.z??0)).catch(n=>{ms(n)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,ia}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(oq,this._estimatedSurfaceAltitude,this._camera.eye),Oo(this._get("renderLocation"),oq)||(this._set("renderLocation",ce(this._propertiesPool.get("renderLocation"),oq)),this.notifyChange("renderLocation"))}};h([f({constructOnly:!0})],Op.prototype,"scheduler",void 0),h([f({constructOnly:!0})],Op.prototype,"cache",void 0),h([f({constructOnly:!0})],Op.prototype,"task",void 0),h([f()],Op.prototype,"location",null),h([f({constructOnly:!0})],Op.prototype,"map",void 0),h([f()],Op.prototype,"renderLocation",void 0),h([f()],Op.prototype,"scale",null),h([f()],Op.prototype,"updating",null),Op=h([I("esri.views.3d.support.pointsOfInterest.CameraOnSurface")],Op);const oq=E(),fCt=1e5,mCt=1e6,gCt=Array;let cd=class extends kv{constructor(e){super(e),this._propertiesPool=new C0({location:_t,renderLocation:gCt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=E(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Or(this._frameWorker),this._propertiesPool=Le(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,ia}_updateRenderLocation(){const e=_Ct;let i=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!i&&r&&(i=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),i&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=vCt;i&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(ce(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),i?this.distance=wr(this._camera.eye,e):(oe(e,this._camera.viewForward,this._get("distance")),me(e,e,this._camera.eye)),Oo(this._get("renderLocation"),e)||this._set("renderLocation",ce(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,i){var s,n;const r=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(r.ray,e,i))return!1;if(this.state.isGlobal){const o=ur(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=Za(r.eye),c=l<a*a,u=wr(r.eye,i);if(c&&u>o/4){const d=a-Math.sqrt(l);return oe(i,r.viewForward,d),me(i,i,r.eye),!0}}else{const o=(s=this.surface)!=null&&s.ready?this.surface.extent:null;o!=null&&AB(o,(n=this.surface)==null?void 0:n.spatialReference,hO,this.renderCoordsHelper.spatialReference)&&(i[0]=Te(i[0],hO[0],hO[2]),i[1]=Te(i[1],hO[1],hO[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,i){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,i)){if(Rr.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,s=wr(r,e),n=wr(r,i);if(Math.abs(n-s)/s>yCt)return!0}return!1}};h([f({constructOnly:!0})],cd.prototype,"scheduler",void 0),h([f({constructOnly:!0})],cd.prototype,"task",void 0),h([f()],cd.prototype,"distance",void 0),h([f({constructOnly:!0})],cd.prototype,"estimateSurfaceAltitudeAtCenter",void 0),h([f({readOnly:!0})],cd.prototype,"location",null),h([f({readOnly:!0})],cd.prototype,"renderLocation",void 0),h([f()],cd.prototype,"updating",void 0),cd=h([I("esri.views.3d.support.pointsOfInterest.CenterOnSurface")],cd);const yCt=.05,_Ct=E(),vCt=E(),hO=Ht();let bCt=class{constructor(e){this._handles=new Pg,this.events=new cn,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Le(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),e.removed.forEach(i=>this._handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",wCt)}};const wCt={},xCt=Array;let Rp=class extends kv{constructor(e){super(e),this._propertiesPool=new C0({location:_t,renderLocation:xCt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([ue(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),ue(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(Mt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Le(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get worldUnitsPerContentPixel(){const{camera:e,contentPixelRatio:i}=this.state;return e.computeRenderPixelSizeAt(this.renderLocation)*(e.pixelRatio/i)}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),i=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(i,Bge);const n=Math.max(0,(Math.acos(pe(Bge,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!LS(e,i)){const c=this._propertiesPool.get("renderLocation");ce(c,i),this._set("renderLocation",c)}return ia}const o=1-Te(n/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(Gge);const l=this._propertiesPool.get("renderLocation");return yr(l,i,Gge,a),e&&LS(e,l)||this._set("renderLocation",l),ia}_calculateScreenHorizontalEdgeOnSurface(e){const i=this.state.contentCamera,r=i.getRenderCenter(xa());if(r[1]=i.aboveGround?i.padding[ai.BOTTOM]:i.fullHeight-i.padding[ai.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(i.unprojectFromRenderScreen(r,dO)){ve(dO,dO,i.eye);const n=ge(dO,dO);if(this.renderCoordsHelper.intersectInfiniteManifold(Mh(i.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,i.eye)}updateRenderLocation(){this._dirty=!0}};h([f()],Rp.prototype,"_dirty",void 0),h([f({constructOnly:!0})],Rp.prototype,"scheduler",void 0),h([f({constructOnly:!0})],Rp.prototype,"centerOnSurface",void 0),h([f({constructOnly:!0})],Rp.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),h([f()],Rp.prototype,"updating",null),h([f()],Rp.prototype,"location",null),h([f()],Rp.prototype,"renderLocation",void 0),h([f()],Rp.prototype,"worldUnitsPerContentPixel",null),Rp=h([I("esri.views.3d.support.pointsOfInterest.Focus")],Rp);const Bge=E(),dO=E(),Gge=E();let Ey=class extends Re{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=E();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([ue(()=>{var e,i;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(i=this.surfaceView)==null?void 0:i.extent]},()=>this._update()),Ta(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}_update(){var r;if(this._updateController&&(this._updateController.abort(),this._updateController=null),((r=this.surfaceView)==null?void 0:r.extent)==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=_ee(this.surfaceView.extent),i=new _t({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(i,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(s=>{this._updateController=null,this._set("location",s.geometry)}).catch(s=>{})):this._set("location",i)}};h([f({constructOnly:!0})],Ey.prototype,"view",void 0),h([f({constructOnly:!0})],Ey.prototype,"cache",void 0),h([f()],Ey.prototype,"surface",null),h([f()],Ey.prototype,"surfaceView",null),h([f({readOnly:!0})],Ey.prototype,"location",void 0),h([f({readOnly:!0})],Ey.prototype,"renderLocation",null),Ey=h([I("esri.views.3d.support.pointsOfInterest.StableSurfaceCenter")],Ey);let Cy=class extends Re{constructor(e){super(e),this._tileGeometryUpdateExtent=Mc(),this._tileGeometryUpdateSpatialReference=null,this.events=new cn,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(Mt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",SCt),Mc(this._tileGeometryUpdateExtent),this._set("updating",!1)),ia}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,r1(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let i=1;i<this.centerOnSurfaces.length;i++){const r=this.centerOnSurfaces[i];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,i){const r=this.state.contentCamera.eye,s=TCt,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,ow,i),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,aw,i),ow[0]<aw[0]?(s[0]=ow[0],s[2]=aw[0]):(s[0]=aw[0],s[2]=ow[0]),ow[1]<aw[1]?(s[1]=ow[1],s[3]=aw[1]):(s[1]=aw[1],s[3]=ow[1]),X3(s,e)}};h([f({constructOnly:!0})],Cy.prototype,"state",void 0),h([f({constructOnly:!0})],Cy.prototype,"centerOnSurfaces",void 0),h([f({constructOnly:!0})],Cy.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],Cy.prototype,"scheduler",void 0),h([f({constructOnly:!0})],Cy.prototype,"surface",void 0),h([f({readOnly:!0})],Cy.prototype,"updating",void 0),Cy=h([I("esri.views.3d.support.pointsOfInterest.SurfaceGeometryUpdates")],Cy);const SCt={},ow=E(),aw=E(),TCt=Mc();let hc=class extends Re{constructor(e){super(e),this.renderPointOfView=E(),this._pois=new Array,this._debugCenters=new Map,this._tmpRay=uo(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new C0({renderPointOfView:ECt},this)}initialize(){var u;const{state:e,basemapTerrain:i,renderCoordsHelper:r,map:s}=this.view;this._surfaceIntersector=jd(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=ta.MIN,this._contentIntersector=jd(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(u=this.view.basemapTerrain)==null?void 0:u.elevationQueryCache,l={state:e,scheduler:o,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new cd({...l,task:Mt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new cd({...l,task:Mt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new cd({...l,task:Mt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new Op({...l,cache:a,task:Mt.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new Cy({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new bCt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new Ey({cache:a,view:this.view})),this._set("focus",new Rp({state:e,scheduler:o,surface:i,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(d,p)=>this._estimateSurfaceIntersectionAtRenderPoint(d,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new CE(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new CE(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new CE(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new CE(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new CE(c,"green","Focus")),this.addHandles([ue(()=>e.contentCamera,d=>this._cameraChanged(d),ar),ue(()=>i.extent,()=>this._updateCenterPointsOfInterest()),vu(()=>!i.updating,()=>this._updateCenterPointsOfInterest(),ar),Ta(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Ta(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),vu(()=>Rr.SHOW_POI,d=>this._setDebug(d),cr)]),this._cameraChanged(this.view.state.contentCamera);for(const d of this._pois)d.runTask()}destroy(){this._setDebug(!1),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(i=>i.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,O2,MCt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(O2):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const i=e.origin,r=me(O2,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,i,r),this._surfaceIntersector.results.min.getIntersectionPoint(O2)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(O2)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,i,r){const s=Yie(i,e,CCt);if(s==null)return null;const n=s.origin,o=me(O2,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,i),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,o),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const i=e.eye;Oo(this.renderPointOfView,i)||this._set("renderPointOfView",ce(this._propertiesPool.get("renderPointOfView"),i))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(i=>i.hide()),void this.removeHandles("debug");for(const i of this._pois)this.addHandles(ue(()=>i.renderLocation,r=>{var s;return(s=this._debugCenters.get(i))==null?void 0:s.show(r,i.renderCoordsHelper.spatialReference)},cr),"debug")}get test(){}};h([f()],hc.prototype,"centerOnContent",void 0),h([f()],hc.prototype,"centerOnSurfaceFrequent",void 0),h([f()],hc.prototype,"centerOnSurfaceInfrequent",void 0),h([f()],hc.prototype,"cameraOnSurface",void 0),h([f()],hc.prototype,"focus",void 0),h([f()],hc.prototype,"renderPointOfView",void 0),h([f()],hc.prototype,"surfaceOrigin",void 0),h([f()],hc.prototype,"contentGeometryUpdates",void 0),h([f()],hc.prototype,"surfaceGeometryUpdates",void 0),h([f({constructOnly:!0})],hc.prototype,"view",void 0),h([f()],hc.prototype,"updating",null),hc=h([I("esri.views.3d.support.pointsOfInterest.PointsOfInterest")],hc);const ECt=Array,O2=E(),CCt=uo(),MCt={exclude:new Set([N1])};let ACt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,i){this._store.put(e,i,i.values.byteLength+256)}};function MS(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function VDe(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function PCt(t,e,i,r,s,n,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function OCt(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:VDe,create:MS,createView:OCt,fromValues:PCt},Symbol.toStringTag,{value:"Module"}));var eu,I0,jge;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(eu||(eu={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(I0||(I0={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(jge||(jge={}));let Df=class sx{static getId(e,i,r,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${i}/${r}/${s}`}constructor(e,i,r,s){this.set(e,i,r,s)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(e){this.set(e)}get hash(){const e=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|e<<8|r}acquire(e,i,r,s){this.set(e,i,r,s)}contains(e){const i=e.level-this.level;return i>=0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}containsChild(e){const i=e.level-this.level;return i>0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new sx(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,i,r,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,o,a,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new sx(this.level-1,this.row>>1,this.col>>1,this.world)}getNeighborId(e,i){return`${this.level}/${this.row+i}/${this.col+e}/${this.world}`}getChildKeys(){const e=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new sx(e,i,r,s),new sx(e,i,r+1,s),new sx(e,i+1,r,s),new sx(e,i+1,r+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};Df.pool=new Ca(Df,null,null,25,50);function F_(t,e){return[t,e]}function lw(t,e,i){return t[0]=e,t[1]=i,t}function RCt(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}const mp=new Df("0/0/0/0");let $Ct=class BDe{static create(e,i,r=null){const s=c0(e.spatialReference),n=i.origin||F_(e.origin.x,e.origin.y),o=F_(e.size[0]*i.resolution,e.size[1]*i.resolution),a=F_(-1/0,-1/0),l=F_(1/0,1/0),c=F_(1/0,1/0);r!=null&&(lw(a,Math.max(0,Math.floor((r.xmin-n[0])/o[0])),Math.max(0,Math.floor((n[1]-r.ymax)/o[1]))),lw(l,Math.max(0,Math.floor((r.xmax-n[0])/o[0])),Math.max(0,Math.floor((n[1]-r.ymin)/o[1]))),lw(c,l[0]-a[0]+1,l[1]-a[1]+1));const{cols:u,rows:d}=i;let p,m,g,y;return!r&&u&&d&&(lw(a,u[0],d[0]),lw(l,u[1],d[1]),lw(c,u[1]-u[0]+1,d[1]-d[0]+1)),e.isWrappable?(p=F_(Math.ceil(Math.round((s.valid[1]-s.valid[0])/i.resolution)/e.size[0]),c[1]),m=F_(Math.floor((s.origin[0]-n[0])/o[0]),a[1]),g=F_(p[0]+m[0]-1,l[1]),y=!0):(m=a,g=l,p=c,y=!1),new BDe(i.level,i.resolution,i.scale,n,a,l,c,o,m,g,p,y)}constructor(e,i,r,s,n,o,a,l,c,u,d,p){this.level=e,this.resolution=i,this.scale=r,this.origin=s,this.first=n,this.last=o,this.size=a,this.norm=l,this.worldStart=c,this.worldEnd=u,this.worldSize=d,this.wrap=p}normalizeCol(e){if(!this.wrap)return e;const i=this.worldSize[0];return e<0?i-1-Math.abs((e+1)%i):e%i}denormalizeCol(e,i){return this.wrap?this.worldSize[0]*i+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,i,r=!1){mp.set(i);const s=r?mp.col:this.denormalizeCol(mp.col,mp.world),n=mp.row;return RCt(e,this.getXForColumn(s),this.getYForRow(n+1),this.getXForColumn(s+1),this.getYForRow(n)),e}getTileCoords(e,i,r=!1){mp.set(i);const s=r?mp.col:this.denormalizeCol(mp.col,mp.world);return Array.isArray(e)?lw(e,this.getXForColumn(s),this.getYForRow(mp.row)):(e.x=this.getXForColumn(s),e.y=this.getYForRow(mp.row)),e}},uJ=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}*keys(){const e=this.lodInfo;for(const{row:i,colFrom:r,colTo:s}of this.spans)for(let n=r;n<=s;n++){const o=e.getWorldForColumn(n);yield new Df(e.level,i,e.normalizeCol(n),o)}}forEach(e,i){const{spans:r,lodInfo:s}=this,{level:n}=s;if(r.length!==0)for(const{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++)e.call(i,n,o,s.normalizeCol(c),s.getWorldForColumn(c))}};uJ.pool=new Ca(uJ);let aq=class{constructor(e,i,r){this.row=e,this.colFrom=i,this.colTo=r}};const Js=new Df("0/0/0/0");let ICt=class GDe{static create(e,i){e[1]>i[1]&&([e,i]=[i,e]);const[r,s]=e,[n,o]=i,a=n-r,l=o-s,c=l!==0?a/l:0,u=(Math.ceil(s)-s)*c,d=(Math.floor(s)-s)*c;return new GDe(r,Math.floor(s),Math.ceil(o),c,a<0?u:d,a<0?d:u,a<0?n:r,a<0?r:n)}constructor(e,i,r,s,n,o,a,l){this.x=e,this.ymin=i,this.ymax=r,this.invM=s,this.leftAdjust=n,this.rightAdjust=o,this.leftBound=a,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const Nu=[[0,0],[0,0],[0,0],[0,0]],LCt=1e-6;let dKt=class{constructor(e,i=null,r=e.lods[0].level,s=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=i,this.scales=[],this._infoByScale={},this._infoByLevel={};const n=e.lods.filter(a=>a.level>=r&&a.level<=s);this.minScale=n[0].scale,this.maxScale=n[n.length-1].scale;const o=this._lodInfos=n.map(a=>$Ct.create(e,a,i));n.forEach((a,l)=>{this._infoByLevel[a.level]=o[l],this._infoByScale[a.scale]=o[l],this.scales[l]=a.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,i,r=!1){Js.set(i);const s=this._infoByLevel[Js.level];return s?s.getTileBounds(e,Js,r):e}getTileCoords(e,i,r=!1){Js.set(i);const s=this._infoByLevel[Js.level];return s?s.getTileCoords(e,Js,r):e}getTileCoverage(e,i=192,r=!0,s="closest"){if(!r&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const n=s==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),o=uJ.pool.acquire(n),a=this._wrap;let l,c,u,d=1/0,p=-1/0;const m=o.spans;Nu[0][0]=Nu[0][1]=Nu[1][1]=Nu[3][0]=-i,Nu[1][0]=Nu[2][0]=e.size[0]+i,Nu[2][1]=Nu[3][1]=e.size[1]+i;for(const b of Nu)e.toMap(b,b),b[0]=n.getColumnForX(b[0]),b[1]=n.getRowForY(b[1]);const g=[];let y=3;for(let b=0;b<4;b++){if(Nu[b][1]===Nu[y][1]){y=b;continue}const w=ICt.create(Nu[b],Nu[y]);d=Math.min(w.ymin,d),p=Math.max(w.ymax,p),g[w.ymin]===void 0&&(g[w.ymin]=[]),g[w.ymin].push(w),y=b}if(d==null||p==null||p-d>100)return null;let v=[];for(l=d;l<p;){g[l]!=null&&(v=v.concat(g[l])),c=1/0,u=-1/0;for(let b=v.length-1;b>=0;b--){const w=v[b];c=Math.min(c,w.getLeftCol()),u=Math.max(u,w.getRightCol())}if(c=Math.floor(c),u=Math.floor(u),l>=n.first[1]&&l<=n.last[1])if(a)if(n.size[0]<n.worldSize[0]){const b=Math.floor(u/n.worldSize[0]);for(let w=Math.floor(c/n.worldSize[0]);w<=b;w++)m.push(new aq(l,Math.max(n.getFirstColumnForWorld(w),c),Math.min(n.getLastColumnForWorld(w),u)))}else m.push(new aq(l,c,u));else c>n.last[0]||u<n.first[0]||(c=Math.max(c,n.first[0]),u=Math.min(u,n.last[0]),m.push(new aq(l,c,u)));l+=1;for(let b=v.length-1;b>=0;b--){const w=v[b];w.ymax>=l?w.incrRow():v.splice(b,1)}}return o}getTileParentId(e){Js.set(e);const i=this._infoByLevel[Js.level],r=this._lodInfos.indexOf(i)-1;return r<0?null:(this._getTileIdAtLOD(Js,this._lodInfos[r],Js),Js.id)}getTileResolution(e){const i=this._infoByLevel[typeof e=="object"?e.level:e];return i?i.resolution:-1}getTileScale(e){const i=this._infoByLevel[e.level];return i?i.scale:-1}intersects(e,i){Js.set(i);const r=this._infoByLevel[Js.level],s=e.lodInfo;if(s.resolution>r.resolution){this._getTileIdAtLOD(Js,s,Js);const o=s.denormalizeCol(Js.col,Js.world);for(const a of e.spans)if(a.row===Js.row&&a.colFrom<=o&&a.colTo>=o)return!0}if(s.resolution<r.resolution){const[o,a,l,c]=e.spans.reduce((y,v)=>(y[0]=Math.min(y[0],v.row),y[1]=Math.max(y[1],v.row),y[2]=Math.min(y[2],v.colFrom),y[3]=Math.max(y[3],v.colTo),y),[1/0,-1/0,1/0,-1/0]),u=r.denormalizeCol(Js.col,Js.world),d=s.getColumnForX(r.getXForColumn(u)),p=s.getRowForY(r.getYForRow(Js.row)),m=s.getColumnForX(r.getXForColumn(u+1))-1,g=s.getRowForY(r.getYForRow(Js.row+1))-1;return!(d>c||m<l||p>a||g<o)}const n=s.denormalizeCol(Js.col,Js.world);return e.spans.some(o=>o.row===Js.row&&o.colFrom<=n&&o.colTo>=n)}normalizeBounds(e,i,r){if(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this._wrap){const s=c0(this.tileInfo.spatialReference),n=-r*(s.valid[1]-s.valid[0]);e[0]+=n,e[2]+=n}return e}getSmallestInfoForScale(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>i[0])return this._infoByScale[i[0]];for(let r=1;r<i.length-1;r++)if(e>i[r]+LCt)return this._infoByScale[i[r-1]];return this._infoByScale[i[i.length-1]]}getClosestInfoForScale(e){const i=this.scales;return this._infoByScale[e]||(e=i.reduce((r,s)=>Math.abs(s-e)<Math.abs(r-e)?s:r,i[0])),this._infoByScale[e]}scaleToLevel(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=i.length-1;r>=0;r--)if(e<i[r])return r===i.length-1?this._infoByScale[i[i.length-1]].level:this._infoByScale[i[r]].level+(i[r]-e)/(i[r]-i[r+1]);return this._infoByScale[i[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}zoomToScale(e){return this.tileInfo.zoomToScale(e)}_getTileIdAtLOD(e,i,r){const s=this._infoByLevel[r.level];return e.set(r),i.resolution<s.resolution?null:(i.resolution===s.resolution||(e.level=i.level,e.col=Math.floor(r.col*s.resolution/i.resolution+.01),e.row=Math.floor(r.row*s.resolution/i.resolution+.01)),e)}},DCt=class{constructor(e,i){this.item=e,this.controller=i,this.promise=null}},NCt=class{constructor(e){this._schedule=null,this._task=null,this._deferreds=new y5,this._controllers=new y5,this._processingItems=new y5,this._pausedSignal=hg(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new NU(e.peeker),this.process=e.process;const i=e.scheduler;e.priority&&i&&(this._task=i.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=Or(this._schedule),this._task=Or(this._task)}get updating(){var e;return!!((e=this._task)!=null&&e.updating)||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const i=this._controllers.get(e);i&&i.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(i=>e.push(i)),this._controllers.clear(),e.forEach(i=>i.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((i,r)=>e(r))}get(e){const i=this._deferreds.get(e);return i?i.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,i){const r=this.get(e);if(r)return r;const s=new AbortController;let n=null;i&&(n=Io(i,()=>s.abort()));const o=()=>{const u=this._processingItems.get(e);u&&u.controller.abort(),a(),c.reject(Di())},a=()=>{l.remove(),n!=null&&n.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},l=QV(s.signal,o),c=ra();return this._deferreds.set(e,c),this._controllers.set(e,s),c.promise.then(a,a),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){var i;const e=this._queue.popLast();return e&&((i=this._deferreds.get(e))==null||i.reject(Di("Removed from queue")),this._removeItem(e)),e}reset(){const e=[];this._processingItems.forEach(i=>e.push(i)),this._processingItems.clear();for(const i of e)this._queue.push(i.item),i.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=hT(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(i))}_processError(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(i))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(e==null)return;let i;const r=new AbortController,s=new DCt(e,r);this._processingItems.set(e,s);try{i=this.process(e,r.signal)}catch(n){this._processError(s,n)}Cu(i)?(s.promise=i,i.then(n=>this._processResult(s,n),n=>this._processError(s,n))):this._processResult(s,i)}get test(){}};function FCt(t,e){return t.length=0,e.forEach(i=>t.push(i)),t}const lq=new Set,LF=[],R2=new Map,Hge=[0,0];let cw=class extends Re{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:i,strategy:r}=this;this._queue=new NCt({concurrency:e,process:(s,n)=>{const o=this._keyToItem.get(s);return i(o,{signal:n})},peeker:r==="scale-first"?s=>this._peekByScaleFirst(s):s=>this._peekByCenterFirst(s)})}destroy(){this.clear(),this._queue=Le(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear()}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const i=typeof e=="string"?e:e.id;return this.has(i)&&this._queue.isOngoing(i)}pause(){this._queue.pause()}push(e){const i=e.key.id;if(this._queue.has(i))return this._queue.get(i);const r=this._queue.push(i),s=()=>{this._keyToItem.delete(i)};return this._keyToItem.set(i,e),r.then(s,s),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView;let r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;e.forEach(u=>{const d=this._keyToItem.get(u),p=this.tileInfoView.getTileScale(d.key);R2.has(p)||(R2.set(p,[]),r=Math.max(p,r),s=Math.min(p,s)),R2.get(p).push(d.key),lq.add(p)});let n=this.state.scale;R2.has(n)||(FCt(LF,lq),LF.sort((u,d)=>u-d),n=LF.reduce((u,d)=>Math.abs(d-n)<Math.abs(u-n)?d:u,LF[0])),n=Math.min(n,r),n=Math.max(n,s);const o=R2.get(n),a=i.getClosestInfoForScale(n),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((u,d)=>{const p=a.denormalizeCol(u.col,u.world),m=a.denormalizeCol(d.col,d.world);return Math.sqrt((l-p)*(l-p)+(c-u.row)*(c-u.row))-Math.sqrt((l-m)*(l-m)+(c-d.row)*(c-d.row))}),lq.clear(),R2.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView,r=this.state.center;let s,n=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);i.getTileCoords(Hge,a.key);const l=V1(Hge,r);l<n&&(n=l,s=a.key)}),s.id}};h([f({constructOnly:!0})],cw.prototype,"concurrency",void 0),h([f({constructOnly:!0})],cw.prototype,"process",void 0),h([f()],cw.prototype,"state",void 0),h([f({constructOnly:!0})],cw.prototype,"strategy",void 0),h([f({constructOnly:!0})],cw.prototype,"tileInfoView",void 0),cw=h([I("esri.views.2d.tiling.TileQueue")],cw);new Df(0,0,0,0);let kCt=class{constructor(e,i){this.sourceTile=i,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},UCt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function qge(t,e,i,r,s,n){const o=i-s;if(o>=0)return(e>>o)+(r-(n<<o))*(t>>o);const a=-o;return e-(n-(r<<a))*(t>>a)<<a}let jDe=class{constructor(e,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(e,i,r,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function zCt(t,e,i,r,s,n,o){const a=e[r++];for(let l=0;l<a;l++){const c=new kCt(n,o);c.xTile=e[r++],c.yTile=e[r++],c.hash=e[r++],c.priority=e[r++],c.featureIndex=e[r++];const u=e[r++];for(let m=0;m<u;m++){const g=e[r++],y=e[r++],v=e[r++],b=e[r++],w=!!e[r++],x=e[r++],T=i[r++],C=i[r++],M=e[r++],O=e[r++];c.colliders.push({xTile:g,yTile:y,dxPixels:v,dyPixels:b,hard:w,partIndex:x,width:M,height:O,minLod:T,maxLod:C})}const d=t[r++];for(let m=0;m<d;m++)c.textVertexRanges.push([t[r++],t[r++]]);const p=t[r++];for(let m=0;m<p;m++)c.iconVertexRanges.push([t[r++],t[r++]]);s.push(c)}return r}function VCt(t,e,i){for(const[r,s]of t.symbols)BCt(t,e,i,s,r)}function BCt(t,e,i,r,s){const n=t.layerData.get(s);if(n.type===eu.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0];c.startOpacity;const u=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&u===0;const d=u?255:0;l=d<<24|d<<16|d<<8|d}else l=0;for(const[c,u]of o.iconVertexRanges)for(let d=c;d<c+u;d+=4)n.iconOpacity[d/4]=l;if(o.selectedForRendering){const c=a.parts[1];c.startOpacity;const u=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&u===0;const d=u?255:0;l=d<<24|d<<16|d<<8|d}else l=0;for(const[c,u]of o.textVertexRanges)for(let d=c;d<c+u;d+=4)n.textOpacity[d/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}function GCt(t,e,i,r){const s=t.colliders;let n,o,a,l;for(const c of s)if(t.unique.show&&t.unique.parts[c.partIndex].show&&(n=c.xScreen-r[0]+c.dxScreen,o=c.yScreen-r[1]+c.dyScreen,a=n+c.width,l=o+c.height,uvt(i,e.x,e.y,n,o,a,l)))return!0;return!1}let wj=class{constructor(e,i){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let r=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[r++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},jCt=class extends wj{constructor(e,i){super(e,i),this.type=eu.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=r[s++],l=r[s++],c=r[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){var e,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((i=this.vao)==null?void 0:i.usedMemory)??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=It(this.vao)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=vr.createVertex(e,rr.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=vr.createIndex(e,rr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=this.layer.lineMaterial;this.vao=new Of(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}},HCt=class extends wj{constructor(e,i){super(e,i),this.type=eu.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=r[s++],l=r[s++],c=r[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){var e,i,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((i=this.fillVAO)==null?void 0:i.usedMemory)??0)+(((r=this.outlineVAO)==null?void 0:r.usedMemory)??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=It(this.fillVAO),this.outlineVAO=It(this.outlineVAO)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=vr.createVertex(e,rr.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=vr.createIndex(e,rr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=s[r++],d=vr.createVertex(e,rr.STATIC_DRAW,new Int32Array(n.buffer,4*r,u));r+=u;const p=s[r++],m=vr.createIndex(e,rr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,p));r+=p;const g=this.layer,y=g.fillMaterial,v=g.outlineMaterial;this.fillVAO=new Of(e,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new Of(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:d},m)}},qCt=class extends wj{constructor(e,i,r){super(e,i),this.type=eu.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++],c=s[a++],u=s[a++],d=new Df(l,c,u,0),p=s[a++];for(let v=0;v<p;v++){const b=s[a++],w=s[a++],x=s[a++];this.iconPerPageElementsMap.set(b,[w,x])}const m=s[a++];for(let v=0;v<m;v++){const b=s[a++],w=s[a++],x=s[a++];this.glyphPerPageElementsMap.set(b,[w,x])}const g=s[a++],y=s[a++];this.iconOpacity=new Int32Array(g),this.textOpacity=new Int32Array(y),a=zCt(s,n,o,a,this.symbols,r,d),this.bufferDataOffset=a}get memoryUsed(){var e,i,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((i=this.iconVAO)==null?void 0:i.usedMemory)??0)+(((r=this.textVAO)==null?void 0:r.usedMemory)??0)+b0(this.iconOpacity)+b0(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[i,r]of this.iconPerPageElementsMap)e+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)e+=r[1];return e/3}doDestroy(){this.iconVAO=It(this.iconVAO),this.textVAO=It(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,i=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===i.usedMemory&&i.setSubData(e,0,0,e.length);const r=this.textOpacity,s=this.textVAO.vertexBuffers.opacity;r.length>0&&r.byteLength===s.usedMemory&&s.setSubData(r,0,0,r.length)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=vr.createVertex(e,rr.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=vr.createIndex(e,rr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=s[r++],d=vr.createVertex(e,rr.STATIC_DRAW,new Int32Array(n.buffer,4*r,u));r+=u;const p=s[r++],m=vr.createIndex(e,rr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,p));r+=p;const g=vr.createVertex(e,rr.STATIC_DRAW,this.iconOpacity.buffer),y=vr.createVertex(e,rr.STATIC_DRAW,this.textOpacity.buffer),v=this.layer,b=v.iconMaterial,w=v.textMaterial;this.iconVAO=new Of(e,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:a,opacity:g},c),this.textVAO=new Of(e,w.getAttributeLocations(),w.getLayoutInfo(),{geometry:d,opacity:y},m)}},WCt=class extends wj{constructor(e,i){super(e,i),this.type=eu.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}get memoryUsed(){var e,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((i=this.vao)==null?void 0:i.usedMemory)??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=It(this.vao)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=vr.createVertex(e,rr.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=vr.createIndex(e,rr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=this.layer.circleMaterial;this.vao=new Of(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}};const EKt=!0,YCt=32,hJ=200;let ZCt=class extends cn{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var r;if(this._stage===e)return;const i=this._stage;this._stage=e,e?(r=this._stage)!=null&&r.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i==null||i.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=ra(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=ra(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,i;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(i=this._fadeOutResolver)==null||i.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,i){const r=re("mapview-transitions-duration")===0?0:1/re("mapview-transitions-duration");if(this.fadeTransitionEnabled&&r!==0){const s=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===s)this.computedVisible=this.visible;else{const o=e*r;this.computedOpacity=n>s?Math.max(s,n-o):Math.min(s,n+o),this.computedVisible=this.computedOpacity>0;const a=s===this.computedOpacity;this.inFadeTransition=!a,a||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},HDe=class extends ZCt{constructor(e,i,r,s,n,o,a=n,l=o){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new Df(e),this.resolution=i,this.x=r,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let e=this;for(;e.parent!==this._stage;){if(!e.parent)return 0;e=e.parent}return this._stage.children.indexOf(e)}setTransform(e){const i=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,a=this.height/this.rangeY*i;fte(r,o,0,0,0,a,0,s,n,1),jM(this.transforms.displayViewScreenMat3,e.displayViewMat3,r)}get destroyed(){return this._destroyed}},AKt=class qDe extends HDe{constructor(e,i,r,s,n,o,a,l=null){super(e,i,r,s,n,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<hJ}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<hJ)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){var r,s;let i=!1;for(const n of e){const o=this.layerData.get(n);o&&(this._memoryUsedByLayerData-=o.memoryUsed,o.type===eu.SYMBOL&&this.symbols.delete(n)&&(i=!0),o.destroy(),this.layerData.delete(n))}(r=this._memCache)==null||r.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&((s=this.featureIndex)==null||s.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}dispose(){this.status!=="unloaded"&&(this.featureIndex=null,WDe.delete(this),qDe._destroyRenderBuckets(this.layerData),this.layerData.clear(),this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get usedMemory(){return this._memoryUsedByLayerData+256}changeDataImpl(e){var r,s;(r=this.featureIndex)==null||r.clear();let i=!1;if(e){const{bucketsWithData:n,emptyBuckets:o}=e,a=this._createRenderBuckets(n);if(o&&o.byteLength>0){const l=new Uint32Array(o);for(const c of l)this._deleteLayerData(c)}for(const[l,c]of a)this._deleteLayerData(l),c.type===eu.SYMBOL&&(this.symbols.set(l,c.symbols),i=!0),this._memoryUsedByLayerData+=c.memoryUsed,this.layerData.set(l,c);(s=this._memCache)==null||s.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const[n,o]of this.layerData)o.type===eu.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const i=this.resolution/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*i,s=this.height/this.rangeY*i,n=[0,0];e.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;WB(o),HM(o,o,n),YB(o,o,Math.PI*e.rotation/180),lL(o,o,[r,s,1])}_createTransforms(){return{displayViewScreenMat3:MS(),tileMat3:MS(),tileUnitsToPixels:MS()}}static _destroyRenderBuckets(e){if(!e)return;const i=new Set;for(const r of e.values())i.has(r)||(r.destroy(),i.add(r));e.clear()}_createRenderBuckets(e){const i=new Map,r=new Map;for(const s of e){const n=this._deserializeBucket(s,r);for(const o of n.layerUIDs)i.set(o,n)}return i}_deserializeBucket(e,i){let r=i.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case eu.FILL:r=new HCt(e,this.styleRepository);break;case eu.LINE:r=new jCt(e,this.styleRepository);break;case eu.SYMBOL:r=new qCt(e,this.styleRepository,this);break;case eu.CIRCLE:r=new WCt(e,this.styleRepository)}return i.set(e,r),r}_deleteLayerData(e){if(!this.layerData.has(e))return;const i=this.layerData.get(e);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(e)}};const WDe=new Map;function XCt(){WDe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(i=>console.log(i)),console.log("========"),t[1].forEach(i=>console.log(i))})}let JCt=class{constructor(e="scene"){this.context=e,this.extent=Mc()}};const OKt={value:.5,readOnly:!0},QCt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let TC=class{constructor(e=0,i=0){this.min=e,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},KCt=class{constructor(e,i){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(i[2]-i[0]),this.dy=(e.width-1)/(i[3]-i[1]),this.x0=i[0],this.y1=i[3]}},eMt=class{constructor(e,i,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=i,this.samplerData=new KCt(r,i)}computeMinMaxValue(e,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,u=this.samplerData.data.values,d=.5*Ete;let p=(c-1)/o,m=(r-this.j*o)*p,g=(i-this.i*o)*p;if(p<1){const y=Math.floor(m),v=Math.floor(g),b=y+v*c,w=u[b],x=u[b+1],T=u[b+c],C=u[b+c+1];if(w+x+T+C<d){const M=m-y,O=g-v,D=CD(w,x,T,C,M,O),k=CD(w,x,T,C,M+p,O),U=CD(w,x,T,C,M,O+p),H=CD(w,x,T,C,M+p,O+p);return s.min=Math.min(D,k,U,H),s.max=Math.max(D,k,U,H),s}m=y,g=v,p=1}else m=Math.floor(m),g=Math.floor(g),p=Math.ceil(p);for(let y=m;y<=m+p;y++)for(let v=g;v<=g+p;v++){const b=u[y+v*c];b<d?(a=Math.min(a,b),l=Math.max(l,b)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}};const tMt=.5*Ete;function _s(t,e,i){if(i==null)return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=Te(r.dy*(r.y1-e),0,s),o=Te(r.dx*(t-r.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=r.data.width,u=a*c+l,d=r.data.values,p=d[u],m=d[u+1],g=u+c,y=d[g],v=d[g+1];if(p+y+m+v<tMt){n-=a,o-=l;const b=p+(m-p)*o;return b+(y+(v-y)*o-b)*n}}return null}var St;(function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"})(St||(St={}));function YDe(t){return Ise(t)||dT(t)||pT(t)}function Ise(t){return S0(t)||MM(t)}const $2=E(),iMt=E(),oy=E(),ay=E();function rMt(t,e,i=0){const r=t.extent;if(r==null)return!1;if(i===0)return _we(r,e);const s=Math.min(r[2]-r[0],r[3]-r[1]);return Oje(r,e,i*s)}function DF(t,e,i,r){ce($2,i),$2[r]=e[r];const s=ve($2,$2,e),n=ve(iMt,t,e),o=pe(n,s),a=pe(s,s);let l;l=o<=0?e:a<=o?i:me($2,e,oe(s,s,o/a));const c=ve($2,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function sMt(t,e,i){const r=t.extent;if(r==null)return 0;oy[0]=r[0],oy[1]=r[1],oy[2]=i,ay[0]=r[2],ay[1]=r[3],ay[2]=i;let s=1/0,n=1/0;return e[0]<oy[0]?s=DF(e,oy,ay,0):e[0]>ay[0]&&(s=DF(e,ay,oy,0)),e[1]<oy[1]?n=DF(e,oy,ay,1):e[1]>ay[1]&&(n=DF(e,ay,oy,1)),Math.min(s,n)}function nMt(t,e,i,r){if(t==null)return Tte();const s=t.spatialReference;if(s.isGeographic&&!Ise(s))return new V("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const n=su.checkUnsupported(t);return n??(i==null?new V("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):oMt(t,i)||(e==null||s.equals(e)||e.isWGS84&&s.isWebMercator?null:new V("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function oMt(t,e){const i=t.lods,r=i[0].resolution*2**i[0].level,s=[r*t.size[0],r*t.size[1]],n=[t.origin.x,t.origin.y],o=ywe(e),a=Ht();su.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>rC){const c=i[0].scale*2**i[0].level;let u=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/r;const d=Math.floor(Math.log(u)/Math.log(10));return u=Math.ceil(u/10**d)*10**d,new V("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:u,requiredNumRootTiles:l,allowedNumRootTiles:rC})}return null}const aMt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:nMt,isInsideExtent:rMt,tiltToExtentEdge:sMt},Symbol.toStringTag,{value:"Module"}));function lMt(){return!0}function cMt(){return 0}function uMt(t,e,i,r){if(t==null)return Tte();const s=(t==null?void 0:t.lods.length)-1,n=t.spatialReference;if(n.isWebMercator){if(!su.makeWebMercatorAuxiliarySphere(s).compatibleWith(t,r))return new V("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!YDe(n))return new V("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!su.makeGCSWithTileSize(t.spatialReference,t.size[0],s).compatibleWith(t,r))return t.spatialReference.isWGS84?new V("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new V("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?null:new V("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const hMt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:uMt,isInsideExtent:lMt,tiltToExtentEdge:cMt},Symbol.toStringTag,{value:"Module"})),dMt={[Ge.Global]:hMt,[Ge.Local]:aMt};function Un(t,e){t||console.warn("Terrain: "+e)}let co=!1,TV=!1;function pMt(t){TV=t,co=co||t}function fMt(t){co=t}function ze(t,e){var i;if(co&&!t){const r=(i=new Error().stack)==null?void 0:i.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+r),new Error("Assertion failed"+(e?": "+e:""))}}function dJ(t){return Lse(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function EV(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function Lse(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function ZDe(t){return(t==null?void 0:t.type)==="tile-3d"}function _A(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function XDe(t){return(t==null?void 0:t.type)==="wmts-3d"}function pJ(t){return(t==null?void 0:t.type)==="elevation-3d"}function pO(t){return(t==null?void 0:t.type)==="group"}function M3(t){return t&&(ZDe(t)||XDe(t)||Lse(t)||_A(t))}function fJ(t){return t&&(ZDe(t)||Lse(t)||_A(t)||XDe(t))}function mJ(t){return fJ(t)||pJ(t)}function mMt(t){var e;return FDe((e=t==null?void 0:t.sourceLayerInfo)==null?void 0:e.data)}function gMt(t){return JDe(t==null?void 0:t.sourceLayerInfo)||!!(t!=null&&t.isVTLBackground)}function yMt(t){var e;return kDe((e=t==null?void 0:t.sourceLayerInfo)==null?void 0:e.data)}function _Mt(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return bj(e)||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData}function JDe(t){return EE(t==null?void 0:t.data)}function uM(t){return t!=null&&"release"in t&&t.release(),null}function LKt(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function Dse(t,e,i,r,s){return dMt[r].checkIfTileInfoSupportedForViewSR(t,i,e,s)}function xj(t,e,i){var o;let r=null,s=null;if((t==null?void 0:t.type)==="wmts"){const a=vMt(t,e,i);r=a.tileInfo,s=a.fullExtent}else{s=EV(t)?t.getCompatibleFullExtent(e):t.fullExtent;const a=i===Ge.Local;EV(t)?r=t.getCompatibleTileInfo(e,s,a):(t==null?void 0:t.type)==="vector-tile"?r=a&&!bMt(e)||wMt.force512VTL?t.tileInfo:t.tileInfo.getCompatibleForVTL(256):r=t.tileInfo}const n="tilemapCache"in t?(o=t.tilemapCache)==null?void 0:o.effectiveMaxLOD:void 0;return r!=null&&s!=null&&Dse(r,s,e,i,n)==null?{tileInfo:r,fullExtent:s}:null}function vMt(t,e,i){const r=N7e(t);if(r!=null){if(!tt.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>Dse(n.tileInfo,n.fullExtent,e,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function bMt(t){return t.isWGS84||t.isWebMercator||MM(t)||!CM(t)}const wMt={force512VTL:!1};function Wge(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function ly(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function Cd(t,e,i=TMt){return Math.abs(t-e)<i}function CV(t){return t===St.NORTH_EAST?St.SOUTH_WEST:t===St.NORTH_WEST?St.SOUTH_EAST:t===St.SOUTH_WEST?St.NORTH_EAST:St.NORTH_WEST}function Nse(t){return t===St.NORTH?St.SOUTH:t===St.EAST?St.WEST:t===St.SOUTH?St.NORTH:St.EAST}function xMt(t){return t===St.NORTH_WEST||t===St.SOUTH_WEST}function SMt(t){return t===St.NORTH_WEST||t===St.NORTH_EAST}function Yge(t){return t===St.NORTH_WEST||t===St.WEST||t===St.SOUTH_WEST}function Zge(t){return t===St.NORTH_EAST||t===St.EAST||t===St.SOUTH_EAST}function Xge(t){return t===St.SOUTH_EAST||t===St.SOUTH||t===St.SOUTH_WEST}function Jge(t){return t===St.NORTH_EAST||t===St.NORTH||t===St.NORTH_WEST}const pf=[St.NORTH,St.EAST,St.SOUTH,St.WEST],MV=[St.NORTH_EAST,St.SOUTH_EAST,St.SOUTH_WEST,St.NORTH_WEST],TMt=1e-5;let od=class extends Re{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(i=>{const r=i.layer;if("operationalLayerType"in r&&D7e(r.operationalLayerType)&&this.viewSpatialReference!=null){const s=QDe(r.fullExtent,this.viewSpatialReference);s!=null&&e.push(ywe(s))}}),e}};function EMt(t,e){return t===Ge.Global?new gJ(e):new yJ(e)}h([f({readOnly:!0})],od.prototype,"layerViewsExtent",null),h([f({readOnly:!0})],od.prototype,"tiledLayersExtent",null),h([f({readOnly:!0})],od.prototype,"stencilEnabledExtents",null),h([f()],od.prototype,"viewSpatialReference",void 0),h([f()],od.prototype,"tilingScheme",void 0),h([f()],od.prototype,"defaultTiledLayersExtent",void 0),h([f({constructOnly:!0})],od.prototype,"layers",void 0),h([f({constructOnly:!0})],od.prototype,"layerViews",void 0),od=h([I("esri.views.3d.terrain.ExtentHelper")],od);let gJ=class extends od{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?iEe:yXe}};gJ=h([I("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],gJ);let yJ=class extends od{_computeLayerViewsExtent(){const e=Mc(),i=this.viewSpatialReference;this.layerViews.forEach(n=>{const o=n.layer;if(n.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=QDe("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,i);r1(e,a,e)}});const r=l7(e)?e:null,s=this._get("layerViewsExtent");return cS(r,s)?s:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const i=this.viewSpatialReference,r=Mc();this.layers.forEach(o=>{var a;if(o.loaded&&z$(o)){const l=xj(o,i,Ge.Local);if(l==null)return;const{tileInfo:c,fullExtent:u}=l,d="tilemapCache"in o?(a=o.tilemapCache)==null?void 0:a.effectiveMaxLOD:void 0;c!=null&&u!=null&&(EV(o)||e.compatibleWith(c,d)&&u.spatialReference.equals(e.spatialReference))&&r1(r,u,r)}}),r1(r,this.defaultTiledLayersExtent,r);const s=l7(r)?r:null,n=this._get("tiledLayersExtent");return cS(s,n)?n:s}};function QDe(t,e){return t==null||t.spatialReference.equals(e)?t:k$(t,t.spatialReference,e)}yJ=h([I("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],yJ);function KDe(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const i=Object.keys(t);for(const r of i)r.includes(".glsl")&&delete t[r]}}const eNe=1.3,CMt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let k_,ac=class extends Re{constructor(e){super(e),this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=re("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){const e=this.view;this.renderer=new Kh({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),e._stage.renderer.plugins.add(this.renderer);const i=()=>this.setDrawTexturesDirty();this._groundIntersector=jd(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([ue(()=>this.renderer.hasHighlights,i),this.renderer.events.on("has-water",r=>{var s;return(s=e._stage)==null?void 0:s.renderer.setParameters({hasOverlayWater:r})}),this.renderer.events.on("content-changed",i),ue(()=>e.state.camera.pixelRatio,i),ue(()=>e.state.alignPixelEnabled,i),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),ue(()=>{var r,s,n;return[(r=e.pointsOfInterest)==null?void 0:r.renderPointOfView,(n=(s=e.pointsOfInterest)==null?void 0:s.centerOnSurfaceFrequent)==null?void 0:n.location]},()=>this.setPlacementDirty()),ue(()=>{var r,s;return[(r=e.state)==null?void 0:r.pixelRatio,(s=e.state)==null?void 0:s.contentPixelRatio]},()=>this.setPlacementDirty(),ar),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(Mt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",r=>{this._updateOverlays(lu,r.camera,tr.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(tr.BACKGROUND,r)})]),e._stage.renderer.renderOverlay=r=>this._renderOverlay(r)}destroy(){var e;(e=this.view)!=null&&e._stage&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{}),k_&&(k_.hide(),k_=null),this.renderer=Le(this.renderer)}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Rr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?ur(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return eNe/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}_renderOverlay(e){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._dispatchAnimationUpdate(e),this._drawOverlays(tr.UPDATE,this.view.state)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const i=this.view.renderSpatialReference;e!=null&&i!=null?(this._renderSR=i,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new x1(-20037508342787e-6,20037508342787e-6):new x1(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(e,i,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,i,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Ju)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,tr.UPDATE)}_updateOverlays(e,i,r){if(!this._spatialReference)return ia;const s=this._computeOverlayResolution(i);this._computeOverlayExtents(i,s,nm),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,nm.stretch);const n=this._updateOverlay(Mn.INNER,nm.inner,s,1*nm.pixelRatioAdjustment,nm.mapUnitsPerPixel),o=Xa(nm.inner)/Xa(nm.outer),a=this._updateOverlay(Mn.OUTER,nm.outer,s,o*nm.pixelRatioAdjustment,nm.mapUnitsPerPixel);n!==Dm.EXTENT&&a!==Dm.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(r)),n===Dm.NONE&&a===Dm.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const i=this.view.state.contentPixelRatio*this.view.resolutionScale,r=e.fullWidth/e.pixelRatio*i,s=e.fullHeight/e.pixelRatio*i,n=Math.ceil(1.5*Math.max(r,s));return Math.min(c1(n),this._maxResolution)}_updateOverlay(e,i,r,s,n){if(this.renderer.overlays.length===0)return Dm.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=n,o.pixelRatio=s,MMt(i,o.extent)&&r===o.resolution)return a===n?Dm.NONE:Dm.RERENDER_ONLY;T0(o.extent,i),o.resolution=r;const l=_ee(o.extent);return o.renderLocalOrigin=eV(l[0],l[1],0,"OV_"+this._latestOriginId++),Dm.EXTENT}setTileParameters(e){const i=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[Mn.INNER],s=this.renderer.overlays[Mn.OUTER],n=e.extent;this._rectInsideRect(r.extent,n)||this._rectanglesOverlap(n,r.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,Mn.INNER,i),this._setTileOverlayData(n,Mn.OUTER,i)):(this._clearTileOverlayData(Mn.INNER,i),this._clearTileOverlayData(Mn.OUTER,i))}else this._clearTileOverlayData(Mn.INNER,i),this._clearTileOverlayData(Mn.OUTER,i)}overlayPixelSizeInMapUnits(e,i){if(this.renderer.overlays.length===0)return i();const r=this.renderer.overlays[Mn.INNER],s=this.renderer.overlays[Mn.OUTER],n=this._pointIsInExtent(e,r.extent)?r:s;return(n.extent[2]-n.extent[0])/n.resolution}_setTileOverlayData(e,i,r){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[i].extent,n=Xa(s),o=_c(s);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(s[0],a);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}r.setScale(i,Xa(e)/n,_c(e)/o),r.setOffset(i,(a-s[0])/n,(e[1]-s[1])/o)}_clearTileOverlayData(e,i){i.setScale(e,-1,-1),i.setOffset(e,-1,-1)}async reloadShaders(){KDe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(lu)}_dispatchAnimationUpdate(e){const i=e-this._animationTimeLast;if(i>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const r=i/this.surface.view._stage.renderer.animationTimeDilation,s=new wOe(this.view.state.camera,r,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(s)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,i,r,s){const n=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,RMt,i,r);if(n==null)return!1;const o=n.origin,a=me(NF,n.origin,n.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,i){let r=.5;const s=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=Te(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const u=NF;zA(UB(zB,ur(this.view.spatialReference).radius+l),Mh(e.eye,e.viewForward),u),ve(u,u,e.eye);const d=S1.normalize(rTe(e.viewForward,u,e.viewRight))/e.fovY+.5,p=d<=0||d>=1?.5:s;r=c?p*d:d+p*(1-d)}else{const u=.5*Math.PI-Math.acos(-e.viewForward[2]),d=Math.tan(u),p=Wt(0,d,1,0),m=hu(p,p,e.projectionMatrix)[1],g=Te(.5+.5*m,0,1);r=g===1||g===0?.5:c?g*s:1-(1-g)*s}return!!this._intersectGroundFromView(e,.5,r,i)&&DI(i,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,i,r){var k;const s=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=E();this._findHorizonBasedPointOfInterest(e,n)||ce(n,s),Rr.OVERLAY_SHOW_CENTER?(k_==null&&(k_=new CE(this.view.graphics,"red")),k_.show(n,this._renderSR)):k_!=null&&k_.hide();const o=Math.max(.1,wr(e.eye,n)),a=j1(this.view.renderCoordsHelper,s,e.eye);this._overlaySREqualsRenderSR||Zn(n,this._renderSR,n,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&((k=this._spatialReference)==null?void 0:k.isGeographic),u=c&&this._spatialReference?1/ur(this._spatialReference).metersPerDegree:1,d=this.view.state.contentPixelRatio,p=e.perScreenPixelRatio/d*o*u;r.mapUnitsPerPixel=p/this._worldToPCSRatio,r.stretch=this._overlayStretch;let m=i*p/2*r.stretch,g=!1,y=c?90:1/0;this._isSpherical&&l&&this._spatialReference&&(this._spatialReference.isWebMercator?(m/=Math.cos(RU(n[1])),y=l[3]):(g=!0,m/=ur(this._spatialReference).metersPerDegree,y=90),m>=y&&(m=y,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let v=1;g&&(v=1/Math.max(.2,Math.cos(Math.abs(Rt(n[1])))),m*v>180&&(v=180/m),r.mapUnitsPerPixel*=v);const b=Math.log(2)/12;m=Math.exp(Math.round(Math.log(m)/b)*b);const w=m*v,x=32,T=.5*i/(x*w),C=.5*i/(x*m);n[0]=Math.round(n[0]*T)/T,n[1]=Math.round(n[1]*C)/C;const M=r.inner;M[0]=n[0]-w,M[1]=n[1]-m,M[2]=n[0]+w,M[3]=n[1]+m,this._isSpherical&&this._shiftExtentToFitBounds(M,1/0,y);const O=r.outer;if(6*w>Xa(l))T0(O,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)O[0]=M[0]-w,O[1]=M[1]-m,O[2]=M[2]+w,O[3]=M[3]+m;else{Zn(e.eye,this._renderSR,NF,this._spatialReference),Hm(uw,n,NF);let U=-Math.atan2(uw[1],uw[0])+.125*Math.PI;U<0&&(U+=2*Math.PI);const H=Math.floor(U/(.25*Math.PI));HS(uw,CMt[H],2*m),uw[0]*=v,uw[2]*=v,Zee(O,M,uw)}if(this._isSpherical)O[0]=this._longitudeCyclical.clamp(O[0]),O[2]=this._longitudeCyclical.clamp(O[2]),O[1]=Math.max(O[1],-y),O[3]=Math.min(O[3],y);else{const U=c7(M,l,PMt),H=c7(O,l,OMt);bae(U,H)&&(O[2]=O[0],O[3]=O[1])}const D=Math.abs(M[2]-M[0])/i;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,D),r.pixelRatioAdjustment=r.mapUnitsPerPixel/D}_drawOverlays(e,i){if(!this.renderer.hasOverlays)return;if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const r=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const s=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(i),s!==this.renderer.computeValidity()&&this.surface.updateTileOverlayParams(tr.UPDATE),r?(this.surface.requestRender(e),e===tr.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(tr.BACKGROUND),this.renderer}_rectanglesOverlap(e,i){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(i[0],i[2],e[0])||this._longitudeCyclical.contains(i[0],i[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],i[0]))&&!(e[1]>i[3]||e[3]<i[1]):X3(e,i))}_rectInsideRect(e,i){return i!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],i[0])&&this._longitudeCyclical.contains(e[0],e[2],i[2])&&i[1]>e[1]&&i[3]<e[3]:bae(e,i))}_pointIsInExtent(e,i){if(this._longitudeCyclical)return this._longitudeCyclical.contains(i[0],i[2],e.x)&&e.y>=i[1]&&e.y<=i[3];const r=e.x,s=e.y;return r>i[0]&&r<i[2]&&s>i[1]&&s<i[3]}_shiftExtentToFitBounds(e,i,r){let s=0,n=0;e[0]<-i?s=e[0]+i:e[2]>i&&(s=i-e[2]),e[1]<-r?n=e[1]+r:e[3]>r&&(n=r-e[3]),DU(e,s,n)}get test(){}};function MMt(t,e){const r=Rr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r}h([f()],ac.prototype,"_spatialReference",void 0),h([f({readOnly:!0})],ac.prototype,"running",null),h([f()],ac.prototype,"_placementDirty",void 0),h([f()],ac.prototype,"_contentUpdated",void 0),h([f()],ac.prototype,"_isSpherical",null),h([f()],ac.prototype,"_worldToPCSRatio",null),h([f()],ac.prototype,"renderer",void 0),h([f({constructOnly:!0})],ac.prototype,"view",void 0),h([f({constructOnly:!0})],ac.prototype,"surface",void 0),h([f()],ac.prototype,"suspended",null),h([f()],ac.prototype,"updating",null),h([f({type:Boolean})],ac.prototype,"rendersOccludedDraped",null),ac=h([I("esri.views.3d.terrain.OverlayManager")],ac);let AMt=class{constructor(){this.inner=Ht(),this.outer=Ht(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=eNe}};const uw=Qt(),NF=E(),nm=new AMt,PMt=Ht(),OMt=Ht(),RMt=uo();var Dm;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(Dm||(Dm={}));let $Mt=class{constructor(){this.indices=null,this.indexCount=0,this.edgeIndicesStartIndex=0,this.poleIndicesStartIndex=0,this.vertexAttributes=null,this.edgeVerticesStartIndex=0,this.poleVerticesStartIndex=0,this.maxEdgeVertexCount=0,this.boundingBox=Br(),this.numVerticesPerSide=0,this.minu=0,this.minv=0,this.maxu=1,this.maxv=1,this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=ti(this.vertexAttributes),this.indices=null}reset(){this.indices=null,this.vertexAttributes=null,Br(this.boundingBox),this.numVerticesPerSide=0}getEdgeFirstVertexIndex(e){return this.outerEdgesOffsetAndLength[2*e]}getEdgeCount(e){return this.outerEdgesOffsetAndLength[2*e+1]}getEdgeVertexIndex(e,i){return this.getEdgeAttributeIndex(e,i)}getEdgeVertexPosition(e,i,r,s){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(e,s),i),me(i,i,r)}getEdgeNormal(e,i,r){const{typedBuffer:s,typedBufferStride:n}=this.vertexAttributes.normalCompressed;Ygt(i,s,this.getEdgeAttributeIndex(e,r),n)}setEdgeNormalFromValues(e,i,r,s,n){this._setNormal(this.getEdgeAttributeIndex(e,i),r,s,n)}setEdgeVertexFromValuesRawPositionUV(e,i,r,s,n,o,a){const l=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(l,r,s,n),this._setUV(l,o,a)}setEdgeVertexFromValuesRawPositionUVNormal(e,i,r,s,n,o,a,l,c,u){const d=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(d,r,s,n),this._setUV(d,o,a),this._setNormal(d,l,c,u)}_getEdgeVertexRaw(e,i){this.vertexAttributes.position.getVec(e,i)}_setNormal(e,i,r,s){const{typedBuffer:n,typedBufferStride:o}=this.vertexAttributes.normalCompressed;Wd(n,e,i,r,s,o)}_setUV(e,i,r){bf(this.vertexAttributes.uv0,e,i,r)}getEdgeAttributeIndex(e,i){return ze(0<=i&&i<this.getEdgeCount(e)),this.getEdgeFirstVertexIndex(e)+i}};const Qge=16384;function bf(t,e,i,r){t.setValues(e,i*Qge,r*Qge)}let IMt=class{constructor(){this.sinLonLUT=new Array(RO+1),this.cosLonLUT=new Array(RO+1),this.sinLatLUT=new Array(RO+1),this.cosLatLUT=new Array(RO+1)}update(e,i,r){const s=i[0],n=i[2];for(let o=0;o<=e;o++){const a=o/e,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=r(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},LMt=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.samplerDataVersion=0,this.clippingArea=null,this.wireframe=!1,this.cornerPeerNeighbors=[null,null,null,null],this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}},tNe=class ek{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Le(this._current),this._next=Le(this._next),this._waiting=Le(this._waiting),this._delayed=Le(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let e=ek.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,m1.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const i=this._fadeDuration,r=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==mn.FADING,n=e-this._fadeStart>=i;(r||s||n)&&(Le(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=ek.test.fadeMoment||performance.now(),i=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return this._next!=null||this._delayed!=null}push(e,i=m1.Immediate){this._delayed=Le(this._delayed),this._push(e,i)}_push(e,i){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const r=ek.test.fadeMoment||performance.now();return i!==m1.Immediate?(this._delayed=e,void(this._delayedTime=r+i)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(e!=null&&(Le(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const i=this._getFadeDuration();return e+i-e%i}get _isFadingEnabled(){return this._getFadeDuration()>0}};var m1;tNe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(m1||(m1={}));var vA;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(vA||(vA={}));let iNe=class{constructor(){this._queue=new Zt,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var i;const e=(i=this._last)==null?void 0:i.children;return e!=null&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},DMt=class{constructor(){this._q=new Zt}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let i=0;i<this._q.length;++i){const r=this._q.data[i];r.isLeaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function yI(t,e,i){if((e==null?void 0:e.fullExtent)==null)return!1;const r=e.fullExtent,s=t.extent;if(i){if(s[0]<r.xmin||s[1]<r.ymin||s[2]>r.xmax||s[3]>r.ymax)return!1}else if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&n>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&n<.99999999*a)}function ng(t,e){const i=t.lij,r=e.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function NMt(t,e,i=null){i==null||i.length===0?t===vA.BACK_TO_FRONT?e.sort(FMt):e.sort(kMt):e.sort((r,s)=>UMt(r,s,t,i))}function FMt(t,e){const i=e.screenDepth-t.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function kMt(t,e){const i=t.screenDepth-e.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function rNe(t,e,i){const r=t.screenDepth,s=e.screenDepth;return r<s?-i:r>s?i:ng(t,e)}function UMt(t,e,i,r){return Kge(t,r)===Kge(e,r)?rNe(t,e,i):t?i:-i}function Kge(t,e){for(const i of e)if(t.intersectsExtent(i))return!0;return!1}function zMt(t,e){const i=t.distanceToPOI-e.distanceToPOI;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function VMt(t,e){const i=t.length;for(let r=0;r<i;++r)t.at(r).updateDistanceToPOI(e);t.sort(zMt)}function BMt(t,e,i){let r=1,s=0,n=0;for(;t!==e;)if(r*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),1&t.lij[1]||(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(e,s,n,r)}function GMt(t){for(let e=0;e<t.length;e++){const i=t[e],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i)return!0}}return!1}function HKt(t,e){if(!t||!e||t[0]===e[0])return!1;const i=t[0]<e[0],r=i?t:e,s=i?e:t,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}let Fse=class{get updating(){return!!this._tileRequested}init(e,i,r,s){this.tile=e,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,i){this._setUpsampleTile(e,i),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,mn.FADING,i):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(e,i),s=dJ(r),{minLevel:n,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?yI:()=>!0;let u=this.tile;const d=u.level;let p;const m=this._tileLayerInfo.upsampleInfo,g=m!=null?m.tile.level:-1,y=m!=null&&g-d>=a,v=s==null?void 0:s.tilemapCache,b=r.type==="vector-tile-3d"?r.schemaHelper:null;for(;u&&c(u,s,!1)&&u.level>=n;){const w=u.level,x=d-w,T=u.layerInfo[i][e];if(T.data&&x>=a){(!y||w>g)&&this._setUpsampleTile(u),T.dataInvalidated&&(p=u);break}const C=(b==null?void 0:b.getLevelRowColumn(u.lij))??u.lij;if((v==null?void 0:v.getAvailability(C[0],C[1],C[2]))!=="unavailable"&&w<=o&&!T.data&&!T.dataMissing&&((!p||u.level===n||w%tEe==0||d-p.level<a)&&(p=u),x>=l))break;u=u.parent}if(p!=null&&d-p.level<a)if(m)p=null;else{const w=this._findAncestorWithData();w!=null&&(this._setUpsampleTile(w),p=w.layerInfo[i][e].dataInvalidated?w:null)}return p}_findAncestorWithData(){const e=this.tile.elevationLevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=i)return s;r=s}return r}_setUpsampleTile(e,i){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,mn.FADING,i)}get test(){}},jMt=class extends Fse{constructor(){super(...arguments),this.type="none"}get _desiredMinLevelDelta(){throw eye}get _progressiveLevelModulo(){throw eye}dispose(){}};const eye=new Error("Abstract method called on TileAgent"),Dc=new jMt;let HMt=class extends Fse{constructor(){super(...arguments),this.type="elevation",this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return this.tile.elevationLevelDelta-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}};function qMt(t){return t.type==="elevation"}let WMt=class extends Fse{constructor(){super(),this.type="map",this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return tEe}};function YMt(t){return t.type==="map"}var Ga;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(Ga||(Ga={}));let tk=class{constructor(){this.waitingAgents=new Zt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const i=cq.acquire();return i._init(e),i}release(){this.dispose(),ik.delete(this),cq.release(this)}dispose(){this.loadingAgent=It(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=uM(this._data)}static prune(){cq.prune(0)}_init(e){this.waitingAgents.clear(),this._data=uM(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Ul(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,i){if(e!==i&&i!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),BMt(e,i,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){uM(this._data),this._data=e}};const cq=new Ca(tk,null,()=>{}),ik=new Map;function ZMt(){ik.size>0&&(console.log(`${ik.size} live TilePerLayerInfo allocations:`),ik.forEach(t=>console.log(t,`
`)))}var yt;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.GEOMETRY=8]="GEOMETRY",t[t.TEXTURE_NOFADING=16]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=32]="TEXTURE_FADING"})(yt||(yt={}));const XMt=.1;let kse=class{constructor(){this._lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Ht(),this._elevationBoundsMin=NaN,this._elevationBoundsMax=0,this.layerInfo=[[],[]],this.extentInRadians=Ht(),this.centerAtSeaLevel=E(),this._center=[E(),ln(),E()],this.up=JK(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=E(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0}get lij(){return this._lij}get elevationLevelDelta(){return this._surface.getElevationLevelDelta(this.level)}static prune(){Use.prune(0),zse.prune(0),tk.prune()}get _isCached(){return!this.isLeaf&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[fn.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,i=(e==null?void 0:e.frustumVisibility)??Ga.INTERSECTS;this._frustumVisibility=i===Ga.INSIDE?Ga.INSIDE:i===Ga.OUTSIDE?Ga.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const r=this._frustumVisibility!==Ga.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}init(e,i,r,s,n){this._lij[0]=e,this._lij[1]=i,this._lij[2]=r,this.ellipsoid=ur(n.tilingScheme.spatialReference),n.tilingScheme.getExtent(e,i,r,this.extent),n.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,n.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[fn.MIDDLE][3]=0,this.elevationLevel=e,s&&!Number.isNaN(s.elevationBoundsMin)?(this._elevationBoundsMin=s.elevationBoundsMin,this._elevationBoundsMax=s.elevationBoundsMax):(this._elevationBoundsMin=0,this._elevationBoundsMax=0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=s,this.unsetChildren(),this._surface=n,this.updateVisibility(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0;for(const o of rx){const a=n.numLayers(o),l=this.layerInfo[o];for(const c of l)c.release();l.length=a;for(let c=0;c<a;c++)l[c]=tk.acquire(this._surface.upsampleInfoPool),o===jt.ELEVATION&&this.findElevationBoundsForLayer(c,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(n.tilingScheme.pixelSize,RO)}dispose(){Un(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of rx){for(const i of this.layerInfo[e])i.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[jt.MAP].reduce((e,{data:i})=>e+(EE(i)?i.usedMemory/i.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){var r;if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=this._baseUsedMemory,this._mapTileMemoryInternal=0;let e=0;for(const{data:s}of this.layerInfo[jt.MAP])EE(s)?e+=this._getTerrainDataMemory(s):this._mapTileMemoryInternal+=this._getTerrainDataMemory(s);const i=this._cpuImageMemorySize;for(const s of this.layerInfo[jt.ELEVATION])this._usedMemory+=s.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=((r=this.renderData.texture)==null?void 0:r.usedMemory)??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,i){const r=this.layerInfo[e][i];return r!=null&&r.data?e===jt.MAP?this._isCached?0:this._getTerrainDataMemory(r.data):e===jt.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return kDe(e)?e.texture.usedMemory:FDe(e)?e.memoryUsage:EE(e)?e.usedMemory/e.referenced:bj(e)||e instanceof HTMLImageElement?this._cpuImageMemorySize:0}updateScreenDepth(e){const i=this._center[fn.MIDDLE],r=e,s=i[0],n=i[1],o=i[2],a=r[2]*s+r[6]*n+r[10]*o+r[14];this.screenDepth=a<0?0:a/(r[3]*s+r[7]*n+r[11]*o+r[15])}shouldSplit(e,i,r){if(!this.visible||e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===Ga.OUTSIDE))return yt.NONE;const s=this.level;ve(kF,this._center[fn.MIDDLE],i);let n=Za(kF),o=kF,a=this._center[fn.MIDDLE];ve(uq,this._center[fn.TOP],i);const l=Za(uq);l<n&&(n=l,o=uq,a=this._center[fn.TOP]),ve(hq,this._center[fn.BOTTOM],i);const c=Za(hq);if(c<n&&(n=c,o=hq,a=this._center[fn.BOTTOM]),this._edgeLen2>n&&s<e.maxLod)return yt.SPLIT;const u=Math.sqrt(n),d=e.fovX*u*2,p=this._edgeLen/d,m=()=>{if(s<e.maxLod)return this.elevationLevel=s,yt.NONE;const O=s+Math.ceil(-Math.log2(e.relativeWidthLimit/p));return O!==this.elevationLevel?(this.elevationLevel=O,yt.ELEVATION):yt.NONE},g=r!=null?r-s:1/0;if(g<=.5)return m();const y=pe(this.up,kF),v=this._elevationBoundsMax-this._elevationBoundsMin,b=v/this.edgeLen;if(e.aboveGround&&y>0&&b<.001&&y/u-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-b>0)return yt.NONE;const w=r!=null?3-Math.min(g,2):1;if(p*w<e.relativeWidthLimit||s>=e.maxLod)return m();if(s<7)return yt.SPLIT;oe(zo,this.up,y),ve(zo,zo,o);const x=Za(zo);if(x<=this.radius*this.radius)return yt.SPLIT;oe(zo,zo,this.radius/Math.sqrt(x)),me(zo,zo,a),ve(zo,i,zo);const T=Math.min(1,(Math.abs(pe(zo,this.up))+.5*v+this._curvatureHeight)/Ae(zo)),C=XMt/e.angledSplitBias,M=e.fovY*u*2;return T*(this._edgeLen/M*w)<C*e.relativeHeightLimit?yt.NONE:yt.SPLIT}setChildren(e,i,r,s){Un(!!(e&&i&&r&&s),"Null child passed");const n=this._children;return n[0]=e,n[1]=i,n[2]=r,n[3]=s,n}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of rx)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const i of rx){const r=this.layerInfo[i];for(const s of r)s.loadingAgent&&s.loadingAgent!==Dc&&(FF(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(yt.GEOMETRY),this.resetPendingUpdate(yt.TEXTURE_NOFADING),this.resetPendingUpdate(yt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[jt.MAP];for(const i of e)i.loadingAgent&&i.loadingAgent!==Dc&&(FF(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(cS(e,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=r&&this._isWithinClippingArea,n=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(yt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,i){return this.layerInfo[i][e]}hasLayerData(e,i){const r=this.layerInfo[i][e];return!(!(r!=null&&r.data)||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of rx){const i=this.layerInfo[e];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==Dc&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(yt.SPLIT)||e!==jt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){const i=this._pendingUpdates;return this._pendingUpdates|=e,e===yt.SPLIT||e===yt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate(),i!==this._pendingUpdates}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,i,r){const s=this.layerInfo[i][e];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e);const a=EE(s.data);return r.dataArrived(this,a),!0}if(s.requestPromise)return!0;Ul(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this._lij[0]===e[0]&&this._lij[1]===e[1]&&this._lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const i=this._children;return i[0]?i[0].findByLij(e)||i[1].findByLij(e)||i[2].findByLij(e)||i[3].findByLij(e):null}distanceToSquared(e){return Za(ve(zo,this._center[fn.MIDDLE],e))}containsPoint(e){const i=this.extent;return e[0]>=i[0]&&e[1]>=i[1]&&e[0]<=i[2]&&e[1]<=i[3]}containsPointXY(e,i){const r=this.extent;return e>=r[0]&&i>=r[1]&&e<=r[2]&&i<=r[3]}unrequestLayerData(e,i,r){const s=this.layerInfo[i][e],n=s.waitingAgents,o=n.removeUnordered(r)!=null;Un(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,i,r){const s=EE(r),n=this.layerInfo[i][e];n.data=r,n.dataInvalidated=!1,n.waitingAgents.forAll(o=>o.dataArrived(this,s)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,i){const r=this.layerInfo[i][e];r.dataMissing=!0,r.waitingAgents.forAll(s=>s.dataMissing()),r.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,i,r){switch(r&&this.forEachLoadedNeighbor(s=>s.updateRenderData(e,i)),e){case jt.MAP:return this._updateTexture(i);case jt.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===mn.FADING?yt.TEXTURE_NOFADING:yt.TEXTURE_FADING),this.setPendingUpdate(e===mn.FADING?yt.TEXTURE_FADING:yt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(yt.GEOMETRY);for(const e of this.layerInfo[jt.ELEVATION])e.pendingUpdates|=yt.GEOMETRY}invalidateLayerData(e,i){this.layerInfo[i][e].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax;let r=1/0,s=-1/0;const n=this.layerInfo[jt.ELEVATION];let o=!0;for(const a of n)a.elevationBounds!=null&&(r=Math.min(r,a.elevationBounds.min),s=Math.max(s,a.elevationBounds.max),a.elevationBounds.hasNoDataValues||(o=!1));o&&(r=Math.min(r,0),s=Math.max(s,0)),e===r&&i===s||(this._elevationBoundsMin=r,this._elevationBoundsMax=s,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax,r=.5*(e+i),s=this._center;oe(zo,this.up,r),me(s[fn.MIDDLE],this.centerAtSeaLevel,zo),oe(zo,this.up,e),me(s[fn.TOP],this.centerAtSeaLevel,zo),oe(zo,this.up,i),me(s[fn.BOTTOM],this.centerAtSeaLevel,zo)}findElevationBoundsForLayer(e,i){const r=this.layerInfo[jt.ELEVATION][e],s=this.elevationLevelDelta,n=Math.max(this.elevationLevel-s,0),o=r.elevationBounds;if(o!=null&&o.level>=i&&o.level<=n)return;const a=this._surface.layerViewByIndex(e,jt.ELEVATION),l=dJ(a);if(!yI(this,l,!1))return;const c=QMt;let u=!1;const d=r.data;if(d&&d.level<=n){const p=r.data;c.min=p.samplerData.data.minValue,c.max=p.samplerData.data.maxValue,c.hasNoDataValues=p.samplerData.data.hasNoDataValues,c.level=this.level,u=!0}else{let p,m,g=0;for(let y=this._parent;y&&(!m||g<s)&&(g=this.elevationLevel-y.level,p=m||p,m=y.layerInfo[jt.ELEVATION][e].data,!(!m&&p&&y.level<=n));y=y.parent);m=m||p,m&&(m.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],c),c.min!==1/0&&(c.level=m.level,u=!0))}u&&(r.elevationBounds==null&&(r.elevationBounds=new TC),r.elevationBounds.copyFrom(c))}modifyLayers(e,i,r){const s=this.layerInfo[r];for(const a of s)a.loadingAgent&&a.loadingAgent!==Dc&&(FF(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)e[a]===void 0&&s[a].release();const n=new Array(...s),o=i.length;s.length=o;for(let a=0;a<o;a++){const l=i[a];s[a]=l>-1?n[l]:tk.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,mn.FADING))}updateAgents(e){if(this.renderData){const i=this.layerInfo[e];for(const r of i)r.loadingAgent===Dc&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of rx){const i=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==Dc&&(r.loadingAgent.setSuspension(i),r.loadingAgent===Dc&&this.updateRenderData(e,mn.FADING))}}removeLayerAgent(e,i){const r=this.layerInfo[i][e];r.loadingAgent&&r.loadingAgent!==Dc&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,i){const r=this.layerInfo[i][e];r.loadingAgent=Dc,r.data||r.upsampleInfo!=null||this._createOrUpdateAgents(e+1,i)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||BM(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,i,r){var s,n,o;for(let a=e;a<i;++a){const l=this._surface.layerViewByIndex(a,r);if(M3(l)&&((s=l==null?void 0:l.layer)==null?void 0:s.blendMode)!=="normal"||BM((n=l==null?void 0:l.layer)==null?void 0:n.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,i){const r=this.layerInfo[i];if(r.length===0)return;const s=this._isSuspended(i);for(let n=e;n<r.length;++n){const o=r[n];let a=!1;const l=this._surface.layerViewByIndex(n,i),c=dJ(l);if(o.loadingAgent?yI(this,c,!1)?(o.loadingAgent!==Dc&&o.loadingAgent.setSuspension(s),o.loadingAgent!==Dc&&(a=o.loadingAgent.update())):o.dispose():yI(this,c,!1)&&(o.loadingAgent=JMt(this,n,i,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===Dc&&this.setPendingUpdate(yt.GEOMETRY):(FF(o.loadingAgent),o.loadingAgent=Dc)),o.loadingAgent===Dc&&this.updateRenderData(i,mn.FADING),!this._hasBlendModes(e,r.length,i)&&a&&l.isOpaque)return}}_isWithinExtent(e){const i=this.extent;return i[0]>=e[0]&&e[2]>=i[2]&&i[1]>=e[1]&&e[3]>=i[3]}intersectsExtent(e){const i=this.extent;return i[2]>=e[0]&&e[2]>=i[0]&&i[3]>=e[1]&&e[3]>=i[1]}getElevationVerticesPerSide(e){const i=this.elevationLevel-this.level,r=Math.max(this.level-e,this.elevationLevelDelta-i),s=Te(1+(this.maxTesselation>>r),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}_findLIJ(e,i){if(!e)return null;const r=this.surface.rootTiles;if(r!=null){for(const s of r)if(KMt(s,e)){let n=s,o=e[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!i(n);){const a=e[1]>>o&1,l=e[2]>>o&1;n=n.children[2*a+l],o--}return i(n)?n:null}}return null}findNeighborTile(e,i){const r=this._lij,s=this.getNeighborLIJ(r,e);return s?rk(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(e,i){const r=e===St.NORTH_EAST?1:e===St.NORTH_WEST?0:e===St.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!i||!i(s));)s=s.children[r];return s}findNeighborCornerTileExact(e,i){var r;return((r=this.findNeighborTile(e,s=>i(s)||s.level===this.level))==null?void 0:r.findCorner(CV(e),i))||null}forAllSubtreeOnSide(e,i){const r=e===St.NORTH?[0,1]:e===St.NORTH_EAST?[1]:e===St.EAST?[1,3]:e===St.SOUTH_EAST?[3]:e===St.SOUTH?[2,3]:e===St.SOUTH_WEST?[2]:e===St.WEST?[0,2]:[0],s=n=>{const o=n.children;!i(n)&&o[0]&&r.forEach(a=>s(o[a]))};s(this)}getNeighborEdgeStartVertexIndex(e,i){if(!i)return 0;const r=this.level-i.level;if(ze(!co||r>=0),r===0)return 0;const s=2**r,n=!(1&~e),o=n?0:1,a=i.lij[o+1]*s,l=this._lij[o+1],c=l-a,u=n?s-1-c:c;return co&&(ze(a<=l&&l<a+s),ze(0<=u&&u<s)),u}forEachLoadedNeighbor(e){const i=this.level,r=s=>s.level===i||s.isLoaded;pf.forEach(s=>{const n=this.findNeighborTile(s,r);n!=null&&n!==this&&n.forAllSubtreeOnSide(Nse(s),o=>!!o.isLoaded&&(e(o,s),!0))}),MV.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,r))==null?void 0:o.findCorner(CV(s),a=>a.isLoaded);ze(!n||_J(this,n,s)),n!=null&&n.isLoaded&&e(n,s)})}getNeighborLIJ(e,i){const r=Jge(i)?-1:Xge(i)?1:0,s=Yge(i)?-1:Zge(i)?1:0,n=[e[0],e[1]+r,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this._lij[2]===0}get isNorthEnd(){return this._lij[1]===0}get isSouthEnd(){const e=this.surface.extent,i=(e==null?void 0:e[1])??null;return i!=null&&this.extent[1]+Lo()>=i}checkGeometryWaterproofness(){var e;TV&&(ze(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(Jge(e)&&i[3]+s>=r[3]||Xge(e)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&Yge(e)&&i[0]-s<=r[0])&&!(!n&&Zge(e)&&i[2]+s>=r[2])}updateDistanceToPOI(e){const i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2])return;ce(this._lastPOI,e);const r=this._center[fn.MIDDLE],s=e[0]-r[0],n=e[1]-r[1],o=e[2]-r[2];this.distanceToPOI=s*s+n*n+o*o}get test(){return{cachedMemory:this._cachedMemory}}};function JMt(t,e,i,r){const s=i===jt.ELEVATION?zse.acquire():Use.acquire();return s.init(t,e,i,r),s}function FF(t){t.dispose(),qMt(t)?zse.release(t):YMt(t)&&Use.release(t)}const Use=new Ca(WMt),zse=new Ca(HMt),QMt=new TC;var fn;function KMt(t,e){const i=t.lij,r=e[0]-i[0];return!(r<0)&&e[1]>>r===i[1]&&e[2]>>r===i[2]}function rk(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function eAt(t,e,i){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&i===St.EAST||t.isWestEnd&&e.isEastEnd&&i===St.WEST))return!0;const r=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(i){case St.NORTH:return Cd(t.extent[3],e.extent[1],r);case St.SOUTH:return Cd(t.extent[1],e.extent[3],r);case St.EAST:return Cd(t.extent[2],e.extent[0],r)||Cd(t.extent[2],-e.extent[0],r);case St.WEST:return Cd(t.extent[0],e.extent[2],r)||Cd(t.extent[0],-e.extent[2],r)}}function _J(t,e,i){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?tye(t,e,i):tye(e,t,CV(i)))}function tye(t,e,i){ze(t.level>=e.level);const r=xMt(i),s=SMt(i),n=t.extent,o=e.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),u=Cd(a[0],l[0],c)||t.surface.isGlobal&&Cd(a[0],-l[0],c),d=Cd(a[1],l[1],c);if(u&&d)return!0;if(t.level===e.level||!u&&!d)return ze(!1),!1;const p=u?iye(o[1],o[3],n[1],n[3],c):iye(o[0],o[2],n[0],n[2],c);return ze(p),p}function iye(t,e,i,r,s){return t-s<=i&&i<=r&&r<=e+s}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(fn||(fn={}));const kF=E(),uq=E(),hq=E(),zo=E();let tAt=class{constructor(){this._scales=Wt(-1,-1,-1,-1),this._offsets=Wt(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,i,r){this._scales[2*e]=i,this._scales[2*e+1]=r}setOffset(e,i,r){this._offsets[2*e]=i,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};function iAt(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(S`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(S`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(S`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function Vse(t){t.code.add(S`
    float lineFactorAtPosition(float value) {
      float pos = value * ${S.float(257)};
      if(pos < 0.5 || pos > ${S.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}var og;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(og||(og={}));let rAt=class extends Pre{constructor(){super(...arguments),this.overlayOpacity=1}};function sAt(t,e){const{vertex:i,fragment:r,varyings:s}=t;s.add("vtc","vec2"),i.uniforms.add(new rye("texOffsetAndScale")),r.uniforms.add(new sye("tex")),r.uniforms.add(new dq("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(i.uniforms.add(new rye("nextTexOffsetAndScale")),s.add("nvtc","vec2"),r.uniforms.add(new sye("texNext")),r.uniforms.add(new dq("nextTexOpacities")),r.uniforms.add(new nAt("fadeFactor")));const o=e.tileBlendInput===og.ColorComposite,a=e.tileBlendInput===og.GridComposite;a&&r.include(Vse),o&&r.uniforms.add(new dq("backgroundColor")),i.code.add(S`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?S`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:S``}
  }`),r.code.add(S`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?S`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?S`backgroundColor`:S`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:S`return color;`}
    }`),n?r.code.add(S`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(S`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let nAt=class extends Fs{constructor(e){super(e,"float")}},dq=class extends Fs{constructor(e){super(e,"vec3")}},rye=class extends Fs{constructor(e){super(e,"vec4")}},sye=class extends Fs{constructor(e){super(e,"sampler2D")}},Bse=class extends rAt{};function sNe(t){const e=new Vi,{vertex:i,fragment:r,varyings:s}=e;e.include(yL),e.include(QA,t),e.include(lf,t);const n=()=>{e.include(S3,t),i.code.add(S`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};bc(i,t),e.include(Ja,t);const o=t.overlayMode!==ig.Disabled,a=o&&t.invisible;switch(t.output){case G.Color:{e.include(sAt,t),e.include(rT,t),o&&e.include(WP,{...t,pbrMode:t.pbrMode===xt.Simplified?xt.TerrainWithWater:xt.Water});const l=t.overlayMode===ig.EnabledWithWater;l&&e.include(iAt,t),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),t.screenSizePerspective&&iA(i);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include(ZA,t),t.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),i.code.add(S`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?S`forwardVertexTangent(vnormal);`:S``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?S`setOverlayVTC(uv);`:""}
          ${t.tileBorders?S`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?S`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?S`forwardLinearDepth();`:""}

        }
      `),e.include(gn,t),e.include(rT,t),e.include(RL,t),e.include(hA,t),Rf(r,t),$L(r),tP(r),r.uniforms.add(i.uniforms.get("localOrigin"),new Vt("viewDirection",(u,d)=>ge(nye,ne(nye,d.camera.viewMatrix[12],d.camera.viewMatrix[13],d.camera.viewMatrix[14])))),l&&r.uniforms.add(new mt("ovWaterTex",(u,d)=>{var p;return(p=d.overlay)==null?void 0:p.getTexture(Yr.WaterNormal)}),new CAe("view",(u,d)=>rl(oAt,d.camera.viewMatrix,u.origin))),r.code.add(S`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),G0(r),Lg(r),r.code.add(S`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?S`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?S`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===xt.Simplified||t.pbrMode===xt.TerrainWithWater?S`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:S`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?S`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?S`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?S`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:S`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?S`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case G.Depth:a&&e.include(WP,t),i.code.add(S`
              void main(void) {
                ${a?S`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPosition(proj, view, position);
              }
          `),r.code.add(S`
              void main() {
                ${a?S`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              }
          `);break;case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:case G.ViewshedShadow:e.include(JG,t),oZ(e),bG(e),i.code.add(S`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(S`void main() {
outputDepth(linearDepth);
}`);break;case G.Normal:a&&e.include(WP,t),s.add("vnormal","vec3"),iA(i),n(),i.code.add(S`
        void main(void) {
          ${a?S`setOverlayVTC(getUV0());`:""}
          gl_Position = transformPosition(proj, view, position);
          vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
        }
      `),r.code.add(S`
        void main() {
          ${a?S`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
          vec3 normal = normalize(vnormal);
          if (gl_FrontFacing == false) {
            normal = -normal;
          }
          fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
        }
      `);break;case G.Highlight:o&&e.include(WP,t),i.code.add(S`
          void main() {
            ${o?S`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(gb,t),r.code.add(S`
          void main() {
            ${o?S`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===G.ObjectAndLayerIdColor&&(o?(e.include(WP,{...t,pbrMode:xt.Disabled}),i.code.add(S`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),r.code.add(S`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(i.code.add(S`void main(void) {
        ${t.opaque?S` gl_Position = transformPosition(proj, view, position);`:""}
      }`),r.code.add(S`void main() {
fragColor = vec4(0.0);
}`))),e}const oAt=Ee(),nye=E(),aAt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Bse,build:sNe},Symbol.toStringTag,{value:"Module"}));let nNe=class oNe extends Wi{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,i){i.spherical=e.viewingMode===Ge.Global}initializeProgram(e){return new Yi(e.rctx,oNe.shader.get().build(this.configuration),aNe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return Gt({blending:i.renderOccluded?Ah(Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA):null,culling:r?nie:null,depthTest:i.renderOccluded?null:{func:fr.LESS},depthWrite:i.renderOccluded?null:Tu,colorWrite:Kt,stencilTest:e?xdt(Tc.IntegratedMeshMaskExcluded):null,drawBuffers:i.output===G.Depth?{buffers:[ao.NONE]}:null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}};nNe.shader=new Bi(aAt,()=>fe(()=>Promise.resolve().then(()=>MUt),void 0));const aNe=new Map([[R.POSITION,0],[R.UV0,1],[R.NORMALCOMPRESSED,2]]);let lAt=class{constructor(){this.geometry=new $Mt,this.intersectionData=null,this.geometryState=null,this._vao=null,this._texture=null,this._textureRef=new tNe(()=>this.tile.surface.fadeDuration),this.overlay=new tAt,this._localOrigin=null,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(e,i){this.clear(),this._tile=e,this.geometry.reset(),this.intersectionData=null,this.geometryState=new LMt,this._localOrigin=i,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||this.dirtyEdgeResolutions||this.dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),co&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)ze(this.geometry.getEdgeCount(i)===this.geometryState.edgeResolutions[i]+1)}_calculateEdgeResolution(e,i){var l;const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const c=r.surface.extent;if(c!=null&&(e===0&&r.extent[3]>c[3]||e===1&&r.extent[2]>c[2]||e===2&&r.extent[1]<c[1]||e===3&&r.extent[0]<c[0]))return s}const n=r.level,o=pf[e];if(!i)return ze(((l=r.surface)==null?void 0:l.rootTiles)==null||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(o)),s;if(i.isLoaded){const c=i,u=c.renderData.geometryState,d=n-c.level;if(ze(d>=0),d===0){const g=u.numVerticesPerSide-1;return Math.max(g,s)}const p=2**d,m=u.edgeResolutions[(e+2)%4]/p;return Math.max(1,m)}ze(!i.isLeaf);let a=s;return i.forAllSubtreeOnSide(Nse(o),c=>c===r||(c.isLoaded?(a=Math.max(a,2**(c.level-n)),!0):(ze(!c.isLeaf),!1))),a}updateNeighborData(){var o;const e=this.tile;if(!e.intersectsClippingArea)return;const i=e.renderData.geometryState,r=a=>(a.isLoaded||a.level===e.level)&&(a==null?void 0:a.intersectsClippingArea),s=i.edgePeerNeighbors,n=i.edgePeerNeighborSamplerVersions;for(let a=0;a<4;++a){const l=e.findNeighborTile(pf[a],r),c=Nx(e,l),u=((o=c==null?void 0:c.renderData)==null?void 0:o.geometryState.samplerDataVersion)??-1,d=s[a],p=c!==Nx(e,d),m=n[a]!==u;co&&l&&(ze(e.level>=l.level),ze(e.level-l.level<=Bn)),s[a]=l,(p||m)&&(n[a]=u,this._markEdgeDirty(a));const g=i.edgeResolutions[a],y=this._calculateEdgeResolution(a,l);ze(NI(y)),ze(y>=1),i.edgeResolutions[a]=y,g!==y&&this._markEdgeResolutionDirty(a)}for(let a=0;a<4;++a){const l=e.findNeighborTile(MV[a],r);i.cornerPeerNeighbors[a]=l;const c=Nx(e,s[a]),u=Nx(e,s[(a+1)%4]),d=Nx(e,l);gp[a]=d,gp[(a+1)%4]=u,gp[(a+2)%4]=e,gp[(a+3)%4]=c,ze(gp.some(y=>(y==null?void 0:y.isLoaded)||y===e));const p=gp.reduce((y,v)=>Math.min(y,(v==null?void 0:v.level)??1/0),1/0);gp.forEach((y,v)=>{y&&(y==null?void 0:y.level)>p&&(gp[v]=null)}),ze(gp.some(y=>(y==null?void 0:y.isLoaded)||y===e));const m=i.cornerNeighborCornerTiles,g=i.cornerNeighborCornerTileSamplerVersions;for(let y=0;y<4;++y){const v=gp[y],b=(v==null?void 0:v.renderData.geometryState.samplerDataVersion)??-1,w=4*a+y,x=m[w]!==v,T=!x&&g[w]!==b;(x||T)&&(m[w]=v,g[w]=b,this._markCornerDirty(a))}co&&ze(Gse.some(y=>{var v;return((v=m[4*a+y])==null?void 0:v.isLoaded)||m[4*a+y]===e}))}co&&ze(this.geometryState.edgeResolutions.every(a=>a>0));for(let a=0;a<4;++a)gp[a]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;co&&ze(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every(m=>m>0)),this.intersectionData=null;const{tile:i,_vao:r,geometry:s,geometryState:n}=this,o=!r||!1||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||this.numVerticesPerSideChanged,a=this.dirtyEdgeResolutions!==0,l=n.edgeResolutions.reduce((m,g)=>m+g+1,0),c=o||a&&l>((s==null?void 0:s.maxEdgeVertexCount)??0),u=!c&&a,d=!u&&(this.dirtyEdges!==0||a),p=!d&&this.dirtyCorners!==0;c?(this.releaseGeometry(),this._createGeometry(e)):u?i.updateEdgeElevationsAndResolutions():d||p?i.updateEdgeElevations():p?i.updateCornerElevations():console.warn("Update for no reason?"),this._modifiedFlags=0}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=It(this._vao),this.geometry.release(),!0)}ensureTexture(e,i,r){const s=i?Ft.RGBA:Ft.RGB;return this._texture==null||this._texture.descriptor.width===e&&this._texture.descriptor.pixelFormat===s||this.releaseTexture(),this._texture==null&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}get numVerticesPerSideChanged(){return!!(this._modifiedFlags&uAt)}get samplerDataChanged(){return!!(this._modifiedFlags&hAt)}get clippingAreaChanged(){return!!(this._modifiedFlags&dAt)}get wireframeChanged(){return!!(this._modifiedFlags&pAt)}get dirtyEdges(){return this._modifiedFlags>>pq&15}get dirtyCorners(){return this._modifiedFlags>>fq&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>mq&15}_markCornerDirty(e){const i=1<<e<<fq;this._modifiedFlags|=i}_markEdgeDirty(e){const i=1<<e<<pq;this._modifiedFlags|=i,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const i=1<<e<<mq;this._modifiedFlags|=i,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=15<<fq|15<<pq|15<<mq}updateGeometryState(){const e=this._getElevationInfo(),i=this.tile,r=e.samplerData?i.getElevationVerticesPerSide(e.maxTileLevel):i.getDefaultVerticesPerSide(),s=Math.max(r,5);let n=i.clippingArea;i.intersectsClippingArea&&!i.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._modifiedFlags|=1,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),e.changed&&(this._modifiedFlags|=2,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),w1(o.clippingArea,n)||(this._modifiedFlags=4,o.clippingArea=n,a=!0);const l=i.surface.wireframe;return o.wireframe!==l&&(this._modifiedFlags=8,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const i=this.geometry.vertexAttributes,r=this.geometry.indices,s=e.gl;this._vao=new Fg(e,aNe,{geometry:Au(i.layout)},{geometry:vr.createVertex(e,s.STATIC_DRAW,i.buffer)},vr.createIndex(e,s.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,i=m1.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,i=this.tile.layerInfo[jt.ELEVATION],r=i.length,s=new Array(r);let n=0,o=0,a=!1;for(let u=0;u<r;u++){const d=i[u];if(d.upsampleInfo!=null){const p=d.upsampleInfo.tile,m=p.layerInfo[jt.ELEVATION][u].data,g=m&&m.samplerData;e&&e[n]===g||(a=!0),s[n++]=g,o=Math.max(o,p.lij[0])}else if(d.data){const p=this.tile.surface.layerViewByIndex(u,jt.ELEVATION);if(yI(this.tile,p.layer,!1)){const m=d.data;e&&e[n]===m.samplerData||(a=!0),s[n++]=m.samplerData,o=this.tile.level}}}e!=null&&e.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var i,r,s;const e=((i=this.intersectionData)==null?void 0:i.estimatedMemoryUsage)??0;return(((r=this.geometry.indices)==null?void 0:r.byteLength)??0)+(((s=this.geometry.vertexAttributes)==null?void 0:s.byteLength)??0)+e}get texture(){return this._texture}get test(){}checkGeometryWaterproofness(){if(!co)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void ze(e==null?void 0:e.isLoaded);const i=e.surface.extent;if(i!=null&&!e.intersectsExtent(i))return;const r=pf.map((a,l)=>i!=null&&(l<2?-1:1)*(e.extent[3-l]-i[3-l])<0),s=e.level;ze(this.dirtyCorners===0),ze(this.dirtyEdges===0),ze(this.dirtyEdgeResolutions===0),ze(!this.numVerticesPerSideChanged),ze(!this.samplerDataChanged),ze(!this.clippingAreaChanged),ze(!this.wireframeChanged);const n=MV.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a!=null&&a.intersectsClippingArea?a:null),o=this.geometryState;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=n[a];ze(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l==null?void 0:l.lij}] exp=[${c==null?void 0:c.lij}]`)}pf.forEach((a,l)=>{if(r[l])return;const c=e.findNeighborTile(a,X=>(X.level===s||(X==null?void 0:X.isLoaded))&&(X==null?void 0:X.intersectsClippingArea));if(!c){const X=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void ze(!X)}ze(c.isLoaded||c.level===e.level),ze(c===this.geometryState.edgePeerNeighbors[l]);const u=s-c.level;if(!c.isLoaded)return ze(!c.isLeaf),void ze(u===0);const d=c.renderData;ze(eAt(e,c,a)),ze(u>=0);const p=2**u;if(u<0)return void ze(!1);const m=e.renderData,g=m.geometry,y=m.localOrigin,v=g.getEdgeCount(l),b=g.numVerticesPerSide-1,w=d.geometry;if(!w)return void ze(!1);const x=d.localOrigin,T=this.geometryState.edgePeerNeighbors[l];if(T!=null&&T.isLoaded){const X=T.renderData;ze(m.geometryState.edgePeerNeighborSamplerVersions[l]===X.geometryState.samplerDataVersion),ze(this.geometryState.edgePeerNeighborSamplerVersions[l]===X.geometryState.samplerDataVersion)}const C=(l+2)%4,M=w.getEdgeCount(C),O=v-1,D=M-1;ze(O*p===D,`Tile[${e.lij}]:e${l},res=${O} edgeRes mismatch with Neighbor[${c.lij}]:e${C},res=${D} (expected:${O*p})`);const k=e.extent,U=a===St.NORTH||a===St.SOUTH,H=M-1,z=H>>u,Z=v-1;if(z<1)return void ze(Z===1);ze(z===Z),ze(NI(z));const q=w.numVerticesPerSide-1;ze(u>0||z===Math.max(q,b));const Y=e.getNeighborEdgeStartVertexIndex(l,c);ze(0<=Y&&Y<p);const de=Y*z;ze(0<=de&&de<=H-z);let L=0,F=de;g.getEdgeVertexPosition(l,om,y,0),g.getEdgeVertexPosition(l,am,y,v-1);const j=wr(om,am),W=Math.max(cAt,1e-4*j);for(let X=0;X<=z;++X){g.getEdgeVertexPosition(l,om,y,L),w.getEdgeVertexPosition(C,am,x,F);const K=X/z,te=U?k[0]+K*(k[2]-k[0]):a===St.WEST?k[0]:k[2],he=U?a===St.SOUTH?k[1]:k[3]:k[1]+K*(k[3]-k[1]),we=e.surface.extent;if(we==null||fB(we,te,he)){const De=e1(om,am),at=Ml(om)-ir.radius,et=Ml(am)-ir.radius,Ke=De<W;if(!Ke){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${L}/${v}] and [${c.lij}].edge${C}[${F}/${M}]`),we!=null&&console.warn("  surface extent= ",we," x,y=",te,",",he);const si=E();ve(si,m.localOrigin,d.localOrigin),Ml(si)>0&&console.warn(`   localOrigins: ${m.localOrigin} vs ${d.localOrigin} d=${Ml(si)} [${si}]`),(()=>{const Ue=Xs(om),ui=Xs(am);e.updateEdgeElevations(),c.updateEdgeElevations(),g.getEdgeVertexPosition(l,om,y,L),w.getEdgeVertexPosition(C,am,x,F);const ke=E();Ai(ke,om,Ue),Ml(ke)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${Ue} vs ${om} d=${Ml(ke)} [${ke}]`),Ai(ke,am,ui),Ml(ke)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${ui} vs ${am} d=${Ml(ke)} [${ke}]`)})();const ei=g.getEdgeCount(l),Gi=w.getEdgeCount(M);ze(Ke,`Mismatch in tile [${e.lij}].edge[${l}][${L}/${ei}] vs neighbor [${c.lij}].edge[${C}][${F}/${Gi}] ${ly(om)} vs ${ly(am)}  dist=${De} h(t|n|d)=${at}|${et}|${et-at}`)}g.getEdgeNormal(l,I2,L),w.getEdgeNormal(C,L2,F),ge(oye,I2),ge(aye,L2);const Je=pe(oye,aye),Xe=1-Je<.01||!1||e===c;if(!Xe){const si=E();Ai(si,I2,L2);const ei=()=>`Mismatch in tile edge normal ${Wge(e.lij)} (${L}/${v-1}) edge ${l} vs neighbor ${Wge(c.lij)}  (${F}/${M-1}) nedge ${C} :${ly(I2)} vs ${ly(L2)}  dot = ${Je} : ${ly(si)}`;console.warn("Mismatch in tile edge normal: ",ei());{e.updateEdgeElevations(),c.updateEdgeElevations();const Gi=E(),Ue=E();g.getEdgeNormal(l,Gi,L),w.getEdgeNormal(C,Ue,F),LS(I2,Gi)||console.warn("Missing update in tile normal: ",ly(I2)," => ",ly(Gi)),LS(L2,Ue)||console.warn("Missing update in neighbor normal: ",ly(L2)," => ",ly(Ue))}ze(Xe,ei())}}L+=1,F+=1}})}};const om=E(),am=E(),I2=E(),L2=E(),oye=E(),aye=E(),cAt=1,gp=[null,null,null,null];function Nx(t,e){return e!=null&&e.isLoaded||e===t?e:null}const uAt=1,hAt=2,dAt=4,pAt=8,pq=4,fq=8,mq=12,Gse=[0,1,2,3],fAt=65536;function mAt(t,e){const{tile:i,geometry:r,geometryState:s}=t,{extentInRadians:n,surface:o}=i,{isWebMercator:a,renderer:l}=o,{numVerticesPerSide:c,wireframe:u}=s,d=c-1,p=(c-2)**2,m=a&&(e===Ed.HAS_SOUTH_POLE||e===Ed.HAS_BOTH_POLES),g=a&&(e===Ed.HAS_NORTH_POLE||e===Ed.HAS_BOTH_POLES),y=((m?1:0)+(g?1:0))*sk*c,v=xNe(s),b=p+y+4*v,w=l.tileGeometryCache.acquire(b);r.numVerticesPerSide=c,r.vertexAttributes=w,r.maxEdgeVertexCount=v;const{boundingBox:x}=r;Br(x);const T=Hse(t);Wo.update(d,n,T),yAt(t),r.poleVerticesStartIndex=p;const C=gAt(t,m,g);r.edgeVerticesStartIndex=p+y,Wse(t),jse(t),fNe(r,C,u),t.intersectionData=null}function gAt(t,e,i){const{tile:r,localOrigin:s,geometry:n}=t,{extent:o,ellipsoid:a}=r,{boundingBox:l,numVerticesPerSide:c,vertexAttributes:u,poleVerticesStartIndex:d}=n,p=c-1,m=s[0],g=s[1],y=s[2],v=a.radius,b=o[1],w=o[3],x=[];let T=d;const C=(M,O)=>{const D=O*c;kd(-m,-g,M*v-y,l),x.push(new DAt(M===1,D,M===1?0:2,T,sk));const k=uNe(M===-1?b:w,v),U=M*Math.PI/2-k,H=.99*(M===1?1:-1),z=v+0,{position:Z,uv0:q}=u,{typedBuffer:Y,typedBufferStride:de}=u.normalCompressed;for(let L=1;L<=sk;++L){const F=k+U*(L/sk),j=Math.cos(F),W=Math.sin(F);for(let X=0;X<=p;X++){const K=X/p,te=Wo.sinLonLUT[X],he=Wo.cosLonLUT[X]*j,we=te*j,De=W,at=he*z-m,et=we*z-g,Ke=De*z-y;kd(at,et,Ke,l),Z.setValues(T,at,et,Ke),bf(q,T,K,H),Wd(Y,T,he,we,De,de),++T}}};return e&&C(-1,0),i&&C(1,p),x}function yAt(t){const{tile:e}=t;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:s}=t,{numVerticesPerSide:n,samplerData:o}=r,a=n-2,l=n-1,{vertexAttributes:c,boundingBox:u}=i,d=c.position,p=c.uv0,{typedBuffer:m,typedBufferStride:g}=c.normalCompressed,{extent:y}=e,v=y[0],b=y[2],w=y[1],x=y[3],T=e.ellipsoid.radius,C=s[0],M=s[1],O=s[2],D=d.typedBuffer,k=d.typedBufferStride,U=1/l;let H=0;if(1<=a){const z=U,Z=w*(1-z)+x*z,q=Wo.sinLatLUT[1],Y=Wo.cosLatLUT[1];for(let de=1;de<=a;de++){const L=de*U,F=v*(1-L)+b*L,j=Wo.sinLonLUT[de],W=Wo.cosLonLUT[de],X=T+_s(F,Z,o),K=X*W*Y-C,te=X*j*Y-M,he=X*q-O;kd(K,te,he,u);const we=(de-1)*k;D[we]=K,D[we+1]=te,D[we+2]=he,bf(p,de-1,L,z)}}for(let z=1;z<=a;z++){const Z=z*U,q=w*(1-Z)+x*Z,Y=Wo.sinLatLUT[z],de=Wo.cosLatLUT[z],L=z+1,F=L*U,j=w*(1-F)+x*F,W=Wo.sinLatLUT[L],X=Wo.cosLatLUT[L],K=Wo.sinLonLUT[0],te=Wo.cosLonLUT[0],he=T+_s(v,q,o);let we=te*de*he-C,De=K*de*he-M,at=Y*he-O;const et=H*k;let Ke=D[et],Je=D[et+1],Xe=D[et+2];for(let si=1;si<=a;si++){const ei=si*U,Gi=v*(1-ei)+b*ei,Ue=Wo.sinLonLUT[si],ui=Wo.cosLonLUT[si];let ke=0,Ze=0,bt=0;if(si<a){const yi=(H+1)*k;ke=D[yi],Ze=D[yi+1],bt=D[yi+2]}else{const yi=Wo.sinLonLUT[l],Hr=Wo.cosLonLUT[l],ks=T+_s(b,q,o);ke=Hr*de*ks-C,Ze=yi*de*ks-M,bt=Y*ks-O}const kt=we,Qe=De,Pt=at;we=Ke,De=Je,at=Xe,Ke=ke,Je=Ze,Xe=bt;const Ne=ke-kt,rt=Ze-Qe,Ot=bt-Pt;let nr=0,xi=0,xr=0;if(z>1){const yi=(H-a)*k;nr=D[yi],xi=D[yi+1],xr=D[yi+2]}else{const yi=Wo.sinLatLUT[0],Hr=Wo.cosLatLUT[0],ks=T+_s(Gi,w,o);nr=ui*Hr*ks-C,xi=Ue*Hr*ks-M,xr=yi*ks-O}const Zi=T+_s(Gi,j,o),or=ui*X*Zi-C,Si=Ue*X*Zi-M,Xi=W*Zi-O;if(z<a){const yi=H+a,Hr=yi*k;D[Hr]=or,D[Hr+1]=Si,D[Hr+2]=Xi,kd(or,Si,Xi,u),bf(p,yi,ei,F)}const Oi=nr-or,hr=xi-Si,$t=xr-Xi;let fi=ui*de,Ri=Ue*de,Sr=Y;Sr*Sr<.999&&(fi=Ot*hr-rt*$t,Ri=Ne*$t-Ot*Oi,Sr=rt*Oi-Ne*hr);const un=1/Math.sqrt(fi*fi+Ri*Ri+Sr*Sr);Wd(m,H,fi*un,Ri*un,Sr*un,g),++H}}}function _At(t){t.tile.intersectsClippingArea&&(jse(t),sP(t),t.intersectionData=null)}function vAt(t){t.tile.intersectsClippingArea&&(yNe(t),jse(t),sP(t),bNe(t),t.intersectionData=null)}function bAt(t){t.tile.intersectsClippingArea&&(cNe(t),lNe(t,!0),sP(t),t.intersectionData=null)}function jse(t){t.tile.intersectsClippingArea&&(cNe(t),lNe(t))}function lNe(t,e=!1){const{geometry:i,geometryState:r,tile:s,localOrigin:n}=t,{level:o,extent:a,extentInRadians:l,ellipsoid:c}=s,u=c.radius,d=l[0],p=l[2],m=l[1],g=l[3],{samplerData:y}=r,v=a[0],b=a[2],w=a[1],x=a[3],T=Hse(t),{boundingBox:C,vertexAttributes:M}=i,O=n[0],D=n[1],k=n[2],U=M.position,H=U.typedBuffer,z=U.typedBufferStride,Z=M.uv0;for(let q=0;q<4;++q){const Y=q===1||q===3,de=r.edgeResolutions[q];ze(NI(de));const L=de+1,F=Nx(s,r.edgePeerNeighbors[q]);if(wNe(s,F,q)){_Ne(t,q,F);continue}const j=F!=null;ze(!j||F.level===s.level),ze(!j||ng(s,F)<=0);const W=F==null?void 0:F.renderData,X=W==null?void 0:W.geometryState;if(co){const Ne=s.surface;if(!F&&Ne&&!Ne.updatingRootTiles){const rt=pf[q],Ot=s.findNeighborTile(rt,nr=>nr.isLoaded||nr.isLeaf||nr.level===s.level);Ot?Ot.intersectsClippingArea&&(ze(!Ot.isLoaded),ze(!Ot.isLeaf),ze(Ot.level===o)):ze((Ne==null?void 0:Ne.rootTiles)==null||!s.shouldHaveNeighbor(rt))}}const K=q===1?a[2]:a[0],te=F==null?void 0:F.extent,he=te&&Y?q===1?te[0]:te[2]:K,we=q===0?a[3]:a[1],De=q===1?1:0,at=q===0?1:0,et=q===1?p:d,Ke=q===0?g:m,Je=Math.sin(et),Xe=Math.cos(et),si=Math.sin(Ke),ei=Math.cos(Ke),Gi=X==null?void 0:X.samplerData,Ue=j?(Ne,rt,Ot)=>.5*(_s(Ne,rt,y)+_s(Ot,rt,Gi)):(Ne,rt,Ot)=>_s(Ne,rt,y),ui=i.outerEdgesOffsetAndLength[2*q+0],ke=e&&L>3?L-3:1,Ze=y!=null&&y.some(Ne=>Ne!=null),bt=Gi!=null&&Gi.some(Ne=>Ne!=null),kt=Ze||bt,Qe=1/de,Pt=ui;ze(!te||Cd(te[2]-te[0],a[2]-a[0])),(()=>{const Ne=q===1?-1:q===3?1:0,rt=q===0?-1:q===2?1:0,Ot=(a[2]-a[0])*Qe,nr=Ne*Ot,xi=rt*Ot,xr=Y?Ne*((p-d)*Qe):0,Zi=Y?0:rt*Qe,or=at,Si=Y?et+xr:et,Xi=Y?Math.sin(Si):Je,Oi=Y?Math.cos(Si):Xe,hr=Y?et-xr:et,$t=Y?Math.sin(hr):Je,fi=Y?Math.cos(hr):Xe,Ri=Y?Ke:T(or+Zi),Sr=Y?si:Math.sin(Ri),un=Y?ei:Math.cos(Ri),yi=Y?Ke:T(or-Zi),Hr=Y?si:Math.sin(yi),ks=Y?ei:Math.cos(yi);let Fo=0,cl=0,ul=0;{const Ti=0*Qe,es=Y?K:v*(1-Ti)+b*Ti,Dn=Y?he:es,mo=Y?w*(1-Ti)+x*Ti:we,le=Y?et:d*(1-Ti)+p*Ti,er=Y?Je:Math.sin(le),tp=Y?Xe:Math.cos(le),go=Y?T(Ti):Ke,ip=Y?Math.sin(go):si,vt=Y?Math.cos(go):ei,Pc=u+Ue(es,mo,Dn);Fo=tp*vt*Pc,cl=er*vt*Pc,ul=ip*Pc}let ko=0,xn=0,Us=0;{const Ti=1*Qe,es=Y?K:v*(1-Ti)+b*Ti,Dn=Y?he:es,mo=Y?w*(1-Ti)+x*Ti:we,le=Y?et:d*(1-Ti)+p*Ti,er=Y?Je:Math.sin(le),tp=Y?Xe:Math.cos(le),go=Y?T(Ti):Ke,ip=Y?Math.sin(go):si,vt=Y?Math.cos(go):ei,Pc=u+Ue(es,mo,Dn);ko=tp*vt*Pc,xn=er*vt*Pc,Us=ip*Pc}for(let Ti=1;Ti<L-1;Ti+=ke){let es=0,Dn=0,mo=0;{const hl=(Ti+1)*Qe,Oc=Y?K:v*(1-hl)+b*hl,zf=Y?he:Oc,_o=Y?w*(1-hl)+x*hl:we,Es=Y?et:d*(1-hl)+p*hl,i_=Y?Je:Math.sin(Es),Eb=Y?Xe:Math.cos(Es),Cb=Y?T(hl):Ke,NT=Y?Math.sin(Cb):si,Mb=Y?Math.cos(Cb):ei,r_=u+Ue(Oc,_o,zf);es=Eb*Mb*r_,Dn=i_*Mb*r_,mo=NT*r_}const le=es,er=Dn,tp=mo,go=ko,ip=xn,vt=Us;ko=le,xn=er,Us=tp;{const hl=Pt+Ti,Oc=hl*z,zf=go-O,_o=ip-D,Es=vt-k;H[Oc]=zf,H[Oc+1]=_o,H[Oc+2]=Es,kd(zf,_o,Es,C);const i_=Ti*Qe;bf(Z,hl,Y?De:i_,Y?i_:at)}const Pc=Fo,yo=cl,xb=ul;Fo=go,cl=ip,ul=vt;const Sb=go,Hl=ip,jg=vt,Tb=1/Math.sqrt(Sb*Sb+Hl*Hl+jg*jg),ni=jg*Tb;let e_=0,Hg=0,t_=0;if(kt&&ni*ni<.999){let hl=0,Oc=0,zf=0;{const _o=q===0?-1:1;hl=_o*(le-Pc),Oc=_o*(er-yo),zf=_o*(tp-xb)}{const _o=Ti*Qe,Es=Y?K:v*(1-_o)+b*_o,i_=Y?he:Es,Eb=Y?w*(1-_o)+x*_o:we,Cb=Y?et:d*(1-_o)+p*_o,NT=Y?Je:Math.sin(Cb),Mb=Y?Xe:Math.cos(Cb),r_=Y?T(_o):Ke,KL=Y?Math.sin(r_):si,ql=Y?Math.cos(r_):ei;let lP=Sb,cP=Hl,J=jg;if(j){const be=u+_s(i_-nr,Eb-xi,Gi),Ie=Y?ql:ks;lP=(Y?fi:Mb)*Ie*be,cP=(Y?$t:NT)*Ie*be,J=(Y?KL:Hr)*be}{const be=u+_s(Es+nr,Eb+xi,y),Ie=Y?ql:un,Ei=(Y?Oi:Mb)*Ie*be,Sn=(Y?Xi:NT)*Ie*be,zs=(Y?KL:Sr)*be;j||(lP=2*Sb-Ei,cP=2*Hl-Sn,J=2*jg-zs);const dl=q===3?-1:1,Ab=dl*(lP-Ei),Jne=dl*(cP-Sn),Qne=dl*(J-zs);e_=zf*Jne-Oc*Qne,Hg=hl*Qne-zf*Ab,t_=Oc*Ab-hl*Jne;const zj=1/Math.sqrt(e_*e_+Hg*Hg+t_*t_);e_*=zj,Hg*=zj,t_*=zj}}}else e_=Sb*Tb,Hg=Hl*Tb,t_=jg*Tb;i.setEdgeNormalFromValues(q,Ti,e_,Hg,t_)}})()}}function cNe(t){vNe(t)}function uNe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function wAt(t,e,i,r){return uNe(t*(1-r)+e*r,i)}function xAt(t,e,i){return t*(1-i)+e*i}function Hse(t){const{tile:e}=t;if(e.surface.isWebMercator){const r=e.extent,s=e.ellipsoid.radius;return n=>wAt(r[1],r[3],s,n)}const i=e.extentInRadians;return r=>xAt(i[1],i[3],r)}function SAt(t,e){const{tile:i,geometryState:r,geometry:s}=t,{extent:n,surface:o}=i,{wireframe:a}=r,l=n[0],c=n[1],u=n[2]-l,d=n[3]-c,{numVerticesPerSide:p,clippingArea:m}=r,g=m!=null?Math.max(0,(m[0]-l)/u):0,y=m!=null?Math.max(0,(m[1]-c)/d):0,v=m!=null?Math.min(1,(m[2]-l)/u):1,b=m!=null?Math.min(1,(m[3]-c)/d):1,w=(p-2)**2,x=xNe(r),T=w+4*x,C=o.renderer.tileGeometryCache.acquire(T),{boundingBox:M}=s;Br(M),s.numVerticesPerSide=p,s.vertexAttributes=C,s.maxEdgeVertexCount=x,s.minu=g,s.minv=y,s.maxu=v,s.maxv=b,TAt(t),s.edgeVerticesStartIndex=w,Wse(t),qse(t),fNe(s,[],a),t.intersectionData=null}function TAt(t){const e=t.tile;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:s}=t,{samplerData:n,clippingArea:o,numVerticesPerSide:a}=r,{surface:l,extent:c,ellipsoid:u}=e,{isWebMercatorOnPlateCarree:d}=l,p=o??Yse,m=c[0],g=c[1],y=c[2],v=c[3],b=Math.max(m,p[0]),w=Math.min(y,p[2]),x=Math.max(g,p[1]),T=Math.min(v,p[3]),C=u.radius,M=e.horizontalScale,O=a-1,D=a-2,{minu:k,minv:U,maxu:H,maxv:z,boundingBox:Z,vertexAttributes:q}=i,Y=q.position,de=q.uv0,{typedBuffer:L,typedBufferStride:F}=q.normalCompressed,j=s[0],W=s[1],X=s[2],K=Y.typedBuffer,te=Y.typedBufferStride;let he=0;const we=Te(g,x,T),De=d?(Math.PI/2-2*Math.atan(Math.exp(-we/C)))*C:we*M,at=1/O,et=Te(g*(1-at)+v*at,x,T);let Ke=De,Je=d?(Math.PI/2-2*Math.atan(Math.exp(-et/C)))*C:et*M;for(let Xe=1;Xe<=D;Xe++){const si=Xe/O,ei=Te(g*(1-si)+v*si,x,T),Gi=Te(si,U,z),Ue=Je,ui=(Xe-1)/O,ke=Te(g*(1-ui)+v*ui,x,T),Ze=Ke,bt=(Xe+1)/O,kt=Te(g*(1-bt)+v*bt,x,T),Qe=d?(Math.PI/2-2*Math.atan(Math.exp(-kt/C)))*C:kt*M,Pt=Te(bt,U,z);Ke=Je,Je=Qe;const Ne=Te(m,b,w);let rt=Ne*M,Ot=_s(Ne,ei,n);const nr=1/O,xi=Te(nr,k,H),xr=Te(m*(1-xi)+y*xi,b,w);let Zi=xi,or=xr,Si=xr*M,Xi=_s(xr,ei,n);if(Xe===1){const Oi=Si-j,hr=Ke-W,$t=Xi-X,fi=0*te;K[fi]=Oi,K[fi+1]=hr,K[fi+2]=$t,kd(Oi,hr,$t,Z);const Ri=Te(nr,k,H);bf(de,he,Ri,Gi)}for(let Oi=1;Oi<=D;Oi++){const hr=Si,$t=Xi,fi=(Oi+1)/O,Ri=Te(fi,k,H),Sr=Te(m*(1-fi)+y*fi,b,w),un=or;or=Sr;{const xn=he+1,Us=xn*te;if(Xe===1||Oi===D){const Ti=Sr*M,es=_s(Sr,ei,n);if(Xe===1&&Oi<D){const Dn=Ti-j,mo=Ue-W,le=es-X;K[Us]=Dn,K[Us+1]=mo,K[Us+2]=le,kd(Dn,mo,le,Z),bf(de,xn,Ri,Gi)}Si=Ti,Xi=es}else Si=K[Us]+j,Xi=K[Us+2]+X}const yi=Si,Hr=Xi,ks=rt,Fo=Ot;rt=hr,Ot=$t;const cl=(he-D)*te,ul=Xe===1?_s(un,ke,n):K[cl+2]+X,ko=_s(un,kt,n);if(Xe<D){const xn=he+D,Us=xn*te,Ti=hr-j,es=Qe-W,Dn=ko-X;K[Us]=Ti,K[Us+1]=es,K[Us+2]=Dn,kd(Ti,es,Dn,Z);const mo=Zi;Zi=Ri,bf(de,xn,mo,Pt)}{const xn=yi-ks,Us=Ze-Qe,Ti=Us*(Hr-Fo),es=xn*(ul-ko),Dn=-Us*xn,mo=Ti*Ti+es*es+Dn*Dn;if(mo===0)Wd(L,he,0,0,1,F);else{const le=1/Math.sqrt(mo);Wd(L,he,Ti*le,es*le,Dn*le,F)}}++he}}}function EAt(t,e){t.tile.intersectsClippingArea&&(dNe(t),hNe(t,!0),sP(t),t.intersectionData=null)}function CAt(t,e){t.tile.intersectsClippingArea&&(yNe(t),qse(t),sP(t),bNe(t),t.intersectionData=null)}function MAt(t,e){t.tile.intersectsClippingArea&&(qse(t),sP(t),t.intersectionData=null)}function qse(t,e){t.tile.intersectsClippingArea&&(dNe(t),hNe(t,!1))}function hNe(t,e){const{geometry:i,geometryState:r,localOrigin:s}=t,n=t.tile,{surface:o,extent:a}=n,{clippingArea:l,samplerData:c}=r,u=l??Yse,d=a[0],p=a[2],m=a[1],g=a[3],y=[g>u[3],p>u[2],m<u[1],d<u[0]],v=n.horizontalScale,b=pNe(o.isWebMercatorOnPlateCarree,n.ellipsoid.radius,v),{minu:w,minv:x,maxu:T,maxv:C,boundingBox:M}=i,O=Math.max(d,u[0]),D=Math.min(p,u[2]),k=Math.max(m,u[1]),U=Math.min(g,u[3]),H=s[0],z=s[1],Z=s[2];for(let q=0;q<4;++q){const Y=q===1||q===3,de=r.edgeResolutions[q];ze(NI(de));const L=de+1,F=y[q],j=Nx(n,r.edgePeerNeighbors[q]);if(!F&&wNe(n,j,q)){_Ne(t,q,j);continue}const W=j!=null&&!F,X=j==null?void 0:j.renderData,K=X==null?void 0:X.geometryState;if(co&&(ze(!W||j.level===n.level),ze(!W||ng(n,j)<=0),n&&!j&&!o.updatingRootTiles)){const Qe=pf[q],Pt=n.findNeighborTile(Qe,Ne=>Ne.isLoaded||Ne.isLeaf||Ne.level===n.level);o.updatingRootTiles||(Pt?Pt.intersectsClippingArea&&(ze(!Pt.isLoaded),ze(!Pt.isLeaf),ze(Pt.level===n.level)):ze((o==null?void 0:o.rootTiles)==null||!n.shouldHaveNeighbor(Qe)))}const te=Te(q===1?p:d,O,D),he=Te(q===0?g:m,k,U),we=K==null?void 0:K.samplerData,De=e&&L>3?L-3:1,at=Te(q===1?1:0,w,T),et=Te(q===0?1:0,x,C),Ke=W?(Qe,Pt)=>.5*(_s(Qe,Pt,we)+_s(Qe,Pt,c)):(Qe,Pt)=>_s(Qe,Pt,c),Je=(p-d)/de,Xe=Y?q===1?Je:-Je:0,si=Y?0:q===0?Je:-Je,ei=-Xe,Gi=-si;let Ue=0,ui=0,ke=0;{const Qe=0/de,Pt=Y?te:Te(d*(1-Qe)+p*Qe,O,D),Ne=Y?Te(m*(1-Qe)+g*Qe,k,U):he,rt=Ke(Pt,Ne);Ue=Pt*v,ui=b(Ne),ke=rt}let Ze=0,bt=0,kt=0;{const Qe=1/de,Pt=Y?te:Te(d*(1-Qe)+p*Qe,O,D),Ne=Y?Te(m*(1-Qe)+g*Qe,k,U):he,rt=Ke(Pt,Ne);Ze=Pt*v,bt=b(Ne),kt=rt}for(let Qe=1;Qe<L-1;Qe+=De){const Pt=Qe/de,Ne=Ze,rt=bt,Ot=kt;{const $t=Y?at:Te(Pt,w,T),fi=Y?Te(Pt,x,C):et,Ri=Ne-H,Sr=rt-z,un=Ot-Z;kd(Ne,Sr,un,M),i.setEdgeVertexFromValuesRawPositionUV(q,Qe,Ri,Sr,un,$t,fi)}{const $t=(Qe+1)/de,fi=Y?te:Te(d*(1-$t)+p*$t,O,D),Ri=Y?Te(m*(1-$t)+g*$t,k,U):he,Sr=Ke(fi,Ri);Ze=fi*v,bt=b(Ri),kt=Sr}const nr=Ze,xi=kt,xr=Ue,Zi=ui,or=ke;Ue=Ne,ui=rt,ke=Ot;let Si=0,Xi=0,Oi=0;if(Y){const $t=bt-rt,fi=xi-Ot,Ri=Zi-rt,Sr=or-Ot,un=Te(m*(1-Pt)+g*Pt,k,U),yi=te+ei,Hr=yi*v-Ne,ks=_s(yi,un,c)-Ot,Fo=q===3?-1:1;if(Si=Fo*(-Ri+$t)*ks,Xi=Fo*Hr*(-Sr+fi),Oi=-Fo*Hr*(-Ri+$t),W){const cl=te+Xe,ul=cl*v-Ne;Si=(-Ri+$t)*(ks-(_s(cl,un,we)-Ot)),Xi=(Hr-ul)*(-Sr+fi),Oi=-(Hr-ul)*(-Ri+$t)}}else{const $t=nr-Ne,fi=xi-Ot,Ri=xr-Ne,Sr=or-Ot,un=Te(d*(1-Pt)+p*Pt,O,D),yi=he+Gi,Hr=_s(un,yi,c)-Ot,ks=b(yi)-rt,Fo=q===2?-1:1;if(Si=Fo*ks*(-Sr+fi),Xi=Fo*(-Ri+$t)*Hr,Oi=-Fo*ks*(-Ri+$t),W){const cl=un,ul=he+si,ko=b(ul)-rt;Si=(-ks+ko)*(-Sr+fi),Xi=(-Ri+$t)*(-Hr+(_s(cl,ul,we)-Ot)),Oi=-(-ks+ko)*(-Ri+$t)}}const hr=1/Math.sqrt(Si*Si+Xi*Xi+Oi*Oi);i.setEdgeNormalFromValues(q,Qe,Si*hr,Xi*hr,Oi*hr)}}}function dNe(t,e){vNe(t)}function AAt(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function PAt(t,e){return t*e}function pNe(t,e,i){return t?r=>AAt(r,e):r=>PAt(r,i)}function fNe(t,e,i){const{numVerticesPerSide:r,vertexAttributes:s,maxEdgeVertexCount:n}=t,o=r-1,a=s.count,l=2*(r-3)*(r-3),c=4*(o+n-3),u=Gse.reduce((y,v)=>y+(o+t.getEdgeCount(v)-3),0),d=e.reduce((y,v)=>y+o*(2*(v.latitudeResolution-1)+1),0),p=3*(i?2:1),m=(l+c+d)*p,g=a>=fAt?new Uint32Array(m):new Uint16Array(m);for(let y=0;y<m;++y)g[y]=0;t.indices=g,t.indexCount=(l+u+d)*p,t.poleIndicesStartIndex=l*p,t.edgeIndicesStartIndex=(l+d)*p,i?($At(t),IAt(t,e),gNe(t)):(OAt(t),RAt(t,e),mNe(t))}function OAt(t){const{numVerticesPerSide:e,indices:i,vertexAttributes:r}=t,{position:s}=r,{typedBuffer:n,typedBufferStride:o}=s,a=e-2,l=e-3,c=0,u=e-3;let d=0;for(let p=0;p<l;++p){const m=p*a;for(let g=c;g<u;++g){const y=m+g,v=y+1,b=v+a,w=b-1;SNe(y,v,b,w,o,n)?(i[d]=y,i[d+1]=v,i[d+2]=b,i[d+3]=b,i[d+4]=w,i[d+5]=y):(i[d]=y,i[d+1]=v,i[d+2]=w,i[d+3]=w,i[d+4]=v,i[d+5]=b),d+=6}}}function RAt(t,e){const{numVerticesPerSide:i,indices:r,poleIndicesStartIndex:s}=t,n=i-1;let o=s;for(const a of e){const l=a.isNorth?1:2,c=a.isNorth?2:1,u=a.isNorth?3:4,d=a.isNorth?4:3;let p=t.getEdgeVertexIndex(a.connectedOuterEdgeOffset,0),m=1;for(let g=0;g<a.latitudeResolution;++g){const y=g===0?a.rowOffset:p+i;for(let v=0;v<n;v++){const b=y+v;r[o]=p,r[o+l]=p+1,r[o+c]=b,g<a.latitudeResolution-1?(r[o+u]=p+1,r[o+d]=b+1,r[o+5]=b,o+=6):o+=3,p+=m}p=y,m=1}}}function mNe(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,s=i-1,n=s-2;let o=r;for(let a=0;a<4;++a){const l=Zse[a];let c=0,u=0;const d=t.getEdgeCount(a),p=l.count;ze(p===s-1);const m=a===1||a===2,g=m?1:2,y=m?2:1,v=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,x=l.stride;for(;c<d-1||u<p-1;){const T=w+u*x,C=v+c*b,M=c<d-1,O=u<p-1,D=M&&(!O||(M?0+s*(c+.5)/(d-1):0)<=(O?1+n*(u+.5)/(p-1):0));D?++c:++u;const k=D?C+b:T+x;e[o]=T,e[o+g]=C,e[o+y]=k,o+=3}}t.indexCount=o}function $At(t){const{indices:e,numVerticesPerSide:i,vertexAttributes:r}=t,{position:s}=r,{typedBuffer:n,typedBufferStride:o}=s,a=i-2;let l=0;for(let c=0;c<i-3;++c){const u=c*a;for(let d=0;d<i-3;++d){const p=c*a+d,m=p+1,g=m+a,y=g-1,v=u+d,b=v+1,w=b+a;SNe(v,b,w,w-1,o,n)?(EC(e,l,p,m,g),l+=6,EC(e,l,g,y,p)):(EC(e,l,p,m,y),l+=6,EC(e,l,y,g,m)),l+=6}}}function IAt(t,e){const{indices:i,numVerticesPerSide:r,poleIndicesStartIndex:s}=t,n=r-1;let o=s;for(const a of e){const l=a.connectedOuterEdgeOffset;let c=t.getEdgeVertexIndex(l,0),u=1;for(let d=0;d<a.latitudeResolution;++d){const p=d===0?a.rowOffset:c+r;for(let m=0;m<n;m++)EC(i,o,c,c+1,p+m),o+=6,d<a.latitudeResolution-1&&(EC(i,o,c+1,p+m+1,p+m),o+=6),c+=u;c=p,u=1}}}function gNe(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,s=i-1,n=s-2;let o=r;for(let a=0;a<4;++a){const l=Zse[a];let c=0,u=0;const d=t.getEdgeCount(a),p=l.count;ze(p===s-1);const m=a===1||a===2,g=m?1:3,y=m?3:1,v=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,x=l.stride;for(;c<d-1||u<p-1;){const T=w+u*x,C=v+c*b,M=c<d-1,O=u<p-1,D=M&&(!O||(M?0+s*(c+.5)/(d-1):0)<=(O?1+n*(u+.5)/(p-1):0));D?++c:++u;const k=D?C+b:T+x;e[o]=T,e[o+g]=C,e[o+g+1]=C,e[o+y]=k,e[o+y+1]=k,e[o+5]=T,o+=6}}t.indexCount=o}function Wse(t){const{geometry:e,geometryState:i}=t,{edgeResolutions:r}=i,{numVerticesPerSide:s,edgeVerticesStartIndex:n}=e,o=s-2;let a=n;for(let l=0;l<4;++l){{const c=l===0||l===2,u=(l===0?o-1:0)*o+(l===1?o-1:0),d=(c?0:1)*o+(c?1:0),p=Zse[l];p.vertex0Index=u,p.stride=d,p.count=o}{const c=r[l]+1;e.outerEdgesOffsetAndLength[2*l+0]=a,e.outerEdgesOffsetAndLength[2*l+1]=c,a+=c}}}function yNe(t){Wse(t),t.geometryState.wireframe?gNe(t.geometry):mNe(t.geometry)}function _Ne(t,e,i){const{geometryState:r,geometry:s,tile:n,localOrigin:o}=t,a=e===1||e===3,l=r.edgeResolutions[e];ze(NI(l));const c=l+1,{boundingBox:u,minu:d,minv:p,maxu:m,maxv:g,vertexAttributes:y}=s,v=Te(e===1?1:0,d,m),b=Te(e===0?1:0,p,g),w=i.renderData,x=w.geometryState,T=w.geometry,C=(e+2)%4,M=T.getEdgeCount(C),O=n.getNeighborEdgeStartVertexIndex(e,i)*l,D=l*2**(n.level-i.level);ze(x.edgeResolutions[C]===D),ze(M-1===D);const k=w.localOrigin[0]-o[0],U=w.localOrigin[1]-o[1],H=w.localOrigin[2]-o[2],z=s.getEdgeFirstVertexIndex(e),Z=y.position,q=Z.typedBuffer,Y=Z.typedBufferStride,de=y.normalCompressed,L=de.typedBuffer,F=de.typedBufferStride,j=y.uv0,W=T.vertexAttributes,X=T.getEdgeFirstVertexIndex(C),K=W.position.typedBuffer,te=W.position.typedBufferStride,he=W.normalCompressed.typedBuffer,we=W.normalCompressed.typedBufferStride;for(let De=1;De<c-1;++De){const at=z+De,et=X+(O+De),Ke=at*Y,Je=et*te,Xe=K[Je]+k,si=K[Je+1]+U,ei=K[Je+2]+H;q[Ke]=Xe,q[Ke+1]=si,q[Ke+2]=ei,kd(Xe,si,ei,u);const Gi=at*F,Ue=et*we;L[Gi]=he[Ue],L[Gi+1]=he[Ue+1];const ui=De/l,ke=a?v:Te(ui,d,m),Ze=a?Te(ui,p,g):b;bf(j,at,ke,Ze)}}function vNe(t){var Gi;const{geometry:e,geometryState:i,localOrigin:r}=t,{clippingArea:s,samplerData:n}=i,{minu:o,minv:a,maxu:l,maxv:c,boundingBox:u,vertexAttributes:d}=e,p=t.tile,{surface:m,ellipsoid:g,extent:y,extentInRadians:v,horizontalScale:b}=p,w=((Gi=m.view)==null?void 0:Gi.viewingMode)==="local",x=g.radius;let T=0,C=0,M=0;const O=(Ue,ui,ke)=>{const Ze=v[ui===0?1:3],bt=v[Ue===0?0:2],kt=Math.cos(Ze),Qe=Math.sin(Ze),Pt=Math.sin(bt),Ne=Math.cos(bt),rt=x+ke;T=Ne*kt*rt,C=Pt*kt*rt,M=Qe*rt},D=w?(()=>{const Ue=s,ui=Ue!=null&&(y[3]>Ue[3]||y[2]>Ue[2]||y[1]<Ue[1]||y[0]<Ue[0]),ke=pNe(m.isWebMercatorOnPlateCarree,x,b);return(Ze,bt,kt)=>{const Qe=Ze===0?y[0]:y[2],Pt=bt===0?y[1]:y[3],Ne=ui?Te(Qe,Ue[0],Ue[2]):Qe,rt=ui?Te(Pt,Ue[1],Ue[3]):Pt,Ot=kt;T=Ne*b,C=ke(rt),M=Ot}})():O;let k=0,U=0,H=0,z=0,Z=0,q=0,Y=0,de=0,L=0;const F=w&&m.isWebMercatorOnPlateCarree,j=(Ue,ui,ke,Ze,bt)=>{let kt=0,Qe=0,Pt=0;if(w){const Ne=ui*b,rt=F?(Math.PI/2-2*Math.atan(Math.exp(-ke/x)))*x:ke*b;kt=Ne-T,Qe=rt-C,Pt=Ze-M}else{const Ne=Hse(Ue),rt=Ue.tile,Ot=rt.extent,nr=rt.extentInRadians,xi=(ui-Ot[0])/(Ot[2]-Ot[0]),xr=(ke-Ot[1])/(Ot[3]-Ot[1]),Zi=nr[0]*(1-xi)+nr[2]*xi,or=Ne(xr),Si=Math.cos(or),Xi=Math.sin(or),Oi=Math.sin(Zi),hr=Math.cos(Zi),$t=x+Ze;kt=hr*Si*$t-T,Qe=Oi*Si*$t-C,Pt=Xi*$t-M}switch(bt){case 0:Y+=kt,de+=Qe,L+=Pt;break;case 1:z-=kt,Z-=Qe,q-=Pt;break;case 2:Y-=kt,de-=Qe,L-=Pt;break;case 3:z+=kt,Z+=Qe,q+=Pt}},W=s??Yse,X=y[0],K=y[2],te=y[1],he=y[3],we=[he>W[3],K>W[2],te<W[1],X<W[0]],De=Math.max(X,W[0]),at=Math.min(K,W[2]),et=Math.max(te,W[1]),Ke=Math.min(he,W[3]),Je=Ue=>Math.max(W[0],Math.min(W[2],Ue)),Xe=Ue=>Math.max(W[1],Math.min(W[3],Ue)),si=Ue=>{const ui=i.cornerNeighborCornerTiles;k=0,U=0,H=1,z=0,Z=0,q=0,Y=0,de=0,L=0;let ke=1/0;for(let Ne=0;Ne<4;++Ne){const rt=ui[4*Ue+Ne];ke=Math.min(ke,(rt==null?void 0:rt.level)??1/0)}for(let Ne=0;Ne<4;++Ne){const rt=ui[4*Ue+Ne];fO[Ne]=(rt==null?void 0:rt.level)===ke?rt:null}let Ze=1,bt=0;for(let Ne=0;Ne<4;++Ne){const rt=fO[Ne];rt&&(Ze=Math.max(Ze,rt==null?void 0:rt.renderData.geometryState.numVerticesPerSide),bt=rt.extent[2]-rt.extent[0])}const kt=bt,Qe=Ze;ze(Qe>1);const Pt=kt/Qe;for(let Ne=0;Ne<4;++Ne){const rt=fO[(Ne+3)%4],Ot=fO[Ne%4];if(!rt&&!Ot)continue;const nr=Ne===0?1:Ne===1?2:Ne===2?3:0,xi=Ne===0?2:Ne===1?3:Ne===2?0:1;if(rt&&Ot){const xr=gq[Ne][0]*Pt,Zi=gq[Ne][1]*Pt,or=rt.extent,Si=Je(or[nr===0||nr===1?2:0]+xr),Xi=Xe(or[nr===0||nr===3?3:1]+Zi),Oi=Ot.extent,hr=Je(Oi[xi===0||xi===1?2:0]+xr),$t=Xe(Oi[xi===0||xi===3?3:1]+Zi),fi=rt.renderData,Ri=Ot.renderData,Sr=_s(Si,Xi,fi.geometryState.samplerData),un=_s(hr,$t,Ri.geometryState.samplerData);j(fi,Si,Xi,.5*(Sr+un),Ne)}else{const xr=rt??Ot,Zi=rt?nr:xi,or=xr.extent,Si=gq[Ne],Xi=Je(or[Zi===0||Zi===1?2:0]+Si[0]*Pt),Oi=Xe(or[Zi===0||Zi===3?3:1]+Si[1]*Pt),hr=xr.renderData,$t=_s(Xi,Oi,hr.geometryState.samplerData);j(hr,Xi,Oi,$t,Ne)}}if(!w){const Ne=Math.sqrt(T*T+C*C+M*M);k=T/Ne,U=C/Ne,H=M/Ne}if(w||H*H<.999){const Ne=Math.sqrt(z*z+Z*Z+q*q);z/=Ne,Z/=Ne,q/=Ne;const rt=Math.sqrt(Y*Y+de*de+L*L);Y/=rt,de/=rt,L/=rt,k=q*de-Z*L,U=z*L-q*Y,H=Z*Y-z*de;const Ot=1/Math.sqrt(k*k+U*U+H*H);k*=Ot,U*=Ot,H*=Ot}},ei=i.cornerNeighborCornerTiles;for(let Ue=0;Ue<4;++Ue){const ui=Ue,ke=(Ue+1)%4,Ze=Ue===0||Ue===1?1:0,bt=Ue===0||Ue===3?1:0,kt=Te(Ze,o,l),Qe=Te(bt,a,c),Pt=e.getEdgeFirstVertexIndex(ui),Ne=e.getEdgeCount(ui),rt=Ue===0||Ue===3?Ne-1:0,Ot=e.getEdgeFirstVertexIndex(ke),nr=e.getEdgeCount(ke),xi=Ue===0||Ue===1?nr-1:0;let xr=-1;for(let Si=0;Si<4;++Si){const Xi=ei[4*Ue+Si],Oi=ei[4*Ue+xr];Xi&&(xr===-1||ng(Oi,Xi)>0)&&(xr=Si)}const Zi=xr,or=ei[4*Ue+Zi];if(or!==p){const Si=p.level-or.level,Xi=2**Si,Oi=[or.lij[0]+Si,or.lij[1]*Xi,or.lij[2]*Xi],hr=[Oi[1]+Xi===p.lij[1],Ue===0&&(Zi===1||Zi===0&&or!==ei[4*Ue+3])||Ue===1&&(Zi===0||Zi===1&&or!==ei[4*Ue+2]),Oi[1]===p.lij[1]+1,Ue===2&&(Zi===3||Zi===2&&or!==ei[4*Ue+1])||Ue===3&&(Zi===2||Zi===3&&or!==ei[4*Ue+0])],$t=hr.reduce((yi,Hr)=>yi+(Hr?1:0),0);ze($t===1||$t===2);let fi=-1,Ri=-1;const Sr=or.renderData;if($t===1){const yi=hr.findIndex(ks=>ks);ze(0<=yi&&yi<=3),fi=(yi+2)%4;const Hr=i.edgeResolutions[yi];Ri=p.getNeighborEdgeStartVertexIndex(yi,or)*Hr+Hr*(yi===0&&Ue===0||yi===1&&Ue===0||yi===2&&Ue===1||yi===3&&Ue===3?1:0)}else{ze(hr[1]||hr[3]),fi=hr[1]?3:1;const yi=Sr.geometryState.edgeResolutions[fi];Ri=Ue===0||Ue===3?0:yi}const un=Sr.geometry;{const yi=Pt+rt,Hr=Ot+xi,ks=un.getEdgeFirstVertexIndex(fi)+Ri,Fo=un.vertexAttributes,cl=Sr.localOrigin;{const ko=Fo.position,xn=ko.typedBuffer,Us=ks*ko.typedBufferStride,Ti=xn[Us]+cl[0]-r[0],es=xn[Us+1]+cl[1]-r[1],Dn=xn[Us+2]+cl[2]-r[2];kd(Ti,es,Dn,u);const mo=d.position,le=mo.typedBuffer;{const er=yi*mo.typedBufferStride;le[er]=Ti,le[er+1]=es,le[er+2]=Dn}{const er=Hr*mo.typedBufferStride;le[er]=Ti,le[er+1]=es,le[er+2]=Dn}}const ul=d.uv0;bf(ul,yi,kt,Qe),bf(ul,Hr,kt,Qe);{const ko=Fo.normalCompressed.typedBuffer,xn=ks*Fo.normalCompressed.typedBufferStride,Us=d.normalCompressed,Ti=Us.typedBuffer;{const es=yi*Us.typedBufferStride;Ti[es]=ko[xn],Ti[es+1]=ko[xn+1]}{const es=Hr*Us.typedBufferStride;Ti[es]=ko[xn],Ti[es+1]=ko[xn+1]}}}}else{const Si=we[ui],Xi=we[ke];let Oi;if(Si||Xi){const Ri=Te(X*(1-Ze)+K*Ze,De,at),Sr=Te(te*(1-bt)+he*bt,et,Ke);Oi=_s(Ri,Sr,n)}else Oi=LAt(ei,Ue);D(Ze,bt,Oi),si(Ue);const hr=T-r[0],$t=C-r[1],fi=M-r[2];kd(hr,$t,fi,u),e.setEdgeVertexFromValuesRawPositionUVNormal(ui,rt,hr,$t,fi,kt,Qe,k,U,H),e.setEdgeVertexFromValuesRawPositionUVNormal(ke,xi,hr,$t,fi,kt,Qe,k,U,H)}}for(let Ue=0;Ue<4;++Ue)fO[Ue]=null}function LAt(t,e){var a,l;const i=4*e,r=Gse.reduce((c,u)=>{var d;return Math.min(c,((d=t[i+u])==null?void 0:d.level)??1/0)},1/0);co&&(ze(!t[i+0]||!t[i+2]||_J(t[i+0],t[i+2],St.SOUTH_WEST)),ze(!t[i+1]||!t[i+3]||_J(t[i+1],t[i+3],St.NORTH_WEST)));let s=0,n=0;for(let c=0;c<4;++c){const u=t[i+c];if(u&&u.level===r){const d=c===0||c===1,p=c===0||c===3,m=u.extent,g=m[d?0:2],y=m[p?1:3],v=(l=(a=u.renderData)==null?void 0:a.geometryState)==null?void 0:l.samplerData;n+=_s(g,y,v),s++}}const o=s?n/s:0;return ze(o!=null),o}function sP(t){const{vao:e,geometry:i}=t,{vertexAttributes:r,edgeVerticesStartIndex:s}=i,n=r.position.typedBuffer;e.vertexBuffers.geometry.setSubData(n,s,s,n.length)}function bNe(t){const{vao:e,geometry:i}=t,{indices:r,indexCount:s,edgeIndicesStartIndex:n}=i;e.indexBuffer.setSubData(r,n,n,s)}let DAt=class{constructor(e,i,r,s,n){this.isNorth=e,this.connectedRowOffset=i,this.connectedOuterEdgeOffset=r,this.rowOffset=s,this.latitudeResolution=n}};const gq=[[0,1],[1,0],[0,-1],[-1,0]],Wo=new IMt,Yse=Z3(-1/0,-1/0,1/0,1/0),fO=[null,null,null,null];function wNe(t,e,i){if(!e)return!1;const r=ng(t,e);return r>0||r===0&&i>=2}let UF=class{constructor(){this.vertex0Index=0,this.stride=1,this.count=0}getVertexIndex(e){return ze(0<=e&&e<this.count),this.vertex0Index+this.stride*e}};const Zse=[new UF,new UF,new UF,new UF];function kd(t,e,i,r){t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}function xNe(t){const{edgeResolutions:e,numVerticesPerSide:i}=t,r=1+Math.max(...e);return Math.max(i,r)}function SNe(t,e,i,r,s,n){const o=t*s,a=n[o],l=n[o+1],c=n[o+2],u=e*s,d=n[u],p=n[u+1],m=n[u+2],g=i*s,y=n[g],v=n[g+1],b=n[g+2],w=r*s,x=n[w],T=n[w+1],C=n[w+2];return(d-x)*(d-x)+(p-T)*(p-T)+(m-C)*(m-C)>(a-y)*(a-y)+(l-v)*(l-v)+(c-b)*(c-b)}function EC(t,e,i,r,s){t[e]=i,t[e+1]=r,t[e+2]=r,t[e+3]=s,t[e+4]=s,t[e+5]=i}const sk=6;let NAt=class extends kse{constructor(e,i,r,s,n){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Ht(),this._baseUsedMemory=900,this._subtreeGeometryElevationBoundMin=0,this._subtreeGeometryElevationBoundMax=0,this.init(e,i,r,s,n)}init(e,i,r,s,n){super.init(e,i,r,s,n);const o=n.view.renderSpatialReference,a=n.spatialReference,l=o!=null&&NS(o)&&a!=null&&a.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;const{isWebMercatorOnPlateCarree:c}=n,u=this._extentInRenderSR,d=this.extent;if(c){const p=$e(d[0],d[1],0);Zn(p,We.WebMercator,p,We.PlateCarree);const m=$e(d[2],d[3],0);Zn(m,We.WebMercator,m,We.PlateCarree),u[0]=p[0],u[1]=p[1],u[2]=m[0],u[3]=m[1]}else for(let p=0;p<4;++p)u[p]=d[p]*l;this.centerAtSeaLevel[0]=.5*(u[0]+u[2]),this.centerAtSeaLevel[1]=.5*(u[1]+u[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(u[2]-u[0],u[3]-u[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,i=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBoundsMax-this.elevationBoundsMin),o=Math.max(s,n);this._center[fn.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const i=this._aabb(),r=i[0],s=i[1],n=i[2],o=i[3],a=i[4],l=i[5];let c=!0;for(let u=0;u<6;u++){const d=e[u],p=d[0],m=d[1],g=d[2],y=d[3];if(p*(p>0?r:o)+m*(m>0?s:a)+g*(g>0?n:l)+y>=0)return Ga.OUTSIDE;c=c&&p*(p<0?r:o)+m*(m<0?s:a)+g*(g<0?n:l)+y<=0}return c?Ga.INSIDE:Ga.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return bKe(e[0],e[1],Math.min(this.elevationBoundsMin,this._subtreeGeometryElevationBoundMin),e[2],e[3],Math.max(this.elevationBoundsMax,this._subtreeGeometryElevationBoundMax))}intersectsRay(e,i,r,s){return zF[0]=1/i[0],zF[1]=1/i[1],zF[2]=1/i[2],Sre(this._aabb(),e,zF,r,s)}createGeometry(){SAt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds(),this.setMemoryDirty()}_updateSubtreeGeometryElevationsBounds(){const e=this._subtreeGeometryElevationBoundMin,i=this._subtreeGeometryElevationBoundMax,r=this.renderData;let s=e,n=i;if(r){const o=r.geometry.boundingBox;s=o[2],n=o[5]}else if(!this.isLeaf){s=1/0,n=-1/0;for(const o of this.children)s=Math.min(s,o._subtreeGeometryElevationBoundMin),n=Math.max(n,o._subtreeGeometryElevationBoundMax)}if(s!==this._subtreeGeometryElevationBoundMin||n!==this._subtreeGeometryElevationBoundMax){this._subtreeGeometryElevationBoundMin=s,this._subtreeGeometryElevationBoundMax=n;const o=this.parent;o==null||o._updateSubtreeGeometryElevationsBounds()}}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){EAt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevations(){MAt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevationsAndResolutions(){CAt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}get horizontalScale(){return this._horizontalScaleFactor}};const zF=E();let FAt=class{constructor(){this.extent=Qt(),this.minLevel=0,this.maxLevel=0,this.callback=null}},nk=class extends Re{constructor(){super(...arguments),this._queries=new Zt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Zt({initialSize:30}),this._queryPool=new Ca(FAt)}queryVisibleLevelRange(e,i,r,s){const n=this._queryPool.acquire();Rd(n.extent,e),n.minLevel=i??-Number.MAX_VALUE,n.maxLevel=r??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const i=this._queries.data[e];this._queryPool.release(i),i.callback(e>=this._queriesInvPtr),i.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const i=e.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};h([f()],nk.prototype,"updating",null),nk=h([I("esri.views.3d.terrain.ScaleRangeQueries")],nk);function kAt(t,e,i,r){const s=Math.cos(i);t[0]=Math.cos(e)*s*r,t[1]=Math.sin(e)*s*r,t[2]=Math.sin(i)*r}let UAt=class extends kse{constructor(e,i,r,s,n){super(),this._convexHull=new Array(24),this._boundingSphere=ln(),this._baseUsedMemory=1816,this.init(e,i,r,s,n)}init(e,i,r,s,n){super.init(e,i,r,s,n);const o=this.ellipsoid.radius,a=this.extentInRadians[0],l=this.extentInRadians[1],c=this.extentInRadians[2],u=this.extentInRadians[3],d=Dt(l,u,.5),p=Dt(a,c,.5),m=e===0?0:Math.min(Math.abs(l),Math.abs(u));this._edgeLen=(c-a)*Math.cos(m)*o,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=o-Math.sqrt(o*o-this._edgeLen2/4),kAt(this.centerAtSeaLevel,p,d,this.ellipsoid.radius),ge(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)ne(e[fn.MIDDLE],0,0,0),ne(e[fn.TOP],0,0,0),ne(e[fn.BOTTOM],0,0,0),e[fn.MIDDLE][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();const i=e[fn.MIDDLE],r=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,zAt(i,r,3*n));e[fn.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(e){if(!Zv(e,this._boundingSphere))return Ga.OUTSIDE;if(this.lij[0]<10)return Ga.INTERSECTS;const i=this.convexHull,r=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<WA;n++){const o=n===_r.NEAR,a=e[n],l=a[0],c=a[1],u=a[2],d=a[3]-(o?r:0);let p=!1;for(let m=0;m<8;++m){const g=3*m;if(l*i[g]+c*i[g+1]+u*i[g+2]+d<0){if(p=!0,!s)break}else s=!1}if(!p)return Ga.OUTSIDE}return s?Ga.INSIDE:Ga.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){mAt(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),co&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,i=e,r=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this.ellipsoid.radius,o=s;if(this.level===0)ne(i,0,0,0),e[3]=n+o;else{const a=this.extentInRadians,l=.5*(a[0]+a[2]),c=a[1],u=a[3];hw(uye,l,c,n),hw(hye,l,u,n),me(i,uye,hye),oe(i,i,(n+.5*(r+s))/Ml(i));const d=this.convexHull;let p=0;const m=(y,v)=>{const b=y[0]-d[3*v],w=y[1]-d[3*v+1],x=y[2]-d[3*v+2];return Math.sqrt(b*b+w*w+x*x)};for(let y=0;y<8;++y){const v=m(i,y);p=Math.max(p,v)}const g=p;e[3]=g+2}}_updateConvexHull(){const e=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this._getPatchType(),o=this.surface.isWebMercator,a=o&&n===Ed.HAS_NORTH_POLE,l=o&&n===Ed.HAS_SOUTH_POLE,c=l||a,u=Math.PI/2,d=e[0],p=e[2],m=l?-u:e[1],g=a?u:e[3],y=.5*(d+p),v=r,b=i+(c?Math.min(0,v-1):v),w=(L,F,j)=>hw(L,F,j,b),x=E(),T=E(),C=E(),M=E();w(x,d,m),w(T,d,g),w(C,p,g),w(M,p,m);const O=(L,F)=>{for(let j=0;j<3;++j)this._convexHull[3*F+j]=L[j]};O(x,0),O(T,1),O(C,2),O(M,3);const D=s,k=i+(c?Math.max(0,D+1):D),U=E(),H=E(),z=E();hw(H,y,g,b),hw(z,y,m,b),me(U,H,z),ge(U,U);const Z=E(),q=E(),Y=(L,F)=>{Ai(q,L,F),ge(q,q);const j=-pe(L,Z)/pe(q,Z);ze(j>=0),oe(q,q,j),me(L,L,q)};if(2**this.lij[0]>2*this.lij[1]){const L=z,F=E();ot(F,cye,L),ge(F,F),ot(Z,L,F),ge(Z,Z),ze(Cd(pe(Z,L)/Ml(L),0)),Y(x,T),Y(M,C),O(x,0),O(M,3)}else if(2**this.lij[0]!==2*this.lij[1]){const L=H,F=E();ot(F,cye,L),ge(F,F),ot(Z,F,L),ge(Z,Z),Y(T,x),Y(C,M),O(T,1),O(C,2)}const de=(L,F)=>{const j=k/pe(F,U);for(let W=0;W<3;++W)this._convexHull[3*L+W]=F[W]*j};de(4,x),de(5,T),de(6,C),de(7,M)}_getPatchType(){const e=this.lij[1],i=e===0,r=e===(1<<this.level)-1;return i?r?Ed.HAS_BOTH_POLES:Ed.HAS_NORTH_POLE:r?Ed.HAS_SOUTH_POLE:Ed.REGULAR}intersectsRay(e,i,r,s){const n=this._boundingSphere,o=n[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-e[0],c=n[1]-e[1],u=n[2]-e[2],d=(l*i[0]+c*i[1]+u*i[2])/a,p=i[0]*d-l,m=i[1]*d-c,g=i[2]*d-u;return p*p+m*m+g*g<o*o}getDefaultVerticesPerSide(){return this.level<lye.length?lye[this.level]+1:2}updateCornerElevations(){bAt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){_At(this.renderData),this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){vAt(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var ui;if(!co||this.level<=2)return;const e=this._boundingSphere,i=e[3],r=e,s=E(),n=this.ellipsoid.radius,o=this.elevationBoundsMin,a=this.elevationBoundsMax,l=n+o,c=1,u=0,d=this._center[fn.MIDDLE][3],p=this.convexHull,m=(ke,Ze)=>{for(let bt=0;bt<3;++bt)ke[bt]=p[3*Ze+bt]};{const ke=E(),Ze=E(),bt=E(),kt=E(),Qe=E(),Pt=(Ne,rt,Ot,nr)=>{m(Ze,Ne),m(bt,rt),m(kt,Ot),Ai(Ze,Ze,bt),Ai(kt,kt,bt),ot(ke,Ze,kt),ge(ke,ke);const xi=pe(ke,bt);m(Qe,nr);const xr=pe(ke,Qe),Zi=Math.abs(xr-xi);ze(Cd(Zi,0),`Non coplanar ${Ne},${rt},${Ot},${nr} diff = ${Zi}`)};Pt(0,1,2,3),Pt(4,5,6,7),Pt(0,1,4,5),Pt(1,2,5,6),Pt(2,3,6,7),Pt(3,0,7,4)}const g=ho(24),y=(ke,Ze,bt)=>{const kt=4*ke;for(let Qe=0;Qe<3;++Qe)g[kt+Qe]=Ze[Qe];g[kt+3]=bt},v=E(),b=E(),w=E(),x=E(),T=(ke,Ze,bt,kt)=>{m(v,Ze),m(b,bt),m(w,kt),Ai(v,v,b),ge(v,v),Ai(w,w,b),ge(w,w),ot(x,v,w),ge(x,x);const Qe=pe(x,b);y(ke,x,Qe)};T(0,0,1,2),T(1,1,0,4),T(2,1,5,2),T(3,3,2,6),T(4,4,0,3),T(5,4,6,5);const C=1,M=(ke,Ze,bt,kt)=>{const Qe=4*ke;return g[Qe]*Ze+g[Qe+1]*bt+g[Qe+2]*kt-g[Qe+3]},O=(ke,Ze,bt,kt)=>M(ke,Ze,bt,kt)>=-C,D=(ke,Ze)=>O(ke,Ze[0],Ze[1],Ze[2]),k=2**this.lij[0]>2*this.lij[1],U=(ke,Ze,bt)=>Math.sqrt(TNe(ke,Ze,bt,r[0],r[1],r[2]))<i,H=ke=>U(ke[0],ke[1],ke[2]),z=(ke,Ze)=>U(ke[Ze],ke[Ze+1],ke[Ze+2]),Z=this.extentInRadians,q=.5*(Z[0]+Z[2]),Y=Z[1],de=Z[3],L=E(),F=E();hw(L,q,de,l),hw(F,q,Y,l);const j=k?"Upper":"Lower";let W=!0;for(let ke=0;ke<6;++ke){for(let Ze=0;Ze<8;++Ze){const bt=3*Ze,kt=O(ke,p[bt],p[bt+1],p[bt+2]);W&&(W=kt),ze(kt,`Tile[${this.lij}] Convex hull point ${Ze} outside of plane ${ke}`)}ze(D(ke,F),`Tile[${this.lij}] (${j}) bottom mid outside of plane ${ke}`),ze(D(ke,L),`Tile[${this.lij}] (${j}) top mid outside of plane ${ke}`)}ze(W,"Not all convex hull points are inside  convex hull polyhedron"),ze(H(F),`Tile[${this.lij}] (${j}) bottom mid outside of bounding sphere`),ze(H(L),`Tile[${this.lij}] (${j}) top mid outside of bounding sphere`);for(let ke=0;ke<8;++ke){const Ze=z(p,3*ke);ze(Ze,`Tile[${this.lij}] Convex hull point ${ke} outside of bounding sphere`)}for(let ke=0;ke<6;++ke)for(let Ze=0;Ze<8;++Ze){const bt=3*Ze;O(ke,p[bt],p[bt+1],p[bt+2])||console.error(`Tile[${this.lij}] Convex hull point ${Ze} outside of plane ${ke}`)}const{extentInRadians:X}=this,K=Math.max(X[2]-X[0],X[3]-X[1]),te=Math.round(K*n),{renderData:he}=this;if(!he)return;const{geometry:we,geometryState:De,localOrigin:at}=he,et=(ui=we.vertexAttributes)==null?void 0:ui.position;if(!et)return;const Ke=E(),Je=we.numVerticesPerSide-2,{indices:Xe,indexCount:si,edgeVerticesStartIndex:ei,poleVerticesStartIndex:Gi}=we;if(!Xe)return;const Ue=new Set;for(let ke=0;ke<si;++ke){const Ze=Xe[ke];if(Ue.has(Ze))continue;Ue.add(Ze);const bt=Ze<Gi,kt=Ze>=ei;let Qe=!1,Pt=-1;if(kt){let $t=ei;for(let fi=0;fi<4;++fi){const Ri=De.edgeResolutions[fi];if(Ze===$t||Ze===$t+Ri-1){Qe=!0;break}if($t+=Ri,Ze<$t){Pt=fi;break}}}const Ne=kt?De.edgePeerNeighbors[Pt]:null,rt=kt&&Ne&&ng(this,Ne)>0;et.getVec(Ze,s),me(Ke,s,at);const Ot=Ml(Ke)-n;let nr=0,xi=!1;const xr=o-Ot,Zi=Ot-a,or=xr>c,Si=Zi>c,Xi=or||Si,Oi=()=>{const $t=bt?"internal":kt&&!Qe?"edge":Qe?"corner":"pole";return`Tile[${this.lij}].vertex[${Ze}]:${$t}`+(or?"(below)":Si?"(above)":"")+(rt?"(Neighbor)":"")},hr=e1(Ke,r);if(hr>=i+u){const $t=hr-i;Xi||(console.error(`${Oi()} is out of the bounding sphere by ${$t.toFixed(0)} / ${i.toFixed(0)}[tol=${u}] h=${Ot.toFixed(0)} / [${o.toFixed(0)}..${a.toFixed(0)}] (${($t/i).toFixed(0)})`),xi=!0)}for(let $t=0;$t<6;++$t)if(!O($t,Ke[0],Ke[1],Ke[2])){const fi=M($t,Ke[0],Ke[1],Ke[2]),Ri=Ze%Je,Sr=(Ze-Ri)/Je;$t===0&&xr||$t===5&&Zi||(console.error(`${Oi()} (${Ri},${Sr})|${Je}] is out of the bounding trapezoid plane ${$t} h=${Math.round(Ot)} / [${Math.round(o)}..${Math.round(a)}] dist=${Math.round(fi)} radii = ${Math.round(i)}/${Math.round(d)}} : maxL = ${te}`),++nr)}if(xi||nr>0)break}}get convexHull(){return this._convexHull}};const lye=[128,64,64,32,16,8,8,4];function zAt(t,e,i){return TNe(t[0],t[1],t[2],e[i],e[i+1],e[i+2])}function TNe(t,e,i,r,s,n){const o=r-t,a=s-e,l=n-i;return o*o+a*a+l*l}const hw=(t,e,i,r)=>{const s=Math.cos(e),n=Math.sin(e),o=Math.cos(i),a=Math.sin(i);t[0]=r*o*s,t[1]=r*o*n,t[2]=r*a},cye=[0,0,1],uye=E(),hye=E();let $p=class extends Re{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};h([f()],$p.prototype,"fovX",void 0),h([f()],$p.prototype,"fovY",void 0),h([f()],$p.prototype,"relativeWidthLimit",void 0),h([f()],$p.prototype,"relativeHeightLimit",void 0),h([f()],$p.prototype,"maxLod",void 0),h([f()],$p.prototype,"angledSplitBias",void 0),h([f()],$p.prototype,"aboveGround",void 0),h([f()],$p.prototype,"frustum",void 0),$p=h([I("esri.views.3d.terrain.SplitLimits")],$p);const VAt=Ts().vec3f(R.POSITION).vec2i16(R.UV0).vec2i16(R.NORMALCOMPRESSED,{glNormalized:!0});let BAt=class{constructor(e){this._storage=new zL((i,r)=>e.newCache(i,r),"TileGeometry")}acquire(e){const r=Math.ceil(e/4)*4,s=this._storage,n=GAt(r),o=s.pop(n);if(o)return o;const a=VAt.createBuffer(r);return a.release=()=>s.put(n,a),a}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function GAt(t){return t.toString()}var Be;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Be||(Be={}));const vJ={normal:Be.Normal,average:Be.Average,lighten:Be.Lighten,lighter:Be.Lighter,screen:Be.Screen,plus:Be.Plus,"color-dodge":Be.ColorDodge,darken:Be.Darken,multiply:Be.Multiply,"color-burn":Be.ColorBurn,overlay:Be.Overlay,"soft-light":Be.SoftLight,"hard-light":Be.HardLight,"vivid-light":Be.VividLight,hue:Be.Hue,saturation:Be.Saturation,luminosity:Be.Luminosity,color:Be.Color,difference:Be.Difference,exclusion:Be.Exclusion,minus:Be.Minus,invert:Be.Invert,reflect:Be.Reflect,"destination-over":Be.DestinationOver,"destination-atop":Be.DestinationAtop,"destination-in":Be.DestinationIn,"destination-out":Be.DestinationOut,"source-atop":Be.SourceAtop,"source-in":Be.SourceIn,"source-out":Be.SourceOut,xor:Be.Xor};function jAt(t){return t===Be.DestinationOver||t===Be.DestinationAtop||t===Be.DestinationIn||t===Be.DestinationOut||t===Be.SourceAtop||t===Be.SourceIn||t===Be.SourceOut||t===Be.Xor}let ENe=class extends jl{constructor(){super(...arguments),this.blendMode=Be.Normal}};h([B({count:Be.COUNT})],ENe.prototype,"blendMode",void 0);var za;(function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"})(za||(za={}));var An;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(An||(An={}));var qp;(function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"})(qp||(qp={}));let _I=class extends ENe{constructor(){super(...arguments),this.output=An.Composite,this.baseOpacityMode=za.NotRequired,this.premultipliedSource=qp.Off}};h([B({count:An.COUNT})],_I.prototype,"output",void 0),h([B({count:za.COUNT})],_I.prototype,"baseOpacityMode",void 0),h([B()],_I.prototype,"premultipliedSource",void 0);let CNe=class extends $r{constructor(){super(...arguments),this.scale=1,this.offset=jS}};function MNe(t){t.attributes.add(R.POSITION,"vec2"),t.attributes.add(R.UV0,"vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.uniforms.add(new qe("scale",e=>e.scale),new Fr("offset",e=>e.offset)).code.add(S`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}function HAt(t,e){const i=e.blendMode;i!==Be.Normal&&(i===Be.Reflect&&t.code.add(S`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Be.ColorDodge&&i!==Be.VividLight||t.code.add(S`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Be.ColorBurn&&i!==Be.VividLight||t.code.add(S`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Be.Overlay&&t.code.add(S`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Be.HardLight&&t.code.add(S`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Be.SoftLight&&t.code.add(S`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Be.VividLight&&t.code.add(S`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Be.Hue&&i!==Be.Saturation&&i!==Be.Color&&i!==Be.Luminosity||(t.code.add(S`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Be.Hue&&i!==Be.Saturation||t.code.add(S`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(S`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Be.Multiply?S`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Average?S`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Lighten?S`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Darken?S`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Lighter?S`return vec4(cl * ol + cb * ob, ol + ob);`:i===Be.Plus?S`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Be.Minus?S`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Be.Screen?S`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Difference?S`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Invert?S`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Be.DestinationOver?S`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Be.DestinationAtop?S`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Be.DestinationOut?S`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Be.SourceAtop?S`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Be.SourceOut?S`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Be.Xor?S`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Be.DestinationIn?S`return vec4(cb * ob * ol, ol * ob);`:i===Be.SourceIn?S`return vec4(cl * ol * ob, ol * ob);`:i===Be.Hue?S`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Saturation?S`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Color?S`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Luminosity?S`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Exclusion?S`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Reflect?S`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.ColorDodge?S`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.ColorBurn?S`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.Overlay?S`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.SoftLight?S`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.HardLight?S`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Be.VividLight?S`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:S``}
    }
  `))}function ANe(t,e){const i=e.output===An.GridComposite,r=e.output===An.ColorComposite,s=e.output===An.GroupBackgroundComposite,n=e.output===An.Composite,o=e.baseOpacityMode===za.Required,a=t.fragment;o&&a.uniforms.add(new qe("baseOpacity",d=>d.baseOpacity)),i?a.include(Vse):r?a.uniforms.add(new Vt("backgroundColor",d=>d.backgroundColor)):n&&a.uniforms.add(new mt("fboColor",d=>d.fboTexture));const l=e.blendMode!==Be.Normal,c=e.premultipliedSource===qp.On,u=!l&&!c&&(n&&!o||s);a.include(HAt,e),a.code.add(S`
    vec4 getBackground(vec2 uv) {
      return ${o?S`baseOpacity *`:""} ${s?S`vec4(0.0, 0.0, 0.0, 0.0)`:r?S`vec4(backgroundColor, 1.0)`:i?S`vec4(gridColor(uv), 1.0)`:S`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec2 bgUV, vec4 colorLayer, float opacity) {
      ${l?S`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec4 bgColor = getBackground(bgUV);
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:S`
          float composeAlpha = colorLayer.a * opacity;
          ${u?S`return colorLayer * opacity;`:S`
            vec4 bgColor = getBackground(bgUV);
            return bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}var Q1;function PNe(t){const e=new Vi,i=e.fragment;if(e.include(MNe),t.background===Q1.Only){const r=t.output===An.ColorComposite;return r?i.uniforms.add(new Vt("backgroundColor",s=>s.backgroundColor)):i.include(Vse),i.code.add(S`
      void main() {
        fragColor = vec4(${r?S`backgroundColor`:S`gridColor(uv)`}, 1.0);
      }
    `),e}return e.include(ANe,t),i.uniforms.add(new mt("tex",r=>r.texture),new qe("opacity",r=>r.opacity)).code.add(S`void main() {
fragColor = blendLayers(uv, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(Q1||(Q1={}));const qAt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Q1},build:PNe},Symbol.toStringTag,{value:"Module"}));let WAt=class extends CNe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=$n}},ONe=class RNe extends Wi{initializeProgram(e){return new Yi(e.rctx,RNe.shader.get().build(this.configuration),wi)}initializePipeline(){return Gt({blending:Ah(Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA),colorWrite:Kt})}};ONe.shader=new Bi(qAt,()=>fe(()=>Promise.resolve().then(()=>AUt),void 0));let $Ne=class extends _I{constructor(){super(...arguments),this.background=Q1.BelowLayer}};h([B()],$Ne.prototype,"background",void 0);let bJ=class{constructor(e,i,r,s,n,o){this.texture=e,this.type=i,e.retain(),this.offsetAndScale=Wt(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=$e(s,n,o)}destroy(){this.texture.release()}};var AS,aT;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(AS||(AS={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(aT||(aT={}));var Cn,Uv,AV,Ya,wJ,PV,xJ,zv,SJ;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(Cn||(Cn={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(Uv||(Uv={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(AV||(AV={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(Ya||(Ya={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(wJ||(wJ={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(PV||(PV={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(xJ||(xJ={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(zv||(zv={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(SJ||(SJ={}));let so=class{};so.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Uv.VISIBLE}},so.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Uv.VISIBLE}},so.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Uv.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:$X.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:IX.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},so.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Uv.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:AV.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:PV.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:Ya.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:PV.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:wJ.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:Ya.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:xJ.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[SJ.HORIZONTAL]}},so.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Uv.VISIBLE}},so.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},so.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:zv.MAP}},so.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:zv.MAP},"line-width":{type:"number",minimum:0,default:1}},so.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:zv.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:zv.MAP}},so.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},so.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:zv.MAP}};function YAt(t,e,i,r,s,n){const{iconRotationAlignment:o,textRotationAlignment:a,iconTranslate:l,iconTranslateAnchor:c,textTranslate:u,textTranslateAnchor:d}=r;let p=0;for(const m of t.colliders){const[g,y]=m.partIndex===0?l:u,v=m.partIndex===0?c:d,b=m.minLod<=n&&n<=m.maxLod;p+=b?0:1,m.enabled=b,m.xScreen=m.xTile*s[0]+m.yTile*s[3]+s[6],m.yScreen=m.xTile*s[1]+m.yTile*s[4]+s[7],v===zv.MAP?(m.xScreen+=i*g-e*y,m.yScreen+=e*g+i*y):(m.xScreen+=g,m.yScreen+=y),Ya.VIEWPORT===(m.partIndex===0?o:a)?(m.dxScreen=m.dxPixels,m.dyScreen=m.dyPixels):(m.dxScreen=i*(m.dxPixels+m.width/2)-e*(m.dyPixels+m.height/2)-m.width/2,m.dyScreen=e*(m.dxPixels+m.width/2)+i*(m.dyPixels+m.height/2)-m.height/2)}t.colliders.length>0&&p===t.colliders.length&&(t.unique.show=!1)}let ZAt=class{constructor(e,i,r,s,n,o){this._symbols=e,this._styleRepository=s,this._zoom=n,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new jDe(i,r,YCt),this._si=Math.sin(Math.PI*o/180),this._co=Math.cos(Math.PI*o/180);for(const a of e)for(const l of a.symbols)this._allNeededMatrices.has(l.tile)||this._allNeededMatrices.set(l.tile,VDe(l.tile.transforms.tileUnitsToPixels))}work(e){const i=this._gridIndex;function r(n){const o=n.xScreen+n.dxScreen,a=n.yScreen+n.dyScreen,l=o+n.width,c=a+n.height,[u,d,p,m]=i.getCellSpan(o,a,l,c);for(let g=d;g<=m;g++)for(let y=u;y<=p;y++){const v=i.cells[g][y];for(const b of v){const w=b.xScreen+b.dxScreen,x=b.yScreen+b.dyScreen,T=w+b.width,C=x+b.height;if(!(l<w||o>T||c<x||a>C))return!0}}return!1}const s=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const n=this._symbols[this._currentLayerCursor],o=this._getProperties(n.styleLayerUID);for(;this._currentSymbolCursor<n.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-s>e)return!1;const a=n.symbols[this._currentSymbolCursor];if(!a.unique.show)continue;YAt(a,this._si,this._co,o,this._allNeededMatrices.get(a.tile),this._zoom);const l=a.unique;if(!l.show)continue;const{iconAllowOverlap:c,iconIgnorePlacement:u,textAllowOverlap:d,textIgnorePlacement:p}=o;for(const m of a.colliders){if(!m.enabled)continue;const g=l.parts[m.partIndex];g.show&&!(m.partIndex?d:c)&&r(m)&&(m.hard?l.show=!1:g.show=!1)}if(l.show)for(const m of a.colliders){if(!m.enabled||(m.partIndex?p:u)||!l.parts[m.partIndex].show)continue;const g=m.xScreen+m.dxScreen,y=m.yScreen+m.dyScreen,v=g+m.width,b=y+m.height,[w,x,T,C]=this._gridIndex.getCellSpan(g,y,v,b);for(let M=x;M<=C;M++)for(let O=w;O<=T;O++)this._gridIndex.cells[M][O].push(m)}}}return!0}_getProperties(e){const i=this._styleProps.get(e);if(i)return i;const r=this._zoom,s=this._styleRepository.getStyleLayerByUID(e),n=s.getLayoutValue("symbol-placement",r)!==AV.POINT;let o=s.getLayoutValue("icon-rotation-alignment",r);o===Ya.AUTO&&(o=n?Ya.MAP:Ya.VIEWPORT);let a=s.getLayoutValue("text-rotation-alignment",r);a===Ya.AUTO&&(a=n?Ya.MAP:Ya.VIEWPORT);const l=s.getPaintValue("icon-translate",r),c=s.getPaintValue("icon-translate-anchor",r),u=s.getPaintValue("text-translate",r),d=s.getPaintValue("text-translate-anchor",r),p={iconAllowOverlap:s.getLayoutValue("icon-allow-overlap",r),iconIgnorePlacement:s.getLayoutValue("icon-ignore-placement",r),textAllowOverlap:s.getLayoutValue("text-allow-overlap",r),textIgnorePlacement:s.getLayoutValue("text-ignore-placement",r),iconRotationAlignment:o,textRotationAlignment:a,iconTranslateAnchor:c,iconTranslate:l,textTranslateAnchor:d,textTranslate:u};return this._styleProps.set(e,p),p}};function XAt(t,e){if(t.priority-e.priority)return t.priority-e.priority;const i=t.tile.key,r=e.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:t.xTile-e.xTile?t.xTile-e.xTile:t.yTile-e.yTile}let JAt=class{get running(){return this._running}constructor(e,i,r,s,n,o){this._visibleTiles=e,this._symbolRepository=i,this._createCollisionJob=r,this._assignTileSymbolsOpacity=s,this._symbolLayerSorter=n,this._isLayerVisible=o,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(e,i){this._screenWidth===e&&this._screenHeight===i||this.restart(),this._screenWidth=e,this._screenHeight=i}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const i=performance.now();if(!this._selectionJob.work(e)||(this._selectionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const i=performance.now();if(!this._collisionJob.work(e)||(this._collisionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const i=performance.now();if(!this._opacityJob.work(e)||(this._opacityJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}return this._running=!1,!0}_createSelectionJob(){const e=this._symbolRepository.uniqueSymbols;for(let l=0;l<e.length;l++){const c=e[l];for(let u=0;u<c.uniqueSymbols.length;u++){const d=c.uniqueSymbols[u];for(const p of d.tileSymbols)p.selectedForRendering=!1}}const i=[];let r=0,s=0;const n=this._isLayerVisible;function o(l){let c;const u=performance.now();for(;s<e.length;s++,r=0){const d=e[s],p=d.styleLayerUID;if(!n(p)){i[s]||(i[s]={styleLayerUID:p,symbols:[]});continue}i[s]=i[s]||{styleLayerUID:p,symbols:[]};const m=i[s];for(;r<d.uniqueSymbols.length;r++){if(c=d.uniqueSymbols[r],r%100==99&&performance.now()-u>l)return!1;let g=null,y=!1,v=!1;for(const b of c.tileSymbols)if(!v||!y){const w=b.tile;(!g||w.isCoverage||w.neededForCoverage&&!y)&&(g=b,(w.neededForCoverage||w.isCoverage)&&(v=!0),w.isCoverage&&(y=!0))}if(g.selectedForRendering=!0,v){m.symbols.push(g),c.show=!0;for(const b of c.parts)b.show=!0}else c.show=!1}}for(const d of i)d.symbols.sort(XAt);return!0}const a=this._symbolLayerSorter;return{work:o,get sortedSymbols(){return i.sort(a)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,i=this._visibleTiles;let r=0;function s(n,o){const a=n.symbols;for(const[l,c]of a)QAt(c,o);e(n,o);for(const l of n.childrenTiles)s(l,o)}return{work(n){const o=performance.now();for(;r<i.length;r++){if(performance.now()-o>n)return!1;const a=i[r];a.parentTile==null&&s(a,performance.now())}return!0}}}};function QAt(t,e){for(const i of t){const r=i.unique;for(const s of r.parts){const n=s.targetOpacity>.5?1:-1;s.startOpacity+=n*((e-s.startTime)/hJ),s.startOpacity=Math.min(Math.max(s.startOpacity,0),1),s.startTime=e,s.targetOpacity=r.show&&s.show?1:0}}}const KAt=32,ePt=8,tPt=64,iPt=20;let rPt=class{constructor(e,i,r){this.tileCoordRange=e,this._visibleTiles=i,this._createUnique=r,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return this._uniqueSymbolLayerArray==null&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(e,i){this._uniqueSymbolLayerArray=null;let r=this._tiles.get(e.id);r||(r={symbols:new Map},this._tiles.set(e.id,r));const s=new Map;if(i)for(const a of i)r.symbols.has(a)&&(s.set(a,r.symbols.get(a)),r.symbols.delete(a));else for(const[a,l]of e.layerData)r.symbols.has(a)&&(s.set(a,r.symbols.get(a)),r.symbols.delete(a));this._removeSymbols(s);const n=e.symbols,o=new Map;for(const[a,l]of n){let c=l.length;if(c>=KAt){let u=this.tileCoordRange;do u/=2,c/=4;while(c>ePt&&u>tPt);const d=new jDe(this.tileCoordRange,this.tileCoordRange,u);o.set(a,{flat:l,index:d}),r.symbols.set(a,{flat:l,index:d});for(const p of l)d.getCell(p.xTile,p.yTile).push(p)}else o.set(a,{flat:l}),r.symbols.set(a,{flat:l})}this._addSymbols(e.key,n)}deleteStyleLayers(e){this._uniqueSymbolLayerArray=null;for(const[i,r]of this._tiles){const s=new Map;for(const n of e)r.symbols.has(n)&&(s.set(n,r.symbols.get(n)),r.symbols.delete(n));this._removeSymbols(s),r.symbols.size===0&&this._tiles.delete(i)}}removeTile(e){this._uniqueSymbolLayerArray=null;const i=this._tiles.get(e.id);if(!i)return;const r=new Map;for(const[s,n]of e.symbols)i.symbols.has(s)&&(r.set(s,i.symbols.get(s)),i.symbols.delete(s));this._removeSymbols(r),i.symbols.size===0&&this._tiles.delete(e.id)}querySymbols(e,i,r,s){const n=[],o=this.uniqueSymbols;for(const a of o){const l=a.styleLayerUID,c=a.uniqueSymbols;for(const u of c){const d=u.tileSymbols.find(p=>p.selectedForRendering);d&&GCt(d,e,i*(window.devicePixelRatio||1),r)&&n.push({vtlSymbol:d,styleLayerUID:l,tileKey:d.tile.key})}}return n}_removeSymbols(e){for(const[i,{flat:r}]of e)for(const s of r){const n=s.unique,o=n.tileSymbols,a=o.length-1;for(let l=0;l<a;l++)if(o[l]===s){o[l]=o[a];break}if(o.length=a,a===0){const l=this._uniqueSymbolsReferences.get(i);l.delete(n),l.size===0&&this._uniqueSymbolsReferences.delete(i)}s.unique=null}}_addSymbols(e,i){if(i.size===0)return;const r=this._visibleTiles;for(const s of r)s.parentTile||s.key.world!==e.world||s.key.level===e.level&&!s.key.equals(e)||this._matchSymbols(s,e,i);for(const[s,n]of i)for(const o of n)if(o.unique==null){const a=this._createUnique();o.unique=a,a.tileSymbols.push(o);let l=this._uniqueSymbolsReferences.get(s);l||(l=new Set,this._uniqueSymbolsReferences.set(s,l)),l.add(a)}}_matchSymbols(e,i,r){if(e.key.level>i.level){const n=e.key.level-i.level;if(e.key.row>>n!==i.row||e.key.col>>n!==i.col)return}if(i.level>e.key.level){const n=i.level-e.key.level;if(i.row>>n!==e.key.row||i.col>>n!==e.key.col)return}if(i.equals(e.key)){for(const n of e.childrenTiles)this._matchSymbols(n,i,r);return}const s=new Map;for(const[n,o]of r){const a=[];for(const d of o){const p=qge(this.tileCoordRange,d.xTile,i.level,i.col,e.key.level,e.key.col),m=qge(this.tileCoordRange,d.yTile,i.level,i.row,e.key.level,e.key.row);p>=0&&p<this.tileCoordRange&&m>=0&&m<this.tileCoordRange&&a.push({symbol:d,xTransformed:p,yTransformed:m})}const l=[],c=(e.key.level<i.level?1:1<<e.key.level-i.level)+iPt,u=this._tiles.get(e.id).symbols.get(n);if(u){const d=u.flat;for(const p of a){let m,g=!1;const y=p.xTransformed,v=p.yTransformed;m=u.index!=null?u.index.getCell(y,v):d;const b=p.symbol,w=b.hash;for(const x of m)if(w===x.hash&&Math.abs(y-x.xTile)<=c&&Math.abs(v-x.yTile)<=c){const T=x.unique;b.unique=T,T.tileSymbols.push(b),g=!0;break}g||l.push(b)}}l.length>0&&s.set(n,l)}for(const n of e.childrenTiles)this._matchSymbols(n,i,s)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsReferences,i=new Array(e.size);let r,s=0;for(const[n,o]of e){const a=new Array(o.size);r=0;for(const l of o)a[r++]=l;i[s]={styleLayerUID:n,uniqueSymbols:a},s++}return i}};function sPt(t,e){const i=t.transforms.tileUnitsToPixels,r=sB(e),s=Math.cos(r),n=Math.sin(r),o=Math.ceil(512*(Math.abs(n)+Math.abs(s)));WB(lm),HM(lm,lm,[o/2,o/2]),YB(lm,lm,r),HM(lm,lm,[-256,-256]),lL(lm,lm,[1/8,1/8,1]),t.transforms.tileUnitsToPixels=lm;const a=[],l=new rPt(4096,a,()=>new UCt),c=new JAt(a,l,(u,d,p)=>new ZAt(u,d,p,t.styleRepository,t.key.level,e),(u,d)=>{VCt(u,d,!1)},()=>0,u=>{const d=t.styleRepository.getStyleLayerByUID(u).getLayoutProperty("visibility");return!d||d.getValue()!==Uv.NONE});a.push(t),l.add(t),c.setScreenSize(o,o),c.continue(1/0),l.removeTile(t),t.transforms.tileUnitsToPixels=i}const lm=MS();let nPt=class extends HDe{_createTransforms(){return{displayViewScreenMat3:MS(),tileMat3:MS()}}},oPt=class{constructor(){this._candidateTiles=[]}schedule(e){this._candidateTiles.includes(e)||this._candidateTiles.push(e)}reshuffle(e){const i=[];for(const r of this._candidateTiles)e>0?(r.reshuffle(),e--):i.push(r);this._candidateTiles=i}};const aPt=.125;let lPt=class{constructor(){this._renderParams={reshuffleManager:new oPt,context:null,drawPhase:1,state:new cPt,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new nPt(new Df(0,0,0,0),0,0,0,512,512,4096,4096),this._heading=0,this._declutteredForHeading=new WeakMap}dispose(){this._renderParams=null}renderBackground(e,i,r,s,n,o,a,l,c,u){const d=this._backgroundTile;this._updateRenderParameters(e,i,d,r,n,o,a,l,c,u),this._renderParams.stencilSymbols=!1,r.drawBackground(this._renderParams,d,s)}renderContent(e,i,r,s,n,o,a,l,c,u,d,p){this._declutter(r),s.forAll(g=>this._declutter(g.sourceLayerInfo.data)),this._stencilSymbols(e,i,r,s,n,o,a,Math.round(1/l),c,u,d,p);let m=1;r.stencilRef=m++,e.setStencilFunction(fr.EQUAL,r.stencilRef,255),this._render(e,i,r,n,o,a,l,c,u,d,p),s.forAll(g=>{g.sourceLayerInfo.data.stencilRef=m++,this._renderSymbols(e,g.sourceLod,g.sourceLayerInfo.data,n,o,a,Math.round(1/l),g.offset,u,d,p)})}_stencilSymbols(e,i,r,s,n,o,a,l,c,u,d,p){let m=1;r.stencilRef=m++,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(fs.KEEP,fs.KEEP,fs.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(fr.ALWAYS,r.stencilRef,255),this._stencilTileSymbols(e,i,r,n,o,a,l,c,u,d,p);for(const g of s.toArray()){const{sourceLod:y,offset:v,sourceLayerInfo:b}=g;b.data.stencilRef=m++,e.setStencilFunction(fr.ALWAYS,b.data.stencilRef,255),this._stencilTileSymbols(e,y,b.data,n,o,a,l,v,u,d,p)}e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,i,r,s,n,o,a,l,c,u,d){e.setStencilFunction(fr.EQUAL,r.stencilRef,255),this._render(e,i,r,s,n,o,a,l,c,u,d,Cn.SYMBOL)}_render(e,i,r,s,n,o,a,l,c,u,d,p){this._updateRenderParameters(e,i,r,s,o,a,l,c,u,d),this._renderParams.stencilSymbols=!1,s.drawTile(this._renderParams,r,n,p)}_stencilTileSymbols(e,i,r,s,n,o,a,l,c,u,d){this._updateRenderParameters(e,i,r,s,o,a,l,c,u,d),this._renderParams.stencilSymbols=!0,r.triangleCount=0,s.drawSymbols(this._renderParams,r,n)}_updateRenderParameters(e,i,r,s,n,o,a,l,c,u){"type"in r&&r.type==="vector-tile"&&!r.stage&&r.attachWithContext(e);const d=i[0]-n.getLevelShift(i[0]),p=this._renderParams;p.context=e,p.painter=s,p.glyphMosaic=s.glyphMosaic,p.spriteMosaic=s.spriteMosaic,p.pixelRatio=c*u,p.displayLevel=d,p.requiredLevel=d;const m=n.getScale(i[0]),[g,y]=n.getOffset(i,o*m),v=aPt*o*m/l,b=r.transforms.displayViewScreenMat3;b[0]=v,b[4]=-v,b[6]=-1-g-a[0]*o*2,b[7]=1+y+(1-a[1])*o*2-2;const w=p.state,x=l/u;w.size[0]=x,w.size[1]=x,w.pixelRatio=u,w.rotation=(360-this._heading)%360;const T=2/x;fte(w.displayViewMat3,T,0,0,0,-T,0,-1,1,1);const C=WB(w.displayMat3),M=sB(this._heading);HM(C,C,[x/2,x/2]),YB(C,C,M),HM(C,C,[-x/2,-x/2]),jM(C,w.displayViewMat3,C)}updateHeading(e){this._heading=e}_declutter(e){this._declutteredForHeading.get(e)!==this._heading&&(sPt(e,(360-this._heading)%360),this._declutteredForHeading.set(e,this._heading))}},cPt=class{constructor(){this.size=[0,0],this.pixelRatio=1,this.rotation=0,this.displayMat3=Gr(),this.displayViewMat3=Gr(),this.transform=null,this.inverseTransform=null,this.viewMat2d=null,this.viewMat3=null,this.id=0,this.extent=null,this.center=null,this.scale=1,this.resolution=0,this.worldScreenWidth=0,this.spatialReference=null,this.viewpoint=null,this.getScreenTransform=null,this.toMap=null,this.toScreen=null,this.clone=null,this.copy=null,this.toJSON=null}};function uPt(t){t.fragment.uniforms.add(new mt("u_colormap",e=>e.u_colormap),new qe("u_colormapOffset",e=>e.colormap.u_colormapOffset),new qe("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new qe("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(S`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function hPt(t){t.fragment.uniforms.add(new mt("u_transformGrid",e=>e.u_transformGrid),new Fr("u_transformSpacing",e=>e.common.u_transformSpacing),new Fr("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(S`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let dPt=class extends CNe{constructor(e,i,r){super(),this.common=e,this.u_image=i,this.u_transformGrid=r}};function pPt(t,e){t.include(hPt),t.fragment.uniforms.add(new mt("u_image",r=>r.u_image),new pg("u_flipY",r=>r.common.u_flipY),new pg("u_applyTransform",r=>r.common.u_applyTransform));const{requireBilinearWithNN:i}=e;i&&t.fragment.uniforms.add(new Fr("u_srcImageSize",r=>r.common.u_srcImageSize)),t.fragment.code.add(S`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),i?t.fragment.code.add(S`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(S`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}let Sj=class extends dPt{constructor(e,i,r,s,n,o){super(e,s,n),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=$n,this.fboTexture=null,this.baseOpacity=1}},INe=class extends Sj{},LNe=class extends Sj{};function DNe(t){const e=new Vi;return e.include(MNe),e.include(pPt,t),e.include(uPt,t),e.include(ANe,t),e.fragment.code.add(S`vec4 applyBackgroundBlend(vec4 layerColor) {
return blendLayers(vuv, layerColor, u_opacity);
}`),t.colorizerType===AS.Stretch?mPt(e,t):t.colorizerType===AS.Lut?fPt(e):t.colorizerType===AS.Hillshade&&gPt(e,t),e}function fPt(t){t.fragment.code.add(S`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function mPt(t,e){t.fragment.uniforms.add(new eP("u_bandCount",r=>r.symbolizer.u_bandCount),new Fl("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new Fl("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new Fl("u_factor",r=>r.symbolizer.u_factor,3),new qe("u_minOutput",r=>r.symbolizer.u_minOutput),new qe("u_maxOutput",r=>r.symbolizer.u_maxOutput),new pg("u_useGamma",r=>r.symbolizer.u_useGamma),new Fl("u_gamma",r=>r.symbolizer.u_gamma,3),new Fl("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new qe("u_opacity",r=>r.common.u_opacity)),t.fragment.code.add(S`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=e.applyColormap?S`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:S`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(S`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===aT.Noop?S`
        fragColor = applyBackgroundBlend(currentPixel);`:S`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function gPt(t,e){const i=t.fragment;i.uniforms.add(new mt("u_image",s=>s.u_image),new eP("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new Fl("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new Fl("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new Fl("u_cosZs",s=>s.symbolizer.u_cosZs,6),new Fl("u_weights",s=>s.symbolizer.u_weights,6),new Fr("u_factor",s=>s.symbolizer.u_factor),new qe("u_minValue",s=>s.symbolizer.u_minValue),new qe("u_maxValue",s=>s.symbolizer.u_maxValue),new Fr("u_srcImageSize",s=>s.common.u_srcImageSize)),i.include(Ug),i.code.add(S`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(S`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?S`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:S`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(S`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const yPt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:LNe,ColorizerStretchUniforms:INe,ColorizerUniforms:Sj,build:DNe},Symbol.toStringTag,{value:"Module"}));let NNe=class FNe extends Wi{initializeProgram(e){return new Yi(e.rctx,FNe.shader.get().build(this.configuration),wi)}initializePipeline(){return Gt({blending:Ah(Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA),colorWrite:Kt})}};NNe.shader=new Bi(yPt,()=>fe(()=>Promise.resolve().then(()=>PUt),void 0));let e$=class extends _I{constructor(){super(...arguments),this.colorizerType=AS.Stretch,this.stretchType=aT.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};h([B({count:AS.COUNT})],e$.prototype,"colorizerType",void 0),h([B({count:aT.COUNT})],e$.prototype,"stretchType",void 0),h([B()],e$.prototype,"applyColormap",void 0),h([B()],e$.prototype,"requireBilinearWithNN",void 0);let dye=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const i=this._fbos.get(e);if(i)return i;const r=new zg(this._rctx,new jr(e),new aAe(_a.DEPTH24_STENCIL8,e));return this._fbos.set(e,r),r}};const _Pt=()=>ie.getLogger("esri.views.3d.terrain");let vPt=class{constructor(e,i){this._rctx=e,this._techniques=i,this._fbos=[],this._vectorTileHelper=new lPt,this._bindParameters=new vG(null,null),this._blendLayersTechniqueConfig=new $Ne,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=kg(this._rctx,mL)}dispose(){this._fbos.forEach(It),this._fbos=null,this._vtFBO=It(this._vtFBO),this._vaoQuad=It(this._vaoQuad),this._vectorTileHelper=It(this._vectorTileHelper),this._backgroundTechnique=ti(this._backgroundTechnique),this._applyOpacityTechnique=ti(this._applyOpacityTechnique),this._blendLayersTechnique=ti(this._blendLayersTechnique)}updateHeading(e){var i;(i=this._vectorTileHelper)==null||i.updateHeading(e)}_getBlendLayersTechnique(e,i,r,s=qp.Off,n=Q1.BelowLayer){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniques.releaseAndAcquire(ONe,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,i){const r=this._getBlendLayersTechnique(Be.Normal,i?An.ColorComposite:An.GridComposite,za.NotRequired,qp.Off,Q1.Only),s=this._rctx.bindTechnique(r,this._bindParameters,e);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(vi.TRIANGLE_STRIP,0,p0(this._vaoQuad,"geometry"))}drawGroup(e,i,r,s,n=qp.On){i===An.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const o=e.baseOpacity<1?za.Required:za.NotRequired,a=this._getBlendLayersTechnique(s,i,o,n),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawImageData(e,i,r,s,n=qp.Off){if(e.texture==null)return;const o=e.baseOpacity<1?za.Required:za.NotRequired;e.fboTexture=i===An.GroupBackgroundComposite||s===Be.Normal&&o===za.NotRequired&&n===qp.Off?null:this.switch(r).colorTexture;const a=this._getBlendLayersTechnique(s,i,o,n),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawRasterData(e,i,r,s,n){const o=n.sourceLayerInfo.data;if(!o.source||(n.tile.surface.layerViewByIndex(n.layerIndex,jt.MAP).ensureSymbolizerParameters(o),!o.bind(this._rctx)))return;const a=e.baseOpacity<1?za.Required:za.NotRequired;e.fboTexture=s===Be.Normal&&a===za.NotRequired?null:this.switch(r).colorTexture;const l=this._getRasterColorizerTechnique(o,i,s,a);o.opacity=e.opacity;const c=o.getUniforms();c.scale=n.scale,c.offset=n.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const u=this._rctx.bindTechnique(l,null,c);this._render(u)}_getRasterColorizerTechnique(e,i,r,s){const n=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new e$,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=i,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?aT.Noop:aT.PerBand,this._rasterColorizerTechnique=this._techniques.releaseAndAcquire(NNe,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,i,r,s,n,o,a,l){const c=this._rctx,u=n.sourceLayerInfo.data,d=n.tile.surface.layerViewByIndex(n.layerIndex,jt.MAP),p=e.baseOpacity<1?za.Required:za.NotRequired,m=p===za.Required||e.opacity<1||s!==Be.Normal||i!==An.Composite,g=m?qp.On:qp.Off,y=this._getBlendLayersTechnique(s,i,p,g);c.setPipelineState(y.getPipeline());let v=null,b=null;m?(b=this.currentFBO(r),this._vtFBO==null&&(this._vtFBO=new dye(this._rctx)),v=this._vtFBO.get(r),c.bindFramebuffer(v),this._clearCurrentFBO()):l&&c.clear(Lr.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(c,n.sourceLod,d.painter,d.layer.styleRepository,d.schemaHelper,Math.round(1/n.scale),n.offset,a,o,d.contentZoom),u&&this._vectorTileHelper.renderContent(c,n.sourceLod,u,n.vtlNeighborInfos,d.painter,d.layer.styleRepository,d.schemaHelper,Math.round(1/n.scale),n.offset,a,o,d.contentZoom)}catch(w){_Pt().warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return v==null||(c.bindFramebuffer(b),e.texture=v.colorTexture,e.offset=jS,e.scale=1,this.drawImageData(e,i,r,s,g),l)}copyFBOToTexture(e){const i=this._rctx,r=i.bindTexture(e.texture,br.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;i.gl.copyTexImage2D(Is.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),i.bindTexture(r,br.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clear(Lr.COLOR_BUFFER_BIT|Lr.DEPTH_BUFFER_BIT|Lr.STENCIL_BUFFER_BIT)}_initFBO(e,i,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let s=this._fbos.length;s<=i;s++)this._fbos.push(new dye(this._rctx));this._initFBO(this._fbos[i].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const i=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const i=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},bPt=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new Zt({allocator:e=>e||new wPt})}},wPt=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},pye=class{constructor(e,i){this._texture=e,this._cache=i,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){if(--this._refCount,this._refCount===0)if(this._cache){const e=`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`;this._cache.put(e,this)}else this.dispose()}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.usedMemory}},xPt=class{constructor(e,i,r,s,n,o){this.start=e,this.end=i,this.blendMode=r,this.opacity=s,this.output=n,this.baseOpacity=o}},SPt=class{constructor(e,i,r,s){this._rctx=e,this.tileSize=i,this._techniques=r,this._cache=s,this._passParameters=new WAt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._compositor=new vPt(this._rctx,this._techniques),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._compositor=It(this._compositor),this._backgroundTexture=ti(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateHeading(e){var i;(i=this._compositor)==null||i.updateHeading(e)}updateTileTexture(e,i){if(!e.renderData)return;const r=e.surface,s=r.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1,c=!1;const u=r.view.state.contentPixelRatio;let d=!1;OV.clear(),D2.length=0;const p=e.layerInfo[jt.MAP];let m=0,g=null;for(;m<p.length;m++){const b=r.layerViewByIndex(m,jt.MAP),w=b.layer.opacity,x=b.fullOpacity;if(c=c||G4(b.layer),M3(b)){let M=b.layer.blendMode!=="normal";if(BM(b.layer.parent)){const O=TJ(b.layer.parent);O!=null&&O!==""&&(M=kNe(b.layer.parent)||M)}M&&(d=M,l=!1)}if(w===0&&!d){p[m].pendingUpdates&=~(yt.TEXTURE_NOFADING&yt.TEXTURE_FADING);continue}++o;const T=_A(b),C=yq(e,m,T);if(C){if(p[m].pendingUpdates&=~(yt.TEXTURE_NOFADING&yt.TEXTURE_FADING),BM(b.layer.parent)){const M=TJ(b.layer.parent);M!=null&&M!==""&&UNe(b.layer.parent,m)}T?a=Math.max(a,this.tileSize*u):s===1&&x===1&&(b.isOpaque||this._dataToTexture(C)&&C.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,g===null&&(g=m)}}const y=a/this.tileSize,v=this._ensureBackgroundTexture(this.tileSize);n!==0&&g!==null?n===1&&!d&&this._useLayerTexture(e,g)||this._composeLayers(e,i,m-1,c,a,y,!l||d,OV,d):EPt(e,o,v,i!==mn.FADING)}_ensureBackgroundTexture(e){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._compositor.bind(e),this._passParameters.offset=jS,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._compositor.drawBackground(this._passParameters,this.backgroundColor!=null),this._compositor.copyFBOToTexture(this._backgroundTexture),this._compositor.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useLayerTexture(e,i){const r=e.surface.layerViewByIndex(i,jt.MAP),s=G4(r.layer),n=s?e.surface.baseOpacity:1,o=s?1:e.surface.baseOpacity,a=r.fullOpacity,l=yq(e,i,!1);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new bJ(l.sourceLayerInfo.data,mn.FADING,l,n,o,a)),!0)}_composeLayers(e,i,r,s,n,o,a,l,c){this._compositor.ensureBuffer(n);const u=e.surface.baseOpacity;let d=!1,p=ii.LINEAR_MIPMAP_LINEAR,m=!1,g=0;for(let w=r;w>=0;w--){const x=e.surface.layerViewByIndex(w,jt.MAP),T=_A(x),C=yq(e,w,T),M=x.layer.opacity;if(!C||M===0&&!c)continue;const O=!G4(x.layer)&&!d;O&&(d=!0);let D=!1;l.forEach(z=>{z.start===w&&(z.output=s?An.Composite:a&&O?this.backgroundIsGrid?An.GridComposite:An.ColorComposite:An.Composite,z.baseOpacity=O?u:1,D2.push(z),this._compositor.openGroup(n),D=!0)});const k=g===0,U=D?An.GroupBackgroundComposite:a&&k?this.backgroundIsGrid?An.GridComposite:An.ColorComposite:An.Composite,H=vJ[M3(x)?x.layer.blendMode:"normal"];for(this._passParameters.baseOpacity=O&&!D&&u<1?u:1,this._passParameters.opacity=M,gMt(C)?m=this._compositor.drawVectorData(this._passParameters,U,n,H,C,o,this.tileSize,m):mMt(C)?(this._compositor.drawRasterData(this._passParameters,U,n,H,C),TPt(C)&&(p=ii.NEAREST)):this._dataToTexture(C)&&(this._passParameters.texture=C.sourceLayerInfo.data.texture,this._passParameters.offset=C.offset,this._passParameters.scale=C.scale,this._compositor.drawImageData(this._passParameters,U,n,H));D2.length>0&&D2[D2.length-1].end===w;){const z=D2.pop();this._passParameters.baseOpacity=z.baseOpacity,this._passParameters.opacity=z.opacity,this._passParameters.offset=jS,this._passParameters.scale=1,this._compositor.drawGroup(this._passParameters,z.output,n,vJ[z.blendMode])}g++}const y=e.renderData,v=c||d&&u<1,b=y.ensureTexture(n,v,()=>this._buildTexture(n,v,p));this._compositor.copyFBOToTexture(b),this._compositor.unbind(),y.setTextureReference(new bJ(b,i,zNe,d?1:u,0,1))}_dataToTexture(e){if(_Mt(e)){const i=e.sourceLayerInfo;i.data=this._buildTexture(i.data,!0),e.tile.setMemoryDirty()}return yMt(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,i,r=ii.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const s=new jr;s.wrapMode=bi.CLAMP_TO_EDGE,s.samplingMode=r,s.maxAnisotropy=this._maxAnisotropy,s.preMultiplyAlpha=!0,s.flipped=!0,s.hasMipmap=!0,i||(s.pixelFormat=Ft.RGB);const n=this._rctx;let o;if(typeof e=="number")s.width=s.height=e,o=this._buildTileTexture(s,e);else if(bj(e))s.isOpaque=e.isOpaque,s.isOpaque&&(s.pixelFormat=Ft.RGB),o=this._buildTileTexture(s,e.element.width,e.element);else try{s.width=e.width,s.height=e.height,o=this._buildTileTexture(s,e.width,e)}catch{o=new pye(VMe(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const a=n.bindTexture(o.texture,br.TEXTURE_UNIT_FOR_UPDATES);return o.generateMipmap(),n.bindTexture(a,br.TEXTURE_UNIT_FOR_UPDATES),o}_buildTileTexture(e,i,r){const s=`${i} ${e.pixelFormat}`,n=this._cache.pop(s);return n?(n.retain(),n.texture.setData(r),n):new pye(new br(this._rctx,e,r),this._cache)}get test(){}};function yq(t,e,i){La.layerIndex=e,La.vtlNeighborInfos.clear();const r=t.layerInfo[jt.MAP][e];if(Pi(La.offset,0,0),La.tile=t,La.scale=1,La.sourceLod=t.lij,La.sourceLayerInfo=r,La.isVTLBackground=i,r.data)return i&&t.forEachLoadedNeighbor((n,o)=>{if(n.level!==t.level)return;const a=n.layerInfo[jt.MAP][e];if(!JDe(a)||r.data===a.data)return;const l=La.vtlNeighborInfos.pushNew();l.offset=My[o],l.sourceLod=n.lij,l.sourceLayerInfo=a}),La;const s=r.upsampleInfo;if(s){const n=s.tile.layerInfo[jt.MAP][e];return La.tile=s.tile,Aa(La.offset,s.offset),La.scale=s.scale,La.sourceLod=s.tile.lij,La.sourceLayerInfo=n,La}return i?La:null}function TJ(t){return t.uid}function TPt(t){const e=t.sourceLayerInfo.data;return!!e.source&&e.interpolation==="nearest"}function kNe(t){let e=t.blendMode!=="normal";return BM(t.parent)&&(e=kNe(t.parent)||e),e}function UNe(t,e){BM(t.parent)&&UNe(t.parent,e);const i=TJ(t);if(i!=null&&i!==""){const r=OV.get(i);r?r.start=e:OV.set(i,new xPt(e,e,t.blendMode,t.opacity,An.Composite,1))}}function EPt(t,e,i,r){const s=t.renderData,n=!r&&s.textureReference!=null&&(t.surface.view.layerViewManager.updating||e>0)?m1.Delayed:m1.Immediate;s.setTextureReference(new bJ(i,mn.FADING,zNe,t.surface.baseOpacity,0,1),n)}const OV=new Map,D2=new Array,La=new bPt,zNe={offset:[0,0],scale:1},My=new Array;My[St.NORTH]=[0,-1],My[St.NORTH_EAST]=[-1,-1],My[St.EAST]=[-1,0],My[St.SOUTH_EAST]=[-1,1],My[St.SOUTH]=[0,1],My[St.SOUTH_WEST]=[1,1],My[St.WEST]=[1,0],My[St.NORTH_WEST]=[1,-1];const CPt=200,_q=40,MPt=.8,APt=10,t$=1e-6;function PPt(t,e,i){const r=e,s=i;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(r[a]<l){if(s[a]<=t$)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-t$){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=t[a+3];if(r[a]>l){if(s[a]>=-t$)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]>=t$){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}let fye=class{constructor(e,i,r,s,n){this.aabb=e,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}},VNe=class EJ{constructor(e,i,r,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=i,this.positions=s,this._rayDirection=E(),this._callback=gye,this._intersectionOptions=mye,this.bspNodeTree=new Array;const n=r-i,o=new(n<LPt?Uint8Array:n<DPt?Uint16Array:Uint32Array)(n);this.triangleIndexMap=o;for(let a=0;a<n;++a)o[a]=a;{const a=IPt(e,i,r,s.data,s.stride),l=Te(Math.log2(n/_q),2,APt),c=(u,d,p)=>{const m=RPt(o,a,u,d),g=d-u;if(g<=_q){const T=new fye(m,void 0,0,u,d);return this.bspNodeTree.push(T),T}const{axis:y,midValue:v}=$Pt(m),b=OPt(o,a,u,d,y,v),w=(T,C)=>{if(p>l)return;const M=C-T;return M<_q||M>=MPt*g?void 0:c(T,C,p+1)},x=new fye(m,y,v,b.next,b.mid);return this.bspNodeTree.push(x),x.leftNode=w(u,b.next),x.rightNode=w(b.mid,d),x};c(0,n,0)}}intersectRayTriangleRange(e,i){if(e>=i)return;const r=this.positions;bRe(this._rayFrom,this._rayDirection,e,i,this.globalTriangleVertexIndices,r.data,r.stride,this._intersectionOptions.normalRequired,this._callback,this.triangleIndexMap,this.firstTriangleIndex),EJ.numFacesTested+=i-e}intersectRay(e,i,r,s){EJ.numFacesTested=0;const n=e,o=i,a=o[0]-n[0],l=o[1]-n[1],c=o[2]-n[2];if(a*a+l*l+c*c<t$)return;this._rayFrom=n;const u=this._rayDirection;u[0]=a,u[1]=l,u[2]=c;const d=this.triangleIndexMap.length;this._callback=s,this._intersectionOptions=r,this.intersectRayBSP(this.bspNodeTree[0],0,d),this._callback=gye,this._intersectionOptions=mye}intersectRayBSP(e,i,r){const s=this._rayFrom,n=this._rayDirection;if(!PPt(e.aabb,s,n))return;const o=e.axis,a=e.d;if(s[o]<a||n[o]<0){const l=i,c=e.midStartIndex;if(l<c){const u=e.leftNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[o]>a||n[o]>0){const l=e.rightStartIndex,c=r;if(l<c){const u=e.rightNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleIndexMap.byteLength}};VNe.numFacesTested=0;const N2=[1/0,1/0,1/0],F2=[-1/0,-1/0,-1/0];function OPt(t,e,i,r,s,n){let o=i,a=r;for(;o<a;){const c=t[o];e[6*c+s+3]<=n?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=r;l<a;){const c=t[a-1];e[6*c+s]>=n?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function RPt(t,e,i,r){if(r<=i)return XS(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[i];for(let n=0;n<3;++n)N2[n]=e[s+0+n],F2[n]=e[s+3+n]}for(let s=i+1;s<r;++s){const n=6*t[s];for(let o=0;o<3;++o)N2[o]=Math.min(N2[o],e[n+0+o]),F2[o]=Math.max(F2[o],e[n+3+o])}return XS(N2[0],N2[1],N2[2],F2[0],F2[1],F2[2])}function $Pt(t){const e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2],s=e>i?e>r?0:i>r?1:2:i>r?1:r>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function IPt(t,e,i,r,s){const n=i-e,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+e),c=t[l]*s,u=t[l+1]*s,d=t[l+2]*s;for(let p=0;p<3;++p){const m=r[c+p],g=r[u+p],y=r[d+p];o[6*a+p]=Math.min(m,g,y),o[6*a+3+p]=Math.max(m,g,y)}}return o}const LPt=255,DPt=65535,mye=new AL,gye=()=>{};let Bs=class extends Ec{constructor(){super(...arguments),this.output=G.Color,this.overlayMode=ig.Disabled,this.tileBlendInput=og.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.opaque=!0,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=xt.Simplified}};h([B({count:G.COUNT})],Bs.prototype,"output",void 0),h([B({count:ig.COUNT})],Bs.prototype,"overlayMode",void 0),h([B({count:og.COUNT})],Bs.prototype,"tileBlendInput",void 0),h([B()],Bs.prototype,"spherical",void 0),h([B()],Bs.prototype,"doublePrecisionRequiresObfuscation",void 0),h([B()],Bs.prototype,"receiveShadows",void 0),h([B()],Bs.prototype,"hasSlicePlane",void 0),h([B()],Bs.prototype,"backfaceCullingEnabled",void 0),h([B()],Bs.prototype,"textureFadingEnabled",void 0),h([B()],Bs.prototype,"renderOccluded",void 0),h([B()],Bs.prototype,"hasScreenSpaceReflections",void 0),h([B()],Bs.prototype,"hasCloudsReflections",void 0),h([B()],Bs.prototype,"invisible",void 0),h([B()],Bs.prototype,"opaque",void 0),h([B()],Bs.prototype,"tileBorders",void 0),h([B()],Bs.prototype,"visualizeNormals",void 0),h([B()],Bs.prototype,"screenSizePerspective",void 0),h([B()],Bs.prototype,"receiveAmbientOcclusion",void 0),h([B({count:xt.COUNT})],Bs.prototype,"pbrMode",void 0),h([B({constValue:Ki.Compressed})],Bs.prototype,"normalType",void 0),h([B({constValue:ps.Compressed})],Bs.prototype,"textureCoordinateType",void 0),h([B({constValue:!1})],Bs.prototype,"highStepCount",void 0),h([B({constValue:!1})],Bs.prototype,"useCustomDTRExponentForWater",void 0),h([B({constValue:!1})],Bs.prototype,"useFillLights",void 0),h([B({constValue:!0})],Bs.prototype,"hasColorTexture",void 0);const vq=7,NPt=10,bq=Jn();var ja;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(ja||(ja={}));let id=class extends lPe{get _isGlobal(){return this._stage.viewingMode===Ge.Global}get _techniques(){return this._context.techniques}get _rctx(){return this._context.renderContext.rctx}constructor(e,i,r,s,n){super({}),this._overlayRenderer=e,this._stage=i,this._allTiles=r,this._ellipsoidRadius=s,this.type=Zr.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Bs,this._passParameters=new Bse,this._drawParameters=new AX,this._renderDataPool=new Ca(lAt),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new iNe,this._transparencyState=ja.Opaque,this._castShadows=!1,this._inViewshed=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=Ji.Occlude,this.produces=new Map([[_e.OPAQUE_TERRAIN,()=>this._produces()],[_e.TRANSPARENT_TERRAIN,()=>this._produces()],[_e.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileTextureCache=new zL((o,a)=>n.newCache(o,a),"TileTexture"),this.tileGeometryCache=new BAt(n)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this),this.addHandles(ue(()=>this._overlayRenderer.rendersOccludedDraped,e=>{this.renderOccludedFlags=e?aV:Ji.Occlude,this.setNeedsRender()},ar))}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?Iie:OG}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}updateHeading(e){var i;(i=this._tileRenderer)==null||i.updateHeading(e)}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===ja.TransparentWithDraped||e===ja.Empty,this._techniqueConfiguration.opaque=e===ja.Opaque,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return N1}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e,this._getLocalOriginOfTile(e)))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,yt.TEXTURE_FADING)}updateTileTexture(e,i){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,i===yt.TEXTURE_FADING?mn.FADING:mn.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(i))}updateTileGeometryState(e){for(const r of e.layerInfo[jt.ELEVATION])r.pendingUpdates&=~yt.GEOMETRY;e.resetPendingUpdate(yt.GEOMETRY);const i=e.renderData.updateGeometryState();return i&&this.setDirty(),i}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const i=e.renderData;i&&(i.releaseGeometry(),this._renderDataPool.release(i),i.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const i=NPt-vq,r=Math.max(0,Math.floor((e.level-i)/vq)*vq);if(this._isGlobal&&r===0)return $n;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=tr.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=tr.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=tr.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new SPt(this._rctx,this._tileSize,this._techniques,this._tileTextureCache),this.updateTileBackground(),this._emptyTex=VMe(this._rctx)}uninitializeRenderContext(){this._emptyTex=It(this._emptyTex),this._tileRenderer=It(this._tileRenderer)}intersect(e,i,r,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==ja.Opaque)return;const n=FPt,o=kPt;ve(n,s,r),ne(o,1/n[0],1/n[1],1/n[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,u=e.options.store===ta.MIN,d=!!e.results.ground.target,p=EZe(e.verticalOffset),m=e.tolerance;let g,y=u&&a.dist!=null?a.dist:1/0;const v=e.options,b=v.normalRequired||!v.backfacesTerrain,w=new AL(!1,b),x=C=>{const M=C.renderData;if(!(M!=null&&M.vao))return;const O=M.geometry;aG(bq,O.boundingBox);const D=M.localOrigin;p!=null&&(p.localOrigin=D,p.applyToAabb(bq));const k=bq;if(k2[0]=r[0]-D[0],k2[1]=r[1]-D[1],k2[2]=r[2]-D[2],!Sre(k,k2,o,m,y))return;const U=(j,W,X)=>{j.set(this.type,C,W,X,Vr),y=u&&a.dist!=null?a.dist:1/0},H=(j,W,X)=>{if((!b||X!=null)&&j>=0&&(v.backfacesTerrain||pe(X,n)<0)&&(v.invisibleTerrain||!v.selectionMode||i==null||i(r,s,j))){if((c.dist==null||j<c.dist)&&U(c,j,X),v.isFiltered)return;v.store===ta.ALL&&(g==null?(g=_te(e.ray),U(g,j,X),e.results.all.push(g)):j<g.dist&&U(g,j,X)),(a.dist==null||j<a.dist)&&U(a,j,X),v.store!==ta.MIN&&(l.dist==null||j>l.dist)&&U(l,j,X)}},z=UPt;ve(z,s,D);const{indices:Z,indexCount:q}=O,Y=O.vertexAttributes,de=Y.getField(R.POSITION,po),L=new cL(de.typedBuffer,3,Y.stride/4),F=q/3;if(!p&&F>CPt){const j=C.renderData;j.intersectionData==null&&(j.intersectionData=new VNe(Z,0,F,L)),j.intersectionData.intersectRay(k2,z,w,H)}else vRe(k2,z,0,F,Z,L,p,w,H)},T=this._rootTiles;T!=null&&(()=>{const C=this._tileIterator;C.reset(T);const M=e.options.invisibleTerrain;for(let O=C.next();O;O=C.next())!(O.visible||M&&O.intersectsClippingArea)||p==null&&!O.intersectsRay(r,n,m,y)||d&&this._useStencilForTile(O)?C.skipSubtree():x(O)})()}processScaleRangeQueries(e,i){var r;if(!i.done)for(this._updatePatchGroups();e.updating&&!i.done;){e.prepare();for(const s of this._visiblePatchesByOrigin.values())for(const n of s)((r=n.renderData)==null?void 0:r.textureReference)!=null&&e.queriesForTile(n);e.process(),i.madeProgress()}}prepareTechnique(e){const i=re("enable-feature:terrain-shadows")&&e.bindParameters.shadowMap.enabled;i!==this._castShadows&&(this._castShadows=i,this._patchesByOriginDirty=!0);const r=e.bindParameters.viewshedEnabled;if(this._inViewshed!==r&&(this._inViewshed=r,this._patchesByOriginDirty=!0),e.bindParameters.slot===_e.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&aV))return null}else{const s=this.transparency===ja.Opaque?_e.OPAQUE_TERRAIN:_e.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==s)return null}if(this.transparency===ja.Empty)return null;switch(e.output){case G.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.lastFrameColor!=null,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssao!=null,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(G.Color,e.bindParameters.slot===_e.OCCLUDED_TERRAIN);case G.Shadow:case G.ShadowExcludeHighlight:return this._castShadows?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.Shadow,!1)):null;case G.ViewshedShadow:return this._inViewshed?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.ViewshedShadow,!1)):null;case G.Depth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.Depth,!1);case G.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.Normal,!1);case G.ObjectAndLayerIdColor:return this._updateTechnique(G.ObjectAndLayerIdColor,!1);case G.Highlight:return this._overlayRenderer.hasHighlights?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.Highlight,!1)):null}return null}renderNode(e,i){switch(this._updatePatchGroups(),i.useStencil=!1,e.output){case G.Color:{const r=e.bindParameters.slot===_e.OCCLUDED_TERRAIN?Yr.Occluded:Yr.Color;this._renderMaterialPass(e,i,r);break}case G.Depth:case G.Normal:this._renderAuxiliaryPass(e,i,Yr.Color,this._visiblePatchesByOrigin);break;case G.Highlight:this._renderAuxiliaryPass(e,i,Yr.Highlight,this._visiblePatchesByOrigin);break;case G.Shadow:case G.ShadowExcludeHighlight:case G.ViewshedShadow:this._renderAuxiliaryPass(e,i,null,this._allPatchesByOrigin);break;case G.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,i,Yr.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(e){if(this._tileRenderer==null)return;const i=this._tileRenderer;let r;if(e!=null){const s=Oe.toUnitRGBA(e);r=$e(s[0]||0,s[1]||0,s[2]||0)}i.setBackground(r),this._allTiles.forAll(s=>i.updateTileTexture(s,mn.FADING)),this._techniqueConfiguration.tileBlendInput=i.backgroundIsGrid?og.GridComposite:i.backgroundColor!=null?og.ColorComposite:og.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==vA.NONE){const e=Array.from(this._visiblePatchesByOrigin.values()),i=this._stencilEnabledLayerExtents;for(const r of e)NMt(this.renderOrder,r,i);e.sort((r,s)=>rNe(r[0],s[0],this.renderOrder)),this._visiblePatchesByOrigin=new Map(e.map(r=>[r[0].renderData.localOrigin,r])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var i;const e=this._rootTiles;if(e!=null){(i=e[0])==null||i.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const r of e)this._rebuildPatchGroupsForRootTile(r)}}_rebuildPatchGroupsForRootTile(e){const i=this._tileIterator;for(i.resetOne(e);!i.done;){const r=i.next(),s=r.renderData;if(!s){this._numTilesCulled++;continue}const n=s.localOrigin;if(this._castShadows||this._inViewshed){let a=this._allPatchesByOrigin.get(n);a||(a=[],this._allPatchesByOrigin.set(n,a)),a.push(r)}if(!r.visible){this._numTilesCulled++,i.skipSubtree();continue}let o=this._visiblePatchesByOrigin.get(n);o||(o=[],this._visiblePatchesByOrigin.set(n,o)),o.push(r),i.skipSubtree()}}_useStencilForTile(e){for(const i of this._stencilEnabledLayerExtents)if(e.intersectsExtent(i))return!0;return!1}_renderAuxiliaryPass(e,i,r,s){const n=e.rctx;this._passParameters.overlayContent=r,n.bindTechnique(i,e.bindParameters,this._passParameters);const o=this._stencilEnabledLayerExtents.length>0;s.forEach(a=>{this._drawParameters.origin=a[0].renderData.localOrigin,i.program.bindDraw(this._drawParameters,e.bindParameters,this._passParameters);for(let l=0;l<a.length;l++)this._renderPatch(e,i,a[l],vi.TRIANGLES,o,r)}),e.rctx.bindVAO(null)}_renderMaterialPass(e,i,r){var p;const{rctx:s}=e;this._passParameters.overlayContent=r,s.bindTechnique(i,e.bindParameters,this._passParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const n=e.bindParameters.camera,o=i.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const m=sOe(this._stage.viewingMode,this._ellipsoidRadius),g=this.pointsOfInterest.centerOnSurfaceFrequent.distance;m.update({distance:g,fovY:n.fovY})}const a=this._stencilEnabledLayerExtents.length>0,l=r===Yr.Occluded;l&&(o.bindTexture("tex",this._emptyTex),o.setUniform3fv("textureOpacities",$n),o.setUniform4fv("texOffsetAndScale",wh));const c=((p=this._tileRenderer)==null?void 0:p.backgroundColor)!=null?this._tileRenderer.backgroundColor:$n;this._techniqueConfiguration.tileBlendInput===og.ColorComposite&&o.setUniform3fv("backgroundColor",c);const u=this.wireframe?vi.LINES:vi.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&o.bindTexture("texNext",this._emptyTex);const d=this._visiblePatchesByOrigin;for(const m of d.values()){const g=m[0].renderData.localOrigin;i.program.bindDraw(new AX(g),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const y of m){const v=y.renderData,b=v.textureReference;if(b!=null){if(!l){o.setUniform4fv("texOffsetAndScale",b.offsetAndScale),o.bindTexture("tex",b.texture.texture);const w=v.textureFadeFactor,x=w<1?v.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&x!=null&&w<1?(o.setUniform1f("fadeFactor",w),o.setUniform4fv("nextTexOffsetAndScale",x.offsetAndScale),o.setUniform3fv("nextTexOpacities",x.opacities),o.bindTexture("texNext",x.texture.texture)):o.setUniform1f("fadeFactor",1),v.textureIsFading&&this.setNeedsRender(),o.setUniform3fv("textureOpacities",b.opacities)}this._renderPatch(e,i,y,u,a,r),y.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,i,r,s,n,o){const a=r.renderData,l=a.vao,c=l==null?void 0:l.indexBuffer;if(!l||c==null)return void(co&&console.error("Rendered tile with no indices: ",r.lij," : ",a));const u=i.program;o==null||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(u,a.overlay),n&&(i.useStencil=this._useStencilForTile(r),e.rctx.setPipelineState(i.getPipeline()));const d=a.geometry.indexCount;e.rctx.bindVAO(l),u.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(s,d,c.indexType,0)}_bindOverlayPatchData(e,i){e.setUniform4fv("overlayTexOffset",i.offsets),e.setUniform4fv("overlayTexScale",i.scales)}_updateTechnique(e,i){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=i,this._shaderTechnique=this._techniques.releaseAndAcquire(nNe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){}};h([f({readOnly:!0})],id.prototype,"_isGlobal",null),h([f()],id.prototype,"renderOccludedFlags",void 0),h([f({value:!1})],id.prototype,"renderingDisabled",null),h([f({value:!0})],id.prototype,"visible",null),h([f()],id.prototype,"renderPatchBorders",null),h([f()],id.prototype,"visualizeNormals",null),h([f()],id.prototype,"cullBackFaces",null),h([f({value:vA.FRONT_TO_BACK})],id.prototype,"renderOrder",null),h([f()],id.prototype,"wireframe",null),id=h([I("esri.views.3d.terrain.TerrainRenderer")],id);const FPt=E(),kPt=E(),k2=E(),UPt=E();let zPt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},Am=class extends Re{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),ue(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(i=>!(!z$(i)||i.isRejected())&&!(i.isFulfilled()&&!VPt(i,this.viewSpatialReference,this.viewingMode))&&(e=i,!((i==null?void 0:i.type)==="vector-tile"||EV(i)))),e)if(e.isResolved()){const i=xj(e,this.viewSpatialReference,this.viewingMode);if(i!=null){const r=new su(i.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const i=e.when().catch(()=>{}).then(()=>{i!==this._waitTask||this.destroyed||this._update()});this._waitTask=i}_lockTilingScheme(e){if(this.viewingMode===Ge.Global){const i=e.levels.length-1,r=e.spatialReference;r.isWebMercator?e=su.makeWebMercatorAuxiliarySphere(i):Ise(r)&&(e=su.makeGCSWithTileSize(e.spatialReference,e.pixelSize,i))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(ue(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Ge.Global){const e=this.extentHelper.viewSpatialReference;e.isWebMercator?this.tilingScheme=su.WebMercatorAuxiliarySphere:YDe(e)&&(this.tilingScheme=su.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||cS(e,this.extent)||(this.tilingScheme=su.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){}};function VPt(t,e,i){return xj(t,e,i)!=null}h([f()],Am.prototype,"tilingScheme",void 0),h([f({readOnly:!0})],Am.prototype,"extent",void 0),h([f({value:!1})],Am.prototype,"tilingSchemeLocked",void 0),h([f({constructOnly:!0})],Am.prototype,"viewSpatialReference",void 0),h([f({constructOnly:!0})],Am.prototype,"layers",void 0),h([f({constructOnly:!0})],Am.prototype,"extentHelper",void 0),h([f({constructOnly:!0})],Am.prototype,"viewingMode",void 0),Am=h([I("esri.views.3d.terrain.TilingSchemeLogic")],Am);let BPt=class{constructor(){this.offset=lt(),this.scale=0,this.tile=null}init(e,i,r,s){this.tile=e,this.offset[0]=i,this.offset[1]=r,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}};var ok;let Jt=ok=class extends cn.EventedMixin(Re){constructor(t){var e,i,r;super(t),this._scaleRangeQueries=new nk,this._iteratorPool=new Ca(iNe,s=>s.remove=()=>this._iteratorPool.release(s)),this._postorderIterator=new DMt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new zPt,this._viewChanged=!1,this.heading=0,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=E(),this._eyePosSurfaceSR=E(),this._splitLimits=new $p,this._frustum=s3(),this._viewProjectionMatrix=Ee(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new u0,this._frameTask=tA,this._allTiles=new Zt,this._upsampleInfoPool=new Ca(BPt),this._shouldEmitChangeEvent=!1,this._rootTilesExtent=Ht(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=We.WebMercator,this._elevationProjectorCache=new Map,this.visibleElevationBounds=new TC(1/0,-1/0),this.rootTileElevationBounds=new TC(1/0,-1/0),this._sebProjectorMap=new Map,this._sebProjectorCache=Vee(),this._tilingSchemeSpatialReference=null,this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateCarree=!1,this.overlayManager=new ac({...t,surface:this}),this._isGlobal=!((i=(e=t.view)==null?void 0:e.state)!=null&&i.isLocal),this._isGeographic=((r=this._spatialReference)==null?void 0:r.isGeographic)??!1,this._tileConstructor=this._isGlobal?UAt:NAt}initialize(){const t=this.view,e=t.resourceController,i=e.memoryController;this._tileCache=new zL((l,c)=>i.newCache(l,c),"terrain-tile"),this._upsampleMapCache=i.newCache("terrain-upsample",l=>l.unloadMapData()),this._elevationQueryCache=new ACt(i.newCache("elevation-query"));const r=this.overlayManager;this._renderer=new id(r.renderer,t._stage,this._allTiles,ur(t.spatialReference).radius,i),this.addHandles([ue(()=>r.renderer.isEmpty,()=>this._evaluateTransparency()),ue(()=>this.renderer.visible,l=>this.suspended=!l),ue(()=>this.heading,l=>{this._renderer.updateHeading(l),this._updateTileTextures(mn.FADING)}),ue(()=>{var l,c;return{heading:(l=t.camera)==null?void 0:l.heading,state:(c=t.state)==null?void 0:c.mode}},({heading:l,state:c})=>{if(l==null)return;if(this.isGlobal&&this.isGeographic||this.isWebMercatorOnPlateCarree)return void(this.heading=90*Math.round(l/90)%360);const u=Math.round(l)%360,d=Math.abs(u-this.heading);(c===Mi.IDLE||Math.min(d,360-d)>=30)&&(this.heading=u)})],"overlayManager"),this.addHandles([ue(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?mn.UNFADED:mn.IMMEDIATE)},sr),ue(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?mn.UNFADED:mn.IMMEDIATE),sr),ue(()=>this.backgroundColor,(l,c)=>{l!=null&&l.equals(c)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(l))},ar),ue(()=>this.snapLevel,()=>this._viewChanged=!0,ar),ue(()=>this.view.pointsOfInterest,l=>{this._renderer.pointsOfInterest=l,this._watchUpdatingTracking.removeAll(),l&&this._watchUpdatingTracking.add(()=>l.focus.renderLocation,()=>this._allTilesSorted=!1)}),ue(()=>Rr.TERRAIN_TILE_TREE_SHOW_TILES,l=>{l&&!this._treeDebugger?fe(()=>import("./TerrainTileTree3DDebugger-DZZADJbl.js"),__vite__mapDeps([192,193])).then(({TerrainTileTree3DDebugger:c})=>{!this._treeDebugger&&Rr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new c({view:t}))}):l||(this._treeDebugger=Le(this._treeDebugger))},cr)]);const{spatialReference:s}=t;this._extentHelper=EMt(this.viewingMode,{layers:t.map.allLayers,layerViews:t.allLayerViews,viewSpatialReference:s});const n=new ZM({getCollections:()=>{var l,c;return(c=(l=t.defaultsFromMap)==null?void 0:l.mapCollections)==null?void 0:c.map(({layers:u})=>u)},getChildrenFunction:l=>l&&"layers"in l?l.layers:null}),o=new Am({layers:n,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:s});this._set("tilingSchemeLogic",o),this._updateTilingScheme(),this._elevationDataRequester=e.createStreamDataRequester(Xm.ELEVATION),this._mapDataRequester=e.createStreamDataRequester(Xm.BASEMAP);const a=e.scheduler;this._frameTask=a.registerTask(Mt.TERRAIN_SURFACE,this),this.addHandles([ue(()=>this._extentHelper.stencilEnabledExtents,l=>this._renderer.setStencilEnabledLayerExtents(l),cr),ue(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),ar),ue(()=>this.extent,()=>this._updateRootTiles(),cr),t.on("resize",()=>this._viewChangeUpdate()),ue(()=>{const l=t.state;return[this._lodBias,this.lodSnapping,t.quality,l.camera,l.contentCamera,l.fixedContentCamera]},()=>this._viewChangeUpdate(),sr),ue(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.fadeDuration},l=>this._renderer.textureFadingEnabled=l>0,cr),ue(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.physicallyBasedRenderingEnabled},l=>this._renderer.pbrMode=l?xt.Simplified:xt.Disabled,cr),ue(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.tiledSurface.elevationLevelDelta},()=>this._updateAllTileGeometries()),ue(()=>this._userClippingExtent,()=>this._updateClippingExtent(),ar)]),this.addHandles(t.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._removeAllTiles(),this._set("tilingSchemeLogic",Le(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((t,e)=>this._unregisterTiledLayerView(e)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Le(this.overlayManager)),this._tileCache=Le(this._tileCache),kse.prune(),this._treeDebugger=Le(this._treeDebugger),this._renderer=Le(this._renderer),this._iteratorPool=Le(this._iteratorPool),this._upsampleMapCache=Le(this._upsampleMapCache),this._elevationQueryCache=Le(this._elevationQueryCache),this._set("view",null),this._extentHelper=Le(this._extentHelper),this._upsampleInfoPool=Le(this._upsampleInfoPool),XCt(),ZMt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===nI.ON){const t=this.view,e=this.tilingScheme,i=t.terrainScale;if(e&&i){const r=e.levelAtScale(i)+t.qualitySettings.tiledSurface.lodBias,s=e.getMaxLod();return Math.min(r,s||1/0)}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?nI.ON:nI.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get _userClippingExtent(){const{spatialReference:t}=this,{clippingArea:e}=this.view;if(e==null||t==null)return null;const i=Ht(),r=gDe(e,i,t)?i:null,s=this._get("extent");return cS(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const t=c7(this.groundExtent,this._userClippingExtent,Ht()),e=this._get("extent");return cS(t,e)?e:t}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var t;return(t=this.tilingSchemeLogic)==null?void 0:t.extent}get updating(){var t,e;return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||(t=this._watchUpdatingTracking)!=null&&t.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||(e=this.overlayManager)!=null&&e.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){var t,e,i;return((i=(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.ground)==null?void 0:i.opacity)??1}set baseOpacity(t){this.view.map.ground.opacity=t}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(t){this._renderer.renderOrder=t,this._set("renderOrder",t)}get rootTiles(){return this._rootTiles}get spatialReference(){var t;return((t=this.tilingScheme)==null?void 0:t.spatialReference)??null}get backgroundColor(){var t,e,i;return(i=(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.ground)==null?void 0:i.surfaceColor}set backgroundColor(t){this.view.map.ground.surfaceColor=t}set slicePlaneEnabled(t){this._renderer.slicePlaneEnabled=t,this._set("slicePlaneEnabled",t),this._evaluateTransparency()}get tilingSchemeLocked(){var t;return((t=this.tilingSchemeLogic)==null?void 0:t.tilingSchemeLocked)??!1}get wireframe(){var t;return(t=this._renderer)==null?void 0:t.wireframe}set wireframe(t){t!==this._renderer.wireframe&&(this._renderer.wireframe=t,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===ja.Opaque}set suspended(t){this._set("suspended",t),this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??0}intersect(t,e,i,r){this._renderer.intersect(t,e,i,r)}getElevationLevelDelta(t){return t<4?3:this.view.qualitySettings.tiledSurface.elevationLevelDelta}getElevation(t,e,i,r){const s=this._rootTiles;if(!(s!=null&&s.length)||s[0].layerInfo[jt.ELEVATION].length===0)return null;let n=this._elevationProjectorCache.get(r);if(n===void 0&&(n=R1(r,this._spatialReference)??null,this._elevationProjectorCache.set(r,n)),n==null)return ie.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;const o=ne(mO,t,e,i);return n(o,0,o,0),yye(s,o[0],o[1])}getElevations(t,e,i){const r=this._rootTiles,s=r?r[0].layerInfo[jt.ELEVATION].length:0;if(r!=null&&r.length&&s!==0)for(let n=0;n<e;++n){const o=3*n;i(n,yye(r,t[o],t[o+1]))}else for(let n=0;n<e;++n)i(n,null)}getScale(t){if(!this.tilingScheme)return null;if(!il(t,mO,this.spatialReference))return ie.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const e=this._rootTiles;if(e!=null){for(const i of e)if(i!=null&&i.containsPoint(mO)){let r=i;for(;r.children[0]&&!r.rendered;){const s=r.children[0].extent;let n=0;mO[0]>s[2]&&(n+=1),mO[1]<s[1]&&(n+=2),r=r.children[n]}return this._getLodBiasCorrectedScale(r.level)}}return 1/0}_ensureSEBProject(t){const e=this._sebProjectorMap.get(t);if(e)return e;const i=R1(t,this._tilingSchemeSpatialReference,this._sebProjectorCache)??null;return this._sebProjectorMap.set(t,i),i}getSphereElevationBounds(t,e){const i=this._ensureSEBProject(e);if(i==null)return ie.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;WS(t,U2);const r=U2;i(r,0,r,0);const s=new xV,n=this._rootTiles;if(n!=null){const o=[];for(const l of n)o.push(l);let a=0;for(;a<o.length;){const l=o[a];if(++a,!vae(l.extent,U2))continue;const c=l.children;if(c[0]==null||l.rendered)s.expandElevationRangeValues(l.elevationBoundsMin,l.elevationBoundsMax);else for(const u of c)o.push(u)}}return s}getRootElevationBounds(){return new xV(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getSphereScale(t,e){if(!this.tilingScheme)return null;if(!il(t,U2,this.spatialReference))return ie.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;U2[3]=e;let i=null;const r=n=>{if(n&&vae(n.extent,U2)){const o=n.children;if(o[0]&&!n.rendered)for(const a of o)r(a);else{const a=this._getLodBiasCorrectedScale(n.level);i=i==null?a:Math.min(i,a)}}},s=this._rootTiles;if(s!=null)for(const n of s)r(n);return i}queryVisibleScaleRange(t,e,i,r){const s=e?this.tilingScheme.levelAtScale(e):0,n=i?this.tilingScheme.levelAtScale(i):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(t,s+o,n+o,r)}_evaluateTransparency(){var n,o;const t=this.baseOpacity,e=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,r=this._allSurfaceLayersTransparent()?e?ja.Empty:ja.TransparentWithDraped:t>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?ja.Opaque:ja.Semitransparent,s=i!==r;return s&&(this._renderer.transparency=r,(o=(n=this.view)==null?void 0:n._stage)==null||o.renderer.setParameters({terrainTransparency:this._renderer.transparency})),s}_updateTilingScheme(){var i,r,s,n;const t=this.tilingSchemeLogic.tilingScheme;if(t===this.tilingScheme)return;Un(!!t,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((r=(i=this.view)==null?void 0:i.state)!=null&&r.isLocal),this.tilingScheme&&this._removeAllTiles();const e=(t==null?void 0:t.spatialReference)??We.WebMercator;this._spatialReference=e,this._isWebMercator=!!(e!=null&&e.isWebMercator),this._isWebMercatorOnPlateCarree=this._isWebMercator&&NS((s=this.view)==null?void 0:s.renderSpatialReference),this._isGeographic=(e==null?void 0:e.isGeographic)??!1,this._set("tilingScheme",t),this._tilingSchemeSpatialReference=(n=this.tilingScheme)==null?void 0:n.spatialReference,this._sebProjectorMap.clear(),this._updateClippingExtent(),t&&(this._updateTiledLayers(),this._renderer.setTileSize(t.pixelSize),this.overlayManager.setSpatialReference(t.spatialReference),this._updateRootTiles())}_acquireTile(t,e,i,r){const s=this._tileCache.pop(ok._tileMemcacheKey);return s?(s.init(t,e,i,r,this),s):new this._tileConstructor(t,e,i,r,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:t,tilingScheme:e}=this;if(!e)return;const i=jPt;let r=e.rootTilesInExtent(t,i,5*rC);if(this._rootTiles!=null){if(r.length>rC)return void ie.getLogger(this).warn(_Xe);const s=this._rootTiles.map(o=>o.lij),n=x9(s,r,rk);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this._rootTiles.filter(a=>!(n.removed.findIndex(l=>rk(l,a.lij))>-1)||(this._purgeTile(a),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>rC&&(ie.getLogger(this).warn(vXe),r=e.rootTilesInExtent(t,i,rC)),this._setRootTiles(r.map(s=>this._newRootTile(s)));cS(i,this._rootTilesExtent)||(this._rootTilesExtent=Ht(i)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const t=this._allTiles.filter(e=>e.isLoaded&&e.intersectsClippingArea);t.sort(ng),t.forEach(e=>this._renderer.updateTileGeometryState(e)),t.forEach(e=>e.renderData.updateNeighborData()),this._updateTilesGeometries(t),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(t){if(t.length===0)return;t.sort(ng);const e=this.renderer;t.forEach(i=>e.updateGeometryIfNeeded(i)),t.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(t){return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===yt.SPLIT}_newRootTile(t){const e=this._acquireTile(0,t[1],t[2],null);return this._shouldSplit(e)&&e.setPendingUpdate(yt.SPLIT),this._loadTile(e),this._markTileToUpdate(e),this._updateRootTileElevationBounds(),e}_setRootTiles(t){if(this._rootTiles=t,this._allTiles.clear(),t!=null){const e=this._iteratorPool.acquire();for(e.reset(t);!e.done;)this._allTiles.push(e.next());e.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(t)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(t){t.updateClippingStatus(this.extent)&&t.resetPendingUpdate(yt.GEOMETRY)&&this._updateTileGeometryState(t)}_updateTilesVisibility(t){if(t==null)return;const e=GMt(t),i=this.visibleElevationBounds;let r=e?i.min:1/0,s=e?i.max:-1/0;const n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(t);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(yt.GEOMETRY)&&this._updateTileGeometryState(l),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(r=Math.min(l.elevationBoundsMin,r),s=Math.max(l.elevationBoundsMax,s))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(r)&&isFinite(s)&&(i.min!==r||i.max!==s)&&(this.visibleElevationBounds=new TC(r,s))}_updateRootTileElevationBounds(){let t=1/0,e=-1/0;const i=this._rootTiles;i!=null&&i.forEach(({elevationBoundsMin:s,elevationBoundsMax:n})=>{t=Math.min(t,s),e=Math.max(e,n)});const r=this.rootTileElevationBounds;r.min===t&&r.max===e||(this.rootTileElevationBounds=new TC(t,e))}_updateViewDependentParameters(){const{camera:t,contentCamera:e}=this.view.state,i=Math.tan(.5*e.fovX),r=Math.tan(.5*e.fovY),s=this.tilingScheme.pixelSize,n=2**-this._lodBias*t.pixelRatio;this._splitLimits.aboveGround=t.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/t.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/t.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=bz(this._splitLimits.frustum??s3(),e.frustum):this._splitLimits.frustum=null,bz(this._frustum,t.frustum),dr(this._viewProjectionMatrix,e.projectionMatrix,e.viewMatrix),ce(this._eyePosRenderSR,e.eye),Zn(t.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(t){t.updateVisibility(),this._renderer.updateTileGeometryState(t)&&this._markTileToUpdate(t),this._usedMemory=null}_markAllTileNeighborsForUpdate(t){t.forEachLoadedNeighbor(e=>{this._layerViews[jt.MAP].some(_A)&&e.setPendingUpdate(yt.TEXTURE_FADING),this._pendingTilesToUpdate.add(e)})}_updateTileTexture(t,e){const i=t.resetPendingUpdate(yt.TEXTURE_FADING)?yt.TEXTURE_FADING:!!t.resetPendingUpdate(yt.TEXTURE_NOFADING)&&yt.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(t,i),this._usedMemory=null,e.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const t=wq.extent;Mc(t),this._pendingTilesForElevationUpdateEvent.forEach(e=>r1(t,e.extent,t)),this._pendingTilesForElevationUpdateEvent.clear(),wq.spatialReference=this.spatialReference,this.emit("elevation-change",wq),this._shouldEmitChangeEvent=!1}runTask(t){this._handleLayerViewChanges(t),this._frameTask.processQueue(t),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,t),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(t),this._sortTiles(t);const e=!this.view.state.fixedContentCamera;if(this._mergeAndSplit(t,e),this._updateElevation(t),this._updateTextures(t),e||this._mergeAndSplit(t,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),t.done&&t.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue"),co&&this._checkTileInvariant(),!t.hasProgressed)return ia}_checkTileInvariant(){const t=new Map;this._allTiles.forAll(e=>t.set(e,new Set)),this._allTiles.forAll(e=>{var i;if(Un(e.rendered===e.isLeaf,` rendered ${e.rendered} != ${e.isLeaf} leaf`),!e.isLeaf){const r=n=>n.unmergableChildCount===0&&n.maxLevelDeltaNeighborCount===0,s=e.children.reduce((n,o)=>n+(r(o)?0:1),0);if(Un(e.unmergableChildCount===s,` Tile[${e.lij.toString()}] unmergeable child count mismatch: actual ${e.unmergableChildCount} vs ${s}`),e.hasPendingUpdate(yt.MERGE)){Un(!e.hasPendingUpdate(yt.SPLIT),"Tile can be both split and merge at the same time");for(const n of e.children)Un(n.isLeaf||n.hasPendingUpdate(yt.MERGE),"Child of tile to merge must also merge")}}for(let r=0;r<4;++r){if(e.rendered){const a=(i=e.renderData)==null?void 0:i.geometryState.edgePeerNeighbors[r];if(a!=null){{const l=e.level-a.level<=Bn;l||(console.log(`tile level delta [${e.lij.toString()}] vs [${a.lij.toString()}] > ${Bn}  (edge[${r}])`),Un(l,`tile level delta [${e.level}] vs [${a.level}] > ${Bn}`))}Un(e.level-a.level<=Bn,`Max tile lod delta exceeded: [${e.lij.toString()}] vs [${a.lij.toString()}]`)}}const s=e.level-Bn,n=a=>a.isLeaf||a.level===e.level,o=e.findNeighborTile(pf[r],n);if(o!=null){if(e.isLeaf&&e.level>=Bn){let a=o;for(;e.level-a.level<Bn;)a=a.parent;const l=[s,e.lij[1]>>Bn,e.lij[2]>>Bn];if(!rk(l,a.lij)){const c=t.get(a);Un(!c.has(e),"Cannot already have neighbor"),c.add(e)}}Un(o.rendered||o.level===e.level,"Non-same-level-neighbor of rendered must be rendered"),Un(e.level-o.level<=Bn,`Tile level delta [${e.level}] vs [${o.level}] > ${Bn}`)}}}),this._allTiles.forAll(e=>{const i=e.maxLevelDeltaNeighborCount,r=t.get(e);Un(i===r.size,`Tile[${e.lij.toString()}] merge-blocker mismatch: actual ${i} vs ${r.size}`)})}_updateAllTilesStatus(t){if(!this._viewChanged||!this._rootTiles||t.done)return;this._viewChanged=!1;const e=new HPt(this._allTiles.length);e.pushAll(this._rootTiles);const i=this.snapLevel,r=this._splitLimits,s=this._eyePosRenderSR;this._allTiles.forAll(o=>{o.maxLevelDeltaNeighborCount=0,o.unmergableChildCount=0});const n=this._viewProjectionMatrix;for(;!e.empty;){const o=e.pop(),a=o.parent,l=a!=null&&a.hasPendingUpdate(yt.MERGE),c=l?yt.MERGE:o.shouldSplit(r,s,i),u=c===yt.SPLIT;o.isLeaf?xq(o,u):e.pushAll(o.children),l?(o.resetPendingUpdate(yt.SPLIT),o.isLeaf||o.setPendingUpdate(yt.MERGE),this._updateClippingStatus(o),o.updateVisibility(),o.updateScreenDepth(n)):u?(o.resetPendingUpdate(yt.MERGE),o.isLeaf&&o.setPendingUpdate(yt.SPLIT)):(o.resetPendingUpdate(yt.SPLIT)&&o.updateAgentSuspension(),c===yt.ELEVATION&&o.updateAgents(jt.ELEVATION),o.isLeaf||(o.setPendingUpdate(yt.MERGE),o.resetPendingUpdate(yt.SPLIT)))}this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),t.madeProgress()}_sortTiles(t){t.done||this._allTilesSorted||(VMt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),t.madeProgress())}_markTileToUpdate(t){ze(t.isLoaded),t.intersectsClippingArea&&(this._pendingTilesToUpdate.add(t),this._markAllTileNeighborsForUpdate(t))}_updatePendingTileGeometries(){const t=this._pendingTilesToUpdate,e=Array.from(t.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea);if(e.length===0)return void t.clear();const i=(s,n)=>{!(n!=null&&n.isLoaded)||!n.intersectsClippingArea||n.level<s.level||t.has(n)||(t.add(n),e.push(n),n.renderData.updateNeighborData())};e.sort(ng);const r=e.length;for(let s=0;s<r;++s){const n=e[s];ze(n.isLoaded),ze(n.intersectsClippingArea);const o=n.renderData;o.updateNeighborData();const a=o.dirtyEdgeResolutions,l=o.geometryState,c=u=>{var p;const d=MV[u];i(n,(p=l.cornerPeerNeighbors[u])==null?void 0:p.findCorner(CV(d),m=>m.isLoaded))};for(let u=0;u<4;++u)if(a&1<<u){const d=o.geometryState.edgePeerNeighbors[u];d&&(d==null?void 0:d.level)>=n.level&&d.forAllSubtreeOnSide(Nse(pf[u]),p=>!(!p.isLoaded||!p.intersectsClippingArea)&&(ze(t.has(p)||ng(n,p)<0),i(n,p),!0)),c((u+1)%4),c(u)}}t.clear(),this._updateTilesGeometries(e),this._shouldEmitChangeEvent=!0,co&&TV&&this.checkAllTilesWaterproofness()}_mergeAndSplit(t,e){if(this.suspended||t.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const r=this.view.state.fixedContentCamera;let s=!1;for(;!t.done;){s=!0;let n=!1;const o=!this._allTiles.some(a=>{if(!i&&!r&&!a.visible)return t.done;let l=a;if(a.hasPendingUpdate(yt.MERGE)){if(!e||a.unmergableChildCount>0)return t.done;for(a.resetPendingUpdate(yt.MERGE);l.parent!=null&&l.parent.unmergableChildCount===0&&l.parent.resetPendingUpdate(yt.MERGE);)l=l.parent;this._mergeTile(l),n=!0,t.madeProgress()}else if(a.resetPendingUpdate(yt.SPLIT)){let c=!0;const u=a.level;if(u>=Bn){const d=p=>p.isLeaf||u-p.level<Bn;for(let p=0;p<4;++p){const m=a.findNeighborTile(pf[p],d);m!=null&&u-m.level===Bn&&(c=!1,co&&(ze(m.isLeaf),ze(m.hasPendingUpdate(yt.SPLIT))))}}c?(this._splitTile(a),t.madeProgress(),n=!0):a.setPendingUpdate(yt.SPLIT)}return t.done});if(n&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries()),o){if(!i){i=!0;continue}if(!n)break}else this._allTilesDirty=!0}s?t.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(t)}_updateElevation(t){t.done||(this._allTiles.some(e=>(e.resetPendingUpdate(yt.GEOMETRY)&&(this._updateTileGeometryState(e),this._shortBatches&&this._updatePendingTileGeometries(),t.madeProgress()),t.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(t){t.done||this._allTiles.some(e=>(this._updateTileTexture(e,t),t.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(tr.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const t=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-t)*gXe}_getLodBiasCorrectedScale(t){const e=this.tilingScheme.levels,i=Te(t-this._lodBias,0,e.length-1),r=i-Math.floor(i);return e[Math.floor(i)].scale*(1-r)+e[Math.ceil(i)].scale*r}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(t=>this._purgeTile(t)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeDescendantTiles(t){if(!t.children[0])return;const e=t.children.slice();t.unsetChildren();for(let i=0;i<4;++i)this._purgeTile(e[i])}_purgeTile(t){t.isLeaf?_ye(t):this._purgeDescendantTiles(t),this._allTiles.removeUnordered(t),this._unloadTile(t),this._tileCache.put(ok._tileMemcacheKey,t)}_unloadTile(t){this._pendingTilesToUpdate.delete(t),this._pendingTilesForElevationUpdateEvent.delete(t),t.unload(this._renderer)}_splitTile(t){Un(t.isLeaf,"Tile that is already split should not be split again!"),Un(t.rendered,"Tile marked to split is not rendered"),_ye(t);const e=t.level+1,i=2*t.lij[1],r=2*t.lij[2],s=t.setChildren(this._createTile(e,i,r,t),this._createTile(e,i,r+1,t),this._createTile(e,i+1,r,t),this._createTile(e,i+1,r+1,t));this._allTiles.pushArray(s),t.updateAgentSuspension(),Un(t.rendered,"parent should be rendered"),this._unloadTile(t),s.forEach(n=>this._loadTile(n)),s.forEach(n=>this._pendingTilesToUpdate.add(n)),this._markAllTileNeighborsForUpdate(t),this._emitTileScaleChange(t,t.level+1),this._allTilesDirty=!0,this._shortBatches&&this._updatePendingTileGeometries(),s.forEach(n=>xq(n,n.hasPendingUpdate(yt.SPLIT))),++this._performanceInfo.numSplit}_emitTileScaleChange(t,e=t.level){VF.spatialReference=this.spatialReference,VF.extent=t.extent,VF.scale=this._getLodBiasCorrectedScale(e),this.emit("scale-change",VF)}_createTile(t,e,i,r){Un(!!r,"_createTile sanity check");const s=this._acquireTile(t,e,i,r);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(yt.SPLIT),s}get _shortBatches(){return this.view.state.mode!==Mi.IDLE}_mergeTile(t){Un(!t.hasPendingUpdate(yt.SPLIT),"_mergeTile sanity check"),Un(!t.isLeaf,"Cannot merge a leaf"),t.isLeaf||(this._purgeDescendantTiles(t),Un(!t.renderData,"_mergeTile sanity check"),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t),this._shortBatches&&this._updatePendingTileGeometries(),xq(t,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(t){t.load(),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(t)}_handleLayerViewChanges(t=lu){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let e=!1;const i=new Set;let r=-1;for(let s=this.view.allLayerViews.length-1;s>=0;s--){const n=this.view.allLayerViews.items[s];if(i.add(n.uid),mJ(n)||pO(n))if(this._basemapLayerViewHandles.has(n.uid)&&!pO(n)){const o=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(o,n.uid);a!=null&&((a<r||r==null)&&(e=!0),r=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(e=!0)}this._basemapLayerViewHandles.forEach((s,n)=>{i.has(n)||(this._unregisterTiledLayerView(n),e=!0)}),e&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),t.madeProgress()}_allSurfaceLayersTransparent(){var e,i;let t=((i=(e=this.view.map)==null?void 0:e.ground)==null?void 0:i.opacity)===0;for(const r of this.view.allLayerViews.items)if(fJ(r)&&!G4(r.layer)&&r.fullOpacity!==0)return t=!1,t;return t}_hasCompositeBlendMode(){for(const t of this.view.allLayerViews.items)if((M3(t)||pO(t))&&jAt(vJ[t.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(t){return pJ(t)?jt.ELEVATION:jt.MAP}_registerTiledLayerView(t){const e=[];if((M3(t)||pO(t))&&e.push(ue(()=>t.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(mn.UNFADED)})),!pO(t)){const i=this._layerClassFromLayerView(t);e.push(ue(()=>t.suspended,()=>this._updateTiledLayers())),e.push(ue(()=>t.fullOpacity,()=>this._updateTileTextures(mn.UNFADED))),e.push(ue(()=>"effectiveScaleRange"in t.layer?t.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),e.push(t.on("data-changed",()=>{const r=this._getLayerIdxByUID(i,t.uid);r!=null&&this._invalidateLayerData(r,i)}))}this._unregisterTiledLayerView(t.uid),this._basemapLayerViewHandles.set(t.uid,e)}_unregisterTiledLayerView(t){const e=this._basemapLayerViewHandles.get(t);if(e){for(const i of e)i.remove();this._basemapLayerViewHandles.delete(t)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const t=this.view.allLayerViews,e=[[],[]];let i=null;t.forEach(r=>{if(!r.layer||r.suspended||!mJ(r)||!r.fullExtent)return;const s=this._layerClassFromLayerView(r);if(s===jt.MAP){const n=r.displayLevelRange.maxLevel;n!==1/0&&(i===null||n>i)&&(i=n)}e[s].push(r)});for(const r of rx){const s=this._layerViews[r],n=e[r];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[r].clear();for(let u=0;u<o;u++){const d=n[u].uid;this._layerIndexByUid[r].set(d,u);const p=s.indexOf(n[u]);l[u]=p,u!==p&&(a=!0),p>-1&&(c[p]=u)}if(a){const u=this._postorderIterator;for(u.reset(this._rootTiles);!u.done;)u.next().modifyLayers(c,l,r);this._layerViews[r]=n,this._restartAllAgents(r),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&(this._viewChangeUpdate(),this.notifyChange("tilingScheme"))}_restartAllAgents(t){const e=this._postorderIterator;for(e.reset(this._rootTiles);!e.done;){const i=e.next();i.restartAgents(t),t===jt.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(t,e){return this._layerViews[e][t]}numLayers(t){return this._layerViews[t].length}_updateTileTextures(t){this._allTiles.forAll(e=>{e.updateAgents(jt.MAP),t===mn.IMMEDIATE?this.renderer.updateTileTexture(e,yt.TEXTURE_NOFADING):e.updateRenderData(jt.MAP,t)}),this._evaluateTransparency()}_invalidateLayerData(t,e){this._allTiles.forAll(i=>i.removeLayerAgent(t,e)),this._allTiles.forAll(i=>i.invalidateLayerData(t,e))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(t=tr.UPDATE){this.renderer.setNeedsRender(t)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(t,e,i,r){const s=this.layerViewByIndex(e,i),n=s.layer;return!n.tilemapCache||_A(s)?this._requestTileData(t,i,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(t.lij[0],t.lij[1],t.lij[2],{...r,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,Et(r),ms(o)||this._dataMissing(t,i,s),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(t,i,s,r),r.signal)))}_requestTileData(t,e,i,r){const s=e===jt.ELEVATION;return r.requester??(r.requester=s?this._elevationDataRequester:this._mapDataRequester),s?pJ(i)?this._requestElevationTileData(t,i,r):Promise.reject():fJ(i)?this._requestMapTileData(t,i,r):Promise.reject()}_requestElevationTileData(t,e,i){++this._asyncWorkItems;const r=n=>{!Yn(i)&&n&&(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(t,e,n))},s=n=>{ms(n)||(ie.getLogger(this).error(`Tile ${t.lij.toString()} layer ${jt.ELEVATION}/${e.uid} error ${n}`),this._dataMissing(t,jt.ELEVATION,e),this.requestUpdate())};return e.fetchTile(t.lij,i).then(n=>this._frameTask.schedule(()=>r(n)),s).finally(()=>--this._asyncWorkItems)}_elevationDataArrived(t,e,i){const r=this._layerIndexByUid[jt.ELEVATION].get(e.uid);if(r==null)return void ie.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",jt.ELEVATION,t.lij.toString());const s=new eMt(t.lij,t.extent,i);t.dataArrived(r,jt.ELEVATION,s);const n=[t],o=t.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(n)}_requestMapTileData(t,e,i){++this._asyncWorkItems;const r=(a,l)=>{uM(l),Yn(i)||(console.error(`Tile ${t.lij.toString()} layer ${jt.MAP}/${e.uid} error ${a}`),this._dataMissing(t,jt.MAP,e),this.requestUpdate())},s=a=>l=>r(l,a),n=a=>this._frameTask.schedule(()=>{this.requestUpdate(),Yn(i)?uM(a):this._mapTileDataArrived(t,e,a)},i.signal,s(a)).catch(s(a)),o=(a,l=null)=>this._frameTask.schedule(()=>r(a,l));return e.fetchTile(t.lij,i).then(n,o).finally(()=>--this._asyncWorkItems)}_mapTileDataArrived(t,e,i){const r=this._getLayerIdxByUID(jt.MAP,e.uid);if(r==null)return uM(i),void ie.getLogger(this).warn("TerrainSurface: received data from unknown layer");t.dataArrived(r,jt.MAP,i)}_getLayerIdxByUID(t,e){return this._layerIndexByUid[t].get(e)}_dataMissing(t,e,i){const r=this._getLayerIdxByUID(e,i.uid);r!=null?t.dataMissing(r,e):ie.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(t){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(e=>{e.renderData&&this.overlayManager.setTileParameters(e)}),this._renderer.setNeedsRender(t))}get performanceInfo(){const t=this._performanceInfo;return t.numNodes=this._allTiles.length,t.numLeaves=t.numVisible=t.numRendered=t.numLoadedPerLevel.length=t.numRenderedPerLevel.length=0,this._allTiles.forAll(e=>{e.isLeaf&&t.numLeaves++;const i=e.level;e.renderData&&(t.numLoadedPerLevel[i]=(t.numLoadedPerLevel[i]||0)+1),e.visible&&(t.numVisible++,e.rendered&&(t.numRenderedPerLevel[i]=(t.numRenderedPerLevel[i]||0)+1,t.numRendered++))}),t}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((t,e)=>t+e.usedMemory,0)):null}getUsedMemoryForLayerView(t){let e=0;const i=this._layerClassFromLayerView(t),r=this._getLayerIdxByUID(i,t.uid);return r!=null&&this._allTiles.forAll(s=>e+=s.getUsedMemoryForLayer(i,r)),e}getTile(t){if(t==null||this._rootTiles==null)return null;const e=t.split("/").map(o=>+o);if(e[0]===0)return this._rootTiles.find(o=>o.lij[1]===e[1]&&o.lij[2]===e[2]);const i=e[0],r=e[1]>>i,s=e[2]>>i;let n;if(this._rootTiles.some(o=>o.lij[1]===r&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<e[0]-1;for(;n.lij[0]<e[0];){let a=e[1]&o?2:0;if((e[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return Un(n.lij[0]===e[0]&&n.lij[1]===e[1]&&n.lij[2]===e[2],"not the right tile?"),n}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(t){this._renderer.renderPatchBorders=t}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(t){this._renderer.visualizeNormals=t}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(t){this._renderer.renderingDisabled=t}get test(){}checkAllTilesWaterproofness(){if(!TV)return;const t=this._rootTiles;if(t==null)return;const e=n=>{var o,a,l;return((l=(a=(o=n==null?void 0:n.renderData)==null?void 0:o.geometry)==null?void 0:a.indices)==null?void 0:l.length)>0},i=(n,o)=>{e(n)&&console.error("Tile[",n.lij,"] has geometry although parent[",o.lij,"] has geom")},r=n=>{var o,a;if(n.intersectsClippingArea)if(n.renderData&&!n.renderData.geometryState&&console.error("Tile[",n.lij,"] has renderData but not geometryState"),n.renderData&&!n.renderData.geometry&&console.error("Tile[",n.lij,"] has renderData but not geometryInfo"),!((o=n.renderData)!=null&&o.geometry)||(((a=n.renderData.geometry.indices)==null?void 0:a.length)??0)>0||console.error("Tile[",n.lij,"] has renderData but no indices - geometryInfo: ",n.renderData.geometry),e(n)){n.checkGeometryWaterproofness();for(const l of n.children)i(l,n)}else if(n.isLeaf)console.error("Tile[",n.lij,"] has no geometry and no children, from root to leaf");else for(const l of n.children)r(l)},s=n=>{var c;const o=((c=n.parent)==null?void 0:c.visible)??!0,a=n.visible;n.computeVisibility();const l=n.visible;if(a!==l&&o&&console.error(" Tile[",n.lij,"] has out of date visibility: ",a," instead of ",l),!n.isLeaf)for(const u of n.children)s(u)};for(const n of t)r(n),s(n)}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(t){return this._isGlobal&&t[2]===this.lijEastEnd(t[0])-1}isWestEndWrap(t){return this._isGlobal&&t[2]===0}lijEastEnd(t){return 1<<t+(this._isGeographic?1:0)}wrapEastWest(t){const e=this.lijEastEnd(t[0]),i=t[2];if(0<=i&&i<e)return t;if(!this._isGlobal)return null;const r=(i+(i<0?e:0))%e;return[t[0],t[1],r]}enableInternalChecks(t){fMt(t)}enableWaterproofnessChecks(t){pMt(t)}};Jt._tileMemcacheKey="TerrainTileMemcache",h([f()],Jt.prototype,"_renderer",void 0),h([f({constructOnly:!0})],Jt.prototype,"_scaleRangeQueries",void 0),h([f({constructOnly:!0})],Jt.prototype,"view",void 0),h([f({constructOnly:!0})],Jt.prototype,"overlayManager",void 0),h([f()],Jt.prototype,"_hasPendingUpdates",void 0),h([f()],Jt.prototype,"_asyncWorkItems",void 0),h([f()],Jt.prototype,"_allTilesDirty",void 0),h([f()],Jt.prototype,"_allTilesSorted",void 0),h([f()],Jt.prototype,"_viewChanged",void 0),h([f({type:Number})],Jt.prototype,"heading",void 0),h([f()],Jt.prototype,"_splitLimits",void 0),h([f({readOnly:!0})],Jt.prototype,"_watchUpdatingTracking",void 0),h([f()],Jt.prototype,"_frameTask",void 0),h([f({readOnly:!0})],Jt.prototype,"snapLevel",null),h([f({readOnly:!0})],Jt.prototype,"lodSnapping",null),h([f()],Jt.prototype,"_userClippingExtent",null),h([f()],Jt.prototype,"_rootTilesExtent",void 0),h([f({readOnly:!0})],Jt.prototype,"extent",null),h([f({readOnly:!0})],Jt.prototype,"groundExtent",null),h([f({readOnly:!0})],Jt.prototype,"_tilingSchemeExtent",null),h([f({readOnly:!0})],Jt.prototype,"updating",null),h([f({readOnly:!0})],Jt.prototype,"running",null),h([f(QCt)],Jt.prototype,"updatingProgress",void 0),h([f({readOnly:!0})],Jt.prototype,"updatingProgressValue",null),h([f()],Jt.prototype,"_maxNumUpdating",void 0),h([f()],Jt.prototype,"baseOpacity",null),h([f()],Jt.prototype,"hasCompositeBlendMode",void 0),h([f({readOnly:!0})],Jt.prototype,"viewingMode",null),h([f()],Jt.prototype,"maxTextureScale",void 0),h([f({readOnly:!0})],Jt.prototype,"ready",null),h([f({value:vA.FRONT_TO_BACK})],Jt.prototype,"renderOrder",null),h([f({readOnly:!0})],Jt.prototype,"rootTiles",null),h([f()],Jt.prototype,"_rootTiles",void 0),h([f({readOnly:!0})],Jt.prototype,"spatialReference",null),h([f({type:Oe})],Jt.prototype,"backgroundColor",null),h([f({value:!1})],Jt.prototype,"slicePlaneEnabled",null),h([f({readOnly:!0})],Jt.prototype,"tilingScheme",void 0),h([f({readOnly:!0})],Jt.prototype,"tilingSchemeLocked",null),h([f({readOnly:!0})],Jt.prototype,"tilingSchemeLogic",void 0),h([f()],Jt.prototype,"wireframe",null),h([f({value:!1})],Jt.prototype,"suspended",null),h([f()],Jt.prototype,"fadeDuration",null),h([f()],Jt.prototype,"visibleElevationBounds",void 0),h([f()],Jt.prototype,"rootTileElevationBounds",void 0),h([f()],Jt.prototype,"_layerViewsDirty",void 0),h([f()],Jt.prototype,"renderPatchBorders",null),h([f()],Jt.prototype,"visualizeNormals",null),h([f()],Jt.prototype,"renderingDisabled",null),Jt=ok=h([I("esri.views.3d.terrain.TerrainSurface")],Jt);const GPt=Jt,mO=E(),U2=ln(),jPt=Ht();new Zt;const wq=new JCt("ground"),VF={spatialReference:null,extent:null,scale:0};function yye(t,e,i){var r;for(const s of t){if(!s.containsPointXY(e,i))continue;let n=s;for(;n&&!n.renderData;){const a=(e>n.extentMidX?1:0)+(i<n.extentMidY?2:0);n=n.children[a]}const o=((r=n==null?void 0:n.renderData)==null?void 0:r.geometryState.samplerData)??null;return _s(e,i,o)}return null}let HPt=class{constructor(e){this.capacity=e,this._head=0,this._tail=0,this._data=new Array(e)}push(e){const i=this._tail;if(!(i<this.capacity))throw new Error("Queue full");this._data[i]=e,this._tail=i+1}pushAll(e){const i=e.length;if(i===0)return;const r=this._tail;if(!(r+i<=this.capacity))throw new Error("Queue full");for(let s=0;s<i;++s)this._data[r+s]=e[s];this._tail=r+i}pop(){const e=this._head;if(e<this._tail){const i=this._data[e];return this._head=e+1,i}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}};function xq(t,e){!t.isLeaf||t.level<Bn||Xse(t,i=>{e&&BNe(i);const r=CJ(i);if(i.maxLevelDeltaNeighborCount++,r){let s=i.parent;for(;s;){const n=CJ(s);if(s.unmergableChildCount++,!n)break;s=s.parent}}})}function BNe(t){if(t.hasPendingUpdate(yt.SPLIT))return;let e=t.parent;for(;e!=null&&e.resetPendingUpdate(yt.MERGE);)e=e.parent;t.resetPendingUpdate(yt.MERGE),t.isLeaf&&t.setPendingUpdate(yt.SPLIT),t.level<Bn||Xse(t,i=>{BNe(i)})}function _ye(t){t.level<Bn||Xse(t,e=>{if(e.maxLevelDeltaNeighborCount--,e.maxLevelDeltaNeighborCount===0&&e.unmergableChildCount===0){let i=e.parent;for(;i&&(i.unmergableChildCount--,CJ(i));)i=i.parent}})}function CJ(t){return t.maxLevelDeltaNeighborCount===0&&t.unmergableChildCount===0}function Xse(t,e){if(t.level<Bn)return;const i=t.level-Bn,r=t.lij[1]>>Bn,s=t.lij[2]>>Bn,n=o=>o.isLeaf||o.level===i;for(let o=0;o<4;++o){const a=t.findNeighborTile(pf[o],n);if(!a||a.level!==i)continue;const l=a.lij;l[1]===r&&l[2]===s||e(a)}}let qPt=class{constructor(e,i,r,s){this.operation=e,this.geometry=i,this.states=r,this.sync=s}},i$=class extends Re{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,i){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c},u)=>{let d=!1;if(l===ls.UPDATE){const p=o.get(u);if(p){if(c&Wn.TRANSFORMATION){const m=this.model.getObject(n);this.model.updateRenderGeometryTransformation(m,a,p)&&(d=!0)}d||i.updates.push({renderGeometry:p,updateType:c})}else ft(!1,"ModelDirtySet.commitLayer: invalid update")}if(l===ls.REMOVE||d){const p=o.get(u);p?(i.removes.push(p),o.delete(u)):l===ls.REMOVE&&ft(!1,"ModelDirtySet.commitLayer: invalid remove")}if(l===ls.ADD||d){const p=this.model.getObject(n);if(p!=null){const m=this.model.getRenderGeometry(p,a);i.adds.push(m),o.set(u,m)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(e,i){const r=this._dirtyGeomRecords.get(e);r&&r.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c,sync:u},d)=>{let p=!1;if(l===ls.UPDATE&&u){const m=o.get(d);if(m){if(c&Wn.TRANSFORMATION){const g=this.model.getObject(n);this.model.updateRenderGeometryTransformation(g,a,m)&&(p=!0)}p||i.updates.push({renderGeometry:m,updateType:c})}else ft(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}getResidentRenderGeometries(e,i){const r=this._residentGeomRecords.get(e);r&&r.forEach(s=>s.forEach(n=>i.push(n)))}_objectStateChanged(e,i){for(const r of i.geometries)this._updateOrCreateDirtyRecord(i,r,null,ls.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Wn.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Wn.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Wn.OCCLUDEE,e)}attributesChanged({object:e,geometry:i,sync:r}){this._updateOrCreateDirtyRecord(e,i,null,ls.UPDATE,Wn.GEOMETRY,r)}layerAdded(e){e.objects.forAll(i=>this._layerObjectAdded(e,i))}layerRemoved(e){e.objects.forAll(i=>this._layerObjectRemoved(e,i))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,i){const r=e.id;for(const s of i.geometries)this._geometryAdded(i,s,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const i of e.objects)this._layerObjectAdded(e.layer,i)}layerObjectsRemoved(e){for(const i of e.objects)this._layerObjectRemoved(e.layer,i)}_layerObjectRemoved(e,i){const r=e.id;for(const s of i.geometries)this._geometryRemoved(i,s,r)}transformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,i,ls.UPDATE,Wn.TRANSFORMATION)})}shaderTransformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(s=>{s.objectShaderTransformationChanged(e.shaderTransformation)})}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,ls.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,ls.REMOVE)}_updateOrCreateDirtyRecord(e,i,r,s,n=Wn.NONE,o=!1){r=r??this._getParentLayerId(e);const a=e.id,l=i.id,c=this._ensureDirtyRecord(r,a),u=c.get(l);let d=!1;if(u){const p=u.operation;p===ls.REMOVE&&s===ls.ADD&&u.states!==Wn.NONE?u.operation=ls.UPDATE:p===ls.REMOVE&&s===ls.ADD||p===ls.ADD&&s===ls.REMOVE?(c.delete(l),d=!0):p!==ls.UPDATE||s!==ls.REMOVE&&s!==ls.UPDATE?(ft((p===ls.REMOVE||p===ls.ADD)&&s===ls.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),u.states|=n):(u.operation=s,u.states|=n),u.sync=u.sync||o}else c.set(l,new qPt(s,i,n,o));this.dirty=!d||this._hasDirtyGeometryRecords}_ensureGeomRecord(e,i){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let s=r.get(i);return s||(s=new Map,r.set(i,s)),s}get _hasDirtyGeometryRecords(){for(const e of this._dirtyGeomRecords.values())for(const i of e.values())if(i.size>0)return!0;return!1}_ensureDirtyRecord(e,i){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let s=r.get(i);return s||(s=new Map,r.set(i,s)),s}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:Qze}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let i="";return this._dirtyGeomRecords.forEach((r,s)=>{r.forEach((n,o)=>{i.length>0&&(i+=`
`),i+=s+"."+o;const a=[];n.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){i+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)i+=a[l][c]+", "}})}),i}get test(){}};h([f({constructOnly:!0})],i$.prototype,"model",void 0),h([f()],i$.prototype,"dirty",void 0),i$=h([I("esri.views.3d.webgl-engine.lib.ModelDirtySet")],i$);const WPt=i$;let ak=class extends Re{constructor(){super(...arguments),this.dirtySet=new WPt({model:this}),this._content=new Map,this._originFactory=new wIe(null)}getObject(e){return this._content.get(e)}add(e){const i=e.id;ft(!this._content.has(i),"Model/Stage already contains object to be added"),this._content.set(i,e),rV(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),rV(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(const i of e)i&&(ft(!this._content.has(i.id),"Model/Stage already contains object to be added"),this._content.set(i.id,i))}removeMany(e){for(const i of e)i&&(ft(this._content.has(i.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(i.id))}has(e){return this._content.has(e.id)}forEachOfType(e,i){this._content.forEach(r=>{r.type===e&&i(r)})}getRenderGeometry(e,i){const r=new gA(i,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});r.transformation=e.getCombinedStaticTransformation(i,vye);const{localOrigin:s}=i;return r.localOrigin=s??this._originFactory.getOrigin(r.boundingSphere),r}updateRenderGeometryTransformation(e,i,r){if(e==null)return!1;r.transformation=e.getCombinedStaticTransformation(i,vye);const s=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==s}getStats(){const e={},i=Array.from(this._content.values());for(let r=0;r<Ls.COUNT;++r)e[r]=i.filter(s=>s.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){}};h([f({constructOnly:!0})],ak.prototype,"dirtySet",void 0),ak=h([I("esri.views.3d.webgl-engine.parts.Model")],ak);const vye=Ee();let YPt=class{constructor(e){this._totalCount=e,this._componentCountCache=-1,this._indexRanges=[0,e]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return this._indexRanges.length===0}isVisible(e){if(e<0||e>=this._totalCount)return!1;if(this.allVisible())return!0;{const i=this._indexRanges;let r=0,s=i.length/2;if(e<i[2*r]||e>i[2*s]+i[2*s+1])return!1;for(;s-r>0;){const n=Math.floor(.5*(r+s)),o=i[2*n];if(e<o){if(s-r==1)return!1;s=n;continue}if(e<o+i[2*n+1])return!0;if(s-r==1)return!1;r=n+1}return!1}}get componentCount(){if(this._componentCountCache===-1){const e=this._indexRanges;let i=0;for(let r=0;r<e.length;r+=2)i+=e[r+1];this._componentCountCache=i}return this._componentCountCache}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=ZPt(e),this._componentCountCache=-1}forEachComponent(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let o=s;o<n;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!e(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(e){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],o=n+r[s+1],a=e[n],l=e[o];i[s]=a,i[s+1]=l-a}return i}};function ZPt(t){const e=new Array;if(t.length===0)return e;let i=t[0],r=1;for(let s=1;s<t.length;s++){const n=t[s];i+r===n?r+=1:(e.push(i),e.push(r),i=n,r=1)}return e.push(i),e.push(r),e}let XPt=class{constructor(e,i){this.offsets=i,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const r=this.count;this.visibility=new YPt(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:i}=JPt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=i}}};function JPt(t,e,i){const r=[],s=[];let n=i.length,o=i.length;return e.forEachComponent(a=>(t[a]>0?(n!==a-1&&(r.length&&r.push(i[n+1]-r[r.length-1]),r.push(i[a])),n=a):(o!==a-1&&(s.length&&s.push(i[o+1]-s[s.length-1]),s.push(i[a])),o=a),!0)),r.length&&r.push(i[n+1]-r[r.length-1]),s.length&&s.push(i[o+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}let QPt=class{constructor(e,i,r,s,n,o){this.transform=e,this.toMapSpace=i,this.obb=r,this.components=s,this.renderable=n,this.intersectionGeometry=o,this.visible=!1,this.offsetObb=null}destroy(){this.intersectionGeometry=Le(this.intersectionGeometry),this.renderable=Le(this.renderable),this.components=Le(this.components)}};function KPt(t,e,i,r,s,n,o){const a=n-o,l=e-t,c=new Float64Array(4*l);for(let u=0;u<l;++u){const d=3*(u+t),p=s*i[d+0],m=r[p+0],g=r[p+1],y=a/(r[p+2]-o),v=m*y,b=g*y,w=s*i[d+1],x=r[w+0],T=r[w+1],C=a/(r[w+2]-o),M=x*C,O=T*C,D=s*i[d+2],k=r[D+0],U=r[D+1],H=a/(r[D+2]-o),z=k*H,Z=U*H,q=4*u;c[q+0]=Math.min(v,M,z),c[q+1]=Math.min(b,O,Z),c[q+2]=Math.max(v,M,z),c[q+3]=Math.max(b,O,Z)}return c}function eOt(t,e,i,r,s){const n=e-t,o=new Float64Array(4*n);for(let a=0;a<n;++a){const l=3*(a+t),c=s*i[l+0],u=r[c+0],d=r[c+1],p=s*i[l+1],m=r[p+0],g=r[p+1],y=s*i[l+2],v=r[y+0],b=r[y+1],w=4*a;o[w+0]=Math.min(u,m,v),o[w+1]=Math.min(d,g,b),o[w+2]=Math.max(u,m,v),o[w+3]=Math.max(d,g,b)}return o}function tOt(t,e){return new(iOt(t))(e)}function iOt(t){return t<128?Uint8Array:t<32768?Uint16Array:t<1<<31?Uint32Array:Array}let GNe=class{constructor(e,i){this.elementCount=e,this.model=i,this._elementIndexMap=null,this._bspNodes=[],this._generatedBVH=!1,this.localMode=i.localMode,this.planetCenterZ=i.planetCenterZ,this.geometryMinZ=i.geometryMinZ,this.planetCenter=$e(0,0,this.planetCenterZ),this.maxBspNodeDepth=i.maxBspNodeDepth??8,this.minElementCountForBVH=i.minElementCountForBVH??15,this.minBspNodeElementCount=i.minBspNodeElementCount??5}get elementIndexMap(){return this._ensureBVH(),this._elementIndexMap}get _skipBVH(){return this.elementCount<this.minElementCountForBVH||this.geometryMinZ<.5*this.planetCenterZ}_ensureBVH(){this._generatedBVH||this._skipBVH||this._bspNodes.length===0&&this._generateBsp()}intersectRay(e,i,r){this.elementCount<1||(this._skipBVH?this._intersectRayWithoutBVH(r):this._intersectRayWithBVH(e,i,r))}_intersectRayWithoutBVH(e){this._intersectRange(0,this.elementCount)}_intersectRange(e,i){this.model.intersectRange(e,i)}_intersectRayWithBVH(e,i,r){this._ensureBVH(),r?this._intersectGeometryWithBVHVerticalRay(e):this._intersectGeometryWithBVHGeneralRay(e,i)}_intersectGeometryWithBVHVerticalRay(e){let i=e[0],r=e[1];if(!this.localMode){const{geometryMinZ:o,planetCenterZ:a}=this,l=(o-a)/(e[2]-a);i=e[0]*l,r=e[1]*l}const{_bspNodes:s}=this;let n=0;for(;n>=0;){const o=s[n],{d:a,dim:l,minIndexIndex:c,minMidIndexIndex:u,maxMidIndexIndex:d,maxIndexIndex:p,aabb2D:m}=o;if(i<m[0]||i>m[2]||r<m[1]||r>m[3])break;if(l===-1||o.child0===-1&&o.child1===-1){this._intersectRange(c,p);break}{this._intersectRange(u,d);const g=(l===0?i:r)-a;if(g<0){if(o.child0===-1){this._intersectRange(c,u);break}n=o.child0}else{if(!(g>0))break;if(o.child1===-1){this._intersectRange(d,p);break}n=o.child1}}}}_intersectGeometryWithBVHGeneralRay(e,i){let r=e[0],s=e[1],n=i[0],o=i[1];const{geometryMinZ:a}=this;if(!this.localMode){let g=0,y=1;const v=Math.min(.5*this.planetCenterZ,a),b=e[2],w=i[2];if(b<v&&w<v||(b<v&&(g=(v-b)/(w-b)),w<v&&(y=(v-b)/(w-b)),g>y))return;const x=(1-g)*e[0]+g*i[0],T=(1-g)*e[1]+g*i[1],C=(1-g)*e[2]+g*i[2],M=(1-y)*e[0]+y*i[0],O=(1-y)*e[1]+y*i[1],D=(1-y)*e[2]+y*i[2],{planetCenterZ:k}=this,U=a-k,H=U/(C-k);r=x*H,s=T*H;const z=U/(D-k);n=M*z,o=O*z}const l=n-r,c=o-s,u=this._bspNodes;let d=1;{const{aabb2D:g}=u[0],y=(w,x,T,C)=>{if(Math.abs(x)<1e-5*Math.max(C-T,1))return!1;const M=x>0,O=M?C:T,D=w+d*x;return(M?D<O:D>O)&&(d=Math.max((O-w)/x,d),!0)},v=()=>y(r,l,g[0],g[2]),b=()=>y(s,c,g[1],g[3]);Math.abs(l)>=Math.abs(c)?v()||b():b()||v()}const p=[0,0,d];let m=0;for(;m<p.length;){const g=p[m];let y=p[m+1],v=p[m+2];if(m+=3,y>v)continue;const b=u[g],{minIndexIndex:w,maxIndexIndex:x}=b,{child0:T,child1:C,minMidIndexIndex:M,maxMidIndexIndex:O,aabb2D:D,d:k,dim:U}=b;{const H=r+y*l,z=r+v*l,Z=Math.min(H,z),q=Math.max(H,z),Y=D[0],de=D[2];if(q<Y||de<Z)continue;if(Z<Y){const L=(Y-r)/l;l>0?y=Math.max(y,L):v=Math.min(v,L)}if(de<q){const L=(de-r)/l;l>0?v=Math.min(v,L):y=Math.max(y,L)}}{const H=s+y*c,z=s+v*c,Z=Math.min(H,z),q=Math.max(H,z),Y=D[1],de=D[3];if(q<Y||de<Z)continue;if(Z<Y){const L=(Y-s)/c;c>0?y=Math.max(y,L):v=Math.min(v,L)}if(de<q){const L=(de-s)/c;c>0?v=Math.min(v,L):y=Math.max(y,L)}}if(T===-1&&C===-1)this._intersectRange(w,x);else{const H=U===0?r:s,z=U===0?l:c,Z=H+y*z,q=H+v*z,Y=Math.min(Z,q),de=Math.max(Z,q),L=Te((k-H)/z,0,d);w<M&&Y<=k&&(T!==-1?(p.push(T),p.push(z>=0?y:Math.max(y,L)),p.push(z>=0?Math.min(v,L):v)):this._intersectRange(w,M)),this._intersectRange(M,O),O<x&&k<=de&&(C!==-1?(p.push(C),p.push(z>=0?Math.max(y,L):y),p.push(z>=0?v:Math.min(v,L))):this._intersectRange(O,x))}}}_generateBsp(){const{elementCount:e}=this;if(e<1)return;const i=tOt(e,e);this._elementIndexMap=i;for(let m=0;m<e;++m)i[m]=m;const r=this.model.getAabbs2D();let s=0;const n=this._bspNodes;n.length=0;const{localMode:o}=this;let a=!1;if(!o){const{planetCenterZ:m,geometryMinZ:g}=this;a=m>=0||g<.5*m}const l=[],c=(m,g,y,v,b)=>{l.push(m),l.push(g),l.push(y),l.push(v<0?-1:(b?0:1)+2*v)},{maxBspNodeDepth:u,minBspNodeElementCount:d}=this,p=(m,g,y,v,b)=>{const w=n.length;if(w>0&&(a||y>=u||g-m<d))return;const x=[0,0,0,0];oOt(x,m,g,i,r);const{d:T,dim:C}=o?rOt(x):sOt(x),{rangeMidStart:M,rangeMidEnd:O}=nOt(m,g,C,T,i,r),D=y===u-1,k=!D&&M>=m+d,U=!D&&g>=O+d;if(k||U||w===0){const H=new aOt(m,M,O,g,C,T,x);if(k&&c(m,M,y+1,w,!0),U&&c(O,g,y+1,w,!1),n.push(H),v!==-1){const z=n[v];b?z.child0=w:z.child1=w}}};for(c(0,e,0,-1,!1);s<l.length;){const m=l[s],g=l[s+1],y=l[s+2],v=l[s+3];s+=4;const b=v>>1;p(m,g,y,b,v-(b<<1)==0)}this._generatedBVH=!0}};function rOt(t){const e=t[0],i=t[1],r=t[2],s=t[3];let n,o;return r-e>=s-i?(o=.5*(e+r),n=0):(o=.5*(i+s),n=1),{d:o,dim:n}}function sOt(t){const e=t[0],i=t[1],r=t[2],s=t[3];let n,o;return r-e>=s-i?(n=0,o=.5*(e+r)):(n=1,o=.5*(i+s)),{dim:n,d:o}}function nOt(t,e,i,r,s,n){let o=t;{let u=e;for(;o<u;){const d=s[o];bye(d,i,r,n)<0?++o:(--u,s[o]=s[u],s[u]=d)}}const a=o;let l=o,c=e;for(;l<c;){const u=s[c-1];bye(u,i,r,n)>0?--c:(s[c-1]=s[l],s[l]=u,++l)}return{rangeMidStart:a,rangeMidEnd:c}}function bye(t,e,i,r){const s=4*t,n=r[s+0+e];return r[s+2+e]<i?-1:n>i?1:0}function oOt(t,e,i,r,s){let n=1/0,o=1/0,a=-1/0,l=-1/0;for(let c=e;c<i;++c){const u=4*r[c];n=Math.min(n,s[u+0]),o=Math.min(o,s[u+1]),a=Math.max(a,s[u+2]),l=Math.max(l,s[u+3])}t[0]=n,t[1]=o,t[2]=a,t[3]=l}let aOt=class{constructor(e,i,r,s,n,o,a){this.minIndexIndex=e,this.minMidIndexIndex=i,this.maxMidIndexIndex=r,this.maxIndexIndex=s,this.dim=n,this.d=o,this.aabb2D=a,this.child0=-1,this.child1=-1}},lOt=class{constructor(e,i,r,s,n,o,a,l,c){this.componentIndex=e,this.vertexData=i,this.vertexStride=r,this.indexData=s,this.startTriangleNumber=n,this.endTriangleNumber=o,this.geometryMinZ=a,this.planetCenterZ=l,this.localMode=c,this.maxBspNodeDepth=8,this.minElementCountForBVH=20,this.minBspNodeElementCount=10,this.rayDirection=E(),this.ray0=E(),this.isVerticalRay=!1,this._triangleHitCallback=wye,this.totalElevationOffset=0,this.normalRequired=!1,this._bvh=new GNe(o-n,this)}getAabbs2D(){return this.localMode?eOt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride):KPt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride,this.geometryMinZ,this.planetCenterZ)}get numTriangles(){return this.endTriangleNumber-this.startTriangleNumber}intersectRay(e,i,r,s,n,o){ce(this.ray0,e),Ai(this.rayDirection,i,e),this.isVerticalRay=r,this.totalElevationOffset=s,this.normalRequired=o,this._triangleHitCallback=n,this._bvh.intersectRay(e,i,r),this._triangleHitCallback=wye}intersectRange(e,i){const r=this._bvh.elementIndexMap;jNe(this.ray0,this.rayDirection,e,i,this.indexData,this.vertexData,this.vertexStride,this.totalElevationOffset,this.planetCenterZ,this.normalRequired,this._triangleHitCallback,r,this.startTriangleNumber)}getTriangleElevationOffset(e){return this.totalElevationOffset}};function jNe(t,e,i,r,s,n,o,a,l,c,u,d=null,p=0){a!==0?ddt(t,e,i,r,s,n,o,a,l,c,u,d,p):bRe(t,e,i,r,s,n,o,c,u,d,p)}function wye(){}function cOt(t,e,i,r){if(i>=e)return t;t==null&&(t=uOt());const s=t.isVisibleBit;let n=t.data;const o=HNe(n),a=i/o|0,l=i-o*a,c=(e-1)/o|0,u=n,d=r===s;if(!(i<u.length*o)&&d){const p=a+1,m=Math.ceil(u.length*BV),g=c+1;let y=Math.max(p,m);y=Math.min(y,g),n=new Uint32Array(y),n.set(u)}return a<n.length&&(n[a]=dOt(n[a],l,d)),t.data=n,t}function MJ(t,e){if(t==null)return!0;const{isVisibleBit:i,data:r}=t,s=HNe(r);return e<r.length*s?hOt(i,r,e,s):!t.isVisibleBit}function uOt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function hOt(t,e,i,r){const s=i/r|0,n=i-s*r;return pOt(e[s],n)===t}function HNe(t){return t.BYTES_PER_ELEMENT*8}function dOt(t,e,i){return t&~(1<<e)|(i?1:0)<<e}function pOt(t,e){return!!(t&1<<e)}let fOt=class{constructor(e,i,r,s,n,o,a,l){this.vertexData=e,this.vertexStride=i,this.indexData=r,this._components=s,this._componentAabbs3D=n,this.geometryMinZ=o,this.planetCenterZ=a,this.localMode=l,this.maxBspNodeDepth=6,this.minElementCountForBVH=10,this.minBspNodeElementCount=3,this._ray0=_Ot,this._ray1=vOt,this._invDir=E(),this._componentVerticalOffsets=null,this._verticalOffset=null,this._tolerance=0,this._intersectionOptions=bOt,this._callback=xye,this.rayDirectionC=E(),this._componentIndexMap=null,this._bvh=new GNe(s.count,this),this.componentIntersectionData=new Array(s.count)}get numComponents(){return this._components.count}get minZGlobal(){return this.geometryMinZ-this.planetCenterZ}getAabbs2D(){return this.localMode?this.getAabbs2DLocal():this.getAabbs2DGlobal()}getAabbs2DGlobal(){const{numComponents:e,planetCenterZ:i,minZGlobal:r}=this,s=new Float64Array(4*e),n=this._componentAabbs3D;for(let o=0;o<e;++o){const a=6*o,l=n[a+0],c=n[a+1],u=n[a+2],d=n[a+3],p=n[a+4],m=r/(u-i),g=r/(n[a+5]-i),y=Math.min(l*m,l*g),v=Math.min(c*m,c*g),b=Math.max(d*m,d*g),w=Math.max(p*m,p*g),x=4*o;s[x+0]=y,s[x+1]=v,s[x+2]=b,s[x+3]=w}return s}getAabbs2DLocal(){const{numComponents:e}=this,i=new Float64Array(4*e),r=this._componentAabbs3D;for(let s=0;s<e;++s){const n=6*s,o=r[n+0],a=r[n+1],l=r[n+3],c=r[n+4],u=4*s;i[u+0]=o,i[u+1]=a,i[u+2]=l,i[u+3]=c}return i}intersectRay(e,i,r,s,n,o,a){const{isVerticalRay:l}=a;this._ray0=e,this._ray1=i,this._componentVerticalOffsets=r,this._verticalOffset=s,this._tolerance=o,this._intersectionOptions=a,this._componentIndexMap=this._bvh.elementIndexMap,_dt(e,i,this._invDir),this._callback=n,this._bvh.intersectRay(e,i,l),this._callback=xye}intersectRange(e,i){const r=this._componentIndexMap,s=this._components,n=s.pickability,o=s.visibility;for(let a=e;a<i;++a){const l=r?r[a]:a;MJ(n,l)&&o.isVisible(l)&&this._intersectComponent(l)}}getComponentTriangleCount(e){const i=this._components.offsets,r=i[e]/3;return i[e+1]/3-r}getComponentAabb3D(e,i){const r=this._componentAabbs3D,s=6*e;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}_intersectComponent(e){if(!MJ(this._components.pickability,e))return;const i=this.getComponentAabb3D(e,mOt);let r=!1;const{localMode:s,_componentVerticalOffsets:n,_verticalOffset:o,_ray0:a,_ray1:l,_invDir:c,planetCenterZ:u,_tolerance:d,rayDirectionC:p,componentIntersectionData:m}=this,{isVerticalRay:g}=this._intersectionOptions,y=this._components.offsets,v=ce(gOt,a),b=ce(yOt,l),w=(n==null?void 0:n[e])??0,x=w+((o==null?void 0:o.offset)??0);if(x!==0&&(s?(v[2]=a[2]-x,b[2]=l[2]-x,r=!0):o!=null&&(o.componentOffset=w)),o==null||r||x===0||o.applyToAabb(i),!xre(i,v,c,d))return;Ai(p,b,v);const T=y[e]/3,C=y[e+1]/3,M=C-T,O=(Z,q,Y)=>{this._callback(Z,q,e,Y)},{vertexData:D,vertexStride:k,indexData:U,_intersectionOptions:H}=this,{normalRequired:z}=H;if(M>wOt){let Z=m[e];Z==null&&(Z=new lOt(e,D,k,U,T,C,this.geometryMinZ,u,s),m[e]=Z),Z.intersectRay(v,b,g,r?0:x,O,z)}else jNe(v,p,T,C,U,D,k,r?0:x,u,z,O)}};const mOt=Jn(),gOt=E(),yOt=E(),_Ot=E(),vOt=E(),xye=()=>{},bOt=new AL,wOt=40;let xOt=class{constructor(e,i,r){this.viewingMode=e,this.positionData=i,this._components=r,this.verticalOffset=null,this.componentVerticalOffsets=null,this._planetCenter=E(),this._componentBvh=null,this._aabb=[0,0,0,0,0,0],this._indices=i.indices?fg(i.indices):RT(i.positions.length/3),this._positions=i.positions}destroy(){this._positions=null,this._indices=null,this._perComponentAabbs=null,this._componentBvh=null}getComponentAabb(e,i){const r=this._ensureComponentAabbs(),s=6*e;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){return this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs()),this._perComponentAabbs}getComponentPositions(e,i){i.indices=this._indices,i.data=this._positions,i.stride=3,i.startIndex=this._components.offsets[e],i.endIndex=this._components.offsets[e+1]}intersect(e,i,r,s,n,o,a,l){this.verticalOffset=s,this.componentVerticalOffsets=n;const{position:c}=o,u=Ai(SOt,e,c),d=Ai(TOt,i,c),p=aL(EOt,o.rotationScale);Qo(u,u,p),Qo(d,d,p);const m=xT(MOt,p);if(this.viewingMode===Ge.Global){const y=this._planetCenter;ea(y,c),Qo(y,y,p)}const g=(y,v,b,w)=>{l(b,y,w?Qo(COt,w,m):null,v)};this._intersectComponents(u,d,n,s,g,r,a)}_computePerComponentAabbs(){const e=this._aabb,i=.5*(e[0]+e[3]),r=.5*(e[1]+e[4]),s=.5*(e[2]+e[5]),n=this._components.count,o=ws(6*n),a=this._indices,l=this._positions,c=this._components.offsets;let u=0,d=1/0,p=1/0,m=1/0,g=-1/0,y=-1/0,v=-1/0;for(let b=0;b<n;b++){const w=c[b],x=c[b+1];let T=1/0,C=1/0,M=1/0,O=-1/0,D=-1/0,k=-1/0;if(w<x)for(let U=w;U<x;U++){const H=3*a[U],z=l[H],Z=l[H+1],q=l[H+2];T=Math.min(T,z),C=Math.min(C,Z),M=Math.min(M,q),O=Math.max(O,z),D=Math.max(D,Z),k=Math.max(k,q)}else T=i,C=r,M=s,O=i,D=r,k=s;o[u++]=T,o[u++]=C,o[u++]=M,o[u++]=O,o[u++]=D,o[u++]=k,d=Math.min(d,T),p=Math.min(p,C),m=Math.min(m,M),g=Math.max(g,O),y=Math.max(y,D),v=Math.max(v,k)}return this._aabb[0]=d,this._aabb[1]=p,this._aabb[2]=m,this._aabb[3]=g,this._aabb[4]=y,this._aabb[5]=v,o}_intersectComponents(e,i,r,s,n,o,a){let l=this._componentBvh;l==null&&(l=new fOt(this._positions,3,this._indices,this._components,this._ensureComponentAabbs(),this.geometryMinZ,this.planetCenterZ,this.localMode),this._componentBvh=l),l.intersectRay(e,i,r,s,n,o,a)}get geometryMinZ(){return this._aabb[2]}get planetCenterZ(){return this._planetCenter[2]}get numTriangles(){return this._indices.length/3}get localMode(){return this.viewingMode===Ge.Local}get positions(){return this._positions}get indices(){return this._indices}get aabb(){return this._ensureComponentAabbs(),this._aabb}};const SOt=E(),TOt=E(),EOt=Gr(),COt=E(),MOt=Gr();let AOt=class{constructor(e,i,r){this.material=e,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},POt=class{constructor(e,i,r,s){this.vao=e,this.primitiveType=i,this.parameters=r,this.indexed=s}dispose(){this.vao.dispose()}},Jse=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function OOt(t,e){return{near:t,far:e}}function jL(t){return OOt(1/0,-1/0)}function RV(t,e,i){return t.near=e,t.far=i,t}function bA(t,e){e!=null&&(t.near=Math.min(t.near,e.near),t.far=Math.max(t.far,e.far))}function BF(t,e){return t.near<=e&&e<=t.far}const AJ={near:0,far:0};function ROt(t,e){const i=jL(),{eye:r,frustum:s,viewForward:n}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=pe(Ai(Hu,a.center,r),n),c=a.projectedRadius(n);if(BF(i,l-c)&&BF(i,l+c))return;const u=NOt(a,s);if(u===-1)return;if(u===0)return cy.far=l+c,cy.near=l-c,void bA(i,cy);const d=GF.pushNew();d.near=l-c,d.far=l+c,d.mask=u,d.object=o});for(let o=0;o<GF.length;o++){const a=GF.data[o];if(BF(i,a.near)&&BF(i,a.far))continue;cy.far=a.far,cy.near=1/0,DOt(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,r,$Ot,c=>{let u=IOt;for(let d=0;d<qNe&&c.length>0;d++){if(!(a.mask&1<<d))continue;LOt(s[d],c,u);const p=c;c=u,u=p}for(let d=0;d<c.length;d+=3){ne(dc,c.data[d],c.data[d+1],c.data[d+2]);const p=pe(Ai(dc,dc,r),n);cy.near=Math.min(cy.near,p)}})===0&&(cy.near=0),bA(i,cy)}return GF.length=0,i}const GF=new Zt({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),cy=jL(),dc=E(),dw=E(),$Ot=new Zt({deallocator:null}),IOt=new Zt({deallocator:null});function LOt(t,e,i){i.length=0;const r=e.length-3;Sq(dc,e,r);const s=Er(t,dc);s<=0&&(i.push(dc[0]),i.push(dc[1]),i.push(dc[2]));let n=0,o=s;for(;n<r;n+=3){Sq(dw,e,n);const a=Er(t,dw);o*a<0&&(yr(dc,dw,dc,a/(a-o)),pc(i,dc)),a<=0&&pc(i,dw),o=a,ce(dc,dw)}o*s<0&&(Sq(dw,e,r),yr(dc,dw,dc,s/(s-o)),pc(i,dc))}function Sq(t,e,i){return ne(t,e.data[i],e.data[i+1],e.data[i+2])}function pc(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function DOt(t,e,i,r){o1(Tye,t.quaternion),Ai(Hu,e,t.center),Jc(Hu,Hu,Tye);const s=t.halfSize,n=8*((Hu[0]<-s[0]?-1:Hu[0]>s[0]?1:0)+3*(Hu[1]<-s[1]?-1:Hu[1]>s[1]?1:0)+9*(Hu[2]<-s[2]?-1:Hu[2]>s[2]?1:0)+13),o=Sye[n];if(o===0)return o;YI(jF,t.quaternion),lL(jF,jF,t.halfSize);const a=(l,c)=>{const u=Sye[n+c+1];return ne(l,((1&u)<<1)-1,(2&u)-1,((4&u)>>1)-1),Qo(l,l,jF),me(l,t.center,l)};return i.length=0,pc(i,a(Tq,0)),pc(i,a(Eye,1)),pc(i,a(Hu,2)),pc(i,a(Cye,3)),r(i),o===1||(i.length=0,pc(i,Tq),pc(i,Cye),pc(i,a(Hu,4)),pc(i,a(Mye,5)),r(i),o===2||(i.length=0,pc(i,Tq),pc(i,Mye),pc(i,a(Hu,6)),pc(i,Eye),r(i))),o}const Sye=(()=>{const t=new Array(216);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),t})(),qNe=4;function NOt(t,e){let i=0;for(let r=0;r<qNe;r++){const s=t.intersectPlane(e[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const jF=Gr(),Tye=Oh(),Hu=E(),Tq=E(),Eye=E(),Cye=E(),Mye=E();let FOt=class{constructor(e){this._objects=e}submit(e,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,i,r))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?ROt(e,this._objects.visibleObjects):null}};function kOt(t){const e=Ts().vec3f(R.POSITION);return t.hasNormals&&e.vec2i16(R.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===ps.Default?e.vec2f(R.UV0):t.textureCoordinates===ps.Atlas&&(e.vec2f(R.UV0),e.vec4u16(R.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(R.COLOR,{glNormalized:!0}),e}let UOt=class{constructor(){this.externalColor=Qt(),this.externalColorMixMode=yn.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}};var ou;function zOt(t,e){const i=t.vertex;switch(i.code.add(S`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case ou.None:i.code.add(S`#define vertexDiscardByOpacity(_opacity_) {}`);break;case ou.Opaque:i.code.add(S`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case ou.Transparent:i.code.add(S`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case ou.COUNT:break;default:e.vertexDiscardMode}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(ou||(ou={}));var _g;function cti(t){return t&&dT(t)?_g.Mars:t&&pT(t)?_g.Moon:_g.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(_g||(_g={}));var Ad;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(Ad||(Ad={}));let di=class extends jl{constructor(){super(...arguments),this.output=G.Color,this.textureCoordinateType=ps.None,this.componentData=gg.Uniform,this.cullFace=Nr.Back,this.vertexDiscardMode=ou.None,this.doubleSidedMode=xs.WindingOrder,this.alphaDiscardMode=Cr.Opaque,this.integratedMeshMode=Ad.None,this.transparencyPassType=nt.NONE,this.ellipsoidMode=_g.Earth,this.pbrMode=xt.Disabled,this.normalType=Ki.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.hasNormalTextureTransform=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};h([B({count:G.COUNT})],di.prototype,"output",void 0),h([B({count:ps.COUNT})],di.prototype,"textureCoordinateType",void 0),h([B({count:gg.COUNT})],di.prototype,"componentData",void 0),h([B({count:Nr.COUNT})],di.prototype,"cullFace",void 0),h([B({count:ou.COUNT})],di.prototype,"vertexDiscardMode",void 0),h([B({count:xs.COUNT})],di.prototype,"doubleSidedMode",void 0),h([B({count:Cr.COUNT})],di.prototype,"alphaDiscardMode",void 0),h([B({count:Ad.COUNT})],di.prototype,"integratedMeshMode",void 0),h([B({count:nt.COUNT})],di.prototype,"transparencyPassType",void 0),h([B({count:_g.COUNT})],di.prototype,"ellipsoidMode",void 0),h([B({count:xt.COUNT})],di.prototype,"pbrMode",void 0),h([B({count:Ki.COUNT})],di.prototype,"normalType",void 0),h([B()],di.prototype,"spherical",void 0),h([B()],di.prototype,"doublePrecisionRequiresObfuscation",void 0),h([B()],di.prototype,"hasVertexColors",void 0),h([B()],di.prototype,"hasNormals",void 0),h([B()],di.prototype,"hasSlicePlane",void 0),h([B()],di.prototype,"hasColorTexture",void 0),h([B()],di.prototype,"receiveAmbientOcclusion",void 0),h([B()],di.prototype,"receiveShadows",void 0),h([B()],di.prototype,"blendingEnabled",void 0),h([B()],di.prototype,"hasScreenSpaceReflections",void 0),h([B()],di.prototype,"hasPolygonOffset",void 0),h([B()],di.prototype,"hasMetallicRoughnessTexture",void 0),h([B()],di.prototype,"hasEmissionTexture",void 0),h([B()],di.prototype,"hasOcclusionTexture",void 0),h([B()],di.prototype,"hasNormalTexture",void 0),h([B()],di.prototype,"hasOccludees",void 0),h([B()],di.prototype,"multipassEnabled",void 0),h([B()],di.prototype,"cullAboveGround",void 0),h([B()],di.prototype,"hasNormalTextureTransform",void 0),h([B()],di.prototype,"hasCloudsReflections",void 0),h([B()],di.prototype,"snowCover",void 0),h([B()],di.prototype,"objectAndLayerIdColor",void 0),h([B({constValue:!1})],di.prototype,"occlusionPass",void 0),h([B({constValue:Hi.Draw})],di.prototype,"pbrTextureBindType",void 0),h([B({constValue:!0})],di.prototype,"hasSliceHighlight",void 0),h([B({constValue:!1})],di.prototype,"hasSliceInVertexProgram",void 0),h([B({constValue:!1})],di.prototype,"useCustomDTRExponentForWater",void 0),h([B({constValue:!1})],di.prototype,"hasVertexTangents",void 0),h([B({constValue:!0})],di.prototype,"supportsTextureAtlas",void 0),h([B({constValue:!1})],di.prototype,"highStepCount",void 0),h([B({constValue:!1})],di.prototype,"instancedDoublePrecision",void 0),h([B({constValue:!1})],di.prototype,"hasModelTransformation",void 0),h([B({constValue:!0})],di.prototype,"useFillLights",void 0),h([B({constValue:!1})],di.prototype,"objectAndLayerIdColorInstanced",void 0);function VOt(t,e){t.include(DT,e),t.fragment.include(Ore);const i=t.fragment;i.uniforms.add(new Wz("baseColor",r=>r.baseColor)),i.uniforms.add(new RRe("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?i.code.add(S`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(S`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(S`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Aye(t,e){const i=t.fragment;switch(e.doubleSidedMode){case xs.None:i.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case xs.View:t.include(QC,e),i.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case xs.WindingOrder:i.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case xs.COUNT:}switch(e.normalType){case Ki.Attribute:case Ki.Compressed:t.include(ZG,e),i.code.add(S`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Ki.ScreenDerivative:t.include(QC,e),i.code.add(S`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Ki.Ground:e.spherical?(t.include(QC,e),i.code.add(S`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(S`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),i.code.add(S`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case Ki.COUNT:}}function BOt(t,e){const i=t.fragment;if(e.hasColorTexture&&(e.output===G.Color||e.alphaDiscardMode!==Cr.Opaque)){t.include(die,e);const r=e.textureCoordinateType===ps.Atlas;i.uniforms.add(new dg("baseColorTexture",s=>s.texture)),r?(t.include(hie),i.code.add(S`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):i.code.add(S`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else i.code.add(S`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function WNe(t){const e=new Vi;e.include(QC,t),e.include(ZG,t),e.include(DT,t),e.include(lf,t),e.include(ZA,t),e.include(rdt,t),e.include(Cdt,t),e.include(dut,t),e.include(BOt,t),e.include(zOt,t);const{vertex:i,fragment:r}=e;t.pbrMode!==xt.Normal&&t.pbrMode!==xt.Schematic||(e.include(fie,t),t.hasNormalTexture&&e.include(LRe,t));const s=t.output===G.Shadow||t.output===G.ShadowHighlight||t.output===G.ShadowExcludeHighlight;s&&t.componentData===gg.Varying?i.code.add(S`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(S`#define discardShadows(castShadows) {}`);const n=t.integratedMeshMode===Ad.ColorOverlay||t.integratedMeshMode===Ad.ColorOverlayWithWater,o=n&&t.output===G.Color&&t.pbrMode===xt.WaterOnIntegratedMesh;n&&(e.include(rT,t),e.include(Qft,t),t.spherical?i.code.add(S`
      const float invEllipsoidRadius = ${S.float(1/(t.ellipsoidMode===_g.Earth?ir.radius:t.ellipsoidMode===_g.Mars?gf.radius:x0.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(S`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),i.code.add(S`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===G.ObjectAndLayerIdColor?S`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${S.float(Xo)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===G.ObjectAndLayerIdColor?S`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?S`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:S`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?S`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===G.Color&&(r.include(sie),e.include(Vg,t),e.include(VOt,t),e.include(Aye,t),e.include(rT,t),t.transparencyPassType===nt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),t.receiveShadows?(e.include(IL,t),r.code.add(S`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(S`float evaluateShadow() { return 0.0; }`),n&&r.uniforms.add(new mt("ovColorTex",(l,c)=>j$e(l,c))),r.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?S`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?S`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===xt.Normal||t.pbrMode===xt.Schematic?(Lg(r),r.code.add(S`
        ${t.pbrMode===xt.Normal?S`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?r.code.add(S`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(S`vec3 shadingNormal = normalVertex;`),r.code.add(S`${t.spherical?S`vec3 normalGround = normalize(positionWorld());`:S`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(S`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();
        ${t.snowCover?S`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                ssao = mix(ssao, 0.5 * ssao, snow);
                shadingNormal = mix(shadingNormal, surfaceNormal, snow);`:""}

        ${n?S` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?r.code.add(S`float shadow = evaluateShadow();`):t.spherical?(tP(r),r.code.add(S`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(S`float shadow = 0.0;`),o&&r.uniforms.add(new mt("ovNormalTex",(l,c)=>{var u;return(u=c.overlay)==null?void 0:u.getTexture(Yr.WaterNormal)})),t.snowCover&&r.code.add(S`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),r.code.add(S`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?S` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?S`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(S`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===nt.ColorAlpha?S`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `));const a=t.output===G.Depth;return(a||s||t.output===G.ViewshedShadow)&&(a||e.include(JG,t),r.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${a?"":S`outputDepth(linearDepth);`}
      }
    `)),t.output===G.Normal&&(e.include(Aye,t),r.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${t.normalType===Ki.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===G.ObjectAndLayerIdColor&&e.fragment.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?S`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===G.Highlight&&(e.include(gb),r.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?S`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}const GOt=Object.freeze(Object.defineProperty({__proto__:null,build:WNe},Symbol.toStringTag,{value:"Module"}));let YNe=class ZNe extends Wi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Ge.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Yi(e.rctx,ZNe.shader.get().build(this.configuration),XNe)}_setPipelineState(e){const i=this.configuration,r=i.integratedMeshMode!==Ad.None,s=e===nt.NONE,n=e===nt.FrontFace;return Gt({blending:i.output===G.Color&&i.blendingEnabled?s?gu:Z0(e):null,culling:yG(i.cullFace),depthTest:{func:yb(e)},depthWrite:s||n?Tu:null,drawBuffers:i.output===G.Depth?{buffers:[ao.NONE]}:X0(e),colorWrite:Kt,stencilWrite:r||i.hasOccludees?Mg:null,stencilTest:r?Sdt(Tc.IntegratedMeshMaskExcluded):i.hasOccludees?_b:null,polygonOffset:s||n?i.hasPolygonOffset?{factor:2,units:2}:null:jG})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};YNe.shader=new Bi(GOt,()=>fe(()=>Promise.resolve().then(()=>OUt),void 0));const XNe=new Map([[R.POSITION,0],[R.NORMAL,1],[R.NORMALCOMPRESSED,1],[R.COLOR,2],[R.UV0,3],[R.UVREGION,4],[R.COMPONENTINDEX,5]]);let jOt=class extends $r{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},Qse=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function Rs(t={}){return(e,i)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,i,{get(){return this[r]},set(n){const o=this[r];if(o==null)this[r]=n;else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(e,i,{get(){return this[r]},set(s){this[r]!==s&&(t.dispose&&this[r]&&this[r].dispose(),this[r]=s,this._setDirty())}})}}function Pye(){return(t,e)=>{const i=t._parameterCount??0;t._parameterCount=i+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(i),Object.defineProperty(t,e,{get(){return this[i]},set(r){this[i]!==r&&(this[i]=r,this._setDirty())}})}}let JNe=class{constructor(e){this._low=E(),this._high=E(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){ce(this._low,ce(Oye,e));const i=Ai(Oye,e,this._low);ce(this._high,i)}get(e){return me(e,this._low,this._high)}getLowScaled(e){return oe(e,this._low,1)}};const Oye=nu();let xo=class extends jOt{constructor(e,i){super(),this.toMapSpace=i,this.baseColor=Wt(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Ol(XG),this.emissiveFactor=$e(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new lk,this.componentParameters=new vI,this.textureAlphaCutoff=Gz,this.alphaDiscardMode=Cr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=_g.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new di;const r=new JNe(e.position),s=DSe(e.rotationScale);aL(s,s),xT(s,s),this.transformNormalGlobalFromModel=s,this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=ti(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,i,r,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.hasNormals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,n.hasEmissionTexture=this.emissionTexture!=null,n.hasOcclusionTexture=this.occlusionTexture!=null,n.hasNormalTexture=this.normalTexture!=null,n.transparencyPassType=i.identifier===$l.Material&&r.transparencyPassType!=null?r.transparencyPassType:nt.NONE,n.multipassEnabled=i.identifier===$l.Material&&r.multipassEnabled,n.cullAboveGround=i.identifier===$l.Material&&r.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?xs.View:xs.None,n.hasColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();if(n.blendingEnabled=o===El.Transparent||o===El.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?WOt(r)?qOt(r)?Ad.ColorOverlayWithWater:Ad.ColorOverlay:Ad.NoOverlay:Ad.None,n.hasPolygonOffset=this.polygonOffsetEnabled,n.pbrMode=n.integratedMeshMode===Ad.ColorOverlayWithWater?xt.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?s.needsNormals&&this.isIntegratedMesh?xt.Disabled:xt.Schematic:xt.Normal:xt.Disabled,n.normalType=s.needsNormals?n.hasNormals?Ki.Compressed:Ki.ScreenDerivative:Ki.Ground,n.hasSlicePlane=r.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,i.identifier===$l.ShadowMap)n.output=G.Shadow,n.vertexDiscardMode=ou.None;else if(i.identifier===$l.ViewshedShadowMap)n.output=G.ViewshedShadow,n.vertexDiscardMode=ou.None;else if(i.identifier===$l.Highlight)n.output=G.Highlight,n.vertexDiscardMode=ou.None;else{switch(o===El.OpaqueAndTransparent?n.vertexDiscardMode=i.transparent?ou.Opaque:ou.Transparent:n.vertexDiscardMode=ou.None,n.output=i.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,i.output){case G.Color:n.receiveAmbientOcclusion=r.ssao!=null,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.hasScreenSpaceReflections=r.ssr.lastFrameColor!=null,n.hasCloudsReflections=r.cloudsFade.data!=null;break;case G.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(r)}return this._technique=e.releaseAndAcquire(YNe,n,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,i,r){if(this.objectOpacity===0)return;const s=r.renderable.geometry,n=r.components,o=r.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case El.Opaque:e.materialOpaque.submitDraw(this,s,a,o);break;case El.Transparent:e.materialTransparent.submitDraw(this,s,a,o);break;case El.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,s,a,o),e.materialTransparent.submitDraw(this,s,a,o);break;case El.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,s,a,o),HOt(i)&&e.highlightIntegratedMesh.submitDraw(this,s,a,o)}const u=this.componentParameters.castShadows!==lo.None;u&&e.shadowMap.submitDraw(this,s,a,o),l!=null&&(e.highlight.submitDraw(this,s,l,o),u&&e.highlightShadowMap.submitDraw(this,s,l,o)),i.viewshedEnabled&&e.viewshedShadowMap.submitDraw(this,s,a,o),u&&c!=null&&e.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?El.IntegratedMesh:this.objectOpacity<1?El.Transparent:this.componentParameters.opaqueOverride===lo.All?El.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Cr.Blend||this.alphaDiscardMode===Cr.MaskBlend?El.Transparent:this.componentParameters.transparent===lo.None?El.Opaque:this.componentParameters.transparent===lo.All?El.Transparent:El.OpaqueAndTransparent}};var El,lo;h([Rs({vectorOps:iTe})],xo.prototype,"baseColor",void 0),h([Rs()],xo.prototype,"usePBR",void 0),h([Rs()],xo.prototype,"hasParametersFromSource",void 0),h([Rs({vectorOps:Xoe})],xo.prototype,"mrrFactors",void 0),h([Rs({vectorOps:Xoe})],xo.prototype,"emissiveFactor",void 0),h([Rs({dispose:!0})],xo.prototype,"baseColorTexture",void 0),h([Rs({dispose:!0})],xo.prototype,"metallicRoughnessTexture",void 0),h([Rs({dispose:!0})],xo.prototype,"emissionTexture",void 0),h([Rs({dispose:!0})],xo.prototype,"occlusionTexture",void 0),h([Rs({dispose:!0})],xo.prototype,"normalTexture",void 0),h([Rs()],xo.prototype,"objectOpacity",void 0),h([Pye()],xo.prototype,"commonMaterialParameters",void 0),h([Pye()],xo.prototype,"componentParameters",void 0),h([Rs()],xo.prototype,"textureAlphaCutoff",void 0),h([Rs()],xo.prototype,"alphaDiscardMode",void 0),h([Rs()],xo.prototype,"isIntegratedMesh",void 0),h([Rs()],xo.prototype,"polygonOffsetEnabled",void 0),h([Rs()],xo.prototype,"ellipsoidMode",void 0),h([Rs()],xo.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(El||(El={}));let lk=class extends Qse{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Nr.Back,this.hasSlicePlane=!0}};h([Rs()],lk.prototype,"doubleSided",void 0),h([Rs()],lk.prototype,"cullFace",void 0),h([Rs()],lk.prototype,"hasSlicePlane",void 0);let vI=class extends Qse{constructor(){super(...arguments),this.externalColor=Wt(1,1,1,1),this.externalColorMixMode=yn.Multiply,this.castShadows=lo.All}get transparent(){return this.externalColor[3]<1?lo.All:lo.None}get opaqueOverride(){return this.externalColorMixMode===yn.Replace&&this.externalColor[3]===1?lo.All:lo.None}get visible(){return this.externalColor[3]>0?lo.All:lo.None}get type(){return gg.Uniform}};h([Rs({vectorOps:iTe})],vI.prototype,"externalColor",void 0),h([Rs()],vI.prototype,"externalColorMixMode",void 0),h([Rs()],vI.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(lo||(lo={}));let r$=class extends Qse{constructor(){super(...arguments),this.texture=null,this.transparent=lo.None,this.opaqueOverride=lo.None,this.castShadows=lo.None}get type(){return gg.Varying}};function HOt(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(Yr.Highlight))!=null}function qOt(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(Yr.WaterNormal))!=null}function WOt(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(Yr.ColorNoRasterImage))!=null}h([Rs()],r$.prototype,"texture",void 0),h([Rs()],r$.prototype,"transparent",void 0),h([Rs()],r$.prototype,"opaqueOverride",void 0),h([Rs()],r$.prototype,"castShadows",void 0);const QNe=Ts().vec3f(R.POSITION).u16(R.COMPONENTINDEX).freeze(),YOt=Ts().vec2u8(R.SIDENESS).freeze(),_ti=Au(YOt),PJ=Ts().vec3f(R.POSITION0).vec3f(R.POSITION1).vec2i16(R.NORMALCOMPRESSED).u16(R.COMPONENTINDEX).u8(R.VARIANTOFFSET,{glNormalized:!0}).u8(R.VARIANTSTROKE).u8(R.VARIANTEXTENSION,{glNormalized:!0}).freeze(),OJ=Ts().vec3f(R.POSITION0).vec3f(R.POSITION1).vec2i16(R.NORMALCOMPRESSED).vec2i16(R.NORMAL2COMPRESSED).u16(R.COMPONENTINDEX).u8(R.VARIANTOFFSET,{glNormalized:!0}).u8(R.VARIANTSTROKE).u8(R.VARIANTEXTENSION,{glNormalized:!0}).freeze(),vti=new Map([[R.POSITION0,0],[R.POSITION1,1],[R.COMPONENTINDEX,2],[R.VARIANTOFFSET,3],[R.VARIANTSTROKE,4],[R.VARIANTEXTENSION,5],[R.NORMALCOMPRESSED,6],[R.NORMAL2COMPRESSED,7],[R.SIDENESS,8]]);function Rye(t,e,i){const r=e/3,s=new Uint32Array(i+1),n=new Uint32Array(i+1),o=(b,w)=>{b<w?s[b+1]++:n[w+1]++};for(let b=0;b<r;b++){const w=t[3*b],x=t[3*b+1],T=t[3*b+2];o(w,x),o(x,T),o(T,w)}let a=0,l=0;for(let b=0;b<i;b++){const w=s[b+1],x=n[b+1];s[b+1]=a,n[b+1]=l,a+=w,l+=x}const c=new Uint32Array(6*r),u=s[i],d=(b,w,x)=>{if(b<w){const T=s[b+1]++;c[2*T]=w,c[2*T+1]=x}else{const T=n[w+1]++;c[2*u+2*T]=b,c[2*u+2*T+1]=x}};for(let b=0;b<r;b++){const w=t[3*b],x=t[3*b+1],T=t[3*b+2];d(w,x,b),d(x,T,b),d(T,w,b)}const p=(b,w)=>{const x=2*b,T=w-b;for(let C=1;C<T;C++){const M=c[x+2*C],O=c[x+2*C+1];let D=C-1;for(;D>=0&&c[x+2*D]>M;D--)c[x+2*D+2]=c[x+2*D],c[x+2*D+3]=c[x+2*D+1];c[x+2*D+2]=M,c[x+2*D+3]=O}};for(let b=0;b<i;b++)p(s[b],s[b+1]),p(u+n[b],u+n[b+1]);const m=new Int32Array(3*r),g=(b,w)=>b===t[3*w]?0:b===t[3*w+1]?1:b===t[3*w+2]?2:-1,y=(b,w)=>{const x=g(b,w);m[3*w+x]=-1},v=(b,w,x,T)=>{const C=g(b,w);m[3*w+C]=T;const M=g(x,T);m[3*T+M]=w};for(let b=0;b<i;b++){let w=s[b];const x=s[b+1];let T=n[b];const C=n[b+1];for(;w<x&&T<C;){const M=c[2*w],O=c[2*u+2*T];M===O?(v(b,c[2*w+1],O,c[2*u+2*T+1]),w++,T++):M<O?(y(b,c[2*w+1]),w++):(y(O,c[2*u+2*T+1]),T++)}for(;w<x;)y(b,c[2*w+1]),w++;for(;T<C;)y(c[2*u+2*T],c[2*u+2*T+1]),T++}return m}const Eq=.7;let KNe=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?XOt:ZOt}write(e,i,r){HF.seed=this._edgeHashFunction(r);const s=HF.getIntRange(0,255),n=HF.getIntRange(0,this.settings.variants-1),o=HF.getFloat(),a=255*(.5*JOt(-(1-Math.min(o/Eq,1))+Math.max(0,o-Eq)/(1-Eq),1.2)+.5);e.position0.setVec(i,r.position0),e.position1.setVec(i,r.position1),e.componentIndex.set(i,r.componentIndex),e.variantOffset.set(i,s),e.variantStroke.set(i,n),e.variantExtension.set(i,a)}};const Ov=new Float32Array(6),Rv=new Uint32Array(Ov.buffer),CC=new Uint32Array(1);function ZOt(t){return Ov[0]=t.position0[0],Ov[1]=t.position0[1],Ov[2]=t.position0[2],Ov[3]=t.position1[0],Ov[4]=t.position1[1],Ov[5]=t.position1[2],CC[0]=31*(31*(31*(31*(31*(166811+Rv[0])+Rv[1])+Rv[2])+Rv[3])+Rv[4])+Rv[5],CC[0]}function XOt(t){const e=Ov;e[0]=z2(t.position0[0]),e[1]=z2(t.position0[1]),e[2]=z2(t.position0[2]),e[3]=z2(t.position1[0]),e[4]=z2(t.position1[1]),e[5]=z2(t.position1[2]),CC[0]=5381;for(let i=0;i<Rv.length;i++)CC[0]=31*CC[0]+Rv[i];return CC[0]}const $ye=1e4;function z2(t){return Math.round(t*$ye)/$ye}function JOt(t,e){return Math.abs(t)**e*Math.sign(t)}let RJ=class{constructor(){this._commonWriter=new KNe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return PJ.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),me(V2,r.faceNormal0,r.faceNormal1),ge(V2,V2);const{typedBuffer:s,typedBufferStride:n}=e.normalCompressed;Wd(s,i,V2[0],V2[1],V2[2],n)}};RJ.Layout=PJ,RJ.glLayout=Au(PJ,1);let $J=class{constructor(){this._commonWriter=new KNe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return OJ.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r);{const{typedBuffer:s,typedBufferStride:n}=e.normalCompressed;Wd(s,i,r.faceNormal0[0],r.faceNormal0[1],r.faceNormal0[2],n)}{const{typedBuffer:s,typedBufferStride:n}=e.normal2Compressed;Wd(s,i,r.faceNormal1[0],r.faceNormal1[1],r.faceNormal1[2],n)}}};$J.Layout=OJ,$J.glLayout=Au(OJ,1);const V2=E(),HF=new nS;let QOt=class{constructor(){this.position0=E(),this.position1=E(),this.faceNormal0=E(),this.faceNormal1=E(),this.componentIndex=0,this.cosAngle=0}};const ck=-1;function KOt(t,e,i){const r=t.vertices.position,s=t.vertices.componentIndex,n=Fc.position0,o=Fc.position1,a=Fc.faceNormal0,l=Fc.faceNormal1,{edges:c,normals:u}=rRt(t),d=c.length/4,p=e.allocate(d);let m=0;const g=d,y=i==null?void 0:i.allocate(g);let v=0,b=0,w=0;qF.length=0;for(let D=0;D<d;++D){const k=4*D;r.getVec(c.data[k],n),r.getVec(c.data[k+1],o);const U=qF.pushNew();U.index=4*D,U.length=wr(n,o)}qF.sort((D,k)=>k.length-D.length);const x=new Array,T=new Array;qF.forAll(({length:D,index:k})=>{const U=c.data[k],H=c.data[k+1],z=c.data[k+2],Z=c.data[k+3],q=Z===ck;if(r.getVec(U,n),r.getVec(H,o),q){const Y=3*z;ne(a,u.data[Y],u.data[Y+1],u.data[Y+2]),ce(l,a),Fc.componentIndex=s.get(U),Fc.cosAngle=pe(a,l)}else{let Y=3*z;if(ne(a,u.data[Y],u.data[Y+1],u.data[Y+2]),Y=3*Z,ne(l,u.data[Y],u.data[Y+1],u.data[Y+2]),Fc.componentIndex=s.get(U),Fc.cosAngle=pe(a,l),tRt(Fc,oRt))return;Fc.cosAngle<-.9999&&ce(l,a)}b+=D,w++,q||eRt(Fc,lRt)?(e.write(p,m++,Fc),x.push(D)):iRt(Fc,eFe)&&(y&&i&&i.write(y,v++,Fc),T.push(D))});const C=new Float32Array(x.reverse()),M=new Float32Array(T.reverse()),O=y&&i?{instancesData:y.slice(0,v),lodInfo:{lengths:M}}:void 0;return{regular:{instancesData:p.slice(0,m),lodInfo:{lengths:C}},silhouette:O,averageEdgeLength:b/w}}function eRt(t,e){return t.cosAngle<e}function tRt(t,e){return t.cosAngle>e}function iRt(t,e){const i=fo(t.cosAngle);return k0(Iye,t.position1,t.position0),i*(pe(ot(nRt,t.faceNormal0,t.faceNormal1),Iye)>0?-1:1)>e}function rRt(t){const e=t.faces.length/3,i=t.faces,r=t.neighbors,s=t.vertices.position;Nc.length=Cq.length=0;for(let n=0;n<e;n++){const o=3*n,a=r[o],l=r[o+1],c=r[o+2],u=i[o],d=i[o+1],p=i[o+2];s.getVec(u,pw),s.getVec(d,WF),s.getVec(p,YF),ve(WF,WF,pw),ve(YF,YF,pw),ot(pw,WF,YF),ge(pw,pw),Cq.pushArray(pw),(a===ck||u<d)&&(Nc.push(u),Nc.push(d),Nc.push(n),Nc.push(a)),(l===ck||d<p)&&(Nc.push(d),Nc.push(p),Nc.push(n),Nc.push(l)),(c===ck||p<u)&&(Nc.push(p),Nc.push(u),Nc.push(n),Nc.push(c))}return{edges:Nc,normals:Cq}}let sRt=class{constructor(){this.index=0,this.length=0}};const qF=new Zt({allocator:t=>t||new sRt,deallocator:null}),Nc=new Zt({deallocator:null}),Cq=new Zt({deallocator:null}),Fc=new QOt,nRt=E(),Iye=E(),pw=E(),WF=E(),YF=E(),eFe=Rt(4),oRt=Math.cos(eFe),aRt=Rt(35),lRt=Math.cos(aRt);function Eti(t){const e=cRt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return Lye.updateSettings(t.writerSettings),Dye.updateSettings(t.writerSettings),KOt(e,Lye,Dye)}function cRt(t,e,i,r){if(e){const o=Rye(i,r,t.count);return new uRt(i,r,o,t)}const s=TX(t.buffer,t.stride/4,{originalIndices:i,originalIndicesLength:r}),n=Rye(s.indices,r,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:QNe.createView(s.buffer)}}let uRt=class{constructor(e,i,r,s){this.faces=e,this.facesLength=i,this.neighbors=r,this.vertices=s}};const Lye=new RJ,Dye=new $J,Mti=Ts().vec3f(R.POSITION0).vec3f(R.POSITION1),hRt=Ts().vec3f(R.POSITION0).vec3f(R.POSITION1).u16(R.COMPONENTINDEX);let dRt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},pRt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this.textureWidth=4096,this._dirty=!0;const r=new jr(this.textureWidth,1);r.samplingMode=ii.NEAREST,r.wrapMode=bi.CLAMP_TO_EDGE,this._texture=new br(this._rctx,r),this._data=new nl(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,i,r,s,n,o){const a=e*this._fieldCount+i;this._dirty=!0,this._data.set(a,0,r),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(e,i,r,s){const n=e*this._fieldCount+i;this._dirty=!0,this._data.set(n,r,s)}getDataElement(e,i,r){const s=e*this._fieldCount+i;return this._dirty=!0,this._data.get(s,r)}resizeToFit(e){const i=(e+1)*this._fieldCount;if(i>this._data.count){const r=Math.ceil(i/this.textureWidth)*this.textureWidth,s=new nl(new ArrayBuffer(4*r));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,i=this._texture.descriptor.height;this._data.count>e*i&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const tFe=65536;let fRt=class{constructor(e,i=1){this.textureBuffer=new pRt(e,i),this._indexManager=new dRt(tFe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},mRt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>tFe)return null;const i=new fRt(this._rctx,this._fieldCount);return this._buffers.push(i),i}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const Nye=()=>ie.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let gRt=class{constructor(e,i){this._renderManager=e,this._viewingMode=i,this._elevationRangeCacheVerticalOffset=NaN,this._elevationRangeCacheMin=NaN,this._elevationRangeCacheMax=NaN,this._visible=new Zt,this._hidden=new Zt,this._renderSubmit=new FOt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=re("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new mRt(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){ft(this._hidden.length===0&&this._visible.length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy(),this._visible.forAll(e=>e.destroy()),this._hidden.forAll(e=>e.destroy()),this._visible.clear(),this._hidden.clear()}createObject(e){const i=e.geometry,r=new XPt(this._componentBufferManager,fg(i.componentOffsets)),s=this._createRenderable(e,r),n=new xOt(this._viewingMode,i.positionData,r),o=new QPt(e.transform,e.toMapSpace,e.obb.clone(),r,s,n);return(o.visible?this._visible:this._hidden).push(o),o}destroyObject(e){const i=e;(i.visible?this._visible:this._hidden).removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(e,i){const r=e;i!==r.visible&&(i?(this._hidden.removeUnordered(r),this._visible.push(r)):(this._visible.removeUnordered(r),this._hidden.push(r)),r.visible=i,this._notifyDirty())}preSubmit(e){const i=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=Ko(i,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,i){const r=e.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,i){const r=e;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,i){return e.components.visibility.forEachComponent(i)}getComponentCount(e){const i=e,r=i.components.visibility.componentCount;return{visible:r,invisible:i.components.count-r}}setComponentData(e,i){const r=e,s=r.renderable.material,n=r.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new UOt,c=o.textureBuffer,u=new Uint8Array(4),d=new Uint32Array(u.buffer);let p=0,m=0,g=0,y=n.verticalOffsets,v=1/0,b=-1/0,w=!1,x=!1,T=0;for(let C=0;C<n.count;C++){i(C,l),p+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===yn.Replace&&l.externalColor[3]===1),g+=+l.castShadows,hRe(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,c.setData(a[C],0,u[0],u[1],u[2],u[3]),w||(w=C>0&&T!==d[0]),T=d[0],x||(x=l.elevationOffset!==0),x&&y==null&&(y=new Array(C).fill(0)),y!=null&&(y[C]=l.elevationOffset),v=Math.min(v,l.elevationOffset),b=Math.max(b,l.elevationOffset),idt(l.elevationOffset,u),c.setData(a[C],1,u[0],u[1],u[2],u[3]);const M=l.objectAndLayerIdColor;M!=null&&c.setData(a[C],2,M[0],M[1],M[2],M[3]),l.pickable!==MJ(n.pickability,C)&&(n.pickability=cOt(n.pickability,n.count,C,l.pickable))}n.verticalOffsets=x?y:null,r.offsetObb=x?f2e(r.obb,v,b,this._viewingMode,r.offsetObb??r.obb.clone()):null,w||x||this._hasObjectAndLayerId?(s.componentParameters=new r$,s.componentParameters.castShadows=Mq(g,n.count),s.componentParameters.transparent=Mq(p,n.count),s.componentParameters.opaqueOverride=Mq(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new vI,s.componentParameters.castShadows=l.castShadows?lo.All:lo.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._elevationRangeCacheVerticalOffset=NaN,this._notifyDirty()}getComponentAabb(e,i,r,s=!1){e.intersectionGeometry.getComponentAabb(i,r);const n=e,o=n.components.verticalOffsets;if(s||o==null)return r;const a=o[i];if(this._viewingMode===Ge.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=nce(a);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,i,r){return e.intersectionGeometry.getComponentPositions(i,r)}expandRangeWithComponentObjectElevationRange(e,i,r,s){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==i||s.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);const n=e,o=n.components,a=o.count,l=o.verticalOffsets,c=n.intersectionGeometry,u=this._viewingMode===Ge.Local,d=c.getComponentAabbs(),p=_Rt;let m=1/0,g=-1/0;for(let y=0;y<a;y++){const v=6*y,b=(l==null?void 0:l[y])??0;let w=1/0,x=-1/0;if(u)w=d[v+2]+b+i,x=d[v+5]+b+i;else{if(p[0]=d[v],p[1]=d[v+1],p[2]=d[v+2],p[3]=d[v+3],p[4]=d[v+4],p[5]=d[v+5],b!==0){const O=nce(b);O.localOrigin=n.transform.position,O.applyToAabb(p)}const T=Math.max(Math.abs(p[3]),Math.abs(p[0])),C=Math.max(Math.abs(p[4]),Math.abs(p[1])),M=i+p[5]+r;s.expandElevationRangeValues(i+p[2],Math.sqrt(T*T+C*C+M*M)-r)}s.expandElevationRangeValues(w,x),m=Math.min(m,w),g=Math.max(g,x)}this._elevationRangeCacheVerticalOffset=i,this._elevationRangeCacheMin=m,this._elevationRangeCacheMax=g}intersect(e,i,r,s,n,o,a){const l=e,{transform:c}=l,{position:u}=c;return n!=null&&(n.localOrigin=u),l.intersectionGeometry.intersect(i,r,s,n,l.components.verticalOffsets,c,o,a)}addEdges(e,i,r,s,n){const o=e,{indices:a,positions:l}=o.intersectionGeometry,c=o.components.offsets;return i.addComponentObject(o,l,a,c,r,s,n)}async extractEdgeInformation(e,i,r){const s=e,n=s.components.visibility;if(n.allInvisible())return{buffer:hRt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=QNe.createBuffer(a.length/3);_j(c.position.typedBuffer,a,c.position.typedBufferStride,3),$$e(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const u=c.count,d=this._computeVisibilityIndices(o,n,l,u);return{origin:Xs(s.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:d,indicesLength:d.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,i,r){let s=0;for(let n=0;n<r.length-1;n++){const o=r[n],a=r[n+1];for(let l=o;l<a;l++){const c=i?i[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,i,r,s){if(e&&i.allVisible())return e;let n=0;i.forEachComponentRange((l,c)=>(n+=r[c]-r[l],!0));const o=wg(e)?new Array(n):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return i.forEachComponentRange((l,c)=>{const u=r[l],d=r[c];for(let p=u;p<d;p++)o[a++]=e?e[p]:p;return!0}),o}addComponentHighlight(e,i){const r=e.components;r.highlightCounts==null&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(e,i){const r=e.components;if(r.highlightCounts==null)return void Nye().warn("Removing non-existing highlight.");const s=r.highlightCounts[i],n=r.highlightCounts[r.count];if(s!==0){if(s>1)return r.highlightCounts[i]=s-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),n===1?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else Nye().warn("Removing non-existing highlight.")}clearHighlights(e){const i=e.components;i.highlightCounts!=null&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(e,i){const r=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,o=vr.createVertex(r,rr.STATIC_DRAW,s.vertices.data),a=s.indices?vr.createIndex(r,rr.STATIC_DRAW,s.indices):null,l=Au(kOt(n)),c=new Uint16Array(s.vertices.count);for(let y=0;y<i.count;y++){const v=i.offsets[y],b=i.offsets[y+1],w=i.materialDataIndices[y];if(s.indices!=null)for(let x=v;x<b;x++)c[s.indices[x]]=w;else for(let x=v;x<b;x++)c[x]=w}const u=vr.createVertex(r,rr.STATIC_DRAW,c.buffer),d=new xo(e.transform,e.toMapSpace),p=new Of(r,XNe,{data:l,componentIndices:yRt},{data:o,componentIndices:u},a),m=new POt(p,vi.TRIANGLES,n,a!=null),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.usedMemory+u.usedMemory+(a!=null?a.usedMemory:0)};return new AOt(d,m,g)}_notifyDirty(){this._renderManager.notifyDirty()}};const yRt=Au(Ts().u16(R.COMPONENTINDEX));function Mq(t,e){return t===e?lo.All:t===0?lo.None:lo.Some}const _Rt=Jn();let Kse=class extends $r{};function iFe(){const t=new Vi,{outputs:e,fragment:i}=t;return t.include(Oa),i.uniforms.add(new dg("textureInput",r=>r.input)),i.constants.add("sampleArea","int",Math.ceil(A3/2)),e.add("fragGrid","vec2"),i.code.add(S`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${S.int(Up)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -sampleArea; x < cellSize + sampleArea; x += 2) {
        for(int y = -sampleArea; y < cellSize + sampleArea; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`),t}const Up=32,A3=9,ene=.4,vRt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Kse,blurSize:ene,build:iFe,gridCellPixelSize:Up,outlineSize:A3},Symbol.toStringTag,{value:"Module"}));function rFe(){const t=new Vi,{vertex:e,fragment:i}=t,r=e.code,s=i.code;return t.attributes.add(R.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(R.UV0,"vec2"),e.uniforms.add(new mt("coverageTex",n=>n.coverageTexture),new Fr("coverageRounding",n=>n.coverageRounding)),r.add(S`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new mt("tex",n=>n.blurTexture),new mt("highlightTexture",n=>n.highlightTexture),new zi("uColor",n=>n.color),new zi("haloColor",n=>n.haloColor),new zi("opacities",n=>ds(bRt,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),i.constants.add("inner","float",1-(A3-ene)/A3),s.add(S`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const bRt=Qt(),wRt=Object.freeze(Object.defineProperty({__proto__:null,build:rFe},Symbol.toStringTag,{value:"Module"}));let sFe=class nFe extends Wi{initializeProgram(e){return new Yi(e.rctx,nFe.shader.get().build(),wi)}initializePipeline(){return Gt({blending:sa(Pe.SRC_ALPHA,Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA,Pe.ONE_MINUS_SRC_ALPHA),colorWrite:Kt})}};sFe.shader=new Bi(wRt,()=>fe(()=>Promise.resolve().then(()=>RUt),void 0));let tne=class extends $r{constructor(){super(...arguments),this.blurSize=lt()}};function oFe(){const t=new Vi,{attributes:e,varyings:i,vertex:r,fragment:s}=t;return e.add(R.POSITION,"vec2"),e.add(R.UV0,"vec2"),i.add("blurCoordinate","vec3"),r.uniforms.add(new mt("coverageTex",n=>n.coverageTexture),new Fr("coverageRounding",n=>n.coverageRounding)),r.code.add(S`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`),s.uniforms.add(new NRe("blurSize",n=>n.blurSize),new dg("tex",n=>n.blurInputTexture)),s.code.add(S`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const xRt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:tne,build:oFe},Symbol.toStringTag,{value:"Module"}));let aFe=class lFe extends Wi{initializeProgram(e){return new Yi(e.rctx,lFe.shader.get().build(),wi)}initializePipeline(){return Gt({colorWrite:Kt})}};aFe.shader=new Bi(xRt,()=>fe(()=>Promise.resolve().then(()=>$Ut),void 0));let cFe=class uFe extends Wi{initializeProgram(e){return new Yi(e.rctx,uFe.shader.get().build(),wi)}initializePipeline(){return Gt({colorWrite:Kt})}};cFe.shader=new Bi(vRt,()=>fe(()=>Promise.resolve().then(()=>IUt),void 0));let SRt=class extends $r{constructor(){super(...arguments),this.color=Wt(1,0,1,1),this.haloColor=Wt(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.coverageRounding=_i(1,1)}},ME=class extends PL{constructor(e){super(e),this.produces="highlight-color",this.consumes={required:["highlight-color","highlights"]},this._passParameters=new SRt,this._downsampleDrawParameters=new Kse,this._blurDrawParameters=new tne,this._blurColorFormat=re("mac")?Xr.RGBA:Xr.RGBA4,this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0},this._blurTechnique=e.techniques.acquire(aFe),this._downsampleTechnique=e.techniques.acquire(cFe),this._applyTechnique=e.techniques.acquire(sFe)}initialize(){this.addHandles([ue(()=>this.view.highlightOptions.color,e=>{this._passParameters.color=i3(e??PDe),this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color),this.requestRender(tr.UPDATE)},sr),ue(()=>this.view.highlightOptions.haloColor,e=>{this._passParameters.haloColor=e!=null?i3(e):this._passParameters.color,this.requestRender(tr.UPDATE)},sr),ue(()=>this.view.highlightOptions.haloOpacity,e=>{this._passParameters.haloOpacity=e??ODe,this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity,this.requestRender(tr.UPDATE)},sr),ue(()=>this.view.highlightOptions.fillOpacity,e=>{this._passParameters.fillOpacity=e??RDe,this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity,this.requestRender(tr.UPDATE)},sr)])}destroy(){this._blurTechnique.release(),this._downsampleTechnique.release(),this._applyTechnique.release(),this._grid.coverage=ti(this._grid.coverage),this._grid.vao=It(this._grid.vao)}render(e){var b,w,x;if(this.bindParameters.decorations===Nl.OFF)return e.find(({name:T})=>T==="highlight-color");if(!(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled))return this.requestRender(tr.UPDATE),e.find(({name:T})=>T==="highlight-color");const i=e.find(({name:T})=>T==="highlights").getTexture(),r=this.bindParameters.camera,s=r.fullWidth,n=r.fullHeight,o=r.pixelRatio,a=Math.ceil(s/o),l=Math.ceil(n/o),c=this.renderingContext;this._gridUpdateResources(i),this._gridComputeCoverage(i,this.bindParameters),this._passParameters.highlightTexture=i,this._passParameters.coverageTexture=(b=this._grid.coverage)==null?void 0:b.getTexture();const{width:u,height:d}=i.descriptor;Pi(this._passParameters.coverageRounding,u/(Math.ceil(u/Up)*Up),d/(Math.ceil(d/Up)*Up));const p=this._grid.vao;c.bindVAO(p);const m=this.fboCache.acquire(a,l,"highlight blur",this._blurColorFormat);c.unbindTexture((w=m.fbo)==null?void 0:w.colorTexture),c.bindFramebuffer(m.fbo),c.setClearColor(0,0,0,0),c.clear(Lr.COLOR_BUFFER_BIT),c.setViewport(0,0,a,l),this._blurDrawParameters.blurInputTexture=i,Pi(this._blurDrawParameters.blurSize,1/a,0);const g=c.bindTechnique(this._blurTechnique,this.bindParameters,this._passParameters,this._blurDrawParameters);c.drawArrays(this._blurTechnique.primitiveType,0,p0(p,"geometry"));const y=this.fboCache.acquire(a,l,"highlight blur",this._blurColorFormat);c.unbindTexture((x=y.fbo)==null?void 0:x.colorTexture),c.bindFramebuffer(y.fbo),c.setClearColor(0,0,0,0),c.clear(Lr.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=m.getTexture(),Pi(this._blurDrawParameters.blurSize,0,1/l),g.bindDraw(this._blurDrawParameters,this.bindParameters,this._passParameters),c.drawArrays(this._blurTechnique.primitiveType,0,p0(p,"geometry"));const v=e.find(({name:T})=>T==="highlight-color");return c.bindFramebuffer(v.fbo),c.setViewport4fv(r.fullViewport),this._passParameters.blurTexture=y.getTexture(),c.bindTechnique(this._applyTechnique,this.bindParameters,this._passParameters),c.drawArrays(this._applyTechnique.primitiveType,0,p0(p,"geometry")),m.release(),y.release(),v}_gridUpdateResources(e){var p;const i=this.renderingContext,r=this._grid,s=Math.ceil(e.descriptor.height/Up),n=Math.ceil(e.descriptor.width/Up);if(r.vao&&r.verticalCellCount===s&&r.horizontalCellCount===n)return;r.verticalCellCount=s,r.horizontalCellCount=n;const o=s+1,a=n+1,l=1/s,c=1/n,u=new Float32Array(6*4*o*a);let d=0;for(let m=0;m<o;m++)for(let g=0;g<a;g++)u[d++]=(g-.5)*c*2-1,u[d++]=(m-.5)*l*2-1,u[d++]=g*c,u[d++]=m*l,u[d++]=(g+.5)*c*2-1,u[d++]=(m-.5)*l*2-1,u[d++]=g*c,u[d++]=m*l,u[d++]=(g-.5)*c*2-1,u[d++]=(m+.5)*l*2-1,u[d++]=g*c,u[d++]=m*l,u[d++]=(g-.5)*c*2-1,u[d++]=(m+.5)*l*2-1,u[d++]=g*c,u[d++]=m*l,u[d++]=(g+.5)*c*2-1,u[d++]=(m-.5)*l*2-1,u[d++]=g*c,u[d++]=m*l,u[d++]=(g+.5)*c*2-1,u[d++]=(m+.5)*l*2-1,u[d++]=g*c,u[d++]=m*l;(p=r.vao)==null||p.dispose(),r.vao=new Fg(i,wi,{geometry:mL},{geometry:vr.createVertex(i,rr.STATIC_DRAW,u)})}_gridComputeCoverage(e,i){var l,c;const r=this.renderingContext,s=this._grid,n=e.descriptor,o=Math.ceil(n.width/Up),a=Math.ceil(n.height/Up);this._downsampleDrawParameters.input=e,(l=s.coverage)==null||l.release(),s.coverage=this.fboCache.acquire(o,a,"highlight coverage",Xr.RG),r.unbindTexture((c=s.coverage.fbo)==null?void 0:c.colorTexture),r.bindFramebuffer(s.coverage.fbo),r.bindTechnique(this._downsampleTechnique,i,this._passParameters,this._downsampleDrawParameters),r.setViewport(0,0,o,a),r.screen.draw()}get test(){}};h([f()],ME.prototype,"produces",void 0),h([f()],ME.prototype,"consumes",void 0),h([f({constructOnly:!0})],ME.prototype,"techniques",void 0),ME=h([I("esri.views.3d.webgl-engine.effects.highlight.Highlight")],ME);let ine=class extends jl{constructor(){super(...arguments),this.receiveShadows=!0}};h([B()],ine.prototype,"receiveShadows",void 0);function hFe(t){const e=t.fragment;t.include(OL),e.include(Ig),e.code.add(S`vec3 normalFromDepth(sampler2D depthMap, vec3 pixelPos, vec2 fragCoord, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
float leftPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(-1, 0), 0).r);
float rightPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(1, 0), 0).r);
float bottomPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, -1), 0).r);
float topPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, 1), 0).r);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`)}const TRt=.99999,ERt=.025;function dFe(t){const e=new Vi;e.include(IL,t),e.include(Oa),e.include(hFe);const i=e.fragment;return i.include(Uf),i.uniforms.add(new mt("defaultDepthTex",(r,s)=>s.shadowMap.getSnapshot(oT.ExcludeHighlight)),new mt("highlightDepthTex",(r,s)=>s.shadowMap.getSnapshot(oT.Highlight)),new mt("depthMap",(r,s)=>{var n;return(n=s.depth)==null?void 0:n.attachment}),new mt("highlightTexture",r=>r.highlight),new zi("uColor",r=>r.shadowColor),new qe("opacity",r=>r.shadowOpacity),new qe("occludedOpacity",r=>r.occludedShadowOpacity),new qe("terminationFactor",r=>r.opacityElevation*r.dayNightTerminator),new Vt("lightingMainDirectionView",(r,s)=>ge(kye,He(kye,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new ss("inverseViewMatrix",(r,s)=>In(Fye,rl(Fye,s.camera.viewMatrix,s.camera.center)))),i.constants.add("unoccludedHighlightFlag","vec4",cre),i.code.add(S`
    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${S.float(TRt)}) {
        discard;
      }

      float depth = depthFromTexture(depthMap, uv);

      // 1.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth >= 1.0 || depth <= 0.0) {
        discard;
      }

      float currentPixelDepth = linearizeDepth(depth);
      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);
      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;
      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(depthMap, currentPixelPos.xyz, gl_FragCoord.xy, uv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${S.float(ERt)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `),e}const Fye=Ee(),kye=E(),CRt=Object.freeze(Object.defineProperty({__proto__:null,build:dFe},Symbol.toStringTag,{value:"Module"}));let MRt=class extends Pre{constructor(){super(...arguments),this.shadowColor=Wt(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},pFe=class fFe extends Wi{constructor(e){super(e,new ine,()=>this.destroy())}initializeProgram(e){return new Yi(e.rctx,fFe.shader.get().build(this.configuration),wi)}initializePipeline(){return Gt({blending:sa(Pe.SRC_ALPHA,Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA,Pe.ONE_MINUS_SRC_ALPHA),colorWrite:Kt,depthTest:null,depthWrite:null})}get primitiveType(){return vi.TRIANGLE_STRIP}};pFe.shader=new Bi(CRt,()=>fe(()=>Promise.resolve().then(()=>LUt),void 0));const ARt=.001953125,PRt=4e4,ORt=5e4;let nx=class extends PL{constructor(e){super(e),this.produces="composite-color",this.consumes={required:["composite-color","highlights"]},this._passParameters=new MRt,this._maxOpacity=1,this._shadowDifference=.2,this._technique=e.techniques.acquire(pFe)}initialize(){this.addHandles([ue(()=>this.view.highlightOptions.shadowOpacity,e=>{this._passParameters.shadowOpacity=e??IDe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},sr),ue(()=>this.view.highlightOptions.shadowDifference,e=>{this._shadowDifference=e??LDe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},sr),ue(()=>this.view.highlightOptions.shadowColor,e=>{this._passParameters.shadowColor=i3(e??$De),this._updateMaxOpacity()},sr)])}destroy(){this._technique.release()}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}render(e){var n;const i=e.find(({name:o})=>o==="composite-color"),r=this.bindParameters;if(!r.shadowHighlightsVisible||!r.depth||!this._ensureIfVisible(r.camera,r.lighting.mainLight.direction))return i;if(!this._technique.compiled)return this.requestRender(tr.UPDATE),i;this._passParameters.highlight=(n=e.find(({name:o})=>o==="highlights"))==null?void 0:n.getTexture(),this._passParameters.origin=r.camera.center;const s=this.renderingContext;return s.bindFramebuffer(i.fbo),s.bindTechnique(this._technique,r,this._passParameters),s.screen.draw(),i}_ensureIfVisible(e,i){this._passParameters.opacityElevation=1-FI(PRt,ORt,e.relativeElevation);const r=this.viewingMode===Ge.Global?ge(Uye,e.center):ne(Uye,0,0,1),s=pe(r,i);return this._passParameters.dayNightTerminator=FI(0,1,Te(30*s,0,1)),this._maxOpacity*this._passParameters.opacityElevation*this._passParameters.dayNightTerminator>=ARt}};h([f()],nx.prototype,"produces",void 0),h([f()],nx.prototype,"consumes",void 0),h([f({constructOnly:!0})],nx.prototype,"viewingMode",void 0),h([f({constructOnly:!0})],nx.prototype,"techniques",void 0),nx=h([I("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],nx);const Uye=E();let rne=class extends $r{constructor(){super(...arguments),this.mask=null,this.overlay=null,this.input=null,this.size=0}};function mFe(){const t=new Vi;return t.attributes.add(R.POSITION,"vec2"),t.vertex.uniforms.add(new zi("drawPosition",(e,i)=>RRt(e,i))),t.varyings.add("vUV","vec2"),t.vertex.code.add(S`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new mt("textureInput",e=>e.input)),t.fragment.uniforms.add(new mt("textureMask",e=>e.mask)),t.fragment.uniforms.add(new mt("textureOverlay",e=>e.overlay)),t.fragment.uniforms.add(new pg("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new pg("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(S`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function RRt(t,e){const i=e.camera.pixelRatio,r=t.magnifier.offset.x*i,s=t.magnifier.offset.y*i;ef(t.magnifier.position,zye);const n=e.camera.screenToRender(zye,$Rt),o=Math.ceil(i*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return ds(IRt,(n[0]+r)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const zye=vs(),$Rt=zwe(),IRt=Qt(),LRt=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:rne,build:mFe},Symbol.toStringTag,{value:"Module"}));let gFe=class yFe extends Wi{initializeProgram(e){return new Yi(e.rctx,yFe.shader.get().build(),wi)}initializePipeline(){return Gt({blending:Ah(Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Kt})}};gFe.shader=new Bi(LRt,()=>fe(()=>Promise.resolve().then(()=>DUt),void 0));async function DRt(t){const e=fe(()=>import("./mask-svg-cNit2NTT.js"),[]),i=fe(()=>import("./overlay-svg-DioSRl-7.js"),[]),r=R0((await e).default,{signal:t}),s=R0((await i).default,{signal:t}),n={mask:await r,overlay:await s};return Et(t),n}let uv=class extends PL{constructor(e){super(e),this.produces="magnifier-color",this.consumes={required:["magnifier-color"]},this._imageSources=null,this._imageLoadTask=null,this._passParameters=new rne,this._vao=null,this._technique=null,this._magnifier=null,this._tmpScreenPoint=vs(),this._tmpRenderPoint=zwe()}initialize(){this.addHandles([ue(()=>this.view.magnifier,e=>this._update(e),sr)])}_update(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const i=()=>{const r=this._validMagnifier;r?(this._loadResources(r),this.produces="magnifier-color"):this.produces="disabled",this.requestRender()};this._magnifier&&this.addHandles(ue(()=>{var r;return(r=this._magnifier)==null?void 0:r.version},i)),i()}get _validMagnifier(){var e,i,r;return(e=this._magnifier)!=null&&e.visible&&((i=this._magnifier)!=null&&i.position)&&((r=this._magnifier)==null?void 0:r.size)>0?this._magnifier:null}get _factor(){var e;return((e=this._magnifier)==null?void 0:e.factor)||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeTextures(),this._vao=It(this._vao)}_disposeTextures(){this._passParameters.mask=It(this._passParameters.mask),this._passParameters.overlay=It(this._passParameters.overlay),this._passParameters.input=It(this._passParameters.input)}render(e){var v;const i=this._validMagnifier,r=e.find(({name:b})=>b==="magnifier-color");if(i==null)return r;if(this._imageSources==null)return this.requestRender(tr.UPDATE),r;const s=this.renderingContext,n=this.camera.pixelRatio,o=Math.ceil(n*i.size);if(this._vao??(this._vao=kg(s,oie,wi,0,1)),this._technique??(this._technique=this.techniques.acquire(gFe)),this._ensureTextureResources(s,o),!((v=this._technique)!=null&&v.compiled)||!this._passParameters.input)return this.requestRender(tr.UPDATE),r;const a=Math.ceil(1/this._factor*o),l=this._passParameters.input;l.resize(a,a),ef(i.position,this._tmpScreenPoint);const c=this.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),u=this.camera.fullWidth,d=this.camera.fullHeight,p=.5*a,m=.5*a;c[0]=Te(c[0],p,u-p-1),c[1]=Te(c[1],m,d-m-1);const g=Math.floor(c[0]-p),y=Math.floor(c[1]-m);return s.bindFramebuffer(r.fbo),this._technique.program.bindTexture("textureInput",l),s.gl.copyTexImage2D(l.descriptor.target,0,l.descriptor.pixelFormat,g,y,a,a,0),this._passParameters.magnifier=i,s.bindTechnique(this._technique,this.bindParameters,this._passParameters),s.bindVAO(this._vao),s.drawArrays(vi.TRIANGLE_STRIP,0,4),r}_loadResources(e){var s,n,o;const{maskUrl:i,overlayUrl:r}=e;((s=this._imageLoadTask)==null?void 0:s.maskUrl)===i&&((n=this._imageLoadTask)==null?void 0:n.overlayUrl)===r||((o=this._imageLoadTask)==null||o.task.abort(),this._imageLoadTask=this._imageSources=null),this._imageSources||this._imageLoadTask||(this._imageLoadTask={maskUrl:i,overlayUrl:r,task:Nf(async a=>{const l=i==null||r==null?DRt(a):null,c=i!=null?R0(i,{signal:a}):l.then(d=>d.mask),u=r!=null?R0(r,{signal:a}):l.then(d=>d.overlay);this._imageSources={mask:await c,overlay:await u}})})}_ensureTextureResources(e,i){if(this._imageSources==null||this._passParameters.size===i&&this._passParameters.input&&this._passParameters.mask&&this._passParameters.overlay)return;this._disposeTextures(),this._imageSources.overlay.width=this._imageSources.mask.width=i,this._imageSources.overlay.height=this._imageSources.mask.height=i;const r=new jr;r.internalFormat=Ft.RGBA,r.wrapMode=bi.CLAMP_TO_EDGE,r.flipped=!0,r.preMultiplyAlpha=!$be(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result,this._passParameters.overlay=new br(e,r,this._imageSources.overlay),r.pixelFormat=r.internalFormat=Ft.ALPHA,r.preMultiplyAlpha=!1,this._passParameters.mask=new br(e,r,this._imageSources.mask),r.pixelFormat=r.internalFormat=Ft.RGBA,r.flipped=!1,this._passParameters.input=new br(e,r)}};h([f()],uv.prototype,"produces",void 0),h([f()],uv.prototype,"consumes",void 0),h([f()],uv.prototype,"_imageSources",void 0),h([f()],uv.prototype,"_imageLoadTask",void 0),h([f({constructOnly:!0})],uv.prototype,"techniques",void 0),uv=h([I("esri.views.3d.webgl-engine.effects.magnifier.MagnifierRenderNode")],uv);const B2={maxSearchSteps:8,maxDistanceAreaTex:16};function _Fe(){const t=new Vi;return t.include(Oa),t.fragment.uniforms.add(new mt("edgesTexture",e=>e.inputTexture),new mt("areaTexture",e=>e.areaTexture),new mt("searchTexture",e=>e.searchTexture)),t.fragment.code.add(S`
    #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
    #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

    vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
      return texture(tex, coord + offset.x * resolution, 0.0);
    }

    float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture( searchTex, e, 0.0 ).r;
    }

    float searchLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${S.int(B2.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${S.int(B2.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
      return texcoord.x;
    }

    float searchUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${S.int(B2.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
      return texcoord.y;
    }

    float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${S.int(B2.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
      return texcoord.y;
    }

    vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
      vec2 texcoord = float( ${S.int(B2.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
      texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
      texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
      return texture( areaTex, texcoord, 0.0 ).rg;
    }

    void main() {
      vec2 size = vec2(textureSize(edgesTexture, 0));
      vec2 resolution = 1.0 / size;
      vec2 pixelCoord = uv * size;
      vec4 offsets[2];
      offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
      offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
      vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${S.int(B2.maxSearchSteps)} );

      ivec4 subsampleIndices = ivec4(0.0);
      vec4 weights = vec4(0.0);
      vec2 e = texture( edgesTexture, uv ).rg;
      if ( e.g > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.x = searchLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
        coords.y = offsets[1].y;
        d.x = coords.x;
        float e1 = texture( edgesTexture, coords, 0.0 ).r;
        coords.x = searchRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
        d.y = coords.x;
        d = d * size.x - pixelCoord.x;
        vec2 sqrt_d = sqrt( abs(d) );
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
        weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
      }

      if ( e.r > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.y = searchUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
        coords.x = offsets[0].x;
        d.x = coords.y;
        float e1 = texture( edgesTexture, coords, 0.0 ).g;
        coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
        d.y = coords.y;
        d = d * size.y - pixelCoord.y;
        vec2 sqrt_d = sqrt(abs(d));
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
        weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

        // for some reason the following lines are necessary to prevent
        // texture lookup precision issues on some Intel integrated graphics chips
        vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
        weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
      }
      fragColor = weights;
    }`),t}const NRt=Object.freeze(Object.defineProperty({__proto__:null,build:_Fe},Symbol.toStringTag,{value:"Module"}));let vFe=class bFe extends Wi{initializeProgram(e){return new Yi(e.rctx,bFe.shader.get().build(),wi)}initializePipeline(){return Gt({colorWrite:Kt})}};vFe.shader=new Bi(NRt,()=>fe(()=>Promise.resolve().then(()=>NUt),void 0));function wFe(){const t=new Vi;return t.include(Oa),t.fragment.uniforms.add(new mt("blendWeightsTexture",e=>e.inputTexture),new mt("colorTexture",e=>e.color)),t.fragment.code.add(S`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const FRt=Object.freeze(Object.defineProperty({__proto__:null,build:wFe},Symbol.toStringTag,{value:"Module"}));let xFe=class SFe extends Wi{initializeProgram(e){return new Yi(e.rctx,SFe.shader.get().build(),wi)}initializePipeline(){return Gt({colorWrite:Kt})}};xFe.shader=new Bi(FRt,()=>fe(()=>Promise.resolve().then(()=>FUt),void 0));const Vye={threshold:.05,localConstrastAdaption:2};function TFe(){const t=new Vi;return t.include(Oa),t.fragment.uniforms.add(new mt("colorTexture",e=>e.color)),t.outputs.add("fragEdges","vec2"),t.fragment.code.add(S`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${S.float(Vye.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${S.float(Vye.localConstrastAdaption)}) * delta.xy);

      fragEdges = edges;
    }
  `),t}const kRt=Object.freeze(Object.defineProperty({__proto__:null,build:TFe},Symbol.toStringTag,{value:"Module"}));let EFe=class CFe extends Wi{initializeProgram(e){return new Yi(e.rctx,CFe.shader.get().build(),wi)}initializePipeline(){return Gt({colorWrite:Kt})}};EFe.shader=new Bi(kRt,()=>fe(()=>Promise.resolve().then(()=>kUt),void 0));let URt=class extends $r{},hv=class extends PL{constructor(e){super(e),this.produces="disabled",this.consumes={required:["aa-color","composite-color"]},this._areaTexture=null,this._searchTexture=null,this._smaaParameters=new URt,this._edgeTechnique=e.techniques.acquire(EFe),this._blendTechnique=e.techniques.acquire(vFe),this._blurTechnique=e.techniques.acquire(xFe)}initialize(){this.addHandles([ue(()=>this.isEnabled(),e=>e?this.enable():this.disable(),sr)])}async enable(){if(this.produces="aa-color",this._abortController||this._areaTexture&&this._searchTexture)return;this._abortController=new AbortController;const e=this._abortController.signal;try{const i=await fe(()=>import("./SMAAData-DCEZ61Cs.js"),[]);await this._loadTextures(i,e),this.requestRender(tr.UPDATE)}catch{}this._abortController=null}async _loadTextures(e,i){Et(i);const[r,s]=await Promise.allSettled([R0(e.areaTexture,{signal:i}),R0(e.searchTexure,{signal:i})]);if(Et(i),r.status!=="fulfilled"||s.status!=="fulfilled")return;const n=this.renderingContext;this._areaTexture=Bye(n,ii.LINEAR,Ft.RGB,r.value),this._searchTexture=Bye(n,ii.NEAREST,Ft.LUMINANCE,s.value)}disable(){this.produces="disabled"}destroy(){this._searchTexture=It(this._searchTexture),this._areaTexture=It(this._areaTexture),this._blurTechnique.release(),this._blendTechnique.release(),this._edgeTechnique.release()}render(e){var c,u;const i=e.find(({name:d})=>d==="aa-color");if(!(this._edgeTechnique.compiled&&this._blendTechnique.compiled&&this._blurTechnique.compiled&&this._areaTexture&&this._searchTexture))return this.requestRender(tr.UPDATE),i;const r=e.find(({name:d})=>d==="composite-color"),s=r.fbo.width,n=r.fbo.height,o=this.renderingContext;o.setViewport(0,0,s,n);const a=this.fboCache.acquire(s,n,"smaa edges",Xr.RG);o.unbindTexture((c=a.fbo)==null?void 0:c.colorTexture),o.bindFramebuffer(a.fbo),o.setClearColor(0,0,0,1),o.clear(Lr.COLOR_BUFFER_BIT),this._smaaParameters.color=r.getTexture(),o.bindTechnique(this._edgeTechnique,null,this._smaaParameters),o.screen.draw();const l=this.fboCache.acquire(s,n,"smaa blend");return o.unbindTexture((u=l.fbo)==null?void 0:u.colorTexture),o.bindFramebuffer(l.fbo),o.setClearColor(0,0,1,1),o.clear(Lr.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=a.getTexture(),this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,o.bindTechnique(this._blendTechnique,null,this._smaaParameters),o.screen.draw(),a.release(),o.bindFramebuffer(i.fbo),o.setClearColor(0,1,0,1),o.clear(Lr.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=l.getTexture(),o.bindTechnique(this._blurTechnique,null,this._smaaParameters),o.screen.draw(),l.release(),i}};function Bye(t,e,i,r){const s=new jr;return s.pixelFormat=i,s.wrapMode=bi.CLAMP_TO_EDGE,s.width=r.width,s.height=r.height,s.samplingMode=e,new br(t,s,r)}h([f()],hv.prototype,"produces",void 0),h([f()],hv.prototype,"consumes",void 0),h([f({constructOnly:!0})],hv.prototype,"isEnabled",void 0),h([f({constructOnly:!0})],hv.prototype,"techniques",void 0),h([f()],hv.prototype,"_abortController",void 0),hv=h([I("esri.views.3d.webgl-engine.effects.smaa.SMAA")],hv);let Tj=class extends $r{constructor(){super(...arguments),this.opacity=1}};function MFe(t){const e=new Vi;return e.include(Oa),e.fragment.uniforms.add(new mt("tex",i=>i.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new qe("opacity",i=>i.opacity)),t.isDepthBlit&&(e.fragment.uniforms.add(new Fr("nearFar",(i,r)=>r.camera.nearFar)),e.fragment.include(Ig),e.fragment.include(Uf)),e.fragment.code.add(S`
    void main() {
      ${t.isDepthBlit?S`
              float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
              fragColor = float2rgba(normalizedLinearDepth);`:S`
              fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};`}
    }`),e}const zRt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:Tj,build:MFe},Symbol.toStringTag,{value:"Module"}));var cu;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(cu||(cu={}));let bI=class extends jl{constructor(){super(...arguments),this.alphaMode=cu.None,this.hasOpacityFactor=!1,this.isDepthBlit=!1}};h([B({count:cu.COUNT})],bI.prototype,"alphaMode",void 0),h([B()],bI.prototype,"hasOpacityFactor",void 0),h([B()],bI.prototype,"isDepthBlit",void 0);let sne=class AFe extends Wi{initializeProgram(e){return new Yi(e.rctx,AFe.shader.get().build(this.configuration),wi)}initializePipeline(){switch(this.configuration.alphaMode){case cu.None:return Gt({colorWrite:Kt});case cu.Alpha:return Gt({blending:sa(Pe.SRC_ALPHA,Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA,Pe.ONE_MINUS_SRC_ALPHA),colorWrite:Kt});case cu.PremultipliedAlpha:case cu.COUNT:return Gt({blending:Ah(Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA),colorWrite:Kt})}}};sne.shader=new Bi(zRt,()=>fe(()=>Promise.resolve().then(()=>UUt),void 0));let nne=class extends $r{};function PFe(){const t=new Vi;return t.include(Oa),t.fragment.uniforms.add(new mt("tex",e=>e.texture)),t.fragment.code.add(S`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const VRt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:nne,build:PFe},Symbol.toStringTag,{value:"Module"}));let OFe=class RFe extends Wi{initializeProgram(e){return new Yi(e.rctx,RFe.shader.get().build(),wi)}initializePipeline(){return Gt({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};OFe.shader=new Bi(VRt,()=>fe(()=>Promise.resolve().then(()=>zUt),void 0));let one=class extends $r{};function $Fe(){const t=new Vi;return t.include(Oa),t.fragment.uniforms.add(new mt("colorTexture",e=>e.colorTexture),new mt("alphaTexture",e=>e.alphaTexture),new mt("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(S`void main() {
float srcAlpha = texture(alphaTexture, uv).r;
if(srcAlpha <= 1e-5){
discard;
}
vec4 srcColor = texture(colorTexture, uv);
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb / srcAlpha, frontFace.rgb, frontFace.a), 1.0 - srcColor.a);
}`),t}const BRt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:one,build:$Fe},Symbol.toStringTag,{value:"Module"}));let ane=class IFe extends Wi{initializeProgram(e){return new Yi(e.rctx,IFe.shader.get().build(),wi)}initializePipeline(){return Gt({blending:sa(Pe.SRC_ALPHA,Pe.ONE,Pe.ONE_MINUS_SRC_ALPHA,Pe.ONE_MINUS_SRC_ALPHA),colorWrite:Kt})}};ane.shader=new Bi(BRt,()=>fe(()=>Promise.resolve().then(()=>VUt),void 0));let GRt=class{constructor(e,i){this._rctx=e,this._techniques=i,this._configuration=new bI,this._passParameters=new Tj,this._oitParameters=new one,this._hudParameters=new nne}compositeOIT(e,i,r,s){this._oitParameters.colorTexture=i,this._oitParameters.alphaTexture=r,this._oitParameters.frontFaceTexture=s;const n=this._techniques.acquire(ane);this._rctx.bindTechnique(n,e,this._oitParameters),this._rctx.screen.draw(),n.release()}compositeHUD(e,i){this._hudParameters.texture=i;const r=this._techniques.acquire(OFe);this._rctx.bindTechnique(r,e,this._hudParameters),this._rctx.screen.draw(),r.release()}composite(e,i,r=cu.None,s=1){this._configuration.alphaMode=r,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=i,this._passParameters.opacity=s;const n=this._techniques.acquire(sne,this._configuration);this._rctx.bindTechnique(n,e,this._passParameters),this._rctx.screen.draw(),n.release()}blitDepthToLinearDepth(e,i){this._configuration.isDepthBlit=!0,this.composite(e,i),this._configuration.isDepthBlit=!1}};const jRt=1e4,IJ=100,HRt=500,qRt=500,WRt=.1;function YRt(t,e,i){return vre(e,t)*(i[1]-i[0])+i[0]}function ZRt(t,e,i){let r=0;if(!e.some(n=>!!n.materialReference&&(r+=n.numGeometries,r>=jRt)))return s$t.compute(t,e);const s=jL();return i.forAll(n=>bA(s,XRt(t,n))),s}function XRt(t,e){if(!e.visible)return;const i=jL(),r=e.getSpatialQueryAccelerator();return r?JRt(i,t,r):QRt(i,t,e.objects),i}function JRt(t,e,i){const r=e.eye,s=e.viewForward,n=e.frustum,o=l=>l.visible,a=i.objectCount;if(a<HRt)RV(fd,e.near,Math.min(t.near,e.far)),i.forEachInDepthRange(r,s,uf.DepthOrder.FRONT_TO_BACK,fd,(l,c)=>{LJ(t,e,l),fd.far=t.near,c.setRange(fd)},n,o),RV(fd,Math.max(t.far,e.near),e.far),i.forEachInDepthRange(r,s,uf.DepthOrder.BACK_TO_FRONT,fd,(l,c)=>{LJ(t,e,l),fd.near=t.far,c.setRange(fd)},n,o);else{const l=Math.max(Math.min(a,qRt),Math.ceil(a*WRt)),c=i.findClosest(s,uf.DepthOrder.FRONT_TO_BACK,n,o,l),u=i.findClosest(s,uf.DepthOrder.BACK_TO_FRONT,n,o,l);c&&u&&(Gye(t,e,c.boundingVolumeWorldSpace.bounds),Gye(t,e,u.boundingVolumeWorldSpace.bounds))}}function QRt(t,e,i){G2.clear(),i.forAll(r=>{r.visible&&r.geometries.length!==0&&G2.add(r)}),G2.empty||(G2.sort(e),RV(fd,e.near,Math.min(t.near,e.far)),G2.forEachInDepthRange(fd,uf.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<t.near&&LJ(t,e,r)}),RV(fd,Math.max(t.far,e.near),e.far),G2.forEachInDepthRange(fd,uf.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{t.far=Math.max(t.far,n)}))}function LJ(t,e,i){if(!i.visible||!Zv(e.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=r$t;i.geometries.forEach(n=>{dr(s,r,n.transformation);const o=VM(s);LFe(t,e,n.boundingInfo,s,o)})}function LFe(t,e,i,r,s){if(i==null)return;He(Pl,i.center,r);const{eye:n,viewForward:o}=e,a=o[0]*(Pl[0]-n[0])+o[1]*(Pl[1]-n[1])+o[2]*(Pl[2]-n[2]);if(Pl[3]=i.radius*s,!(a-Pl[3]>t.near&&a+Pl[3]<t.far)&&Zv(e.frustum,Pl))if(i.radius>IJ&&i.getChildren())for(const l of i.getChildren())LFe(t,e,l,r,s);else DJ.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function Gye(t,e,i){const r=e.eye,s=e.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];t.near=Math.min(t.near,n-i[3]),t.far=Math.max(t.far,n+i[3])}let KRt=class{constructor(){this._items=new Zt({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const i=e.eye,r=e.viewForward;this._items.forAll(s=>{const n=s.object.boundingVolumeWorldSpace.bounds,o=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,i,r){if(i===uf.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.object,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.object,n.near,n.far)}}},e$t=class{constructor(){this._view=Ee(),this._viewProj=Ee(),this._frustum=s3(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,i){this._reset(),vn(this._view,e.viewMatrix),dr(this._viewProj,e.projectionMatrix,this._view),bz(this._frustum,e.frustum);const r=this._view,s=r[2],n=r[6],o=r[10],a=r[14];i.forAll(p=>{p.materialReference&&p.forEachGeometry&&p.forEachGeometry(m=>{if(!m.visible||!m.castShadow)return;const g=m.boundingSphere,y=s*g[0]+n*g[1]+o*g[2]+a,v=y-g[3],b=y+g[3];this._geometries.push(m),this._near.push(-b),this._far.push(-v)})});const l=new Jse;if(this._geometries.length===0)return l;for(let p=0;p<this._geometries.length;++p)this._near[p]>l.far&&(l.far=this._near[p]),this._near[p]>2&&this._far[p]<l.near&&(l.near=this._far[p]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let u=0,d=0;for(let p=0;p<this._geometries.length;++p)this._near[p]<l.near&&(this._near[p]>=c.near?l.near=this._near[p]:this._nearCandidates[u++]=p),this._far[p]>l.far&&(this._far[p]<=c.far?l.far=this._far[p]:this._farCandidates[d++]=p);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((p,m)=>this._near[p]<this._near[m]?-1:this._near[p]>this._near[m]?1:0),this._farCandidates.sort((p,m)=>this._far[p]<this._far[m]?1:this._far[p]>this._far[m]?-1:0);for(let p=0;p<this._nearCandidates.length;++p){const m=this._nearCandidates[p];if(this._near[m]<l.near){const g=this._geometries[m],y=g.boundingInfo;this._includeNearBoundingInfoRec(y,g.shaderTransformation,l)}}for(let p=0;p<this._farCandidates.length;++p){const m=this._farCandidates[p];if(this._far[m]>l.far){const g=this._geometries[m],y=g.boundingInfo;this._includeFarBoundingInfoRec(y,g.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,i,r){if(e==null)return;const s=e.center;He(Pl,s,i);const n=VM(i),o=Pl[0],a=Pl[1],l=Pl[2],c=e.radius*n,u=this._frustum;if(u[0][0]*o+u[0][1]*a+u[0][2]*l+u[0][3]>c||u[1][0]*o+u[1][1]*a+u[1][2]*l+u[1][3]>c||u[2][0]*o+u[2][1]*a+u[2][2]*l+u[2][3]>c||u[3][0]*o+u[3][1]*a+u[3][2]*l+u[3][3]>c)return;const d=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],p=d+c;if(!(-(d-c)<2||-p>=r.near))if(-p>this._looseRange.near)r.near=-p;else{if(c>IJ){const m=e.getChildren();if(m!==void 0){for(const g of m)this._includeNearBoundingInfoRec(g,i,r);return}}DJ.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,i,r){if(e==null)return;let s=e.radius;const n=e.center;He(Pl,n,i);const o=VM(i),a=Pl[0],l=Pl[1],c=Pl[2];s*=o;const u=this._frustum;if(u[0][0]*a+u[0][1]*l+u[0][2]*c+u[0][3]>s||u[1][0]*a+u[1][1]*l+u[1][2]*c+u[1][3]>s||u[2][0]*a+u[2][1]*l+u[2][2]*c+u[2][3]>s||u[3][0]*a+u[3][1]*l+u[3][2]*c+u[3][3]>s)return;const d=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-d<=r.far))if(-d<this._looseRange.far)r.far=-d;else{if(s>IJ){const p=e.getChildren();if(p!==void 0){for(const m of p)this._includeFarBoundingInfoRec(m,i,r);return}}DJ.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}},t$t=class{constructor(){this._modelViewProj=Ee(),this._clipPosition=[Qt(),Qt(),Qt(),Qt(),Qt(),Qt(),Qt(),Qt()]}unionDepthRangeWithAABB(e,i,r,s,n){const o=this._modelViewProj;dr(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],u=l===0||l===3||l===4||l===7?s[0]:n[0],d=l===0||l===1||l===4||l===5?s[1]:n[1],p=l<4?s[2]:n[2];c[0]=o[0]*u+o[4]*d+o[8]*p+o[12],c[1]=o[1]*u+o[5]*d+o[9]*p+o[13],c[2]=o[2]*u+o[6]*d+o[10]*p+o[14],c[3]=o[3]*u+o[7]*d+o[11]*p+o[15]}for(let l=0;l<12;++l){const c=i$t(this._clipPosition[Pq[l][0]],this._clipPosition[Pq[l][1]],this._clipPosition[Pq[l][2]]);let u=!0;for(let d=0;d<c.length;++d)if(c[d][3]>=2){u=!1;break}if(!u){a=!0;for(let d=0;d<c.length;++d){const p=c[d][3];Number.isFinite(p)&&(e.near=Math.min(p,e.near),e.far=Math.max(p,e.far))}}}return a}};function i$t(t,e,i){let r=[t,e,i];for(let s=0;s<4;++s){const n=r;r=[];for(let o=0;o<n.length;++o){const a=n[o],l=n[(o+1)%n.length];Aq(l,s)?(Aq(a,s)||r.push(jye(a,l,s)),r.push(l)):Aq(a,s)&&r.push(jye(a,l,s))}}return r}function Aq(t,e){return e===0?t[0]>=-t[3]:e===1?t[1]>=-t[3]:e===2?t[0]<=t[3]:e===3?t[1]<=t[3]:void ft(!1)}function jye(t,e,i){let r=0;return i===0?r=(-t[3]-t[0])/(e[0]-t[0]+e[3]-t[3]):i===1?r=(-t[3]-t[1])/(e[1]-t[1]+e[3]-t[3]):i===2?r=(t[3]-t[0])/(e[0]-t[0]-e[3]+t[3]):i===3&&(r=(t[3]-t[1])/(e[1]-t[1]-e[3]+t[3])),LB(Qt(),t,e,r)}const Pq=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Pl=ln(),r$t=Ee(),fd=jL(),G2=new KRt,s$t=new e$t,DJ=new t$t;let n$t=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new nl(new ArrayBuffer(4)),this._layerToOidToColor=new q1,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new q1,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,i,r,s,n,o=null,a=null,l=null){e&&i&&r&&s&&(this._layerUidToId.set(s,r),this._layerUidToPopupEnabled.set(s,n),n&&this._layerUidToGraphicsUidToObjectId.set(s,i,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l}))}getObjectAndLayerIdColor(e){const i=this.getObjectAndLayerIdColorArray(e);return Wt(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(e){var o;if(!e.layerUid||!e.graphicUid)return this.colorZero;const i=this._layerUidToPopupEnabled.get(e.layerUid);if(i===void 0)return this.colorZero;if(i===!1)return this.colorZero;const r=(o=this._layerUidToGraphicsUidToObjectId.get(e.layerUid,e.graphicUid))==null?void 0:o.objectId;if(!r)return this.colorZero;let s=this._layerToOidToColor.get(e.layerUid,r);if(!s){for(;!s;){const a=Math.floor(16777214*Math.random())+1;this._colorToUID.has(a)||(s=a)}if(s>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(e.layerUid,r,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new nl(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[i,r]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(r.layerUid,r.graphicUid),n=this._layerUidToId.get(r.layerUid);s&&n&&e.set(i,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:s.objectId,lid:n,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",oid:s.objectId,lid:n})}return e}};var Vv,eS;(function(t){t.OPAQUE="opaque-color",t.TRANSPARENT="transparent-color",t.COMPOSITE="composite-color",t.FINAL="final-color"})(Vv||(Vv={})),function(t){t.ANTIALIASING="aa-color",t.HIGHLIGHTS="highlight-color",t.MAGNIFIER="magnifier-color"}(eS||(eS={}));let DFe=class{constructor(e,i){this.key=e,this.free=i,this.incarnation=0,this._refCount=1}retain(e=1){this._refCount+=e}release(){return this._refCount===0?(console.log(`Releasing already released FBO attachment in ${new Error().stack}`),!0):(--this._refCount,this._refCount===0&&(this.free(),!0))}};var wA;(function(t){t[t.FBO=0]="FBO",t[t.DEPTH=1]="DEPTH",t[t.COLOR=2]="COLOR"})(wA||(wA={}));let NFe=class extends DFe{constructor(e,i,r){super(e,r),this.attachment=i,this.name=""}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.usedMemory}},o$t=class extends NFe{constructor(e,i,r){super(e,i,r),this.attachment=i,this.type=wA.COLOR}},Hye=class extends NFe{constructor(){super(...arguments),this.type=wA.DEPTH}};function a$t(t){return(t==null?void 0:t.attachment.type)===P0.Texture}let FFe=class extends DFe{constructor(e,i,r,s,n,o){super(e,o),this.type=wA.FBO,this._colors=new Map,this._name="composite-color",this.acquireDepth=null,this.acquireColor=null,this._name=i,this.fbo=r,this.acquireDepth=s,this.acquireColor=n}dispose(){var e;(e=this.fbo)==null||e.dispose()}get usedMemory(){var e;return((e=this.fbo)==null?void 0:e.usedMemory)||0}get name(){return this._name}setName(e){this._name=e}getTexture(e=qn.COLOR_ATTACHMENT0){var i,r;return e===eA?(i=this.fbo)==null?void 0:i.depthStencilTexture:(r=this.fbo)==null?void 0:r.getColorTexture(e)}getAttachment(e=qn.COLOR_ATTACHMENT0){return e===eA?this._depth:this._colors.get(e)}attachDepth(e){var i;return e==null||e.retain(),this.detachDepth(),e&&((i=this.fbo)==null||i.attachDepthStencil(e.attachment)),this._depth=e,this}detachDepth(){var e,i;(e=this.fbo)==null||e.detachDepthStencilTexture(),(i=this.fbo)==null||i.detachDepthStencilBuffer(),this._depth=ti(this._depth)}obtainDepthTexture(){var i;const e=this._depth;return a$t(e)?((i=this.fbo)==null||i.detachDepthStencilTexture(),this._depth=null,e):null}attachColor(e,i){var r;return e.retain(),this.detachColor(i),(r=this.fbo)==null||r.attachColorTexture(e.attachment,i),this._colors.set(i,e),this}detachColor(e){var r;(r=this.fbo)==null||r.detachColorTexture(e);const i=this._colors.get(e);this._colors.delete(e),i==null||i.release()}detachAll(){this._colors.forEach((e,i)=>this.detachColor(i)),this.detachDepth()}},Oq=class{constructor(e,i){this._last=new Zt,this._incarnation=0,this._cache=new zL(e,i)}destroy(){var e;(e=this._last)==null||e.forAll(i=>i.dispose()),this._last=null,this._cache.destroy()}set interactive(e){var i;e&&!this._last?this._last=new Zt:e||((i=this._last)==null||i.forAll(r=>r.dispose()),this._last=null)}clean(){var e;(e=this._last)==null||e.filterInPlace(i=>!(i.incarnation<this._incarnation)||(this._cache.put(i.key,i),!1))}frame(){++this._incarnation}pop(e){if(this._last){const i=this._last.find(r=>r.key===e);if(i)return this._last.removeUnordered(i),i}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){var e;return((e=this._last)==null?void 0:e.reduce((i,r)=>i+r.usedMemory,0))??0}},l$t=class{constructor(e){this.rctx=e,this._acquired=new Set,this._cache=new Oq(e.newCache,"FBOCache"),this._depthCache=new Oq(e.newCache,"DepthAttachmentCache"),this._colorCache=new Oq(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frameStart(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame(),this.debugCallback&&this.debugCallback()}frameEnd(){const e=this.debugCallback;e&&this._acquired.forEach(i=>i.type===wA.FBO&&e(i.name,i.fbo))}get usedMemory(){return Array.from(this._acquired.values()).reduce((e,i)=>{var r;return e+("getTexture"in i?((r=i.getTexture())==null?void 0:r.usedMemory)??0:i.usedMemory)},this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e}acquire(e,i,r,s=Xr.RGBA){const n=Rq(s,e,i);let o=this._cache.pop(n);if(o){o.retain(),o.setName(r);const a=this.rctx.getBoundFramebufferObject();this.rctx.bindFramebuffer(o.fbo),this.rctx.setDrawBuffers([qn.COLOR_ATTACHMENT0]),this.rctx.bindFramebuffer(a)}else o=new FFe(n,r,new zg(this.rctx,{...qye[s],width:e,height:i}),a=>{a??(a=Ao.DEPTH_STENCIL_TEXTURE);const l=this._acquireDepth(a,o.fbo.width,o.fbo.height,`${o.name} depth`);return o.attachDepth(l),l.release(),o},(a,l)=>{l??(l=Xr.RGBA);const c=this._acquireColor(l,e,i,`${o.name} color ${a}`);return o.attachColor(c,a),c.release(),o},()=>{this.debugCallback&&this.debugCallback(o.name,o.fbo),this._acquired.delete(o),o.detachAll(),this._cache.put(o)});return this._trackHandle(o)}acquireDepth(e,i,r,s){return this._acquireDepth(e,i,r,s)}_acquireDepth(e,i,r,s){const n=Rq(e,i,r),o=this._depthCache.pop(n);if(o)return o.retain(),o.name=s,this._trackHandle(o);const a=e===Ao.DEPTH_STENCIL_TEXTURE?new Hye(n,new br(this.rctx,{...Wye[e],width:i,height:r}),()=>{this._acquired.delete(a),this._depthCache.put(a)}):new Hye(n,new lAe(this.rctx,{...Wye[e],width:i,height:r}),()=>{this._acquired.delete(a),this._depthCache.put(a)});return a.name=s,this._trackHandle(a)}_acquireColor(e,i,r,s){const n=Rq(e,i,r),o=this._colorCache.pop(n);if(o)return o.retain(),o.name=s,this._trackHandle(o);const a=new o$t(n,new br(this.rctx,{...qye[e],width:i,height:r}),()=>{this._acquired.delete(a),this._colorCache.put(a)});return a.name=s,this._trackHandle(a)}_trackHandle(e){return this._acquired.add(e),e}};const P3=new FFe("default","default",null,()=>P3,()=>P3,()=>{});function Rq(t,e,i){return`${t}x${e}x${i}`}const uk=new jr;uk.pixelFormat=Ft.RED,uk.internalFormat=gt.R8,uk.wrapMode=bi.CLAMP_TO_EDGE;const hk=new jr;hk.pixelFormat=Ft.RG,hk.internalFormat=gt.RG8,hk.wrapMode=bi.CLAMP_TO_EDGE;const dk=new jr;dk.internalFormat=gt.RGBA4,dk.dataType=sl.UNSIGNED_SHORT_4_4_4_4,dk.wrapMode=bi.CLAMP_TO_EDGE;const kFe=new jr;kFe.wrapMode=bi.CLAMP_TO_EDGE;const s$=new jr;s$.wrapMode=bi.CLAMP_TO_EDGE,s$.samplingMode=ii.LINEAR_MIPMAP_LINEAR,s$.hasMipmap=!0,s$.maxAnisotropy=8;const n$=new jr;n$.pixelFormat=Ft.RED,n$.dataType=sl.HALF_FLOAT,n$.internalFormat=gt.R16F,n$.samplingMode=ii.NEAREST;const pk=new jr;pk.dataType=sl.HALF_FLOAT,pk.internalFormat=gt.RGBA16F,pk.samplingMode=ii.NEAREST;const qye={[Xr.RED]:uk,[Xr.RG]:hk,[Xr.RGBA4]:dk,[Xr.RGBA]:kFe,[Xr.RGBA_MIPMAP]:s$,[Xr.R16F]:n$,[Xr.RGBA16F]:pk},o$=new jr;o$.pixelFormat=Ft.DEPTH_STENCIL,o$.dataType=sl.UNSIGNED_INT_24_8,o$.samplingMode=ii.NEAREST,o$.wrapMode=bi.CLAMP_TO_EDGE;const Wye={[Ao.DEPTH_STENCIL_TEXTURE]:o$,[Ao.DEPTH16_BUFFER]:new aAe(_a.DEPTH_COMPONENT16,4)};var O3;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(O3||(O3={}));let uy=class{constructor(e,i,r=O3.FrontToBack){this._rctx=e,this._techniques=i,this._sorting=r,this._draws=new Zt({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,i,r,s){const n=this._draws.pushNew();n.geometry=i,n.geometryRanges=r,n.material=e,n.depthSquaredHint=s,n.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0}prepare(e,i){return this._draws.map(r=>r.material.prepareTechnique(this._techniques,e,i,r.geometry.parameters))}dispatch(e,i,r){const s=this._rctx;this._previouslyBoundDraw.clear();let n=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=r[a];l===n&&l.configuration.transparencyPassType===nt.NONE||(s.bindTechnique(l,i,e),n=l);const c=this._draws.data[a],u=c.geometry;s.bindVAO(u.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,i,e),this._previouslyBoundDraw.set(l,c.material));const d=c.geometryRanges,p=d.length;if(c.indexType!==0){const m=fk.get(c.indexType);for(let g=0;g<p;g+=2){const y=d[g],v=d[g+1];s.drawElements(u.primitiveType,v,c.indexType,y*m)}}else for(let m=0;m<p;m+=2){const g=d[m],y=d[m+1];s.drawArrays(u.primitiveType,g,y)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===O3.FrontToBack?1:-1;this._draws.sort((i,r)=>{const s=e*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.byteSize-r.geometry.vao.byteSize})}get count(){return this._draws.length}};const fk=new Map;fk.set(Me.UNSIGNED_BYTE,1),fk.set(Me.UNSIGNED_SHORT,2),fk.set(Me.UNSIGNED_INT,4);let NJ=class extends znt{constructor(){super({}),this._passes=null,this.produces=new Map([[_e.OPAQUE_MATERIAL,e=>this._produces(e)],[_e.TRANSPARENT_MATERIAL,e=>!!(this._passes&&this._passes.materialTransparent.count>0)&&this._produces(e)],[_e.INTEGRATED_MESH,e=>this._produces(e)]]),this._materialPassParameters=new Hft,this._shadowPassParameters=new qft,this._highlightPassParameters=new Wft,this._viewshedPassParameters=new Yft,this._systems=new Set}initializeRenderContext(e){this._context=e;const i=e.renderContext.rctx,r=e.techniques;this._passes={materialOpaque:new uy(i,r),materialTransparent:new uy(i,r,O3.BackToFront),materialIntegratedMesh:new uy(i,r),shadowMap:new uy(i,r),highlight:new uy(i,r),highlightIntegratedMesh:new uy(i,r),highlightShadowMap:new uy(i,r),viewshedShadowMap:new uy(i,r),defaultShadowMap:new uy(i,r)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e){return this._systems.size!==0&&this._passes!==null&&(e===G.Highlight?this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0:e!==G.ShadowHighlight||this._passes.highlight.count>0)}prepareRender(e){if(this._systems.size!==0&&this._passes!==null){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,e.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this._context.techniques.frameUpdate()}}prepareTechniques(e){if(this._systems.size===0)return null;const i=e.output===G.Shadow||e.output===G.ShadowHighlight||e.output===G.ShadowExcludeHighlight?this._shadowPassParameters:e.output===G.ViewshedShadow?this._viewshedPassParameters:e.output===G.Highlight?this._highlightPassParameters:this._materialPassParameters,r=e.bindParameters;return this._updateParameters(r.camera,i,r.slot===_e.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e,(s,n)=>s.prepare(n,e.bindParameters))}renderNode(e,i){this._invoke(e,(r,s)=>r.dispatch(s,e.bindParameters,i))}_invoke(e,i){if(this._passes===null)return null;switch(e.bindParameters.slot){case _e.OPAQUE_MATERIAL:switch(e.output){case G.Color:case G.Depth:case G.Normal:case G.ObjectAndLayerIdColor:return i(this._passes.materialOpaque,this._materialPassParameters);case G.Highlight:return i(this._passes.highlight,this._highlightPassParameters);case G.Shadow:return i(this._passes.shadowMap,this._shadowPassParameters);case G.ShadowHighlight:return i(this._passes.highlightShadowMap,this._shadowPassParameters);case G.ShadowExcludeHighlight:return i(this._passes.defaultShadowMap,this._shadowPassParameters);case G.ViewshedShadow:return i(this._passes.viewshedShadowMap,this._viewshedPassParameters)}break;case _e.TRANSPARENT_MATERIAL:switch(e.output){case G.Color:case G.Depth:case G.Normal:case G.ObjectAndLayerIdColor:return i(this._passes.materialTransparent,this._materialPassParameters)}break;case _e.INTEGRATED_MESH:switch(e.output){case G.Color:case G.Depth:case G.Normal:case G.ObjectAndLayerIdColor:return i(this._passes.materialIntegratedMesh,this._materialPassParameters);case G.Highlight:return i(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const i=new Jse;return this._systems.forEach(r=>bA(i,r.queryShadowCasterDepthRange(e))),i}_updateParameters(e,i,r){const s=e.viewInverseTransposeMatrix;ne($q,s[3],s[7],s[11]),Iq.set($q),ce(i.transformWorldFromViewTH,Iq.high),ce(i.transformWorldFromViewTL,Iq.low),ce(i.slicePlaneLocalOrigin,$q),Xd(i.transformViewFromCameraRelativeRS,e.viewMatrix),vn(i.transformProjFromView,e.projectionMatrix),i.identifier===$l.Material&&(this._materialPassParameters.transparent=r,xT(Yye,i.transformViewFromCameraRelativeRS),aL(i.transformNormalViewFromGlobal,Yye))}};NJ=h([I("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],NJ);const $q=E(),Yye=Gr(),Iq=new JNe;function ZF(t){return t.name}let c$t=class{constructor(e){this._context=e,this._nodes=new Zt}destroy(){this._nodes.forEach(e=>e.destroy()),this._nodes.clear()}add(e){this._nodes.push(e),_z&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}remove(e){this._nodes.remove(e),_z&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}produces(e){return this._nodes.some(({produces:i})=>i===e)}require(e,...i){const r=this._nodes;return i.reduce((s,n)=>s+r.reduce((o,{consumes:a,produces:l})=>o+(a.required.includes(e)&&l===n?1:0),0),0)}optional(e,...i){const r=this._nodes;return i.reduce((s,n)=>s+r.reduce((o,{consumes:a,produces:l})=>{var c;return o+((c=a.optional)!=null&&c.includes(e)&&l===n?1:0)},0),0)}updateAnimation(){return this._nodes.reduce((e,i)=>i.updateAnimation()||e,!1)}render(e,i,r=()=>{}){const s=ZF(e)?e.name:e,n=this._nodes.filter(({produces:o})=>o===s);return n.length===0||(n.forEach(o=>{const a=ZF(e)?[e]:[];for(const l of o.consumes.required){if(l===s)continue;const c=i.get(l);if(!c)return void(r&&r(a));a.push(c)}if(o.consumes.optional)for(const l of o.consumes.optional){if(l===s)continue;const c=i.get(l);c&&a.push(c)}try{const l=o.doRender(a,this._context);l&&l!==e&&(ZF(e)?(e.release(),e=l,i.set(s,e)):e=l)}catch(l){ie.getLogger(o).errorOnce(l)}r&&r(a)}),this._context.rctx.enforceState()),ZF(e)?e:P3}},u$t=class{constructor(e){this._context=e,this._renderPlugins=new Zt,this._materialRenderers=new Map,this._slots=new Array,this._renderVersion=hg(0);for(let i=0;i<_e.MAX_SLOTS;++i)this._slots[i]=[]}destroy(){this._renderPlugins.forEach(e=>e.destroy()),this._renderPlugins.clear(),this._materialRenderers.clear()}get plugins(){return this._renderPlugins}add(e,i){const r=()=>{if(i!=null&&i.aborted)throw e.uninitializeRenderContext(),Di();this._renderPlugins.push(e),e.materialReference&&this._materialRenderers.set(e.materialReference,e),e.produces.forEach((n,o)=>{this._slots[o].push(e)}),this._context.requestRender(),this._renderVersion.value++},s=e.initializeRenderContext(this._context,i);if(Cu(s))return s.then(r);r()}remove(e){if(e.materialReference!=null&&this._materialRenderers.delete(e.materialReference),this._renderPlugins.removeUnordered(e)!=null){for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==e);e.uninitializeRenderContext(),this._context.requestRender(),this._renderVersion.value++}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(e)||i)}),i}renderFeatureChanged(){this._renderPlugins.forAll(e=>{e.renderFeatureChanged&&e.renderFeatureChanged()})}prepare(...e){for(const i of e)this._context.renderContext.bindParameters.slot=i,this._slots[i].forEach(r=>{const s=r.produces.get(i);s!=null&&s(G.Color)&&(ZZ(r)&&r.prepareTechnique(this._context.renderContext),ahe(r)&&r.prepareTechniques(this._context.renderContext))})}_getRenderables(){const e=this._context.renderContext.bindParameters.slot,i=this._context.renderContext.output??G.Color,r=new Map;return this._slots[e].forEach(s=>{const n=s.produces.get(e);if(n!=null&&n(i)&&(!s.isDecoration||this._context.renderContext.bindParameters.decorations!==Nl.OFF))if(ZZ(s)){const o=s.prepareTechnique(this._context.renderContext);o!=null&&r.set(s,o)}else if(ahe(s)){const o=s.prepareTechniques(this._context.renderContext);o!=null&&r.set(s,o)}else r.set(s,null)}),r}render(e,...i){for(const r of i)this._context.renderContext.bindParameters.slot=r,this._getRenderables().forEach((s,n)=>n.renderNode(this._context.renderContext,s,e))}queryDepthRange(e){const i=new Jse;return this._renderPlugins.forAll(r=>{var n;const s=(n=r.queryDepthRange)==null?void 0:n.call(r,e);bA(i,s)}),i}get updating(){return this._renderVersion.value>=0&&this._renderPlugins.some(e=>e.running)}produces(e,...i){for(const r of i)if(this._slots[r].some(s=>{const n=s.produces.get(r);return!!n&&n(e)}))return!0;return!1}consumes(e){return this._renderPlugins.some(i=>i.consumes().required.includes(e))}getMaterialRenderer(e){return this._materialRenderers.get(e)}removeEmptyMaterialRenderers(){this._renderPlugins.filterInPlace(e=>!e.materialReference||e.numGeometries!==0||(this._materialRenderers.delete(e.materialReference),e.destroy(),!1))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get hasOccludees(){return this._renderPlugins.some(e=>e.hasOccludees)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,i)=>e|i.renderOccludedFlags,Ji.None)}get usedMemory(){return this._renderPlugins.reduce((e,i)=>i.materialReference!==null?e:e+(i.usedMemory??0),0)}get test(){}},h$t=class{constructor(e){this.techniques=e,this._blitConfiguration=new bI,this._blitParameters=new Tj}render(e,i,r,s,n){e.bindFramebuffer(r.fbo);const o=this.techniques.acquire(sne,this._blitConfiguration);return e.setClearColor(0,0,0,1),e.clear(Lr.COLOR_BUFFER_BIT),o!=null&&o.compiled?(this._blitParameters.texture=i.getTexture(),e.bindTechnique(o,s,this._blitParameters),e.screen.draw(),o.release(),r):(n(tr.UPDATE),r)}},d$t=class{constructor(){this._step=Jye,this._dilation=1,this._firstIdleTime=0}frame(e,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,re("disable-feature:high-quality-idle"))this._dilation=1;else{const s=i?performance.now()-this._firstIdleTime:0;if(s>=Zye+f$t)return this._step=1/0,void(this._dilation=1);this._dilation=s>=Zye?m$t:1}const r=Te(e/p$t,Jye,y$t);this._step===1/0?this._step=r:this._step=this._step*Xye+r*(1-Xye)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const p$t=.5,Zye=12e4,f$t=1e4,m$t=10,Xye=.9,g$t=30,Jye=1e3/1,y$t=1e3/g$t;let _$t=class{constructor(e,i){this._fbos=e,this.compositingHelper=i,this._width=4,this._height=4,this._clearColor=Qt()}dispose(){this._color=ti(this._color),this.releaseBuffers()}get framebuffer(){return this.color.attachDepth(this.depth),this.color.fbo}get colorTexture(){return this.color.getTexture()}get depthTexture(){return this.depth.attachment}initializeFrame(e,i,r){this._fbos.interactive=r===Zp.Default;const s=this._fbos.rctx;this._width=e.fullWidth,this._height=e.fullHeight,Yx(this,s.parameters.maxTextureSize);const n=this._color;return this._color=null,this.releaseBuffers(),Rd(this._clearColor,i),n}releaseBuffers(){var e;(e=this._color)==null||e.detachDepth(),this._depth=ti(this._depth)}renderHUDVisibility(e,i,r){var s,n;return((s=e==null?void 0:e.fbo)==null?void 0:s.width)===this._width&&((n=e==null?void 0:e.fbo)==null?void 0:n.height)===this._height||(e==null||e.release(),e=this._fbos.acquire(this._width,this._height,"hud visibility",Xr.RGBA4)),e.attachDepth(r||this.depth),this._fbos.rctx.bindFramebuffer(e.fbo),this._fbos.rctx.clearFramebuffer(v$t),i(),e.detachDepth(),e}compositeToHUDVisibility(e,i){var r;this._fbos.rctx.bindFramebuffer((r=e.hudVisibility)==null?void 0:r.fbo),this.compositingHelper.compositeHUD(e,i)}renderOITPass(e,i,r){let s,n;const{_width:o,_height:a}=this;switch(i){case nt.ColorAlpha:s=this._fbos.acquire(o,a,r?"oit hud color alpha":"oit color alpha",Xr.RGBA16F),s.acquireColor(qn.COLOR_ATTACHMENT1,Xr.R16F),n=[0,0,0,1];break;case nt.FrontFace:s=this._fbos.acquire(o,a,r?"oit hud front":"oit front"),n=[0,0,0,0]}return r?s.acquireDepth(Ao.DEPTH16_BUFFER):s.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(s.fbo),this._fbos.rctx.clearFramebuffer(n,r,r),e(),s.detachDepth(),s}compositeToFramebuffer(e,i,r,s){this.bindFbo(),this.compositingHelper.composite(e,i,r,s)}compositeOIT(e,i,r,s){s?(this._fbos.rctx.bindFramebuffer(s.fbo),this._fbos.rctx.setClearColor(0,0,0,1e-13),this._fbos.rctx.clear(Lr.COLOR_BUFFER_BIT)):this.bindFbo(),this.compositingHelper.compositeOIT(e,i.getTexture(),i.getTexture(qn.COLOR_ATTACHMENT1),r.getTexture())}renderDepthDetached(e){this._bindTarget(this.color),e(),this._bindTarget(this.color,this.depth)}renderToCachedFBO(e,i,r,s,n=Xr.RGBA,o=Ao.DEPTH16_BUFFER,a=this._width,l=this._height,c=null){var u,d;return((u=e==null?void 0:e.fbo)==null?void 0:u.width)===a&&((d=e==null?void 0:e.fbo)==null?void 0:d.height)===l||(e=ti(e)),e=e??this._fbos.acquire(a,l,i,n),c==null||c.forEach(p=>e.acquireColor(p.attachment,p.format)),o!=null&&e.acquireDepth(o),this._fbos.rctx.bindFramebuffer(e.fbo),this._fbos.rctx.clearFramebuffer(s,!0,!0),r(),e}renderToTargets(e,i,r,s,n=!1,o=!1){this._bindTarget(i,r),this._fbos.rctx.clearFramebuffer(s,n,o),e(),i.detachDepth()}bindFbo(){const e=this._color==null;if(this._bindTarget(this.color,this.depth),e){const i=this._fbos.rctx;i.setClearStencil(0),i.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),i.clear(Lr.COLOR_BUFFER_BIT|Lr.DEPTH_BUFFER_BIT|Lr.STENCIL_BUFFER_BIT)}}_bindTarget(e,i){e.attachDepth(i),this._fbos.rctx.bindFramebuffer(e.fbo)}get width(){return this._width}get height(){return this._height}get color(){return this._ensureColor()}_ensureColor(){return this._color||(this._color=this._fbos.acquire(this._width,this._height,"composite-color")),this._color}updateColor(e){const i=this._ensureColor();i.attachDepth(this.depth),this._color=e(i)}get depth(){return this._depth||(this._depth=this._fbos.acquireDepth(Ao.DEPTH_STENCIL_TEXTURE,this._width,this._height,"depth")),this._depth}};const v$t=[0,1,0,1];let b$t=class{constructor(){this._inputs=new Map}set(e,i){this._inputs.set(e,i)}get(e){return this._inputs.get(e)}has(e){return this._inputs.has(e)}release(e){var i;(i=this._inputs.get(e))!=null&&i.release()&&this._inputs.delete(e)}};const HL=255,w$t=1/HL;function UFe(t){const e=new Vi,i=e.fragment;return i.include(Uf),i.include(Ig),e.include(OL),e.include(Oa),e.include(IL,t),i.uniforms.add(new mt("shadowMap",(r,s)=>s.shadowMap.depthTexture),new mt("depthMap",(r,s)=>{var n;return(n=s.depth)==null?void 0:n.attachment}),new ss("inverseViewMatrix",(r,s)=>In(Qye,rl(Qye,s.camera.viewMatrix,s.camera.center)))),i.constants.add("sampleValue","float",w$t),e.outputs.add("sampleCount","float"),i.code.add(S`void main(void) {
float depth = depthFromTexture(depthMap, uv);
if (depth >= 1.0 || depth <= 0.0) {
discard;
}
float currentPixelDepth = linearizeDepth(depth);
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMap, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMap);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`),e}const Qye=Ee(),x$t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:HL,build:UFe},Symbol.toStringTag,{value:"Module"}));var xA;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(xA||(xA={}));let FJ=class extends jl{constructor(){super(...arguments),this.visualization=xA.Gradient,this.bandsEnabled=!1}};h([B({count:xA.COUNT})],FJ.prototype,"visualization",void 0),h([B()],FJ.prototype,"bandsEnabled",void 0);let lne=class extends $r{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=sL(S$t),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const S$t=Wt(.01,0,.25,1);function zFe(t){const e=new Vi,i=e.fragment;i.include(Uf),i.include(sie),e.include(OL),e.include(Oa);const{visualization:r,bandsEnabled:s}=t;i.constants.add("inverseSampleValue","float",HL),i.uniforms.add(new mt("shadowCastMap",a=>a.shadowCastMap),new qe("sampleScale",a=>a.sampleScale),new qe("opacityFromElevation",a=>a.opacityFromElevation),new zi("uColor",a=>a.color));const n=r===xA.Gradient,o=r===xA.Threshold;return n&&s?i.uniforms.add(new qe("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new qe("threshold",a=>a.threshold)),i.code.add(S`
    void main(void) {
      float record = texture(shadowCastMap, uv).r;
      float pixelSamples = record * inverseSampleValue;
      if (pixelSamples < 1.0) {
        discard;
      }

      float strength = pixelSamples * sampleScale;

      ${o?S`
          if (strength <= threshold) {
            discard;
          }`:""}

      ${n&&s?S`strength = ceil(strength / bandSize) * bandSize;`:""}

      fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?S`* strength`:""});
    }
  `),e}const T$t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:lne,build:zFe},Symbol.toStringTag,{value:"Module"}));let VFe=class BFe extends Wi{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new Yi(e.rctx,BFe.shader.get().build(this.configuration),wi)}initializePipeline(){return Gt({blending:gu,colorWrite:Kt,depthTest:null,depthWrite:null})}get primitiveType(){return vi.TRIANGLE_STRIP}};VFe.shader=new Bi(T$t,()=>fe(()=>Promise.resolve().then(()=>BUt),void 0));const E$t=4e4,C$t=5e4,GFe=1/512;let mk=class extends Re{constructor(e,i,r,s){super({}),this._techniques=e,this._rctx=i,this._data=r,this._requestRender=s,this._passParameters=new lne(this._data),this._techniqueConfig=new FJ,this._enabled=!1,this._vao=kg(i)}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=It(this._vao),this._techniques.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniques.releaseAndAcquire(VFe,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const i=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(i,e,this._passParameters),this._rctx.drawArrays(i.primitiveType,0,p0(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>GFe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniques.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniques.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const i=this._passParameters.color;BC(e,i)||(Rd(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};h([f()],mk.prototype,"opacityFromElevation",null),mk=h([I("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],mk);let jFe=class HFe extends Wi{constructor(e){super(e,new ine,()=>this.destroy())}initializeProgram(e){return new Yi(e.rctx,HFe.shader.get().build(this.configuration),wi)}initializePipeline(){return Gt({blending:sa(Pe.ONE,Pe.ONE,Pe.ONE,Pe.ONE),colorWrite:Kt,depthTest:null,depthWrite:null})}get primitiveType(){return vi.TRIANGLE_STRIP}};jFe.shader=new Bi(x$t,()=>fe(()=>Promise.resolve().then(()=>GUt),void 0));let lc=class extends Re{constructor(e,i,r,s,n,o){super({}),this.fbos=e,this._stage=r,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new Pre,this._cachedLightDirections=[],this._depthRange=AJ,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new vG(new Zre(e,r.viewingMode),null),this._bindParameters.shadowMap.enabled=!0,this._vao=kg(this._rctx),this._accumulationRenderer=new mk(i,this._rctx,this,o);const a=this._stage.view.resourceController.scheduler;this.addHandles([a.registerTask(Mt.SHADOW_ACCUMULATOR,this),ue(()=>r.renderView,l=>{this.removeHandles(Kye),l!=null&&this.addHandles(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),Kye)},sr),ue(()=>this._previewing,()=>this._requestRenderIfEnabled(),ar)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=It(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=It(this._fbo),this._vao=It(this._vao),this._accumulationTechniqueCached=ti(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new jFe(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._bindParameters.depth!=null&&this._depthRange!==AJ&&this._opacityFromElevation>GFe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const i=this._cachedLightDirections;if(w1(i,e,LS))return;const r=Math.min(HL,e.length);i.length=r,this._sampleCount=r;for(let s=0;s<r;++s)i[s]=ce(i[s]??E(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,i,r,s){if(this._depthRange=i,this._updateCamera(r),this._bindParameters.contentCamera=s,this._bindParameters.depth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return!1;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(M$t,this._sampleCount-this._progress);for(let o=0;o<n;++o)this._accumulateShadow();return this._cameraForcedForScreenshot=!1,this._requestRender(),n>0}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const i=this._fbo!=null;e.enabled!==i&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,i){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||i<0||i>=this._fbo.height?0:(this._fbo.readPixels(e,i,1,1,Ft.RGBA,sl.UNSIGNED_BYTE,e0e),e0e[0]/this._progress)}_enable(){this._progress=0;const e=new jr;e.pixelFormat=Ft.RED,e.internalFormat=gt.R8,e.wrapMode=bi.CLAMP_TO_EDGE,this._fbo=new zg(this._rctx,e),this._requestRender()}_disable(){this._fbo=It(this._fbo),this._requestRender()}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clear(Lr.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,p0(this._vao,"geometry"))}_updateCamera(e){const i=this._fbo;if(i==null)return;const r=this._bindParameters.camera;e.equals(r)||r.copyFrom(e),i.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-FI(E$t,C$t,e.relativeElevation)}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){}};h([f()],lc.prototype,"_progress",void 0),h([f()],lc.prototype,"_sampleCount",void 0),h([f()],lc.prototype,"_fbo",void 0),h([f()],lc.prototype,"_depthRange",void 0),h([f()],lc.prototype,"_previewing",void 0),h([f()],lc.prototype,"_accumulationRenderer",void 0),h([f()],lc.prototype,"_isRefining",null),h([f()],lc.prototype,"_isActive",null),h([f()],lc.prototype,"canAccumulate",null),h([f()],lc.prototype,"_isDoneAccumulating",null),h([f()],lc.prototype,"_opacityFromElevation",null),h([f()],lc.prototype,"running",null),lc=h([I("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],lc);const M$t=6,Kye="renderView",e0e=new Uint8Array(4),t0e=z0();let A$t=class{constructor(){this._plane=z0()}get isEnabled(){return!mTe(this.plane,t0e)}get plane(){return this._plane}set plane(e){bT(e||t0e,this._plane)}},dv=class extends Pr{constructor(){super(...arguments),this.sectionAngles=Qt()}get sectionAnglesDeg(){return HI(this.sectionAngles.map(e=>Ma(e)))}set sectionAnglesDeg(e){this.sectionAngles=HI(e.map(i=>Rt(i)))}get projectionMatrix(){const e=Ee();return jI(e,this.sectionMatrix,this._projectionMatrixInternal)}get sectionMatrix(){const e=this.sectionAngles[0],i=this.sectionAngles[1],r=this.sectionAngles[2],s=this.sectionAngles[3];ft(e<=i),ft(r<=s);const n=2*Math.tan(this.fovX/2),o=2*Math.tan(this.fovY/2),a=Math.tan(e),l=Math.tan(i),c=Math.tan(r),u=l-a,d=Math.tan(s)-c,p=n/u,m=o/d,g=-(a+u/2)/n*2,y=-(c+d/2)/o*2,v=Ee();yT(v,[g,y,0]);const b=Ee();TSe(b,[p,m,1]);const w=Ee();return jI(w,b,v)}get _sectionRatioX(){const e=Math.tan(this.sectionAngles[0]),i=Math.tan(this.sectionAngles[1]),r=2*Math.tan(this.fovX/2);return Math.min(1,(i-e)/r)}setViewport(e,i){const r=i*this._sectionRatioX;return this.viewport=[e[0],e[1],r,i],r}};h([f()],dv.prototype,"sectionAngles",void 0),h([f()],dv.prototype,"sectionAnglesDeg",null),h([f()],dv.prototype,"projectionMatrix",null),h([f()],dv.prototype,"sectionMatrix",null),h([f()],dv.prototype,"_sectionRatioX",null),dv=h([I("esri.views.3d.webgl-engine.lib.ViewshedFaceCamera")],dv);let P$t=class{constructor(){this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.textureSizeMultiple=128,this.toleranceSides=5,this.toleranceBottomTop=10}textureSizeModifier(e){return e?this.textureSizeModHighQuality:this.textureSizeModLowQuality}textureResizeModulo(e){return Math.ceil(e/this.textureSizeMultiple)*this.textureSizeMultiple}};const Lq=["front","left","right","back","top","bottom"];function O$t(t){return!["top","bottom"].includes(t)}let R$t=class{constructor(e){this._fbos=e,this._enabled=!1,this._faces={},this._textureWidth=0,this._textureHeight=0,this.settings=new P$t,this._maxTextureWidth=Math.min(re("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}get depthTexture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}get enabled(){return this._enabled}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get isTextureZero(){return this._textureWidth===0||this._textureHeight===0}get nearFar(){const e=this.faces;return e.length===0?null:e[0].nearFar}get numActiveFaces(){const e=this._faces;let i=0;return Object.keys(e).forEach(r=>{e[r]&&(i+=1)}),i}get faces(){const e=this._faces,i=[];for(const r of Lq){const s=e[r];s&&i.push(s)}return i}get atlasRegions(){return this.faces.map(e=>[e.x/this._textureWidth,(e.x+e.width)/this._textureWidth,e.y/this._textureHeight,(e.y+e.height)/this._textureHeight])}get viewshedProjectionMatrices(){return this.faces.map(e=>e.projectionMatrix)}get viewshedViewMatrices(){return this.faces.map(e=>e.viewMatrix)}_setupFaceCamera(e,i,r,s){const{observerRenderSpace:n,tiltedUpVector:o,targetRenderSpace:a,farDistanceRenderSpace:l,horizontalFieldOfView:c,verticalFieldOfView:u}=i,d=E();Ai(d,a,n);const p=E(),m=E(),g=(k,U)=>{const H=E(),z=Ee();return wu(z,k,U),He(H,d,z),me(H,n,H),H};let y,v=o;const b=Math.min(90,c),w=Math.min(90,Math.max(0,(c-90)/2));let x=-45,T=45,C=-45,M=45;if(O$t(e)){const k=U=>Te(U,-45,45);C=k(-u/2)-this.settings.toleranceBottomTop,M=k(+u/2)+this.settings.toleranceBottomTop}switch(e){case"front":y=a,x=-b/2,T=b/2;break;case"left":y=g(Math.PI/2,o),x=45-w;break;case"right":y=g(-Math.PI/2,o),T=-45+w;break;case"top":y=me(p,n,o),v=ea(m,d);break;case"bottom":y=Ai(p,n,o),v=d;break;case"back":y=g(Math.PI,o)}const O=new dv({center:y,eye:n,up:v,far:l});O.sectionAnglesDeg=[x-this.settings.toleranceSides,T+this.settings.toleranceSides,C,M],O.fovY=Math.PI/2;const D=O.setViewport(r,s);return this._faces[e]=O,D}_bindFBO(){var i;const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer((i=this._handle)==null?void 0:i.fbo)}_computeActiveFaces(e){const i=new Set,{horizontalFieldOfView:r,verticalFieldOfView:s}=e,n=-s/2,o=s/2;return r===0||s===0||(n<=45&&o>=-45&&i.add("front"),r>90&&(i.add("left"),i.add("right")),r>270&&i.add("back"),o>45-this.settings.toleranceBottomTop&&i.add("top"),n<-45+this.settings.toleranceBottomTop&&i.add("bottom")),i}_computeBaseTextureSize(e,i,r,s){const n=Math.min(window.devicePixelRatio,i)/e.pixelRatio,o=this.settings.textureSizeModifier(r),a=c1(Math.floor(Math.max(e.fullWidth,e.fullHeight)*n*o)),l=Math.floor(this._maxTextureWidth/s),c=Math.min(l,a);return BMe(c)}_ensureFBO(){var r,s,n,o,a;const e=this._textureWidth,i=this._textureHeight;((s=(r=this._handle)==null?void 0:r.fbo)==null?void 0:s.width)===e&&((o=(n=this._handle)==null?void 0:n.fbo)==null?void 0:o.height)===i||((a=this._handle)==null||a.release(),this._handle=this._fbos.acquire(e,i,"viewshed shadow map",Xr.RGBA4)),this._handle.acquireDepth(Ao.DEPTH16_BUFFER)}clearFBO(){const e=this._fbos.rctx;this._ensureFBO(),this._bindFBO(),e.setClearColor(1,1,1,1),e.clear(Lr.COLOR_BUFFER_BIT|Lr.DEPTH_BUFFER_BIT)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._handle=ti(this._handle)}start(e,i,r,s){if(this._faces={},!this.enabled)return!1;const n=this._computeActiveFaces(i),o=n.size;if(o===0)return!1;const a=this._computeBaseTextureSize(e,s,r,o);if(a===0)return!1;let l=0,c=0,u=0;return Lq.filter(d=>n.has(d)).forEach(d=>{const p=$$t(d,o);p>c&&(u=Math.max(u,l),l=0),c=p;const m=p*a;l+=this._setupFaceCamera(d,i,[l,m],a)}),u=Math.max(u,l),this._textureWidth=this.settings.textureResizeModulo(u),this._textureHeight=I$t(o)*a,this.clearFBO(),!0}finish(){var e;(e=this._handle)==null||e.detachDepth()}get test(){return{faces:this._faces,faceTypes:Lq}}};function $$t(t,e){if(e<4)return 0;const i=t==="front"||t==="left";return e===4?i?0:1:i||t==="right"?0:1}function I$t(t){return t<4?1:2}let L$t=class extends $r{constructor(){super(...arguments),this.localOrigin=XK()}};function D$t(t){t.include(OL),t.fragment.uniforms.add(new ss("inverseViewMatrix",(e,i)=>{const r=Ee();return rl(r,i.camera.viewMatrix,e.localOrigin),rb(r,r)})),t.fragment.code.add(S`vec4 reconstructLocalPosition(vec2 coord, float linearDepth) {
vec4 cameraSpace = vec4(reconstructPosition(coord, linearDepth), 1.0);
return inverseViewMatrix * cameraSpace;
}`)}let cne=class extends L$t{constructor(){super(...arguments),this.targetVector=[1,0,0],this.upVector=[0,0,1],this.fovs=[45,45],this.headingAndTilt=[0,0],this.shadowMap={depthTexture:null,nearFar:[1,100],numActiveFaces:1,atlasRegions:[[0,0,1,1]]},this.projectionMatrices=Vr.flat(),this.viewMatrices=Vr.flat()}};function qFe(t){const e=new Vi,i=e.fragment;e.include(Oa),e.include(D$t),e.include(hie),i.include(Ig),i.include(Mre),i.uniforms.add(new mt("depthTexture",(s,n)=>{var o;return(o=n.depth)==null?void 0:o.attachment})),i.uniforms.add(new ss("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new ss("inverseViewNormalMatrix",(s,n)=>rb(N$t,n.camera.viewInverseTransposeMatrix))),i.uniforms.add(new Vt("viewshedTargetVector",(s,n)=>s.targetVector),new Vt("viewshedUpVector",(s,n)=>s.upVector),new Fr("viewshedFOVs",(s,n)=>s.fovs),new Fr("viewshedHeadingAndTilt",(s,n)=>s.headingAndTilt),new Fr("viewshedNearFar",(s,n)=>s.shadowMap.nearFar??[1,100])),i.uniforms.add(new mt("viewshedShadowMap",s=>s.shadowMap.depthTexture),new wX("viewshedProjectionMatrices",(s,n)=>s.projectionMatrices,6),new wX("viewshedViewMatrices",(s,n)=>s.viewMatrices,6),new eP("viewshedNumFaces",(s,n)=>s.shadowMap.numActiveFaces),new Fl("viewshedAtlasRegions",(s,n)=>s.shadowMap.atlasRegions.flat(),24)),i.constants.add("visibleColor","vec4",[0,1,0,.5]),i.constants.add("occludedColor","vec4",[1,0,0,.5]);const r=t.useNormalMap;return r?(i.uniforms.add(new mt("normalMap",(s,n)=>s.normalTexture)),i.code.add(S`vec3 normalFromTexture() {
vec4 norm4 = texture(normalMap, uv);
vec3 nNormal = vec3(-1.0) + 2.0 * norm4.xyz;
return normalize((inverseViewNormalMatrix * vec4(nNormal, 1.0)).xyz);
}`)):e.include(hFe),i.code.add(S`
    // UV coordinates of point projected onto viewshed shadow map
    vec2 getViewshedUv(vec4 worldPosition, int face) {
      mat4 viewshedMatrix = viewshedProjectionMatrices[face];
      vec4 viewshedUv4 = viewshedMatrix * worldPosition;
      vec3 viewshedUv = viewshedUv4.xyz / viewshedUv4.w;
      return viewshedUv.xy;
    }

    float viewshedDepthToFloat(float depth) {
      return (depth - viewshedNearFar[0]) / (viewshedNearFar[1] - viewshedNearFar[0]);
    }

    // Orthographic depth to viewshed of given point and given cube map face in range [0, 1].
    float getOrthographicDepthToViewshed(vec4 worldPosition, int face) {
      mat4 viewshedViewMatrix = viewshedViewMatrices[face];
      vec4 viewshedUv4 = viewshedViewMatrix * worldPosition;
      vec3 viewshedUv = viewshedUv4.xyz / viewshedUv4.w;
      float depth = -viewshedUv.z;
      return viewshedDepthToFloat(depth);
    }

    // Read depth from shadow map given uv and cube map face
    float getDepthFromShadowMap(vec2 uv, int face) {
      int index = 4 * face;

      float umin = viewshedAtlasRegions[index];
      float umax = viewshedAtlasRegions[index + 1];
      float vmin = viewshedAtlasRegions[index + 2];
      float vmax = viewshedAtlasRegions[index + 3];

      vec4 atlasRegion = vec4(umin, vmin, umax, vmax);
      return rgba4ToFloat(textureAtlasLookup(viewshedShadowMap, uv, atlasRegion));
    }

    struct ViewshedPoint {
      int face;
      vec2 uv;
      bool isWithin;
      float orthographicDepth;
    };

    // Find cube map face the given position lies in and return relevant information about it
    bool getViewshedPoint(vec4 worldPosition, out ViewshedPoint point) {
      vec3 nUp = normalize(viewshedUpVector);

      // Try with all active cube map faces
      for(int i=0; i < viewshedNumFaces; i++) {

        // Check if when projected, point lies within shadow map texture
        vec2 viewshedUv = getViewshedUv(worldPosition, i);
        if (viewshedUv.x > 0.0 && viewshedUv.x < 1.0 && viewshedUv.y > 0.0 && viewshedUv.y < 1.0) {
          float orthoDepth = getOrthographicDepthToViewshed(worldPosition, i);
          if (orthoDepth >= 0.0) { // found a cube map face

            // Check whether point is really inside viewshed geometry, not just within the camera frustum

            // outside farDistance
            vec3 position = worldPosition.xyz;
            bool isWithin = length(position) <= viewshedNearFar[1];

            // horizontally outside fov
            float t = dot(nUp, position);
            bool isBottomHalf = t > 0.0;
            vec3 nProjVector = normalize(position - t * nUp);
            if (isWithin) {
              float angle = acos(dot(normalize(viewshedTargetVector), nProjVector));
              if (angle > viewshedFOVs[0] / 2.0) {
                isWithin = false;
              }
            }

            // vertically outside fov
            if (isWithin) {
              float angle = acos(dot(nProjVector, normalize(position)));
              if (!isBottomHalf) {
                angle = -angle;
              }
              float tilt = viewshedHeadingAndTilt[1];
              float limit = viewshedFOVs[1] / 2.0;
              if (angle > limit || angle < -limit) {
                isWithin = false;
              }
            }

            point = ViewshedPoint(i, viewshedUv, isWithin, orthoDepth);
            return true;
          }
        }
      }

      // no cube face matches
      return false;
    }

    float normalCosAngle(float linearDepth, vec3 localPosition) {
      ${r?S`vec3 normal = normalFromTexture();`:S`
        vec3 cameraSpacePosition = reconstructPosition(gl_FragCoord.xy, linearDepth);
        vec3 normal = normalFromDepth(depthTexture, cameraSpacePosition, gl_FragCoord.xy, uv);
        normal = (inverseViewNormalMatrix * vec4(normal, 1.0)).xyz;
        `};

      vec3 viewingDir = normalize(localPosition);
      return dot(normal, viewingDir);
    }

    void main() {
      float depth = depthFromTexture(depthTexture, uv);

      // Outside camera planes
      if (depth >= 1.0 || depth <= 0.0) {
        return;
      }

      float linearDepth = linearizeDepth(depth);

      // Relative to viewshed position
      vec4 localPosition = reconstructLocalPosition(gl_FragCoord.xy, linearDepth);

      ViewshedPoint point;
      bool foundFace = getViewshedPoint(localPosition, point);

      // Outside every viewshed
      if (!foundFace || !point.isWithin) {
        return;
      }

      float viewshedDepth = getDepthFromShadowMap(point.uv, point.face);
      float distance = point.orthographicDepth;

      bool visible = distance < viewshedDepth;
      fragColor = visible ? visibleColor : occludedColor;

      float cosAngle = normalCosAngle(linearDepth, localPosition.xyz);

      // Everything facing away, and close to parallel is considered occluded.
      // Theshold corresponds to around 0.6 degrees, tuned empirically.
      if (cosAngle > -0.01) {
        fragColor = occludedColor;
      }
    }`),e}const N$t=Ee(),F$t=Object.freeze(Object.defineProperty({__proto__:null,ViewshedPassParameters:cne,build:qFe},Symbol.toStringTag,{value:"Module"}));let WFe=class YFe extends Wi{initializeProgram(e){return new Yi(e.rctx,YFe.shader.get().build(this.configuration),wi)}initializePipeline(){return Gt({colorWrite:Kt,blending:gu})}};WFe.shader=new Bi(F$t,()=>fe(()=>Promise.resolve().then(()=>jUt),void 0));let ZFe=class extends jl{constructor(){super(...arguments),this.useNormalMap=!0}};h([B()],ZFe.prototype,"useNormalMap",void 0);let ox=class extends Lie{get viewshedShadowMap(){return this._viewshedShadowMap}get enabled(){return this._viewsheds.length>0}constructor(e,i){super(e),this._pluginContext=null,this.renderHighQuality=!1,this._parameters=new cne,this._configuration=new ZFe,this._viewsheds=new tt,this.produces=new Map([[_e.VIEWSHED,()=>!0]]),this._renderShadowMap=i}initialize(){this.addHandles(ue(()=>this.view.qualitySettings.maximumPixelRatio,e=>this._maximumPixelRatio=e,sr))}destroy(){this.uninitializeRenderContext()}consumes(){return this.enabled?Iie:OG}initializeRenderContext(e){this._pluginContext=e,this._viewshedShadowMap=new R$t(this.fboCache),this._viewshedShadowMap.enabled=!0}renderNode(e,i,r){var a,l,c;const{bindParameters:s,rctx:n}=e;if(!this.enabled||!s.depth||r==null)return;const o=this._setupNormals(r);if(this._technique!=null&&this._configuration.useNormalMap===o||(this._configuration.useNormalMap=o,this._technique=(a=this._pluginContext)==null?void 0:a.techniques.acquire(WFe,this._configuration)),(l=this._technique)==null?void 0:l.compiled)for(const u of this._viewsheds){const d=e.rctx.getBoundFramebufferObject(),p=this._renderViewshedShadowCubeMap(s,u),m=this._viewshedShadowMap;p&&m.depthTexture!=null&&!m.isTextureZero&&(this._setPassParameters(u),e.rctx.bindFramebuffer(d),n.bindTechnique(this._technique,s,this._parameters),n.screen.draw())}else(c=this._pluginContext)==null||c.requestRender()}uninitializeRenderContext(){this._pluginContext=null,this._viewshedShadowMap.dispose(),this._technique=Le(this._technique)}updateViewsheds(e){const i=e.removes;i!=null&&(tt.isCollection(i)?this._viewsheds.removeMany(i):this._viewsheds.remove(i));const r=e.adds;if(r!=null)if(tt.isCollection(r)){const s=r.filter(n=>!this._viewsheds.includes(n));this._viewsheds.addMany(s)}else this._viewsheds.includes(r)||this._viewsheds.add(r)}_renderViewshedShadowCubeMap(e,i){const r=this._viewshedShadowMap;if(!r.enabled)return!1;const s=r.start(e.camera,i,this.renderHighQuality,this._maximumPixelRatio);if(s)for(const n of r.faces)this._renderShadowMap(e,n,G.ViewshedShadow);return r.finish(),s}_setPassParameters(e){const i=this._parameters,r=this._viewshedShadowMap,s=e.observerRenderSpace;i.localOrigin=s,i.fovs=[Rt(e.horizontalFieldOfView),Rt(e.verticalFieldOfView)],i.headingAndTilt=[Rt(e.heading),Rt(e.tiltParallelToSurface)],i.upVector=e.tiltedUpVector;const n=k$t(e.targetRenderSpace,s);i.targetVector=n,i.shadowMap=r;const o=[],a=[];for(let l=0;l<r.numActiveFaces;l++)rl(Dq,r.viewshedViewMatrices[l],s),o.push(...Dq.flat()),U$t(r.viewshedProjectionMatrices[l],Dq,i0e),a.push(...i0e.flat());i.viewMatrices=o,i.projectionMatrices=a}_setupNormals(e){const i=e.get("normals"),r=i==null?void 0:i.getTexture();return this._parameters.normalTexture=r,r!=null}get test(){return{viewsheds:this._viewsheds}}};function k$t(t,e){const i=E();return Ai(i,t,e)}function U$t(t,e,i){const r=$e(.5,.5,.5);return yT(i,r),rL(i,i,r),jI(i,i,t),jI(i,i,e),i}h([f()],ox.prototype,"_pluginContext",void 0),h([f()],ox.prototype,"fboCache",void 0),h([f()],ox.prototype,"view",void 0),h([f()],ox.prototype,"viewshedShadowMap",null),ox=h([I("esri.views.3d.webgl-engine.lib.Viewshed")],ox);const Dq=Ee(),i0e=Ee();let r0e=class{constructor(e,i,r,s,n,o,a,l,c){this.createQuery=e,this.deleteQuery=i,this.resultAvailable=r,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},Ay=!1;function z$t(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i?new r0e(()=>t.createQuery(),r=>{t.deleteQuery(r),Ay=!1},r=>t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE),r=>t.getQueryParameter(r,t.QUERY_RESULT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{Ay||(Ay=!0,t.beginQuery(i.TIME_ELAPSED_EXT,r))},()=>{t.endQuery(i.TIME_ELAPSED_EXT),Ay=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=t.getExtension("EXT_disjoint_timer_query"),i?new r0e(()=>i.createQueryEXT(),r=>{i.deleteQueryEXT(r),Ay=!1},r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{Ay||(Ay=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,r))},()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),Ay=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function V$t(t,e){const i=t.capabilities.disjointTimerQuery;return i==null?null:new B$t(i,e)}let B$t=class{constructor(e,i){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(r,null)})}start(){Ay||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const i=this._queryResults.get(e);if(i==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var Os;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.DEPTH="depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.NORMALS="normals",t.SSAO="SSAO",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.OPAQUE_ENVIRONMENT="opaque environment",t.TRANSPARENT_ENVIRONMENT="transparent environment",t.LASER_LINES="laser lines",t.VIEWSHED="viewshed",t.OCCLUDED="occluded",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(Os||(Os={}));const Nq=Object.values(Vv).concat(Object.values(eS)).concat(Object.values(Os)),s0e="Total";let G$t=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new r0(s0e),this._cpuTimeSamplers=new Map(Nq.map(i=>[i,new r0(i)])),this._enableGPUTimer=0,this._totalGPUTime=new r0("GPU"),this._gpuTimeSamplers=new Map(Nq.map(i=>[i,new r0(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const i=[...Nq,s0e];this._gpuTimerPool=V$t(this._rctx,i)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=It(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&this._gpuTimerPool.start()}advance(e){const i=performance.now();if(this._cpuTimeSamplers.get(e).record(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,this._gpuTimerPool){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(r),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const i=this._gpuTimerPool.stop(Os.FINISH);this._gpuTimeSamplers.get(Os.FINISH).record(i),this._rctx.gl.flush()}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}};class gk{constructor(e,i,r,s,n,o){this._stage=e,this._techniques=r,this._rctx=s,this._compositingHelper=n,this._requestRender=o,this._pluginsHas={hudElements:!1,water:!1},this._hasOverlayWater=!1,this.renderOverlay=a=>{},this._isRendering=!1,this._inGlobeView=!1,this._backgroundColor=Wt(0,0,0,1),this._sliceHelper=new A$t,this._blit=null,this._state=hg(Mi.IDLE),this._highQualityTransparencyEnabled=!0,this._terrainTransparency=ja.Opaque,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new d$t,this._loadEdgeViewTask=null,this._edgeViewCallbacks=[],this._reprojectionMatrixVersion=hg(0),this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new b$t,this._releaseNormals=a=>{a.some(({name:l})=>l==="normals")&&this._pluginInput.release("normals")},this._debugNeedsDepth=!1,this.fboCache=new l$t(s),this._renderStateFeatures=hg(jhe(!re("disable-feature:high-quality-idle"),e.view.qualityProfile)),this._offscreen=new _$t(this.fboCache,this._compositingHelper),this.performanceInfo=new G$t(this._rctx),this._shadowMap=new Zre(this.fboCache,e.viewingMode),this._viewshed=new ox({fboCache:this.fboCache,view:e.view},(a,l,c)=>{l.setGLViewport(this._rctx);const{camera:u,contentCamera:d}=a;this._ensureBindParametersCamera(l,l),this._renderAllGeometry(c),this._ensureBindParametersCamera(u,d),a.camera.setGLViewport(this._rctx)}),this._shadowAccumulator=new lc(this.fboCache,r,e,a=>{const l=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureBindParametersCamera(a.camera,a.contentCamera),this._plugins.prepareRender(),this._shadowMap.enabled=l},(a,l,c)=>{const u=this._stage.view.qualitySettings.maximumPixelRatio;a.shadowMap.start(a.camera,l,c,!0,u),this._renderShadowCascades(G.Shadow,a.shadowMap),a.shadowMap.finish(),a.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(a.camera,a.contentCamera)},o),this._renderContext=new _gt(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper),this._nodes=new c$t(this._renderContext),this._plugins=new u$t({renderContext:this._renderContext,techniques:r,materials:i,requestRender:o,controller:e,fbos:this.fboCache,isFeatureEnabled:a=>this.isFeatureEnabled(a)}),this.renderPassManager=new NJ,this._plugins.add(this.renderPassManager),this._plugins.add(this._viewshed),this._handles=[ue(()=>this._stage.view.state.camera,()=>o(),sr),ue(()=>Rr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,a=>{this._renderHiddenTransparentEdges=a?()=>this._renderEdges(ch.TRANSPARENT):()=>{},o()},cr),ue(()=>{var a;return(a=this._stage.view.environment.background)==null?void 0:a.color},a=>{const l=a?i3(a):wh;ds(this._backgroundColor,l[0]*l[3],l[1]*l[3],l[2]*l[3],l[3]),o()},sr),ue(()=>this._stage.view.state.camera.relativeElevation,a=>{this._inGlobeView=(a??1/0)>=Jz},sr)]}destroy(){this._handles.forEach(e=>e.remove()),this._gpuTimerHandle=Or(this._gpuTimerHandle),this._nodes.destroy(),this._offscreen.dispose(),this._shadowMap.dispose(),this._shadowAccumulator.dispose(),this._loadEdgeViewTask=Ul(this._loadEdgeViewTask),this._edgeView=Le(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),this._plugins.destroy(),XAe.prune()}get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(e=null,i=!re("disable-feature:high-quality-idle")){this._renderStateFeatures.value=jhe(i,e),this._plugins.renderFeatureChanged(),this._requestRender()}isFeatureEnabled(e,i=this._state.value){return this._renderStateFeatures.value.get(i,e)??!1}setFeatureEnabled(e,i,r){this._renderStateFeatures.mutate(s=>s.set(i,e,r)),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Ws.HighQualityTransparency)}get hasReflections(){return(this._pluginsHas.water||this._hasOverlayWater)&&(this._ssrEnabled||this.isFeatureEnabled(Ws.WaterReflection))}get hasDecorations(){return this._plugins.hasDecorations||this._nodes.produces("magnifier-color")}get hasHighlights(){return this._plugins.produces(G.Highlight,_e.OPAQUE_MATERIAL,_e.TRANSPARENT_MATERIAL,_e.DRAPED_MATERIAL)}get hasLaserlines(){return this._plugins.produces(this._renderContext.output,_e.LASERLINES,_e.LASERLINES_CONTRAST_CONTROL)}get hasSSAO(){return(this._stage.view.qualitySettings.ambientOcclusion||this.isFeatureEnabled(Ws.SSAO))&&!this._inGlobeView}get hasSMAA(){return this._stage.view.qualitySettings.antialiasingEnabled||this.isFeatureEnabled(Ws.Antialiasing)}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(Ws.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=ti(this._bindParameters.ssr.lastFrameColor),this._bindParameters.multipassTerrain.depth=ti(this._bindParameters.multipassTerrain.depth),this._bindParameters.multipassGeometry.depth=ti(this._bindParameters.multipassGeometry.depth)}_disposeOffscreenBuffers(){this._offscreen.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._viewshed.viewshedShadowMap.disposeOffscreenBuffers(),this._bindParameters.depth=ti(this._bindParameters.depth),this._bindParameters.hudVisibility=ti(this._bindParameters.hudVisibility)}get updating(){return this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}loadEdgeView(){return this._loadEdgeViewTask||(this._loadEdgeViewTask=Nf(async e=>{const{EdgeView:i}=await fe(()=>import("./EdgeView-DlHlhVNn.js"),__vite__mapDeps([194,195,71,27]));Et(e);const r=this._edgeView=new i({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniques:this._techniques,setNeedsRender:()=>this._requestRender(),schedule:j$t(this._stage.view.resourceController)});return this._handles.push(ue(()=>r.updating,()=>this._requestRender(),ar)),this._requestRender(),this._edgeViewCallbacks.forEach(s=>s(r)),this._edgeViewCallbacks.length=0,r})),this._loadEdgeViewTask.promise}withEdgeView(e){this.loadEdgeView(),this._edgeView==null?this._edgeViewCallbacks.push(e):e(this._edgeView)}get edgeView(){return this._edgeView}get isCameraFinal(){return this._reprojectionMatrixVersion.value>=0&&RB(this._bindParameters.ssr.reprojectionMatrix,Vr)}set _reprojectionMatrix(e){Qve(this._bindParameters.ssr.reprojectionMatrix,e)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setParameters(e){var s;const{_shadowMap:i,_bindParameters:r}=this;if(((s=e.qualitySettings)==null?void 0:s.reflections)!==void 0&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&i.maxCascades!==e.shadowMapMaxCascades&&(i.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.environment!=null){e.environment.weather!=null&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible);const n=e.environment.lighting.type!=="virtual";r.enableFillLights!==n&&(r.enableFillLights=n,this._requestRender())}e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.terrainTransparency!==void 0&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),e.shadowCast!==void 0&&this._shadowAccumulator.setOptions(e.shadowCast)}get hasSlicePlane(){return!!this._sliceHelper.plane}get plugins(){return this._plugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,i){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:s,updates:n}=e;if(r.length===0&&s.length===0&&n.length===0)return;const o=gAe(e);let a=!1;o.forEach((l,c)=>{if(i.done)return;let u=this._plugins.getMaterialRenderer(c);if(u==null&&l.adds.length>0){const d=new aI({material:c});d.initializeRenderContext(this._plugins._context),u=d,this._plugins.add(u)}u&&(u.modify(l),u.numGeometries===0&&(a=!0)),l.removes.forEach(d=>e.removes.removeUnordered(d)),l.adds.forEach(d=>e.adds.removeUnordered(d)),l.updates.forEach(d=>e.updates.removeUnordered(d)),i.madeProgress()}),a&&this._plugins.removeEmptyMaterialRenderers(),this._updateHasFlags(),this._requestRender()}_updateHasFlags(){const e=this._pluginsHas;e.hudElements=this._plugins.produces(G.Color,_e.LINE_CALLOUTS_HUD_DEPTH,_e.HUD_MATERIAL,_e.LABEL_MATERIAL),e.water=this._plugins.produces(G.Normal,_e.DRAPED_WATER),this._bindParameters.hasOccludees=this._plugins.hasOccludees}updateAnimation(e){const i=this._hasAnimations;return this._hasAnimations=this._plugins.updateAnimation(e),this._hasAnimations=this._nodes.updateAnimation()||this._hasAnimations,this._hasAnimations!==i&&(this._gpuTimerHandle=i?Or(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(e,i,r=Zp.Default,s=Nl.ON){var Z,q,Y,de;this._isRendering=!0,this.performanceInfo.startFrame(),this.fboCache.frameStart(),this._disposeBindBuffers();const n=this._offscreen,{camera:o,contentCamera:a,mode:l,alignPixelEnabled:c}=e;this._state.value=l,this._bindParameters.overlay=this.renderOverlay(i),this._bindParameters.overlay&&this.performanceInfo.advance(Os.OVERLAY),this._renderContext.time=i,this._bindParameters.transparencyPassType=nt.NONE,this._bindParameters.alignPixelEnabled=c,this._bindParameters.decorations=s,this._bindParameters.mainColor=this._bindParameters.mainDepth=null,this._bindParameters.viewshedEnabled=this._viewshed.enabled;const u=this._nodes.produces("magnifier-color"),d=this._nodes.produces("final-color"),p=z0(this._sliceHelper.plane);s===Nl.OFF&&(this._sliceHelper.plane=null),o.setGLViewport(this._rctx);const m=n.initializeFrame(o,this._backgroundColor,r);this.hasReflections?this._bindParameters.ssr.lastFrameColor=m:m==null||m.release(),this._ensureBindParametersCamera(o,a),this._plugins.prepareRender(),this._bindParameters.shadowHighlightsVisible=this._needsShadowHighlight&&s===Nl.ON;const g=this._plugins.produces(G.Color,_e.OPAQUE_TERRAIN)&&(this._terrainTransparency===ja.Semitransparent||this._terrainTransparency===ja.TransparentWithDraped),y=this._highQualityTransparency&&g,v=this._plugins.produces(G.Color,...XF);this._prepareShaders(y,v),this.performanceInfo.advance(Os.PREPARE);const b=this._computeDepthRange(o);this._renderShadowMap(o,this._bindParameters.lighting.mainLight.direction,b),this._ensureBindParametersCamera(o,a);let w=this._renderNormals();if(this._pluginInput.set("normals",w),w){let L=null;this._needsDepth&&(L=w.getAttachment(eA),L==null||L.retain()),this._pluginInput.set("ssao",this._renderSSAO()),this._renderNoSSAOGeometryDepth(L),w=null}else this._renderAllGeometryDepth();this._renderShadowAccumulation(b,o,a),this._ensureBindParametersSSR(i),this._renderContext.output=G.Color,n.bindFbo(),this._bindParameters.mainColor=n.colorTexture,this._bindParameters.mainDepth=n.depthTexture;const x=this.plugins.produces(G.Color,...Fq);x&&this._renderOpaqueGeometry(),this._offscreen.updateColor(L=>this._renderNodes(Vv.OPAQUE,L,x)),(q=(Z=this.fboCache).debugCallback)==null||q.call(Z,"opaque-color",this._offscreen.color.fbo),this._renderPlugins(_e.OPAQUE_ENVIRONMENT,Os.OPAQUE_ENVIRONMENT),this._renderMultipassTerrainDepth(y),this._setMultipassTerrain(y),this._renderEdges(ch.OPAQUE),n.bindFbo(),this._renderPlugins(_e.VOXEL,Os.VOXEL),this._renderHiddenTransparentEdges(),v&&(this._oitEnabled?this._renderOITPass(MC.Geometry):this._renderTransparentMaterial()),this._offscreen.updateColor(L=>this._renderNodes(Vv.TRANSPARENT,L,v)),(de=(Y=this.fboCache).debugCallback)==null||de.call(Y,"transparent-color",this._offscreen.color.fbo),this._renderMultipassGeometryDepth(y),this._renderHUDVisibility(),y||this._plugins.render(this._pluginInput,_e.LINE_CALLOUTS);const T=r===Zp.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;this._renderEdges(ch.TRANSPARENT);const C=g?this._renderTransparentTerrain():null;C&&(this.performanceInfo.advance(Os.TRANSPARENT_TERRAIN),this._bindParameters.hudVisibility&&(y?this._renderLineCallouts(fc.Occluded):n.compositeToHUDVisibility(this._bindParameters,C.getTexture()),this._renderHUD(fc.Occluded,n.color))),this._setTerrainCulling(!1),C&&(n.compositeToFramebuffer(this._bindParameters,C.getTexture(),cu.PremultipliedAlpha,1),C.release(),y&&(this._renderEdges(ch.OPAQUE),v&&(this._oitEnabled?this._renderOITPass(MC.Geometry):this._renderTransparentMaterial(),this.performanceInfo.advance(Os.TRANSPARENT)),this._renderEdges(ch.TRANSPARENT))),this._bindParameters.ssao=ti(this._bindParameters.ssao),y&&this._renderLineCallouts(fc.NotOccluded),this._setMultipassEnabled(!1),this._renderTransparentEnvironment(),this._renderViewshed(),this._renderLaserlines(),this._renderOccluded(),this._pluginInput.set("highlights",this._renderHighlightPrepass()),this._offscreen.updateColor(L=>this._renderNodes(Vv.COMPOSITE,L));const M=this._nodes.produces("aa-color"),O=!(r!==Zp.Default||d||u&&s===Nl.ON&&r===Zp.Default),D=this._pluginInput.get("composite-color"),k=O?P3:this.fboCache.acquire(D.fbo.width,D.fbo.height,"aa-color"),U=M?this._renderNodes(eS.ANTIALIASING,k):this._blitToDefault(D,k,!1);this._pluginInput.set(eS.ANTIALIASING,U),this._renderHUD(fc.NotOccluded,U);const H=this._renderNodes(eS.HIGHLIGHTS,U);let z=this._renderNodes(eS.MAGNIFIER,H);return u&&s===Nl.ON&&r===Zp.Default&&!d&&(z=this._blitToDefault(z)),d?(z.attachDepth(n.depth),this._blitToDefault(this._renderNodes(Vv.FINAL,z)),z.detachDepth()):this._pluginInput.set(Vv.FINAL,z),this._pluginInput.release("highlights"),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),this._offscreen.releaseBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=p,this._isRendering=!1,this.fboCache.frameEnd(),this.performanceInfo.finishFrame(),r!==Zp.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers()),{screen:this._pluginInput.get("final-color"),oid:T}}_prepareShaders(e,i){this._renderContext.output=G.Color,this._prepareOpaqueGeometry(),this._setMultipassTerrain(e),this._plugins.prepare(_e.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),e||this._plugins.prepare(_e.LINE_CALLOUTS),i&&this._prepareTransparencySlots(),this._plugins.prepare(_e.VIEWSHED,_e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,_e.TRANSPARENT_ENVIRONMENT,_e.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(){if(!re("enable-feature:objectAndLayerId-rendering"))return;const e=this._renderContext.output,i=this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oid");return i.acquireDepth(Ao.DEPTH_STENCIL_TEXTURE),this._rctx.bindFramebuffer(i.fbo),this.fboCache.rctx.clearFramebuffer([0,0,0,0],!0,!0),this._renderAllGeometry(G.ObjectAndLayerIdColor),this._rctx.bindFramebuffer(i.fbo),this.fboCache.rctx.clearFramebuffer(void 0,!0,!0),this._bindParameters.hudRenderStyle=fc.NotOccluded,this._plugins.render(this._pluginInput,_e.HUD_MATERIAL),this._renderContext.output=e,this.performanceInfo.advance(Os.OBJECT_AND_LAYER_ID_COLOR),i}finish(e){this._hasAnimations||this._animationTimestep.clear();const i=this.performanceInfo.gpuSamplingEnabled,r=e===tr.BACKGROUND;if(r||i){const s=r?this.performanceInfo.elapsedTime:0,n=i?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),o=Math.max(s,n);this._animationTimestep.frame(o,r)}}readDepthPixels(e,i){var o;if(!this._bindParameters.mainDepth)return;const{width:r,height:s}=this._offscreen,n=this.fboCache.acquire(r,s,"linear-depth");this._rctx.bindFramebuffer(n.fbo),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.clearFramebuffer([0,0,0,0],!0,!0),this._compositingHelper.blitDepthToLinearDepth(this._bindParameters,this._bindParameters.mainDepth),(o=n.fbo)==null||o.readPixels(e[0],e[1],e[2],e[3],Ft.RGBA,sl.UNSIGNED_BYTE,i),n.release()}readHUDVisibility(e,i,r,s,n){var o,a;(a=(o=this._bindParameters.hudVisibility)==null?void 0:o.fbo)==null||a.readPixels(e,i,r,s,Ft.RGBA,sl.UNSIGNED_BYTE,n)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassTerrain(e){this._setMultipassEnabled(e),this._setTerrainCulling(e)}_setMultipassEnabled(e){this._bindParameters.multipassEnabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderEdges(e){const i=this._edgeView;if(!(i!=null&&i.shouldRender()))return;const{width:r,height:s,depth:n}=this._offscreen,o=this.fboCache.acquire(r,s,"edges"),a=()=>i.render(this._bindParameters,e),l=this._bindParameters.multipassGeometry.depth;this._offscreen.renderToTargets(a,o,l??n,o0e),this._offscreen.compositeToFramebuffer(this._bindParameters,o.getTexture(),cu.Alpha,1),o.release(),this.performanceInfo.advance(e===ch.OPAQUE?Os.OPAQUE_EDGES:Os.TRANSPARENT_EDGES)}_renderShadowMap(e,i,r){const s=this._shadowMap;s.enabled&&(s.start(e,i,r,this.isFeatureEnabled(Ws.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._needsShadowHighlight?(this._renderShadowCascades(G.ShadowHighlight,this._shadowMap),s.moveSnapshot(oT.Highlight),this._renderShadowCascades(G.ShadowExcludeHighlight,this._shadowMap),s.copySnapshot(oT.ExcludeHighlight),this._renderShadowCascades(G.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(G.Shadow),s.finish(),e.setGLViewport(this._rctx),this.performanceInfo.advance(Os.SHADOW_MAP))}_renderShadowCascades(e,i=this._shadowMap){for(const r of i.cascades)r.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(r.camera,r.camera),this._renderAllGeometry(e)}get _needsDepth(){return this._plugins.consumes(G.Depth)||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast||this._debugNeedsDepth}_renderNoSSAOGeometryDepth(e){if(!this._needsDepth||!e)return void(this._bindParameters.depth=ti(this._bindParameters.depth));const{width:i,height:r}=this._offscreen,s=this.fboCache.acquire(i,r,"depth");s.attachDepth(e),e.release(),this._rctx.bindFramebuffer(s.fbo),this._rctx.clearFramebuffer(void 0,!1,!0),this._renderGeometryExcludedFromSSAO(G.Depth),ti(this._bindParameters.depth),this._bindParameters.depth=s.obtainDepthTexture(),s.release(),this.performanceInfo.advance(Os.DEPTH)}_renderAllGeometryDepth(){if(!this._needsDepth)return void(this._bindParameters.depth=ti(this._bindParameters.depth));const{width:e,height:i}=this._offscreen,r=this.fboCache.acquire(e,i,"depth").acquireDepth(Ao.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderAllGeometry(G.Depth),ti(this._bindParameters.depth),this._bindParameters.depth=r.obtainDepthTexture(),r.release(),this.performanceInfo.advance(Os.DEPTH)}_renderMultipassTerrainDepth(e){if(!e)return void(this._bindParameters.multipassTerrain.depth=ti(this._bindParameters.multipassTerrain.depth));const i=this._renderContext.output;this._renderContext.output=G.Depth;const{width:r,height:s}=this._offscreen,n=this.fboCache.acquire(r,s,"terrain depth").acquireDepth(Ao.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(n.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderTransparentTerrain(),ti(this._bindParameters.multipassTerrain.depth),this._bindParameters.multipassTerrain.depth=n.obtainDepthTexture(),this._renderContext.output=i,n.release()}_renderMultipassGeometryDepth(e){if(!e)return void(this._bindParameters.multipassGeometry.depth=ti(this._bindParameters.multipassGeometry.depth));const i=this._renderContext.output,{width:r,height:s}=this._offscreen,n=this.fboCache.acquire(r,s,"geometry depth").acquireDepth(Ao.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(n.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderOpaqueGeometryAndTransparentMaterial(G.Depth),this._renderContext.output=i,ti(this._bindParameters.multipassGeometry.depth),this._bindParameters.multipassGeometry.depth=n.obtainDepthTexture(),n.release()}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return AJ;const i=ZRt(e,this._plugins.plugins,this._stage.layers);return bA(i,this._plugins.queryDepthRange(e)),i.near=Math.max(e.near,i.near),i.far=Math.min(e.far,i.far),i}_renderNormals(){const e=this._nodes.require("normals","final-color","composite-color","opaque-color","transparent-color"),i=(this.hasSSAO?1:0)+(this.hasLaserlines?1:0)+e;if(i===0)return;const r=this._offscreen.renderToCachedFBO(null,"normals",()=>this._renderGeometryForSSAO(G.Normal),[0,0,0,0],Xr.RGBA,Ao.DEPTH_STENCIL_TEXTURE),s=this._nodes.optional("normals","final-color","composite-color","opaque-color","transparent-color")+(this._viewshedEnabled?1:0);return r.retain(i+s-1),this.performanceInfo.advance(Os.NORMALS),r}_renderSSAO(){const e=this._pluginInput.get("normals");if(!this.hasSSAO||!e)return void(e==null?void 0:e.detachDepth());const i=this._nodes.render("ssao",this._pluginInput);return this._bindParameters.ssao=i,e.detachDepth(),this._pluginInput.release("normals"),this.performanceInfo.advance(Os.SSAO),i}_renderAllGeometry(e){this._renderContext.output=e,this._plugins.prepare(_e.TRANSPARENT_TERRAIN),this._renderOpaqueGeometryAndTransparentMaterial(e),this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(e){this._renderContext.output=e,this._plugins.prepare(_e.TRANSPARENT_MATERIAL,_e.TRANSPARENT_NO_SSAO_DEPTH),this._renderOpaqueGeometry(),this._renderTransparentMaterial()}_renderGeometryForSSAO(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,_e.INTEGRATED_MESH,_e.OPAQUE_TERRAIN,_e.OPAQUE_MATERIAL,_e.TRANSPARENT_MATERIAL),this._renderTransparentTerrain()}_renderGeometryExcludedFromSSAO(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,_e.OPAQUE_NO_SSAO_DEPTH,_e.TRANSPARENT_NO_SSAO_DEPTH)}_prepareOpaqueGeometry(){this._plugins.prepare(...Fq,_e.OPAQUE_ENVIRONMENT)}_renderOpaqueGeometry(){this._plugins.render(this._pluginInput,...Fq)}_renderTransparentMaterial(){this._plugins.render(this._pluginInput,...XF)}_renderTransparentTerrain(){const e=this._renderContext.output;if(!this._plugins.produces(e,_e.TRANSPARENT_TERRAIN))return;const i=()=>this._plugins.render(this._pluginInput,_e.TRANSPARENT_TERRAIN);if(e!==G.Color)return void i();const{width:r,height:s,depth:n}=this._offscreen,o=this.fboCache.acquire(r,s,"transparent terrain");return this._offscreen.renderToTargets(i,o,n,[0,0,0,0]),o}_renderHUDVisibility(){this._plugins.produces(this._renderContext.output,_e.OCCLUSION_PIXELS)?(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,()=>this._plugins.render(this._pluginInput,_e.OCCLUSION_PIXELS),this._bindParameters.multipassGeometry.depth),this._offscreen.bindFbo(),this.performanceInfo.advance(Os.HUD_VISIBILITY)):this._bindParameters.hudVisibility=ti(this._bindParameters.hudVisibility)}_renderLineCallouts(e){if(this._bindParameters.hudRenderStyle=e,e===fc.Occluded){const i=()=>this._plugins.render(this._pluginInput,_e.LINE_CALLOUTS),{width:r,height:s,color:n}=this._offscreen,o=this.fboCache.acquireDepth(Ao.DEPTH16_BUFFER,r,s,"line callouts");this._offscreen.renderToTargets(i,n,o,void 0,!0,!0),o.release()}else this._plugins.render(this._pluginInput,_e.LINE_CALLOUTS)}_renderLaserlines(){if(this.hasLaserlines){if(this._plugins.render(this._pluginInput,_e.LASERLINES),this._plugins.produces(this._renderContext.output,_e.LASERLINES_CONTRAST_CONTROL)){const e=this._offscreen,{width:i,height:r,depth:s}=e,n=this.fboCache.acquire(i,r,"laser lines"),o=()=>this._plugins.render(this._pluginInput,_e.LASERLINES_CONTRAST_CONTROL);e.renderToTargets(o,n,s,o0e),e.compositeToFramebuffer(this._bindParameters,n.getTexture(),cu.PremultipliedAlpha,1),n.release()}this._pluginInput.release("normals"),this.performanceInfo.advance(Os.LASER_LINES)}}_renderHUD(e,i){if(this._pluginsHas.hudElements){if(this._oitEnabled){const r=this._renderOITPass(MC.HUD,e);this._rctx.bindFramebuffer(i.fbo),this._compositingHelper.composite(this._bindParameters,r.getTexture(),cu.PremultipliedAlpha),r.release()}else if(e===fc.Occluded){this._renderContext.output=G.Color;const r=()=>this._renderHUDElements(e),{width:s,height:n,color:o}=this._offscreen,a=this.fboCache.acquireDepth(Ao.DEPTH16_BUFFER,s,n,"hud");this._offscreen.renderToTargets(r,o,a,void 0,!0,!0),a.release()}else this._renderContext.output=G.Color,i.acquireDepth(Ao.DEPTH16_BUFFER),this._rctx.bindFramebuffer(i.fbo),this._renderHUDElements(e),i.detachDepth();this.performanceInfo.advance(e===fc.Occluded?Os.HUD_OCCLUDED:Os.HUD)}}_renderHUDElements(e){this._bindParameters.hudRenderStyle=e,this._plugins.prepare(_e.LINE_CALLOUTS_HUD_DEPTH,_e.HUD_MATERIAL,_e.LABEL_MATERIAL),this._plugins.render(this._pluginInput,_e.LINE_CALLOUTS_HUD_DEPTH,_e.HUD_MATERIAL,_e.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._plugins.produces(G.ShadowHighlight,_e.OPAQUE_MATERIAL)}_renderHighlightPrepass(){if(!this.hasHighlights)return;const e=()=>{this._renderAllGeometry(G.Highlight),this._rctx.clear(Lr.DEPTH_BUFFER_BIT),this._renderHUDElements(fc.Both)},i=this._offscreen.renderToCachedFBO(null,"highlights",e,[0,0,0,0],Xr.RGBA4,Ao.DEPTH_STENCIL_TEXTURE);return i.detachDepth(),i}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(e,i,r){this._needsShadowCast&&this._bindParameters.depth&&this._shadowAccumulator.renderAccumulation(this._bindParameters.depth,e,i,r)&&this.performanceInfo.advance(Os.ACCUMULATED_SHADOWS)}_prepareTransparencySlots(){this._renderContext.output=G.Color,this._bindParameters.transparencyPassType=nt.ColorAlpha,this._plugins.prepare(...XF),this._bindParameters.transparencyPassType=nt.FrontFace,this._plugins.prepare(...XF),this._bindParameters.transparencyPassType=nt.NONE,this._techniques.acquire(ane).release()}_renderOITPass(e,i=fc.Both){const r=e===MC.HUD,s=r?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oit hud composite"):null,n=r?()=>this._renderHUDElements(i):()=>this._renderTransparentMaterial(),o=this._renderContext.output;this._renderContext.output=G.Color,this._bindParameters.transparencyPassType=nt.ColorAlpha;const a=this._offscreen.renderOITPass(n,nt.ColorAlpha,r);this._bindParameters.transparencyPassType=nt.FrontFace;const l=this._offscreen.renderOITPass(n,nt.FrontFace,r);return this._offscreen.compositeOIT(this._bindParameters,a,l,s),s==null||s.detachDepth(),l.release(),a.release(),this._bindParameters.transparencyPassType=nt.NONE,this._renderContext.output=o,s}_renderOccluded(){let e=0;Fu.clear(),this._plugins.plugins.forAll(l=>{l.materialReference&&l.queryRenderOccludedState(Ji.OccludeAndTransparentStencil)&&(e|=Ji.OccludeAndTransparentStencil,Fu.push(l))});const i=this._offscreen,r=(l,c,u,d,p)=>{if(!(e&c))return;const{width:m,height:g,depth:y}=i,v=this.fboCache.acquire(m,g,"tmp color");i.renderToTargets(u,v,y,[0,0,0,0],d,p),i.compositeToFramebuffer(this._bindParameters,v.getTexture(),cu.PremultipliedAlpha,l),v.release()},s=(l,c)=>{this._bindParameters.slot=l,c.forAll(u=>{if(ZZ(u)){const d=u.prepareTechnique(this._renderContext);d&&u.renderNode(this._renderContext,d)}})};Fu.length!==0&&(s(_e.OCCLUDER_MATERIAL,Fu),r(.5,Ji.OccludeAndTransparentStencil,()=>s(_e.TRANSPARENT_OCCLUDER_MATERIAL,Fu),!1,!1));const n=Fu.length>0;Fu.clear(),this._plugins.plugins.forAll(l=>{if(!l.materialReference)return;const c=l.queryRenderOccludedState(Ji.OccludeAndTransparent),u=l.queryRenderOccludedState(Ji.Transparent),d=l.queryRenderOccludedState(Ji.Opaque);(c||u||d)&&(e|=c?Ji.OccludeAndTransparent:u?Ji.Transparent:Ji.Opaque,Fu.push(l))});const o=this._plugins.renderOccludedFlags;if(e|=o,!e)return;const a=l=>{this._renderContext.renderOccludedMask=l,o>Ji.Occlude&&this._plugins.render(this._pluginInput,_e.OCCLUDED_TERRAIN),s(_e.OPAQUE_MATERIAL,Fu),s(_e.TRANSPARENT_MATERIAL,Fu),s(_e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Fu),this._renderContext.renderOccludedMask=nV};this._renderContext.output=G.Color,r(.5,Ji.OccludeAndTransparent,()=>a(Ji.OccludeAndTransparent),!0,Tc.OutlineVisualElementMask),r(.5,Ji.Transparent,()=>a(Ji.Transparent),!0,Tc.OutlineVisualElementMask),r(1,Ji.Opaque,()=>a(Ji.Opaque),!0,Tc.OutlineVisualElementMask),(n||Fu.length>0)&&this.performanceInfo.advance(Os.OCCLUDED),Fu.clear()}_renderTransparentEnvironment(){this._shadowAccumulator.render(this._bindParameters),this._offscreen.bindFbo(),this._plugins.render(this._pluginInput,_e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,_e.TRANSPARENT_ENVIRONMENT),this.performanceInfo.advance(Os.TRANSPARENT_ENVIRONMENT)}_renderViewshed(){this._viewshedEnabled&&(this._viewshed.renderHighQuality=this.isFeatureEnabled(Ws.HighResolutionViewshed),this._plugins.render(this._pluginInput,_e.VIEWSHED),this._pluginInput.release("normals"),this.performanceInfo.advance(Os.VIEWSHED))}_renderPlugins(e,i){this._plugins.produces(this._renderContext.output,e)&&(this._plugins.render(this._pluginInput,e),this.performanceInfo.advance(i))}_renderNodes(e,i,r=!1){if(!this._nodes.produces(e))return r&&this.performanceInfo.advance(e),i;i.setName(e),this._pluginInput.set(e,i);const s=this._nodes.render(i,this._pluginInput,this._releaseNormals);return this.performanceInfo.advance(e),s}_blitToDefault(e,i=P3,r=!0){this._blit||(this._blit=new h$t(this._techniques));const s=this._blit.render(this._rctx,e,i,this._bindParameters,this._requestRender);return this._pluginInput.set(e.name,s),r&&e.release(),s}_ensureBindParametersCamera(e,i){this._bindParameters.camera=e,this._bindParameters.contentCamera=i}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Vr:(In(l0e,this._bindParameters.camera.viewMatrix),In(a0e,this._bindParameters.camera.projectionMatrix),dr(j2,l0e,a0e),dr(j2,this._renderContext.lastFrameCamera.viewMatrix,j2),dr(j2,this._renderContext.lastFrameCamera.projectionMatrix,j2),this._reprojectionMatrix=j2);const i=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=i>0?Math.min(i,e-this._ssrEnableTime)/i:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=Vr,this._ssrEnableTime=null}addRenderNode(e){this._nodes.add(e),this._requestRender()}removeRenderNode(e){this._nodes.remove(e),this._requestRender()}get usedMemory(){var e;return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:((e=this.edgeView)==null?void 0:e.usedMemory)??0}}get _viewshedEnabled(){return this._viewshed.enabled&&this._plugins.produces(this._renderContext.output,_e.VIEWSHED)}get test(){}}var MC,n0e;h([f({readOnly:!0})],gk.prototype,"fullResolutionAtmosphere",null),h([f()],gk.prototype,"_edgeView",void 0),h([f()],gk.prototype,"updating",null),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(MC||(MC={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.ShadowMap=2]="ShadowMap",t[t.HudVisibility=3]="HudVisibility",t[t.ViewshedShadowMap=4]="ViewshedShadowMap"}(n0e||(n0e={}));const o0e=[0,0,0,0],Fq=[_e.INTEGRATED_MESH,_e.OPAQUE_TERRAIN,_e.OPAQUE_MATERIAL,_e.OPAQUE_NO_SSAO_DEPTH],XF=[_e.TRANSPARENT_MATERIAL,_e.TRANSPARENT_NO_SSAO_DEPTH],Fu=new Zt,a0e=Ee(),l0e=Ee(),j2=Ee();function j$t(t){return e=>t.immediate.schedule(e)}let H$t=class{constructor(e){this._rctx=e,this._vao=q$t(e)}destroy(){this._vao=It(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(vi.TRIANGLES,0,3))}get test(){}};function q$t(t,e=oie,i=wi){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new Fg(t,i,{geometry:e},{geometry:vr.createVertex(t,rr.STATIC_DRAW,r)})}let XFe=class JFe{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=JFe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return vr.createIndex(this._rctx,rr.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,Tt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(vi.POINTS,1,Me.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){}},c0e=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Pe.ONE,dstRGB:Pe.ZERO,srcAlpha:Pe.ONE,dstAlpha:Pe.ZERO},this.blendEquation={mode:M0.ADD,modeAlpha:M0.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=cf.BACK,this.frontFace=KM.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=fr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:cf.FRONT_AND_BACK,func:fr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:cf.FRONT_AND_BACK,fail:fs.KEEP,zFail:fs.KEEP,zPass:fs.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.drawBuffers={defaultFramebuffer:[ao.BACK],fbos:new WeakMap},this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},W$t=class{constructor(){for(this._current=new Array,this._allocations=null;this._current.length<nn.COUNT;)this._current.push(0)}increment(e,i,r=1){var s;this._current[e]+=r,(s=this._allocations)==null||s.add(i)}decrement(e,i,r=1){var s;this._current[e]-=r,(s=this._allocations)==null||s.remove(i)}get current(){return this._current}get total(){return this.current.reduce((e,i,r)=>e+(r<nn.UNCOUNTED?i:0),0)}get resourceInformation(){var i;let e="";if(this.total>0){e+=`Live objects:
`;for(let r=0;r<nn.COUNT;++r){const s=this._current[r];s>0&&(e+=`${nn[r]}: ${s}
`)}}return e+=(i=this._allocations)==null?void 0:i.resetLog(),e}},Y$t=class{constructor(e,i,r){const s=i.textureFilterAnisotropic,n=r.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=s?Math.min(e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES),this.maxDrawBuffers=e.getParameter(e.MAX_DRAW_BUFFERS)}};const Z$t=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var u0e,QFe={exports:{}};(u0e=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(QFe.exports=u0e);const X$t=wL(QFe.exports);var h0e,KFe={exports:{}};h0e=KFe,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(h0e.exports=e)}();const d0e=wL(KFe.exports);var e4e={exports:{}};(function(t){(function(e){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();i!==void 0&&(t.exports=i)})()})(e4e);const J$t=wL(e4e.exports);var yp=999,p0e=9999,kq=0,Uq=1,f0e=2,m0e=3,g0e=4,JF=5,Q$t=6,K$t=7,eIt=8,y0e=9,tIt=10,_0e=11,iIt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function rIt(){var t,e,i,r=0,s=0,n=yp,o=[],a=[],l=1,c=0,u=0,d=!1,p=!1,m="";return function(z){return a=[],z!==null?y(z.replace?z.replace(/\r\n/g,`
`):z):v()};function g(z){z.length&&a.push({type:iIt[n],data:z,position:u,line:l,column:c})}function y(z){var Z;for(r=0,i=(m+=z).length;t=m[r],r<i;){switch(Z=r,n){case kq:r=C();break;case Uq:r=T();break;case f0e:r=x();break;case m0e:r=M();break;case g0e:r=k();break;case _0e:r=D();break;case JF:r=U();break;case p0e:r=H();break;case y0e:r=w();break;case yp:r=b()}Z!==r&&(m[Z]===`
`?(c=0,++l):++c)}return s+=r,m=m.slice(r),a}function v(z){return o.length&&g(o.join("")),n=tIt,g("(eof)"),a}function b(){return o=o.length?[]:o,e==="/"&&t==="*"?(u=s+r-1,n=kq,e=t,r+1):e==="/"&&t==="/"?(u=s+r-1,n=Uq,e=t,r+1):t==="#"?(n=f0e,u=s+r,r):/\s/.test(t)?(n=y0e,u=s+r,r):(d=/\d/.test(t),p=/[^\w_]/.test(t),u=s+r,n=d?g0e:p?m0e:p0e,r)}function w(){return/[^\s]/g.test(t)?(g(o.join("")),n=yp,r):(o.push(t),e=t,r+1)}function x(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,r+1):(g(o.join("")),n=yp,r)}function T(){return x()}function C(){return t==="/"&&e==="*"?(o.push(t),g(o.join("")),n=yp,r+1):(o.push(t),e=t,r+1)}function M(){if(e==="."&&/\d/.test(t))return n=JF,r;if(e==="/"&&t==="*")return n=kq,r;if(e==="/"&&t==="/")return n=Uq,r;if(t==="."&&o.length){for(;O(o););return n=JF,r}if(t===";"||t===")"||t==="("){if(o.length)for(;O(o););return g(t),n=yp,r+1}var z=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||z){for(;O(o););return n=yp,r}return o.push(t),e=t,r+1}function O(z){for(var Z,q,Y=0;;){if(Z=d0e.indexOf(z.slice(0,z.length+Y).join("")),q=d0e[Z],Z===-1){if(Y--+z.length>0)continue;q=z.slice(0,1).join("")}return g(q),u+=q.length,(o=o.slice(q.length)).length}}function D(){return/[^a-fA-F0-9]/.test(t)?(g(o.join("")),n=yp,r):(o.push(t),e=t,r+1)}function k(){return t==="."||/[eE]/.test(t)?(o.push(t),n=JF,e=t,r+1):t==="x"&&o.length===1&&o[0]==="0"?(n=_0e,o.push(t),e=t,r+1):/[^\d]/.test(t)?(g(o.join("")),n=yp,r):(o.push(t),e=t,r+1)}function U(){return t==="f"&&(o.push(t),e=t,r+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,r+1):/[^\d]/.test(t)?(g(o.join("")),n=yp,r):(o.push(t),e=t,r+1)}function H(){if(/[^\d\w_]/.test(t)){var z=o.join("");return n=X$t.indexOf(z)>-1?eIt:J$t.indexOf(z)>-1?K$t:Q$t,g(o.join("")),n=yp,r}return o.push(t),e=t,r+1}}function sIt(t){var e=rIt(),i=[];return i=(i=i.concat(e(t))).concat(e(null))}function nIt(t){return sIt(t)}function oIt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const zq=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function aIt(t,e="100",i="300 es"){const r=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const o=n[1].replaceAll(/\s{2,}/g," ");if(o===i)return o;if(o===e)return s.data="#version "+i,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function lIt(t,e){for(let i=e-1;i>=0;i--){const r=t[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function a$(t,e,i,r){r=r||i;for(const s of t)if(s.type==="ident"&&s.data===i)return r in e?e[r]++:e[r]=0,a$(t,e,r+"_"+e[r],r);return i}function t4e(t,e,i="afterVersion"){function r(l,c){for(let u=c;u<l.length;u++){const d=l[u];if(d.type==="operator"&&d.data===";")return u}return null}function s(l){let c=-1,u=0,d=-1;for(let p=0;p<l.length;p++){const m=l[p];if(m.type==="preprocessor"&&(/#(if|ifdef|ifndef)\s+.+/.test(m.data)?++u:/#endif\s*.*/.test(m.data)&&--u),i!=="afterVersion"&&i!=="afterPrecision"||m.type==="preprocessor"&&m.data.startsWith("#version")&&(d=Math.max(d,p)),i==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const g=r(l,p);if(g===null)throw new Error("precision statement not followed by any semicolons!");d=Math.max(d,g)}c<d&&u===0&&(c=p)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=s(t);o(a-1)&&t.splice(a++,0,n);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,n)}function cIt(t,e,i,r="lowp"){t4e(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function uIt(t,e,i,r,s="lowp"){t4e(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function hIt(t,e){let i,r,s=-1;for(let n=e;n<t.length;n++){const o=t[n];if(o.type==="operator"&&(o.data==="["&&(i=n),o.data==="]")){r=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return i&&r&&t.splice(i,r-i+1),s}function v0e(t,e){if(t.startsWith("#version 300"))return t;const i=nIt(t);if(aIt(i,"100","300 es")==="300 es")return t;let r=null,s=null;const n={},o={};for(let a=0;a<i.length;++a){const l=i[a];switch(l.type){case"keyword":e===lh.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===lh.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===lh.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(r||(r=a$(i,n,"fragColor"),cIt(i,r,"vec4")),l.data=r),e===lh.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=hIt(i,a+1),u=a$(i,n,"fragData");uIt(i,u,"vec4",c,"mediump"),l.data=u}else e===lh.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(s||(s=a$(i,n,"gl_FragDepth")),l.data=s);break;case"ident":if(Z$t.includes(l.data)){if(e===lh.VERTEX_SHADER&&lIt(i,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=a$(i,n,l.data)),l.data=o[l.data]}}}for(let a=i.length-1;a>=0;--a){const l=i[a];if(l.type==="preprocessor"){const c=l.data.match(/#extension\s+(.*):/);if(c!=null&&c[1]&&zq.has(c[1].trim())){const p=i[a+1];i.splice(a,p&&p.type==="whitespace"?2:1)}const u=l.data.match(/#ifdef\s+(.*)/);u!=null&&u[1]&&zq.has(u[1].trim())&&(l.data="#if 1");const d=l.data.match(/#ifndef\s+(.*)/);d!=null&&d[1]&&zq.has(d[1].trim())&&(l.data="#if 0")}}return dIt(t,oIt(i))}function dIt(t,e){return e}const pIt=4294967295;let fIt=class{constructor(e,i,r,s,n=new Map,o=[]){var c;this._context=e,this._locations=s,this._uniformBlockBindings=n,this._transformFeedbackVaryings=o,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),i=v0e(i,lh.VERTEX_SHADER),r=v0e(r,lh.FRAGMENT_SHADER),this._vShader=b0e(this._context,lh.VERTEX_SHADER,i),this._fShader=b0e(this._context,lh.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(nn.Shader,this),ZY()&&(this.vertexShader=i,this.fragmentShader=r),this.usedMemory=i.length+r.length;const a=this._context.gl,l=a.createProgram();a.attachShader(l,this._vShader),a.attachShader(l,this._fShader),this._locations.forEach((u,d)=>a.bindAttribLocation(l,u,d)),(c=this._transformFeedbackVaryings)!=null&&c.length&&a.transformFeedbackVaryings(l,this._transformFeedbackVaryings,a.SEPARATE_ATTRIBS),a.linkProgram(l),ZY()&&!a.getProgramParameter(l,a.LINK_STATUS)&&console.error(`Could not link shader
validated: ${a.getProgramParameter(l,a.VALIDATE_STATUS)}, gl error ${a.getError()}, vertex: ${a.getShaderParameter(this._vShader,a.COMPILE_STATUS)}, fragment: ${a.getShaderParameter(this._fShader,a.COMPILE_STATUS)}, info log: ${a.getProgramInfoLog(l)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[u,d]of this._uniformBlockBindings){const p=a.getUniformBlockIndex(l,u);p<pIt&&a.uniformBlockBinding(l,p,d)}this._glName=l,this._context.instanceCounter.increment(nn.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get hasTransformFeedbackVaryings(){var e;return!!((e=this._transformFeedbackVaryings)!=null&&e.length)}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,i=this._context.instanceCounter;this._nameToUniformLocation.forEach(r=>r&&i.decrement(nn.Uniform,r)),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(i.decrement(nn.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,i.decrement(nn.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,i.decrement(nn.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const i=this._nameToUniformLocation.get(e);if(i!==void 0)return i;if(this.glName){const r=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,r),r&&this._context.instanceCounter.increment(nn.Uniform,r),r}return null}hasUniform(e){return this._getUniformLocation(e)!=null}setUniform1i(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1iv(e,i){cm(this._nameToUniform1v,e,i)&&this._context.gl.uniform1iv(this._getUniformLocation(e),i)}setUniform2iv(e,i){cm(this._nameToUniform2,e,i)&&this._context.gl.uniform2iv(this._getUniformLocation(e),i)}setUniform3iv(e,i){cm(this._nameToUniform3,e,i)&&this._context.gl.uniform3iv(this._getUniformLocation(e),i)}setUniform4iv(e,i){cm(this._nameToUniform4,e,i)&&this._context.gl.uniform4iv(this._getUniformLocation(e),i)}setUniform1f(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1fv(e,i){cm(this._nameToUniform1v,e,i)&&this._context.gl.uniform1fv(this._getUniformLocation(e),i)}setUniform2f(e,i,r){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),this._nameToUniform2.set(e,[i,r])):i===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),s[0]=i,s[1]=r)}setUniform2fv(e,i){cm(this._nameToUniform2,e,i)&&this._context.gl.uniform2fv(this._getUniformLocation(e),i)}setUniform3f(e,i,r,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),this._nameToUniform3.set(e,[i,r,s])):i===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),n[0]=i,n[1]=r,n[2]=s)}setUniform3fv(e,i){const r=this._getUniformLocation(e);r!=null&&cm(this._nameToUniform3,e,i)&&this._context.gl.uniform3fv(r,i)}setUniform4f(e,i,r,s,n){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),this._nameToUniform4.set(e,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(e,i){const r=this._getUniformLocation(e);r!=null&&cm(this._nameToUniform4,e,i)&&this._context.gl.uniform4fv(r,i)}setUniformMatrix3fv(e,i,r=!1){const s=this._getUniformLocation(e);s!=null&&cm(this._nameToUniformMatrix3,e,i)&&this._context.gl.uniformMatrix3fv(s,r,i)}setUniformMatrix4fv(e,i,r=!1){const s=this._getUniformLocation(e);s!=null&&cm(this._nameToUniformMatrix4,e,i)&&this._context.gl.uniformMatrix4fv(s,r,i)}stop(){}};function b0e(t,e,i){const r=t.gl,s=r.createShader(e);return r.shaderSource(s,i),r.compileShader(s),ZY()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===lh.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(mIt(i))),s}function mIt(t){let e=2;return t.replaceAll(`
`,()=>`
`+gIt(e++)+":")}function gIt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function cm(t,e,i){const r=t.get(e);if(!r)return t.set(e,Array.from(i)),!0;const s=i.length;if(r.length!==s)return t.set(e,Array.from(i)),!0;for(let n=0;n<s;++n){const o=i[n];if(r[n]!==o){for(r[n]=o;n<s;++n)r[n]=i[n];return!0}}return!1}let yIt=class{constructor(e){this._rctx=e,this._store=new q1}dispose(){this._store.forEach(e=>e.forEach(i=>i.dispose())),this._store.clear()}acquire(e,i,r,s){const n=this._store.get(e,i);if(n!=null)return n.ref(),n;const o=new fIt(this._rctx,e,i,r,s);return o.ref(),this._store.set(e,i,o),o}get test(){}},Ej=class{constructor(){this._result=!1}dispose(){this._program=It(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},_It=class extends Ej{constructor(e){super(),this._rctx=e,this._helperProgram=null,re("mac")&&re("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){var e;super.dispose(),(e=this._helperProgram)==null||e.dispose(),this._helperProgram=null}_test(e){const i=this._rctx,r=i.getBoundFramebufferObject(),{x:s,y:n,width:o,height:a}=i.getViewport();i.resetState();const l=new jr(1);l.wrapMode=bi.CLAMP_TO_EDGE,l.samplingMode=ii.NEAREST;const c=new zg(i,l),u=vr.createIndex(this._rctx,rr.STATIC_DRAW,new Uint8Array([0]));i.bindFramebuffer(c),i.setViewport(0,0,1,1),i.useProgram(this._helperProgram),i.bindBuffer(u,Tt.ELEMENT_ARRAY_BUFFER),i.drawElements(vi.POINTS,1,Me.UNSIGNED_BYTE,0),i.useProgram(e),i.bindVAO(null),i.drawArrays(vi.TRIANGLES,0,258);const d=new Uint8Array(4);return c.readPixels(0,0,1,1,Ft.RGBA,sl.UNSIGNED_BYTE,d),i.setViewport(s,n,o,a),i.bindFramebuffer(r),c.dispose(),u.dispose(),d[0]===255}_prepareProgram(){const i=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${S.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${S.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(i,r,new Map([]))}_prepareHelperProgram(){const e=XFe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},vIt=class extends Ej{constructor(e){super(),this._rctx=e,this._program=w0e(this._rctx,!1),this._obfuscated=w0e(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=It(this._obfuscated)}_test(e){if(re("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const i=this._rctx,r=i.getBoundFramebufferObject(),{x:s,y:n,width:o,height:a}=i.getViewport(),l=this._runProgram(e),c=this._runProgram(this._obfuscated);return i.setViewport(s,n,o,a),i.bindFramebuffer(r),l!==0&&(c===0||l/c>5)}_runProgram(e){const i=this._rctx;i.resetState();const r=new jr(1);r.wrapMode=bi.CLAMP_TO_EDGE,r.samplingMode=ii.NEAREST;const s=new zg(i,r),n=vr.createVertex(i,rr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Of(i,new Map([["position",0]]),{geometry:[new bs("position",2,Me.UNSIGNED_SHORT,0,4)]},{geometry:n}),a=$e(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=$e(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);sZ(a,c,3);const u=new Float32Array(6);sZ(l,u,3),i.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",u[0],u[2],u[4]),e.setUniform3f("u_lowB",u[1],u[3],u[5]),i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(vi.TRIANGLE_STRIP,0,4);const d=new Uint8Array(4);s.readPixels(0,0,1,1,Ft.RGBA,sl.UNSIGNED_BYTE,d),o.dispose(),s.dispose();const p=(a[2]-l[2])/25,m=vre(d);return Math.abs(p-m)}};function w0e(t,e){const i=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `;return t.programCache.acquire(i,`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,new Map([["position",0]]))}let bIt=class extends Ej{constructor(e){var s,n;if(super(),this._rctx=e,!e.gl||!((s=e.capabilities.colorBufferFloat)!=null&&s.textureFloat&&((n=e.capabilities.colorBufferFloat)!=null&&n.floatBlend)))return;const i=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new jr(1);r.wrapMode=bi.CLAMP_TO_EDGE,r.dataType=sl.FLOAT,r.internalFormat=gt.RGBA32F,r.samplingMode=ii.NEAREST;const s=new zg(i,r),n=vr.createVertex(i,rr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Of(i,new Map([["a_pos",0]]),{geometry:[new bs("a_pos",2,Me.UNSIGNED_SHORT,0,4)]},{geometry:n});i.gl.getError(),i.useProgram(e);const a=i.getBoundFramebufferObject(),{x:l,y:c,width:u,height:d}=i.getViewport();i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(vi.TRIANGLE_STRIP,0,4);const p=Gt({blending:Ah(Pe.ZERO,Pe.ONE_MINUS_SRC_ALPHA)});i.setPipelineState(p),i.drawArrays(vi.TRIANGLE_STRIP,0,4);const m=i.gl.getError();return i.setViewport(l,c,u,d),i.bindFramebuffer(a),o.dispose(),s.dispose(),m!==i.gl.INVALID_OPERATION||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}};new bs("a_pos",2,Me.BYTE,0,2);new bs("a_pos",2,Me.BYTE,0,4),new bs("a_tex",2,Me.BYTE,2,4);const wIt={geometry:[new bs("a_pos",2,Me.UNSIGNED_SHORT,0,4)]};let xIt=class extends Ej{constructor(e){super(),this._rctx=e;const i=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const i=this._rctx;if(!i.gl)return e.dispose(),!0;const r=new jr(1);r.wrapMode=bi.CLAMP_TO_EDGE,r.samplingMode=ii.NEAREST;const s=new zg(i,r),n=vr.createVertex(i,rr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Of(i,new Map([["a_pos",0]]),wIt,{geometry:n}),a=new jr;a.samplingMode=ii.LINEAR,a.wrapMode=bi.CLAMP_TO_EDGE;const l=new br(i,a,l$);i.useProgram(e),i.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=i.getBoundFramebufferObject(),{x:u,y:d,width:p,height:m}=i.getViewport();i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.setClearColor(0,0,0,0),i.setBlendingEnabled(!1),i.clear(Lr.COLOR_BUFFER_BIT),i.bindVAO(o),i.drawArrays(vi.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);return s.readPixels(0,0,1,1,Ft.RGBA,sl.UNSIGNED_BYTE,g),o.dispose(),s.dispose(),l.dispose(),i.setViewport(u,d,p,m),i.bindFramebuffer(c),g[0]!==255}};const l$=new Image;l$.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",l$.width=5,l$.height=5,l$.decode();let SIt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new bIt(e),this.svgPremultipliesAlpha=new xIt(e),this.doublePrecisionRequiresObfuscation=new vIt(e),this.drawArraysRequiresIndicesTypeReset=new _It(e)}dispose(){this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function TIt(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function EIt(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function CIt(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function MIt(t,e){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}function AIt(t,e,i,r,s){if(e[i])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function PIt(t,e){if(e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function OIt(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}let RIt=class{constructor(e,i){this._gl=e,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get compressedTextureETC(){return this._compressedTextureETC??(this._compressedTextureETC=TIt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC??(this._compressedTextureS3TC=EIt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic??(this._textureFilterAnisotropic=CIt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery??(this._disjointTimerQuery=z$t(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get colorBufferFloat(){return this._colorBufferFloat??(this._colorBufferFloat=MIt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get loseContext(){return this._loseContext??(this._loseContext=OIt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16??(this._textureNorm16=PIt(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear??(this._textureFloatLinear=AIt(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},$It=class{constructor(e,i){this.gl=e,this.instanceCounter=new W$t,this.programCache=new yIt(this),this._transformFeedbackRequestInfo=null,this._state=new c0e,this._numOfDrawCalls=0,this._numOfTriangles=0,this._loadExtensions(),this.configure(i)}configure(e){this._capabilities=new RIt(this.gl,e),this._parameters=new Y$t(this.gl,this._capabilities,e),br.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new c0e,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new Vit({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)},setDrawBuffers:r=>{if(r)this.setDrawBuffers(r.buffers);else{const{drawFramebuffer:s}=this._state;s===null?this.setDrawBuffers([ao.BACK]):s.colorAttachments.length===0?this.setDrawBuffers([ao.NONE]):this.setDrawBuffers([qn.COLOR_ATTACHMENT0])}}}),this.enforceState(),It(this._driverTest),this._driverTest=new SIt(this)}dispose(){It(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Tt.ARRAY_BUFFER),this.unbindBuffer(Tt.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(Tt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Tt.PIXEL_PACK_BUFFER),this.unbindBuffer(Tt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Tt.COPY_READ_BUFFER),this.unbindBuffer(Tt.COPY_WRITE_BUFFER),this._state.textureUnitMap.length=0,Gp()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,i){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,i,r,s){e===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,i,r,s),this._state.blendColor.r=e,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,i){e===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,i,r,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,i,r,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,i){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(e,i),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(e,i,r,s){this._state.colorMask.r===e&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(e,i,r,s),this._state.colorMask.r=e,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,i,r,s){this._state.clearColor.r===e&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(e,i,r,s),this._state.clearColor.r=e,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,i){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=i,this.gl.polygonOffset(e,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,i,r,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(e,i,r,s),this._state.scissorRect.x=e,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,i){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===i||(this.gl.depthRange(e,i),this._state.depthRange.zNear=e,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,i,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,i,r),this._state.stencilFunction.face=cf.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,i,r,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,i,r,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,i,r){this._state.stencilOperation.face===cf.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,i,r),this._state.stencilOperation.face=cf.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,i,r,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,i,r,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,i=!1){const r=this._state.activeTexture;return e>=0&&(i||e!==this._state.activeTexture)&&(this.gl.activeTexture(H6+e),this._state.activeTexture=e),r}setDrawBuffers(e){const{drawFramebuffer:i}=this._state,r=i===null,s=r?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(i);if((s==null?void 0:s.length)!==e.length||!s.every((n,o)=>n===e[o]))if(e.length>this.parameters.maxDrawBuffers)console.error("Setting more active draw buffers than GL.MAX_DRAW_BUFFERS allows.");else{if(r){if(e.length>1)return void console.error("The default framebuffer can only have one active draw buffer.");if(e[0]!==ao.BACK&&e[0]!==ao.NONE)return void console.error("The default framebuffer can only use the constants GL.BACK or GL.NONE as draw buffers.")}r||!e.includes(ao.BACK)?(this.gl.drawBuffers(e),r?this._state.drawBuffers.defaultFramebuffer=e:this._state.drawBuffers.fbos.set(i,e),this._stateTracker.invalidateDrawBuffers()):console.error("A framebuffer object can only use the constants GL.COLOR_ATTACHMENTi or GL.NONE as draw buffers.")}}clear(e,i=255){var r;if(e){if(e&Lr.COLOR_BUFFER_BIT){const s=(r=this._state.drawFramebuffer)==null?void 0:r.colorAttachments;s&&this.setDrawBuffers(s),this.setColorMask(!0,!0,!0,!0)}e&Lr.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&Lr.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(e)}}clearFramebuffer(e,i=!1,r=!1){let s=0;if(e){const o=Math.max(1e-13,e[3]);this.setClearColor(e[0],e[1],e[2],o),s|=Lr.COLOR_BUFFER_BIT}i&&(s|=Lr.DEPTH_BUFFER_BIT),r===!1?r=0:(r===!0&&(r=255),s|=Lr.STENCIL_BUFFER_BIT),s&&this.clear(s,r)}drawArrays(e,i,r){var s,n;if(this._transformFeedbackRequestInfo){if(e!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(((s=this._state.program)==null?void 0:s.hasTransformFeedbackVaryings)==null)throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if(Gp()){this._numOfDrawCalls++,this._numOfTriangles+=x0e(e,r);const o=this._state.textureUnitMap;for(let a=0;a<o.length;a++){const l=o[a];if(l!=null&&l===((n=this._state.drawFramebuffer)==null?void 0:n.colorTexture))throw new Error(`Detected readWrite. Texture already bound at index ${a}`)}}this.gl.drawArrays(e,i,r),qm(this.gl)}drawArraysInstanced(e,i,r,s){this.gl.drawArraysInstanced(e,i,r,s),qm(this.gl)}drawElements(e,i,r,s){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if(Gp()&&(this._numOfDrawCalls++,this._numOfTriangles+=x0e(e,i)),this.gl.drawElements(e,i,r,s),Gp()){const n=kMe(this);if(n){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},u={mode:e,count:i,type:r,offset:s},d=(a==null?void 0:a.size)??0,p=s+i,m=d<p?`. Buffer is too small. Attempted to draw index ${p} of ${d}`:"";console.error(`drawElements: ${n}${m}`,{args:u,vao:c})}}}logInfo(){Gp()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){Gp()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===i&&n.width===r&&n.height===s||(n.x=e,n.y=i,n.width=r,n.height=s,this.gl.viewport(e,i,r,s))}setViewport4fv(e){this.setViewport(e[0],e[1],e[2],e[3])}restoreViewport({x:e,y:i,width:r,height:s}){this.setViewport(e,i,r,s)}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var i;this._state.program!==e&&((i=this._state.program)==null||i.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return(e==null?void 0:e.glName)==null?(s!=null&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==e?(this.setActiveTexture(i,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[i]=e,s):(e.isDirty&&(this.setActiveTexture(i,r),e.applyChanges()),s)}unbindTexture(e){if(e!=null)for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===e&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(e,i=!1){if(i||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(this._stateTracker.invalidateDrawBuffers(),e==null)return this.gl.bindFramebuffer(Va.FRAMEBUFFER,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);e.initializeAndBind(Va.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,i,r=!1){const s=i===Va.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==e)&&(e==null?this.gl.bindFramebuffer(i,null):e.initializeAndBind(i),s?this._state.readFramebuffer=e??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=e??null))}blitFramebuffer(e,i,r=0,s=0,n=e.width,o=e.height,a=0,l=0,c=i.width,u=i.height,d=Lr.COLOR_BUFFER_BIT,p=ii.NEAREST){this.bindFramebufferSeparate(e,Va.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,Va.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,s,n,o,a,l,c,u,d,p)}bindBuffer(e,i){if(e)switch(i??(i=e.bufferType),i){case Tt.ARRAY_BUFFER:this._state.vertexBuffer=tc(this.gl,e,i,this._state.vertexBuffer);break;case Tt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=tc(this.gl,e,i,this._state.indexBuffer);break;case Tt.UNIFORM_BUFFER:this._state.uniformBuffer=tc(this.gl,e,i,this._state.uniformBuffer);break;case Tt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=tc(this.gl,e,i,this._state.pixelPackBuffer);break;case Tt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=tc(this.gl,e,i,this._state.pixelUnpackBuffer);break;case Tt.COPY_READ_BUFFER:this._state.copyReadBuffer=tc(this.gl,e,i,this._state.copyReadBuffer);break;case Tt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=tc(this.gl,e,i,this._state.copyWriteBuffer);break;case Tt.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=tc(this.gl,e,i,this._state.transformFeedbackBuffer)}}bindRenderbuffer(e){const i=this.gl;e||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=e===Tt.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let s=r[i];return s==null&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(e,i,r){const s=this._getBufferBinding(e,i);s!=null&&(s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0))}bindBufferRange(e,i,r,s,n){const o=this._getBufferBinding(e,i);o!=null&&(o.buffer===r&&o.offset===s&&o.size===n||(s%this._parameters.uniformBufferOffsetAlignment==0?(this.gl.bindBufferRange(e,i,r.glName,s,n),o.buffer=r,o.offset=s,o.size=n):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment")))}bindUBO(e,i,r,s){i!=null?(Gp()&&(s??i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(Tt.UNIFORM_BUFFER,e,i.buffer,r,s):this.bindBufferBase(Tt.UNIFORM_BUFFER,e,i.buffer)):this.bindBufferBase(Tt.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];s!=null&&s.buffer===e.buffer&&this.bindBufferBase(Tt.UNIFORM_BUFFER,i,null)}}unbindBuffer(e){switch(e){case Tt.ARRAY_BUFFER:this._state.vertexBuffer=tc(this.gl,null,e,this._state.vertexBuffer);break;case Tt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=tc(this.gl,null,e,this._state.indexBuffer);break;case Tt.UNIFORM_BUFFER:this._state.uniformBuffer=tc(this.gl,null,e,this._state.uniformBuffer);break;case Tt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=tc(this.gl,null,e,this._state.pixelPackBuffer);break;case Tt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=tc(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Tt.COPY_READ_BUFFER:this._state.copyReadBuffer=tc(this.gl,null,e,this._state.copyReadBuffer);break;case Tt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=tc(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}bindTransformFeedback(e){const{gl:i}=this;i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,e.glName)}beginTransformFeedback(e,i){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:r}=this;r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,e.glName),r.beginTransformFeedback(i),this._transformFeedbackRequestInfo={primitiveType:i}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:e}=this;e.endTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(e=10){const{gl:i}=this,r=i.fenceSync(YY.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(nn.Sync,r),i.flush();do await RI(e),s=i.clientWaitSync(r,0,0);while(s===yz.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(nn.Sync,r),i.deleteSync(r),s===yz.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=Va.FRAMEBUFFER){return e===Va.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Tt.ARRAY_BUFFER),this.unbindBuffer(Tt.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(Tt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Tt.PIXEL_PACK_BUFFER),this.unbindBuffer(Tt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Tt.COPY_READ_BUFFER),this.unbindBuffer(Tt.COPY_WRITE_BUFFER);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Pe.ONE,Pe.ZERO),this.setBlendEquation(M0.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(cf.BACK),this.setFrontFace(KM.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(fr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(fr.ALWAYS,0,0),this.setStencilOp(fs.KEEP,fs.KEEP,fs.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setDrawBuffers([ao.BACK]),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var r,s,n;const{gl:e}=this;e.bindVertexArray(null);for(let o=0;o<this.parameters.maxVertexAttributes;o++)e.disableVertexAttribArray(o);this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(Tt.ARRAY_BUFFER,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(Tt.ELEMENT_ARRAY_BUFFER,null),this._state.uniformBuffer?e.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):e.bindBuffer(Tt.UNIFORM_BUFFER,null);for(let o=0;o<this._parameters.maxUniformBufferBindings;o++){const a=this._state.uniformBufferBindingPoints[o];if(a!=null){const{buffer:l,offset:c,size:u}=a;l!==null?c===0&&u===0?e.bindBufferBase(Tt.UNIFORM_BUFFER,o,l.glName):e.bindBufferRange(Tt.UNIFORM_BUFFER,o,l.glName,c,u):e.bindBufferBase(Tt.UNIFORM_BUFFER,o,null)}}if(this._state.pixelPackBuffer?e.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):e.bindBuffer(Tt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?e.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):e.bindBuffer(Tt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?e.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):e.bindBuffer(Tt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?e.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):e.bindBuffer(Tt.COPY_WRITE_BUFFER,null),e.bindFramebuffer(Va.READ_FRAMEBUFFER,null),e.readBuffer(e.BACK),this._state.readFramebuffer&&(e.bindFramebuffer(Va.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),e.readBuffer(qn.COLOR_ATTACHMENT0)),e.bindFramebuffer(Va.DRAW_FRAMEBUFFER,((r=this._state.drawFramebuffer)==null?void 0:r.glName)??null),this._state.drawFramebuffer===null){const o=this._state.drawBuffers.defaultFramebuffer;e.drawBuffers(o??[ao.BACK])}else{const o=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer);e.drawBuffers(o??[qn.COLOR_ATTACHMENT0])}if(this._state.vertexArrayObject){const o=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(o)}e.useProgram(((s=this._state.program)==null?void 0:s.glName)??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,((n=this._state.renderbuffer)==null?void 0:n.glName)??null),this._state.blend===!0?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),this._state.faceCulling===!0?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let o=0;o<this.parameters.maxTextureImageUnits;o++){e.activeTexture(H6+o),e.bindTexture(Is.TEXTURE_2D,null),e.bindTexture(Is.TEXTURE_CUBE_MAP,null),e.bindTexture(Is.TEXTURE_3D,null),e.bindTexture(Is.TEXTURE_2D_ARRAY,null);const a=this._state.textureUnitMap[o];a!=null&&e.bindTexture(a.descriptor.target,a.glName)}e.activeTexture(H6+this._state.activeTexture);const i=this._state.viewport;e.viewport(i.x,i.y,i.width,i.height),this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};function tc(t,e,i,r){return e?r!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function x0e(t,e){switch(t){case vi.POINTS:return 2*e;case vi.TRIANGLES:return e/3;case vi.TRIANGLE_STRIP:case vi.TRIANGLE_FAN:return e-2;default:return 0}}let IIt=class extends $It{constructor(e,i,r){super(e,i),this.gl=e,this.newCache=r,this._appleAmdDriverHelper=null,this._refCount=1,this.screen=new H$t(this)}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){var e;super.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose(),this.screen.destroy()}bindTechnique(e,i,r,s,n){return this.useProgram(e.program),this.setPipelineState(e.getPipeline(!!n)),e.program.bindPass(r,i),s&&e.program.bindDraw(s,i,r),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new XFe(this)),this._appleAmdDriverHelper.run())}get test(){}};function S0e(t){return!!t.frameUpdate}let AE=class extends Re{constructor(e,i,r){super({}),this._stage=e,this._techniques=i,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new cn,this._frameTask=e.view.resourceController.scheduler.registerTask(Mt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Ls.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniques.acquire(Jre,new Qre)),this._textureTechnique}acquire(e){const i=this._textures.get(e);return i?(i.ref(),i.loadingPromise??i):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(i=>{const r=i.texture.frameUpdate(i.previousToken);r>=0&&r!==i.previousToken&&(i.previousToken=r,e=!0)}),e&&this.events.emit("changed",tr.BACKGROUND)}_createNewRef(e){const i=this._stage.getObject(e);if(i==null)return ft(i!==void 0),null;const r=i.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),s=new LIt(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&i.unload()})});return this._textures.set(e,s),s.ref(),i.glTexture?(this._updateGLTexture(s,i.glTexture),S0e(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=i.load(this._rctx),o=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),S0e(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s),a=l=>(this._loadingCount--,s.loadingPromise=null,ms(l)||ie.getLogger(this).error(l),null);return Cu(n)?n.then(o,a):o(n)}),s.loadingPromise)}_updateGLTexture(e,i){e.glTexture=i,this.events.emit("changed",tr.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};h([f()],AE.prototype,"_loadingCount",void 0),h([f()],AE.prototype,"_frameTask",void 0),h([f()],AE.prototype,"updating",null),AE=h([I("esri.views.3d.webgl-engine.lib.TextureRepository")],AE);let LIt=class{constructor(e,i){this.id=e,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(ie.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function DIt(t,e){return new K$e(i=>agt(i,t),i=>i,e)}let c$=class extends Re{constructor(){super(...arguments),this._passParameters=new NIt,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=Ul(this._resourcesTask),this._passParameters.waveNormal=It(this._passParameters.waveNormal),this._passParameters.wavePerturbation=It(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=Nf(async i=>{await Promise.allSettled([this._loadImageResource(e,mr("esri/images/materials/water/normals.jpg"),r=>this._passParameters.waveNormal=r,i),this._loadImageResource(e,mr("esri/images/materials/water/perturbation.jpg"),r=>this._passParameters.wavePerturbation=r,i)])})),this._resourcesTask.finished?B1.LOADED:B1.LOADING}async _loadImageResource(e,i,r,s){try{const n=await R0(i,{signal:s});Et(s);const o=new jr(n.width,n.height);o.pixelFormat=Ft.RGB,o.samplingMode=ii.LINEAR_MIPMAP_LINEAR,o.hasMipmap=!0,o.maxAnisotropy=8,r(new br(e,o,n))}catch(n){ie.getLogger(this).error("Failed to load water material normal texture.",n)}}};h([f()],c$.prototype,"_resourcesTask",void 0),h([f({type:Boolean,readOnly:!0})],c$.prototype,"updating",null),c$=h([I("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],c$);let NIt=class extends $r{};const T0e=2048,FIt=1.5,kIt=8;function UIt(t,e){const{format:i,quality:r,rotation:s,disableDecorations:n}=t||{},o=une(t,e.padding),a=qIt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=HIt(t,a),u=ZIt(i),d=e3t[u];return{format:u,quality:Te(r??d,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!!(t!=null&&t.ignoreBackground),ignorePadding:!!(t!=null&&t.ignorePadding)}}function zIt(t,e){const i=UIt(t,e),r=i.area,s=i.width/r.width,n=une(i,e.padding),o=n.left+n.right,a=n.top+n.bottom,l=e.width-o,c=e.height-a,u=Math.floor(l*s+o),d=Math.floor(c*s+a),p=(t==null?void 0:t.layers)??[],m=i.ignoreBackground,g=i.ignorePadding;return{framebufferWidth:u,framebufferHeight:d,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:p,disableDecorations:i.disableDecorations,ignoreBackground:m,ignorePadding:g,objectAndLayerIdColor:!1}}function Vq(t,e,i){const{ctx:r,canvas:s}=i4e(t,i),n=r.getImageData(0,0,t.width,t.height),o=BIt(s,e);return r4e(s),{dataUrl:o,data:n}}function Bq(t,e){const{ctx:i,canvas:r}=i4e(t,e),s=i.getImageData(0,0,t.width,t.height);return r4e(r),s}function i4e(t,e){const i=VIt();e.premultipliedAlpha&&JIt(t),i.width=t.width,i.height=t.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(t,0,0),e.flipY&&XIt(r),{ctx:r,canvas:i}}function r4e(t){t.width=0,t.height=0}function VIt(){return Gq==null&&(Gq=document.createElement("canvas")),Gq}let Gq=null;function BIt(t,e){const i=QIt[e.format],r=e.quality/100;return t.toDataURL(i,r)}function GIt(t,e,i,r=0,s=0,n=t.width-r,o=t.height-s,a=!1){const{data:l}=t,{width:c,height:u,data:d}=e,p=n/c,m=o/u,g=Math.ceil(p/2),y=Math.ceil(m/2),v=t.width;for(let b=0;b<u;b++)for(let w=0;w<c;w++){const x=4*(w+(a?u-b-1:b)*c);let T=0,C=0,M=0,O=0,D=0,k=0;const U=(b+.5)*m;for(let H=Math.floor(b*m);H<(b+1)*m;H++){const z=Math.abs(U-(H+.5))/y,Z=(w+.5)*p,q=z*z;for(let Y=Math.floor(w*p);Y<(w+1)*p;Y++){const de=Math.abs(Z-(Y+.5))/g,L=Math.sqrt(q+de*de);if(L>=1)continue;let F=2*L*L*L-3*L*L+1;const j=4*(r+Y+(s+H)*v);k+=F*l[j+3],C+=F,M+=F*l[j],O+=F*l[j+1],D+=F*l[j+2],T+=F}}d[x]=M/T,d[x+1]=O/T,d[x+2]=D/T,d[x+3]=k/C}return e}function jIt(t,e,i){if(!e)return t;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=t,a=une(t,i),l=a.left+a.right,c=a.top+a.bottom,u=r-l,d=s-c,p=Math.min(kIt,Math.min((T0e-l)/u,(T0e-c)/d));return p<FIt?t:{...t,framebufferWidth:Math.round(u*p)+l,framebufferHeight:Math.round(d*p)+c,pixelRatio:n*p,resample:{region:{x:Math.round((o.x-a.left)*p)+a.left,y:Math.round((o.y-a.top)*p)+a.top,width:Math.round(o.width*p),height:Math.round(o.height*p)},width:r,height:s}}}function HIt(t,e){if(!t)return e;const i=t.width,r=t.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return e;const s=e.width/e.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function qIt(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t!=null&&t.area){t.area.x!=null&&(i.x=Math.floor(t.area.x)),t.area.y!=null&&(i.y=Math.floor(t.area.y));const r=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return WIt(YIt(i,t),e)}function WIt(t,e){const i=Math.floor(Math.max(t.x,0)),r=Math.floor(Math.max(t.y,0)),s={x:i,y:r,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-r))},n=s.width/s.height,o=t.width/t.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),u=s.height-c;return{x:s.x,y:Math.floor(s.y+u/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function YIt(t,e){if((e==null?void 0:e.width)==null||e.height==null)return t;const i=e.width/e.height,r=t.width/t.height;if(r===i)return t;if(r<i){const n=Math.floor(t.height*i);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/i);return t.y-=(s-t.height)/2,t.height=s,t}function une(t,e){return!e||t!=null&&t.ignorePadding?t3t:e}function ZIt(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return KIt}}function XIt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function JIt(t){const e=t.data,i=e.length;for(let r=0;r<i;r+=4){const s=e[r+3];if(s!==255&&s>0){const n=255/s;e[r]=e[r]*n,e[r+1]=e[r+1]*n,e[r+2]=e[r+2]*n}}}const QIt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},E0e=98,KIt="png",e3t={png:100,jpg:E0e,jpeg:E0e},t3t={top:0,right:0,bottom:0,left:0};let i3t=class{constructor(e,i,r){this.parameters=e,this.frameHasDecorations=i,this.fbos=r}},r3t=class{constructor(e,i,r){this._rctx=e,this._renderFunctions=i,this._forceCameraHook=r,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(tr.BACKGROUND);const i=ra();return this._screenshotQueue.push({settings:e,resolver:i}),i.promise}update(e,i){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const s={...r.settings,pixelRatio:r.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,s,i);r.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,i,r){e.width=i.width,e.height=i.height;const s=e.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderFunctions.renderOverlay(e,r.disableDecorations?Nl.OFF:Nl.ON,i),s.restore(),i}_readbackScreenshot(e,i){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},i):this._readbackScreenshotImmediate(e,i)}_readbackScreenshotResampled(e,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=OH(r,s,a);this._rctx.gl.readPixels(0,0,r,s,Ft.RGBA,Me.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=OH(n.width,n.height,a);return GIt(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,i){const{framebufferHeight:r,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),o=OH(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,Ft.RGBA,Me.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(n,o,e)}_renderScreenshot(e,i,r){const s=e.parameters.camera,n={width:i.framebufferWidth,height:i.framebufferHeight};Yx(n,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let o=!1;const a=i.disableDecorations&&e.frameHasDecorations,l=n.width!==s.fullWidth||n.height!==s.fullHeight,c=i.ignorePadding&&s.pixelRatio!==i.pixelRatio,u=l||a||c||i.objectAndLayerIdColor;let d=null,p=null;if(u){const v=s.clone();if(i.ignorePadding){const C=sL(v.padding);for(let M=0;M<4;M++)C[M]=Math.round(C[M]/v.pixelRatio*i.pixelRatio);v.padding=C}v.fullWidth=n.width,v.fullHeight=n.height,v.pixelRatio=i.pixelRatio;const b=s.fovX-v.fovX,w=s.fovY-v.fovY;b<0&&b<w?v.fovX=s.fovX:w<0&&w<b&&(v.fovY=s.fovY);const x={camera:v,contentCamera:v,mode:Mi.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(x),o=!0;const T=this._renderFunctions.renderScene(x,r,i.objectAndLayerIdColor?Zp.ObjectAndLayerID:Zp.Screenshot,i.disableDecorations?Nl.OFF:Nl.ON);p=T.screen,d=T.oid}const m=()=>{this._rctx.bindFramebuffer(null),p==null||p.release()};this._rctx.bindFramebuffer(p==null?void 0:p.fbo);const g=this._readbackScreenshot(i,m);let y=null;if(i.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),d==null||d.release()};this._rctx.bindFramebuffer(d==null?void 0:d.fbo),y=this._readbackScreenshot(i,v),this._rctx.bindFramebuffer(null)}if(u&&!this._rctx.contextAttributes.alpha)for(let v=3;v<g.data.length;v+=4)g.data[v]=255;if(y&&!this._rctx.contextAttributes.alpha)for(let v=3;v<y.data.length;v+=4)y.data[v]=255;return o&&this._forceCameraHook(e.parameters),[g,y]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}};function kJ(t,e={}){return t.getContext("webgl2",e)||null}let ua=class extends Re{constructor(e){super({}),this.events=new cn,this.waterTextures=new c$,this.objectAndLayerIdRenderHelper=re("enable-feature:objectAndLayerId-rendering")?new n$t:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode;try{this._initializeContext(e)}catch(s){return void console.error("Failed to initialize context",s)}const{memoryController:i}=e.view.resourceController;this.stippleTextures=gmt(this._rctx,i),this.markerTextures=DIt(this._rctx,i),this._techniques=new q$e({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextures:this.stippleTextures,waterTextures:this.waterTextures,markerTextures:this.markerTextures}),this._textures=new AE(e,this._techniques,this._rctx),this.addHandles(this._textures.events.on("changed",s=>this.requestRender(s))),this._materials=new W$e(this._textures,this._techniques,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new GRt(this._rctx,this._techniques),this.renderer=new gk(e,this._materials,this._techniques,this._rctx,this._compositingHelper,s=>this.requestRender(s)),this.addHandles([ue(()=>e.view.ready,s=>{s&&this._createRenderNodes(e.view,e.viewingMode)},cr),ue(()=>{var s;return(s=this.waterTextures)==null?void 0:s.updating},()=>this.requestRender(),cr),ue(()=>e.view.qualityProfile,s=>{var n;return(n=this.renderer)==null?void 0:n.updateRenderFeatures(s)},sr)]);const r={renderScene:(s,n,o,a)=>this.renderer.render(s,n,o,a),requestRenderScene:s=>this.requestRender(s),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(s,n,o)=>e.options.screenshot.renderOverlay(s,n,o)};this._screenshotManager=new r3t(this._rctx,r,s=>this.events.emit("force-camera-for-screenshot",s)),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Or(this._frameTask),this._techniques=Le(this._techniques),this._componentObjects=Le(this._componentObjects),this._screenshotManager=Le(this._screenshotManager),Le(this.renderer),this._textures=Le(this._textures),Le(this.waterTextures),Le(this.markerTextures),Le(this.stippleTextures),this._canvas=null,this._container=null,this._rctx=Le(this._rctx)}_createRenderNodes(e,i){new Zw({view:e,isEnabled:()=>this.renderer.hasSSAO,techniques:this._techniques}),new hv({view:e,isEnabled:()=>this.renderer.hasSMAA,techniques:this._techniques}),new uv({view:e,techniques:this._techniques}),new ME({view:e,techniques:this._techniques}),new nx({view:e,viewingMode:i,techniques:this._techniques})}requestRender(e=tr.UPDATE){this._needsRender=!0,e===tr.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating}get textures(){return this._textures}get compositingHelper(){return this._compositingHelper}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(i=>i[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,i,r,s,n,o=n){const a=s.constrainWindowSize(i,r,n*s.pixelRatio,o*s.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(a,l);let c=Number.MAX_VALUE;for(let u=0;u<a[2]*a[3];u++){const d=YRt(4*u,l,s.nearFar);c>d&&d!==s.nearFar[0]&&d!==s.nearFar[1]&&(c=d)}if(e){const u=e.pickDepth(i*s.pixelRatio,r*s.pixelRatio,s);u!=null&&c>u&&u!==s.nearFar[0]&&u!==s.nearFar[1]&&(c=u)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const i=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<i)&&(this._tmpDepthBuffer=new Uint8Array(i)),this._tmpDepthBuffer}async reloadShaders(){KDe(),await this._techniques.reloadAll(),this.requestRender()}_registerFrameTask(e){const i=e.view.state;let r=!1,s=tr.BACKGROUND,n=!1;const o={preRender:({time:a})=>{r=this.updating,s=this._needsUpdate?tr.UPDATE:tr.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||i.forcedAnimationTime!=null||r||this._needsRender){const c=l/this.renderer.animationTimeDilation,u=new wOe(i.camera,c,i.forcedAnimationTime);this.renderer.updateAnimation(u)&&this.requestRender(tr.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&i.camera.fullWidth>0&&i.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(i,a),n=!0,l&&this.renderer.hasReflections&&(this.requestRender(tr.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=this.renderer.hasSlicePlane||this.renderer.hasDecorations||this.renderer.hasHighlights,c=new i3t(i,l,this.renderer.fboCache);this._textures.update(),this._screenshotManager.update(c,a)},finish:()=>{n&&(this.renderer.finish(i.mode===Mi.IDLE?s:tr.UPDATE),n=!1)}};this._frameTask=RS(o)}_initializeContext(e){const i=e.options;this._canvas=i.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:i.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:i.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:i.preserveDrawingBuffer??!1},s=kJ(this._canvas,r);s!=null?(this._rctx=s3t(s,e),this._loadShaderOnlyExtensions(),!i.alpha&&this._rctx.contextAttributes.alpha&&ie.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&re("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):ie.getLogger(this).error("A WebGL2 context could not be created.")}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloatLinear")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjects==null&&(this._componentObjects=new gRt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjects}set componentObjectCollection(e){this._componentObjects=e}};function s3t(t,e){const i={disabledExtensions:e.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:e.options.debugWebGLExtensions||{},maxAnisotropy:8},r=(s,n)=>e.view.resourceController.memoryController.newCache(s,n);return new IIt(t,i,r)}h([f({type:Boolean,readOnly:!0})],ua.prototype,"updating",null),h([f()],ua.prototype,"_rctx",void 0),h([f()],ua.prototype,"_container",void 0),h([f()],ua.prototype,"_canvas",void 0),h([f()],ua.prototype,"stippleTextures",void 0),h([f()],ua.prototype,"markerTextures",void 0),h([f()],ua.prototype,"waterTextures",void 0),h([f({readOnly:!0})],ua.prototype,"objectAndLayerIdRenderHelper",void 0),h([f()],ua.prototype,"_textures",void 0),h([f({readOnly:!0})],ua.prototype,"renderer",void 0),h([f()],ua.prototype,"_screenshotManager",void 0),h([f()],ua.prototype,"componentObjectCollection",null),h([f()],ua.prototype,"_componentObjects",void 0),h([f()],ua.prototype,"_needsUpdate",void 0),h([f()],ua.prototype,"_needsWaterReflectionUpdate",void 0),ua=h([I("esri.views.3d.webgl-engine.parts.RenderView")],ua);let qu=class extends Re{constructor(e){super(e),this._model=new ak,this._layers=new Zt,this._asyncChangeSet=new eZ,this._syncChangeSet=new eZ,this._layerSyncSet=new Set}initialize(){this._set("renderView",new ua(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(Mt.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),rV(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e!=null&&!this.destroyed&&this._model.remove(e)&&(rV(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){var i,r;e!=null&&((i=this._model)==null||i.removeMany(e),(r=this.renderView)==null||r.requestRender())}forEachOfType(e,i){this._model.forEachOfType(e,i)}handleEvent(e,i){this.destroyed||(this._model.dirtySet[e](i),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){if(this._frameTask.processQueue(e),this._commit(e),!e.hasProgressed)return ia}_commit(e){const i=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const s=this._layerSyncSet.has(r.id)||r.updatePolicy===p1.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;i.commitLayer(r.id,n),this._layerSyncSet.delete(r.id),n.empty||(this.renderer.modify(n,s?lu:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,lu),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==p1.ASYNC||(i.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(i=>{this._layerSyncSet.has(i.id)||i.updatePolicy===p1.SYNC?(e.commitLayer(i.id,this._syncChangeSet),this._layerSyncSet.delete(i.id)):e.commitSyncUpdates(i.id,this._syncChangeSet)});for(const i of this._layerSyncSet)e.commitLayer(i,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,lu),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,lu),this.renderView.requestRender())}schedule(e,i){return this._frameTask.schedule(e,i)}reschedule(e,i){return this._frameTask.reschedule(e,i)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,lu))}addRenderPlugin(e,i){const r=this.renderer.plugins.add(e,i),s=()=>{Fge(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(Cu(r))return r.then(s);s()}removeRenderPlugin(e){this.destroyed||(Fge(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.plugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){}};qu.DebugSettings={endFrameContentValidation:!1},h([f({constructOnly:!0})],qu.prototype,"view",void 0),h([f({constructOnly:!0})],qu.prototype,"options",void 0),h([f({readOnly:!0})],qu.prototype,"viewingMode",null),h([f({constructOnly:!0})],qu.prototype,"container",void 0),h([f({readOnly:!0})],qu.prototype,"updating",null),h([f({constructOnly:!0})],qu.prototype,"_model",void 0),h([f()],qu.prototype,"renderView",void 0),h([f({readOnly:!0})],qu.prototype,"renderer",null),h([f({readOnly:!0})],qu.prototype,"running",null),qu=h([I("esri.views.3d.webgl-engine.Stage")],qu);function Qii(t){return t&&typeof t.highlight=="function"}function n3t(t){return t&&typeof t.maskOccludee=="function"}function o3t(t,e,i){return t==null||t>=i&&(e===0||t<=e)}function Kii(t,e){if(e&&t){const{minScale:i,maxScale:r}=t;if(a3t(i,r))return o3t(e,i,r)}return!0}function a3t(t,e){return t!=null&&t>0||e!=null&&e>0}function eri(t){return!(t!=null&&t.minScale)||!t.maxScale||t.minScale>=t.maxScale}let jq;function UJ(){return jq||(jq=u3t()),jq}let l3t=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}};function c3t(t){if(typeof WebGL2RenderingContext>"u")return null;const e=document.createElement("canvas");if(!e)return null;let i=kJ(e,{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=kJ(e),i!=null&&(t.majorPerformanceCaveat=!0)),i==null)return i;t.available=!0,t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const r=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return r&&(t.supportsHighPrecisionFragment=r.precision>0),i}function u3t(){const t=new l3t,e=c3t(t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function h3t(t){const e=UJ();return e.available?t==="3d"&&e.majorPerformanceCaveat?new V("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?null:new V("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new V("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new V("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function d3t(t){return t&&"nodeType"in t}function p3t(t){return t&&typeof t.render=="function"}const C0e={component:"esri-component"};let ax=class extends Re{constructor(){super(...arguments),this.widget=null}destroy(){var e;this.node=null,(e=this.widget)==null||e.destroy()}get id(){var e,i;return this._get("id")??((e=this.widget)==null?void 0:e.id)??((i=this.node)==null?void 0:i.id)}set id(e){this._set("id",e)}set node(e){const i=this._get("node");e!==i&&(e&&e.classList.add(C0e.component),i&&i.classList.remove(C0e.component),this._set("node",e))}castNode(e){var i;return(i=this.widget)==null||i.destroy(),e?typeof e=="string"||d3t(e)?(this._set("widget",null),gB(e)):(p3t(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};h([f()],ax.prototype,"id",null),h([f()],ax.prototype,"node",null),h([Li("node")],ax.prototype,"castNode",null),h([f({readOnly:!0})],ax.prototype,"widget",void 0),ax=h([I("esri.views.ui.Component")],ax);const yk=ax,s4e="calcite-mode-";function f3t(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function m3t(){return f3t().startsWith("dark")}function g3t(){return`${s4e}${m3t()?"dark":"light"}`}function y3t(t){_3t(t),t.classList.add(g3t())}function _3t(t){Array.from(t.classList).forEach(e=>{e.startsWith(s4e)&&t.classList.remove(e)})}const v3t={left:0,top:0,bottom:0,right:0},n4e={bottom:30,top:15,right:15,left:15},hy="esri-ui",kc={ui:hy,corner:`${hy}-corner`,innerContainer:`${hy}-inner-container`,manualContainer:`${hy}-manual-container`,cornerContainer:`${hy}-corner-container`,topLeft:`${hy}-top-left`,topRight:`${hy}-top-right`,bottomLeft:`${hy}-bottom-left`,bottomRight:`${hy}-bottom-right`};function b3t(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function QF(t){return t===0?"0":`${t}px`}function Hq(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function qq(t,{top:e,bottom:i,left:r,right:s}){t.style.top=e,t.style.bottom=i,t.style.left=r,t.style.right=s}let Pm=class extends cn.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=fu(),this.view=null,this._applyViewPadding=()=>{const i=this.container;i&&qq(i,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const i=this._innerContainer;i&&qq(i,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([ue(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,cr),ue(()=>this.padding,this._applyUIPadding,cr),ue(()=>[this.container,this._locale],([e,i])=>{e&&e.setAttribute("lang",i)},cr),qwe(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const i=this._get("container");e!==i&&(e&&(e.classList.add(kc.ui),y3t(e),this._attachContainers(e)),i&&(i.classList.remove(kc.ui),qq(i,{top:"",bottom:"",left:"",right:""}),Nwe(i)),this._set("container",e))}get height(){var n;const e=((n=this.view)==null?void 0:n.height)??0;if(e===0)return e;const i=this._getViewPadding(),{top:r,bottom:s}=i;return Math.max(e-r-s,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...n4e,...e}}get width(){var n;const e=((n=this.view)==null?void 0:n.width)??0;if(e===0)return e;const i=this._getViewPadding(),{left:r,right:s}=i;return Math.max(e-r-s,0)}add(e,i){let r,s,n;if(Array.isArray(e))return void e.forEach(a=>this.add(a,i));const o=Hq(e);o&&({index:r,position:i,component:e,key:s}=o),i&&typeof i=="object"&&({index:r,key:s,position:i,internal:n}=i),!e||i&&!this._isValidPosition(i)||this._add(e,i,r,s,n)}remove(e,i){var s,n;if(!e)return;if(Array.isArray(e))return e.map(o=>this.remove(o,i));const r=this._find(e);if(r){if(this._componentMap.has(r)&&((s=this._componentMap.get(r))==null?void 0:s.key)!==i)return;const o=this._components.indexOf(r),a=r.node.parentNode;return a==null||a.removeChild(r.node),this._componentMap.delete(r),(n=r.widget)==null||n.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(o,1)[0]}}empty(e,i={removeInternal:!1}){if(Array.isArray(e)){for(const n of e)this.empty(n,i);return}const r=this._positionNameToContainerLookup[e??"manual"],s=Array.prototype.slice.call(r.children).map(n=>this._findByNode(n)).filter(n=>{var o;return n==null?!1:!(((o=this._componentMap.get(n))==null?void 0:o.internal)??!1)||i.removeInternal});for(const n of s)this.remove(n)}move(e,i){if(Array.isArray(e)&&e.forEach(o=>this.move(o,i)),!e)return;let r;const s=Hq(e)||Hq(i);if(s&&(r=s.index,i=s.position,e=s.component||e),i&&!this._isValidPosition(i))return;const n=this.remove(e);n&&this.add(n,{position:i,index:r})}find(e){if(!e)return null;const i=this._findById(e);return i&&(i.widget||i.node)}getComponents(e,i={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(r=>this._getComponentsAtPosition(r,i)):this._getComponentsAtPosition(e,i):this._components.filter(r=>{var s;return i.includeInternal||!((s=this._componentMap.get(r))!=null&&s.internal)}).map(({widget:r,node:s})=>r??s)}getPosition(e){for(const i in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[i].contains(e))return i;return null}_add(e,i,r,s,n){e instanceof yk||(e=new yk({node:e}));const{widget:o}=e;o!=null&&o instanceof Re&&o.addHandles(Ni(()=>{queueMicrotask(()=>this.remove(e))}),this._removeWidgetHandleKey),this._place({component:e,position:i,index:r}),this._components.push(e),this._componentMap.set(e,{key:s,internal:n})}_find(e){return e?e instanceof yk?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){var e;return((e=this.view)==null?void 0:e.padding)??v3t}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(kc.innerContainer,kc.cornerContainer);const i=document.createElement("div");i.classList.add(kc.innerContainer,kc.manualContainer);const r=document.createElement("div");r.classList.add(kc.topLeft,kc.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(kc.topRight,kc.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(kc.bottomLeft,kc.corner),e.appendChild(n);const o=document.createElement("div");o.classList.add(kc.bottomRight,kc.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=i;const a=kWe();this._cornerNameToContainerLookup={"top-left":r,"top-right":s,"bottom-left":n,"bottom-right":o,"top-leading":a?s:r,"top-trailing":a?r:s,"bottom-leading":a?o:n,"bottom-trailing":a?n:o},this._positionNameToContainerLookup={manual:i,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const i=e.position??"manual",{component:r,index:s}=e,n=this._positionNameToContainerLookup[i],o=s!=null&&s>-1;if(b3t(r.widget)&&r.widget.startup(),!o)return void n.appendChild(r.node);const a=Array.from(n.children);if(s===0)return void(n.firstChild?Tae(r.node,n.firstChild):n.appendChild(r.node));s>=a.length?n.appendChild(r.node):Tae(r.node,a[s])}_toPixelPosition(e){return{top:QF(e.top),left:QF(e.left),right:QF(e.right),bottom:QF(e.bottom)}}_findByComponent(e){return this._components.find(i=>i===e)??null}_findById(e){return this._components.find(({id:i})=>i===e)??null}_findByNode(e){return this._components.find(({node:i})=>i===e)??null}_getComponentsAtPosition(e,i){const r=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(r.children).map(s=>this._findByNode(s)).filter(K1).filter(s=>{var n;return i.includeInternal||!((n=this._componentMap.get(s))!=null&&n.internal)}).map(({widget:s,node:n})=>s??n)}};h([f()],Pm.prototype,"_locale",void 0),h([f()],Pm.prototype,"container",null),h([f()],Pm.prototype,"height",null),h([f({value:n4e})],Pm.prototype,"padding",null),h([Li("padding")],Pm.prototype,"castPadding",null),h([f()],Pm.prototype,"view",void 0),h([f()],Pm.prototype,"width",null),Pm=h([I("esri.views.ui.UI")],Pm);const w3t=Pm,x3t="randomUUID"in crypto;function qL(){if(x3t)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=i=>t[i].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function sri(){return`{${qL().toUpperCase()}}`}function S3t(){return`{${qL()}}`}const T3t={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties[`on${r.type}`].apply(e.properties.bind||i,[r]))},E3t={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}},C3t=t=>({...E3t,...t}),M3t=(t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i},A3t=(t,e)=>t.find(e),M0e=(t,e,i=!1)=>{let r=t;return e.forEach((s,n)=>{const o=r!=null&&r.children?A3t(r.children,a=>a.domNode===s):void 0;i&&!o&&n!==e.length-1||(r=o)}),r},P3t=t=>{let e;const i={...T3t,...t},r=C3t(i),s=r.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],u=(p,m,g)=>{var b;let y;r.eventHandlerInterceptor=(w,x,T,C)=>function(M){let O;s("domEvent",M);const D=M3t(M.currentTarget,y.domNode),k=D.some(H=>{var z;return customElements.get((z=H==null?void 0:H.tagName)==null?void 0:z.toLowerCase())});if(M.eventPhase===Event.CAPTURING_PHASE||!k)D.reverse(),O=M0e(y.getLastRender(),D);else{const H=M.composedPath(),z=H.slice(H.indexOf(M.currentTarget),H.indexOf(y.domNode)).reverse();O=M0e(y.getLastRender(),z,!0)}let U;return O&&(U=i.handleInterceptedEvent(e,O,this,M)),s("domEventProcessed",M),U},(b=i.postProcessProjectionOptions)==null||b.call(i,r);const v=g();y=p(m,v,r),r.eventHandlerInterceptor=void 0,l.push(y),c.push(g),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(y,v)};let d=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let p=0;p<l.length;p++){const m=c[p]();s("rendered",void 0),l[p].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(d=i.modifyDoRenderImplementation(d,l,c)),e={renderNow:d,scheduleRender:()=>{n||a||(n=requestAnimationFrame(d))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(p,m)=>{u(Wv.append,p,m)},insertBefore:(p,m)=>{u(Wv.insertBefore,p,m)},merge:(p,m)=>{u(Wv.merge,p,m)},replace:(p,m)=>{u(Wv.replace,p,m)},detach:p=>{for(let m=0;m<c.length;m++)if(c[m]===p)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},e};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.10.1
 */const o4e="calcite-mode-auto",a4e="calcite-mode-dark",O3t="calcite-mode-light",nri={autoMode:o4e,darkMode:a4e,lightMode:O3t,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.10.1
 */const tS=globalThis.calciteConfig,ori=(tS==null?void 0:tS.focusTrapStack)||[],A0e="2.10.1";function R3t(){if(tS&&tS.version){console.warn(`[calcite-components] while initializing v${A0e}, an existing configuration with version "${tS.version}" was found. This may cause unexpected behavior. The version will not be added to the existing global configuration.`);return}const t=tS||globalThis.calciteConfig||{};Object.defineProperty(t,"version",{value:A0e,writable:!1}),globalThis.calciteConfig=t}var i0={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,formAssociated:!1,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0,experimentalSlotFixes:!1},$3t=Object.defineProperty,I3t=(t,e)=>{for(var i in e)$3t(t,i,{get:e[i],enumerable:!0})},L3t=t=>{const e=new URL(t,Pa.$resourcesUrl$);return e.origin!==YL.location.origin?e.href:e.pathname},D3t=t=>Pa.$resourcesUrl$=t,P0e={},N3t="http://www.w3.org/2000/svg",F3t="http://www.w3.org/1999/xhtml",k3t=t=>t!=null,hne=t=>(t=typeof t,t==="object"||t==="function");function U3t(t){var e,i,r;return(r=(i=(e=t.head)==null?void 0:e.querySelector('meta[name="csp-nonce"]'))==null?void 0:i.getAttribute("content"))!=null?r:void 0}var z3t={};I3t(z3t,{err:()=>l4e,map:()=>V3t,ok:()=>zJ,unwrap:()=>B3t,unwrapErr:()=>G3t});var zJ=t=>({isOk:!0,isErr:!1,value:t}),l4e=t=>({isOk:!1,isErr:!0,value:t});function V3t(t,e){if(t.isOk){const i=e(t.value);return i instanceof Promise?i.then(r=>zJ(r)):zJ(i)}if(t.isErr){const i=t.value;return l4e(i)}throw"should never get here"}var B3t=t=>{if(t.isOk)return t.value;throw t.value},G3t=t=>{if(t.isErr)return t.value;throw t.value},lT=(t,e="")=>()=>{},j3t="slot-fb{display:contents}slot-fb[hidden]{display:none}",O0e="http://www.w3.org/1999/xlink",c4e=(t,e,...i)=>{let r=null,s=null,n=null,o=!1,a=!1;const l=[],c=d=>{for(let p=0;p<d.length;p++)r=d[p],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof t!="function"&&!hne(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?$V(null,r):r),a=o)};if(c(i),e){e.key&&(s=e.key),e.name&&(n=e.name);{const d=e.className||e.class;d&&(e.class=typeof d!="object"?d:Object.keys(d).filter(p=>d[p]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,W3t);const u=$V(t,null);return u.$attrs$=e,l.length>0&&(u.$children$=l),u.$key$=s,u.$name$=n,u},$V=(t,e)=>{const i={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return i.$attrs$=null,i.$key$=null,i.$name$=null,i},H3t={},q3t=t=>t&&t.$tag$===H3t,W3t={forEach:(t,e)=>t.map(R0e).forEach(e),map:(t,e)=>t.map(R0e).map(e).map(Y3t)},R0e=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),Y3t=t=>{if(typeof t.vtag=="function"){const i={...t.vattrs};return t.vkey&&(i.key=t.vkey),t.vname&&(i.name=t.vname),c4e(t.vtag,i,...t.vchildren||[])}const e=$V(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},Z3t=t=>SLt.map(e=>e(t)).find(e=>!!e),X3t=(t,e)=>t!=null&&!hne(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,J3t=t=>t,ari=(t,e,i)=>{const r=J3t(t);return{emit:s=>Q3t(r,e,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:s})}},Q3t=(t,e,i)=>{const r=Pa.ce(e,i);return t.dispatchEvent(r),r},$0e=new WeakMap,K3t=(t,e,i)=>{let r=DV.get(t);CLt&&i?(r=r||new CSSStyleSheet,typeof r=="string"?r=e:r.replaceSync(e)):r=e,DV.set(t,r)},eLt=(t,e,i)=>{var r;const s=u4e(e,i),n=DV.get(s);if(t=t.nodeType===11?t:wf,n)if(typeof n=="string"){t=t.head||t;let o=$0e.get(t),a;if(o||$0e.set(t,o=new Set),!o.has(s)){{a=wf.createElement("style"),a.innerHTML=n;const l=(r=Pa.$nonce$)!=null?r:U3t(wf);l!=null&&a.setAttribute("nonce",l),t.insertBefore(a,t.querySelector("link"))}e.$flags$&4&&(a.innerHTML+=j3t),o&&o.add(s)}}else t.adoptedStyleSheets.includes(n)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,n]);return s},tLt=t=>{const e=t.$cmpMeta$,i=t.$hostElement$,r=e.$flags$,s=lT("attachStyles",e.$tagName$),n=eLt(i.shadowRoot?i.shadowRoot:i.getRootNode(),e,t.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},u4e=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),I0e=(t,e,i,r,s,n)=>{if(i!==r){let o=z0e(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=L0e(i),u=L0e(r);l.remove(...c.filter(d=>d&&!u.includes(d))),l.add(...u.filter(d=>d&&!c.includes(d)))}else if(e==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?t.style.setProperty(l,r[l]):t.style[l]=r[l])}else if(e!=="key")if(e==="ref")r&&r(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n"){if(e[2]==="-"?e=e.slice(3):z0e(YL,a)?e=a.slice(2):e=a[2]+e.slice(3),i||r){const l=e.endsWith(h4e);e=e.replace(rLt,""),i&&Pa.rel(t,e,i,l),r&&Pa.ael(t,e,r,l)}}else{const l=hne(r);if((o||l&&r!==null)&&!s)try{if(t.tagName.includes("-"))t[e]=r;else{const u=r??"";e==="list"?o=!1:(i==null||t[e]!=u)&&(t[e]=u)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),r==null||r===!1?(r!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(O0e,e):t.removeAttribute(e)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?t.setAttributeNS(O0e,e,r):t.setAttribute(e,r))}}},iLt=/\s/,L0e=t=>t?t.split(iLt):[],h4e="Capture",rLt=new RegExp(h4e+"$"),d4e=(t,e,i)=>{const r=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,s=t&&t.$attrs$||P0e,n=e.$attrs$||P0e;for(const o of D0e(Object.keys(s)))o in n||I0e(r,o,s[o],void 0,i,e.$flags$);for(const o of D0e(Object.keys(n)))I0e(r,o,s[o],n[o],i,e.$flags$)};function D0e(t){return t.includes("ref")?[...t.filter(e=>e!=="ref"),"ref"]:t}var PE,VJ,SA,dne=!1,IV=!1,pne=!1,oh=!1,LV=(t,e,i,r)=>{var s;const n=e.$children$[i];let o=0,a,l,c;if(dne||(pne=!0,n.$tag$==="slot"&&(PE&&r.classList.add(PE+"-s"),n.$flags$|=n.$children$?2:1)),n.$text$!==null)a=n.$elm$=wf.createTextNode(n.$text$);else if(n.$flags$&1)a=n.$elm$=wf.createTextNode("");else{if(oh||(oh=n.$tag$==="svg"),a=n.$elm$=wf.createElementNS(oh?N3t:F3t,n.$flags$&2?"slot-fb":n.$tag$),oh&&n.$tag$==="foreignObject"&&(oh=!1),d4e(null,n,oh),k3t(PE)&&a["s-si"]!==PE&&a.classList.add(a["s-si"]=PE),mne(a,r),n.$children$)for(o=0;o<n.$children$.length;++o)l=LV(t,n,o,a),l&&a.appendChild(l);n.$tag$==="svg"?oh=!1:a.tagName==="foreignObject"&&(oh=!0)}return a["s-hn"]=SA,n.$flags$&3&&(a["s-sr"]=!0,a["s-cr"]=VJ,a["s-sn"]=n.$name$||"",a["s-rf"]=(s=n.$attrs$)==null?void 0:s.ref,c=t&&t.$children$&&t.$children$[i],c&&c.$tag$===n.$tag$&&t.$elm$&&R3(t.$elm$,!1)),a},R3=(t,e)=>{Pa.$flags$|=1;const i=Array.from(t.childNodes);if(t["s-sr"]&&i0.experimentalSlotFixes){let r=t;for(;r=r.nextSibling;)r&&r["s-sn"]===t["s-sn"]&&r["s-sh"]===SA&&i.push(r)}for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==SA&&s["s-ol"]&&(g1(m4e(s),s,fne(s)),s["s-ol"].remove(),s["s-ol"]=void 0,s["s-sh"]=void 0,pne=!0),e&&R3(s,e)}Pa.$flags$&=-2},p4e=(t,e,i,r,s,n)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===SA&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=LV(null,i,s,t),a&&(r[s].$elm$=a,g1(o,a,fne(e))))},f4e=(t,e,i)=>{for(let r=e;r<=i;++r){const s=t[r];if(s){const n=s.$elm$;_4e(s),n&&(IV=!0,n["s-ol"]?n["s-ol"].remove():R3(n,!0),n.remove())}}},sLt=(t,e,i,r,s=!1)=>{let n=0,o=0,a=0,l=0,c=e.length-1,u=e[0],d=e[c],p=r.length-1,m=r[0],g=r[p],y,v;for(;n<=c&&o<=p;)if(u==null)u=e[++n];else if(d==null)d=e[--c];else if(m==null)m=r[++o];else if(g==null)g=r[--p];else if(KF(u,m,s))OE(u,m,s),u=e[++n],m=r[++o];else if(KF(d,g,s))OE(d,g,s),d=e[--c],g=r[--p];else if(KF(u,g,s))(u.$tag$==="slot"||g.$tag$==="slot")&&R3(u.$elm$.parentNode,!1),OE(u,g,s),g1(t,u.$elm$,d.$elm$.nextSibling),u=e[++n],g=r[--p];else if(KF(d,m,s))(u.$tag$==="slot"||g.$tag$==="slot")&&R3(d.$elm$.parentNode,!1),OE(d,m,s),g1(t,d.$elm$,u.$elm$),d=e[--c],m=r[++o];else{for(a=-1,l=n;l<=c;++l)if(e[l]&&e[l].$key$!==null&&e[l].$key$===m.$key$){a=l;break}a>=0?(v=e[a],v.$tag$!==m.$tag$?y=LV(e&&e[o],i,a,t):(OE(v,m,s),e[a]=void 0,y=v.$elm$),m=r[++o]):(y=LV(e&&e[o],i,o,t),m=r[++o]),y&&g1(m4e(u.$elm$),y,fne(u.$elm$))}n>c?p4e(t,r[p+1]==null?null:r[p+1].$elm$,i,r,o,p):o>p&&f4e(e,n,c)},KF=(t,e,i=!1)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:i?!0:t.$key$===e.$key$:!1,fne=t=>t&&t["s-ol"]||t,m4e=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,OE=(t,e,i=!1)=>{const r=e.$elm$=t.$elm$,s=t.$children$,n=e.$children$,o=e.$tag$,a=e.$text$;let l;a===null?(oh=o==="svg"?!0:o==="foreignObject"?!1:oh,o==="slot"&&!dne||d4e(t,e,oh),s!==null&&n!==null?sLt(r,s,e,n,i):n!==null?(t.$text$!==null&&(r.textContent=""),p4e(r,null,e,n,0,n.length-1)):s!==null&&f4e(s,0,s.length-1),oh&&o==="svg"&&(oh=!1)):(l=r["s-cr"])?l.parentNode.textContent=a:t.$text$!==a&&(r.data=a)},g4e=t=>{const e=t.childNodes;for(const i of e)if(i.nodeType===1){if(i["s-sr"]){const r=i["s-sn"];i.hidden=!1;for(const s of e)if(s!==i){if(s["s-hn"]!==i["s-hn"]||r!==""){if(s.nodeType===1&&(r===s.getAttribute("slot")||r===s["s-sn"])||s.nodeType===3&&r===s["s-sn"]){i.hidden=!0;break}}else if(s.nodeType===1||s.nodeType===3&&s.textContent.trim()!==""){i.hidden=!0;break}}}g4e(i)}},Jy=[],y4e=t=>{let e,i,r;for(const s of t.childNodes){if(s["s-sr"]&&(e=s["s-cr"])&&e.parentNode){i=e.parentNode.childNodes;const n=s["s-sn"];for(r=i.length-1;r>=0;r--)if(e=i[r],!e["s-cn"]&&!e["s-nr"]&&e["s-hn"]!==s["s-hn"]&&!i0.experimentalSlotFixes)if(N0e(e,n)){let o=Jy.find(a=>a.$nodeToRelocate$===e);IV=!0,e["s-sn"]=e["s-sn"]||n,o?(o.$nodeToRelocate$["s-sh"]=s["s-hn"],o.$slotRefNode$=s):(e["s-sh"]=s["s-hn"],Jy.push({$slotRefNode$:s,$nodeToRelocate$:e})),e["s-sr"]&&Jy.map(a=>{N0e(a.$nodeToRelocate$,e["s-sn"])&&(o=Jy.find(l=>l.$nodeToRelocate$===e),o&&!a.$slotRefNode$&&(a.$slotRefNode$=o.$slotRefNode$))})}else Jy.some(o=>o.$nodeToRelocate$===e)||Jy.push({$nodeToRelocate$:e})}s.nodeType===1&&y4e(s)}},N0e=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",_4e=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(_4e)},g1=(t,e,i)=>{const r=t==null?void 0:t.insertBefore(e,i);return mne(e,t),r},v4e=t=>{const e=[];return t&&e.push(...t["s-scs"]||[],t["s-si"],t["s-sc"],...v4e(t.parentElement)),e},mne=(t,e,i=!1)=>{var r;if(t&&e&&t.nodeType===1){const s=new Set(v4e(e).filter(Boolean));if(s.size&&((r=t.classList)==null||r.add(...t["s-scs"]=[...s]),t["s-ol"]||i))for(const n of Array.from(t.childNodes))mne(n,t,!0)}},nLt=(t,e,i=!1)=>{var r,s,n,o,a;const l=t.$hostElement$,c=t.$cmpMeta$,u=t.$vnode$||$V(null,null),d=q3t(e)?e:c4e(null,null,e);if(SA=l.tagName,c.$attrsToReflect$&&(d.$attrs$=d.$attrs$||{},c.$attrsToReflect$.map(([p,m])=>d.$attrs$[m]=l[p])),i&&d.$attrs$)for(const p of Object.keys(d.$attrs$))l.hasAttribute(p)&&!["key","ref","style","class"].includes(p)&&(d.$attrs$[p]=l[p]);d.$tag$=null,d.$flags$|=4,t.$vnode$=d,d.$elm$=u.$elm$=l.shadowRoot||l,PE=l["s-sc"],dne=(c.$flags$&1)!==0,VJ=l["s-cr"],IV=!1,OE(u,d,i);{if(Pa.$flags$|=1,pne){y4e(d.$elm$);for(const p of Jy){const m=p.$nodeToRelocate$;if(!m["s-ol"]){const g=wf.createTextNode("");g["s-nr"]=m,g1(m.parentNode,m["s-ol"]=g,m)}}for(const p of Jy){const m=p.$nodeToRelocate$,g=p.$slotRefNode$;if(g){const y=g.parentNode;let v=g.nextSibling;{let b=(r=m["s-ol"])==null?void 0:r.previousSibling;for(;b;){let w=(s=b["s-nr"])!=null?s:null;if(w&&w["s-sn"]===m["s-sn"]&&y===w.parentNode){for(w=w.nextSibling;w===m||w!=null&&w["s-sr"];)w=w==null?void 0:w.nextSibling;if(!w||!w["s-nr"]){v=w;break}}b=b.previousSibling}}(!v&&y!==m.parentNode||m.nextSibling!==v)&&m!==v&&(!m["s-hn"]&&m["s-ol"]&&(m["s-hn"]=m["s-ol"].parentNode.nodeName),g1(y,m,v),m.nodeType===1&&(m.hidden=(n=m["s-ih"])!=null?n:!1)),m&&typeof g["s-rf"]=="function"&&g["s-rf"](m)}else m.nodeType===1&&(i&&(m["s-ih"]=(o=m.hidden)!=null?o:!1),m.hidden=!0)}}IV&&g4e(d.$elm$),Pa.$flags$&=-2,Jy.length=0}if(i0.experimentalScopedSlotChanges&&c.$flags$&2)for(const p of d.$elm$.childNodes)p["s-hn"]!==SA&&!p["s-sh"]&&(i&&p["s-ih"]==null&&(p["s-ih"]=(a=p.hidden)!=null?a:!1),p.hidden=!0);VJ=void 0},oLt=(t,e)=>{},gne=(t,e)=>(t.$flags$|=16,oLt(t,t.$ancestorComponent$),ALt(()=>aLt(t,e))),aLt=(t,e)=>{const i=t.$hostElement$,r=lT("scheduleUpdate",t.$cmpMeta$.$tagName$),s=i;if(!s)throw new Error(`Can't render component <${i.tagName.toLowerCase()} /> with invalid Stencil runtime! Make sure this imported component is compiled with a \`externalRuntime: true\` flag. For more information, please refer to https://stenciljs.com/docs/custom-elements#externalruntime`);let n;return e?n=hM(s,"componentWillLoad"):n=hM(s,"componentWillUpdate"),n=F0e(n,()=>hM(s,"componentWillRender")),r(),F0e(n,()=>cLt(t,s,e))},F0e=(t,e)=>lLt(t)?t.then(e):e(),lLt=t=>t instanceof Promise||t&&t.then&&typeof t.then=="function",cLt=async(t,e,i)=>{const r=t.$hostElement$,s=lT("update",t.$cmpMeta$.$tagName$);r["s-rc"],i&&tLt(t);const n=lT("render",t.$cmpMeta$.$tagName$);uLt(t,e,r,i),n(),s(),hLt(t)},k0e=null,uLt=(t,e,i,r)=>{try{k0e=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(i0.hasRenderFn||i0.reflect)&&(i0.vdomRender||i0.reflect)&&(i0.hydrateServerSide||nLt(t,e,r))}catch(l){WL(l,t.$hostElement$)}return k0e=null,null},hLt=t=>{const e=t.$cmpMeta$.$tagName$,i=t.$hostElement$,r=lT("postUpdate",e),s=i;t.$ancestorComponent$,hM(s,"componentDidRender"),t.$flags$&64?(hM(s,"componentDidUpdate"),r()):(t.$flags$|=64,hM(s,"componentDidLoad"),r())},lri=t=>{{const e=nP(t),i=e.$hostElement$.isConnected;return i&&(e.$flags$&18)===2&&gne(e,!1),i}},hM=(t,e,i)=>{if(t&&t[e])try{return t[e](i)}catch(r){WL(r)}},dLt=(t,e)=>nP(t).$instanceValues$.get(e),pLt=(t,e,i,r)=>{const s=nP(t),n=t,o=s.$instanceValues$.get(e),a=s.$flags$,l=n;i=X3t(i,r.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){s.$instanceValues$.set(e,i);{if(r.$watchers$&&a&128){const d=r.$watchers$[e];d&&d.map(p=>{try{l[p](i,o,e)}catch(m){WL(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,e)===!1)return;gne(s,!1)}}}},fLt=(t,e,i)=>{var r;const s=t.prototype;if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const n=Object.entries(e.$members$);n.map(([o,[a]])=>{(a&31||a&32)&&Object.defineProperty(s,o,{get(){return dLt(this,o)},set(l){pLt(this,o,l,e)},configurable:!0,enumerable:!0})});{const o=new Map;s.attributeChangedCallback=function(a,l,c){Pa.jmp(()=>{var u;const d=o.get(a);if(this.hasOwnProperty(d))c=this[d],delete this[d];else{if(s.hasOwnProperty(d)&&typeof this[d]=="number"&&this[d]==c)return;if(d==null){const p=nP(this),m=p==null?void 0:p.$flags$;if(m&&!(m&8)&&m&128&&c!==l){const y=this,v=(u=e.$watchers$)==null?void 0:u[a];v==null||v.forEach(b=>{y[b]!=null&&y[b].call(y,c,l,a)})}return}}this[d]=c===null&&typeof this[d]=="boolean"?!1:c})},t.observedAttributes=Array.from(new Set([...Object.keys((r=e.$watchers$)!=null?r:{}),...n.filter(([a,l])=>l[0]&15).map(([a,l])=>{var c;const u=l[1]||a;return o.set(u,a),l[0]&512&&((c=e.$attrsToReflect$)==null||c.push([a,u])),u})]))}}return t},mLt=async(t,e,i,r)=>{let s;if(!(e.$flags$&32)){e.$flags$|=32,i.$lazyBundleId$;{s=t.constructor;const o=t.localName;customElements.whenDefined(o).then(()=>e.$flags$|=128)}if(s&&s.style){let o=s.style;typeof o!="string"&&(e.$modeName$=Z3t(t),e.$modeName$&&(o=o[e.$modeName$]));const a=u4e(i,e.$modeName$);if(!DV.has(a)){const l=lT("registerStyles",i.$tagName$);K3t(a,o,!!(i.$flags$&1)),l()}}}e.$ancestorComponent$,gne(e,!0)},U0e=t=>{},gLt=t=>{if(!(Pa.$flags$&1)){const e=nP(t),i=e.$cmpMeta$,r=lT("connectedCallback",i.$tagName$);e.$flags$&1?(b4e(t,e,i.$listeners$),e!=null&&e.$lazyInstance$?U0e(e.$lazyInstance$):e!=null&&e.$onReadyPromise$&&e.$onReadyPromise$.then(()=>U0e(e.$lazyInstance$))):(e.$flags$|=1,i.$flags$&12&&yLt(t),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&t.hasOwnProperty(s)){const o=t[s];delete t[s],t[s]=o}}),mLt(t,e,i)),r()}},yLt=t=>{const e=t["s-cr"]=wf.createComment("");e["s-cn"]=!0,g1(t,e,t.firstChild)},_Lt=async t=>{if(!(Pa.$flags$&1)){const e=nP(t);e.$rmListeners$&&(e.$rmListeners$.map(i=>i()),e.$rmListeners$=void 0)}},cri=(t,e)=>{const i={$flags$:e[0],$tagName$:e[1]};i.$members$=e[2],i.$listeners$=e[3],i.$watchers$=t.$watchers$,i.$attrsToReflect$=[];const r=t.prototype.connectedCallback,s=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){xLt(this,i)},connectedCallback(){gLt(this),r&&r.call(this)},disconnectedCallback(){_Lt(this),s&&s.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)})}}),t.is=i.$tagName$,fLt(t,i)},uri=(t,e)=>e,b4e=(t,e,i,r)=>{i&&i.map(([s,n,o])=>{const a=bLt(t,s),l=vLt(e,o),c=wLt(s);Pa.ael(a,n,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>Pa.rel(a,n,l,c))})},vLt=(t,e)=>i=>{var r;try{i0.lazyLoad||t.$hostElement$[e](i)}catch(s){WL(s)}},bLt=(t,e)=>e&4?wf:e&8?YL:e&16?wf.body:t,wLt=t=>TLt?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,w4e=new WeakMap,nP=t=>w4e.get(t),xLt=(t,e)=>{const i={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return b4e(t,i,e.$listeners$),w4e.set(t,i)},z0e=(t,e)=>e in t,WL=(t,e)=>(0,console.error)(t,e),DV=new Map,SLt=[],YL=typeof window<"u"?window:{},wf=YL.document||{head:{}},hri=YL.HTMLElement||class{},Pa={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,i,r)=>t.addEventListener(e,i,r),rel:(t,e,i,r)=>t.removeEventListener(e,i,r),ce:(t,e)=>new CustomEvent(t,e)},TLt=(()=>{let t=!1;try{wf.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),ELt=t=>Promise.resolve(t),CLt=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),BJ=!1,GJ=[],x4e=[],S4e=(t,e)=>i=>{t.push(i),BJ||(BJ=!0,e&&Pa.$flags$&4?MLt(jJ):Pa.raf(jJ))},V0e=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(i){WL(i)}t.length=0},jJ=()=>{V0e(GJ),V0e(x4e),(BJ=GJ.length>0)&&Pa.raf(jJ)},MLt=t=>ELt().then(t),dri=S4e(GJ,!1),ALt=S4e(x4e,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.10.1
 */function B0e(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>t.contains(a4e)||t.contains(o4e)&&e?"dark":"light",r=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&r(o),n=o};let n=i();r(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function PLt(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?B0e():document.addEventListener("DOMContentLoaded",()=>B0e(),{once:!0})),R3t()}const OLt=PLt;OLt();let T4e;function RLt(){try{L3t(".")}catch{D3t(uh(mr(T4e)))}}function yne(t){var i;const e=[];for(const r of Object.keys(t))customElements.get(`calcite-${r}`)||e.push((i=t[r])==null?void 0:i.call(t));return e.length>0?Promise.all(e):null}T4e="components/assets";const E4e=Symbol("widget"),C4e=Symbol("widget-test-data"),$Lt=[],ILt={},NV=new WeakMap;function M4e(t,e){let i=e.children;if(i!=null&&i.length)for(let s=0;s<i.length;++s)i[s]=M4e(t,i[s]);else i=$Lt;const r=e.vnodeSelector;if(FV(r)){const s=e.properties||ILt,n=s.key||r;return{vnodeSelector:"div",properties:{key:n,afterCreate:LLt,afterUpdate:DLt,afterRemoved:A4e,parentWidget:t,widgetConstructor:r,widgetProperties:{...s,key:n,children:i}},children:void 0,text:void 0,domNode:null}}return e}function LLt(t,e,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=t,NV.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),r.addHandles(Ni(()=>A4e(t))),queueMicrotask(()=>{o[C4e].projector.renderNow()})}function DLt(t,e,i,{widgetProperties:r}){var n;const s=NV.get(t);s&&(s.set(r),(n=s.afterUpdate)==null||n.call(s,s,t))}function A4e(t){var i;const e=NV.get(t);e&&((i=e.afterRemoved)==null||i.call(e,e,t),e.destroy(),NV.delete(t))}function FV(t){return typeof t=="function"&&t[E4e]}const G0e=new Set;function NLt(t){G0e.add(t),t.finally(()=>G0e.delete(t))}var P4e;const FLt="esri.widgets.Widget";let kLt=0;function O4e(t,e){const i=Object.prototype.hasOwnProperty;for(const r in e)i.call(e,r)&&i.call(t,r)&&(t[r]!=null&&e[r]!=null&&typeof t[r]=="object"&&typeof e[r]=="object"?O4e(t[r],e[r]):t[r]=e[r]);return t}const ULt=P3t({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(r,s,n,o)=>{const a=e==null?void 0:e(r,s,n,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const c=r[2].toLowerCase()+r.slice(3),u=m=>a==null?void 0:a.call(n,m);n.addEventListener(c,u,l);const d=()=>n.removeEventListener(c,u,l),p=o.afterRemoved;o.afterRemoved=m=>{p==null||p(m),d()}}return a}},handleInterceptedEvent(t,e,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(qTe(),t.scheduleRender(),l[a].call(l.bind||i,r))}});let Wq=!1,jo=class extends BA(cn.EventedAccessor){constructor(e,i){super(e,i),this._attached=!1,this._projector=ULt,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=eB(async()=>{var l;if((l=this._messageBundleProps)!=null&&l.length){const c=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:u,propertyName:d})=>{if(this.destroyed)return;let p=await Jxe(u);this.uiStrings&&Object.keys(this.uiStrings)&&(p=O4e(Q(p),this.uiStrings)),this[d]=p}));if(this.destroyed)return;for(const u of c)u.status==="rejected"&&ie.getLogger(this).error("widget-intl:locale-error",this.declaredClass,u.reason)}await this.loadLocale()}),RLt();const r="esri-widget-uid-"+qL(),s=this.render.bind(this);this._trackingTarget=new tB(()=>{this.autoRenderingEnabled&&this.scheduleRender()});const n=()=>({vnodeSelector:"div",properties:{key:`${r}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),o=()=>{var d,p;if(!this._readyForTrueRender||this.destroyed)return null;const l=s()??n(),c=l.properties??(l.properties={});if(c.key??(c.key=r),FV(l.vnodeSelector)){if(!this.visible)return n()}else this.visible?c.styles||(c.styles={}):(c.class="",c.styles={display:"none"}),(d=c.styles).display??(d.display="");let u=0;return(p=l.children)==null||p.forEach(m=>{var g;FV(m.vnodeSelector)||(m.properties??(m.properties={}),(g=m.properties).key??(g.key=`${this.id}--${u++}`))}),M4e(this,l)};this.render=()=>{if(Wq)return o();let l=DWe(this)??null;if(l)return l;this._trackingTarget.clear(),Wq=!0;try{l=w0(this._trackingTarget,o)}catch(c){throw ie.getLogger(this).error(c),c}finally{Wq=!1}return l&&NWe(this,l),l};const a=this.beforeFirstRender();a?this._resourcesFetch=a.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),NLt(this._resourcesFetch)}normalizeCtorArgs(e,i){const r={...e};return i&&(r.container=i),r}postInitialize(){}beforeFirstRender(){var i;const e=this.loadDependencies();return(i=this._messageBundleProps)!=null&&i.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(Noe):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(Le(this._trackingTarget),Le(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,b6(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return gB(e)}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){var e;return this._get("id")||((e=this.container)==null?void 0:e.id)||Date.now().toString(16)+"-widget-"+kLt++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(P4e=E4e,C4e)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(b6(this),this._projector.scheduleRender())}own(e){Jve(ie.getLogger(this),"`Widget.own()` is deprecated in favor of 'Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(e)}classes(...e){return FWe.apply(this,e)}renderNow(){b6(this),this._projector.renderNow()}_postInitialize(){var i;if(this.destroyed)return;this.scheduleRender(),(i=this._delegatedEventNames)!=null&&i.length&&this.addHandles(ue(()=>this.viewModel,(r,s)=>{s&&this.removeHandles("delegated-events"),r&&XV(r)&&this.addHandles(this._delegatedEventNames.map(n=>PA(r,n,o=>{this.emit(n,o)})),"delegated-events")},sr)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(Noe),this.scheduleRender()};this.addHandles([qwe(e),ue(()=>this.uiStrings,e),vu(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var i;this._attached&&(this._projector.detach(this.render),this._attached=!1),(i=e==null?void 0:e.parentNode)==null||i.removeChild(e)}};jo[P4e]=!0,h([f()],jo.prototype,"_readyForTrueRender",void 0),h([f({value:null})],jo.prototype,"container",null),h([Li("container")],jo.prototype,"castContainer",null),h([f()],jo.prototype,"icon",null),h([f()],jo.prototype,"id",null),h([f()],jo.prototype,"label",null),h([f()],jo.prototype,"renderable",null),h([f()],jo.prototype,"uiStrings",void 0),h([f()],jo.prototype,"viewModel",void 0),h([f({value:!0})],jo.prototype,"visible",null),h([f()],jo.prototype,"key",void 0),h([f()],jo.prototype,"children",void 0),h([f()],jo.prototype,"afterCreate",void 0),h([f()],jo.prototype,"afterUpdate",void 0),h([f()],jo.prototype,"afterRemoved",void 0),jo=h([I(FLt)],jo);const Cj=jo;let _k,vk=null;const dM=new Map;async function fri(t){vk==null&&(_k==null&&(_k=fe(()=>import("./Lyr3DWasmPerSceneView-mxoAUeaF.js"),__vite__mapDeps([196,62,71,63,115]))),vk=await _k);const e=t.view;let i=dM.get(e);return i||(i=new vk.default({view:e}),dM.set(e,i)),await i.initializeWasm(),i.add3DTilesLayerView(t)}function zLt(t){return dM.get(t)}function mri(t){const e=t.view,i=dM.get(e);i&&i.remove3DTilesLayerView(t)<1&&(dM.delete(e),dM.size===0&&(_k=null,vk=null))}function j0e(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function VLt(t,e){return t.length!==e.length||t.some((i,r)=>i.text!==e[r].text)}function gO(t,e,i){!i||!e||t.find(r=>r.layerView===e&&r.text===i)||t.push({text:i,layerView:e})}function BLt(t){return t.type==="bing-maps"}const dy=[];let RE=class extends Re{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new tt,this.view=null,this._allLayerViewsChange=i=>{var s;this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const r=(s=this.view)==null?void 0:s.allLayerViews;r&&(this.addHandles(r.map(n=>ue(()=>{var o;return[n.suspended,(o=n.layer)==null?void 0:o.attributionVisible]},()=>this._updateAttributionItems())).toArray(),"suspension"),r.forEach(n=>{n.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(n.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),i!=null&&i.removed&&i.removed.forEach(n=>{this._pendingAttributions.delete(n),this._fetchedAttributionData.delete(n)}),this._updateAttributionItems()},this.addHandles([Ta(()=>{var i;return(i=this.view)==null?void 0:i.allLayerViews},"change",i=>this._allLayerViewsChange(i),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),vu(()=>{var i;return((i=this.view)==null?void 0:i.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){var e;return(e=this.view)!=null&&e.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,i=e==null?void 0:e.allLayerViews;if(dy.length=0,!e||!i)return void this._clear();i.forEach(s=>{var a,l;if(s.suspended||!((a=s.layer)!=null&&a.attributionVisible))return;const n=s.layer;if(j0e(n,"user"))return void gO(dy,s,n.copyright);if(n.hasAttributionData){if(this._fetchedAttributionData.has(s)){const c=this._fetchedAttributionData.get(s);return void(c?gO(dy,s,this._getDynamicAttribution(c,e,n)):j0e(n)&&gO(dy,s,n.copyright))}return void this._fetchAttributionData(s)}const o="portalItem"in n?(l=n.portalItem)==null?void 0:l.accessInformation:void 0;gO(dy,s,o||n.copyright)});const r=i.find(s=>{var n;return((n=s.layer)==null?void 0:n.type)==="integrated-mesh-3dtiles"});if(this.view&&r){const s=zLt(this.view);if(s){const n=s.getAttributionText();for(let o=0;o<n.length;++o)gO(dy,r,n[o])}}VLt(this.items,dy)&&(this.items.removeAll(),this.items.addMany(dy)),dy.length=0,this.notifyChange("state")}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const i=await Vd(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=i.ok?this._createContributionIndex(i.value,BLt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,i){const r=e.contributors,s={};if(!r)return s;for(let n=0;n<r.length;n++){const o=r[n],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,u=l.zoomMin-(i&&l.zoomMin?1:0),d=l.zoomMax-(i&&l.zoomMax?1:0),p=new gi({xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:We.WGS84}),m={extent:lS(p),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:n};for(let g=u;g<=d;g++)s[g]??(s[g]=[]),s[g].push(m)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(e,i,r){var u;const{extent:s,scale:n}=i;let o=((u=r.tileInfo)==null?void 0:u.scaleToZoom(n))??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!s||o==null||o<=-1)return"";const a=e[o],l=W3(s.center.clone().normalize(),i.spatialReference),c=new Set;return a?a.filter(d=>{const p=d.id,m=!c.has(p)&&l&&d.extent&&gee(d.extent,l);return m&&c.add(p),m}).sort((d,p)=>p.score-d.score||d.objectId-p.objectId).map(d=>d.attribution).join(", "):""}};h([f({readOnly:!0,type:tt})],RE.prototype,"items",void 0),h([f({readOnly:!0})],RE.prototype,"state",null),h([f()],RE.prototype,"view",void 0),RE=h([I("esri.widgets.Attribution.AttributionViewModel")],RE);const R4e=RE,vg={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};function GLt(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:HLt(t[e])}}}function jLt(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function HLt(t){return function(e,...i){jLt(e)?BWe(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...i)}}function Mj(t){return(e,i)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var qLt=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},$4e=function(t,e){for(var i=0,r=t.length;i<r;i++){var s=t[i];Array.isArray(s)?$4e(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=qLt(s)),e.push(s))}},WLt=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var s=[];return $4e(i,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function du(t,e,...i){return typeof t!="function"||FV(t)?WLt(t,e,...i):t(e,...i)}function yri(...t){return t}const H2="esri-attribution",q2={base:H2,poweredBy:`${H2}__powered-by`,sources:`${H2}__sources`,open:`${H2}--open`,sourcesOpen:`${H2}__sources--open`,link:`${H2}__link`};let cc=class extends Cj{constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new R4e}initialize(){this.addHandles(Ta(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[q2.open]:this._isOpen};return du("div",{bind:this,class:this.classes(q2.base,vg.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return du("div",{class:q2.poweredBy},"Powered by"," ",du("a",{class:q2.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,r=i?0:void 0,{attributionText:s}=this,n={[q2.sourcesOpen]:e,[vg.interactive]:i};return du("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(q2.sources,n),innerHTML:s,tabIndex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:r,clientWidth:s,scrollWidth:n}=e,o=n>s,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(i=!0),this._isOpen){const l=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,l&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};h([f()],cc.prototype,"_isOpen",void 0),h([f()],cc.prototype,"_isInteractive",null),h([f()],cc.prototype,"_attributionTextOverflowed",void 0),h([f()],cc.prototype,"_prevSourceNodeHeight",void 0),h([f({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],cc.prototype,"attributionText",null),h([f()],cc.prototype,"icon",null),h([f()],cc.prototype,"itemDelimiter",void 0),h([f()],cc.prototype,"label",null),h([f(),Mj("esri/widgets/Attribution/t9n/Attribution")],cc.prototype,"messages",void 0),h([f()],cc.prototype,"view",null),h([f({type:R4e})],cc.prototype,"viewModel",void 0),h([GLt()],cc.prototype,"_toggleState",null),cc=h([I("esri.widgets.Attribution")],cc);const YLt=cc;function ZLt(t){var e,i;return((e=t==null?void 0:t.spatialReference)==null?void 0:e.isWebMercator)||((i=t==null?void 0:t.spatialReference)==null?void 0:i.isGeographic)||!1}const XLt=t=>{let e=class extends t{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return YV(r),this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return h([f()],e.prototype,"goToOverride",void 0),h([f()],e.prototype,"view",void 0),e=h([I("esri.widgets.support.GoTo")],e),e};let lx=class extends XLt(Re){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(ue(()=>this.view,this._updateRotationWatcher,cr))}destroy(){this.view=null}get canShowNorth(){return ZLt(this.view)}get state(){var e;return!((e=this.view)!=null&&e.ready)||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){var e,i;(e=this.view)!=null&&e.ready&&(((i=this.view)==null?void 0:i.type)==="2d"?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:re("mapview-essential-goto-duration")}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(e){e!=null&&this._set("orientation",{z:e})}_updateForCamera(e){if(!e)return;const i=-e.heading;this._set("orientation",{x:0,y:0,z:i})}_updateRotationWatcher(e){this.removeAllHandles(),e&&this.addHandles(e.type==="2d"?ue(()=>e==null?void 0:e.rotation,this._updateForRotation,cr):ue(()=>e==null?void 0:e.camera,this._updateForCamera,cr))}};h([f({readOnly:!0})],lx.prototype,"canShowNorth",null),h([f({readOnly:!0})],lx.prototype,"orientation",void 0),h([f({readOnly:!0})],lx.prototype,"state",null),h([f()],lx.prototype,"view",void 0),lx=h([I("esri.widgets.Compass.CompassViewModel")],lx);const I4e=lx,H0e="esri-compass",q0e={base:H0e,iconContainer:`${H0e}__icon-container`};let Py=class extends Cj{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new I4e,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=r=>({transform:`rotateZ(${r.z}deg)`})}loadDependencies(){return yne({button:()=>fe(()=>import("./calcite-button-DmitS5rx.js"),__vite__mapDeps([197,198,199,200,201,202,203,204,205,206,207,208,209])),icon:()=>fe(()=>import("./calcite-icon-BAgyF0eh.js"),__vite__mapDeps([210,208,199,200,207]))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return this.viewModel.state==="rotation"?"arrow-up":"compass-needle"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:i}=this.viewModel,{messages:r}=this;return du("div",{class:this.classes(q0e.base,vg.widget)},du("calcite-button",{class:vg.widgetButton,disabled:i==="disabled",kind:"neutral",label:r.reset,onclick:this._reset,round:!0,scale:"s",title:r.reset},du("div",{"aria-hidden":"true",class:q0e.iconContainer,title:r.reset},du("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(e)}))))}};h([f()],Py.prototype,"goToOverride",null),h([f()],Py.prototype,"icon",null),h([f()],Py.prototype,"label",null),h([f(),Mj("esri/widgets/Compass/t9n/Compass")],Py.prototype,"messages",void 0),h([f()],Py.prototype,"view",null),h([f({type:I4e})],Py.prototype,"viewModel",void 0),Py=h([I("esri.widgets.Compass")],Py);const JLt=Py,W0e="esri-navigation-toggle",Y0e={base:W0e,isLayoutHorizontal:`${W0e}--horizontal`};let $E=class extends Re{constructor(e){super(e),this._navigationMode="pan",this.view=null}initialize(){this.addHandles(vu(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e,i;return(e=this.view)!=null&&e.ready&&((i=this.view)==null?void 0:i.type)==="3d"?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(e){this._navigationMode=e,this._setNavigationMode()}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate")}_setNavigationMode(){var i;const e=(i=this.view)==null?void 0:i.inputManager;e&&(e.primaryDragAction=this._navigationMode==="pan"?"pan":"rotate")}};h([f({readOnly:!0})],$E.prototype,"state",null),h([f()],$E.prototype,"_navigationMode",void 0),h([f()],$E.prototype,"view",void 0),$E=h([I("esri.widgets.NavigationToggle.NavigationToggleViewModel")],$E);const L4e=$E;let Oy=class extends Cj{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new L4e,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{var s;const r=((s=this.viewModel)==null?void 0:s.navigationMode)==="pan"?this._rotateButton:this._panButton;r==null||r.setFocus(),this.toggle()}}loadDependencies(){return yne({button:()=>fe(()=>import("./calcite-button-DmitS5rx.js"),__vite__mapDeps([197,198,199,200,201,202,203,204,205,206,207,208,209]))})}get icon(){return"move"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){var s,n;const e=((s=this.viewModel)==null?void 0:s.state)==="disabled",i=((n=this.viewModel)==null?void 0:n.navigationMode)==="pan",r=this.messages.toggle;return du("div",{class:this.classes(Y0e.base,vg.widget,{[Y0e.isLayoutHorizontal]:this.layout==="horizontal"})},du("calcite-button",{afterCreate:o=>{this._panButton=o},appearance:i?"outline-fill":"solid",class:vg.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?void 0:-1,title:r}),du("calcite-button",{afterCreate:o=>{this._rotateButton=o},appearance:i?"solid":"outline-fill",class:vg.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?-1:void 0,title:r}))}};h([f()],Oy.prototype,"icon",null),h([f()],Oy.prototype,"label",null),h([f({value:"vertical"})],Oy.prototype,"layout",null),h([f(),Mj("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Oy.prototype,"messages",void 0),h([f()],Oy.prototype,"view",null),h([f({type:L4e})],Oy.prototype,"viewModel",void 0),Oy=h([I("esri.widgets.NavigationToggle")],Oy);const QLt=Oy;let cx=class extends Re{get canZoomIn(){var r,s,n;if(!((r=this.view)==null?void 0:r.ready))return!1;const i=(n=(s=this.view)==null?void 0:s.constraints)==null?void 0:n.effectiveMaxScale;return i===0||this._scale>i}get canZoomOut(){var s;const{view:e}=this;if(!(e==null?void 0:e.ready))return!1;const r=(s=e.constraints)==null?void 0:s.effectiveMinScale;return r===0||this._scale<r}get _scale(){var i,r,s;const e=(r=(i=this.view)==null?void 0:i.animation)==null?void 0:r.target;return(e&&"then"in e||e==null?void 0:e.scale)??((s=this.view)==null?void 0:s.scale)??0}};h([f({readOnly:!0})],cx.prototype,"canZoomIn",null),h([f({readOnly:!0})],cx.prototype,"canZoomOut",null),h([f()],cx.prototype,"view",void 0),h([f()],cx.prototype,"_scale",null),cx=h([I("esri.widgets.Zoom.ZoomConditions2D")],cx);const KLt=cx;let IE=class extends Re{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};h([f({readOnly:!0})],IE.prototype,"canZoomIn",null),h([f({readOnly:!0})],IE.prototype,"canZoomOut",null),h([f()],IE.prototype,"view",void 0),IE=h([I("esri.widgets.Zoom.ZoomConditions3D")],IE);const eDt=IE;let pv=class extends Re{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return this._zoomConditions!=null&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new KLt({view:e}):e.type==="3d"&&(this._zoomConditions=new eDt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():OI(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():OI(e.goTo({zoomFactor:.5}))}};h([f()],pv.prototype,"_zoomConditions",void 0),h([f()],pv.prototype,"canZoomIn",null),h([f()],pv.prototype,"canZoomOut",null),h([f({readOnly:!0})],pv.prototype,"state",null),h([f()],pv.prototype,"view",null),pv=h([I("esri.widgets.Zoom.ZoomViewModel")],pv);const D4e=pv,Z0e={base:"esri-zoom",horizontalLayout:"esri-zoom--horizontal"};let Ry=class extends Cj{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new D4e,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return yne({button:()=>fe(()=>import("./calcite-button-DmitS5rx.js"),__vite__mapDeps([197,198,199,200,201,202,203,204,205,206,207,208,209]))})}get icon(){return"magnifying-glass-plus"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e={[Z0e.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:r}=this.viewModel,{zoomIn:s,zoomOut:n}=this.messages;return du("div",{class:this.classes(Z0e.base,vg.widget,e)},du("calcite-button",{class:vg.widgetButton,disabled:!i,iconStart:"plus",kind:"neutral",label:s,onclick:this.zoomIn,title:s}),du("calcite-button",{class:vg.widgetButton,disabled:!r,iconStart:"minus",kind:"neutral",label:n,onclick:this.zoomOut,title:n}))}};h([f()],Ry.prototype,"icon",null),h([f()],Ry.prototype,"label",null),h([f({value:"vertical"})],Ry.prototype,"layout",null),h([f(),Mj("esri/widgets/Zoom/t9n/Zoom")],Ry.prototype,"messages",void 0),h([f()],Ry.prototype,"view",null),h([f({type:D4e})],Ry.prototype,"viewModel",void 0),Ry=h([I("esri.widgets.Zoom")],Ry);const tDt=Ry;function iDt(t){return(t==null?void 0:t.view)!==void 0}let bk=class extends w3t{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=i=>{this.components.forEach(r=>{const s=this._find(r),n=s==null?void 0:s.widget;iDt(n)&&(n.view=i)})},this._componentsWatcher=(i,r)=>{this._removeComponents(r),this._addComponents(i),this._adjustPadding(i)}}initialize(){this.addHandles([ue(()=>this.components,this._componentsWatcher,cr),ue(()=>this.view,this._updateViewAwareWidgets,cr)])}_add(e,i,r,s,n){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,i,r,s,n)}_removeComponents(e){e.forEach(i=>{const r=this._find(i);r&&(this.remove(r),r.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:i}=this.padding;this.padding=i}}_addComponents(e){this.constructed&&e.forEach(i=>this.add(this._createComponent(i),this._defaultPositionLookup[i]))}_createComponent(e){const i=this._createWidget(e);return new yk({id:e,node:i})}_createWidget(e){const i=this.view;switch(e){case"attribution":return new YLt({view:i});case"compass":return new JLt({view:i});case"navigation-toggle":return new QLt({view:i});case"zoom":return new tDt({view:i})}}};h([f()],bk.prototype,"components",void 0),bk=h([I("esri.views.ui.DefaultUI")],bk);const N4e=bk;let wk=class extends N4e{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};h([f()],wk.prototype,"components",void 0),wk=h([I("esri.views.ui.3d.DefaultUI3D")],wk);const F4e=wk;let st=class extends B7e(LXe(rYe(Qet))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new C0({slicePlane:lTe},this),this._resourceController=nCt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new yX({view:this}),this.labeler=new tx({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new GM,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new Ax,this.environment=new mE,this.environmentManager=new Cp,this.floors=new tt,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new ttt({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new iEt,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new F4e,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new DDe,XHe();const i=(r=null)=>{r!=null&&r.type===Ar.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async s=>{try{await s.when()}catch{}this._updatingChanged()}))};this.addHandles([Ta(()=>{var r;return(r=this.map)==null?void 0:r.allLayers},"after-changes",r=>i(r),{onListenerAdd:()=>i(),onListenerRemove:()=>i(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),ue(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new $ct({view:this}),this.stateManager=new Ks({view:this})}initialize(){this.groundView=new wXe({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.addHandles(Ta(()=>{var i;return(i=this.map)==null?void 0:i.allLayers},"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,i=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=i)},cr),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,i=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=i)},cr),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,i=>Gze(i>0?1e3/Math.ceil(i):0),cr),this.updatingHandles.add(()=>{var i;return(i=this.map)==null?void 0:i.ground},e,sr),this.updatingHandles.add(()=>{var i,r;return(r=(i=this.map)==null?void 0:i.ground)==null?void 0:r.opacity},()=>this._updateDefaultHitTestOptions(),sr),this.addHandles(ue(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),ar))}destroy(){var e;this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Le(this.sharedSymbolResources),this._set("labeler",Le(this.labeler)),this._set("deconflictor",Le(this.deconflictor)),this._resourceController=Le(this._resourceController),this._set("stateManager",Le(this.stateManager)),this._set("inputManager",Le(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Le(this.environmentManager)),this._set("environment",Le(this.environment)),this.groundView=Le(this.groundView),this._exitBasemapTerrain(),(e=this._stage)==null||e.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var e;return(e=this.basemapTerrain)==null?void 0:e.spatialReference}get animation(){var e;return(e=this.state)==null?void 0:e.animation}get camera(){var e;return(e=this.stateManager)==null?void 0:e.camera}set camera(e){this.stateManager&&(this.stateManager.camera=e)}get contentCamera(){var e;return(e=this.stateManager)==null?void 0:e.contentCamera}set contentCamera(e){this.stateManager&&(this.stateManager.contentCamera=e)}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get center(){var e;return(e=this.stateManager)==null?void 0:e.center}set center(e){this.stateManager&&(this.stateManager.center=e)}get clippingArea(){if(this.viewingMode==="global")return null;const e=this.map;let i=this._userClippingArea||Moe(e,"clippingArea");return!this._userClippingArea&&!Moe(e,"clippingEnabled")||i==null?(this._clippingArea=null,null):i instanceof gi?this.spatialReference&&(i=e4(i,this.spatialReference),i==null)?(ie.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(i=i.clone(),i.intersection(this._groundAndLayersExtent)==null&&(i.xmin=i.xmax,i.ymin=i.ymax),i.zmin=void 0,i.zmax=void 0,i.equals(this._clippingArea)||(this._clippingArea=i),this._clippingArea):(ie.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&e!=null?ie.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===Ge.Global)return null;const e=this.renderSpatialReference,i=this.dataExtent;return i==null||e==null||i.spatialReference.equals(e)?i:e4(i,e)}get tileInfo(){var e,i;return(i=(e=this.basemapTerrain)==null?void 0:e.tilingScheme)==null?void 0:i.toTileInfo()}get dataExtent(){let e=this._groundAndLayersExtent;const i=this.spatialReference||We.WGS84,r=e4(this.clippingArea,i);r!=null&&(e=e!=null?e.intersection(r):r);const s=this._get("dataExtent");return e!=null&&e.equals(s)?s:e}get _groundAndLayersExtent(){const e=this.spatialReference||We.WGS84;let i;const r=o=>{const a=e4(o,e);a!=null&&(i!=null?i.union(a):i=a.clone())},s=this.basemapTerrain;if(s!=null&&s.spatialReference){const o=s.groundExtent;r(new gi({xmin:o[0],ymin:o[1],zmin:0,xmax:o[2],ymax:o[3],zmax:0,spatialReference:s.spatialReference}))}if(this.map){const o=a=>{a.fullExtent==null||a.type==="graphics"&&a.internal||r(a.fullExtent)};this.map.allLayers.forEach(a=>o(a))}if(i==null)return null;i.hasZ?(i.zmin=Math.min(0,i.zmin??0),i.zmax=Math.max(0,i.zmax??0)):(i.zmin=0,i.zmax=0);const n=this._get("_groundAndLayersExtent");return i.equals(n)?n:i}castEnvironment(e){var i;return e?e instanceof mE?e:e instanceof rMe?((i=this.environment)==null?void 0:i.cloneWithWebsceneEnvironment(e))??mE.fromWebsceneEnvironment(e):Ln(mE,e):new mE}get extent(){var e;return(e=this.stateManager)==null?void 0:e.extent}set extent(e){this.stateManager&&(this.stateManager.extent=e)}get screenCenter(){var e;return(e=this.stateManager)==null?void 0:e.screenCenter}get frustum(){var e;return(e=this.stateManager)==null?void 0:e.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){var e;return this.navigating||(((e=this.toolViewManager)==null?void 0:e.interacting)??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){var e;return((e=this.state)==null?void 0:e.navigating)??!1}get padding(){var e;return(e=this.stateManager)==null?void 0:e.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}set qualityProfile(e){J5.isValidProfile(e)&&(J5.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||J5.getDefaultProfile()}set slicePlane(e){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:e}),e==null)return void this._set("slicePlane",null);const i=this._propertiesPool.get("slicePlane");bT(e,i),this._set("slicePlane",i)}get typeSpecificPreconditionsReady(){var e;return!!this.viewingMode&&!!((e=this.stateManager)!=null&&e.preinit(this.spatialReference))}get resolution(){return this.spatialReference!=null?O7e(this.scale,this.spatialReference):0}get scale(){var e;return(e=this.stateManager)==null?void 0:e.scale}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get terrainScale(){var e;return(e=this.stateManager)==null?void 0:e.terrainScale}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return e!=null?gT.deriveUnitFromSR(e,this.spatialReference):null}get updating(){var n,o,a,l;if(this.destroyed)return!1;let e=0,i=this.layerViewManager.updating,r=i?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(c=>{if(c.isFulfilled()){if(c.updating){if(i=!0,c.suspended||mJ(c))return;++r,e+=c.updatingProgress}}else++r});for(const c of this._updatingObjects)c!=null&&c.updating&&(r+=.1,e+=.5*.1);for(const c of this._updatingObjectsWithProgress)c!=null&&c.updating&&(++r,e+=c.updatingProgress);const s=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(i=!!(i||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||s||this._createGraphicsViewController||(n=this.inputManager)!=null&&n.updating||(a=(o=this.map)==null?void 0:o.allLayers)!=null&&a.some(c=>!c.isFulfilled())||(l=this.textures)!=null&&l.updating),i?(this._numUpdating=Math.max(r,this._numUpdating),e+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=i?0:1,this._get("updatingProgress")!==e){const c=performance.now();if(e<1){const u=Math.min((c-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-u)+e*u}this._set("updatingProgress",e),this._lastUpdateTime=i&&e<1?c:0}return i}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var r;const e=this._predeterminedViewingMode;if(e!=null)return S6(e);const i=this.spatialReference;return i?((r=this.defaultsFromMap)==null?void 0:r.viewingMode)!=null&&i.equals(this.defaultsFromMap.spatialReference)?S6(this.defaultsFromMap.viewingMode):W7(i,Ge.Global)?"global":"local":"global"}set viewingMode(e){this.ready?ie.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",e)}get viewpoint(){var e;return(e=this.stateManager)==null?void 0:e.viewpoint}set viewpoint(e){this.stateManager&&(this.stateManager.viewpoint=e)}get zoom(){return this.stateManager.zoom}set zoom(e){this.stateManager&&(this.stateManager.zoom=e)}get resourceController(){return this._resourceController}get quality(){var e,i;return((i=(e=this._resourceController)==null?void 0:e.memoryController)==null?void 0:i.memoryFactor)??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new lCt(this)}on(e,i,r,s){return this.viewEvents.on(e,i,r,s)||super.on(e,i)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,i){if(!this.ready)return ie.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=Jce(e)?Xce(this,e):e;return bEt(this,r,i,this._defaultToMapOptions)}toScreen(e){if(!this.ready)return ie.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const i=(e.z==null?Qm(this.elevationProvider,e):null)??0;return il(e,t4,this.renderSpatialReference,i),this.state.camera.projectToScreen(t4,Yq),Bd(Yq[0],Yq[1])}pixelSizeAt(e){return this.ready?e?(il(e,t4,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(t4)):0:(ie.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const i=this.basemapTerrain.overlayManager;return i?i.overlayPixelSizeInMapUnits(e,()=>this.pixelSizeAt(e)):1}hitTest(e,i){if(!this.ready)return ie.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=Jce(e)?Xce(this,e):e;return vEt(this,r,i,this._defaultHitTestOptions)}async popupHitTest(e){return UEt(this,e)}goTo(e,i){return this.updatingHandles.addPromise(this.stateManager.goTo(e,i))}async whenAnalysisView(e){if(e.parent==null)throw new V("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});switch(e.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(e.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(e)}}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const i=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(i);return Vq(r,i,this._pixelFormat())}async _takeScreenshot(e){const i=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(i);return Bq(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(e){const i=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(i);return[Bq(r[0],this._pixelFormat()),Bq(r[1],this._pixelFormat())]}_completeSettings(e){const i=zIt(e,this);return i.pixelRatio/=this.state.pixelRatio,jIt(i,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){}async takeScreenshotWithObjectAndLayerId(e){if(!re("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const i=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(i),s=Vq(r[0],i,this._pixelFormat()),n=this._completeSettings(e);return n.format="png",[s,Vq(r[1],n,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return nue.importLayerView(e)}hasLayerViewModule(e){return nue.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,i,r;return this.map&&"initialViewProperties"in this.map&&((e=this.map.initialViewProperties)==null?void 0:e.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let e=h3t(this.type);const i=re("safari");if(i&&i<9&&(e=new V("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:i})),e!=null)throw ie.getLogger(this).warn("#validate()",e.message),e}get _predeterminedViewingMode(){var i;const e=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(i=this.map.initialViewProperties)==null?void 0:i.viewingMode:null)??null;return e!=null?Hle(e):null}getSpatialReferenceSupport(e,i){const r=this._predeterminedViewingMode;if(r!=null)return this._validateSpatialReferenceForViewingMode(e,i,r)?{constraints:this._makeSpatialReferenceConstraints(e,i,r)}:null;const s=this._validateSpatialReferenceForViewingMode(e,i,Ge.Local),n=this._validateSpatialReferenceForViewingMode(e,i,Ge.Global);return s||n?s&&n?{constraints:this._makeSpatialReferenceConstraints(e,i,null)}:s?{constraints:this._makeSpatialReferenceConstraints(e,i,Ge.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,i,Ge.Global)}:null}_validateSpatialReferenceForViewingMode(e,i,r){return!!W7(e,r)&&(i==null||!!Ile(i)||(!z$(i)||xj(i,e,r)!=null)&&(!$le(i)||r!==Ge.Global))}_makeSpatialReferenceConstraints(e,i,r){if(i==null)return[{spatialReference:e,viewingMode:r}];const{isWebMercator:s,isWGS84:n}=e;return Ile(i)&&(s||n)?!n||r===Ge.Local||Dse(i.tileInfo,i.fullExtent,e,Ge.Global)===null?[{spatialReference:e,viewingMode:r},{spatialReference:We.WebMercator,viewingMode:r}]:[{spatialReference:s?We.WGS84:We.WebMercator,viewingMode:r}]:z$(i)||$le(i)||!s&&!n?z$(i)&&s&&r!==Ge.Global?[{spatialReference:e,viewingMode:r},{spatialReference:We.WGS84,viewingMode:Ge.Local}]:[{spatialReference:e,viewingMode:r}]:[{spatialReference:e,viewingMode:r},{spatialReference:s?We.WGS84:We.WebMercator,viewingMode:r}]}_validateSpatialReference(e){const i=this.getSpatialReferenceSupport(e)!=null,r=this._predeterminedViewingMode;return i||(r!=null?ie.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${S6(r)} viewing mode.`):e.isGeographic&&ie.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),i}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}trackGraphicState(e){if(!e.graphic)return ie.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const i=this.getViewForGraphic(e.graphic);let r=null,s=!1;const n=o=>{var a;!s&&o!=null&&"processor"in o&&((a=o.processor)==null?void 0:a.type)==="graphics-3d"&&o.processor.graphicsCore&&(r=o.processor.graphicsCore.trackGraphicState(e))};return i!=null?n(i):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(o=>n(o),()=>{}).catch(()=>{}),Ni(()=>{s=!0,r!=null&&(r.remove(),r=null)})}highlight(e){if(Array.isArray(e))return PS(e.map(r=>this.highlight(r)));if(tt.isCollection(e))return PS(e.toArray().map(r=>this.highlight(r)));const i=this.getViewForGraphic(e);return i&&"highlight"in i?i.highlight(e):Ni()}maskOccludee(e){if(!e)return ie.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const i=this.getViewForGraphic(e);let r=null,s=!1;const n=o=>{!s&&o!=null&&n3t(o)&&(r=o.maskOccludee(e))};return i!=null?n(i):this.whenViewForGraphic(e,{waitForLayer:!0}).then(o=>n(o),()=>{}).catch(()=>{}),Ni(()=>{s=!0,r!=null&&(r.remove(),r=null)})}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find(i=>i.layer===e.layer):null}graphicChanged(e){this.graphicsView!=null&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,i){if(e.layer===this)return await zI(()=>this.graphicsView),this.graphicsView;if(!e.layer||!this.map)throw new V("no-view-for-graphic");return i&&i.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((r,s)=>{const n=this.map.allLayers.on("change",o=>{o.added.includes(e.layer)&&(n.remove(),this.whenLayerView(e.layer).then(r,s))})}):this.whenLayerView(e.layer)}_initBasemapTerrain(){this._set("basemapTerrain",new GPt({view:this})),this._set("elevationProvider",new KR({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new hc({view:this})),this._set("featureTiles",new qo({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{var r;const i=(r=this.basemapTerrain)==null?void 0:r.extent;if(this.clippingArea||i)if(i&&this.basemapTerrain.spatialReference){const s=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?ib(pB(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(s):this.featureTiles.filterExtent=s}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>Rr.FEATURE_TILE_TREE_SHOW_TILES,i=>{i&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(fe(()=>import("./FeatureTileTree3DDebugger-C2yV-hVh.js"),__vite__mapDeps([211,193]))).then(({FeatureTileTree3DDebugger:r})=>{!this._featureTreeDebugger&&Rr.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new r({view:this}))}):i||!this._featureTreeDebugger||Rr.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},sr),this.updatingHandles.add(()=>this.clippingArea,e,sr),this.updatingHandles.add(()=>this.basemapTerrain.extent,e,sr)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new NEt(this.map,e));const i=this.state.isGlobal,r=P7e(i,e);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",GEt.create(this.state.viewingMode,r)),i||this.addHandles(ue(()=>{var s;return(s=this.basemapTerrain)==null?void 0:s.extent},s=>{const n=this.renderCoordsHelper.spatialReference;s==null||s[0]===0&&s[1]===0&&s[2]===0&&s[3]===0||!AB(s,this.basemapTerrain.spatialReference,X0e,n)||(this.renderCoordsHelper.extent=X0e)},ar),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(WM/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){e!=null&&e.type===Ar.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(i=>{i.destroyed||(this.addHandles(ue(()=>[i.updating,i.updatingProgress],()=>this._updatingChanged(),ar),"updatingMonitors"),i.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(e,i,r){if(!this.overlay||!this.overlay.hasVisibleItems)return r;const s=e.getContext("2d");return s.putImageData(r,0,0),this.overlay.renderCanvas(e,{disableDecorations:i===Nl.OFF}),s.getImageData(0,0,r.width,r.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(s,n,o)=>this._renderScreenshotOverlay(s,n,o)}},i=new TEt(this.state.viewingMode,s=>this._stage.layers.forAll(s),this);this._set("sceneIntersectionHelper",i);const r=gB(this.surface);this._stage=new qu({view:this,options:e,container:r}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,s=>this._stage.renderer.setParameters({highQualityTransparency:s}),cr),this.on("pointer-move",()=>{var s;return(s=this._stage)==null?void 0:s.renderer.resetAnimation()}),PA(this._stage.renderView.canvas,"webglcontextlost",s=>{this.fatalError=new V("webgl-context-lost",s.statusMessage)})],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(WM/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Le(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new dCt({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const i=(await fe(async()=>{const{default:r}=await import("./GraphicsView3D-i2l2AHrk.js");return{default:r}},__vite__mapDeps([212,125,110,23,15,16]))).default;Et(e),await zI(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.ready},e),this._set("graphicsView",new i({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=Hle(this.viewingMode);e===Ge.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.addHandles(Ta(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded();const i=this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties:null,r=i==null?void 0:i.environment;r&&tSe(this.environment,r),this.timeExtent=i==null?void 0:i.timeExtent,this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new SC(this._stage,this.resourceController.scheduler));const s=this._resolveWhenReady;this._resolveWhenReady=[],s.forEach(n=>n(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",Le(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(N1);for(const e of this.map.allLayers.items)WI(e.type)&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(N1);for(const e of this.map.allLayers.items)WI(e.type)&&e.opacity<1&&this._defaultHitTestOptions.exclude.add(e.uid)}}};function e4(t,e){return t!=null&&Ac(t.spatialReference,e)?ib(t,e):null}st.type="3d",h([f()],st.prototype,"_userClippingArea",void 0),h([f()],st.prototype,"_resourceController",void 0),h([f()],st.prototype,"_stage",void 0),h([f({readOnly:!0})],st.prototype,"deconflictor",void 0),h([f({readOnly:!0})],st.prototype,"labeler",void 0),h([f(BU(GM,"analyses"))],st.prototype,"analyses",void 0),h([f({type:QM,readOnly:!0})],st.prototype,"animation",null),h([f({readOnly:!0})],st.prototype,"basemapTerrain",void 0),h([f({readOnly:!0})],st.prototype,"elevationProvider",void 0),h([f()],st.prototype,"camera",null),h([f({type:Eh})],st.prototype,"contentCamera",null),h([f({readOnly:!0})],st.prototype,"canvas",void 0),h([f({type:_t})],st.prototype,"center",null),h([f({type:gi})],st.prototype,"clippingArea",null),h([f({type:Ax})],st.prototype,"constraints",void 0),h([f({type:gi,readOnly:!0})],st.prototype,"renderDataExtent",null),h([f({readOnly:!0})],st.prototype,"tileInfo",null),h([f({type:gi,readOnly:!0})],st.prototype,"dataExtent",null),h([f({type:gi,readOnly:!0})],st.prototype,"_groundAndLayersExtent",null),h([f({type:mE})],st.prototype,"environment",void 0),h([Li("environment")],st.prototype,"castEnvironment",null),h([f({readOnly:!0})],st.prototype,"environmentManager",void 0),h([f({type:gi})],st.prototype,"extent",null),h([f()],st.prototype,"floors",void 0),h([f()],st.prototype,"screenCenter",null),h([f()],st.prototype,"frustum",null),h([f({type:Number,readOnly:!0})],st.prototype,"fullOpacity",void 0),h([f({readOnly:!0})],st.prototype,"graphicsView",void 0),h([f({readOnly:!0})],st.prototype,"analysisViewManager",void 0),h([f()],st.prototype,"groundView",void 0),h([f({type:Boolean})],st.prototype,"initialExtentRequired",null),h([f()],st.prototype,"_defaultsFromMapSettings",null),h([f()],st.prototype,"interacting",null),h([f()],st.prototype,"stationary",null),h([f()],st.prototype,"navigating",null),h([f()],st.prototype,"map",void 0),h([f({readOnly:!0})],st.prototype,"mapCoordsHelper",void 0),h([f()],st.prototype,"padding",null),h([f({type:hc,readOnly:!0})],st.prototype,"pointsOfInterest",void 0),h([f({type:qo,readOnly:!0})],st.prototype,"featureTiles",void 0),h([f()],st.prototype,"_featureTreeDebugger",void 0),h([f({type:Boolean})],st.prototype,"screenSizePerspectiveEnabled",void 0),h([f({constructOnly:!0})],st.prototype,"deactivatedWebGLExtensions",void 0),h([f({constructOnly:!0})],st.prototype,"debugWebGLExtensions",void 0),h([f({constructOnly:!0})],st.prototype,"renderCanvas",void 0),h([f({constructOnly:!0})],st.prototype,"state",void 0),h([f({readOnly:!0})],st.prototype,"inputManager",void 0),h([f({readOnly:!0})],st.prototype,"stateManager",void 0),h([f({type:["low","medium","high"]})],st.prototype,"qualityProfile",null),h([f({type:kge,get(){let t=this._get("qualitySettings");return t||(t=new kge,J5.apply(this.qualityProfile,t)),t}})],st.prototype,"qualitySettings",void 0),h([f()],st.prototype,"slicePlane",null),h([f({readOnly:!0})],st.prototype,"typeSpecificPreconditionsReady",null),h([f({readOnly:!0})],st.prototype,"renderCoordsHelper",void 0),h([f({readOnly:!0})],st.prototype,"sceneIntersectionHelper",void 0),h([f({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],st.prototype,"resolution",null),h([f({type:Number})],st.prototype,"scale",null),h([f()],st.prototype,"heightModelInfo",null),h([f()],st.prototype,"spatialReference",void 0),h([f({type:Boolean,constructOnly:!0})],st.prototype,"alphaCompositingEnabled",void 0),h([f({constructOnly:!0})],st.prototype,"preserveDrawingBufferEnabled",void 0),h([f({type:Boolean})],st.prototype,"supersampleScreenshotsEnabled",void 0),h([f({readOnly:!0})],st.prototype,"type",void 0),h([f(),Li(t=>t instanceof N4e?t:$S(F4e,t))],st.prototype,"ui",void 0),h([f({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],st.prototype,"updating",null),h([f()],st.prototype,"_updatingObjects",null),h([f()],st.prototype,"_updatingObjectsWithProgress",null),h([f({type:Number,readOnly:!0,dependsOn:["updating"]})],st.prototype,"updatingProgress",void 0),h([f({type:["global","local"]})],st.prototype,"viewingMode",null),h([f({type:M1})],st.prototype,"viewpoint",null),h([f({type:Number})],st.prototype,"zoom",null),h([f({type:DDe})],st.prototype,"highlightOptions",void 0),h([f({readOnly:!0})],st.prototype,"quality",null),h([f({readOnly:!0})],st.prototype,"resolutionScale",null),h([f()],st.prototype,"textures",void 0),st=h([I("esri.views.SceneView")],st);const t4=E(),Yq=vs(),X0e=Ht(),rDt=st,sDt={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}},J0e={read:{reader:b3},write:{allowNull:!0,writer:w3}},nDt={json:{read:!1,write:!1,origins:{"web-map":J0e,"portal-item":J0e}}},_ne=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return h([f(sDt)],e.prototype,"blendMode",void 0),h([f(nDt)],e.prototype,"effect",void 0),e=h([I("esri.layers.mixins.BlendLayer")],e),e},Aj=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&oDt(i,r.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===i.minScale&&s.maxScale===i.maxScale?s:i}};return h([f({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),h([f({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=h([I("esri.layers.mixins.ScaleRangeLayer")],e),e};function oDt(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}var HJ;let u$=HJ=class extends ye{constructor(t){super(t)}async collectRequiredFields(t,e){return Vl(t,e,this.expression)}clone(){return new HJ({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};h([f({type:String,json:{write:!0}})],u$.prototype,"expression",void 0),h([f({type:String,json:{write:!0}})],u$.prototype,"title",void 0),u$=HJ=h([I("esri.symbols.support.FeatureExpressionInfo")],u$);const Q0e=u$;var qJ;const i4=Bl()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),K0e=new qi({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let $y=qJ=class extends ye{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,i,r){e[i]=t.write({},r),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new qJ({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&nze(this.featureExpressionInfo,t.featureExpressionInfo)}};h([f({type:Q0e,json:{write:!0}})],$y.prototype,"featureExpressionInfo",void 0),h([Ce("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],$y.prototype,"readFeatureExpressionInfo",null),h([Ve("featureExpressionInfo",{featureExpressionInfo:{type:Q0e},"featureExpression.value":{type:[0]}})],$y.prototype,"writeFeatureExpressionInfo",null),h([f({type:i4.apiValues,nonNullable:!0,json:{type:i4.jsonValues,read:i4.read,write:{writer:i4.write,isRequired:!0}}})],$y.prototype,"mode",null),h([f({type:Number,json:{write:!0}})],$y.prototype,"offset",void 0),h([f({type:$ht,json:{type:String,read:K0e.read,write:K0e.write}})],$y.prototype,"unit",null),$y=qJ=h([I("esri.symbols.support.ElevationInfo")],$y);const vne=$y;let Iy=class extends _ne(Aj(uL)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new wS,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,i){return super.on(e,i)}graphicChanged(e){this.emit("graphic-update",e)}};h([f({type:vne})],Iy.prototype,"elevationInfo",void 0),h([f(BU(wS,"graphics"))],Iy.prototype,"graphics",void 0),h([f({type:["show","hide"]})],Iy.prototype,"listMode",void 0),h([f()],Iy.prototype,"screenSizePerspectiveEnabled",void 0),h([f({readOnly:!0})],Iy.prototype,"type",void 0),h([f({constructOnly:!0})],Iy.prototype,"internal",void 0),Iy=h([I("esri.layers.GraphicsLayer")],Iy);const aDt=Iy;let lDt=class k4e{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(C9),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const i=new k4e,r=this._originStores[Ii.DEFAULTS];r&&r.forEach((s,n)=>{i.set(n,Q(s),Ii.DEFAULTS)});for(let s=Ii.SERVICE;s<C9;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{e&&e.has(a)||i.set(a,Q(o),s)})}return i}get(e,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(e):void 0}keys(e){const i=e==null?this._values:this._originStores[e];return i?[...i.keys()]:[]}set(e,i,r=Ii.USER){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(e,i),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const n=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,r),n!==i}return!1}delete(e,i=Ii.USER){const r=this._originStores[i];if(!r)return;const s=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===i){this._values.delete(e);for(let n=i-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,n);break}}}return s}has(e,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(e)}revert(e,i){for(;i>0&&!this.has(e,i);)--i;const r=this._originStores[i],s=r==null?void 0:r.get(e),n=this._values.get(e);return this._values.set(e,s),this._propertyOriginMap.set(e,i),n!==s}originOf(e){return this._propertyOriginMap.get(e)||Ii.DEFAULTS}forEach(e){this._values.forEach(e)}};const U4e=t=>{let e=class extends t{constructor(...i){super(...i);const r=tl(this),s=r.store,n=new lDt;r.store=n,bbe(r,s,n)}read(i,r){xbe(this,i,r)}getAtOrigin(i,r){const s=Zq(this),n=jv(r);if(typeof i=="string")return s.get(i,n);const o={};return i.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(i){return rU(this.originIdOf(i))}originIdOf(i){return Zq(this).originOf(i)}revert(i,r){const s=Zq(this),n=jv(r),o=tl(this);let a;a=typeof i=="string"?i==="*"?s.keys(n):[i]:i,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return e=h([I("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function Zq(t){return tl(t).store}let e_e=class extends U4e(Re){};e_e=h([I("esri.core.ReadOnlyMultiOriginJSONSupport")],e_e);const cDt=t=>{let e=class extends t{constructor(...i){super(...i)}clear(i,r="user"){return Xq(this).delete(i,jv(r))}write(i,r){return Tbe(this,i=i||{},r),i}setAtOrigin(i,r,s){tl(this).setAtOrigin(i,r,jv(s))}removeOrigin(i){const r=Xq(this),s=jv(i),n=r.keys(s);for(const o of n)r.originOf(o)===s&&r.set(o,r.get(o,s),Ii.USER)}updateOrigin(i,r){const s=Xq(this),n=jv(r),o=mf(this,i);for(let a=n+1;a<C9;++a)s.delete(i,a);s.set(i,o,n)}toJSON(i){return this.write({},i)}};return e=h([I("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function Xq(t){return tl(t).store}const Pj=t=>{let e=class extends cDt(U4e(t)){constructor(...i){super(...i)}};return e=h([I("esri.core.MultiOriginJSONSupport")],e),e};let WJ=class extends Pj(Re){};WJ=h([I("esri.core.MultiOriginJSONSupport")],WJ);function uDt(t){return"portalItem"in t}const bne=t=>{let e=class extends t{get apiKey(){var i;return this._isOverridden("apiKey")?this._get("apiKey"):uDt(this)?(i=this.portalItem)==null?void 0:i.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return h([f({type:String})],e.prototype,"apiKey",null),e=h([I("esri.layers.mixins.APIKeyMixin")],e),e};let hDt=class{constructor(e,i=0,r=e.lods[e.lods.length-1].level){this.tileInfo=e,this.minLOD=i,this.maxLOD=r,e.lodAt(i)||(this.minLOD=e.lods[0].level),e.lodAt(r)||(this.maxLOD=e.lods[e.lods.length-1].level)}get effectiveMinLOD(){return this.minLOD??this.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.tileInfo.lods[this.tileInfo.lods.length-1].level}getAvailability(e,i,r){var n;const s=(n=this.tileInfo)==null?void 0:n.lodAt(e);return!s||e<this.minLOD||e>this.maxLOD?"unavailable":s.cols&&s.rows?r>=s.cols[0]&&r<=s.cols[1]&&i>=s.rows[0]&&i<=s.rows[1]?"unknown":"unavailable":"unknown"}async fetchAvailability(e,i,r,s){await oU(s);const n=this.getAvailability(e,i,r);if(n==="unavailable")throw new V("tile-map:tile-unavailable","Tile is not available",{level:e,row:i,col:r});return n}async fetchAvailabilityUpsample(e,i,r,s,n){await oU(n),s.level=e,s.row=i,s.col=r;const o=this.tileInfo;return o.updateTileInfo(s),this.fetchAvailability(e,i,r,n).catch(a=>{if(ms(a))throw a;if(o.upsampleTile(s))return this.fetchAvailabilityUpsample(s.level,s.row,s.col,s,n);throw a})}};function dDt(t,e=!1){return t<=_u?e?new Array(t).fill(0):new Array(t):new Uint32Array(t)}let t_e=class YJ{constructor(e){fDt(e);const{location:i,data:r}=e;this.location=Object.freeze(Q(i));const s=this.location.width,n=this.location.height;let o=!0,a=!0;const l=Math.ceil(s*n/32),c=dDt(l);let u=0;for(let d=0;d<r.length;d++){const p=d%32;r[d]?(a=!1,c[u]|=1<<p):o=!1,p===31&&++u}a?(this._availability="unavailable",this.byteSize=40):o?(this._availability="available",this.byteSize=40):(this._availability=c,this.byteSize=40+b0(c))}getAvailability(e,i){if(this._availability==="unavailable"||this._availability==="available")return this._availability;const r=(e-this.location.top)*this.location.width+(i-this.location.left),s=r%32,n=r>>5,o=this._availability;return n<0||n>o.length?"unknown":o[n]&1<<s?"available":"unavailable"}static fromDefinition(e,i){const r=e.service.request||Yt,{row:s,col:n,width:o,height:a}=e,l={query:{f:"json"}};return i=i?{...l,...i}:l,r(pDt(e),i).then(c=>c.data).catch(c=>{var u;if(((u=c==null?void 0:c.details)==null?void 0:u.httpStatus)===422)return{location:{top:s,left:n,width:o,height:a},valid:!0,data:new Array(o*a).fill(0)};throw c}).then(c=>{if(c.location&&(c.location.top!==s||c.location.left!==n||c.location.width!==o||c.location.height!==a))throw new V("tilemap:location-mismatch","Tilemap response for different location than requested",{response:c,definition:{top:s,left:n,width:o,height:a}});return YJ.fromJSON(c)})}static fromJSON(e){return Object.freeze(new YJ(e))}};function i_e(t){return`${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}function pDt(t){var r;let e;if((r=t.service.tileServers)!=null&&r.length){const s=t.service.tileServers;e=`${s&&s.length?s[t.row%s.length]:t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}else e=`${t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`;const i=t.service.query;return i&&(e=`${e}?${i}`),e}function fDt(t){if(!(t!=null&&t.location))throw new V("tilemap:missing-location","Location missing from tilemap response");if(t.valid===!1)throw new V("tilemap:invalid","Tilemap response was marked as invalid");if(!t.data)throw new V("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(t.data))throw new V("tilemap:data-mismatch","Data must be an array of numbers");if(t.data.length!==t.location.width*t.location.height)throw new V("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}var Fx;let ud=Fx=class extends Re{constructor(t){super(t),this._pendingTilemapRequests={},this.request=Yt,this.size=32,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new pse(2*SV.MEGABYTES),this.addHandles(ue(()=>{const{layer:t}=this;return[t==null?void 0:t.parsedUrl,t==null?void 0:t.tileServers,t==null?void 0:t.apiKey,t==null?void 0:t.customParameters]},()=>this._initializeTilemapDefinition(),cr))}get effectiveMinLOD(){return this.minLOD??this.layer.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.layer.tileInfo.lods[this.layer.tileInfo.lods.length-1].level}getAvailability(t,e,i){if(!this.layer.tileInfo.lodAt(t)||t<this.effectiveMinLOD||t>this.effectiveMaxLOD)return"unavailable";const r=this._tilemapFromCache(t,e,i,this._tmpTilemapDefinition);return r?r.getAvailability(e,i):"unknown"}fetchAvailability(t,e,i,r){return!this.layer.tileInfo.lodAt(t)||t<this.effectiveMinLOD||t>this.effectiveMaxLOD?Promise.reject(new V("tile-map:tile-unavailable","Tile is not available",{level:t,row:e,col:i})):this._fetchTilemap(t,e,i,r).catch(s=>s).then(s=>{if(s instanceof t_e){const n=s.getAvailability(e,i);if(n==="unavailable")throw new V("tile-map:tile-unavailable","Tile is not available",{level:t,row:e,col:i});return n}if(ms(s))throw s;return"unknown"})}fetchAvailabilityUpsample(t,e,i,r,s){r.level=t,r.row=e,r.col=i;const n=this.layer.tileInfo;n.updateTileInfo(r);const o=this.fetchAvailability(t,e,i,s).catch(a=>{if(ms(a))throw a;if(n.upsampleTile(r))return this.fetchAvailabilityUpsample(r.level,r.row,r.col,r,s);throw a});return this._fetchAvailabilityUpsamplePrefetch(r.id,t,e,i,s,o),o}async _fetchAvailabilityUpsamplePrefetch(t,e,i,r,s,n){if(!this._prefetchingEnabled||t==null)return;const o=`prefetch-${t}`;if(this.hasHandles(o))return;const a=new AbortController;n.then(()=>a.abort(),()=>a.abort());let l=!1;const c=Ni(()=>{l||(l=!0,a.abort())});if(this.addHandles(c,o),await N1e(10,a.signal).catch(()=>{}),l||(l=!0,this.removeHandles(o)),Yn(a))return;const u=new eEe(t,e,i,r),d={...s,signal:a.signal},p=this.layer.tileInfo;for(let m=0;Fx._prefetches.length<Fx._maxPrefetch&&p.upsampleTile(u);++m){const g=this.fetchAvailability(u.level,u.row,u.col,d);Fx._prefetches.push(g);const y=()=>{Fx._prefetches.removeUnordered(g)};g.then(y,y)}}_fetchTilemap(t,e,i,r){if(!this.layer.tileInfo.lodAt(t)||t<this.effectiveMinLOD||t>this.effectiveMaxLOD)return Promise.reject(new V("tilemap-cache:level-unavailable",`Level ${t} is unavailable in the service`));const s=this._tmpTilemapDefinition,n=this._tilemapFromCache(t,e,i,s);if(n)return Promise.resolve(n);const o=r==null?void 0:r.signal;return r={...r,signal:null},new Promise((a,l)=>{Io(o,()=>l(Di()));const c=i_e(s);let u=this._pendingTilemapRequests[c];if(!u){u=t_e.fromDefinition(s,r).then(p=>(this._tilemapCache.put(c,p,p.byteSize),p));const d=()=>{delete this._pendingTilemapRequests[c]};this._pendingTilemapRequests[c]=u,u.then(d,d)}u.then(a,l)})}_initializeTilemapDefinition(){var r;if(!this.layer.parsedUrl)return;const{parsedUrl:t,apiKey:e,customParameters:i}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:t.path,query:DS({...t.query,...i,token:e??((r=t.query)==null?void 0:r.token)}),tileServers:this.layer.tileServers,request:this.request},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(t,e,i,r){r.level=t,r.row=e-e%this.size,r.col=i-i%this.size;const s=i_e(r);return this._tilemapCache.get(s)}get test(){}};ud._maxPrefetch=4,ud._prefetches=new Zt({initialSize:Fx._maxPrefetch}),h([f({constructOnly:!0})],ud.prototype,"layer",void 0),h([f({constructOnly:!0})],ud.prototype,"minLOD",void 0),h([f({constructOnly:!0})],ud.prototype,"maxLOD",void 0),h([f({constructOnly:!0})],ud.prototype,"request",void 0),h([f({constructOnly:!0})],ud.prototype,"size",void 0),ud=Fx=h([I("esri.layers.support.TilemapCache")],ud);const mDt=t=>{let e=class extends t{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}destroy(){var i,r;(r=(i=this.tilemapCache)==null?void 0:i.destroy)==null||r.call(i)}readMinScale(i,r){return r.minLOD!=null&&r.maxLOD!=null?i:0}readMaxScale(i,r){return r.minLOD!=null&&r.maxLOD!=null?i:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(i,r,s){var u;const n=(u=r.capabilities)==null?void 0:u.includes("Tilemap");let{minLOD:o,maxLOD:a,minScale:l,maxScale:c}=r;if(o==null&&a==null&&l!==0&&c!==0){const d=p=>Math.round(1e4*p)/1e4;l=d(l||r.tileInfo.lods[0].scale),c=d(c||r.tileInfo.lods[r.tileInfo.lods.length-1].scale);for(const p of r.tileInfo.lods){const m=d(p.scale);o=m>=l?p.level:o,a=m>=c?p.level:a}}if(n)return new ud({layer:this,minLOD:o,maxLOD:a});if(r.tileInfo){const d=new ug;return d.read(r.tileInfo,s),new hDt(d,o,a)}return null}};return h([f({json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",void 0),h([f()],e.prototype,"minScale",void 0),h([Ce("service","minScale")],e.prototype,"readMinScale",null),h([f()],e.prototype,"maxScale",void 0),h([Ce("service","maxScale")],e.prototype,"readMaxScale",null),h([f({type:We})],e.prototype,"spatialReference",void 0),h([f({readOnly:!0})],e.prototype,"supportsBlankTile",null),h([f({type:ug})],e.prototype,"tileInfo",void 0),h([f()],e.prototype,"tilemapCache",void 0),h([Ce("service","tilemapCache",["capabilities","tileInfo"])],e.prototype,"readTilemapCache",null),h([f()],e.prototype,"version",void 0),e=h([I("esri.layers.mixins.ArcGISCachedService")],e),e},wne=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=B0(this.url);if(i!=null&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",jet(i,ie.getLogger(this)))}};return h([f()],e.prototype,"title",null),h([f({type:String})],e.prototype,"url",null),e=h([I("esri.layers.mixins.ArcGISService")],e),e},xne=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return h([f({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],e.prototype,"customParameters",void 0),e=h([I("esri.layers.mixins.CustomParametersMixin")],e),e},Ea=(t=>t)(["operational-layers","basemap","ground"]),r_e={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},s_e={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0},n_e={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},gDt={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GroupLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,KML:!0,LineOfSightLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,RasterDataLayer:!0,VectorTileLayer:!0,Voxel:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/basemap":{ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":r_e,"web-map/basemap":s_e,"web-map/tables":n_e,"link-chart/operational-layers":{...r_e,LinkChartLayer:!0},"link-chart/basemap":s_e,"link-chart/tables":n_e,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,BuildingSceneLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,SubtypeGroupLayer:!0}},yDt={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:Ea}}},Oj={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,i){e[i]=!t}}}},Sne={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:Ea}}},z4e={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:U1}}},V4e={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:Ea}}},B4e={value:null,type:vne,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:Ea}}};function ZJ(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const G4e={write:{enabled:!0,layerContainerTypes:Ea},read:!0},XJ={type:Number,json:{origins:{"web-document":G4e,"portal-item":{write:!0}}}},_Dt={...XJ,json:{...XJ.json,origins:{"web-document":{...G4e,write:{enabled:!0,layerContainerTypes:Ea,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,i)=>{var r;return i&&i.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?(r=e.layerDefinition)!=null&&r.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?XI(e.layerDefinition.drawingInfo.transparency):void 0:XI(e.drawingInfo.transparency)}}}},vDt={type:gi,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const i=gi.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(i.spatialReference=We.fromJSON(e.spatialReference)),i}}}},read:!1}},j4e={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},bDt={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:Ea}}},name:"layerDefinition.minScale",write:!0}},wDt={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:Ea}}},name:"layerDefinition.maxScale",write:!0}},H4e={json:{write:{ignoreOrigin:!0,layerContainerTypes:Ea},origins:{"web-map":{read:!1,write:!1}}}},Tne=t=>{let e=class extends t{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(i,r,s){var n;return((n=s==null?void 0:s.portalItem)==null?void 0:n.type)==="Group Layer"?void 0:i}writeListMode(i,r,s,n){(n&&n.layerContainerType==="ground"||i&&bBe(this,s,{},n))&&(r[s]=i)}writeOperationalLayerType(i,r,s,n){i&&(n==null?void 0:n.layerContainerType)!=="tables"&&(r.layerType=i)}writeTitle(i,r){r.title=i??"Layer"}readTimeExtent(i){return i?Sg.fromArray(i):null}writeTimeExtent(i,r,s,n){i&&n.layerContainerType!=="tables"&&(i.isEmpty?n!=null&&n.messages&&n.messages.push(new V("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):r[s]=i.toArray())}read(i,r){r&&(r.layer=this),yBe(this,i,s=>super.read(i,s),r)}write(i,r){var o,a;if(!this.persistenceEnabled&&!(r!=null&&r.ignorePersistenceEnabled))return null;if(r!=null&&r.origin){const l=`${r.origin}/${r.layerContainerType||"operational-layers"}`,c=gDt[l];let u=!!(c!=null&&c[this.operationalLayerType]);if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(u=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(u=!1),!u)return(o=r.messages)==null||o.push(new V("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(i,{...r,layer:this}),n=!!r&&!!r.messages&&!!r.messages.filter(l=>l instanceof V&&l.name==="web-document-write:property-required").length;return TM(s==null?void 0:s.url)?((a=r==null?void 0:r.messages)==null||a.push(new V("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return h([f({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),h([Ce("id",["id"])],e.prototype,"readId",null),h([f(H4e)],e.prototype,"listMode",void 0),h([Ve("listMode")],e.prototype,"writeListMode",null),h([f({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:Ea}}}}})],e.prototype,"operationalLayerType",void 0),h([Ve("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),h([f(XJ)],e.prototype,"opacity",void 0),h([f({type:Boolean,readOnly:!1})],e.prototype,"persistenceEnabled",void 0),h([f({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),h([Ve("title"),Ve(["web-scene"],"title")],e.prototype,"writeTitle",null),h([f({type:Sg,json:{origins:{"web-scene":{write:{layerContainerTypes:Ea}}}}})],e.prototype,"visibilityTimeExtent",void 0),h([Ce("visibilityTimeExtent")],e.prototype,"readTimeExtent",null),h([Ve(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[Qr,rB]]}})],e.prototype,"writeTimeExtent",null),h([f({type:Boolean,json:{origins:{"web-scene":{name:"visibility",write:{enabled:!0,layerContainerTypes:Ea}}},name:"visibility",write:!0}})],e.prototype,"visible",void 0),e=h([I("esri.layers.mixins.OperationalLayer")],e),e};async function xDt(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return wO(t);const i=We.WGS84;return await iL(e,i),ib(t,i)}function SDt(t,e){if(!q4e(t,e)){const i=t.typeKeywords;i?i.push(e):t.typeKeywords=[e]}}function q4e(t,e){var i;return!!((i=t.typeKeywords)!=null&&i.includes(e))}function Lri(t){return q4e(t,EDt.HOSTED_SERVICE)}function TDt(t,e){const i=t.typeKeywords;if(i){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}function Dri(t,e,i){i?SDt(t,e):TDt(t,e)}async function Nri(t){const e=t.clone().normalize();let i;if(e.length>1)for(const r of e)i?r.width>i.width&&(i=r):i=r;else i=e[0];return xDt(i)}const EDt={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function o_e(t){var l;const{portal:e,isOrgItem:i,itemControl:r}=t,s=(l=e.user)==null?void 0:l.privileges;let n=!s||s.includes("features:user:edit"),o=!!i&&!!(s!=null&&s.includes("features:user:fullEdit"));const a=r==="update"||r==="admin";return a?o=n=!0:o&&(n=!0),{features:{edit:n,fullEdit:o},content:{updateItem:a}}}const Ene=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=Le(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,s){if(r.itemId)return new l1({id:r.itemId,portal:s==null?void 0:s.portal})}writePortalItem(i,r){i!=null&&i.id&&(r.itemId=i.id)}async loadFromPortal(i,r){var s;if((s=this.portalItem)!=null&&s.id)try{const{load:n}=await fe(()=>import("./layersLoader-CRzW61vp.js"),__vite__mapDeps([213,74,73,72]));return Et(r),await n({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData,layerModuleTypeMap:i.layerModuleTypeMap},r)}catch(n){throw ms(n)||ie.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${n}`),n}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(Pn(r),!0)))}async setUserPrivileges(i,r){if(!lr.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(r);if(this.url)try{const{features:{edit:s,fullEdit:n},content:{updateItem:o}}=await this._fetchUserPrivileges(i,r);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",o)}catch(s){Pn(s)}}async _fetchUserPrivileges(i,r){let s=this.portalItem;if(!i||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(r);const n=i===s.id;if(n&&s.portal.user)return o_e(s);let o,a;if(n)o=s.portal.url;else try{o=await RTe(this.url,r)}catch(d){Pn(d)}if(!o||!GBe(o,s.portal.url))return this._fetchFallbackUserPrivileges(r);try{const d=r!=null?r.signal:null;a=await(pi==null?void 0:pi.getCredential(`${o}/sharing`,{prompt:!1,signal:d}))}catch(d){Pn(d)}const l=!0,c=!1,u=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:u}};try{if(n?await s.reload():(s=new l1({id:i,portal:{url:o}}),await s.load(r)),s.portal.user)return o_e(s)}catch(d){Pn(d)}return{features:{edit:l,fullEdit:c},content:{updateItem:u}}}async _fetchFallbackUserPrivileges(i){let r=!0;try{r=await this._fetchUserHasEditingPrivileges(i)}catch(s){Pn(s)}return{features:{edit:r,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(i){const r=this.url?pi==null?void 0:pi.findCredential(this.url):null;if(!r)return!0;const s=r4.credential===r?r4.user:await this._fetchEditingUser(i);return r4.credential=r,r4.user=s,(s==null?void 0:s.privileges)==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(i){var u,d;const r=(d=(u=this.portalItem)==null?void 0:u.portal)==null?void 0:d.user;if(r)return r;const s=pi==null?void 0:pi.findServerInfo(this.url??"");if(!(s!=null&&s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=No.getDefault();if(o&&o.loaded&&vh(o.restUrl)===vh(n))return o.user;const a=`${n}/community/self`,l=i!=null?i.signal:null,c=await Vd(Yt(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?Mte.fromJSON(c.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){var o;const s=r==null?void 0:r.portal,n=((o=this.portalItem)==null?void 0:o.id)&&(this.portalItem.portal||No.getDefault());return s&&n&&!Obe(n.restUrl,s.restUrl)?(r.messages&&r.messages.push(new V("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,{...r,layer:this})}};return h([f({type:l1})],e.prototype,"portalItem",null),h([Ce("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),h([Ve("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),h([f({clonable:!1})],e.prototype,"resourceReferences",void 0),h([f({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),h([f({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),h([f({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=h([I("esri.layers.mixins.PortalLayer")],e),e},r4={credential:null,user:null};let s4=null;function CDt(t){if(s4)return s4;const e={lossy:"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",lossless:"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",alpha:"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==",animation:"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"};return s4=new Promise(i=>{const r=new Image;r.onload=()=>{r.onload=r.onerror=null,i(r.width>0&&r.height>0)},r.onerror=()=>{r.onload=r.onerror=null,i(!1)},r.src="data:image/webp;base64,"+e[t]}),s4}const a_e=1.15;let l_e=class{constructor(e,i){this._spriteSource=e,this._maxTextureSize=i,this.devicePixelRatio=1,this._spriteImageFormat="png",this._isRetina=!1,this._spritesData={},this.image=null,this.width=null,this.height=null,this.loadStatus="not-loaded",e.type==="url"&&e.spriteFormat&&(this._spriteImageFormat=e.spriteFormat),e.pixelRatio&&(this.devicePixelRatio=e.pixelRatio),this.baseURL=e.spriteUrl}get spriteNames(){const e=[];for(const i in this._spritesData)e.push(i);return e.sort(),e}getSpriteInfo(e){return this._spritesData?this._spritesData[e]:null}async load(e){if(this.baseURL){this.loadStatus="loading";try{await this._loadSprites(e),this.loadStatus="loaded"}catch{this.loadStatus="failed"}}else this.loadStatus="failed"}async _loadSprites(e){this._isRetina=this.devicePixelRatio>a_e;const{width:i,height:r,data:s,json:n}=await this._getSpriteData(this._spriteSource,e),o=Object.keys(n);if(!o||o.length===0||!s)return this._spritesData=this.image=null,void(this.width=this.height=0);this._spritesData=n,this.width=i,this.height=r;const a=Math.max(this._maxTextureSize,4096);if(i>a||r>a){const c=`Sprite resource for style ${this.baseURL} is bigger than the maximum allowed of ${a} pixels}`;throw ie.getLogger("esri.layers.support.SpriteSource").error(c),new V("SpriteSource",c)}let l;for(let c=0;c<s.length;c+=4)l=s[c+3]/255,s[c]=s[c]*l,s[c+1]=s[c+1]*l,s[c+2]=s[c+2]*l;this.image=s}async _getSpriteData(e,i){if(e.type==="image"){let u,d;if(this.devicePixelRatio<a_e){if(!e.spriteSource1x)throw new V("SpriteSource","no image data provided for low resolution sprites!");u=e.spriteSource1x.image,d=e.spriteSource1x.json}else{if(!e.spriteSource2x)throw new V("SpriteSource","no image data provided for high resolution sprites!");u=e.spriteSource2x.image,d=e.spriteSource2x.json}return"width"in u&&"height"in u&&"data"in u&&(JE(u.data)||FK(u.data))?{width:u.width,height:u.height,data:new Uint8Array(u.data),json:d}:{...c_e(u),json:d}}const r=Ns(this.baseURL),s=r.query?"?"+DS(r.query):"",n=this._isRetina?"@2x":"",o=`${r.path}${n}.${this._spriteImageFormat}${s}`,a=`${r.path}${n}.json${s}`,[l,c]=await Promise.all([Yt(a,i),Yt(o,{responseType:"image",...i})]);return{...c_e(c.data),json:l.data}}};function c_e(t){const e=document.createElement("canvas"),i=e.getContext("2d");e.width=t.width,e.height=t.height,i.drawImage(t,0,0,t.width,t.height);const r=i.getImageData(0,0,t.width,t.height);return{width:t.width,height:t.height,data:new Uint8Array(r.data)}}let MDt=class{constructor(e){this.url=e}destroy(){this._tileIndexPromise=null}async fetchTileIndex(){return this._tileIndexPromise||(this._tileIndexPromise=Yt(this.url).then(e=>e.data.index)),this._tileIndexPromise}async dataKey(e,i){const r=await this.fetchTileIndex();return Et(i),this._getIndexedDataKey(r,e)}_getIndexedDataKey(e,i){const r=[i];if(i.level<0||i.row<0||i.col<0||i.row>>i.level>0||i.col>>i.level>0)return null;let s=i;for(;s.level!==0;)s=new Df(s.level-1,s.row>>1,s.col>>1,s.world),r.push(s);let n,o,a=e,l=r.pop();if(a===1)return l;for(;r.length;)if(n=r.pop(),o=(1&n.col)+((1&n.row)<<1),a){if(a[o]===0){l=null;break}if(a[o]===1){l=n;break}l=n,a=a[o]}return l}},ADt=class{constructor(e,i){this._tilemap=e,this._tileIndexUrl=i}destroy(){this._tilemap=Le(this._tilemap),this._tileIndexPromise=null}async fetchTileIndex(e){return this._tileIndexPromise||(this._tileIndexPromise=Yt(this._tileIndexUrl,{query:{...e==null?void 0:e.query}}).then(i=>i.data.index)),this._tileIndexPromise}dataKey(e,i){const{level:r,row:s,col:n}=e,o=new Df(e);return this._tilemap.fetchAvailabilityUpsample(r,s,n,o,i).then(()=>(o.world=e.world,o)).catch(a=>{if(ms(a))throw a;return null})}},PDt=class{constructor(e){this._tileUrl=e,this._promise=null,this._abortController=null,this._abortOptions=[]}getData(e){var r;(this._promise==null||Yn((r=this._abortController)==null?void 0:r.signal))&&(this._promise=this._makeRequest(this._tileUrl));const i=this._abortOptions;return i.push(e),Io(e,()=>{i.every(s=>Yn(s))&&this._abortController.abort()}),this._promise.then(s=>Q(s))}async _makeRequest(e){this._abortController=new AbortController;const{data:i}=await Yt(e,{responseType:"array-buffer",signal:this._abortController.signal});return i}};const u_e=new Map;function ODt(t,e,i,r,s){const n=Ns(t),o=n.query;if(o)for(const[l,c]of Object.entries(o))switch(c){case"{x}":o[l]=r.toString();break;case"{y}":o[l]=i.toString();break;case"{z}":o[l]=e.toString()}const a=n.path;return RDt(ag(a.replaceAll(/\{z\}/gi,e.toString()).replaceAll(/\{y\}/gi,i.toString()).replaceAll(/\{x\}/gi,r.toString()),{...n.query}),s)}function RDt(t,e){return V3(u_e,t,()=>new PDt(t)).getData(e).finally(()=>u_e.delete(t))}let $Dt=class{constructor(e,i,r){this.tilemap=null,this.tileInfo=null,this.capabilities=null,this.fullExtent=null,this.initialExtent=null,this.name=e,this.sourceUrl=i;const s=Ns(this.sourceUrl),n=Q(r),o=n.tiles;if(s)for(let p=0;p<o.length;p++){const m=Ns(o[p]);m&&(xc(m.path)||(m.path=zl(s.path,m.path)),o[p]=ag(m.path,{...s.query,...m.query}))}this.tileServers=o;const a=r.capabilities&&r.capabilities.split(",").map(p=>p.toLowerCase().trim()),l=(r==null?void 0:r.exportTilesAllowed)===!0,c=(a==null?void 0:a.includes("tilemap"))===!0,u=l&&r.hasOwnProperty("maxExportTilesCount")?r.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:l,supportsTileMap:c},exportTiles:l?{maxExportTilesCount:+u}:null},this.tileInfo=ug.fromJSON(n.tileInfo);const d=r.tileMap?ag(zl(s.path,r.tileMap),s.query??{}):null;c?(this.type="vector-tile",this.tilemap=new ADt(new ud({layer:{parsedUrl:s,tileInfo:this.tileInfo},minLOD:n.minLOD??this.tileInfo.lods[0].level,maxLOD:n.maxLOD??this.tileInfo.lods[this.tileInfo.lods.length-1].level}),d)):d&&(this.tilemap=new MDt(d)),this.fullExtent=gi.fromJSON(r.fullExtent),this.initialExtent=gi.fromJSON(r.initialExtent)}destroy(){var e;(e=this.tilemap)==null||e.destroy()}async getRefKey(e,i){var r;return await((r=this.tilemap)==null?void 0:r.dataKey(e,i))??e}requestTile(e,i,r,s){const n=this.tileServers[i%this.tileServers.length];return ODt(n,e,i,r,s)}isCompatibleWith(e){const i=this.tileInfo,r=e.tileInfo;if(!i.spatialReference.equals(r.spatialReference)||!i.origin.equals(r.origin)||Math.round(i.dpi)!==Math.round(r.dpi))return!1;const s=i.lods,n=r.lods,o=Math.min(s.length,n.length);for(let a=0;a<o;a++){const l=s[a],c=n[a];if(l.level!==c.level||Math.round(l.scale)!==Math.round(c.scale))return!1}return!0}};async function IDt(t,e){const i={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,sourceNameToSource:{},primarySourceName:"",spriteFormat:"png"},[r,s]=typeof t=="string"?[t,null]:[null,t.jsonUrl];return await iS(i,"esri",t,s,e),{layerDefinition:i.validatedSource,url:r,serviceUrl:i.sourceUrl,style:i.style,styleUrl:i.styleUrl,spriteUrl:i.style.sprite&&TA(i.styleBase,i.style.sprite),spriteFormat:i.spriteFormat,glyphsUrl:i.style.glyphs&&TA(i.styleBase,i.style.glyphs),sourceNameToSource:i.sourceNameToSource,primarySourceName:i.primarySourceName}}function TA(...t){let e;for(const i of t)i!=null&&(zd(i)?e&&(e=e.split("://")[0]+":"+i.trim()):e=xc(i)?i:zl(e,i));return e?lB(e):void 0}async function iS(t,e,i,r,s){let n,o,a;if(Et(s),typeof i=="string"){const c=vh(i);a=await Yt(c,{...s,responseType:"json",query:{f:"json",...s==null?void 0:s.query}}),a.ssl&&(n&&(n=n.replace(/^http:/i,"https:")),o&&(o=o.replace(/^http:/i,"https:"))),n=c,o=c}else i!=null&&(a={data:i},n=i.jsonUrl||null,o=r);const l=a==null?void 0:a.data;if(Y4e(l))return t.styleUrl=n||null,DDt(t,l,o,s);if(LDt(l))return t.sourceUrl?h_e(t,l,o,!1,e,s):(t.sourceUrl=n||null,h_e(t,l,o,!0,e,s));throw new Error("You must specify the URL or the JSON for a service or for a style.")}function W4e(t){return typeof t=="object"&&!!t&&"tilejson"in t&&t.tilejson!=null}function Y4e(t){return!!t&&"sources"in t&&!!t.sources}function LDt(t){return!Y4e(t)}async function DDt(t,e,i,r){const s=i?aB(i):Abe();t.styleBase=s,t.style=e,e["sprite-format"]&&e["sprite-format"].toLowerCase()==="webp"&&(t.spriteFormat="webp");const n=[];if(e.sources&&e.sources.esri){const o=e.sources.esri;o.url?await iS(t,"esri",TA(s,o.url),void 0,r):n.push(iS(t,"esri",o,s,r))}for(const o of Object.keys(e.sources))o!=="esri"&&e.sources[o].type==="vector"&&(e.sources[o].url?n.push(iS(t,o,TA(s,e.sources[o].url),void 0,r)):e.sources[o].tiles&&n.push(iS(t,o,e.sources[o],s,r)));await Promise.all(n)}async function h_e(t,e,i,r,s,n){const o=i?lB(i)+"/":Abe(),a=NDt(e),l=new $Dt(s,ag(o,(n==null?void 0:n.query)??{}),a);if(!r&&t.primarySourceName in t.sourceNameToSource){const c=t.sourceNameToSource[t.primarySourceName];if(!c.isCompatibleWith(l))return;l.fullExtent!=null&&(c.fullExtent!=null?c.fullExtent.union(l.fullExtent):c.fullExtent=l.fullExtent.clone()),c.tileInfo&&l.tileInfo&&c.tileInfo.lods.length<l.tileInfo.lods.length&&(c.tileInfo=l.tileInfo)}if(r&&(t.sourceBase=o,t.source=e,t.validatedSource=a,t.primarySourceName=s),t.sourceNameToSource[s]=l,!W4e(t)&&"defaultStyles"in e&&!t.style){if(e.defaultStyles==null)throw new Error;return typeof e.defaultStyles=="string"?iS(t,"",TA(o,e.defaultStyles,"root.json"),void 0,n):iS(t,"",e.defaultStyles,TA(o,"root.json"),n)}}function NDt(t){if(FDt(t)){const u=t==null?void 0:t.tileInfo;return u!=null&&(u.rows==null&&(u.rows=512),u.cols==null&&(u.cols=512)),t}const i={xmin:-20037507067161843e-9,ymin:-20037507067161843e-9,xmax:20037507067161843e-9,ymax:20037507067161843e-9,spatialReference:{wkid:102100,latestWkid:3857}};let r=null;if(W4e(t)){const{bounds:u}=t;if(u){const d=lS({x:u[0],y:u[1],spatialReference:Q(PU)}),p=lS({x:u[2],y:u[3],spatialReference:Q(PU)});r={xmin:d.x,ymin:d.y,xmax:p.x,ymax:p.y,spatialReference:Q(OU)}}}r===null&&(r=i);let s=78271.51696400007,n=2958287637957775e-7;const o=[],a=t.hasOwnProperty("maxzoom")&&t.maxzoom!=null?+t.maxzoom:22,l=0,c=0;for(let u=0;u<=a;u++)o.push({level:u,scale:n,resolution:s}),s/=2,n/=2;return{capabilities:"TilesOnly",initialExtent:r,fullExtent:i,minScale:l,maxScale:c,tiles:t.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-20037508342787e-6,y:20037508342787e-6},lods:o,spatialReference:Q(OU)}}}function FDt(t){return t.hasOwnProperty("tileInfo")}function kDt(t,e){return{...Z4e(t,e),readResourcePaths:[]}}function d_e(t,e,i){const r=Ns(t.itemUrl);return{...Z4e(t,e),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:r?{rootPath:r.path,writtenUrls:[]}:null,resources:i?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function Z4e(t,e){return{origin:e,url:Ns(t.itemUrl),portal:t.portal||No.getDefault(),portalItem:t}}const n4=1e-6;function UDt(t,e){if(t===e)return!0;if(t==null&&e!=null||t!=null&&e==null||t==null||e==null||!t.spatialReference.equals(e.spatialReference)||t.dpi!==e.dpi)return!1;const i=t.origin,r=e.origin;if(Math.abs(i.x-r.x)>=n4||Math.abs(i.y-r.y)>=n4)return!1;let s,n;t.lods[0].scale>e.lods[0].scale?(s=t,n=e):(n=t,s=e);for(let o=s.lods[0].scale;o>=n.lods[n.lods.length-1].scale-n4;o/=2)if(Math.abs(o-n.lods[0].scale)<n4)return!0;return!1}function zDt(t,e){if(t===e)return t;if(t==null&&e!=null)return e;if(t!=null&&e==null)return t;if(t==null||e==null)return null;const i=t.size[0],r=t.format,s=t.dpi,n=new _t({x:t.origin.x,y:t.origin.y}),o=t.spatialReference,a=t.lods[0].scale>e.lods[0].scale?t.lods[0]:e.lods[0],l=t.lods[t.lods.length-1].scale<=e.lods[e.lods.length-1].scale?t.lods[t.lods.length-1]:e.lods[e.lods.length-1],c=a.scale,u=a.resolution,d=l.scale,p=[];let m=c,g=u,y=0;for(;m>d;)p.push(new Sd({level:y,resolution:g,scale:m})),y++,m/=2,g/=2;return new ug({size:[i,i],dpi:s,format:r||"pbf",origin:n,lods:p,spatialReference:o})}let VDt=class{constructor(e){this._array=[],this._stride=e}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return new Uint32Array(this._array).buffer}static i1616to32(e,i){return 65535&e|i<<16}static i8888to32(e,i,r,s){return 255&e|(255&i)<<8|(255&r)<<16|s<<24}static i8816to32(e,i,r){return 255&e|(255&i)<<8|r<<16}};var At,kx;(function(t){t[t.R8_SIGNED=0]="R8_SIGNED",t[t.R8_UNSIGNED=1]="R8_UNSIGNED",t[t.R16_SIGNED=2]="R16_SIGNED",t[t.R16_UNSIGNED=3]="R16_UNSIGNED",t[t.R8G8_SIGNED=4]="R8G8_SIGNED",t[t.R8G8_UNSIGNED=5]="R8G8_UNSIGNED",t[t.R16G16_SIGNED=6]="R16G16_SIGNED",t[t.R16G16_UNSIGNED=7]="R16G16_UNSIGNED",t[t.R8G8B8A8_SIGNED=8]="R8G8B8A8_SIGNED",t[t.R8G8B8A8_UNSIGNED=9]="R8G8B8A8_UNSIGNED",t[t.R8G8B8A8_COLOR=10]="R8G8B8A8_COLOR",t[t.R16G16B16A16_DASHARRAY=11]="R16G16B16A16_DASHARRAY",t[t.R16G16B16A16_PATTERN=12]="R16G16B16A16_PATTERN"})(At||(At={})),function(t){t[t.UNIFORM=0]="UNIFORM",t[t.DATA_DRIVEN=1]="DATA_DRIVEN",t[t.INTERPOLATED_DATA_DRIVEN=2]="INTERPOLATED_DATA_DRIVEN",t[t.UNUSED=3]="UNUSED"}(kx||(kx={}));let bb=class JJ{constructor(e){this._locations=new Map,this._key=e}get key(){return this._key}get type(){return 7&this._key}defines(){return[]}getStride(){return this._layoutInfo||this._buildAttributesInfo(),this._stride}getAttributeLocations(){return this._locations.size===0&&this._buildAttributesInfo(),this._locations}getLayoutInfo(){return this._layoutInfo||this._buildAttributesInfo(),this._layoutInfo}getEncodingInfos(){return this._propertyEncodingInfo||this._buildAttributesInfo(),this._propertyEncodingInfo}getUniforms(){return this._uniforms||this._buildAttributesInfo(),this._uniforms}getShaderHeader(){return this._shaderHeader||this._buildAttributesInfo(),this._shaderHeader}getShaderMain(){return this._shaderMain||this._buildAttributesInfo(),this._shaderMain}setDataUniforms(e,i,r,s,n){const o=this.getUniforms();for(const a of o){const{name:l,type:c,getValue:u}=a,d=u(r,i,s,n);if(d!==null)switch(c){case"float":e.setUniform1f(l,d);break;case"vec2":e.setUniform2fv(l,d);break;case"vec4":e.setUniform4fv(l,d)}}}encodeAttributes(e,i,r,s){var u;const n=this.attributesInfo(),o=this.getEncodingInfos(),a=[];let l=0,c=0;for(const d of Object.keys(o)){const p=o[d],{type:m,precisionFactor:g,isLayout:y}=n[d],v=y?r.getLayoutProperty(d):r.getPaintProperty(d),b=(u=v.interpolator)==null?void 0:u.getInterpolationRange(i);let w=0;for(const x of p){const{offset:T,bufferElementsToAdd:C}=x;if(C>0){for(let O=0;O<C;O++)a.push(0);l+=c,c=x.bufferElementsToAdd}const M=s??v.getValue(b?b[w]:i,e);switch(m){case At.R8_SIGNED:case At.R8_UNSIGNED:a[l]|=this._encodeByte(M*(g||1),8*T);break;case At.R16_SIGNED:case At.R16_UNSIGNED:a[l]|=this._encodeShort(M*(g||1),8*T);break;case At.R8G8_SIGNED:case At.R8G8_UNSIGNED:a[l]|=this._encodeByte(M*(g||1),8*T),a[l]|=this._encodeByte(M*(g||1),8*T+8);break;case At.R16G16_SIGNED:case At.R16G16_UNSIGNED:a[l]|=this._encodeShort(M*(g||1),8*T),a[l]|=this._encodeShort(M*(g||1),8*T+16);break;case At.R8G8B8A8_SIGNED:case At.R8G8B8A8_UNSIGNED:a[l]|=this._encodeByte(M*(g||1),8*T),a[l]|=this._encodeByte(M*(g||1),8*T+8),a[l]|=this._encodeByte(M*(g||1),8*T+16),a[l]|=this._encodeByte(M*(g||1),8*T+24);break;case At.R8G8B8A8_COLOR:a[l]=this._encodeColor(M);break;case At.R16G16B16A16_DASHARRAY:case At.R16G16B16A16_PATTERN:this._encodePattern(l,a,M);break;default:throw new Error("Unsupported encoding type")}w++}}return a}getAtributeState(e){let i=0;const r=3+2*e;return i|=this._bit(r),i|=this._bit(r+1)<<1,i}_buildAttributesInfo(){const e=[],i={},r={};let s=-1;const n=this.attributesInfo(),o=this.attributes();let a=-1;for(const d of o){a++;const p=this.getAtributeState(a);if(p===kx.UNIFORM||p===kx.UNUSED)continue;const m=n[d],g=[];i[d]=g;const y=m.type;for(let v=0;v<p;v++){const{dataType:b,bytesPerElement:w,count:x,normalized:T}=JJ._encodingInfo[y],C=w*x,M=`${b}-${T===!0}`;let O=r[M],D=0;if(!O||O.count+x>4)s++,O={dataIndex:s,count:0,offset:0},x!==4&&(r[M]=O),e.push({location:-1,name:"a_data_"+s,count:x,type:b,normalized:T}),D=Math.ceil(Math.max(C/4,1));else{const k=e[O.dataIndex];k.count+=x,D=Math.ceil(Math.max(k.count*w/4,1))-Math.ceil(Math.max(O.offset/4,1))}g.push({dataIndex:O.dataIndex,offset:O.offset,bufferElementsToAdd:D}),O.offset+=C,O.count+=x}}for(const d of e)switch(d.type){case Me.BYTE:case Me.UNSIGNED_BYTE:d.count=4;break;case Me.SHORT:case Me.UNSIGNED_SHORT:d.count+=d.count%2}this._buildVertexBufferLayout(e);let l=0;const c=this._layoutInfo.geometry;for(const d of c)this._locations.set(d.name,l++);const u=this._layoutInfo.opacity;if(u)for(const d of u)this._locations.set(d.name,l++);this._buildShaderInfo(e,i),this._propertyEncodingInfo=i}_buildVertexBufferLayout(e){const i={},r=this.geometryInfo();let s=r[0].stride;if(e.length===0)i.geometry=r;else{const n=[];let o=s;for(const a of e)s+=p_e(a.type)*a.count;for(const a of r)n.push(new bs(a.name,a.count,a.type,a.offset,s,a.normalized));for(const a of e)n.push(new bs(a.name,a.count,a.type,o,s,a.normalized)),o+=p_e(a.type)*a.count;i.geometry=n}this.opacityInfo()&&(i.opacity=this.opacityInfo()),this._layoutInfo=i,this._stride=s}_buildShaderInfo(e,i){let r=`
`,s=`
`;const n=[];for(const c of e)r+=`attribute ${this._getType(c.count)} ${c.name};
`;const o=this.attributes(),a=this.attributesInfo();let l=-1;for(const c of o){l++;const{name:u,type:d,precisionFactor:p,isLayout:m}=a[c],g=p&&p!==1?" * "+1/p:"",{bytesPerElement:y,count:v}=JJ._encodingInfo[d],b=w=>`a_data_${w.dataIndex}${BDt(v,w.offset,y)}`;switch(this.getAtributeState(l)){case kx.UNIFORM:{const w=this._getType(v),x=`u_${u}`;n.push({name:x,type:w,getValue:(T,C,M,O)=>{const D=m?T.getLayoutValue(c,C):T.getPaintValue(c,C);if(d===At.R16G16B16A16_DASHARRAY){const k=T.getDashKey(D,T.getLayoutValue("line-cap",C)),U=O.getMosaicItemPosition(k,!1);if(U==null)return null;const{tl:H,br:z}=U;return[H[0],z[1],z[0],H[1]]}if(d===At.R16G16B16A16_PATTERN){const k=O.getMosaicItemPosition(D,!c.includes("line-"));if(k==null)return null;const{tl:U,br:H}=k;return[U[0],H[1],H[0],U[1]]}if(d===At.R8G8B8A8_COLOR){const k=D[3];return[k*D[0],k*D[1],k*D[2],k]}return D}}),r+=`uniform ${w} ${x};
`,s+=`${w} ${u} = ${x};
`}break;case kx.DATA_DRIVEN:{const w=b(i[c][0]);s+=`${this._getType(v)} ${u} = ${w}${g};
`}break;case kx.INTERPOLATED_DATA_DRIVEN:{const w=`u_t_${u}`;n.push({name:w,type:"float",getValue:(C,M,O,D)=>(m?C.getLayoutProperty(c):C.getPaintProperty(c)).interpolator.interpolationUniformValue(O,M)}),r+=`uniform float ${w};
`;const x=b(i[c][0]),T=b(i[c][1]);s+=`${this._getType(v)} ${u} = mix(${x}${g}, ${T}${g}, ${w});
`}}}this._shaderHeader=r,this._shaderMain=s,this._uniforms=n}_bit(e){return(this._key&1<<e)>>e}_getType(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw new Error("Invalid count")}_encodeColor(e){const i=255*e[3];return VDt.i8888to32(e[0]*i,e[1]*i,e[2]*i,i)}_encodePattern(e,i,r){if(!(r!=null&&r.rect))return;const s=2,n=r.rect,o=r.width,a=r.height;i[e]=this._encodeShort(n.x+s,0),i[e]|=this._encodeShort(n.y+s+a,16),i[e+1]=this._encodeShort(n.x+s+o,0),i[e+1]|=this._encodeShort(n.y+s,16)}_encodeByte(e,i){return(255&e)<<i}_encodeShort(e,i){return(65535&e)<<i}};bb._encodingInfo={[At.R8_SIGNED]:{dataType:Me.BYTE,bytesPerElement:1,count:1,normalized:!1},[At.R8_UNSIGNED]:{dataType:Me.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},[At.R16_SIGNED]:{dataType:Me.SHORT,bytesPerElement:2,count:1,normalized:!1},[At.R16_UNSIGNED]:{dataType:Me.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},[At.R8G8_SIGNED]:{dataType:Me.BYTE,bytesPerElement:1,count:2,normalized:!1},[At.R8G8_UNSIGNED]:{dataType:Me.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},[At.R16G16_SIGNED]:{dataType:Me.SHORT,bytesPerElement:2,count:2,normalized:!1},[At.R16G16_UNSIGNED]:{dataType:Me.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},[At.R8G8B8A8_SIGNED]:{dataType:Me.BYTE,bytesPerElement:1,count:4,normalized:!1},[At.R8G8B8A8_UNSIGNED]:{dataType:Me.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!1},[At.R8G8B8A8_COLOR]:{dataType:Me.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},[At.R16G16B16A16_DASHARRAY]:{dataType:Me.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},[At.R16G16B16A16_PATTERN]:{dataType:Me.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}};const p_e=t=>{switch(t){case Me.FLOAT:case Me.INT:case Me.UNSIGNED_INT:return 4;case Me.SHORT:case Me.UNSIGNED_SHORT:case Me.HALF_FLOAT:return 2;case Me.BYTE:case Me.UNSIGNED_BYTE:return 1}},BDt=(t,e,i)=>{const r=e/i;if(t===1)switch(r){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(t===2)switch(r){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(t===3)switch(r){case 0:return".xyz";case 1:return".yzw"}return""};let pM=class xk extends bb{constructor(e){super(e)}geometryInfo(){return xk.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return xk.ATTRIBUTES}attributesInfo(){return xk.ATTRIBUTES_INFO}};pM.ATTRIBUTES=[],pM.GEOMETRY_LAYOUT=[new bs("a_pos",2,Me.BYTE,0,2)],pM.ATTRIBUTES_INFO={};let fM=class Sk extends bb{constructor(e){super(e)}geometryInfo(){return Sk.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return Sk.ATTRIBUTES}attributesInfo(){return Sk.ATTRIBUTES_INFO}};fM.ATTRIBUTES=["circle-radius","circle-color","circle-opacity","circle-stroke-width","circle-stroke-color","circle-stroke-opacity","circle-blur"],fM.GEOMETRY_LAYOUT=[new bs("a_pos",2,Me.SHORT,0,4)],fM.ATTRIBUTES_INFO={"circle-radius":{name:"radius",type:At.R8_UNSIGNED},"circle-color":{name:"color",type:At.R8G8B8A8_COLOR},"circle-opacity":{name:"opacity",type:At.R8_UNSIGNED,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:At.R8_UNSIGNED,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:At.R8G8B8A8_COLOR},"circle-stroke-opacity":{name:"stroke_opacity",type:At.R8_UNSIGNED,precisionFactor:100},"circle-blur":{name:"blur",type:At.R8_UNSIGNED,precisionFactor:32}};let mM=class Tk extends bb{constructor(e){super(e)}geometryInfo(){return Tk.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return Tk.ATTRIBUTES}attributesInfo(){return Tk.ATTRIBUTES_INFO}};mM.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"],mM.GEOMETRY_LAYOUT=[new bs("a_pos",2,Me.SHORT,0,4)],mM.ATTRIBUTES_INFO={"fill-color":{name:"color",type:At.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:At.R8_UNSIGNED,precisionFactor:100},"fill-pattern":{name:"tlbr",type:At.R16G16B16A16_PATTERN,isOptional:!0}};let Jm=class LE extends bb{constructor(e,i){super(e),this._usefillColor=i}geometryInfo(){return LE.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return this._usefillColor?LE.ATTRIBUTES_FILL:LE.ATTRIBUTES_OUTLINE}attributesInfo(){return this._usefillColor?LE.ATTRIBUTES_INFO_FILL:LE.ATTRIBUTES_INFO_OUTLINE}};Jm.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"],Jm.ATTRIBUTES_FILL=["fill-color","fill-opacity"],Jm.GEOMETRY_LAYOUT=[new bs("a_pos",2,Me.SHORT,0,8),new bs("a_offset",2,Me.BYTE,4,8),new bs("a_xnormal",2,Me.BYTE,6,8)],Jm.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",type:At.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:At.R8_UNSIGNED,precisionFactor:100}},Jm.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:At.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:At.R8_UNSIGNED,precisionFactor:100}};let gM=class Ek extends bb{constructor(e){super(e)}geometryInfo(){return Ek.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return Ek.ATTRIBUTES}attributesInfo(){return Ek.ATTRIBUTES_INFO}};gM.ATTRIBUTES=["line-blur","line-color","line-gap-width","line-offset","line-opacity","line-width","line-pattern","line-dasharray"],gM.GEOMETRY_LAYOUT=[new bs("a_pos",2,Me.SHORT,0,16),new bs("a_extrude_offset",4,Me.BYTE,4,16),new bs("a_dir_normal",4,Me.BYTE,8,16),new bs("a_accumulatedDistance",2,Me.UNSIGNED_SHORT,12,16)],gM.ATTRIBUTES_INFO={"line-width":{name:"width",type:At.R8_UNSIGNED,precisionFactor:2},"line-gap-width":{name:"gap_width",type:At.R8_UNSIGNED,precisionFactor:2},"line-offset":{name:"offset",type:At.R8_SIGNED,precisionFactor:2},"line-color":{name:"color",type:At.R8G8B8A8_COLOR},"line-opacity":{name:"opacity",type:At.R8_UNSIGNED,precisionFactor:100},"line-blur":{name:"blur",type:At.R8_UNSIGNED,precisionFactor:4},"line-pattern":{name:"tlbr",type:At.R16G16B16A16_PATTERN,isOptional:!0},"line-dasharray":{name:"tlbr",type:At.R16G16B16A16_DASHARRAY,isOptional:!0}};const X4e=[new bs("a_pos",2,Me.SHORT,0,16),new bs("a_vertexOffset",2,Me.SHORT,4,16),new bs("a_texAngleRange",4,Me.UNSIGNED_BYTE,8,16),new bs("a_levelInfo",4,Me.UNSIGNED_BYTE,12,16)],J4e=[new bs("a_opacityInfo",1,Me.UNSIGNED_BYTE,0,1)];let wI=class QJ extends bb{constructor(e){super(e)}geometryInfo(){return X4e}opacityInfo(){return J4e}attributes(){return QJ.ATTRIBUTES}attributesInfo(){return QJ.ATTRIBUTES_INFO}};wI.ATTRIBUTES=["icon-color","icon-opacity","icon-halo-blur","icon-halo-color","icon-halo-width","icon-size"],wI.ATTRIBUTES_INFO={"icon-color":{name:"color",type:At.R8G8B8A8_COLOR},"icon-opacity":{name:"opacity",type:At.R8_UNSIGNED,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:At.R8G8B8A8_COLOR},"icon-halo-width":{name:"halo_width",type:At.R8_UNSIGNED,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:At.R8_UNSIGNED,precisionFactor:4},"icon-size":{name:"size",type:At.R8_UNSIGNED,precisionFactor:32,isLayout:!0}};let xI=class KJ extends bb{constructor(e){super(e)}geometryInfo(){return X4e}opacityInfo(){return J4e}attributes(){return KJ.ATTRIBUTES}attributesInfo(){return KJ.ATTRIBUTES_INFO}};xI.ATTRIBUTES=["text-color","text-opacity","text-halo-blur","text-halo-color","text-halo-width","text-size"],xI.ATTRIBUTES_INFO={"text-color":{name:"color",type:At.R8G8B8A8_COLOR},"text-opacity":{name:"opacity",type:At.R8_UNSIGNED,precisionFactor:100},"text-halo-color":{name:"halo_color",type:At.R8G8B8A8_COLOR},"text-halo-width":{name:"halo_width",type:At.R8_UNSIGNED,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:At.R8_UNSIGNED,precisionFactor:4},"text-size":{name:"size",type:At.R8_UNSIGNED,isLayout:!0}};function GDt(t,e,i,r){const s=3*t,n=3*(i-t)-s,o=1-s-n,a=3*e,l=3*(r-e)-a,c=1-a-l;function u(g){return((o*g+n)*g+s)*g}function d(g){return((c*g+l)*g+a)*g}function p(g){return(3*o*g+2*n)*g+s}function m(g,y){let v,b,w,x,T,C;for(w=g,C=0;C<8;C++){if(x=u(w)-g,Math.abs(x)<y)return w;if(T=p(w),Math.abs(T)<1e-6)break;w-=x/T}if(v=0,b=1,w=g,w<v)return v;if(w>b)return b;for(;v<b;){if(x=u(w),Math.abs(x-g)<y)return w;g>x?v=w:b=w,w=.5*(b-v)+v}return w}return function(g,y=1e-6){return d(m(g,y))}}const Q4e={kind:"null"},Rn={kind:"number"},Ph={kind:"string"},al={kind:"boolean"},L0={kind:"color"},Rj={kind:"object"},v0={kind:"value"};function ZL(t,e){return{kind:"array",itemType:t,n:e}}const jDt=[Q4e,Rn,Ph,al,L0,Rj,ZL(v0)];function EA(t){if(t.kind==="array"){const e=EA(t.itemType);return typeof t.n=="number"?`array<${e}, ${t.n}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}function $j(t){if(t===null)return Q4e;if(typeof t=="string")return Ph;if(typeof t=="boolean")return al;if(typeof t=="number")return Rn;if(t instanceof Oe)return L0;if(Array.isArray(t)){let e;for(const i of t){const r=$j(i);if(e){if(e!==r){e=v0;break}}else e=r}return ZL(e||v0,t.length)}return typeof t=="object"?Rj:v0}function eQ(t,e){if(e.kind==="array")return t.kind==="array"&&(t.n===0&&t.itemType.kind==="value"||eQ(t.itemType,e.itemType))&&(typeof e.n!="number"||e.n===t.n);if(e.kind==="value"){for(const i of jDt)if(eQ(t,i))return!0}return e.kind===t.kind}function tQ(t){if(t===null)return"";const e=typeof t;return e==="string"?t:e==="number"||e==="boolean"?String(t):t instanceof Oe?t.toString():JSON.stringify(t)}let HDt=class{constructor(e){this._parent=e,this._vars={}}add(e,i){this._vars[e]=i}get(e){return this._vars[e]?this._vars[e]:this._parent?this._parent.get(e):null}},qDt=class K4e{constructor(){this.type=v0}static parse(e){if(e.length>1)throw new Error('"id" does not expect arguments');return new K4e}evaluate(e,i){return e==null?void 0:e.id}},WDt=class e5e{constructor(){this.type=Ph}static parse(e){if(e.length>1)throw new Error('"geometry-type" does not expect arguments');return new e5e}evaluate(e,i){if(!e)return null;switch(e.type){case Kc.Point:return"Point";case Kc.LineString:return"LineString";case Kc.Polygon:return"Polygon";default:return null}}},YDt=class t5e{constructor(){this.type=Rj}static parse(e){if(e.length>1)throw new Error('"properties" does not expect arguments');return new t5e}evaluate(e,i){return e==null?void 0:e.values}},i5e=class r5e{constructor(){this.type=Rn}static parse(e){if(e.length>1)throw new Error('"zoom" does not expect arguments');return new r5e}evaluate(e,i){return i}},Yd=class s5e{constructor(e,i,r){this._lhs=e,this._rhs=i,this._compare=r,this.type=al}static parse(e,i,r){if(e.length!==3&&e.length!==4)throw new Error(`"${e[0]}" expects 2 or 3 arguments`);if(e.length===4)throw new Error(`"${e[0]}" collator not supported`);return new s5e(ri(e[1],i),ri(e[2],i),r)}evaluate(e,i){return this._compare(this._lhs.evaluate(e,i),this._rhs.evaluate(e,i))}},ZDt=class extends Yd{static parse(e,i){return Yd.parse(e,i,(r,s)=>r===s)}},XDt=class extends Yd{static parse(e,i){return Yd.parse(e,i,(r,s)=>r!==s)}},JDt=class extends Yd{static parse(e,i){return Yd.parse(e,i,(r,s)=>r<s)}},QDt=class extends Yd{static parse(e,i){return Yd.parse(e,i,(r,s)=>r<=s)}},KDt=class extends Yd{static parse(e,i){return Yd.parse(e,i,(r,s)=>r>s)}},eNt=class extends Yd{static parse(e,i){return Yd.parse(e,i,(r,s)=>r>=s)}},tNt=class n5e{constructor(e){this._arg=e,this.type=al}static parse(e,i){if(e.length!==2)throw new Error('"!" expects 1 argument');return new n5e(ri(e[1],i))}evaluate(e,i){return!this._arg.evaluate(e,i)}},iNt=class o5e{constructor(e){this._args=e,this.type=al}static parse(e,i){const r=[];for(let s=1;s<e.length;s++)r.push(ri(e[s],i));return new o5e(r)}evaluate(e,i){for(const r of this._args)if(!r.evaluate(e,i))return!1;return!0}},rNt=class a5e{constructor(e){this._args=e,this.type=al}static parse(e,i){const r=[];for(let s=1;s<e.length;s++)r.push(ri(e[s],i));return new a5e(r)}evaluate(e,i){for(const r of this._args)if(r.evaluate(e,i))return!0;return!1}},sNt=class l5e{constructor(e){this._args=e,this.type=al}static parse(e,i){const r=[];for(let s=1;s<e.length;s++)r.push(ri(e[s],i));return new l5e(r)}evaluate(e,i){for(const r of this._args)if(r.evaluate(e,i))return!1;return!0}},nNt=class c5e{constructor(e,i,r){this.type=e,this._args=i,this._fallback=r}static parse(e,i,r){if(e.length<4)throw new Error('"case" expects at least 3 arguments');if(e.length%2==1)throw new Error('"case" expects an odd number of arguments');let s;const n=[];for(let a=1;a<e.length-1;a+=2){const l=ri(e[a],i),c=ri(e[a+1],i,r);s||(s=c.type),n.push({condition:l,output:c})}const o=ri(e[e.length-1],i,r);return s||(s=o.type),new c5e(s,n,o)}evaluate(e,i){for(const r of this._args)if(r.condition.evaluate(e,i))return r.output.evaluate(e,i);return this._fallback.evaluate(e,i)}},oNt=class u5e{constructor(e,i){this.type=e,this._args=i}static parse(e,i){if(e.length<2)throw new Error('"coalesce" expects at least 1 argument');let r;const s=[];for(let n=1;n<e.length;n++){const o=ri(e[n],i);r||(r=o.type),s.push(o)}return new u5e(r,s)}evaluate(e,i){for(const r of this._args){const s=r.evaluate(e,i);if(s!==null)return s}return null}},aNt=class h5e{constructor(e,i,r,s,n){this.type=e,this._input=i,this._labels=r,this._outputs=s,this._fallback=n}static parse(e,i){if(e.length<3)throw new Error('"match" expects at least 3 arguments');if(e.length%2==0)throw new Error('"case" expects an even number of arguments');let r;const s=ri(e[1],i),n=[],o={};let a;for(let l=2;l<e.length-1;l+=2){let c=e[l];Array.isArray(c)||(c=[c]);for(const d of c){const p=typeof d;if(p!=="string"&&p!=="number")throw new Error('"match" requires string or number literal as labels');if(a){if(p!==a)throw new Error('"match" requires labels to have the same type')}else a=p;o[d]=n.length}const u=ri(e[l+1],i);r||(r=u.type),n.push(u)}return new h5e(r,s,o,n,ri(e[e.length-1],i))}evaluate(e,i){const r=this._input.evaluate(e,i);return(this._outputs[this._labels[r]]||this._fallback).evaluate(e,i)}},Ck=class ux{constructor(e,i,r,s,n){this._operator=e,this.type=i,this.interpolation=r,this.input=s,this._stops=n}static parse(e,i,r){const s=e[0];if(e.length<5)throw new Error(`"${s}" expects at least 4 arguments`);const n=e[1];if(!Array.isArray(n)||n.length===0)throw new Error(`"${n}" is not a valid interpolation`);switch(n[0]){case"linear":if(n.length!==1)throw new Error("Linear interpolation cannot have parameters");break;case"exponential":if(n.length!==2||typeof n[1]!="number")throw new Error("Exponential interpolation requires one numeric argument");break;case"cubic-bezier":if(n.length!==5)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(let c=1;c<5;c++){const u=n[c];if(typeof u!="number"||u<0||u>1)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1")}break;default:throw new Error(`"${e[0]}" unknown interpolation type "${n[0]}"`)}if(e.length%2!=1)throw new Error(`"${s}" expects an even number of arguments`);const o=ri(e[2],i,Rn);let a;s==="interpolate-hcl"||s==="interpolate-lab"?a=L0:r&&r.kind!=="value"&&(a=r);const l=[];for(let c=3;c<e.length;c+=2){const u=e[c];if(typeof u!="number")throw new Error(`"${s}" requires stop inputs as literal numbers`);if(l.length&&l[l.length-1][0]>=u)throw new Error(`"${s}" requires strictly ascending stop inputs`);const d=ri(e[c+1],i,a);a||(a=d.type),l.push([u,d])}if(a&&a!==L0&&a!==Rn&&(a.kind!=="array"||a.itemType!==Rn))throw new Error(`"${s}" cannot interpolate type ${EA(a)}`);return new ux(s,a,n,o,l)}evaluate(e,i){const r=this._stops;if(r.length===1)return r[0][1].evaluate(e,i);const s=this.input.evaluate(e,i);if(s<=r[0][0])return r[0][1].evaluate(e,i);if(s>=r[r.length-1][0])return r[r.length-1][1].evaluate(e,i);let n=0;for(;++n<r.length&&!(s<r[n][0]););const o=r[n-1][0],a=r[n][0],l=ux.interpolationRatio(this.interpolation,s,o,a),c=r[n-1][1].evaluate(e,i),u=r[n][1].evaluate(e,i);if(this._operator==="interpolate"){if(this.type.kind==="array"&&Array.isArray(c)&&Array.isArray(u))return c.map((d,p)=>uc(d,u[p],l));if(this.type.kind==="color"&&c instanceof Oe&&u instanceof Oe){const d=new Oe(c),p=new Oe(u);return new Oe([uc(d.r,p.r,l),uc(d.g,p.g,l),uc(d.b,p.b,l),uc(d.a,p.a,l)])}if(this.type.kind==="number"&&typeof c=="number"&&typeof u=="number")return uc(c,u,l);throw new Error(`"${this._operator}" cannot interpolate type ${EA(this.type)}`)}if(this._operator==="interpolate-hcl"){const d=hue(c),p=hue(u),m=p.h-d.h,g=QS({h:d.h+l*(m>180||m<-180?m-360*Math.round(m/360):m),c:uc(d.c,p.c,l),l:uc(d.l,p.l,l)});return new Oe({a:uc(c.a,u.a,l),...g})}if(this._operator==="interpolate-lab"){const d=VY(c),p=VY(u),m=QS({l:uc(d.l,p.l,l),a:uc(d.a,p.a,l),b:uc(d.b,p.b,l)});return new Oe({a:uc(c.a,u.a,l),...m})}throw new Error(`Unexpected operator "${this._operator}"`)}interpolationUniformValue(e,i){const r=this._stops;if(r.length===1||e>=r[r.length-1][0])return 0;let s=0;for(;++s<r.length&&!(e<r[s][0]););const n=r[s-1][0],o=r[s][0];return ux.interpolationRatio(this.interpolation,i,n,o)}getInterpolationRange(e){const i=this._stops;if(i.length===1){const n=i[0][0];return[n,n]}const r=i[i.length-1][0];if(e>=r)return[r,r];let s=0;for(;++s<i.length&&!(e<i[s][0]););return[i[s-1][0],i[s][0]]}static interpolationRatio(e,i,r,s){let n=0;return e[0]==="linear"?n=ux._exponentialInterpolationRatio(i,1,r,s):e[0]==="exponential"?n=ux._exponentialInterpolationRatio(i,e[1],r,s):e[0]==="cubic-bezier"&&(n=GDt(e[1],e[2],e[3],e[4])(ux._exponentialInterpolationRatio(i,1,r,s),1e-5)),n<0?n=0:n>1&&(n=1),n}static _exponentialInterpolationRatio(e,i,r,s){const n=s-r;if(n===0)return 0;const o=e-r;return i===1?o/n:(i**o-1)/(i**n-1)}},lNt=class d5e{constructor(e,i,r){this.type=e,this._input=i,this._stops=r}static parse(e,i){if(e.length<5)throw new Error('"step" expects at least 4 arguments');if(e.length%2!=1)throw new Error('"step" expects an even number of arguments');const r=ri(e[1],i,Rn);let s;const n=[];n.push([-1/0,ri(e[2],i)]);for(let o=3;o<e.length;o+=2){const a=e[o];if(typeof a!="number")throw new Error('"step" requires stop inputs as literal numbers');if(n.length&&n[n.length-1][0]>=a)throw new Error('"step" requires strictly ascending stop inputs');const l=ri(e[o+1],i);s||(s=l.type),n.push([a,l])}return new d5e(s,r,n)}evaluate(e,i){const r=this._stops;if(r.length===1)return r[0][1].evaluate(e,i);const s=this._input.evaluate(e,i);let n=0;for(;++n<r.length&&!(s<r[n][0]););return this._stops[n-1][1].evaluate(e,i)}},cNt=class p5e{constructor(e,i){this.type=e,this._output=i}static parse(e,i,r){if(e.length<4)throw new Error('"let" expects at least 3 arguments');if(e.length%2==1)throw new Error('"let" expects an odd number of arguments');const s=new HDt(i);for(let o=1;o<e.length-1;o+=2){const a=e[o];if(typeof a!="string")throw new Error(`"let" requires a string to define variable names - found ${a}`);s.add(a,ri(e[o+1],i))}const n=ri(e[e.length-1],s,r);return new p5e(n.type,n)}evaluate(e,i){return this._output.evaluate(e,i)}},uNt=class f5e{constructor(e,i){this.type=e,this.output=i}static parse(e,i,r){if(e.length!==2||typeof e[1]!="string")throw new Error('"var" requires just one literal string argument');const s=i.get(e[1]);if(!s)throw new Error(`${e[1]} must be defined before being used in a "var" expression`);return new f5e(r||v0,s)}evaluate(e,i){return this.output.evaluate(e,i)}},hNt=class m5e{constructor(e,i,r){this.type=e,this._index=i,this._array=r}static parse(e,i){if(e.length!==3)throw new Error('"at" expects 2 arguments');const r=ri(e[1],i,Rn),s=ri(e[2],i);return new m5e(s.type.itemType,r,s)}evaluate(e,i){const r=this._index.evaluate(e,i),s=this._array.evaluate(e,i);if(r<0||r>=s.length)throw new Error('"at" index out of bounds');if(r!==Math.floor(r))throw new Error('"at" index must be an integer');return s[r]}},dNt=class iQ{constructor(e,i){this._key=e,this._obj=i,this.type=v0}static parse(e,i){let r,s;switch(e.length){case 2:return r=ri(e[1],i),new iQ(r);case 3:return r=ri(e[1],i),s=ri(e[2],i),new iQ(r,s);default:throw new Error('"get" expects 1 or 2 arguments')}}evaluate(e,i){const r=this._key.evaluate(e,i);return this._obj?this._obj.evaluate(e,i)[r]:e==null?void 0:e.values[r]}},pNt=class rQ{constructor(e,i){this._key=e,this._obj=i,this.type=al}static parse(e,i){let r,s;switch(e.length){case 2:return r=ri(e[1],i),new rQ(r);case 3:return r=ri(e[1],i),s=ri(e[2],i),new rQ(r,s);default:throw new Error('"has" expects 1 or 2 arguments')}}evaluate(e,i){const r=this._key.evaluate(e,i);return this._obj?r in this._obj.evaluate(e,i):!!(e!=null&&e.values[r])}},fNt=class g5e{constructor(e,i){this._key=e,this._vals=i,this.type=al}static parse(e,i){if(e.length!==3)throw new Error('"in" expects 2 arguments');return new g5e(ri(e[1],i),ri(e[2],i))}evaluate(e,i){const r=this._key.evaluate(e,i);return this._vals.evaluate(e,i).includes(r)}},mNt=class sQ{constructor(e,i,r){this._item=e,this._array=i,this._from=r,this.type=Rn}static parse(e,i){if(e.length<3||e.length>4)throw new Error('"index-of" expects 3 or 4 arguments');const r=ri(e[1],i),s=ri(e[2],i);if(e.length===4){const n=ri(e[3],i,Rn);return new sQ(r,s,n)}return new sQ(r,s)}evaluate(e,i){const r=this._item.evaluate(e,i),s=this._array.evaluate(e,i);if(this._from){const n=this._from.evaluate(e,i);if(n!==Math.floor(n))throw new Error('"index-of" index must be an integer');return s.indexOf(r,n)}return s.indexOf(r)}},gNt=class y5e{constructor(e){this._arg=e,this.type=Rn}static parse(e,i){if(e.length!==2)throw new Error('"length" expects 2 arguments');const r=ri(e[1],i);return new y5e(r)}evaluate(e,i){const r=this._arg.evaluate(e,i);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Error('"length" expects string or array')}},yNt=class nQ{constructor(e,i,r,s){this.type=e,this._array=i,this._from=r,this._to=s}static parse(e,i){if(e.length<3||e.length>4)throw new Error('"slice" expects 2 or 3 arguments');const r=ri(e[1],i),s=ri(e[2],i,Rn);if(s.type!==Rn)throw new Error('"slice" index must return a number');if(e.length===4){const n=ri(e[3],i,Rn);if(n.type!==Rn)throw new Error('"slice" index must return a number');return new nQ(r.type,r,s,n)}return new nQ(r.type,r,s)}evaluate(e,i){const r=this._array.evaluate(e,i);if(!Array.isArray(r)&&typeof r!="string")throw new Error('"slice" input must be an array or a string');const s=this._from.evaluate(e,i);if(s<0||s>=r.length)throw new Error('"slice" index out of bounds');if(s!==Math.floor(s))throw new Error('"slice" index must be an integer');if(this._to){const n=this._to.evaluate(e,i);if(n<0||n>=r.length)throw new Error('"slice" index out of bounds');if(n!==Math.floor(n))throw new Error('"slice" index must be an integer');return r.slice(s,n)}return r.slice(s)}},_Nt=class _5e{constructor(){this.type=al}static parse(e){if(e.length!==1)throw new Error('"has-id" expects no arguments');return new _5e}evaluate(e,i){return(e==null?void 0:e.id)!==void 0}},Th=class v5e{constructor(e,i){this._args=e,this._calculate=i,this.type=Rn}static parse(e,i,r){const s=e.slice(1).map(n=>ri(n,i));return new v5e(s,r)}evaluate(e,i){let r;return this._args&&(r=this._args.map(s=>s.evaluate(e,i))),this._calculate(r)}},vNt=class extends Th{static parse(e,i){switch(e.length){case 2:return Th.parse(e,i,r=>-r[0]);case 3:return Th.parse(e,i,r=>r[0]-r[1]);default:throw new Error('"-" expects 1 or 2 arguments')}}},bNt=class extends Th{static parse(e,i){return Th.parse(e,i,r=>{let s=1;for(const n of r)s*=n;return s})}},wNt=class extends Th{static parse(e,i){if(e.length===3)return Th.parse(e,i,r=>r[0]/r[1]);throw new Error('"/" expects 2 arguments')}},xNt=class extends Th{static parse(e,i){if(e.length===3)return Th.parse(e,i,r=>r[0]%r[1]);throw new Error('"%" expects 2 arguments')}};class SNt extends Th{static parse(e,i){if(e.length===3)return Th.parse(e,i,r=>r[0]**r[1]);throw new Error('"^" expects 1 or 2 arguments')}}class TNt extends Th{static parse(e,i){return Th.parse(e,i,r=>{let s=0;for(const n of r)s+=n;return s})}}class En{constructor(e,i){this._args=e,this._calculate=i,this.type=Rn}static parse(e,i){const r=e.slice(1).map(s=>ri(s,i));return new En(r,En.ops[e[0]])}evaluate(e,i){let r;return this._args&&(r=this._args.map(s=>s.evaluate(e,i))),this._calculate(r)}}En.ops={abs:t=>Math.abs(t[0]),acos:t=>Math.acos(t[0]),asin:t=>Math.asin(t[0]),atan:t=>Math.atan(t[0]),ceil:t=>Math.ceil(t[0]),cos:t=>Math.cos(t[0]),e:()=>Math.E,floor:t=>Math.floor(t[0]),ln:t=>Math.log(t[0]),ln2:()=>Math.LN2,log10:t=>Math.log(t[0])/Math.LN10,log2:t=>Math.log(t[0])/Math.LN2,max:t=>Math.max(...t),min:t=>Math.min(...t),pi:()=>Math.PI,round:t=>Math.round(t[0]),sin:t=>Math.sin(t[0]),sqrt:t=>Math.sqrt(t[0]),tan:t=>Math.tan(t[0])};class Cne{constructor(e){this._args=e,this.type=Ph}static parse(e,i){return new Cne(e.slice(1).map(r=>ri(r,i)))}evaluate(e,i){return this._args.map(r=>r.evaluate(e,i)).join("")}}class CA{constructor(e,i){this._arg=e,this._calculate=i,this.type=Ph}static parse(e,i){if(e.length!==2)throw new Error(`${e[0]} expects 1 argument`);const r=ri(e[1],i);return new CA(r,CA.ops[e[0]])}evaluate(e,i){return this._calculate(this._arg.evaluate(e,i))}}CA.ops={downcase:t=>t.toLowerCase(),upcase:t=>t.toUpperCase()};class Mne{constructor(e){this._args=e,this.type=L0}static parse(e,i){if(e.length!==4)throw new Error('"rgb" expects 3 arguments');const r=e.slice(1).map(s=>ri(s,i));return new Mne(r)}evaluate(e,i){const r=this._validate(this._args[0].evaluate(e,i)),s=this._validate(this._args[1].evaluate(e,i)),n=this._validate(this._args[2].evaluate(e,i));return new Oe({r,g:s,b:n})}_validate(e){if(typeof e!="number"||e<0||e>255)throw new Error(`${e}: invalid color component`);return Math.round(e)}}class Ane{constructor(e){this._args=e,this.type=L0}static parse(e,i){if(e.length!==5)throw new Error('"rgba" expects 4 arguments');const r=e.slice(1).map(s=>ri(s,i));return new Ane(r)}evaluate(e,i){const r=this._validate(this._args[0].evaluate(e,i)),s=this._validate(this._args[1].evaluate(e,i)),n=this._validate(this._args[2].evaluate(e,i)),o=this._validateAlpha(this._args[3].evaluate(e,i));return new Oe({r,g:s,b:n,a:o})}_validate(e){if(typeof e!="number"||e<0||e>255)throw new Error(`${e}: invalid color component`);return Math.round(e)}_validateAlpha(e){if(typeof e!="number"||e<0||e>1)throw new Error(`${e}: invalid alpha color component`);return e}}class Pne{constructor(e){this._color=e,this.type=ZL(Rn,4)}static parse(e,i){if(e.length!==2)throw new Error('"to-rgba" expects 1 argument');const r=ri(e[1],i);return new Pne(r)}evaluate(e,i){return new Oe(this._color.evaluate(e,i)).toRgba()}}class Ux{constructor(e,i){this.type=e,this._args=i}static parse(e,i){const r=e[0];if(e.length<2)throw new Error(`${r} expects at least one argument`);let s,n=1;if(r==="array"){if(e.length>2){switch(e[1]){case"string":s=Ph;break;case"number":s=Rn;break;case"boolean":s=al;break;default:throw new Error('"array" type argument must be string, number or boolean')}n++}else s=v0;let a;if(e.length>3){if(a=e[2],a!==null&&(typeof a!="number"||a<0||a!==Math.floor(a)))throw new Error('"array" length argument must be a positive integer literal');n++}s=ZL(s,a)}else switch(r){case"string":s=Ph;break;case"number":s=Rn;break;case"boolean":s=al;break;case"object":s=Rj}const o=[];for(;n<e.length;n++){const a=ri(e[n],i);o.push(a)}return new Ux(s,o)}evaluate(e,i){let r;for(const s of this._args){const n=s.evaluate(e,i);if(r=$j(n),eQ(r,this.type))return n}throw new Error(`Expected ${EA(this.type)} but got ${EA(r)}`)}}class Ld{constructor(e,i){this.type=e,this._args=i}static parse(e,i){const r=e[0],s=Ld.types[r];if(s===al||s===Ph){if(e.length!==2)throw new Error(`${r} expects one argument`)}else if(e.length<2)throw new Error(`${r} expects at least one argument`);const n=[];for(let o=1;o<e.length;o++){const a=ri(e[o],i);n.push(a)}return new Ld(s,n)}evaluate(e,i){if(this.type===al)return!!this._args[0].evaluate(e,i);if(this.type===Ph)return tQ(this._args[0].evaluate(e,i));if(this.type===Rn){for(const r of this._args){const s=Number(r.evaluate(e,i));if(!isNaN(s))return s}return null}if(this.type===L0){for(const r of this._args)try{const s=Ld.toColor(r.evaluate(e,i));if(s instanceof Oe)return s}catch{}return null}}static toBoolean(e){return!!e}static toString(e){return tQ(e)}static toNumber(e){const i=Number(e);if(isNaN(i))throw new Error(`"${e}" is not a number`);return i}static toColor(e){if(e instanceof Oe)return e;if(typeof e=="string"){const i=Oe.fromString(e);if(i)return i;throw new Error(`"${e}" is not a color`)}if(Array.isArray(e))return Oe.fromArray(e);throw new Error(`"${e}" is not a color`)}}Ld.types={"to-boolean":al,"to-color":L0,"to-number":Rn,"to-string":Ph};class One{constructor(e){this._val=e,this.type=$j(e)}static parse(e){if(e.length!==2)throw new Error('"literal" expects 1 argument');return new One(e[1])}evaluate(e,i){return this._val}}class Rne{constructor(e){this._arg=e,this.type=Ph}static parse(e,i){if(e.length!==2)throw new Error('"typeof" expects 1 argument');return new Rne(ri(e[1],i))}evaluate(e,i){return EA($j(this._arg.evaluate(e,i)))}}function ri(t,e,i){const r=typeof t;if(r==="string"||r==="boolean"||r==="number"||t===null){if(i)switch(i.kind){case"string":r!=="string"&&(t=Ld.toString(t));break;case"number":r!=="number"&&(t=Ld.toNumber(t));break;case"color":t=Ld.toColor(t)}t=["literal",t]}if(!Array.isArray(t)||t.length===0)throw new Error("Expression must be a non empty array");const s=t[0];if(typeof s!="string")throw new Error("First element of expression must be a string");const n=b5e[s];if(n===void 0)throw new Error(`Invalid expression operator "${s}"`);if(!n)throw new Error(`Unimplemented expression operator "${s}"`);return n.parse(t,e,i)}const b5e={array:Ux,boolean:Ux,collator:null,format:null,image:null,literal:One,number:Ux,"number-format":null,object:Ux,string:Ux,"to-boolean":Ld,"to-color":Ld,"to-number":Ld,"to-string":Ld,typeof:Rne,accumulated:null,"feature-state":null,"geometry-type":WDt,id:qDt,"line-progress":null,properties:YDt,at:hNt,get:dNt,has:pNt,in:fNt,"index-of":mNt,length:gNt,slice:yNt,"!":tNt,"!=":XDt,"<":JDt,"<=":QDt,"==":ZDt,">":KDt,">=":eNt,all:iNt,any:rNt,case:nNt,coalesce:oNt,match:aNt,within:null,interpolate:Ck,"interpolate-hcl":Ck,"interpolate-lab":Ck,step:lNt,let:cNt,var:uNt,concat:Cne,downcase:CA,"is-supported-script":null,"resolved-locale":null,upcase:CA,rgb:Mne,rgba:Ane,"to-rgba":Pne,"-":vNt,"*":bNt,"/":wNt,"%":xNt,"^":SNt,"+":TNt,abs:En,acos:En,asin:En,atan:En,ceil:En,cos:En,e:En,floor:En,ln:En,ln2:En,log10:En,log2:En,max:En,min:En,pi:En,round:En,sin:En,sqrt:En,tan:En,zoom:i5e,"heatmap-density":null,"has-id":_Nt,none:sNt};let ENt=class Wu{constructor(e){this._expression=e}filter(e,i){if(!this._expression)return!0;try{return this._expression.evaluate(e,i)}catch(r){return console.log(r.message),!0}}static createFilter(e){if(!e)return null;this.isLegacyFilter(e)&&(e=this.convertLegacyFilter(e));try{const i=ri(e,null,al);return new Wu(i)}catch(i){return console.log(i.message),null}}static isLegacyFilter(e){if(!Array.isArray(e)||e.length===0)return!0;switch(e[0]){case"==":case"!=":case">":case"<":case">=":case"<=":return e.length===3&&typeof e[1]=="string"&&!Array.isArray(e[2]);case"in":return e.length>=3&&typeof e[1]=="string"&&!Array.isArray(e[2]);case"!in":case"none":case"!has":return!0;case"any":case"all":for(let i=1;i<e.length;i++)if(this.isLegacyFilter(e[i]))return!0;return!1;case"has":return e.length===2&&(e[1]==="$id"||e[1]==="$type");default:return!1}}static convertLegacyFilter(e){if(!Array.isArray(e)||e.length===0)return!0;const i=e[0];if(e.length===1)return i!=="any";switch(i){case"==":return Wu.convertComparison("==",e[1],e[2]);case"!=":return Wu.negate(Wu.convertComparison("==",e[1],e[2]));case">":case"<":case">=":case"<=":return Wu.convertComparison(i,e[1],e[2]);case"in":return Wu.convertIn(e[1],e.slice(2));case"!in":return Wu.negate(Wu.convertIn(e[1],e.slice(2)));case"any":case"all":case"none":return Wu.convertCombining(i,e.slice(1));case"has":return Wu.convertHas(e[1]);case"!has":return Wu.negate(Wu.convertHas(e[1]));default:throw new Error("Unexpected legacy filter.")}}static convertComparison(e,i,r){switch(i){case"$type":return[e,["geometry-type"],r];case"$id":return[e,["id"],r];default:return[e,["get",i],r]}}static convertIn(e,i){switch(e){case"$type":return["in",["geometry-type"],["literal",i]];case"$id":return["in",["id"],["literal",i]];default:return["in",["get",e],["literal",i]]}}static convertHas(e){switch(e){case"$type":return!0;case"$id":return["has-id"];default:return["has",e]}}static convertCombining(e,i){return[e].concat(i.map(this.convertLegacyFilter))}static negate(e){return["!",e]}},f_e=class w5e{constructor(e,i){let r;switch(this.isDataDriven=!1,this.interpolator=null,e.type){case"number":case"color":r=!0;break;case"array":r=e.value==="number";break;default:r=!1}if(i==null&&(i=e.default),Array.isArray(i)&&i.length>0&&b5e[i[0]]){const n={number:Rn,color:L0,string:Ph,boolean:al,enum:Ph};try{const o=e.type==="array"?ZL(n[e.value]||v0,e.length):n[e.type],a=ri(i,null,o);this.getValue=this._buildExpression(a,e),this.isDataDriven=!0,a instanceof Ck&&a.input instanceof i5e&&(this.interpolator=a)}catch(o){console.log(o.message),this.getValue=this._buildSimple(e.default)}return}r&&i.type==="interval"&&(r=!1);const s=(i==null?void 0:i.stops)&&i.stops.length>0;if(s)for(const n of i.stops)n[1]=this._validate(n[1],e);if(this.isDataDriven=!!i&&!!i.property,this.isDataDriven)if(i.default!==void 0&&(i.default=this._validate(i.default,e)),s)switch(i.type){case"identity":this.getValue=this._buildIdentity(i,e);break;case"categorical":this.getValue=this._buildCategorical(i,e);break;default:this.getValue=r?this._buildInterpolate(i,e):this._buildInterval(i,e)}else this.getValue=this._buildIdentity(i,e);else s?this.getValue=r?this._buildZoomInterpolate(i):this._buildZoomInterval(i):(i=this._validate(i,e),this.getValue=this._buildSimple(i))}_validate(e,i){if(i.type==="number"){if(i.minimum!=null&&e<i.minimum)return i.minimum;if(i.maximum!=null&&e>i.maximum)return i.maximum}else i.type==="color"?e=w5e._parseColor(e):i.type==="enum"?typeof e=="string"&&(e=i.values.indexOf(e)):i.type==="array"&&i.value==="enum"?e=e.map(r=>typeof r=="string"?i.values.indexOf(r):r):i.type==="string"&&(e=tQ(e));return e}_buildSimple(e){return()=>e}_buildExpression(e,i){return(r,s)=>{try{const n=e.evaluate(s,r);return n===void 0?i.default:this._validate(n,i)}catch(n){return console.log(n.message),i.default}}}_buildIdentity(e,i){return(r,s)=>{let n;return s&&(n=s.values[e.property]),n!==void 0&&(n=this._validate(n,i)),n??(e.default!==void 0?e.default:i.default)}}_buildCategorical(e,i){return(r,s)=>{let n;return s&&(n=s.values[e.property]),n=this._categorical(n,e.stops),n!==void 0?n:e.default!==void 0?e.default:i.default}}_buildInterval(e,i){return(r,s)=>{let n;return s&&(n=s.values[e.property]),typeof n=="number"?this._interval(n,e.stops):e.default!==void 0?e.default:i.default}}_buildInterpolate(e,i){return(r,s)=>{let n;return s&&(n=s.values[e.property]),typeof n=="number"?this._interpolate(n,e.stops,e.base||1):e.default!==void 0?e.default:i.default}}_buildZoomInterpolate(e){return i=>this._interpolate(i,e.stops,e.base||1)}_buildZoomInterval(e){return i=>this._interval(i,e.stops)}_categorical(e,i){const r=i.length;for(let s=0;s<r;s++)if(i[s][0]===e)return i[s][1]}_interval(e,i){const r=i.length;let s=0;for(let n=0;n<r&&i[n][0]<=e;n++)s=n;return i[s][1]}_interpolate(e,i,r){let s,n;const o=i.length;for(let a=0;a<o;a++){const l=i[a];if(!(l[0]<=e)){n=l;break}s=l}if(s&&n){const a=n[0]-s[0],l=e-s[0],c=r===1?l/a:(r**l-1)/(r**a-1);if(Array.isArray(s[1])){const u=s[1],d=n[1],p=[];for(let m=0;m<u.length;m++)p.push(uc(u[m],d[m],c));return p}return uc(s[1],n[1],c)}return s?s[1]:n?n[1]:void 0}static _isEmpty(e){for(const i in e)if(e.hasOwnProperty(i))return!1;return!0}static _parseColor(e){return Array.isArray(e)?e:(typeof e=="string"&&(e=new Oe(e)),e instanceof Oe&&!this._isEmpty(e)?Oe.toUnitRGBA(e):void 0)}};const MA=8;var SI;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(SI||(SI={}));let XL=class{constructor(e,i,r,s){switch(this.type=e,this.typeName=i.type,this.id=i.id,this.source=i.source,this.sourceLayer=i["source-layer"],this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,this.filter=i.filter,this.layout=i.layout,this.paint=i.paint,this.z=r,this.uid=s,e){case Cn.BACKGROUND:this._layoutDefinition=so.backgroundLayoutDefinition,this._paintDefinition=so.backgroundPaintDefinition;break;case Cn.FILL:this._layoutDefinition=so.fillLayoutDefinition,this._paintDefinition=so.fillPaintDefinition;break;case Cn.LINE:this._layoutDefinition=so.lineLayoutDefinition,this._paintDefinition=so.linePaintDefinition;break;case Cn.SYMBOL:this._layoutDefinition=so.symbolLayoutDefinition,this._paintDefinition=so.symbolPaintDefinition;break;case Cn.CIRCLE:this._layoutDefinition=so.circleLayoutDefinition,this._paintDefinition=so.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout),this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return this._featureFilter!==void 0?this._featureFilter:this._featureFilter=ENt.createFilter(this.filter)}getLayoutProperty(e){return this._layoutProperties[e]}getPaintProperty(e){return this._paintProperties[e]}getLayoutValue(e,i,r){let s;const n=this._layoutProperties[e];return n&&(s=n.getValue(i,r)),s===void 0&&(s=this._layoutDefinition[e].default),s}getPaintValue(e,i,r){let s;const n=this._paintProperties[e];return n&&(s=n.getValue(i,r)),s===void 0&&(s=this._paintDefinition[e].default),s}isPainterDataDriven(){const e=this._paintProperties;if(e){for(const i in e)if(e[i].isDataDriven)return!0}return!1}isIntersectingFeature(e,i,r,s,n,o,a){return!1}getFeatureInflatedBounds(e,i,r,s){return null}_parseLayout(e){const i={};for(const r in e){const s=this._layoutDefinition[r];s&&(i[r]=new f_e(s,e[r]))}return i}_parsePaint(e){const i={};for(const r in e){const s=this._paintDefinition[r];s&&(i[r]=new f_e(s,e[r]))}return i}computeAttributesKey(e,i,r,s){let n=0,o=0;for(const a of i){let l=3;if(!a||a!==s){const c=r[a],{isLayout:u,isOptional:d}=c,p=u?this.getLayoutProperty(a):this.getPaintProperty(a);l=p!=null&&p.interpolator?2:p!=null&&p.isDataDriven?1:d&&!p?3:0}o|=l<<n,n+=2}return o<<3|e}},m_e=class extends XL{constructor(e,i,r,s){super(e,i,r,s),this.backgroundMaterial=new pM(this.computeAttributesKey(I0.BACKGROUND,pM.ATTRIBUTES,pM.ATTRIBUTES_INFO))}},g_e=class extends XL{constructor(e,i,r,s){super(e,i,r,s);const n=this.getPaintProperty("fill-color"),o=this.getPaintProperty("fill-opacity"),a=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=n==null?void 0:n.isDataDriven,this.hasDataDrivenOpacity=o==null?void 0:o.isDataDriven,this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||(a==null?void 0:a.isDataDriven);const l=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!l,this.hasDataDrivenOutlineColor=l==null?void 0:l.isDataDriven,this.hasDataDrivenOutline=l?l.isDataDriven:!!n&&n.isDataDriven,this.hasDataDrivenOutline=(l?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity,this.fillMaterial=new mM(this.computeAttributesKey(I0.FILL,mM.ATTRIBUTES,mM.ATTRIBUTES_INFO)),this.outlineMaterial=new Jm(this.computeAttributesKey(I0.OUTLINE,this.outlineUsesFillColor?Jm.ATTRIBUTES_FILL:Jm.ATTRIBUTES_OUTLINE,this.outlineUsesFillColor?Jm.ATTRIBUTES_INFO_FILL:Jm.ATTRIBUTES_INFO_OUTLINE),this.outlineUsesFillColor)}getFeatureInflatedBounds(e,i,r,s){const n=$ne(e);if(!n)return null;const o=this.getPaintValue("fill-translate",i,e),a=s*Math.max(o[0],o[1]);return n[0]-=a,n[2]-=a,n[1]+=a,n[3]+=a,n}isIntersectingFeature(e,i,r,s,n,o,a){const l=s.getGeometry();if(!l)return!1;const c=MA/a.normalizationRatio;e=e/a.normalizationRatio+a.normalizationOffsetX,i=i/a.normalizationRatio+a.normalizationOffsetY;const u=lse(this.getPaintValue("fill-translate",n,s),this.getPaintValue("fill-translate-anchor",n,s),o,MA);return e-=c*u.x,i-=c*u.y,!!cvt(e,i,l)||O3e(e,i,l,c*r)}},y_e=class extends XL{constructor(e,i,r,s){var o,a,l,c,u,d,p,m,g;super(e,i,r,s);const n=this.getPaintProperty("line-pattern");if(this.lineMaterial=new gM(this.computeAttributesKey(I0.LINE,gM.ATTRIBUTES,gM.ATTRIBUTES_INFO,n?"line-dasharray":"")),this.hasDataDrivenLine=((o=this.getPaintProperty("line-blur"))==null?void 0:o.isDataDriven)||((a=this.getPaintProperty("line-color"))==null?void 0:a.isDataDriven)||((l=this.getPaintProperty("line-gap-width"))==null?void 0:l.isDataDriven)||((c=this.getPaintProperty("line-offset"))==null?void 0:c.isDataDriven)||((u=this.getPaintProperty("line-opacity"))==null?void 0:u.isDataDriven)||((d=this.getPaintProperty("line-pattern"))==null?void 0:d.isDataDriven)||((p=this.getPaintProperty("line-dasharray"))==null?void 0:p.isDataDriven)||((m=this.getLayoutProperty("line-cap"))==null?void 0:m.isDataDriven)||((g=this.getPaintProperty("line-width"))==null?void 0:g.isDataDriven),this.canUseThinTessellation=!1,!this.hasDataDrivenLine){const y=this.getPaintProperty("line-width");if(!y||typeof y=="number"&&.5*y<p_t){const v=this.getPaintProperty("line-offset");(!v||typeof v=="number"&&v===0)&&(this.canUseThinTessellation=!0)}}}getDashKey(e,i){let r;switch(i){case SI.BUTT:r="Butt";break;case SI.ROUND:r="Round";break;case SI.SQUARE:r="Square";break;default:r="Butt"}return`dasharray-[${e.toString()}]-${r}`}getFeatureInflatedBounds(e,i,r,s){const n=$ne(e);if(!n)return null;const o=this.getPaintValue("line-translate",i,e),a=s*Math.max(o[0],o[1]);n[0]-=a,n[2]-=a,n[1]+=a,n[3]+=a;const l=s*Math.abs(this.getPaintValue("line-offset",i,e)||0),c=s*(this.getPaintValue("line-width",i,e)/2);return n[0]-=l+c,n[1]-=l+c,n[2]+=l+c,n[3]+=l+c,n}isIntersectingFeature(e,i,r,s,n,o,a){let l=s.getGeometry();if(!l)return!1;const c=MA/a.normalizationRatio;e=e/a.normalizationRatio+a.normalizationOffsetX,i=i/a.normalizationRatio+a.normalizationOffsetY;const u=lse(this.getPaintValue("line-translate",n,s),this.getPaintValue("line-translate-anchor",n,s),o,MA);e-=c*u.x,i-=c*u.y;const d=c*this.getPaintValue("line-offset",n,s)||0;d!==0&&(l=hvt(l,-d));const p=this.getPaintValue("line-width",n,s);return O3e(e,i,l,c*(r+p/2))}},__e=class extends XL{constructor(e,i,r,s){var n,o,a,l,c,u,d,p,m,g,y,v;super(e,i,r,s),this.iconMaterial=new wI(this.computeAttributesKey(I0.ICON,wI.ATTRIBUTES,wI.ATTRIBUTES_INFO)),this.textMaterial=new xI(this.computeAttributesKey(I0.TEXT,xI.ATTRIBUTES,xI.ATTRIBUTES_INFO)),this.hasDataDrivenIcon=((n=this.getPaintProperty("icon-color"))==null?void 0:n.isDataDriven)||((o=this.getPaintProperty("icon-halo-blur"))==null?void 0:o.isDataDriven)||((a=this.getPaintProperty("icon-halo-color"))==null?void 0:a.isDataDriven)||((l=this.getPaintProperty("icon-halo-width"))==null?void 0:l.isDataDriven)||((c=this.getPaintProperty("icon-opacity"))==null?void 0:c.isDataDriven)||((u=this.getLayoutProperty("icon-size"))==null?void 0:u.isDataDriven),this.hasDataDrivenText=((d=this.getPaintProperty("text-color"))==null?void 0:d.isDataDriven)||((p=this.getPaintProperty("text-halo-blur"))==null?void 0:p.isDataDriven)||((m=this.getPaintProperty("text-halo-color"))==null?void 0:m.isDataDriven)||((g=this.getPaintProperty("text-halo-width"))==null?void 0:g.isDataDriven)||((y=this.getPaintProperty("text-opacity"))==null?void 0:y.isDataDriven)||((v=this.getLayoutProperty("text-size"))==null?void 0:v.isDataDriven)}},v_e=class extends XL{constructor(e,i,r,s){super(e,i,r,s),this.circleMaterial=new fM(this.computeAttributesKey(I0.CIRCLE,fM.ATTRIBUTES,fM.ATTRIBUTES_INFO))}getFeatureInflatedBounds(e,i,r,s){const n=$ne(e);if(!n)return null;const o=this.getPaintValue("circle-translate",i,e),a=Math.max(o[0],o[1]);n[0]-=a,n[2]-=a,n[1]+=a,n[3]+=a;const l=s*(MA*(this.getPaintValue("circle-radius",i,e)+this.getPaintValue("circle-stroke-width",i,e))/2);return n[0]-=l,n[1]-=l,n[2]+=l,n[3]+=l,n}isIntersectingFeature(e,i,r,s,n,o,a){const l=s.getGeometry();if(!l)return!1;const c=MA/a.normalizationRatio;e=e/a.normalizationRatio+a.normalizationOffsetX,i=i/a.normalizationRatio+a.normalizationOffsetY,r*=c;const u=lse(this.getPaintValue("circle-translate",n,s),this.getPaintValue("circle-translate-anchor",n,s),o,c),d=c*(this.getPaintValue("circle-radius",n,s)+this.getPaintValue("circle-stroke-width",n,s));let p,m;for(const g of l)if(g){for(const y of g)if(p=y.x+u.x,m=y.y+u.y,Math.sqrt((e-p)*(e-p)+(i-m)*(i-m))-r<=d)return!0}return!1}},osi=class{constructor(e,i,r){let s;this.allowOverlap=e.getLayoutValue("icon-allow-overlap",i),this.ignorePlacement=e.getLayoutValue("icon-ignore-placement",i),this.keepUpright=e.getLayoutValue("icon-keep-upright",i),this.optional=e.getLayoutValue("icon-optional",i),this.rotationAlignment=e.getLayoutValue("icon-rotation-alignment",i),this.rotationAlignment===Ya.AUTO&&(this.rotationAlignment=r?Ya.MAP:Ya.VIEWPORT),s=e.getLayoutProperty("icon-anchor"),s!=null&&s.isDataDriven?this._anchorProp=s:this.anchor=e.getLayoutValue("icon-anchor",i),s=e.getLayoutProperty("icon-offset"),s!=null&&s.isDataDriven?this._offsetProp=s:this.offset=e.getLayoutValue("icon-offset",i),s=e.getLayoutProperty("icon-padding"),s!=null&&s.isDataDriven?this._paddingProp=s:this.padding=e.getLayoutValue("icon-padding",i),s=e.getLayoutProperty("icon-rotate"),s!=null&&s.isDataDriven?this._rotateProp=s:this.rotate=e.getLayoutValue("icon-rotate",i),s=e.getLayoutProperty("icon-size"),s!=null&&s.isDataDriven?this._sizeProp=s:this.size=e.getLayoutValue("icon-size",i)}update(e,i){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,i)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,i)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,i)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,i)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,i))}},lsi=class{constructor(e,i,r){let s;this.allowOverlap=e.getLayoutValue("text-allow-overlap",i),this.ignorePlacement=e.getLayoutValue("text-ignore-placement",i),this.keepUpright=e.getLayoutValue("text-keep-upright",i),this.optional=e.getLayoutValue("text-optional",i),this.rotationAlignment=e.getLayoutValue("text-rotation-alignment",i),this.rotationAlignment===Ya.AUTO&&(this.rotationAlignment=r?Ya.MAP:Ya.VIEWPORT),s=e.getLayoutProperty("text-anchor"),s!=null&&s.isDataDriven?this._anchorProp=s:this.anchor=e.getLayoutValue("text-anchor",i),s=e.getLayoutProperty("text-justify"),s!=null&&s.isDataDriven?this._justifyProp=s:this.justify=e.getLayoutValue("text-justify",i),s=e.getLayoutProperty("text-letter-spacing"),s!=null&&s.isDataDriven?this._letterSpacingProp=s:this.letterSpacing=e.getLayoutValue("text-letter-spacing",i),s=e.getLayoutProperty("text-line-height"),s!=null&&s.isDataDriven?this._lineHeightProp=s:this.lineHeight=e.getLayoutValue("text-line-height",i),s=e.getLayoutProperty("text-max-angle"),s!=null&&s.isDataDriven?this._maxAngleProp=s:this.maxAngle=e.getLayoutValue("text-max-angle",i),s=e.getLayoutProperty("text-max-width"),s!=null&&s.isDataDriven?this._maxWidthProp=s:this.maxWidth=e.getLayoutValue("text-max-width",i),s=e.getLayoutProperty("text-offset"),s!=null&&s.isDataDriven?this._offsetProp=s:this.offset=e.getLayoutValue("text-offset",i),s=e.getLayoutProperty("text-padding"),s!=null&&s.isDataDriven?this._paddingProp=s:this.padding=e.getLayoutValue("text-padding",i),s=e.getLayoutProperty("text-rotate"),s!=null&&s.isDataDriven?this._rotateProp=s:this.rotate=e.getLayoutValue("text-rotate",i),s=e.getLayoutProperty("text-size"),s!=null&&s.isDataDriven?this._sizeProp=s:this.size=e.getLayoutValue("text-size",i),s=e.getLayoutProperty("text-writing-mode"),s!=null&&s.isDataDriven?this._writingModeProp=s:this.writingMode=e.getLayoutValue("text-writing-mode",i)}update(e,i){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,i)),this._justifyProp&&(this.justify=this._justifyProp.getValue(e,i)),this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(e,i)),this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(e,i)),this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(e,i)),this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(e,i)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,i)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,i)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,i)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,i)),this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(e,i))}};function $ne(t){const e=t==null?void 0:t.getGeometry();if(e==null)return null;let i=1/0,r=1/0,s=-1/0,n=-1/0;for(const o of e)if(o)for(const a of o)i=Math.min(i,a.x),r=Math.min(r,a.y),s=Math.max(s,a.x),n=Math.max(n,a.y);return Z3(i,r,s,n)}let CNt=class h${constructor(e){if(this._style=e,this.backgroundBucketIds=[],this._uidToLayer=new Map,this._layerByName={},this._runningId=0,e.layers||(e.layers=[]),this.version=parseFloat(e.version),this.layers=e.layers.map((i,r,s)=>this._create(i,r,s)).filter(i=>!!i),this.layers)for(let i=0;i<this.layers.length;i++){const r=this.layers[i];this._layerByName[r.id]=r,this._uidToLayer.set(r.uid,r),r.type===Cn.BACKGROUND&&this.backgroundBucketIds.push(r.id)}this._identifyRefLayers()}isPainterDataDriven(e){const i=this._layerByName[e];return!!i&&i.isPainterDataDriven()}getStyleLayerId(e){return e>=this.layers.length?null:this.layers[e].id}getStyleLayerByUID(e){return this._uidToLayer.get(e)??null}getStyleLayerIndex(e){const i=this._layerByName[e];return i?this.layers.indexOf(i):-1}setStyleLayer(e,i){if(!(e!=null&&e.id))return;const r=this._style;i!=null&&i>=this.layers.length&&(i=this.layers.length-1);let s,n=!0;const o=this._layerByName[e.id];if(o){const a=this.layers.indexOf(o);i||(i=a),i===a?(n=!1,s=h$._recreateLayer(e,o),this.layers[i]=s,r.layers[i]=e):(this.layers.splice(a,1),r.layers.splice(a,1),s=this._create(e,i,this.layers),this.layers.splice(i,0,s),r.layers.splice(i,0,e))}else s=this._create(e,i,this.layers),!i||i>=this.layers.length?(this.layers.push(s),r.layers.push(e)):(this.layers.splice(i,0,s),r.layers.splice(i,0,e));this._layerByName[e.id]=s,this._uidToLayer.set(s.uid,s),n&&this._recomputeZValues(),this._identifyRefLayers()}getStyleLayer(e){const i=this._layerByName[e];return i?{type:i.typeName,id:i.id,source:i.source,"source-layer":i.sourceLayer,minzoom:i.minzoom,maxzoom:i.maxzoom,filter:i.filter,layout:i.layout,paint:i.paint}:null}deleteStyleLayer(e){const i=this._layerByName[e];if(i){delete this._layerByName[e],this._uidToLayer.delete(i.uid);const r=this.layers.indexOf(i);this.layers.splice(r,1),this._style.layers.splice(r,1),this._recomputeZValues(),this._identifyRefLayers()}}getLayerById(e){return this._layerByName[e]}getLayoutProperties(e){const i=this._layerByName[e];return i?i.layout:null}getPaintProperties(e){const i=this._layerByName[e];return i?i.paint:null}setPaintProperties(e,i){const r=this._layerByName[e];if(!r)return;const s={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:r.layout,paint:i},n=h$._recreateLayer(s,r),o=this.layers.indexOf(r);this.layers[o]=n,this._style.layers[o].paint=i,this._layerByName[r.id]=n,this._uidToLayer.set(r.uid,n)}setLayoutProperties(e,i){const r=this._layerByName[e];if(!r)return;const s={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:i,paint:r.paint},n=h$._recreateLayer(s,r),o=this.layers.indexOf(r);this.layers[o]=n,this._style.layers[o].layout=i,this._layerByName[r.id]=n,this._uidToLayer.set(r.uid,n)}setStyleLayerVisibility(e,i){const r=this._layerByName[e];if(!r)return;const s=r.layout||{};s.visibility=i;const n={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:s,paint:r.paint},o=h$._recreateLayer(n,r),a=this.layers.indexOf(r);this.layers[a]=o,this._style.layers[a].layout=s,this._layerByName[r.id]=o,this._uidToLayer.set(r.uid,o)}getStyleLayerVisibility(e){const i=this._layerByName[e];if(!i)return"none";const r=i.layout;return(r==null?void 0:r.visibility)??"visible"}_recomputeZValues(){const e=this.layers,i=1/(e.length+1);for(let r=0;r<e.length;r++)e[r].z=1-(1+r)*i}_identifyRefLayers(){const e=[],i=[];let r=0;for(const s of this.layers){const n=s.layout;if(s.type===Cn.FILL){const o=s;let a=s.source+"|"+s.sourceLayer;a+="|"+((n==null?void 0:n.visibility)??""),a+="|"+s.minzoom,a+="|"+s.maxzoom,a+="|"+JSON.stringify(s.filter),(o.hasDataDrivenFill||o.hasDataDrivenOutline)&&(a+="|"+r),e.push({key:a,layer:s})}else if(s.type===Cn.LINE){const o=s,a=s.paint,l=a!=null&&(a["line-pattern"]!=null||a["line-dasharray"]!=null);let c=s.source+"|"+s.sourceLayer;c+="|"+((n==null?void 0:n.visibility)??""),c+="|"+s.minzoom,c+="|"+s.maxzoom,c+="|"+JSON.stringify(s.filter),c+="|"+(n!==void 0?n["line-cap"]:""),c+="|"+(n!==void 0?n["line-join"]:""),(o.hasDataDrivenLine||l)&&(c+="|"+r),i.push({key:c,layer:s})}++r}this._assignRefLayers(e),this._assignRefLayers(i)}_assignRefLayers(e){let i,r;e.sort((n,o)=>n.key<o.key?-1:n.key>o.key?1:0);const s=e.length;for(let n=0;n<s;n++){const o=e[n];if(o.key===i)o.layer.refLayerId=r;else if(i=o.key,r=o.layer.id,o.layer.type===Cn.FILL){if(!o.layer.getPaintProperty("fill-outline-color"))for(let a=n+1;a<s;a++){const l=e[a];if(l.key!==i)break;if(l.layer.getPaintProperty("fill-outline-color")){e[n]=l,e[a]=o,r=l.layer.id;break}}}else if(o.layer.type===Cn.LINE){let a=o.layer;for(let l=n+1;l<s;l++){const c=e[l];if(c.key!==i)break;const u=c.layer;(a.canUseThinTessellation&&!u.canUseThinTessellation||!a.canUseThinTessellation&&(u.getPaintProperty("line-pattern")||u.getPaintProperty("line-dasharray")))&&(a=u,e[n]=c,e[l]=o,r=c.layer.id)}}}}_create(e,i,r){const s=1-(1+i)*(1/(r.length+1)),n=this._runningId++;switch(e.type){case"background":return new m_e(Cn.BACKGROUND,e,s,n);case"fill":return new g_e(Cn.FILL,e,s,n);case"line":return new y_e(Cn.LINE,e,s,n);case"symbol":return new __e(Cn.SYMBOL,e,s,n);case"raster":return console.warn(`Unsupported vector tile raster layer ${e.id}`),null;case"circle":return new v_e(Cn.CIRCLE,e,s,n)}return null}static _recreateLayer(e,i){switch(e.type){case"background":return new m_e(Cn.BACKGROUND,e,i.z,i.uid);case"fill":return new g_e(Cn.FILL,e,i.z,i.uid);case"line":return new y_e(Cn.LINE,e,i.z,i.uid);case"symbol":return new __e(Cn.SYMBOL,e,i.z,i.uid);case"raster":return console.warn(`Unsupported vector tile raster layer ${e.id}`),null;case"circle":return new v_e(Cn.CIRCLE,e,i.z,i.uid)}return null}},as=class extends _ne(Aj(mDt(wne(Tne(Ene(xne(bne(Pj(uL))))))))){constructor(...e){super(...e),this._spriteSourceMap=new Map,this.currentStyleInfo=null,this.isReference=null,this.operationalLayerType="VectorTileLayer",this.style=null,this.tilemapCache=null,this.type="vector-tile",this.url=null,this.path=null}normalizeCtorArgs(e,i){return typeof e=="string"?{url:e,...i}:e}destroy(){var e;if(this.sourceNameToSource)for(const i of Object.values(this.sourceNameToSource))i==null||i.destroy();(e=this.primarySource)==null||e.destroy(),this._spriteSourceMap.clear()}async prefetchResources(e){await this.loadSpriteSource(globalThis.devicePixelRatio||1,e)}load(e){const i=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1},e).catch(Pn).then(async()=>{var s;if(!((s=this.portalItem)!=null&&s.id))return;const r=`${this.portalItem.itemCdnUrl}/resources/styles/root.json`;(await Yt(r,{...e,query:{f:"json",...this.customParameters,token:this.apiKey}})).data&&this.read({url:r},kDt(this.portalItem,"portal-item"))}).catch(Pn).then(()=>this._loadStyle(e));return this.addResolvingPromise(i),Promise.resolve(this)}get attributionDataUrl(){const e=this.currentStyleInfo,i=(e==null?void 0:e.serviceUrl)&&Ns(e.serviceUrl);if(!i)return null;const r=this._getDefaultAttribution(i.path);return r?ag(r,{...this.customParameters,token:this.apiKey}):null}get capabilities(){const e=this.primarySource;return e?e.capabilities:{operations:{supportsExportTiles:!1,supportsTileMap:!1},exportTiles:null}}get fullExtent(){var e;return((e=this.primarySource)==null?void 0:e.fullExtent)||null}get initialExtent(){var e;return((e=this.primarySource)==null?void 0:e.initialExtent)||null}get parsedUrl(){return this.serviceUrl?Ns(this.serviceUrl):null}get serviceUrl(){var e;return((e=this.currentStyleInfo)==null?void 0:e.serviceUrl)||null}get spatialReference(){var e;return((e=this.tileInfo)==null?void 0:e.spatialReference)??null}get styleUrl(){var e;return((e=this.currentStyleInfo)==null?void 0:e.styleUrl)||null}writeStyleUrl(e,i){e&&zd(e)&&(e=`https:${e}`);const r=W9(e);i.styleUrl=Pte(e,r)}get tileInfo(){var r;const e=[];for(const s in this.sourceNameToSource)e.push(this.sourceNameToSource[s]);let i=((r=this.primarySource)==null?void 0:r.tileInfo)||new ug;if(e.length>1)for(let s=0;s<e.length;s++)UDt(i,e[s].tileInfo)&&(i=zDt(i,e[s].tileInfo));return i}readTilemapCache(e,i){var s;return((s=i.capabilities)==null?void 0:s.includes("Tilemap"))?new ud({layer:this}):null}readVersion(e,i){return i.version?parseFloat(i.version):parseFloat(i.currentVersion)}async loadSpriteSource(e=1,i){var r,s;if(!this._spriteSourceMap.has(e)){const n=UJ().maxTextureSize,o=(r=this.currentStyleInfo)!=null&&r.spriteUrl?ag(this.currentStyleInfo.spriteUrl,{...this.customParameters,token:this.apiKey}):null,a=new l_e({type:"url",spriteUrl:o,pixelRatio:e,spriteFormat:(s=this.currentStyleInfo)==null?void 0:s.spriteFormat},n);await a.load(i),this._spriteSourceMap.set(e,a)}return this._spriteSourceMap.get(e)}async setSpriteSource(e,i){if(!e)return null;const r=UJ().maxTextureSize,s=e.spriteUrl,n=s?ag(s,{...this.customParameters,token:this.apiKey}):null;if(!n&&e.type==="url")return null;const o=new l_e(e,r);try{await o.load(i);const a=e.pixelRatio||1;return this._spriteSourceMap.clear(),this._spriteSourceMap.set(a,o),n&&this.currentStyleInfo&&(this.currentStyleInfo.spriteUrl=n),this.emit("spriteSource-change",{spriteSource:o}),o}catch(a){Pn(a)}return null}async loadStyle(e,i){var s;const r=e||this.style||this.url;return this._loadingTask&&typeof r=="string"&&this.url===r||((s=this._loadingTask)==null||s.abort(),this._loadingTask=Nf(n=>(this._spriteSourceMap.clear(),this._getSourceAndStyle(r,{signal:n})),i)),this._loadingTask.promise}getStyleLayerId(e){return this.styleRepository.getStyleLayerId(e)}getStyleLayerIndex(e){return this.styleRepository.getStyleLayerIndex(e)}getPaintProperties(e){var i;return Q((i=this.styleRepository)==null?void 0:i.getPaintProperties(e))}setPaintProperties(e,i){const r=this.styleRepository.isPainterDataDriven(e);this.styleRepository.setPaintProperties(e,i);const s=this.styleRepository.isPainterDataDriven(e);this.emit("paint-change",{layer:e,paint:i,isDataDriven:r||s})}getStyleLayer(e){return Q(this.styleRepository.getStyleLayer(e))}setStyleLayer(e,i){this.styleRepository.setStyleLayer(e,i),this.emit("style-layer-change",{layer:e,index:i})}deleteStyleLayer(e){this.styleRepository.deleteStyleLayer(e),this.emit("delete-style-layer",{layer:e})}getLayoutProperties(e){return Q(this.styleRepository.getLayoutProperties(e))}setLayoutProperties(e,i){this.styleRepository.setLayoutProperties(e,i),this.emit("layout-change",{layer:e,layout:i})}setStyleLayerVisibility(e,i){this.styleRepository.setStyleLayerVisibility(e,i),this.emit("style-layer-visibility-change",{layer:e,visibility:i})}getStyleLayerVisibility(e){return this.styleRepository.getStyleLayerVisibility(e)}write(e,i){return i!=null&&i.origin&&!this.styleUrl?(i.messages&&i.messages.push(new V("vectortilelayer:unsupported",`VectorTileLayer (${this.title}, ${this.id}) with style defined by JSON only are not supported`,{layer:this})),null):super.write(e,i)}getTileUrl(e,i,r){return null}async _getSourceAndStyle(e,i){if(!e)throw new Error("invalid style!");const r=await IDt(e,{...i,query:{...this.customParameters,token:this.apiKey}});r.spriteFormat==="webp"&&(await CDt("lossy")||(r.spriteFormat="png")),this._set("currentStyleInfo",{...r}),typeof e=="string"?(this.url=e,this.style=null):(this.url=null,this.style=e),this._set("sourceNameToSource",r.sourceNameToSource),this._set("primarySource",r.sourceNameToSource[r.primarySourceName]),this._set("styleRepository",new CNt(r.style)),this.read(r.layerDefinition,{origin:"service"}),this.emit("load-style")}_getDefaultAttribution(e){const i=e.match(/^https?:\/\/(?:basemaps|basemapsbeta|basemapsdev)(?:-api)?\.arcgis\.com(\/[^/]+)?\/arcgis\/rest\/services\/([^/]+(\/[^/]+)*)\/vectortileserver/i),r=["OpenStreetMap_v2","OpenStreetMap_Daylight_v2","OpenStreetMap_Export_v2","OpenStreetMap_FTS_v2","OpenStreetMap_GCS_v2","World_Basemap","World_Basemap_v2","World_Basemap_Export_v2","World_Basemap_GCS_v2","World_Basemap_WGS84","World_Contours_v2","World_Hillshade_v2"];if(!i)return;const s=i[2]&&i[2].toLowerCase();if(!s)return;const n=i[1]||"";for(const o of r)if(o.toLowerCase().includes(s))return vh(`//static.arcgis.com/attribution/Vector${n}/${o}`)}async _loadStyle(e){var i;return((i=this._loadingTask)==null?void 0:i.promise)??this.loadStyle(null,e)}};h([f({readOnly:!0})],as.prototype,"attributionDataUrl",null),h([f({type:["show","hide"]})],as.prototype,"listMode",void 0),h([f({json:{read:!0,write:!0}})],as.prototype,"blendMode",void 0),h([f({readOnly:!0,json:{read:!1}})],as.prototype,"capabilities",null),h([f({readOnly:!0})],as.prototype,"currentStyleInfo",void 0),h([f({json:{read:!1},readOnly:!0,type:gi})],as.prototype,"fullExtent",null),h([f({json:{read:!1},readOnly:!0,type:gi})],as.prototype,"initialExtent",null),h([f({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],as.prototype,"isReference",void 0),h([f({type:["VectorTileLayer"]})],as.prototype,"operationalLayerType",void 0),h([f({readOnly:!0})],as.prototype,"parsedUrl",null),h([f()],as.prototype,"style",void 0),h([f({readOnly:!0})],as.prototype,"serviceUrl",null),h([f({type:We,readOnly:!0})],as.prototype,"spatialReference",null),h([f({readOnly:!0})],as.prototype,"styleRepository",void 0),h([f({readOnly:!0})],as.prototype,"sourceNameToSource",void 0),h([f({readOnly:!0})],as.prototype,"primarySource",void 0),h([f({type:String,readOnly:!0,json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],as.prototype,"styleUrl",null),h([Ve(["portal-item","web-document"],"styleUrl")],as.prototype,"writeStyleUrl",null),h([f({json:{read:!1,origins:{service:{read:!1}}},readOnly:!0,type:ug})],as.prototype,"tileInfo",null),h([f()],as.prototype,"tilemapCache",void 0),h([Ce("service","tilemapCache",["capabilities","tileInfo"])],as.prototype,"readTilemapCache",null),h([f({json:{read:!1},readOnly:!0,value:"vector-tile"})],as.prototype,"type",void 0),h([f({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],as.prototype,"url",void 0),h([f({readOnly:!0})],as.prototype,"version",void 0),h([Ce("version",["version","currentVersion"])],as.prototype,"readVersion",null),h([f({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],as.prototype,"path",void 0),as=h([I("esri.layers.VectorTileLayer")],as);const x5e=as,hsi=Object.freeze(Object.defineProperty({__proto__:null,default:x5e},Symbol.toStringTag,{value:"Module"}));var oQ;let d$=oQ=class extends ye{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new oQ({minValue:this.minValue,maxValue:this.maxValue})}};h([f({type:Number,json:{write:!0}})],d$.prototype,"minValue",void 0),h([f({type:Number,json:{write:!0}})],d$.prototype,"maxValue",void 0),d$=oQ=h([I("esri.renderers.support.AuthoringInfoClassBreakInfo")],d$);var aQ;let $v=aQ=class extends ye{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=new Array}clone(){return new aQ({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:Q(this.classBreakInfos)})}};h([f({type:String,json:{write:!0}})],$v.prototype,"field",void 0),h([f({type:String,json:{write:!0}})],$v.prototype,"normalizationField",void 0),h([f({type:String,json:{write:!0}})],$v.prototype,"label",void 0),h([f({type:[d$],json:{write:!0}})],$v.prototype,"classBreakInfos",void 0),$v=aQ=h([I("esri.renderers.support.AuthoringInfoFieldInfo")],$v);var lQ;let DE=lQ=class extends ye{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new lQ({label:this.label,value:this.value,size:this.size})}};h([f({type:String,json:{write:!0}})],DE.prototype,"label",void 0),h([f({type:Number,json:{write:!0}})],DE.prototype,"size",void 0),h([f({type:Number,json:{write:!0}})],DE.prototype,"value",void 0),DE=lQ=h([I("esri.renderers.support.AuthoringInfoSizeStop")],DE);const MNt=DE;var cQ;const o4=new qi({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),a4=new qi({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),b_e={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},w_e=["high-to-low","above-and-below","centered-on","extremes"],x_e=[...new Set(["high-to-low","above-and-below","centered-on","extremes","above","below","high-to-low","above-and-below","above","below","reference-size"])],S_e=["seconds","minutes","hours","days","months","years"],ANt=["circle","diamond","hexagon-flat","hexagon-pointy","square"];let ha=cQ=class extends ye{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}get normalizationField(){return this.theme==="reference-size"?this._get("normalizationField"):null}set normalizationField(t){this._set("normalizationField",t)}get referenceSizeScale(){return this.theme==="reference-size"?this._get("referenceSizeScale"):null}set referenceSizeScale(t){this._set("referenceSizeScale",t)}get referenceSizeSymbolStyle(){return this.theme==="reference-size"?this._get("referenceSizeSymbolStyle"):null}set referenceSizeSymbolStyle(t){this._set("referenceSizeSymbolStyle",t)}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get sizeStops(){return this.theme==="reference-size"?this._get("sizeStops"):null}set sizeStops(t){this._set("sizeStops",t)}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new cQ({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,normalizationField:this.normalizationField,referenceSizeScale:this.referenceSizeScale,referenceSizeSymbolStyle:this.referenceSizeSymbolStyle,sizeStops:Q(this.sizeStops),startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};h([f({types:b_e,json:{write:!0}})],ha.prototype,"endTime",void 0),h([Li("endTime")],ha.prototype,"castEndTime",null),h([f({type:String,json:{write:!0}})],ha.prototype,"field",void 0),h([f({type:Number,json:{write:!0}})],ha.prototype,"maxSliderValue",void 0),h([f({type:Number,json:{write:!0}})],ha.prototype,"minSliderValue",void 0),h([f({type:String,json:{origins:{"web-scene":{write:!1}},write:!0}})],ha.prototype,"normalizationField",null),h([f({type:Number,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],ha.prototype,"referenceSizeScale",null),h([f({type:ANt,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],ha.prototype,"referenceSizeSymbolStyle",null),h([f({types:b_e,json:{write:!0}})],ha.prototype,"startTime",void 0),h([Li("startTime")],ha.prototype,"castStartTime",null),h([f({type:[MNt],json:{origins:{"web-scene":{write:!1}},write:!0}})],ha.prototype,"sizeStops",null),h([f({type:o4.apiValues,value:null,json:{type:o4.jsonValues,read:o4.read,write:o4.write}})],ha.prototype,"style",null),h([f({type:x_e,value:null,json:{type:x_e,origins:{"web-scene":{type:w_e,write:{writer:(t,e)=>{w_e.includes(t)&&(e.theme=t)}}}},write:!0}})],ha.prototype,"theme",null),h([f({type:a4.apiValues,json:{type:a4.jsonValues,read:a4.read,write:a4.write}})],ha.prototype,"type",void 0),h([f({type:S_e,json:{type:S_e,write:!0}})],ha.prototype,"units",void 0),ha=cQ=h([I("esri.renderers.support.AuthoringInfoVisualVariable")],ha);const PNt=ha;let Mk=class extends ye{constructor(e){super(e),this.type=null}};h([f({readOnly:!0,json:{read:!1,write:!0}})],Mk.prototype,"type",void 0),Mk=h([I("esri.rest.support.ColorRamp")],Mk);const Ine=Mk;var uQ;let hx=uQ=class extends Ine{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new uQ({fromColor:Q(this.fromColor),toColor:Q(this.toColor),algorithm:this.algorithm})}};h([ct({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],hx.prototype,"algorithm",void 0),h([f({type:Oe,json:{type:[Qr],write:!0}})],hx.prototype,"fromColor",void 0),h([f({type:Oe,json:{type:[Qr],write:!0}})],hx.prototype,"toColor",void 0),h([f({type:["algorithmic"]})],hx.prototype,"type",void 0),hx=uQ=h([I("esri.rest.support.AlgorithmicColorRamp")],hx);const Lne=hx;var hQ;let p$=hQ=class extends Ine{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new hQ({colorRamps:Q(this.colorRamps)})}};h([f({type:[Lne],json:{write:!0}})],p$.prototype,"colorRamps",void 0),h([f({type:["multipart"]})],p$.prototype,"type",void 0),p$=hQ=h([I("esri.rest.support.MultipartColorRamp")],p$);const S5e=p$,ONt={key:"type",base:Ine,typeMap:{algorithmic:Lne,multipart:S5e}};function RNt(t){return t!=null&&t.type?t.type==="algorithmic"?Lne.fromJSON(t):t.type==="multipart"?S5e.fromJSON(t):null:null}var dQ;const fw=new qi({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),l4=new qi({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),T_e=new qi({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),E_e=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],$Nt=["high-to-low","above-and-below","above","below"],INt=["flow-line","wave-front"],LNt=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let Tn=dQ=class extends ye{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?RNt(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){var t;return new dQ({classificationMethod:this.classificationMethod,colorRamp:Q(this.colorRamp),fadeRatio:Q(this.fadeRatio),fields:(t=this.fields)==null?void 0:t.slice(0),field1:Q(this.field1),field2:Q(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};h([f({type:fw.apiValues,value:null,json:{type:fw.jsonValues,read:fw.read,write:fw.write,origins:{"web-document":{default:"manual",type:fw.jsonValues,read:fw.read,write:fw.write}}}})],Tn.prototype,"classificationMethod",null),h([f({types:ONt,json:{write:!0}})],Tn.prototype,"colorRamp",void 0),h([Ce("colorRamp")],Tn.prototype,"readColorRamp",null),h([f({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Tn.prototype,"fadeRatio",void 0),h([f({type:[String],value:null,json:{write:!0}})],Tn.prototype,"fields",null),h([f({type:$v,value:null,json:{write:!0}})],Tn.prototype,"field1",null),h([f({type:$v,value:null,json:{write:!0}})],Tn.prototype,"field2",null),h([f({type:INt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Tn.prototype,"flowTheme",null),h([f({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],Tn.prototype,"focus",null),h([f({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],Tn.prototype,"isAutoGenerated",void 0),h([f({type:Number,value:null,json:{type:Qr,write:!0}})],Tn.prototype,"numClasses",null),h([f({type:E_e,json:{type:E_e,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],Tn.prototype,"lengthUnit",void 0),h([f({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Tn.prototype,"maxSliderValue",void 0),h([f({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Tn.prototype,"minSliderValue",void 0),h([f({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Tn.prototype,"statistics",null),h([f({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],Tn.prototype,"standardDeviationInterval",null),h([f({type:l4.apiValues,value:null,json:{type:l4.jsonValues,read:l4.read,write:l4.write,origins:{"web-scene":{type:T_e.jsonValues,write:{writer:T_e.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],Tn.prototype,"type",null),h([f({type:[PNt],json:{write:!0}})],Tn.prototype,"visualVariables",void 0),h([f({type:LNt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Tn.prototype,"univariateSymbolStyle",null),h([f({type:$Nt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Tn.prototype,"univariateTheme",null),Tn=dQ=h([I("esri.renderers.support.AuthoringInfo")],Tn);const Dne=Tn,Jq=new qi({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let f$=class extends ye{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const i=new Set;return await this.collectRequiredFields(i,e),Array.from(i).sort()}getSymbol(e,i){}async getSymbolAsync(e,i){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};h([f({type:Dne,json:{write:!0}})],f$.prototype,"authoringInfo",void 0),h([f({type:Jq.apiValues,readOnly:!0,json:{type:Jq.jsonValues,read:!1,write:{writer:Jq.write,ignoreOrigin:!0}}})],f$.prototype,"type",void 0),f$=h([I("esri.renderers.Renderer")],f$);const Q0=f$;function DNt(t){var e,i;return((i=(e=t.match(NNt))==null?void 0:e[1])==null?void 0:i.replace(/\\'/g,"'"))??null}const NNt=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var pQ;let yM=pQ=class extends ye{constructor(){super(...arguments),this.title=null}clone(){return new pQ({title:this.title})}};h([f({type:String,json:{write:!0}})],yM.prototype,"title",void 0),yM=pQ=h([I("esri.renderers.support.LegendOptions")],yM);var fQ;let Ak=fQ=class extends yM{constructor(){super(...arguments),this.showLegend=null}clone(){return new fQ({title:this.title,showLegend:this.showLegend})}};h([f({type:Boolean,json:{write:!0}})],Ak.prototype,"showLegend",void 0),Ak=fQ=h([I("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],Ak);const T5e=Ak,Qq=new qi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let Ip=class extends ye{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(ie.getLogger(this).error(".field: field must be a string value"),null):B3(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};h([f()],Ip.prototype,"index",void 0),h([f({type:Qq.apiValues,readOnly:!0,json:{read:Qq.read,write:Qq.write}})],Ip.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],Ip.prototype,"field",void 0),h([Li("field")],Ip.prototype,"castField",null),h([f({type:String,json:{write:!0}})],Ip.prototype,"valueExpression",void 0),h([f({type:String,json:{write:!0}})],Ip.prototype,"valueExpressionTitle",void 0),h([f({readOnly:!0})],Ip.prototype,"arcadeRequired",null),h([f({type:T5e,json:{write:!0}})],Ip.prototype,"legendOptions",void 0),Ip=h([I("esri.renderers.visualVariables.VisualVariable")],Ip);const JL=Ip;var mQ;let dx=mQ=class extends ye{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,i){e[i]=t??0}clone(){return new mQ({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};h([f({type:Oe,json:{type:[Qr],write:!0}})],dx.prototype,"color",void 0),h([f({type:String,json:{write:!0}})],dx.prototype,"label",void 0),h([f({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],dx.prototype,"value",void 0),h([Ve("value")],dx.prototype,"writeValue",null),dx=mQ=h([I("esri.renderers.visualVariables.support.ColorStop")],dx);const FNt=dx;var gQ;let px=gQ=class extends JL{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){var t;return new gQ({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};h([f({readOnly:!0})],px.prototype,"cache",null),h([f({type:["color"],json:{type:["colorInfo"]}})],px.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],px.prototype,"normalizationField",void 0),h([f({type:[FNt],json:{write:!0}})],px.prototype,"stops",null),px=gQ=h([I("esri.renderers.visualVariables.ColorVariable")],px);const E5e=px;var yQ;let fv=yQ=class extends ye{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return XI(e.transparency)}writeOpacity(t,e,i){e[i]=tG(t)}clone(){return new yQ({label:this.label,opacity:this.opacity,value:this.value})}};h([f({type:String,json:{write:!0}})],fv.prototype,"label",void 0),h([f({type:Number,json:{type:Qr,write:{target:"transparency"}}})],fv.prototype,"opacity",void 0),h([Ce("opacity",["transparency"])],fv.prototype,"readOpacity",null),h([Ve("opacity")],fv.prototype,"writeOpacity",null),h([f({type:Number,json:{write:!0}})],fv.prototype,"value",void 0),fv=yQ=h([I("esri.renderers.visualVariables.support.OpacityStop")],fv);const kNt=fv;var _Q;let fx=_Q=class extends JL{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){var t;return new _Q({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};h([f({readOnly:!0})],fx.prototype,"cache",null),h([f({type:["opacity"],json:{type:["transparencyInfo"]}})],fx.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],fx.prototype,"normalizationField",void 0),h([f({type:[kNt],json:{write:!0}})],fx.prototype,"stops",null),fx=_Q=h([I("esri.renderers.visualVariables.OpacityVariable")],fx);const C5e=fx;var vQ;let Ly=vQ=class extends JL{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,i,r){if(r!=null&&r.messages){const s=`visualVariables[${this.index}]`;r.messages.push(new V("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:r}))}}clone(){var t;return new vQ({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}};h([f({readOnly:!0})],Ly.prototype,"cache",null),h([f({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],Ly.prototype,"axis",void 0),h([f({type:["rotation"],json:{type:["rotationInfo"]}})],Ly.prototype,"type",void 0),h([f({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],Ly.prototype,"rotationType",void 0),h([f({type:String,json:{write:!0}})],Ly.prototype,"valueExpressionTitle",void 0),h([Ve("web-scene","valueExpressionTitle")],Ly.prototype,"writeValueExpressionTitleWebScene",null),Ly=vQ=h([I("esri.renderers.visualVariables.RotationVariable")],Ly);const M5e=Ly;function UNt(t){return pr(t)}var bQ;let mv=bQ=class extends ye{constructor(t){super(t),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new bQ({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}};h([f({type:String,json:{write:!0}})],mv.prototype,"label",void 0),h([f({type:Number,cast:pr,json:{write:!0}})],mv.prototype,"size",void 0),h([f({type:Number,json:{write:!0}})],mv.prototype,"value",void 0),h([f({type:Boolean,json:{write:!1}})],mv.prototype,"useMinValue",void 0),h([f({type:Boolean,json:{write:!1}})],mv.prototype,"useMaxValue",void 0),mv=bQ=h([I("esri.renderers.visualVariables.support.SizeStop")],mv);const Pk=mv;var wQ;let Ok=wQ=class extends T5e{constructor(){super(...arguments),this.customValues=null}clone(){var t;return new wQ({title:this.title,showLegend:this.showLegend,customValues:(t=this.customValues)==null?void 0:t.slice(0)})}};h([f({type:[Number],json:{write:!0}})],Ok.prototype,"customValues",void 0),Ok=wQ=h([I("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],Ok);const zNt=Ok;var xQ;const c4=new qi({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),SQ=new qi({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function C_e(t){if(t!=null)return typeof t=="string"||typeof t=="number"?UNt(t):t.type==="size"?pC(t)?t:(delete(t={...t}).type,new kr(t)):void 0}function M_e(t,e,i){if(typeof t!="object")return t;const r=new kr;return r.read(t,i),r}let kr=xQ=class extends JL{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&D$e.test(this.valueExpression)}}set index(t){pC(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),pC(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return I$e(this)}set maxDataValue(t){t&&this.stops&&(ie.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(ie.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return C_e(t)}readMaxSize(t,e,i){return M_e(t,e,i)}set minDataValue(t){t&&this.stops&&(ie.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(ie.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return C_e(t)}readMinSize(t,e,i){return M_e(t,e,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value):t&&(ie.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return vft(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,i,r){if(t==="$view.scale"){if(r!=null&&r.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;r.messages.push(new V("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:r}))}}else e[i]=t}readValueUnit(t){return t?SQ.read(t):null}clone(){var t,e;return new xQ({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:pC(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:pC(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:(t=this.stops)==null?void 0:t.map(i=>i.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:(e=this.legendOptions)==null?void 0:e.clone()})}flipSizes(){if(this.transformationType===Yo.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===Yo.Stops){const t=this.stops;if(!t)return this;const e=t.map(r=>r.size).reverse(),i=t.length;for(let r=0;r<i;r++)t[r].size=e[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){var t;return(t=this.stops)==null?void 0:t.map(e=>e.value||0)}};h([f({readOnly:!0})],kr.prototype,"cache",null),h([f({type:c4.apiValues,json:{type:c4.jsonValues,origins:{"web-map":{read:!1}},read:c4.read,write:c4.write}})],kr.prototype,"axis",void 0),h([f()],kr.prototype,"index",null),h([f({type:String,readOnly:!0})],kr.prototype,"inputValueType",null),h([f({type:zNt,json:{write:!0}})],kr.prototype,"legendOptions",void 0),h([f({type:Number,value:null,json:{write:!0}})],kr.prototype,"maxDataValue",null),h([f({type:Number,value:null,json:{write:!0}})],kr.prototype,"maxSize",null),h([Li("maxSize")],kr.prototype,"castMaxSize",null),h([Ce("maxSize")],kr.prototype,"readMaxSize",null),h([f({type:Number,value:null,json:{write:!0}})],kr.prototype,"minDataValue",null),h([f({type:Number,value:null,json:{write:!0}})],kr.prototype,"minSize",null),h([Li("minSize")],kr.prototype,"castMinSize",null),h([Ce("minSize")],kr.prototype,"readMinSize",null),h([f({type:String,json:{write:!0}})],kr.prototype,"normalizationField",void 0),h([f({readOnly:!0})],kr.prototype,"arcadeRequired",null),h([f({type:String})],kr.prototype,"scaleBy",void 0),h([f({type:[Pk],value:null,json:{write:!0}})],kr.prototype,"stops",null),h([f({type:["outline"],json:{write:!0}})],kr.prototype,"target",void 0),h([f({type:String,readOnly:!0})],kr.prototype,"transformationType",null),h([f({type:["size"],json:{type:["sizeInfo"]}})],kr.prototype,"type",void 0),h([f({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],kr.prototype,"useSymbolValue",void 0),h([f({type:String,json:{write:!0}})],kr.prototype,"valueExpression",void 0),h([Ce("valueExpression",["valueExpression","expression"])],kr.prototype,"readValueExpression",null),h([Ve("web-scene","valueExpression")],kr.prototype,"writeValueExpressionWebScene",null),h([f({type:["radius","diameter","area","width","distance"],json:{write:!0}})],kr.prototype,"valueRepresentation",void 0),h([f({type:SQ.apiValues,json:{write:SQ.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],kr.prototype,"valueUnit",void 0),h([Ce("valueUnit")],kr.prototype,"readValueUnit",null),kr=xQ=h([I("esri.renderers.visualVariables.SizeVariable")],kr);const Nne=kr,VNt={color:E5e,size:Nne,opacity:C5e,rotation:M5e},BNt=new qi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),GNt=/^\[([^\]]+)\]$/i;let Rk=class extends Re{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e&&e.filter(i=>!!i),e==null?void 0:e.length){for(const i of e)switch(i.type){case"color":this.colorVariables.push(i);break;case"opacity":this.opacityVariables.push(i);break;case"rotation":this.rotationVariables.push(i);break;case"size":this.sizeVariables.push(i)}this.sizeVariables.length&&this.sizeVariables.some(i=>!!i.target)&&e.sort((i,r)=>{let s=null;return s=i.target===r.target?0:i.target?1:-1,s});for(let i=0;i<e.length;i++)e[i].index=i;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,i,r){const{rotationExpression:s,rotationType:n}=i,o=s==null?void 0:s.match(GNt),a=o==null?void 0:o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map(l=>{const c=BNt.read(l.type),u=VNt[c];u||(ie.getLogger(this).warn(`Unknown variable type: ${c}`),r!=null&&r.messages&&r.messages.push(new Sf("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:r})));const d=new u;return d.read(l,r),d})}writeVariables(e,i){const r=[];for(const s of e){const n=s.toJSON(i);n&&r.push(n)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};h([f()],Rk.prototype,"visualVariables",null),Rk=h([I("esri.renderers.visualVariables.VisualVariableFactory")],Rk);const jNt=Rk,HNt={base:JL,key:"type",typeMap:{opacity:C5e,color:E5e,rotation:M5e,size:Nne}},oP=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new jNt}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,s){return this._vvFactory.readVariables(i,r,s)}writeVisualVariables(i,r,s,n){r[s]=this._vvFactory.writeVariables(i,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const s=this.visualVariables;return s?s.filter(n=>n.type===i&&(typeof r=="string"?n.target===r:r!==!1||!n.target)):[]}async collectVVRequiredFields(i,r){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&Sc(i,r,n.field),n.normalizationField&&Sc(i,r,n.normalizationField),n.valueExpression&&(qNt(n.valueExpression,i,r)||await Vl(i,r,n.valueExpression)))}};return h([f({types:[HNt],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),h([Ce("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),h([Ve("visualVariables")],e.prototype,"writeVisualVariables",null),e=h([I("esri.renderers.mixins.VisualVariablesMixin")],e),e};function qNt(t,e,i){const r=DNt(t);return r!=null&&(Sc(e,i,r),!0)}const Ij={types:ACe,json:{write:{writer:_V},origins:{"web-scene":{types:zce,write:{writer:_V},read:{reader:OA({types:zce})}}}}},Fne=zK({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},Ij),A5e={types:{base:ll,key:"type",typeMap:{"simple-fill":bS.typeMap["simple-fill"],"picture-fill":bS.typeMap["picture-fill"],"polygon-3d":bS.typeMap["polygon-3d"]}},json:{write:{writer:_V},origins:{"web-scene":{type:hb,write:{writer:_V}}}}},$k={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t==null?void 0:t.toString()}}}};var TQ;let gv=TQ=class extends ye{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){var t;return new TQ({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:((t=this.symbol)==null?void 0:t.clone())??null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};h([f({type:String,json:{write:!0}})],gv.prototype,"description",void 0),h([f({type:String,json:{write:!0}})],gv.prototype,"label",void 0),h([f({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],gv.prototype,"minValue",void 0),h([f({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],gv.prototype,"maxValue",void 0),h([f(Fne)],gv.prototype,"symbol",void 0),gv=TQ=h([I("esri.renderers.support.ClassBreakInfo")],gv);const kV=gv;var EQ;const P5e="log",Ik="percent-of-total",Lk="field",u4=new qi({esriNormalizeByLog:P5e,esriNormalizeByPercentOfTotal:Ik,esriNormalizeByField:Lk}),WNt=Ln(kV);let So=EQ=class extends oP(Q0){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,i){if(!Array.isArray(t))return;let r=e.minValue;return t.map(s=>{const n=new kV;return n.read(s,i),n.minValue==null&&(n.minValue=r),n.maxValue==null&&(n.maxValue=n.minValue),r=n.maxValue,n})}writeClassBreakInfos(t,e,i,r){const s=t.map(n=>n.write({},r));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),e[i]=s}castField(t){return t==null?t:typeof t=="function"?(ie.getLogger(this).error(".field: field must be a string value"),null):B3(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,i=this.normalizationTotal!=null;return e||i?(t=e&&Lk||i&&Ik||null,e&&i&&ie.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==Lk&&t!==Ik||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,i){let r=null;r=typeof t=="number"?new kV({minValue:t,maxValue:e,symbol:PCe(i)}):WNt(Q(t)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const s=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(s[0]===t&&s[1]===e){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(t,e){return this.valueExpression&&(e==null?void 0:e.arcade)==null&&ie.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let i=e;this.valueExpression&&(e==null?void 0:e.arcade)==null&&(i={...i,arcade:await z1()});const r=this.getBreakIndex(t,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(t,e){if(this.valueExpression&&(e==null?void 0:e.arcade)==null)return void ie.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(t,e);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&(e==null?void 0:e.arcade)==null){const s=await z1(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this.getBreakIndex(t,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((r,s)=>r+s.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){var t,e;return new EQ({field:this.field,backgroundFillSymbol:(t=this.backgroundFillSymbol)==null?void 0:t.clone(),defaultLabel:this.defaultLabel,defaultSymbol:(e=this.defaultSymbol)==null?void 0:e.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:Q(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:Q(this.visualVariables),legendOptions:Q(this.legendOptions),authoringInfo:Q(this.authoringInfo)})}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),Vl(t,e,this.valueExpression)];Sc(t,e,this.field),Sc(t,e,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:s,arcade:n,timeZone:o}=e??{},{valueExpression:a}=this;let l=this._compiledValueExpression.valueExpression===a?this._compiledValueExpression.compiledFunction:null;const c=n.arcadeUtils;if(!l){const d=c.createSyntaxTree(a);l=c.createFunction(d),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=a;const u=c.executeFunction(l,c.createExecContext(t,c.getViewInfo({viewingMode:i,scale:r,spatialReference:s}),o));return this._getBreakIndexfromInfos(u)}_getBreakIndexForField(t){const e=this.field,i=t.attributes,r=this.normalizationType;let s=parseFloat(i[e]);if(r){const n=this.normalizationTotal,o=parseFloat(this.normalizationField?i[this.normalizationField]:void 0);if(r===P5e)s=Math.log(s)*Math.LOG10E;else if(r!==Ik||n==null||isNaN(n)){if(r===Lk&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=t&&(e?t<=r[1]:t<r[1]))return i}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let i=1;i<e;i++)if(t[i-1].maxValue!==t[i].minValue)return!1;return!0}};h([f(A5e)],So.prototype,"backgroundFillSymbol",void 0),h([f({type:[kV]})],So.prototype,"classBreakInfos",void 0),h([Ce("classBreakInfos")],So.prototype,"readClassBreakInfos",null),h([Ve("classBreakInfos")],So.prototype,"writeClassBreakInfos",null),h([f({type:String,json:{write:!0}})],So.prototype,"defaultLabel",void 0),h([f(Ij)],So.prototype,"defaultSymbol",void 0),h([f({type:String,json:{write:!0}})],So.prototype,"field",void 0),h([Li("field")],So.prototype,"castField",null),h([f({type:Boolean})],So.prototype,"isMaxInclusive",void 0),h([f({type:yM,json:{write:!0}})],So.prototype,"legendOptions",void 0),h([f({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],So.prototype,"minValue",null),h([f({type:String,json:{write:!0}})],So.prototype,"normalizationField",void 0),h([f({type:Number,cast:t=>bd(t),json:{write:!0}})],So.prototype,"normalizationTotal",void 0),h([f({type:u4.apiValues,value:null,json:{type:u4.jsonValues,read:u4.read,write:u4.write}})],So.prototype,"normalizationType",null),h([ct({classBreaks:"class-breaks"})],So.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],So.prototype,"valueExpression",void 0),h([f({type:String,json:{write:!0}})],So.prototype,"valueExpressionTitle",void 0),So=EQ=h([I("esri.renderers.ClassBreaksRenderer")],So);const O5e=So;let Lj=class{};function YNt(t){return t instanceof IA?t===Lj.instance:(t==null?void 0:t.toString().toLowerCase())==="unknown"}function ysi(t){return YNt(t)?Lj.instance:t}Lj.instance=new Ch("Etc/UTC");function ZNt(t){return"timeZone"in t}function XNt(t){return"timeZone"in t}function JNt(t){return"dateFieldsTimeZone"in t}const QNt=new Map;let kne=class Dk{static fromJSON(e){return new Dk(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new Dk(e.fields??[],P_e(e))}static fromLayerJSON(e){return new Dk(e.fields??[],P_e(e))}constructor(e=[],i){var s;this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=i?new Map(i):null;const r=[];for(const n of this.fields){const o=n==null?void 0:n.name,a=A_e(o);if(o&&a){const l=zx(o);this._fieldsMap.set(o,n),this._fieldsMap.set(l,n),this._normalizedFieldsMap.set(a,n),r.push(`${l}:${n.type}:${(s=this._timeZoneByFieldName)==null?void 0:s.get(o)}`),kEe(n)?(this.dateFields.push(n),this._dateFieldsSet.add(n)):Dte(n)&&(this._numericFieldsSet.add(n),this.numericFields.push(n)),Ice(n)||Lce(n)||(n.editable=n.editable==null||!!n.editable,n.nullable=n.nullable==null||!!n.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)Ice(e)||Lce(e)||e.nullable||bQe(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===(e==null?void 0:e.uid)}has(e){return this.get(e)!=null}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(zx(e))??this._normalizedFieldsMap.get(A_e(e)),i&&this._fieldsMap.set(e,i),i)}getTimeZone(e){const i=this.get(e&&typeof e!="string"?e.name:e);return i?this._timeZoneByFieldName?this._timeZoneByFieldName.get(i.name):i.type==="date"||i.type==="esriFieldTypeDate"?(ie.getLogger("esri.layers.support.FieldsIndex").error(new V("getTimeZone:no-timezone-information",`no time zone information for field '${i.name}'`)),P1):R5e.has(i.type)?GS:null:null}getLuxonTimeZone(e){const i=this.getTimeZone(e);return i?i===GS?Lj.instance:i===P1?Qa.utcInstance:V3(QNt,i,()=>Ch.create(i)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return IQe(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){var i;return((i=this.get(e))==null?void 0:i.name)??void 0}toJSON(){return{fields:this.fields.map(e=>bU(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}};function zx(t){return t.trim().toLowerCase()}function A_e(t){var e;return((e=iQe(t))==null?void 0:e.toLowerCase())??""}const R5e=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function P_e(t){const e=new Map;if(!t.fields)return e;const i=t.datesInUnknownTimezone===!0,{timeInfo:r,editFieldsInfo:s}=t,n=(r?"startField"in r?r.startField:r.startTimeField:"")??"",o=(r?"endField"in r?r.endField:r.endTimeField:"")??"",a=JNt(t)?t.dateFieldsTimeZone??null:t.dateFieldsTimeReference?F4(t.dateFieldsTimeReference):null,l=s?ZNt(s)?s.timeZone??a:s.dateFieldsTimeReference?F4(s.dateFieldsTimeReference):a??P1:null,c=r?XNt(r)?r.timeZone??a:r.timeReference?F4(r.timeReference):a:null,u=new Map([[zx((s==null?void 0:s.creationDateField)??""),l],[zx((s==null?void 0:s.editDateField)??""),l],[zx(n),c],[zx(o),c]]);for(const{name:d,type:p}of t.fields)if(R5e.has(p))e.set(d,GS);else if(p!=="date"&&p!=="esriFieldTypeDate")e.set(d,null);else if(i)e.set(d,GS);else{const m=u.get(zx(d??""))??a;e.set(d,m)}return e}const O_e="esri.renderers.support.DictionaryLoader",KNt={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let $5e=class{constructor(e,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new pse(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,i){var d;let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(p){if(ms(p))return this._dictionaryPromise=null,null}const s=(d=this._dictionaryVersion)==null?void 0:d.since(4,0),n={};if(this.fieldMap)for(const p of this._symbolFields){const m=i3e(this.fieldMap[p],this._fieldIndex);if(m){const g=e.attributes[m];n[p]=s?g:g!=null?""+e.attributes[m]:""}else n[p]=""}let o=null;try{o=r==null?void 0:r(n,i)}catch{return null}if(!o||typeof o!="string"||o==="invalid")return null;const a=o.split(";"),l=[],c=[];for(const p of a)if(p)if(p.includes("po:")){const m=p.substr(3).split("|");if(m.length===3){const g=m[0],y=m[1];let v=m[2];if(y==="DashTemplate")v=v.split(" ").map(b=>Number(b));else if(y==="Color"){const b=new Oe(v).toRgba();v=[b[0],b[1],b[2],255*b[3]]}else v=Number(v);c.push({primitiveName:g,propertyName:y,value:v,defaultValue:null})}}else if(p.includes("|")){for(const m of p.split("|"))if(this._itemNames.has(m)){l.push(m);break}}else this._itemNames.has(p)&&l.push(p);const u=e.geometry==null||!e.geometry.hasZ&&e.geometry.type==="point";return this._cimPartsToCIMSymbol(e,l,c,u,i)}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void ie.getLogger(O_e).error("no valid URL!");const i=Yt(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:e!=null?e.signal:null}),[{data:r}]=await Promise.all([i,z1()]);if(!r)throw this._dictionaryPromise=null,new V("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:s,dictionary_version:n,expression:o,itemsNames:a}=r,l=o;let c=!1;n&&(this._dictionaryVersion=GL.parse(n),c=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=s.symbol;const u={};if(this.config){const m=this.config;for(const g in m)u[g]=m[g]}if(s.configuration)for(const m of s.configuration)u.hasOwnProperty(m.name)||(u[m.name]=m.value);const d=[];if(e!=null&&e.fields&&this.fieldMap)for(const m in this.fieldMap){const g=this.fieldMap[m],y=e.fields.filter(v=>v.name.toLowerCase()===(g==null?void 0:g.toLowerCase()));y.length>0&&d.push({...y[0],type:c?y[0].type:"esriFieldTypeString"})}d.length>0&&(this._fieldIndex=new kne(d));const p=KJe(l,e!=null?e.spatialReference:null,d,u).then(m=>{const g={scale:0};return(y,v)=>{if(m==null)return null;const b=m.repurposeFeature({geometry:null,attributes:y});return g.scale=v!=null?v.scale??void 0:void 0,m.evaluate({$feature:b,$view:g},m.services)}}).catch(m=>(ie.getLogger(O_e).error("Creating dictionary expression failed:",m),null));return this._dictionaryPromise=p,p}async _cimPartsToCIMSymbol(e,i,r,s,n){const o=new Array(i.length);for(let c=0;c<i.length;c++)o[c]=this._getSymbolPart(i[c],n);let a=await Promise.all(o);const l=this.fieldMap;if(l){a=Q(a);for(const c of a)_C.applyDictionaryTextOverrides(c,e,l,this._fieldIndex,GX(c))}return new cb({data:eFt(a,r,s)})}async _getSymbolPart(e,i){const r=this._symbolCache.get(e);if(r)return r;if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(o=>o.data);const s=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),n=Yt(s,{responseType:"json",query:{f:"json"},...i});this._ongoingRequests.set(e,n),n.finally(()=>this._ongoingRequests.delete(e));try{const o=await n;return this._symbolCache.put(e,o.data),o.data}catch(o){throw o}}};function eFt(t,e,i){if(!t||t.length===0)return null;const r={...t[0]};if(t.length>1){r.symbolLayers=[];for(const s of t){const n=s;r.symbolLayers.unshift(...n.symbolLayers)}}return i&&(r.callout=KNt),{type:"CIMSymbolReference",symbol:r,primitiveOverrides:e}}var CQ;let Lp=CQ=class extends oP(Q0){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new $5e(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,i,r){r!=null&&r.origin||super.writeVisualVariables(t,e,i,r)}clone(){return new CQ({config:Q(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:Q(this.fieldMap),url:Q(this.url),visualVariables:Q(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await Vl(t,e,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];e.has(r)&&t.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};h([f({type:$5e})],Lp.prototype,"_loader",null),h([f({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],Lp.prototype,"config",void 0),h([f({type:Object,json:{write:!0}})],Lp.prototype,"fieldMap",void 0),h([f({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],Lp.prototype,"scaleExpression",void 0),h([Ve("scaleExpression")],Lp.prototype,"writeData",null),h([f({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],Lp.prototype,"scaleExpressionTitle",void 0),h([f({type:String,json:{write:!0}})],Lp.prototype,"url",void 0),h([Ve("visualVariables")],Lp.prototype,"writeVisualVariables",null),Lp=CQ=h([I("esri.renderers.DictionaryRenderer")],Lp);const tFt=Lp;var MQ;let Dy=MQ=class extends ye{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(ie.getLogger(this).error(".field: field must be a string value"),null):B3(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){var t;return new MQ({color:(t=this.color)==null?void 0:t.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};h([f({type:Oe,json:{type:[Number],write:!0}})],Dy.prototype,"color",void 0),h([f({type:String,json:{write:!0}})],Dy.prototype,"field",void 0),h([Li("field")],Dy.prototype,"castField",null),h([f({type:String,json:{write:!0}})],Dy.prototype,"label",void 0),h([f({type:String,json:{write:!0}})],Dy.prototype,"valueExpression",void 0),h([f({type:String,json:{write:!0}})],Dy.prototype,"valueExpressionTitle",void 0),Dy=MQ=h([I("esri.renderers.support.AttributeColorInfo")],Dy);const I5e=Dy;var AQ;let Nk=AQ=class extends ye{constructor(){super(...arguments),this.unit=null}clone(){return new AQ({unit:this.unit})}};h([f({type:String,json:{write:!0}})],Nk.prototype,"unit",void 0),Nk=AQ=h([I("esri.renderers.support.DotDensityLegendOptions")],Nk);const iFt=Nk;var PQ;let Vc=PQ=class extends oP(Q0){constructor(t){super(t),this.attributes=null,this.backgroundColor=new Oe([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Mu,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new db({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var t;return((t=this.attributes)==null?void 0:t.reduce((e,i)=>e+i.getAttributeHash(),""))??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new PQ({attributes:Q(this.attributes),backgroundColor:Q(this.backgroundColor),dotBlendingEnabled:Q(this.dotBlendingEnabled),dotShape:Q(this.dotShape),dotSize:Q(this.dotSize),dotValue:Q(this.dotValue),legendOptions:Q(this.legendOptions),outline:Q(this.outline),referenceScale:Q(this.referenceScale),seed:Q(this.seed),visualVariables:Q(this.visualVariables),authoringInfo:Q(this.authoringInfo)})}getControllerHash(){var e;return`${(e=this.attributes)==null?void 0:e.map(i=>i.field||i.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const i of this.attributes??[])i.valueExpression&&await Vl(t,e,i.valueExpression),i.field&&t.add(i.field)}};h([f({type:[I5e],json:{write:!0}})],Vc.prototype,"attributes",void 0),h([f({type:Oe,json:{write:!0}})],Vc.prototype,"backgroundColor",void 0),h([f({type:Boolean,json:{write:!0}})],Vc.prototype,"dotBlendingEnabled",void 0),h([f({type:String,json:{write:!1}})],Vc.prototype,"dotShape",void 0),h([f({type:Number,json:{write:!0}})],Vc.prototype,"dotSize",void 0),h([f({type:iFt,json:{write:!0}})],Vc.prototype,"legendOptions",void 0),h([f({type:Mu,json:{default:null,write:!0}})],Vc.prototype,"outline",void 0),h([f({type:Number,json:{write:!0}})],Vc.prototype,"dotValue",void 0),h([f({type:Number,json:{write:!0}})],Vc.prototype,"referenceScale",void 0),h([f({type:Number,json:{write:!0}})],Vc.prototype,"seed",void 0),h([ct({dotDensity:"dot-density"})],Vc.prototype,"type",void 0),Vc=PQ=h([I("esri.renderers.DotDensityRenderer")],Vc);const rFt=Vc;var OQ;let m$=OQ=class extends ye{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new OQ({color:this.color&&this.color.clone(),ratio:this.ratio})}};h([f({type:Oe,json:{type:[Qr],default:null,write:!0}})],m$.prototype,"color",void 0),h([f({type:Number,json:{write:!0}})],m$.prototype,"ratio",void 0),m$=OQ=h([I("esri.renderers.support.HeatmapColorStop")],m$);const Fk=m$;let NE=class extends Kr(ye){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};h([f({type:String,json:{write:!0}})],NE.prototype,"minLabel",void 0),h([f({type:String,json:{write:!0}})],NE.prototype,"maxLabel",void 0),h([f({type:String,json:{write:!0}})],NE.prototype,"title",void 0),NE=h([I("esri.renderers.support.HeatmapLegendOptions")],NE);const Une=2.4;function sFt(t){return Do(t*Une)}function nFt(t){return _n(t)/Une}function oFt(t,e,i,r){let{color:s,ratio:n}=e,{color:o,ratio:a}=i;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=Te((r-n)/(a-n),0,1);LB(t,s.toArray(),o.toArray(),l)}function bsi(t){const i=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return i;let r=t[0],s=t[0],n=1;const o=Qt();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<t.length;)r=s,s=t[n++];oFt(o,r,s,l),i.set(o,4*a)}return i}function wsi(t,e,i){const r=Math.sqrt(t**2+e**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function xsi(t){return typeof t=="function"?t:t?e=>+e[t]:()=>1}var RQ;function R_e(t){if(t!=null){const{maxDensity:e,minDensity:i,radius:r}=t;if(e!=null||i!=null||r!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=t;return a}}return t}let da=RQ=class extends Q0{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new Fk({ratio:0,color:new Oe("rgba(255, 140, 0, 0)")}),new Fk({ratio:.75,color:new Oe("rgba(255, 140, 0, 1)")}),new Fk({ratio:.9,color:new Oe("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return R_e(t)}get blurRadius(){return nFt(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",sFt(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(Une**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||tl(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,hT(()=>{LUe(ie.getLogger(this),t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=R_e(t),super.read(t,e)}getSymbol(){return new kf}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&Sc(t,e,i),r&&typeof r=="string"&&await Vl(t,e,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new RQ({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:Q(this.colorStops),field:this.field,legendOptions:Q(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};h([f({type:Dne,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],da.prototype,"authoringInfo",void 0),h([f({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],da.prototype,"blurRadius",null),h([f({type:[Fk],json:{write:!0}})],da.prototype,"colorStops",void 0),h([f({type:String,json:{write:!0}})],da.prototype,"field",void 0),h([f({type:NE,json:{write:!0}})],da.prototype,"legendOptions",void 0),h([f({type:Number,json:{write:!0}})],da.prototype,"maxDensity",void 0),h([f({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],da.prototype,"maxPixelIntensity",null),h([f({type:Number,json:{write:!0}})],da.prototype,"minDensity",void 0),h([f({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],da.prototype,"minPixelIntensity",null),h([f({type:Number,cast:pr,json:{write:!0}})],da.prototype,"radius",void 0),h([f({type:Number,range:{min:0},json:{default:0,write:!0}})],da.prototype,"referenceScale",void 0),h([ct({heatmap:"heatmap"})],da.prototype,"type",void 0),h([f({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],da.prototype,"valueExpression",void 0),h([f({type:String})],da.prototype,"valueExpressionTitle",void 0),h([f({readOnly:!0})],da.prototype,"_pixelIntensityToDensity",null),da=RQ=h([I("esri.renderers.HeatmapRenderer")],da);const L5e=da;let Vx=class extends Kr(ye){constructor(){super(...arguments),this.color=new Oe([0,0,0,0]),this.label=null,this.threshold=0}};h([f({type:Oe,json:{write:!0}})],Vx.prototype,"color",void 0),h([f({type:String,json:{write:!0}})],Vx.prototype,"label",void 0),h([f({type:Number,range:{min:0,max:1},json:{write:!0}})],Vx.prototype,"threshold",void 0),Vx=h([I("esri.renderers.support.OthersCategory")],Vx);let kk=class extends Kr(ye){constructor(){super(...arguments),this.title=null}};h([f({type:String,json:{write:!0}})],kk.prototype,"title",void 0),kk=h([I("esri.renderers.support.PieChartLegendOptions")],kk);let Yu=class extends oP(Kr(Q0)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new Oe([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new Vx,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new kf({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(K1)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,i)=>e+i.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,i)=>e+JSON.stringify(i),"")}async collectRequiredFields(e,i){await this.collectVVRequiredFields(e,i);for(const r of this.attributes)r.valueExpression&&await Vl(e,i,r.valueExpression),r.field&&e.add(r.field)}};h([f({type:[I5e],json:{write:!0}})],Yu.prototype,"attributes",void 0),h([f({type:db,json:{default:null,write:!0}})],Yu.prototype,"backgroundFillSymbol",void 0),h([f({type:Oe,json:{write:!0}})],Yu.prototype,"defaultColor",void 0),h([f({type:String,json:{write:!0}})],Yu.prototype,"defaultLabel",void 0),h([f({type:Number,range:{min:0,max:1},json:{write:!0}})],Yu.prototype,"holePercentage",void 0),h([f({type:Vx,json:{write:!0}})],Yu.prototype,"othersCategory",void 0),h([f({type:kk,json:{write:!0}})],Yu.prototype,"legendOptions",void 0),h([f({type:Mu,json:{default:null,write:!0}})],Yu.prototype,"outline",void 0),h([f({type:Number,cast:pr,json:{write:!0}})],Yu.prototype,"size",void 0),h([ct({pieChart:"pie-chart"})],Yu.prototype,"type",void 0),Yu=h([I("esri.renderers.PieChartRenderer")],Yu);const aFt=Yu;var $Q;let mx=$Q=class extends oP(Q0){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new $Q({description:this.description,label:this.label,symbol:Q(this.symbol),visualVariables:Q(this.visualVariables),authoringInfo:Q(this.authoringInfo)})}};h([f({type:String,json:{write:!0}})],mx.prototype,"description",void 0),h([f({type:String,json:{write:!0}})],mx.prototype,"label",void 0),h([f(Fne)],mx.prototype,"symbol",void 0),h([ct({simple:"simple"})],mx.prototype,"type",void 0),mx=$Q=h([I("esri.renderers.SimpleRenderer")],mx);const aP=mx,lFt=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function IQ(t){return t instanceof Re}function $_e(t){return t instanceof tt?Object.keys(t.items):IQ(t)?tl(t).keys():t?Object.keys(t):[]}function h4(t,e){return t instanceof tt?t.items[e]:t[e]}function cFt(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function TI(t){return t?t.declaredClass:null}function D5e(t,e){var d;const i=t.diff;if(i&&typeof i=="function")return i(t,e);const r=$_e(t),s=$_e(e);if(r.length===0&&s.length===0)return;if(!r.length||!s.length||cFt(t,e))return{type:"complete",oldValue:t,newValue:e};const n=s.filter(p=>!r.includes(p)),o=r.filter(p=>!s.includes(p)),a=r.filter(p=>s.includes(p)&&h4(t,p)!==h4(e,p)).concat(n,o).sort(),l=TI(t);if(l&&lFt.has(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const u=IQ(t)&&IQ(e);for(const p of a){const m=h4(t,p),g=h4(e,p);let y;if((u||typeof m!="function"&&typeof g!="function")&&m!==g&&(m!=null||g!=null)){if(i&&i[p]&&typeof i[p]=="function")y=(d=i[p])==null?void 0:d.call(i,m,g);else if(m instanceof Date&&g instanceof Date){if(m.getTime()===g.getTime())continue;y={type:"complete",oldValue:m,newValue:g}}else y=typeof m=="object"&&typeof g=="object"&&TI(m)===TI(g)?D5e(m,g):{type:"complete",oldValue:m,newValue:g};y!=null&&(c!=null?c.diff[p]=y:c={type:"partial",diff:{[p]:y}})}}return c}function Csi(t,e){return uFt(t,e)}function uFt(t,e){if(t==null)return!1;const i=e.split(".");let r=t;for(const s of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const n=r.diff[s];if(!n)return!1;r=n}}return!0}function Msi(t,e){if(!t)return!1;if(t.type==="partial"){const i=Object.keys(t.diff);return i.length===1&&i[0]===e}return!1}function hFt(t,e){if(typeof t!="function"&&typeof e!="function"&&(t!=null||e!=null))return t==null||e==null||typeof t=="object"&&typeof e=="object"&&TI(t)!==TI(e)?{type:"complete",oldValue:t,newValue:e}:D5e(t,e)}function d4(t){if(t==null)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const i of e.added)if(!d4(i))return!1;for(const i of e.removed)if(!d4(i))return!1;for(const i of e.changed)if(!d4(i))return!1;return!0}case"partial":for(const e in t.diff)if(!d4(t.diff[e]))return!1;return!0}}let FE=class extends Kr(ye){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};h([f($k)],FE.prototype,"value",void 0),h([f($k)],FE.prototype,"value2",void 0),h([f($k)],FE.prototype,"value3",void 0),FE=h([I("esri.renderers.support.UniqueValue")],FE);const _M=FE;let yv=class extends Kr(ye){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const i=typeof(e=Array.isArray(e)?e:[e])[0];return i==="string"||i==="number"?e.map(r=>new _M({value:r})):i==="object"?e[0]instanceof _M?e:e.map(r=>new _M(r)):null}};h([f({type:String,json:{write:!0}})],yv.prototype,"description",void 0),h([f({type:String,json:{write:!0}})],yv.prototype,"label",void 0),h([f(Ij)],yv.prototype,"symbol",void 0),h([f({type:[_M],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new _M({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const i=[];for(const r of t){const s=[r.value,r.value2,r.value3].filter(K1).map(n=>n.toString());i.push(s)}e.values=i}}}})],yv.prototype,"values",void 0),h([Li("values")],yv.prototype,"castValues",null),yv=h([I("esri.renderers.support.UniqueValueClass")],yv);const N5e=yv;let g$=class extends Kr(ye){constructor(e){super(e),this.heading=null,this.classes=null}};h([f({type:String,json:{write:!0}})],g$.prototype,"heading",void 0),h([f({type:[N5e],json:{write:!0}})],g$.prototype,"classes",void 0),g$=h([I("esri.renderers.support.UniqueValueGroup")],g$);const LQ=g$;var DQ;let gx=DQ=class extends ye{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new DQ({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){var e;const t=JSON.stringify((e=this.symbol)==null?void 0:e.toJSON());return`${this.value}.${t}`}};h([f({type:String,json:{write:!0}})],gx.prototype,"description",void 0),h([f({type:String,json:{write:!0}})],gx.prototype,"label",void 0),h([f(Fne)],gx.prototype,"symbol",void 0),h([f($k)],gx.prototype,"value",void 0),gx=DQ=h([I("esri.renderers.support.UniqueValueInfo")],gx);const EI=gx;var y$;const F5e="esri.renderers.UniqueValueRenderer",U_=()=>ie.getLogger(F5e),I_e="uvInfos-watcher",L_e="uvGroups-watcher",dFt=",",pFt=Ln(EI);function fFt(t){const{field1:e,field2:i,field3:r,fieldDelimiter:s,uniqueValueInfos:n,valueExpression:o}=t,a=!(!e||!i);return[{classes:(n??[]).map(l=>{var b;const{symbol:c,label:u,value:d,description:p}=l,[m,g,y]=a?((b=d==null?void 0:d.toString())==null?void 0:b.split(s||""))||[]:[d],v=[];return(e||o)&&v.push(m),i&&v.push(g),r&&v.push(y),{symbol:c,label:u,values:[v],description:p}})}]}let tn=y$=class extends oP(Q0){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,i){if(!e&&!i)return;if(!e||!i)return{type:"complete",oldValue:e,newValue:i};let r=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const o=e.find(a=>a.value===i[n].value);o?hFt(o,i[n])?(s.changed.push({type:"complete",oldValue:o,newValue:i[n]}),r=!0):s.unchanged.push({oldValue:o,newValue:i[n]}):(s.added.push(i[n]),r=!0)}for(let n=0;n<e.length;n++)i.find(o=>o.value===e[n].value)||(s.removed.push(e[n]),r=!0);return r?s:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:B3(t)}writeField(t,e,i,r){typeof t=="string"?e[i]=t:r!=null&&r.messages?r.messages.push(new V("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):U_().error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,i){return i.portal||No.getDefault()}readStyleOrigin(t,e,i){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const r=k1(e.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(t,e,i,r){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=YS(t.styleUrl,r))}set uniqueValueGroups(t){this.styleOrigin?U_().error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?U_().error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){var r;if(this.styleOrigin)return void U_().error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof t=="object"?pFt(t):new EI({value:t,symbol:PCe(e)}),(r=this.uniqueValueInfos)==null||r.push(i),this._valueInfoMap[i.value]=i,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void U_().error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e)for(let i=0;i<e.length;i++){const r=e[i];if(String(r.value)===String(t)){delete this._valueInfoMap[t],e.splice(i,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let i=e;return this.valueExpression&&(e==null?void 0:e.arcade)==null&&(i={...i,arcade:await z1()}),this._getUniqueValueInfo(t,i)}getSymbol(t,e){if(this.valueExpression&&(e==null?void 0:e.arcade)==null)return void U_().error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(t,e);return(i==null?void 0:i.symbol)||this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&(i==null?void 0:i.arcade)==null){const s=await z1(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this._getUniqueValueInfo(t,i);return(r==null?void 0:r.symbol)||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){var r;const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=(r=this.uniqueValueInfos)==null?void 0:r.reduce((s,n)=>s+n.getMeshHash(),"");return`${t}.${e}.${i}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new y$({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:Q(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:Q(this.visualVariables),legendOptions:Q(this.legendOptions),authoringInfo:Q(this.authoringInfo),backgroundFillSymbol:Q(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=Q(this.uniqueValueInfos),i=Q(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(Q(this.styleOrigin))),Object.freeze(e),Object.freeze(i)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",i),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),Vl(t,e,this.valueExpression)];Sc(t,e,this.field),Sc(t,e,this.field2),Sc(t,e,this.field3),await Promise.all(i)}populateFromStyle(){return _se(this.styleOrigin,{portal:this.portal}).then(t=>{var i;const e=[];return this._valueInfoMap={},t!=null&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(r=>{const s=new PT({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==t.data.defaultItem||(this.defaultSymbol=s,this._isDefaultSymbolDerived=!0);const n=new EI({value:r.name,symbol:s});e.push(n),this._valueInfoMap[r.name]=n}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((i=this.uniqueValueInfos)!=null&&i.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",dFt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(I_e);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const i of t)e.push(ue(()=>({symbol:i.symbol,value:i.value,label:i.label,description:i.description}),(r,s)=>{r!==s&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,I_e)}}_watchUniqueValueGroups(){this.removeHandles(L_e);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const i of t){e.push(ue(()=>({classes:i.classes}),(r,s)=>{r!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const r of i.classes??[])e.push(ue(()=>({symbol:r.symbol,values:r.values,label:r.label,description:r.description}),(s,n)=>{s!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,L_e)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:i,field3:r,fieldDelimiter:s,uniqueValueGroups:n,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!i);for(const l of n)for(const c of l.classes??[]){const{symbol:u,label:d,values:p,description:m}=c;for(const g of p??[]){const{value:y,value2:v,value3:b}=g,w=[y];i&&w.push(v),r&&w.push(b);const x=a?w.join(s||""):w[0]??void 0;t.push(new EI({symbol:u,label:d,value:x,description:m}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:i,valueExpression:r,fieldDelimiter:s,uniqueValueInfos:n}=this;if(!e&&!r||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!i),a=n.map(c=>{var b;const{symbol:u,label:d,value:p,description:m}=c,[g,y,v]=o?((b=p==null?void 0:p.toString())==null?void 0:b.split(s||""))||[]:[p];return new N5e({symbol:u,label:d,description:m,values:[new _M({value:g,value2:y,value3:v})]})}),l=[new LQ({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:s,arcade:n,timeZone:o}=e??{};let a=this._cache.compiledFunc;const l=n.arcadeUtils;if(!a){const u=l.createSyntaxTree(this.valueExpression);a=l.createFunction(u),this._cache.compiledFunc=a}const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:i,scale:r,spatialReference:s}),o));return this._valueInfoMap[c+""]}_getUnqiueValueInfoForFields(t){const e=this.field,i=t.attributes;let r;if(this.field2){const s=this.field2,n=this.field3,o=[];e&&o.push(i[e]),s&&o.push(i[s]),n&&o.push(i[n]),r=o.join(this.fieldDelimiter||"")}else e&&(r=i[e]);return this._valueInfoMap[r+""]}static fromPortalStyle(t,e){const i=new y$(e==null?void 0:e.properties);i._set("styleOrigin",Object.freeze({styleName:t})),i._set("portal",(e==null?void 0:e.portal)||No.getDefault());const r=i.populateFromStyle();return r.catch(s=>{U_().error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",s)}),r}static fromStyleUrl(t,e){const i=new y$(e==null?void 0:e.properties);i._set("styleOrigin",Object.freeze({styleUrl:t}));const r=i.populateFromStyle();return r.catch(s=>{U_().error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),r}};h([f({readOnly:!0})],tn.prototype,"_cache",null),h([ct({uniqueValue:"unique-value"})],tn.prototype,"type",void 0),h([f(A5e)],tn.prototype,"backgroundFillSymbol",void 0),h([f({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],tn.prototype,"field",null),h([Li("field")],tn.prototype,"castField",null),h([Ve("field")],tn.prototype,"writeField",null),h([f({type:String,value:null,json:{write:!0}})],tn.prototype,"field2",null),h([f({type:String,value:null,json:{write:!0}})],tn.prototype,"field3",null),h([f({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],tn.prototype,"orderByClassesEnabled",void 0),h([f({type:String,value:null,json:{write:!0}})],tn.prototype,"valueExpression",null),h([f({type:String,json:{write:!0}})],tn.prototype,"valueExpressionTitle",void 0),h([f({type:yM,json:{write:!0}})],tn.prototype,"legendOptions",void 0),h([f({type:String,json:{write:!0}})],tn.prototype,"defaultLabel",void 0),h([f(zK({...Ij},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],tn.prototype,"defaultSymbol",null),h([f({type:String,value:null,json:{write:!0}})],tn.prototype,"fieldDelimiter",null),h([f({type:No,readOnly:!0})],tn.prototype,"portal",void 0),h([Ce("portal",["styleName"])],tn.prototype,"readPortal",null),h([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],tn.prototype,"styleOrigin",void 0),h([Ce("styleOrigin",["styleName","styleUrl"])],tn.prototype,"readStyleOrigin",null),h([Ve("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],tn.prototype,"writeStyleOrigin",null),h([f({type:[LQ],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,i)=>(e.uniqueValueGroups||fFt(e)).map(r=>LQ.fromJSON(r,i))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],tn.prototype,"uniqueValueGroups",null),h([f({type:[EI],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],tn.prototype,"uniqueValueInfos",null),tn=y$=h([I(F5e)],tn);const zne=tn,Dj={key:"type",base:Q0,typeMap:{heatmap:L5e,simple:aP,"unique-value":zne,"class-breaks":O5e,"dot-density":rFt,dictionary:tFt,"pie-chart":aFt},errorContext:"renderer"},k5e={key:"type",base:Q0,typeMap:{simple:aP,"unique-value":zne,"class-breaks":O5e,heatmap:L5e},errorContext:"renderer",validate:mFt};function mFt(t){switch(t.type){case"simple":return gFt(t);case"unique-value":return yFt(t);case"class-breaks":return _Ft(t);case"heatmap":return t}}function gFt(t){if(t.symbol)return t;ie.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}function yFt(t){const e=t.uniqueValueInfos,i=e==null?void 0:e.filter(({symbol:r,label:s},n)=>(r||ie.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${n}] ${s}) without a symbol from web scene.`),!!r));return(i==null?void 0:i.length)!==(e==null?void 0:e.length)&&(t.uniqueValueInfos=i),t}function _Ft(t){const e=t.classBreakInfos,i=e==null?void 0:e.filter(({symbol:r,label:s},n)=>(r||ie.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${n}] ${s}) without a symbol from web scene.`),!!r));return(i==null?void 0:i.length)!==(e==null?void 0:e.length)&&(t.classBreakInfos=i),t}function Rsi(t,e){return $3(t,null,e)}const vFt=OA({types:Dj});function $3(t,e,i){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(i!=null&&i.messages&&i.messages.push(new Sf("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:i})),null):vFt(t,e,i):null}var NQ;let yx=NQ=class extends ye{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new NQ({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};h([f({type:String,json:{write:!0}})],yx.prototype,"expression",void 0),h([f({type:String,json:{write:!0}})],yx.prototype,"name",void 0),h([f({type:["boolean","date","number","string"],json:{write:!0}})],yx.prototype,"returnType",void 0),h([f({type:String,json:{write:!0}})],yx.prototype,"title",void 0),yx=NQ=h([I("esri.form.ExpressionInfo")],yx);const bFt=yx;let _x=class extends ye{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};h([f({type:String,json:{write:!0}})],_x.prototype,"description",void 0),h([f({type:String,json:{write:!0}})],_x.prototype,"label",void 0),h([f()],_x.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],_x.prototype,"visibilityExpression",void 0),_x=h([I("esri.form.elements.Element")],_x);const cT=_x;var FQ;let Uk=FQ=class extends ye{constructor(t){super(t),this.type=null}clone(){return new FQ({type:this.type})}};h([f({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],Uk.prototype,"type",void 0),Uk=FQ=h([I("esri.form.elements.inputs.AttachmentInput")],Uk);const wFt=Uk;var kQ;let vx=kQ=class extends cT{constructor(t){super(t),this.attachmentKeyword=null,this.editableExpression=null,this.input=null,this.type="attachment"}clone(){return new kQ({attachmentKeyword:this.attachmentKeyword,description:this.description,editableExpression:this.editableExpression,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};h([f({type:String,json:{write:!0}})],vx.prototype,"attachmentKeyword",void 0),h([f({type:String,json:{write:!0}})],vx.prototype,"editableExpression",void 0),h([f({type:wFt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],vx.prototype,"input",void 0),h([f({type:["attachment"],json:{read:!1,write:!0}})],vx.prototype,"type",void 0),vx=kQ=h([I("esri.form.elements.AttachmentElement")],vx);const D_e=vx;let zk=class extends ye{constructor(e){super(e),this.type=null}};h([f()],zk.prototype,"type",void 0),zk=h([I("esri.form.elements.inputs.Input")],zk);const K0=zk;let _$=class extends K0{constructor(e){super(e),this.maxLength=null,this.minLength=0}};h([f({type:Number,json:{write:!0}})],_$.prototype,"maxLength",void 0),h([f({type:Number,json:{write:!0}})],_$.prototype,"minLength",void 0),_$=h([I("esri.form.elements.inputs.TextInput")],_$);const Vne=_$;var UQ;let Vk=UQ=class extends Vne{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new UQ({maxLength:this.maxLength,minLength:this.minLength})}};h([f({type:["barcode-scanner"],json:{read:!1,write:!0}})],Vk.prototype,"type",void 0),Vk=UQ=h([I("esri.form.elements.inputs.BarcodeScannerInput")],Vk);const xFt=Vk;var zQ;let kE=zQ=class extends K0{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new zQ({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};h([f({type:String,json:{write:!0}})],kE.prototype,"noValueOptionLabel",void 0),h([f({type:Boolean,json:{write:!0}})],kE.prototype,"showNoValueOption",void 0),h([f({type:["combo-box"],json:{read:!1,write:!0}})],kE.prototype,"type",void 0),kE=zQ=h([I("esri.form.elements.inputs.ComboBoxInput")],kE);const SFt=kE;var VQ;function N_e(t){return t??null}function F_e(t){return t??null}let Om=VQ=class extends K0{constructor(t){super(t),this.max=null,this.min=null,this.type="date-picker"}readMax(t,e){return N_e(e.max)}writeMax(t,e){e.max=F_e(t)}readMin(t,e){return N_e(e.min)}writeMin(t,e){e.min=F_e(t)}clone(){return new VQ({max:this.max,min:this.min})}};h([f({type:String,json:{type:String,write:!0}})],Om.prototype,"max",void 0),h([Ce("max")],Om.prototype,"readMax",null),h([Ve("max")],Om.prototype,"writeMax",null),h([f({type:String,json:{type:String,write:!0}})],Om.prototype,"min",void 0),h([Ce("min")],Om.prototype,"readMin",null),h([Ve("min")],Om.prototype,"writeMin",null),h([f({type:["date-picker"],json:{read:!1,write:!0}})],Om.prototype,"type",void 0),Om=VQ=h([I("esri.form.elements.inputs.DatePickerInput")],Om);const TFt=Om;var BQ;function Kq(t){return t??null}function e9(t){return t??null}let Bc=BQ=class extends K0{constructor(t){super(t),this.includeTimeOffset=!0,this.max=null,this.min=null,this.timeResolution="minutes",this.type="datetimeoffset-picker"}readMax(t,e){return Kq(e.max)}writeMax(t,e){e.max=e9(t)}readMin(t,e){return Kq(e.min)}writeMin(t,e){e.min=e9(t)}readTimeResolution(t,e){return Kq(e.timeResolution)}writeTimeResolution(t,e){e.timeResolution=e9(t)}clone(){return new BQ({includeTimeOffset:this.includeTimeOffset,max:this.max,min:this.min,timeResolution:this.timeResolution})}};h([f({type:Boolean,json:{write:!0}})],Bc.prototype,"includeTimeOffset",void 0),h([f({type:String,json:{type:String,write:!0}})],Bc.prototype,"max",void 0),h([Ce("max")],Bc.prototype,"readMax",null),h([Ve("max")],Bc.prototype,"writeMax",null),h([f({type:String,json:{type:String,write:!0}})],Bc.prototype,"min",void 0),h([Ce("min")],Bc.prototype,"readMin",null),h([Ve("min")],Bc.prototype,"writeMin",null),h([f({type:String,json:{type:String,write:!0}})],Bc.prototype,"timeResolution",void 0),h([Ce("timeResolution")],Bc.prototype,"readTimeResolution",null),h([Ve("timeResolution")],Bc.prototype,"writeTimeResolution",null),h([f({type:["datetimeoffset-picker"],json:{read:!1,write:!0}})],Bc.prototype,"type",void 0),Bc=BQ=h([I("esri.form.elements.inputs.DateTimeOffsetPickerInput")],Bc);const EFt=Bc;var GQ;function k_e(t){return t!=null?new Date(t):null}function U_e(t){return t?t.getTime():null}let Dp=GQ=class extends K0{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return k_e(e.max)}writeMax(t,e){e.max=U_e(t)}readMin(t,e){return k_e(e.min)}writeMin(t,e){e.min=U_e(t)}clone(){return new GQ({includeTime:this.includeTime,max:this.max,min:this.min})}};h([f({type:Boolean,json:{write:!0}})],Dp.prototype,"includeTime",void 0),h([f({type:Date,json:{type:Number,write:!0}})],Dp.prototype,"max",void 0),h([Ce("max")],Dp.prototype,"readMax",null),h([Ve("max")],Dp.prototype,"writeMax",null),h([f({type:Date,json:{type:Number,write:!0}})],Dp.prototype,"min",void 0),h([Ce("min")],Dp.prototype,"readMin",null),h([Ve("min")],Dp.prototype,"writeMin",null),h([f({type:["datetime-picker"],json:{read:!1,write:!0}})],Dp.prototype,"type",void 0),Dp=GQ=h([I("esri.form.elements.inputs.DateTimePickerInput")],Dp);const CFt=Dp;var jQ;let UE=jQ=class extends K0{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new jQ({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};h([f({type:String,json:{write:!0}})],UE.prototype,"noValueOptionLabel",void 0),h([f({type:Boolean,json:{write:!0}})],UE.prototype,"showNoValueOption",void 0),h([f({type:["radio-buttons"],json:{read:!1,write:!0}})],UE.prototype,"type",void 0),UE=jQ=h([I("esri.form.elements.inputs.RadioButtonsInput")],UE);const MFt=UE;var HQ;let zE=HQ=class extends K0{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new HQ({offValue:this.offValue,onValue:this.onValue})}};h([f({type:[String,Number],json:{write:!0}})],zE.prototype,"offValue",void 0),h([f({type:[String,Number],json:{write:!0}})],zE.prototype,"onValue",void 0),h([f({type:["switch"],json:{read:!1,write:!0}})],zE.prototype,"type",void 0),zE=HQ=h([I("esri.form.elements.inputs.SwitchInput")],zE);const AFt=zE;var qQ;let Bk=qQ=class extends Vne{constructor(t){super(t),this.type="text-area"}clone(){return new qQ({maxLength:this.maxLength,minLength:this.minLength})}};h([f({type:["text-area"],json:{read:!1,write:!0}})],Bk.prototype,"type",void 0),Bk=qQ=h([I("esri.form.elements.inputs.TextAreaInput")],Bk);const PFt=Bk;var WQ;let Gk=WQ=class extends Vne{constructor(t){super(t),this.type="text-box"}clone(){return new WQ({maxLength:this.maxLength,minLength:this.minLength})}};h([f({type:["text-box"],json:{read:!1,write:!0}})],Gk.prototype,"type",void 0),Gk=WQ=h([I("esri.form.elements.inputs.TextBoxInput")],Gk);const OFt=Gk;var YQ;function t9(t){return t??null}function i9(t){return t??null}let Zu=YQ=class extends K0{constructor(t){super(t),this.max=null,this.min=null,this.timeResolution="minutes",this.type="time-picker"}readMax(t,e){return t9(e.max)}writeMax(t,e){e.max=i9(t)}readMin(t,e){return t9(e.min)}writeMin(t,e){e.min=i9(t)}readTimeResolution(t,e){return t9(e.timeResolution)}writeTimeResolution(t,e){e.timeResolution=i9(t)}clone(){return new YQ({max:this.max,min:this.min,timeResolution:this.timeResolution})}};h([f({type:String,json:{type:String,write:!0}})],Zu.prototype,"max",void 0),h([Ce("max")],Zu.prototype,"readMax",null),h([Ve("max")],Zu.prototype,"writeMax",null),h([f({type:String,json:{type:String,write:!0}})],Zu.prototype,"min",void 0),h([Ce("min")],Zu.prototype,"readMin",null),h([Ve("min")],Zu.prototype,"writeMin",null),h([f({type:String,json:{type:String,write:!0}})],Zu.prototype,"timeResolution",void 0),h([Ce("timeResolution")],Zu.prototype,"readTimeResolution",null),h([Ve("timeResolution")],Zu.prototype,"writeTimeResolution",null),h([f({type:["time-picker"],json:{read:!1,write:!0}})],Zu.prototype,"type",void 0),Zu=YQ=h([I("esri.form.elements.inputs.TimePickerInput")],Zu);const RFt=Zu,$Ft={base:K0,key:"type",typeMap:{"barcode-scanner":xFt,"combo-box":SFt,"date-picker":TFt,"datetime-picker":CFt,"datetimeoffset-picker":EFt,"radio-buttons":MFt,switch:AFt,"text-area":PFt,"text-box":OFt,"time-picker":RFt}};var ZQ;let rd=ZQ=class extends cT{constructor(t){super(t),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return this._get("editable")??!0}set editable(t){this._set("editable",t)}clone(){return new ZQ({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};h([f({types:LCe,json:{read:{reader:hG},write:!0}})],rd.prototype,"domain",void 0),h([f({type:Boolean,json:{write:!0}})],rd.prototype,"editable",null),h([f({type:String,json:{write:!0}})],rd.prototype,"editableExpression",void 0),h([f({type:String,json:{write:!0}})],rd.prototype,"fieldName",void 0),h([f({type:String,json:{write:!0}})],rd.prototype,"hint",void 0),h([f({types:$Ft,json:{read:{source:"inputType"},write:{target:"inputType"}}})],rd.prototype,"input",void 0),h([f({type:String,json:{write:!0}})],rd.prototype,"requiredExpression",void 0),h([f({type:String,json:{read:!1,write:!0}})],rd.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],rd.prototype,"valueExpression",void 0),rd=ZQ=h([I("esri.form.elements.FieldElement")],rd);const z_e=rd;var XQ;let Ny=XQ=class extends cT{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new XQ({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:Q(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};h([f({type:Number,json:{write:!0}})],Ny.prototype,"displayCount",void 0),h([f({type:["list"],json:{write:!0}})],Ny.prototype,"displayType",void 0),h([f({type:String,json:{write:!0}})],Ny.prototype,"editableExpression",void 0),h([f({type:[Ute],json:{write:!0}})],Ny.prototype,"orderByFields",void 0),h([f({type:Number,json:{write:!0}})],Ny.prototype,"relationshipId",void 0),h([f({type:["relationship"],json:{read:!1,write:!0}})],Ny.prototype,"type",void 0),Ny=XQ=h([I("esri.form.elements.RelationshipElement")],Ny);const V_e=Ny;var JQ;let VE=JQ=class extends cT{constructor(t){super(t),this.text=null,this.textFormat="plain-text",this.type="text"}clone(){return new JQ({text:this.text,textFormat:this.textFormat,visibilityExpression:this.visibilityExpression})}};h([f({type:String,json:{write:!0}})],VE.prototype,"text",void 0),h([f({type:String,json:{write:!0}})],VE.prototype,"textFormat",void 0),h([f({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],VE.prototype,"type",void 0),VE=JQ=h([I("esri.form.elements.TextElement")],VE);const B_e=VE;function U5e(t){return{typesWithGroup:{base:cT,key:"type",typeMap:{attachment:D_e,field:z_e,group:t,relationship:V_e,text:B_e}},typesWithoutGroup:{base:cT,key:"type",typeMap:{attachment:D_e,field:z_e,relationship:V_e,text:B_e}}}}function z5e(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function V5e(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>s.toJSON())}function B5e(t,e,i=!0){return t?t.map(r=>xf(i?e.typesWithGroup:e.typesWithoutGroup,r)):null}var QQ;let Nm=QQ=class extends cT{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return B5e(t,r9,!1)}readElements(t,e){return z5e(e.formElements,r9,!1)}writeElements(t,e){e.formElements=V5e(t,r9,!1)}clone(){return new QQ({description:this.description,elements:Q(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};h([f({json:{write:!0}})],Nm.prototype,"elements",void 0),h([Li("elements")],Nm.prototype,"castElements",null),h([Ce("elements",["formElements"])],Nm.prototype,"readElements",null),h([Ve("elements")],Nm.prototype,"writeElements",null),h([f({type:["collapsed","expanded"],json:{write:!0}})],Nm.prototype,"initialState",void 0),h([f({type:String,json:{read:!1,write:!0}})],Nm.prototype,"type",void 0),Nm=QQ=h([I("esri.form.elements.GroupElement")],Nm);const r9=U5e(Nm),IFt=Nm,LFt=t=>t.type==="field",DFt=t=>t.type==="group",NFt=t=>t.type==="text";var KQ;const s9=U5e(IFt);let Np=KQ=class extends ye{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return B5e(t,s9)}readElements(t,e){return z5e(e.formElements,s9)}writeElements(t,e){e.formElements=V5e(t,s9)}clone(){return new KQ({description:this.description,expressionInfos:Q(this.expressionInfos),elements:Q(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}async getFieldsUsed(t,e){const i=new Set,{description:r,elements:s,expressionInfos:n,title:o}=this;if(CI(i,t,r),CI(i,t,o),!s)return[];const a=FFt(s,n).map(l=>Vl(i,t,l));await Promise.all(a);for(const l of s)G5e(i,{fieldsIndex:t,relationships:e},l);return Array.from(i).sort()}};function G5e(t,e,i){var s;const{fieldsIndex:r}=e;if(!r||r.fields.length!==t.size)switch(CI(t,r,i.label),CI(t,r,i.description),i.type){case"field":Sc(t,r,i.fieldName);break;case"group":i.elements.forEach(n=>G5e(t,e,n));break;case"relationship":if(e.relationships){const n=e.relationships.find(o=>o.id===i.relationshipId);n&&Sc(t,r,n.keyField)}ZS(t,r,(s=i.orderByFields)==null?void 0:s.map(n=>n.field));break;case"text":CI(t,r,i.text)}}function FFt(t,e){if(!e||e.length===0)return[];const i=j5e(t),r=[];for(const s of e)i.has(s.name)&&r.push(s.expression);return r}function j5e(t){const e=new Set;for(const i of t)if(Foe(e,i.visibilityExpression),!NFt(i)){if(DFt(i))lU(e,j5e(i.elements));else if(Foe(e,i.editableExpression),LFt(i)){const{requiredExpression:r,valueExpression:s}=i;lU(e,[r,s])}}return e}function CI(t,e,i){ZS(t,e,zEe(i))}h([f({type:String,json:{write:!0}})],Np.prototype,"description",void 0),h([f({json:{write:!0}})],Np.prototype,"elements",void 0),h([Li("elements")],Np.prototype,"castElements",null),h([Ce("elements",["formElements"])],Np.prototype,"readElements",null),h([Ve("elements")],Np.prototype,"writeElements",null),h([f({type:[bFt],json:{write:!0}})],Np.prototype,"expressionInfos",void 0),h([f({type:Boolean,json:{default:!1,write:!0}})],Np.prototype,"preserveFieldValuesWhenHidden",void 0),h([f({type:String,json:{write:!0}})],Np.prototype,"title",void 0),Np=KQ=h([I("esri.form.FormTemplate")],Np);const kFt=Np;function G_e(t,e,i){if(t.hasM==null||t.hasZ)for(const r of e)for(const s of r)s.length>2&&(s[2]*=i)}function UFt(t,e,i){if(!t&&!e||!i)return;const r=kS(i);j_e(t,i,r),j_e(e,i,r)}function j_e(t,e,i){if(t)for(const r of t)zFt(r.geometry,e,i)}function zFt(t,e,i){if(!(t!=null&&t.spatialReference)||gs(t.spatialReference,e))return;const r=kS(t.spatialReference)/i;if(r!==1){if("x"in t)t.z!=null&&(t.z*=r);else if("rings"in t)G_e(t,t.rings,r);else if("paths"in t)G_e(t,t.paths,r);else if("points"in t&&(t.hasM==null||t.hasZ))for(const s of t.points)s.length>2&&(s[2]*=r)}}function H_e(t,e,i){if(!(i!=null&&i.features)||!i.hasZ)return;const r=dSe(i.geometryType,e,t.outSpatialReference);if(r!=null)for(const s of i.features)r(s.geometry)}var eK;const tK=new qi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let pa=eK=class extends ye{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){var s;const i=We.fromJSON(e.spatialReference),r=[];for(let n=0;n<t.length;n++){const o=t[n],a=Su.fromJSON(o),l=(s=o.geometry)==null?void 0:s.spatialReference;a.geometry==null||l||(a.geometry.spatialReference=i);const c=o.aggregateGeometries,u=a.aggregateGeometries;if(c&&u!=null)for(const d in u){const p=u[d],m=c[d],g=m==null?void 0:m.spatialReference;p==null||g||(p.spatialReference=i)}r.push(a)}return r}writeGeometryType(t,e,i,r){if(t)return void tK.write(t,e,i,r);const{features:s}=this;if(s){for(const n of s)if((n==null?void 0:n.geometry)!=null)return void tK.write(n.geometry.type,e,i,r)}}readQueryGeometry(t,e){if(!t)return null;const i=!!t.spatialReference,r=C1(t);return r&&!i&&e.spatialReference&&(r.spatialReference=We.fromJSON(e.spatialReference)),r}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&r.geometry!=null&&r.geometry.spatialReference)return void(e.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new eK(this.cloneProperties())}cloneProperties(){return Q({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let i=0;i<e.features.length;i++){const r=e.features[i];if(r.geometry){const s=t==null?void 0:t[i];r.geometry=(s==null?void 0:s.toJSON())||r.geometry}}return e}quantize(t){const{scale:[e,i],translate:[r,s]}=t,n=c=>Math.round((c-r)/e),o=c=>Math.round((s-c)/i),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,u=a.length;c<u;c++)l!=null&&l(a[c].geometry)||(a.splice(c,1),c--,u--);return this.transform=t,this}unquantize(){var p,m;const{geometryType:t,features:e,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,o]}=i,a=g=>g*n+r,l=g=>s-g*o;let c=null,u=null;if(this.hasZ&&((p=i==null?void 0:i.scale)==null?void 0:p[2])!=null){const{translate:[,,g],scale:[,,y]}=i;c=v=>v*y+g}if(this.hasM&&((m=i==null?void 0:i.scale)==null?void 0:m[3])!=null){const{translate:[,,,g],scale:[,,,y]}=i;u=v=>v==null?v:v*y+g}const d=this._getHydrationFunction(t,a,l,c,u);for(const{geometry:g}of e)g!=null&&d&&d(g);return this.transform=null,this}_quantizePoints(t,e,i){let r,s;const n=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),u=i(l[1]);c===r&&u===s||(n.push([c-r,u-s]),r=c,s=u)}else r=e(l[0]),s=i(l[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(t,e,i){return t==="point"?r=>(r.x=e(r.x),r.y=i(r.y),r):t==="polyline"||t==="polygon"?r=>{const s=Ll(r)?r.rings:r.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,e,i);c&&n.push(c)}return n.length>0?(Ll(r)?r.rings=n:r.paths=n,r):null}:t==="multipoint"?r=>{const s=this._quantizePoints(r.points,e,i);return s&&s.length>0?(r.points=s,r):null}:t==="extent"?r=>r:null}_getHydrationFunction(t,e,i,r,s){return t==="point"?n=>{n.x=e(n.x),n.y=i(n.y),r&&(n.z=r(n.z))}:t==="polyline"||t==="polygon"?n=>{const o=Ll(n)?n.rings:n.paths;let a,l;for(let c=0,u=o.length;c<u;c++){const d=o[c];for(let p=0,m=d.length;p<m;p++){const g=d[p];p>0?(a+=g[0],l+=g[1]):(a=g[0],l=g[1]),g[0]=e(a),g[1]=i(l)}}if(r&&s)for(let c=0,u=o.length;c<u;c++){const d=o[c];for(let p=0,m=d.length;p<m;p++){const g=d[p];g[2]=r(g[2]),g[3]=s(g[3])}}else if(r)for(let c=0,u=o.length;c<u;c++){const d=o[c];for(let p=0,m=d.length;p<m;p++){const g=d[p];g[2]=r(g[2])}}else if(s)for(let c=0,u=o.length;c<u;c++){const d=o[c];for(let p=0,m=d.length;p<m;p++){const g=d[p];g[2]=s(g[2])}}}:t==="extent"?n=>{n.xmin=e(n.xmin),n.ymin=i(n.ymin),n.xmax=e(n.xmax),n.ymax=i(n.ymax),r&&n.zmax!=null&&n.zmin!=null&&(n.zmax=r(n.zmax),n.zmin=r(n.zmin)),s&&n.mmax!=null&&n.mmin!=null&&(n.mmax=s(n.mmax),n.mmin=s(n.mmin))}:t==="multipoint"?n=>{const o=n.points;let a,l;for(let c=0,u=o.length;c<u;c++){const d=o[c];c>0?(a+=d[0],l+=d[1]):(a=d[0],l=d[1]),d[0]=e(a),d[1]=i(l)}if(r&&s)for(let c=0,u=o.length;c<u;c++){const d=o[c];d[2]=r(d[2]),d[3]=s(d[3])}else if(r)for(let c=0,u=o.length;c<u;c++){const d=o[c];d[2]=r(d[2])}else if(s)for(let c=0,u=o.length;c<u;c++){const d=o[c];d[2]=s(d[2])}}:null}};h([f({type:String,json:{write:!0}})],pa.prototype,"displayFieldName",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],pa.prototype,"exceededTransferLimit",void 0),h([f({type:[Su],json:{write:!0}})],pa.prototype,"features",void 0),h([Ce("features")],pa.prototype,"readFeatures",null),h([f({type:[dG],json:{write:!0}})],pa.prototype,"fields",void 0),h([f({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:tK.read}}})],pa.prototype,"geometryType",void 0),h([Ve("geometryType")],pa.prototype,"writeGeometryType",null),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],pa.prototype,"hasM",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],pa.prototype,"hasZ",void 0),h([f({types:fT,json:{write:!0}})],pa.prototype,"queryGeometry",void 0),h([Ce("queryGeometry")],pa.prototype,"readQueryGeometry",null),h([f({type:We,json:{write:!0}})],pa.prototype,"spatialReference",void 0),h([Ve("spatialReference")],pa.prototype,"writeSpatialReference",null),h([f({json:{write:!0}})],pa.prototype,"transform",void 0),pa=eK=h([I("esri.rest.support.FeatureSet")],pa),pa.prototype.toJSON.isDefaultToJSON=!0;const H5e=pa;let VFt=0,Wy=class extends Mf.LoadableMixin(BA(tt)){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const i=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(i)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get _workerGeometryType(){var i;const e=(i=this.layer)==null?void 0:i.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,i={}){await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);H_e(e,this.layer.spatialReference,r);const s=H5e.fromJSON(r);if(!this._requiresClientGraphicMapping())return s;const n=this.layer.objectIdField;for(const o of s.features){const a=o.attributes[n],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return s.geometryType=this.layer.geometryType,s}async queryFeaturesJSON(e,i={}){if(this._requiresClientGraphicMapping())throw new V("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);return H_e(e,this.layer.spatialReference,r),r}queryFeatureCount(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,i))}queryObjectIds(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,i))}queryExtent(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,i)).then(r=>({count:r.count,extent:gi.fromJSON(r.extent)}))}querySnapping(e,i={}){return this.load(i).then(()=>this._connection.invoke("querySnapping",e,i))}async _applyEdits(e){if(!this._connection)throw new V("feature-layer-source:edit-failure","Memory source not loaded");const i=this.layer.objectIdField;let r=null;const s=[],n=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=u=>"objectId"in u&&u.objectId!=null?u.objectId:"attributes"in u&&u.attributes[i]!=null?u.attributes[i]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const u of e.deleteFeatures){const d=o(u);d!=null&&s.push(d)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const u of e.updateFeatures)if(n.push(this._serializeFeature(u)),a){const d=o(u);d!=null&&a.set(d,u)}}UFt(r?r.features:null,n,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:n,deletes:s});return this.fullExtent=l,r&&r.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,i){if(this._layerOrSourceGeometryType!=="mesh"||e==null)return;const r=[];for(const{geometry:s}of e)s==null||s.type!=="mesh"||s.hasExtent||s.loaded||r.push(s.load({signal:i}));r.length&&await Promise.all(r)}_updateClientGraphicIds(e,i){if(this._idToClientGraphic){if(e)for(const r of i.updateResults){if(!r.success)continue;const s=e.get(r.objectId);s!=null&&this._addIdToClientGraphic(s)}for(const r of i.deleteResults)r.success&&this._idToClientGraphic.delete(r.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const i=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:i?new V("feature-layer-source:edit-failure",i.description,{code:i.code}):null}}_prepareAddFeatures(e){const i=new Map,r=new Array(e.length);let s=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);s||a.geometry==null||(s=a.geometry.type),r[o]=l,i.set(`${l.uid}`,a)}const n=this;return{features:r,inferredGeometryType:s,finish(o){const a=n.sourceJSON.objectIdField;for(const l in o){const c=o[l],u=i.get(l);u&&(u.attributes||(u.attributes={}),c===-1?delete u.attributes[a]:u.attributes[a]=c,n._addIdToClientGraphic(u))}}}}_addIdToClientGraphic(e){var s;if(!this._idToClientGraphic)return;const i=this.sourceJSON.objectIdField,r=(s=e.attributes)==null?void 0:s[i];r!=null&&this._idToClientGraphic.set(r,e)}get _layerOrSourceGeometryType(){var e,i;return((e=this.layer)==null?void 0:e.geometryType)??((i=this.sourceJSON)==null?void 0:i.geometryType)}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:i}=e,r=this._geometryForSerialization(e),s=(VFt++).toString();return r?{uid:s,geometry:r.toJSON(),attributes:i}:{uid:s,attributes:i}}_geometryForSerialization(e){const{geometry:i}=e;return i==null?null:this._geometryRequiresClientGraphicMapping(i)?i.extent?tb.fromExtent(i.extent):null:i}async _startWorker(e){this._connection=await JHe("MemorySourceWorker",{strategy:re("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});const{fields:i,spatialReference:r,objectIdField:s,hasM:n,hasZ:o,timeInfo:a,dateFieldsTimeZone:l}=this.layer,c=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const u=this._prepareAddFeatures(this.items);this.addHandles(this.on("before-changes",g=>{ie.getLogger(this).error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),g.preventDefault()}));const d={features:u.features,fields:i==null?void 0:i.map(g=>g.toJSON()),geometryType:xae.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&n,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:s,spatialReference:c?null:r&&r.toJSON(),timeInfo:(a==null?void 0:a.toJSON())??null,dateFieldsTimeZone:l},p=await this._connection.invoke("load",d,{signal:e});for(const g of p.warnings)ie.getLogger(this.layer).warn("#load()",`${g.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:g});p.featureErrors.length&&ie.getLogger(this.layer).warn("#load()",`Encountered ${p.featureErrors.length} validation errors while loading features. (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{errors:p.featureErrors});const m=p.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(u.inferredGeometryType)&&(m.geometryType=xae.toJSON(u.inferredGeometryType)),this.sourceJSON=m,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),u.finish(p.assignedObjectIds)}};h([See({Type:Su,ensureType:Ln(Su)})],Wy.prototype,"itemType",void 0),h([f()],Wy.prototype,"type",void 0),h([f({constructOnly:!0})],Wy.prototype,"layer",void 0),h([f({readOnly:!0})],Wy.prototype,"_workerGeometryType",null),h([f()],Wy.prototype,"sourceJSON",void 0),Wy=h([I("esri.layers.graphics.sources.MemorySource")],Wy);const BFt=S3t(),q5e=new Map,W5e=new Map;async function Nsi(t,e,i){if(!t||!i)return!1;if(!e)return!0;const r=new URL(t).host;let s=q5e.get(r);if(!s){const n=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");s=(await Yt(n,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return s===e}async function Fsi(t,e,i=!1){var n,o,a;if(!t||!e)return!0;const r=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),s=(n=W5e.get(r))==null?void 0:n.entries();if(s){for(const[l,c]of s)if(c.name===e){const u=!((o=c.stack)!=null&&o.hasForwardEdits());if(!u&&i){const[{deleteForwardEdits:d},{default:p}]=await Promise.all([fe(()=>import("./deleteForwardEdits-0ndSslxL.js"),[]),fe(()=>import("./DeleteForwardEditsParameters-BTO2Hb4q.js"),[])]),m=await d(r,l,new p({sessionId:BFt,moment:c.moment}));return m.success&&((a=c.stack)==null||a.clearForwardEdits()),m.success}return u}}return!0}function GFt(t,e){var s;if(!t)return!1;const i=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),r=(s=W5e.get(i))==null?void 0:s.entries();if(r){for(const[n,o]of r)if(o.name===e)return o.lockType==="edit"}return!1}const Bne=new cn.EventEmitter;function jFt(t){return Bne.on("apply-edits",new WeakRef(t))}function HFt(t){return Bne.on("update-moment",new WeakRef(t))}function ksi(t,e,i=null,r=!1){const s=ra();return r=e==null||r,Bne.emit("apply-edits",{serviceUrl:t,layerId:e,gdbVersion:i,mayReceiveServiceEdits:r,result:s.promise}),s}const Y5e=Symbol();function Usi(t){return t!=null&&typeof t=="object"&&Y5e in t}function yO(t){return t!=null&&typeof t=="object"&&"gdbVersion"in t}function n9(t,e,i){const r=new URL(t).host,s=q5e.get(r),n=o=>!o||o===s;return n(e)&&n(i)||e===i}const qFt=t=>{var e;let i=class extends t{constructor(...r){super(...r),this[e]=!0,this._applyEditsHandler=s=>{const{serviceUrl:n,layerId:o,gdbVersion:a,mayReceiveServiceEdits:l,result:c}=s,u=n===this.url,d=o!=null&&this.layerId!=null&&o===this.layerId,p=yO(this),m=yO(this)&&n9(n,a,this.gdbVersion);if(!u||p&&!m||!d&&!l)return;this.lastEditsEventDate=new Date;const g=c.then(y=>{var w;if(d&&(y.addedFeatures.length||y.updatedFeatures.length||y.deletedFeatures.length||y.addedAttachments.length||y.updatedAttachments.length||y.deletedAttachments.length))return this.emit("edits",Q(y)),y;const v=(w=y.editedFeatures)==null?void 0:w.find(({layerId:x})=>x===this.layerId);if(v){const{adds:x,updates:T,deletes:C}=v.editedFeatures,M={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:x?x.map(({attributes:O})=>({objectId:this.objectIdField&&O[this.objectIdField],globalId:this.globalIdField&&O[this.globalIdField]})):[],deletedFeatures:C?C.map(({attributes:O})=>({objectId:this.objectIdField&&O[this.objectIdField],globalId:this.globalIdField&&O[this.globalIdField]})):[],updatedFeatures:T?T.map(({current:{attributes:O}})=>({objectId:this.objectIdField&&O[this.objectIdField],globalId:this.globalIdField&&O[this.globalIdField]})):[],editedFeatures:Q(y.editedFeatures),exceededTransferLimit:!1,historicMoment:Q(y.historicMoment)};return this.emit("edits",M),M}const b={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:Q(y.editedFeatures),exceededTransferLimit:!1,historicMoment:Q(y.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(n,a,b.historicMoment)&&this.emit("edits",b),b}).then(y=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(n,a,y.historicMoment)&&(this.historicMoment=y.historicMoment),y));this.emit("apply-edits",{result:g})},this._updateMomentHandler=s=>{const{serviceUrl:n,gdbVersion:o,moment:a}=s,l=n===this.url,c=yO(this),u=yO(this)&&n9(n,o,this.gdbVersion),d=yO(this)&&!n9(n,this.gdbVersion,null);l&&c&&u&&d&&"historicMoment"in this&&this.historicMoment!==a&&(this.historicMoment=a)},this.when().then(()=>{this.addHandles(jFt(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(HFt(this._updateMomentHandler))},()=>{})}_shouldUpdateHistoricMoment(r,s,n){return"historicMoment"in this&&this.historicMoment!==n&&GFt(r,s)}};return e=Y5e,h([f()],i.prototype,"lastEditsEventDate",void 0),i=h([I("esri.layers.mixins.EditBusLayer")],i),i};var iK;const o9=new qi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),a9=new qi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Rm=iK=class extends ye{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new Pf({geometry:Q(i),objectIds:Q(n),spatialRelationship:r,timeExtent:Q(s),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:i,timeExtent:r,objectIds:s,units:n,distance:o}=this;return new iK({geometry:Q(e),objectIds:Q(s),spatialRelationship:i,timeExtent:Q(r),where:t,units:n,distance:o})}};h([f({type:String,json:{write:!0}})],Rm.prototype,"where",void 0),h([f({types:fT,json:{write:!0}})],Rm.prototype,"geometry",void 0),h([f({type:o9.apiValues,json:{name:"spatialRel",read:{reader:o9.read},write:{allowNull:!1,writer:o9.write,overridePolicy(){return{enabled:this.geometry!=null}}}}})],Rm.prototype,"spatialRelationship",void 0),h([f({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],Rm.prototype,"distance",void 0),h([f({type:[Number],json:{write:!0}})],Rm.prototype,"objectIds",void 0),h([f({type:a9.apiValues,json:{read:a9.read,write:{writer:a9.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],Rm.prototype,"units",void 0),h([f({type:Sg,json:{write:!0}})],Rm.prototype,"timeExtent",void 0),Rm=iK=h([I("esri.layers.support.FeatureFilter")],Rm);const WFt=Rm;var rK;const q_e={read:{reader:b3},write:{writer:w3,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},W_e={read:{reader:b3},write:{writer:w3,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},Y_e={name:"showExcludedLabels",default:!0};let bx=rK=class extends ye{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){var r,s;const i=super.write(t,e);if(e!=null&&e.origin){if(i.filter){const n=Object.keys(i.filter);if(n.length>1||n[0]!=="where")return(r=e.messages)==null||r.push(new V("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in i)return(s=e.messages)==null||s.push(new V("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return i}clone(){return new rK({filter:this.filter!=null?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};h([f({type:WFt,json:{write:{allowNull:!0,writer(t,e,i,r){const s=t==null?void 0:t.write({},r);s&&Object.keys(s).length!==0?kl(i,s,e):kl(i,null,e)}}}})],bx.prototype,"filter",void 0),h([f({json:{read:b3,write:{writer:w3,allowNull:!0},origins:{"web-map":q_e,"portal-item":q_e}}})],bx.prototype,"includedEffect",void 0),h([f({json:{read:b3,write:{writer:w3,allowNull:!0},origins:{"web-map":W_e,"portal-item":W_e}}})],bx.prototype,"excludedEffect",void 0),h([f({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":Y_e,"portal-item":Y_e}}})],bx.prototype,"excludedLabelsVisible",void 0),bx=rK=h([I("esri.layers.support.FeatureEffect")],bx);const YFt=bx,Z_e={write:{allowNull:!0}},ZFt={type:YFt,json:{origins:{"web-map":Z_e,"portal-item":Z_e}}},XFt=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return h([f(ZFt)],e.prototype,"featureEffect",void 0),e=h([I("esri.layers.mixins.FeatureEffectLayer")],e),e};let Fy=class extends Kr(ye){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.timeZone=null}};h([f()],Fy.prototype,"creatorField",void 0),h([f()],Fy.prototype,"creationDateField",void 0),h([f()],Fy.prototype,"editorField",void 0),h([f()],Fy.prototype,"editDateField",void 0),h([f()],Fy.prototype,"realm",void 0),h([f(VU("dateFieldsTimeReference",!0))],Fy.prototype,"timeZone",void 0),Fy=h([I("esri.layers.support.EditFieldsInfo")],Fy);const JFt=Fy;let Fm=class extends Kr(ye){constructor(e){super(e)}};h([f({constructOnly:!0,json:{write:!0}})],Fm.prototype,"name",void 0),h([f({constructOnly:!0,json:{write:!0}})],Fm.prototype,"fields",void 0),h([f({constructOnly:!0,json:{write:!0}})],Fm.prototype,"isAscending",void 0),h([f({constructOnly:!0,json:{write:!0}})],Fm.prototype,"indexType",void 0),h([f({constructOnly:!0,json:{write:!0}})],Fm.prototype,"isUnique",void 0),h([f({constructOnly:!0,json:{write:!0}})],Fm.prototype,"description",void 0),Fm=h([I("esri.layers.support.FeatureIndex")],Fm);async function QFt(t,e,i){e=e.clone(),t.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=Z5e(t));const r=KFt(t),s=t.capabilities.query.supportsPagination;e.start=0,e.num=r;let n=null;for(;;){const o=await t.source.queryFeaturesJSON(e,i);if(n==null?n=o:n.features=n.features.concat(o.features),n.exceededTransferLimit=o.exceededTransferLimit,!s||!o.exceededTransferLimit)break;e.start+=r}return n}function KFt(t){return Z5e(t)*e4t(t)}function e4t(t){return t.capabilities.query.maxRecordCount||2e3}function Z5e(t){return t.capabilities.query.supportsMaxRecordCountFactor?Pf.MAX_MAX_RECORD_COUNT_FACTOR:1}var sK;let fa=sK=class extends ye{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new sK(Q({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};h([f({type:[String],json:{write:!0}})],fa.prototype,"attachmentTypes",void 0),h([f({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],fa.prototype,"attachmentsWhere",void 0),h([f({type:Boolean,json:{write:!0}})],fa.prototype,"cacheHint",void 0),h([f({type:[String],json:{write:!0}})],fa.prototype,"keywords",void 0),h([f({type:[Number],json:{write:!0}})],fa.prototype,"globalIds",void 0),h([f({json:{write:!0}})],fa.prototype,"name",void 0),h([f({type:Number,json:{read:{source:"resultRecordCount"}}})],fa.prototype,"num",void 0),h([f({type:[Number],json:{write:!0}})],fa.prototype,"objectIds",void 0),h([f({type:Boolean,json:{default:!1,write:!0}})],fa.prototype,"returnMetadata",void 0),h([f({type:[Number],json:{write:!0}})],fa.prototype,"size",void 0),h([f({type:Number,json:{read:{source:"resultOffset"}}})],fa.prototype,"start",void 0),h([Ve("start"),Ve("num")],fa.prototype,"writeStart",null),h([f({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],fa.prototype,"where",void 0),fa=sK=h([I("esri.rest.support.AttachmentQuery")],fa),fa.from=Ln(fa);const t4t=fa;var nK;let pn=nK=class extends ye{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new nK(Q({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};h([f({type:Boolean,json:{write:!0}})],pn.prototype,"cacheHint",void 0),h([f({type:Vp,json:{write:!0}})],pn.prototype,"dynamicDataSource",void 0),h([f({type:String,json:{write:!0}})],pn.prototype,"gdbVersion",void 0),h([f({type:Number,json:{write:!0}})],pn.prototype,"geometryPrecision",void 0),h([f({type:Date})],pn.prototype,"historicMoment",void 0),h([Ve("historicMoment")],pn.prototype,"_writeHistoricMoment",null),h([f({type:Number,json:{write:!0}})],pn.prototype,"maxAllowableOffset",void 0),h([f({json:{write:!0}})],pn.prototype,"objectIds",void 0),h([f({type:[String],json:{write:!0}})],pn.prototype,"orderByFields",void 0),h([f({type:[String],json:{write:!0}})],pn.prototype,"outFields",void 0),h([f({type:We,json:{read:{source:"outSR"},write:{target:"outSR"}}})],pn.prototype,"outSpatialReference",void 0),h([f({json:{write:!0}})],pn.prototype,"relationshipId",void 0),h([f({type:Number,json:{read:{source:"resultOffset"}}})],pn.prototype,"start",void 0),h([Ve("start"),Ve("num")],pn.prototype,"writeStart",null),h([f({type:Number,json:{read:{source:"resultRecordCount"}}})],pn.prototype,"num",void 0),h([f({json:{write:!0}})],pn.prototype,"returnGeometry",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],pn.prototype,"returnM",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],pn.prototype,"returnZ",void 0),h([f({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],pn.prototype,"where",void 0),pn=nK=h([I("esri.rest.support.RelationshipQuery")],pn),pn.from=Ln(pn);const Gne=pn,Bsi=Object.freeze(Object.defineProperty({__proto__:null,default:Gne},Symbol.toStringTag,{value:"Module"})),oK=new qi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function i4t(t,e,i,r){const s=await wb(t);if(await jne(t,e,r),!s.addAttachment)throw new V(r,"Layer source does not support addAttachment capability");return s.addAttachment(e,i)}function jne(t,e,i){var n,o;const{attributes:r}=e,{objectIdField:s}=t;return(o=(n=t.capabilities)==null?void 0:n.data)!=null&&o.supportsAttachment?e?r?s&&r[s]?Promise.resolve():Promise.reject(new V(i,`feature is missing the identifying attribute ${s}`)):Promise.reject(new V(i,"'attributes' are required on a feature to query attachments")):Promise.reject(new V(i,"A feature is required to add/delete/update attachments")):Promise.reject(new V(i,"this layer doesn't support attachments"))}async function r4t(t,e,i,r,s){const n=await wb(t);if(await jne(t,e,s),!n.updateAttachment)throw new V(s,"Layer source does not support updateAttachment capability");return n.updateAttachment(e,i,r)}async function s4t(t,e,i){const{applyEdits:r}=await fe(()=>import("./editingSupport-BheQ6ebt.js"),__vite__mapDeps([214,18,19,103])),s=await t.load();let n=i;return s.type==="feature"&&s.infoFor3D&&e.deleteFeatures!=null&&s.globalIdField!=null&&(n={...n,globalIdToObjectId:await x4t(s,e.deleteFeatures,s.globalIdField)}),r(s,s.source,e,i)}async function n4t(t,e,i){const{uploadAssets:r}=await fe(()=>import("./editingSupport-BheQ6ebt.js"),__vite__mapDeps([214,18,19,103])),s=await t.load();return r(s,s.source,e,i)}async function o4t(t,e,i,r){const s=await wb(t);if(await jne(t,e,r),!s.deleteAttachments)throw new V(r,"Layer source does not support deleteAttachments capability");return s.deleteAttachments(e,i)}async function a4t(t,e,i){const r=(await t.load({signal:e==null?void 0:e.signal})).source;if(!r.fetchRecomputedExtents)throw new V(i,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)}async function l4t(t,e,i,r){var m,g;e=t4t.from(e),await t.load();const s=t.source,n=t.capabilities;if(!((m=n==null?void 0:n.data)!=null&&m.supportsAttachment))throw new V(r,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:u,start:d,where:p}=e;if(!((g=n==null?void 0:n.operations)!=null&&g.supportsQueryAttachments)&&((o==null?void 0:o.length)>0||(l==null?void 0:l.length)>0||(u==null?void 0:u.length)>0||c||d||p))throw new V(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a!=null&&a.length||l!=null&&l.length||p))throw new V(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!s.queryAttachments)throw new V(r,"Layer source does not support queryAttachments capability",e);return s.queryAttachments(e)}async function c4t(t,e,i,r){const s=await wb(t);if(!s.queryObjectIds)throw new V(r,"Layer source does not support queryObjectIds capability");return s.queryObjectIds(Pf.from(e)??t.createQuery(),i)}async function u4t(t,e,i,r){const s=await wb(t);if(!s.queryFeatureCount)throw new V(r,"Layer source does not support queryFeatureCount capability");return s.queryFeatureCount(Pf.from(e)??t.createQuery(),i)}async function h4t(t,e,i,r){const s=await wb(t);if(!s.queryExtent)throw new V(r,"Layer source does not support queryExtent capability");return s.queryExtent(Pf.from(e)??t.createQuery(),i)}async function d4t(t,e,i,r){const s=await wb(t);if(!s.queryRelatedFeatures)throw new V(r,"Layer source does not support queryRelatedFeatures capability");return s.queryRelatedFeatures(Gne.from(e),i)}async function p4t(t,e,i,r){const s=await wb(t);if(!s.queryRelatedFeaturesCount)throw new V(r,"Layer source does not support queryRelatedFeaturesCount capability");return s.queryRelatedFeaturesCount(Gne.from(e),i)}async function f4t(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:i,updates:r}=await e.refresh();if(r!=null&&(t.sourceJSON={...t.sourceJSON,...r},t.read(r,{origin:"service",url:t.parsedUrl})),i)return!0}catch{}if(t.definitionExpression)try{return(await $te(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function m4t(t){var o,a;const e=new Pf,i=(o=t.capabilities)==null?void 0:o.data,r=(a=t.capabilities)==null?void 0:a.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),i&&(i.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),i.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:s,timeExtent:n}=t;return e.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function X5e(t){const{globalIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeGlobalID")return r.name}}function J5e(t){const{objectIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeOID")return r.name}}function g4t(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function y4t(t,e){const{subtypes:i,subtypeField:r}=t;if(!e||!(i!=null&&i.length)||!r)return null;const s=e.attributes[r];return s==null?null:i.find(n=>n.code===s)}async function wb(t){return(await t.load()).source}async function _4t(t,e){if(!pi||pi.findCredential(t))return;let i;try{const r=await RTe(t,e);r&&(i=await pi.checkSignInStatus(`${r}/sharing`))}catch{}if(i)try{const r=e!=null?e.signal:null;await pi.getCredential(t,{signal:r})}catch{}}async function v4t(t,e,i){var s;const r=(s=t.parsedUrl)==null?void 0:s.path;r&&t.authenticationTriggerEvent===e&&await _4t(r,i)}function b4t(t){return!jk(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const l9=OA({types:ACe});function Hne(t,e){var i;if(t.defaultSymbol)return(i=t.types)!=null&&i.length?new zne({defaultSymbol:l9(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(r=>({id:r.id,symbol:l9(r.symbol,r,e)}))}):new aP({symbol:l9(t.defaultSymbol,t,e)})}function w4t(t){var r,s,n;let e=(r=t.sourceJSON)==null?void 0:r.cacheMaxAge;if(!e)return!1;const i=(n=(s=t.editingInfo)==null?void 0:s.lastEditDate)==null?void 0:n.getTime();return i==null||(e*=1e3,Date.now()-i<e)}async function x4t(t,e,i){if(e==null)return null;const r=[],{objectIdField:s}=t;if(e.forEach(c=>{let u=null;if("attributes"in c){const{attributes:d}=c;u={globalId:d[i],objectId:d[s]!=null&&d[s]!==-1?d[s]:null}}else u={globalId:c.globalId,objectId:c.objectId!=null&&c.objectId!==-1?c.objectId:null};u.globalId!=null&&(u.objectId!=null&&u.objectId!==-1||r.push(u.globalId))}),r.length===0)return null;const n=t.createQuery();n.where=r.map(c=>`${i}='${c}'`).join(" OR "),n.returnGeometry=!1,n.outFields=[s,i],n.cacheHint=!1;const o=await Qje(QFt(t,n));if(!o.ok)return null;const a=new Map,l=o.value.features;for(const c of l){const u=c.attributes[i],d=c.attributes[s];u!=null&&d!=null&&d!==-1&&a.set(u,d)}return a}function S4t(t,e,i){if(!e||!i||!t)return null;const r=i.getAttribute(e);return r==null?null:t.find(s=>{const{id:n}=s;return n!=null&&n.toString()===r.toString()})??null}function jk(t){var e;return((e=t.sourceJSON)==null?void 0:e.isMultiServicesView)||T4t(t)}function T4t(t){var e,i;return!!((i=(e=t.sourceJSON)==null?void 0:e.capabilities)!=null&&i.toLowerCase().split(",").map(r=>r.trim()).includes("map"))}let BE=class extends Kr(ye){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};h([f({type:String,json:{read:{source:"shapeAreaFieldName"}}})],BE.prototype,"shapeAreaField",void 0),h([f({type:String,json:{read:{source:"shapeLengthFieldName"}}})],BE.prototype,"shapeLengthField",void 0),h([f({type:String,json:{read:t=>YGe.read(t)||ZGe.read(t)}})],BE.prototype,"units",void 0),BE=h([I("esri.layers.support.GeometryFieldsInfo")],BE);const E4t=BE;var aK;let GE=aK=class extends ye{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new tt}clone(){return new aK({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};h([f({type:String,json:{write:!0}})],GE.prototype,"floorField",void 0),h([f({json:{read:!1,write:!1}})],GE.prototype,"viewAllMode",void 0),h([f({json:{read:!1,write:!1}})],GE.prototype,"viewAllLevelIds",void 0),GE=aK=h([I("esri.layers.support.LayerFloorInfo")],GE);const C4t=GE,X_e=new qi({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),J_e=new qi({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let sd=class extends Kr(ye){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};h([f({json:{read:X_e.read,write:X_e.write}})],sd.prototype,"cardinality",void 0),h([f({json:{read:!0,write:!0}})],sd.prototype,"composite",void 0),h([f({json:{read:!0,write:!0}})],sd.prototype,"id",void 0),h([f({json:{read:!0,write:!0}})],sd.prototype,"keyField",void 0),h([f({json:{read:!0,write:!0}})],sd.prototype,"keyFieldInRelationshipTable",void 0),h([f({json:{read:!0,write:!0}})],sd.prototype,"name",void 0),h([f({json:{read:!0,write:!0}})],sd.prototype,"relatedTableId",void 0),h([f({json:{read:!0,write:!0}})],sd.prototype,"relationshipTableId",void 0),h([f({json:{read:J_e.read,write:J_e.write}})],sd.prototype,"role",void 0),sd=h([I("esri.layers.support.Relationship")],sd);const M4t=sd;function Ut(t,e,i){return!!Q5e(t,e,i)}function v$(t,e,i){return Q5e(t,e,i)}function Q5e(t,e,i){return t&&t.hasOwnProperty(e)?t[e]:i}const A4t={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function P4t(t){var i;const e=(i=t==null?void 0:t.supportedSpatialAggregationStatistics)==null?void 0:i.map(r=>r.toLowerCase());return{envelope:!!(e!=null&&e.includes("envelopeaggregate")),centroid:!!(e!=null&&e.includes("centroidaggregate")),convexHull:!!(e!=null&&e.includes("convexhullaggregate"))}}function QL(t,e){var r;const i=(r=t==null?void 0:t.supportedOperationsWithCacheHint)==null?void 0:r.map(s=>s.toLowerCase());return!!(i!=null&&i.includes(e.toLowerCase()))}function K5e(t,e){return{analytics:O4t(t),attachment:R4t(t),data:$4t(t),metadata:I4t(t),operations:L4t(t.capabilities,t,e),query:D4t(t,e),queryRelated:N4t(t),queryTopFeatures:F4t(t),editing:k4t(t)}}function O4t(t){return{supportsCacheHint:QL(t.advancedQueryCapabilities,"queryAnalytics")}}function R4t(t){const e=t.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:QL(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:Ut(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(r=>{const s=A4t[r.name];s&&(i[s]=!!r.isEnabled)}),i}function $4t(t){return{isVersioned:Ut(t,"isDataVersioned",!1),supportsAttachment:Ut(t,"hasAttachments",!1),supportsM:Ut(t,"hasM",!1),supportsZ:Ut(t,"hasZ",!1)}}function I4t(t){return{supportsAdvancedFieldProperties:Ut(t,"supportsFieldDescriptionProperty",!1)}}function L4t(t,e,i){const r=t?t.toLowerCase().split(",").map(p=>p.trim()):[],s=i?B0(i):null,n=r.includes(s!=null&&s.serverType==="MapServer"?"data":"query"),o=r.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&r.includes("create"),l=o&&r.includes("delete"),c=o&&r.includes("update");const u=r.includes("changetracking"),d=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:Ut(e,"supportsCalculate",!1),supportsTruncate:Ut(e,"supportsTruncate",!1),supportsValidateSql:Ut(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:u,supportsQuery:n,supportsQueryAnalytics:Ut(d,"supportsQueryAnalytic",!1),supportsQueryAttachments:Ut(d,"supportsQueryAttachments",!1),supportsQueryTopFeatures:Ut(d,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:Ut(e,"supportsAttachmentsResizing",!1),supportsSync:r.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:Ut(e,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:Ut(e,"supportsAsyncConvert3D",!1)}}function D4t(t,e){const i=t.advancedQueryCapabilities,r=t.ownershipBasedAccessControlForFeatures,s=t.archivingInfo,n=t.currentVersion,o=e==null?void 0:e.includes("MapServer"),a=!o||n>=re("mapserver-pbf-version-support"),l=HCe(e),c=new Set((t.supportedQueryFormats??"").split(",").map(u=>u.toLowerCase().trim()));return{maxRecordCount:v$(t,"maxRecordCount",void 0),maxRecordCountFactor:v$(t,"maxRecordCountFactor",void 0),standardMaxRecordCount:v$(t,"standardMaxRecordCount",void 0),supportedSpatialAggregationStatistics:P4t(i),supportsCacheHint:Ut(i,"supportsQueryWithCacheHint",!1)||QL(i,"query"),supportsCentroid:Ut(i,"supportsReturningGeometryCentroid",!1),supportsCompactGeometry:l,supportsDefaultSpatialReference:Ut(i,"supportsDefaultSR",!1),supportsDisjointSpatialRelationship:Ut(i,"supportsDisjointSpatialRel",!1),supportsDistance:Ut(i,"supportsQueryWithDistance",!1),supportsDistinct:Ut(i,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:Ut(i,"supportsReturningQueryExtent",!1),supportsFormatPBF:a&&c.has("pbf"),supportsFullTextSearch:Ut(i,"supportsFullTextSearch",!1),supportsGeometryProperties:Ut(i,"supportsReturningGeometryProperties",!1),supportsHavingClause:Ut(i,"supportsHavingClause",!1),supportsHistoricMoment:Ut(s,"supportsQueryWithHistoricMoment",!1),supportsMaxRecordCountFactor:Ut(i,"supportsMaxRecordCountFactor",!1),supportsOrderBy:Ut(i,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:Ut(i,"supportsPagination",!1),supportsPercentileStatistics:Ut(i,"supportsPercentileStatistics",!1),supportsQuantization:Ut(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Ut(t,"supportsQuantizationEditMode",!1),supportsQueryByAnonymous:Ut(r,"allowAnonymousToQuery",!0),supportsQueryByOthers:Ut(r,"allowOthersToQuery",!0),supportsQueryGeometry:Ut(t,"supportsReturningQueryGeometry",!1),supportsResultType:Ut(i,"supportsQueryWithResultType",!1),supportsSpatialAggregationStatistics:Ut(i,"supportsSpatialAggregationStatistics",!1),supportsSqlExpression:Ut(i,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Ut(t,"useStandardizedQueries",!1),supportsStatistics:Ut(i,"supportsStatistics",t.supportsStatistics),supportsTopFeaturesQuery:Ut(i,"supportsTopFeaturesQuery",!1),tileMaxRecordCount:v$(t,"tileMaxRecordCount",void 0)}}function N4t(t){const e=t.advancedQueryCapabilities,i=Ut(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Ut(e,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:QL(e,"queryRelated")}}function F4t(t){return{supportsCacheHint:QL(t.advancedQueryCapabilities,"queryTopFilter")}}function k4t(t){const e=t.ownershipBasedAccessControlForFeatures,i=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:Ut(t,"allowGeometryUpdates",!0),supportsGlobalId:Ut(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Ut(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Ut(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Ut(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Ut(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Ut(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Ut(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Ut(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Ut(e,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:Ut(i,"supportsAsyncApplyEdits",!1),zDefault:v$(t,"zDefault",void 0)}}function Hsi(t){var e;return{operations:{supportsAppend:Ut(t,"supportsAppend",!1),supportsExportClip:Ut(t,"supportsExportClip",!1),supportsExportFrameset:Ut(t,"supportsExportFrameset",!1),supportsMensuration:Ut(t,"supportsMensuration",!1),supportsUpdate:Ut(t,"supportsUpdate",!1)},query:{supportsCoverageQuery:((e=t==null?void 0:t.playbackInfo)==null?void 0:e.klv["0601"])??!1}}}let ky=class extends Kr(ye){constructor(e){super(e),this.code=null,this.defaultValues={},this.domains=null,this.name=null}readDomains(e){if(!e)return null;const i={};for(const r of Object.keys(e))i[r]=hG(e[r]);return i}writeDomains(e,i){var s;if(!e)return;const r={};for(const n of Object.keys(e))e[n]&&(r[n]=(s=e[n])==null?void 0:s.toJSON());i.domains=r}};h([f({type:Number,json:{write:!0}})],ky.prototype,"code",void 0),h([f({type:Object,json:{write:!0}})],ky.prototype,"defaultValues",void 0),h([f({json:{write:!0}})],ky.prototype,"domains",void 0),h([Ce("domains")],ky.prototype,"readDomains",null),h([Ve("domains")],ky.prototype,"writeDomains",null),h([f({type:String,json:{write:!0}})],ky.prototype,"name",void 0),ky=h([I("esri.layers.support.Subtype")],ky);const U4t=ky,z4t=t=>{let e=class extends t{constructor(){super(...arguments),this.copyright=null,this.capabilities=null,this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.definitionExpression=null,this.displayField=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.globalIdField=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.indexes=new(tt.ofType(Fm)),this.isTable=!1,this.layerId=void 0,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.preferredTimeZone=null,this.relationships=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.sourceJSON=null,this.spatialReference=We.WGS84,this.subtypeField=null,this.subtypes=null,this.trackIdField=null,this.version=void 0}get authenticationTriggerEvent(){if(!this.url)return null;const{capabilities:i}=this;if(i){const{query:s,operations:n,editing:o}=i;if(!s.supportsQueryByOthers||!s.supportsQueryByAnonymous||n.supportsEditing&&!(o.supportsUpdateByOthers&&o.supportsUpdateByAnonymous&&o.supportsDeleteByOthers&&o.supportsDeleteByAnonymous))return"load"}if(this.userHasUpdateItemPrivileges){if(w4t(this))return"load";if(this.hasUpdateItemRestrictions)return i.operations.supportsQuery?"editing":"load"}if(this.userHasFullEditingPrivileges&&this.hasFullEditingRestrictions)return"editing";const r=this.editFieldsInfo;return(r!=null&&r.creatorField||r!=null&&r.editorField)&&(i!=null&&i.operations.supportsEditing)?"editing":null}readCapabilitiesFromService(i,r){return K5e(r,this.url)}readEditingInfo(i,r){const{editingInfo:s}=r;return s?{lastEditDate:s.lastEditDate!=null?new Date(s.lastEditDate):null}:null}get effectiveCapabilities(){const i=this.capabilities;if(!i)return null;const r=Q(i),{operations:s,editing:n}=r;return jk(this)?(this.userHasUpdateItemPrivileges&&(s.supportsQuery=!0),r):this.userHasUpdateItemPrivileges?(s.supportsAdd=s.supportsDelete=s.supportsEditing=s.supportsQuery=s.supportsUpdate=n.supportsDeleteByOthers=n.supportsGeometryUpdate=n.supportsUpdateByOthers=!0,r):(this.userHasFullEditingPrivileges&&s.supportsEditing&&(s.supportsAdd=s.supportsDelete=s.supportsUpdate=n.supportsGeometryUpdate=!0),r)}readGlobalIdFieldFromService(i,r){return X5e(r)}get hasFullEditingRestrictions(){const i=this.capabilities;if(!i||jk(this))return!1;const{operations:r,editing:s}=i;return r.supportsEditing&&!(r.supportsAdd&&r.supportsDelete&&r.supportsUpdate&&s.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const i=this.capabilities;if(!i)return!1;const{operations:r,editing:s}=i;return jk(this)?!r.supportsQuery:!(r.supportsAdd&&r.supportsDelete&&r.supportsEditing&&r.supportsQuery&&r.supportsUpdate&&s.supportsDeleteByOthers&&s.supportsGeometryUpdate&&s.supportsUpdateByOthers)}readIsTableFromService(i,r){return r.type==="Table"}readMaxScale(i,r){return r.effectiveMaxScale||i||0}readMinScale(i,r){return r.effectiveMinScale||i||0}readObjectIdFieldFromService(i,r){return J5e(r)}readServiceDefinitionExpression(i,r){return r.definitionQuery||r.definitionExpression}set url(i){if(i==null)return void this._set("url",i);const r=qCe({layer:this,url:i,nonStandardUrlAllowed:!0,logger:ie.getLogger(this)});this._set("url",r.url),r.layerId!=null&&this._set("layerId",r.layerId)}writeUrl(i,r,s,n){WCe(this,i,null,r,n)}readVersion(i,r){return g4t(r)}};return h([f({readOnly:!0})],e.prototype,"authenticationTriggerEvent",null),h([f({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),h([f({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),h([Ce("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),h([f(VU("dateFieldsTimeReference"))],e.prototype,"dateFieldsTimeZone",void 0),h([f({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),h([f({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),h([f({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),h([f({readOnly:!0,type:JFt})],e.prototype,"editFieldsInfo",void 0),h([f({readOnly:!0})],e.prototype,"editingInfo",void 0),h([Ce("editingInfo")],e.prototype,"readEditingInfo",null),h([f({readOnly:!0})],e.prototype,"effectiveCapabilities",null),h([f((()=>{const i=Q(B4e),r=i.json.origins;return r["web-map"]={read:!1,write:!1},r["portal-item"]={read:!1,write:!1},i})())],e.prototype,"elevationInfo",void 0),h([f({type:C4t,json:{name:"layerDefinition.floorInfo",write:!0,origins:{"web-scene":{name:"layerDefinition.floorInfo",write:{enabled:!0,layerContainerTypes:Ea}}}}})],e.prototype,"floorInfo",void 0),h([f({type:gi,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),h([f()],e.prototype,"gdbVersion",void 0),h([f({readOnly:!0,type:E4t,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),h([f({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:oK.read}}}})],e.prototype,"geometryType",void 0),h([f({type:String})],e.prototype,"globalIdField",void 0),h([Ce("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),h([f({readOnly:!0})],e.prototype,"hasFullEditingRestrictions",null),h([f({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),h([f({readOnly:!0})],e.prototype,"hasUpdateItemRestrictions",null),h([f({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),h([f({readOnly:!0,type:gT})],e.prototype,"heightModelInfo",void 0),h([f({type:Date})],e.prototype,"historicMoment",void 0),h([f({type:tt.ofType(Fm),readOnly:!0})],e.prototype,"indexes",void 0),h([f({readOnly:!0})],e.prototype,"isTable",void 0),h([Ce("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),h([f({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),h([f(wDt)],e.prototype,"maxScale",void 0),h([Ce("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),h([f(bDt)],e.prototype,"minScale",void 0),h([Ce("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),h([f({type:String})],e.prototype,"objectIdField",void 0),h([Ce("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),h([f(VU("preferredTimeReference"))],e.prototype,"preferredTimeZone",void 0),h([f({type:[M4t],readOnly:!0})],e.prototype,"relationships",void 0),h([f({type:Boolean})],e.prototype,"returnM",void 0),h([f({type:Boolean})],e.prototype,"returnZ",void 0),h([f({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),h([f({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),h([Ce("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),h([f({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),h([f()],e.prototype,"sourceJSON",void 0),h([f({type:We,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),h([f({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),h([f({type:[U4t],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"subtypes",void 0),h([f({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),h([f(z4e)],e.prototype,"url",null),h([Ve("url")],e.prototype,"writeUrl",null),h([f({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),h([Ce("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=h([I("esri.layers.mixins.FeatureLayerBase")],e),e};let jE=class extends Kr(ye){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};h([f({type:String,json:{write:!0}})],jE.prototype,"expression",void 0),h([f({type:String,json:{write:!0}})],jE.prototype,"title",void 0),h([f({type:String,json:{write:!0}})],jE.prototype,"returnType",void 0),jE=h([I("esri.layers.support.ExpressionInfo")],jE);const qne=jE;var lK;let Uy=lK=class extends ye{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new lK({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:Q(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};h([f({type:Boolean,json:{write:!0}})],Uy.prototype,"isAutoGenerated",void 0),h([f({type:String,json:{write:!0}})],Uy.prototype,"name",void 0),h([f({type:String,json:{write:!0}})],Uy.prototype,"alias",void 0),h([f({type:String,json:{write:!0}})],Uy.prototype,"onStatisticField",void 0),h([f({type:qne,json:{write:!0}})],Uy.prototype,"onStatisticExpression",void 0),h([f({type:String,json:{write:!0}})],Uy.prototype,"statisticType",void 0),Uy=lK=h([I("esri.layers.support.AggregateField")],Uy);const uT=Uy;let y1=class extends ye{constructor(){super(...arguments),this.type=null}};h([f({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],y1.prototype,"type",void 0),y1=h([I("esri.layers.support.FeatureReduction")],y1);var cK;let _v=cK=class extends ye{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?_X(e.value):t}writeExpression(t,e,i){this.value!=null&&(t=_X(this.value)),t!=null&&(e[i]=t)}clone(){return new cK({expression:this.expression,title:this.title,value:this.value})}};h([f({type:String,json:{write:{writerEnsuresNonNull:!0}}})],_v.prototype,"expression",void 0),h([Ce("expression",["expression","value"])],_v.prototype,"readExpression",null),h([Ve("expression")],_v.prototype,"writeExpression",null),h([f({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],_v.prototype,"title",void 0),h([f({json:{read:!1,write:!1}})],_v.prototype,"value",void 0),_v=cK=h([I("esri.layers.support.LabelExpressionInfo")],_v);const eke=_v;var uK;const p4=new qi({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function f4(t,e,i){return{enabled:!OTe(i==null?void 0:i.layer)}}function tke(t){var e;return!t||t.origin!=="service"&&((e=t.layer)==null?void 0:e.type)!=="map-image"}function V4t(t){return(t==null?void 0:t.type)==="map-image"}function ike(t){var e,i;return!!V4t(t)&&!!((i=(e=t.capabilities)==null?void 0:e.exportMap)!=null&&i.supportsArcadeExpressionForLabeling)}function B4t(t){return tke(t)||ike(t==null?void 0:t.layer)}let kn=uK=class extends ye{static evaluateWhere(t,e){const i=(r,s,n)=>{switch(s){case"=":return r==n;case"<>":return r!=n;case">":return r>n;case">=":return r>=n;case"<":return r<n;case"<=":return r<=n}return!1};try{if(t==null)return!0;const r=t.split(" ");if(r.length===3)return i(e[r[0]],r[1],r[2]);if(r.length===7){const s=i(e[r[0]],r[1],r[2]),n=r[3],o=i(e[r[4]],r[5],r[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=ivt,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const i=e.labelExpressionInfo;if(!i||!i.value&&!i.expression)return t}writeLabelExpression(t,e,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=aht(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=dre(this.labelExpressionInfo.expression);r&&(t="["+r+"]")}}t!=null&&(e[i]=t)}writeLabelExpressionInfo(t,e,i,r){if(t==null&&this.labelExpression!=null&&tke(r))t=new eke({expression:this.getLabelExpressionArcade()});else if(!t)return;const s=t.toJSON(r);s.expression&&(e[i]=s)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return qG(this)}getLabelExpressionArcade(){return lht(this)}getLabelExpressionSingleField(){return cht(this)}hash(){return JSON.stringify(this)}clone(){return new uK({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:Q(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:Q(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};h([f({type:String,json:{write:!0}})],kn.prototype,"name",void 0),h([f({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:f4}}}}})],kn.prototype,"allowOverrun",void 0),h([f({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:f4}}}}})],kn.prototype,"deconflictionStrategy",void 0),h([f({type:String,json:{write:{overridePolicy(t,e,i){return this.labelExpressionInfo&&(i==null?void 0:i.origin)==="service"&&ike(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],kn.prototype,"labelExpression",void 0),h([Ce("labelExpression")],kn.prototype,"readLabelExpression",null),h([Ve("labelExpression")],kn.prototype,"writeLabelExpression",null),h([f({type:eke,json:{write:{overridePolicy:(t,e,i)=>B4t(i)?{allowNull:!0}:{enabled:!1}}}})],kn.prototype,"labelExpressionInfo",void 0),h([Ve("labelExpressionInfo")],kn.prototype,"writeLabelExpressionInfo",null),h([f({type:p4.apiValues,json:{type:p4.jsonValues,read:p4.read,write:p4.write}})],kn.prototype,"labelPlacement",void 0),h([f({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],kn.prototype,"labelPosition",void 0),h([f({type:Number})],kn.prototype,"maxScale",void 0),h([Ve("maxScale")],kn.prototype,"writeMaxScale",null),h([f({type:Number})],kn.prototype,"minScale",void 0),h([Ve("minScale")],kn.prototype,"writeMinScale",null),h([f({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:f4}}}}})],kn.prototype,"repeatLabel",void 0),h([f({type:Number,cast:pr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:f4}}}}})],kn.prototype,"repeatLabelDistance",void 0),h([f({types:WKe,json:{origins:{"web-scene":{types:YKe,write:Ome,default:null}},write:Ome,default:null}})],kn.prototype,"symbol",void 0),h([f({type:Boolean,json:{write:!0}})],kn.prototype,"useCodedValues",void 0),h([f({type:String,json:{write:!0}})],kn.prototype,"where",void 0),kn=uK=h([I("esri.layers.support.LabelClass")],kn);const Nj=kn;var hK;let Sl=hK=class extends y1{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=null,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.size=pr("12px"),this.fields=[],this.renderer=null}writeFields(t,e,i){const r=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());kl(i,r,e)}readRenderer(t,e,i){var s;const r=(s=e.drawingInfo)==null?void 0:s.renderer;return r?$3(r,e,i)??void 0:Hne(e,i)}clone(){return new hK({fields:Q(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:Q(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:Q(this.popupTemplate),renderer:Q(this.renderer),binType:Q(this.binType),size:this.size})}};h([ct({binning:"binning"})],Sl.prototype,"type",void 0),h([ct({geohash:"geohash",square:"square"}),f({type:["geohash","square"]})],Sl.prototype,"binType",void 0),h([f({type:Number,json:{write:!0}})],Sl.prototype,"fixedBinLevel",void 0),h([f({type:[Nj],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Sl.prototype,"labelingInfo",void 0),h([f(Sne)],Sl.prototype,"labelsVisible",void 0),h([f({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Sl.prototype,"maxScale",void 0),h([f(Oj)],Sl.prototype,"popupEnabled",void 0),h([f({type:GA,json:{name:"popupInfo",write:!0}})],Sl.prototype,"popupTemplate",void 0),h([f({type:Number,cast:t=>t==="auto"?t:pr(t)})],Sl.prototype,"size",void 0),h([f({type:[uT],json:{write:!0}})],Sl.prototype,"fields",void 0),h([Ve("fields")],Sl.prototype,"writeFields",null),h([f({types:Dj,json:{write:{target:"drawingInfo.renderer"}}})],Sl.prototype,"renderer",void 0),h([Ce("renderer",["drawingInfo.renderer"])],Sl.prototype,"readRenderer",null),Sl=hK=h([I("esri.layers.support.FeatureReductionBinning")],Sl);const rke=Sl;var dK;function Q_e(t){var e;return t.type==="simple"&&!((e=t.visualVariables)!=null&&e.length)}let To=dK=class extends ye{constructor(t){super(t),this.type="cluster",this.clusterRadius=pr("80px"),this.clusterMinSize=pr("12px"),this.clusterMaxSize=pr("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=[]}readRenderer(t,e,i){var s,n;const r=(s=e.drawingInfo)==null?void 0:s.renderer;return(n=r==null?void 0:r.authoringInfo)!=null&&n.isAutoGenerated?null:r?Q_e(r)?null:$3(r,e,i)??void 0:Hne(e,i)}readSymbol(t,e,i){var s,n;const r=(s=e.drawingInfo)==null?void 0:s.renderer;if((n=r==null?void 0:r.authoringInfo)!=null&&n.isAutoGenerated)return null;if(r&&Q_e(r)){const o=$3(r,e,i);return o==null?void 0:o.symbol}return null}writeSymbol(t,e,i,r){var n,o;const s=(o=(n=this.renderer)==null?void 0:n.authoringInfo)==null?void 0:o.isAutoGenerated;if(!this.renderer||s){const a=new aP({symbol:t});e.drawingInfo={renderer:a.write({},r)}}}writeFields(t,e,i){const r=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());kl(i,r,e)}readFields(t,e,i){return t.filter(r=>!r.isAutoGenerated).map(r=>uT.fromJSON(r))}clone(){return new dK({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:Q(this.labelingInfo),labelsVisible:this.labelsVisible,fields:Q(this.fields),maxScale:this.maxScale,renderer:Q(this.renderer),symbol:Q(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:Q(this.popupTemplate)})}};h([f({type:["cluster"],readOnly:!0,json:{write:!0}})],To.prototype,"type",void 0),h([f({type:Number,cast:t=>t==="auto"?t:pr(t),json:{write:!0}})],To.prototype,"clusterRadius",void 0),h([f({type:Number,cast:pr,json:{write:!0}})],To.prototype,"clusterMinSize",void 0),h([f({type:Number,cast:pr,json:{write:!0}})],To.prototype,"clusterMaxSize",void 0),h([f({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],To.prototype,"maxScale",void 0),h([f(Oj)],To.prototype,"popupEnabled",void 0),h([f({type:GA,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],To.prototype,"popupTemplate",void 0),h([f({types:Dj,json:{write:{target:"drawingInfo.renderer"}}})],To.prototype,"renderer",void 0),h([Ce("renderer",["drawingInfo.renderer"])],To.prototype,"readRenderer",null),h([f({types:HKe})],To.prototype,"symbol",void 0),h([Ce("symbol",["drawingInfo.renderer"])],To.prototype,"readSymbol",null),h([Ve("symbol")],To.prototype,"writeSymbol",null),h([f({type:[Nj],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],To.prototype,"labelingInfo",void 0),h([f(Sne)],To.prototype,"labelsVisible",void 0),h([f({type:[uT],json:{write:!0}})],To.prototype,"fields",void 0),h([Ve("fields")],To.prototype,"writeFields",null),h([Ce("fields")],To.prototype,"readFields",null),To=dK=h([I("esri.layers.support.FeatureReductionCluster")],To);const ske=To;var pK;let Hk=pK=class extends y1{constructor(t){super(t),this.type="selection"}clone(){return new pK}};h([f({type:["selection"]})],Hk.prototype,"type",void 0),Hk=pK=h([I("esri.layers.support.FeatureReductionSelection")],Hk);const K_e=Hk,eve={key:"type",base:y1,typeMap:{cluster:ske,binning:rke}},G4t={types:{key:"type",base:y1,typeMap:{selection:K_e,cluster:ske,binning:rke}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:eve},"portal-item":{types:eve},"web-scene":{types:{key:"type",base:y1,typeMap:{selection:K_e}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:Ea}}}}},W2={Base64:0,Hex:1,String:2,Raw:3},vM=8,nke=(1<<vM)-1;function Qv(t,e){const i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function j4t(t){const e=[];for(let i=0,r=t.length*vM;i<r;i+=vM)e[i>>5]|=(t.charCodeAt(i/vM)&nke)<<i%32;return e}function H4t(t){const e=[];for(let i=0,r=32*t.length;i<r;i+=vM)e.push(String.fromCharCode(t[i>>5]>>>i%32&nke));return e.join("")}function q4t(t){const e="0123456789abcdef",i=[];for(let r=0,s=4*t.length;r<s;r++)i.push(e.charAt(t[r>>2]>>r%4*8+4&15)+e.charAt(t[r>>2]>>r%4*8&15));return i.join("")}function W4t(t){const e="=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[];for(let s=0,n=4*t.length;s<n;s+=3){const o=(t[s>>2]>>s%4*8&255)<<16|(t[s+1>>2]>>(s+1)%4*8&255)<<8|t[s+2>>2]>>(s+2)%4*8&255;for(let a=0;a<4;a++)8*s+6*a>32*t.length?r.push(e):r.push(i.charAt(o>>6*(3-a)&63))}return r.join("")}function Y4t(t,e){return t<<e|t>>>32-e}function Fj(t,e,i,r,s,n){return Qv(Y4t(Qv(Qv(e,t),Qv(r,n)),s),i)}function ml(t,e,i,r,s,n,o){return Fj(e&i|~e&r,t,e,s,n,o)}function gl(t,e,i,r,s,n,o){return Fj(e&r|i&~r,t,e,s,n,o)}function yl(t,e,i,r,s,n,o){return Fj(e^i^r,t,e,s,n,o)}function _l(t,e,i,r,s,n,o){return Fj(i^(e|~r),t,e,s,n,o)}function Z4t(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let i=1732584193,r=-271733879,s=-1732584194,n=271733878;for(let o=0;o<t.length;o+=16){const a=i,l=r,c=s,u=n;i=ml(i,r,s,n,t[o],7,-680876936),n=ml(n,i,r,s,t[o+1],12,-389564586),s=ml(s,n,i,r,t[o+2],17,606105819),r=ml(r,s,n,i,t[o+3],22,-1044525330),i=ml(i,r,s,n,t[o+4],7,-176418897),n=ml(n,i,r,s,t[o+5],12,1200080426),s=ml(s,n,i,r,t[o+6],17,-1473231341),r=ml(r,s,n,i,t[o+7],22,-45705983),i=ml(i,r,s,n,t[o+8],7,1770035416),n=ml(n,i,r,s,t[o+9],12,-1958414417),s=ml(s,n,i,r,t[o+10],17,-42063),r=ml(r,s,n,i,t[o+11],22,-1990404162),i=ml(i,r,s,n,t[o+12],7,1804603682),n=ml(n,i,r,s,t[o+13],12,-40341101),s=ml(s,n,i,r,t[o+14],17,-1502002290),r=ml(r,s,n,i,t[o+15],22,1236535329),i=gl(i,r,s,n,t[o+1],5,-165796510),n=gl(n,i,r,s,t[o+6],9,-1069501632),s=gl(s,n,i,r,t[o+11],14,643717713),r=gl(r,s,n,i,t[o],20,-373897302),i=gl(i,r,s,n,t[o+5],5,-701558691),n=gl(n,i,r,s,t[o+10],9,38016083),s=gl(s,n,i,r,t[o+15],14,-660478335),r=gl(r,s,n,i,t[o+4],20,-405537848),i=gl(i,r,s,n,t[o+9],5,568446438),n=gl(n,i,r,s,t[o+14],9,-1019803690),s=gl(s,n,i,r,t[o+3],14,-187363961),r=gl(r,s,n,i,t[o+8],20,1163531501),i=gl(i,r,s,n,t[o+13],5,-1444681467),n=gl(n,i,r,s,t[o+2],9,-51403784),s=gl(s,n,i,r,t[o+7],14,1735328473),r=gl(r,s,n,i,t[o+12],20,-1926607734),i=yl(i,r,s,n,t[o+5],4,-378558),n=yl(n,i,r,s,t[o+8],11,-2022574463),s=yl(s,n,i,r,t[o+11],16,1839030562),r=yl(r,s,n,i,t[o+14],23,-35309556),i=yl(i,r,s,n,t[o+1],4,-1530992060),n=yl(n,i,r,s,t[o+4],11,1272893353),s=yl(s,n,i,r,t[o+7],16,-155497632),r=yl(r,s,n,i,t[o+10],23,-1094730640),i=yl(i,r,s,n,t[o+13],4,681279174),n=yl(n,i,r,s,t[o],11,-358537222),s=yl(s,n,i,r,t[o+3],16,-722521979),r=yl(r,s,n,i,t[o+6],23,76029189),i=yl(i,r,s,n,t[o+9],4,-640364487),n=yl(n,i,r,s,t[o+12],11,-421815835),s=yl(s,n,i,r,t[o+15],16,530742520),r=yl(r,s,n,i,t[o+2],23,-995338651),i=_l(i,r,s,n,t[o],6,-198630844),n=_l(n,i,r,s,t[o+7],10,1126891415),s=_l(s,n,i,r,t[o+14],15,-1416354905),r=_l(r,s,n,i,t[o+5],21,-57434055),i=_l(i,r,s,n,t[o+12],6,1700485571),n=_l(n,i,r,s,t[o+3],10,-1894986606),s=_l(s,n,i,r,t[o+10],15,-1051523),r=_l(r,s,n,i,t[o+1],21,-2054922799),i=_l(i,r,s,n,t[o+8],6,1873313359),n=_l(n,i,r,s,t[o+15],10,-30611744),s=_l(s,n,i,r,t[o+6],15,-1560198380),r=_l(r,s,n,i,t[o+13],21,1309151649),i=_l(i,r,s,n,t[o+4],6,-145523070),n=_l(n,i,r,s,t[o+11],10,-1120210379),s=_l(s,n,i,r,t[o+2],15,718787259),r=_l(r,s,n,i,t[o+9],21,-343485551),i=Qv(i,a),r=Qv(r,l),s=Qv(s,c),n=Qv(n,u)}return[i,r,s,n]}function oke(t,e=W2.Hex){const i=e||W2.Base64,r=Z4t(j4t(t),t.length*vM);switch(i){case W2.Raw:return r;case W2.Hex:return q4t(r);case W2.String:return H4t(r);case W2.Base64:return W4t(r)}}const X4t=()=>ie.getLogger("esri.views.2d.layers.support.clusterUtils");re.add("esri-cluster-arcade-enabled",!0);const J4t=re("esri-cluster-arcade-enabled"),Q4t=new Set(["simple-line","simple-fill","picture-fill"]);function tve(t,e){let i=e.clone();if(!K4t(i))return i;if(e.getSymbols().some(r=>Q4t.has(r.type))&&(i=new aP({symbol:new kf})),i.authoringInfo||(i.authoringInfo=new Dne),i.authoringInfo.isAutoGenerated=!0,"visualVariables"in i){const r=(i.visualVariables||[]).filter(s=>s.valueExpression!=="$view.scale");r.forEach(s=>{s.type==="rotation"?s.field?s.field=mw(t,s.field,"avg_angle","number"):s.valueExpression&&(s.field=_O(t,s.valueExpression,"avg_angle","number"),s.valueExpression=null):s.normalizationField?(s.field=mw(t,s.field,"avg_norm","number",s.normalizationField),s.normalizationField=null):s.field?s.field=mw(t,s.field,"avg","number"):s.valueExpression&&(s.field=_O(t,s.valueExpression,"avg","number"),s.valueExpression=null)}),i.visualVariables=r}switch(i.type){case"simple":break;case"pie-chart":for(const r of i.attributes)r.field?r.field=mw(t,r.field,"sum","number"):r.valueExpression&&(r.field=_O(t,r.valueExpression,"sum","number"),r.valueExpression=null);break;case"unique-value":i.field?i.field=mw(t,i.field,"mode","string"):i.valueExpression&&(i.field=_O(t,i.valueExpression,"mode","string"),i.valueExpression=null);break;case"class-breaks":i.normalizationField?(i.field=mw(t,i.field,"avg_norm","number",i.normalizationField),i.normalizationField=null):i.field?i.field=mw(t,i.field,"avg","number"):i.valueExpression&&(i.field=_O(t,i.valueExpression,"avg","number"),i.valueExpression=null)}return i}const K4t=t=>{const e=i=>X4t().error(new V("Unsupported-renderer",i,{renderer:t}));if(!t)return!1;switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const i=t.normalizationType;if(i!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${i}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!J4t){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(i=>!(!("valueExpression"in i)||!i.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function e5t(t,e,i){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const r=i,s="field",n=e.toLowerCase()+",norm:"+s+","+r.toLowerCase();return"cluster_avg_"+oke(n)}}}function _O(t,e,i,r){const s=oke(e),n=i==="mode"?`cluster_type_${s}`:i==="sum"?`cluster_sum_${s}`:`cluster_avg_${s}`;return t.some(o=>o.name===n)||t.push(new uT({name:n,isAutoGenerated:!0,onStatisticExpression:new qne({expression:e,returnType:r}),statisticType:i})),n}function mw(t,e,i,r,s){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const n=e5t(i,e,s);return t.some(o=>o.name===n)||(i==="avg_norm"?t.push(new uT({name:n,isAutoGenerated:!0,onStatisticExpression:new qne({expression:`$feature.${e} / $feature.${s}`,returnType:r}),statisticType:"avg"})):t.push(new uT({name:n,isAutoGenerated:!0,onStatisticField:e,statisticType:i}))),n}const t5t=t=>{let e=class extends t{constructor(...i){super(...i),this.addHandles(ue(()=>this.renderer,()=>{if(this.featureReduction){const r=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",r)}},ar))}set featureReduction(i){const r=this._normalizeFeatureReduction(i);this._set("featureReduction",r)}set renderer(i){}_withClusterVariable(i,r,s){const n=i.clone();return"visualVariables"in n&&(n.visualVariables||(n.visualVariables=[]),n.visualVariables.some(o=>o.type==="size")||n.visualVariables.push(new Nne({field:"cluster_count",stops:[new Pk({value:1}),new Pk({useMinValue:!0,size:r}),new Pk({useMaxValue:!0,size:s})]}))),n}_normalizeFeatureReduction(i){var d;if((i==null?void 0:i.type)!=="cluster")return i;const r=i.clone(),s=[new uT({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=(r.fields??[]).filter(p=>!p.isAutoGenerated),o=i.renderer&&!((d=i.renderer.authoringInfo)!=null&&d.isAutoGenerated),{clusterMinSize:a,clusterMaxSize:l}=r;if(o){r.fields=[...s,...n];const p=this._withClusterVariable(r.renderer,a,l);return r.effectiveFeatureRenderer=p,r.effectiveClusterRenderer=p,r}if(i.symbol){if(r.fields=[...s,...n],r.renderer=null,!this.renderer)return r.effectiveFeatureRenderer=null,r.effectiveClusterRenderer=null,r;const p=tve(s,this.renderer),m=this._withClusterVariable(p,a,l),g="visualVariables"in m&&m.visualVariables?m.visualVariables:[],y=new aP({symbol:i.symbol,visualVariables:g});return r.fields=[...s,...n],r.effectiveFeatureRenderer=m,r.effectiveClusterRenderer=y,r}if(!this.renderer)return i;const c=tve(s,this.renderer);r.fields=[...s,...n],r.renderer=c;const u=this._withClusterVariable(c,a,l);return r.effectiveFeatureRenderer=u,r.effectiveClusterRenderer=u,r}};return h([f(G4t)],e.prototype,"featureReduction",null),e=h([I("esri.layers.mixins.FeatureReductionLayer")],e),e};var fK;const m4=new qi({asc:"ascending",desc:"descending"});let HE=fK=class extends ye{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new fK({field:this.field,valueExpression:this.valueExpression,order:this.order})}};h([f({type:String,json:{write:!0}})],HE.prototype,"field",void 0),h([f({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],HE.prototype,"valueExpression",void 0),h([f({type:m4.apiValues,json:{type:m4.jsonValues,read:m4.read,write:m4.write}})],HE.prototype,"order",void 0),HE=fK=h([I("esri.layers.support.OrderByInfo")],HE);const ake=HE;function i5t(t,e,i){if(!t)return null;const r=t.find(n=>!!n.field);if(!r)return null;const s=new ake;return s.read(r,i),[s]}function r5t(t,e,i,r){const s=t.find(n=>!!n.field);s&&kl(i,[s.toJSON()],e)}const s5t={type:[ake],json:{origins:{"web-scene":{write:!1,read:!1}},name:"layerDefinition.orderBy",read:{reader:i5t},write:{writer:r5t}}},n5t=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return h([f(s5t)],e.prototype,"orderBy",void 0),e=h([I("esri.layers.mixins.OrderedLayer")],e),e};let b$=class extends Re{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};h([f()],b$.prototype,"updating",void 0),h([f()],b$.prototype,"status",void 0),b$=h([I("esri.layers.support.PublishingInfo")],b$);const o5t=b$,a5t=Symbol(),l5t=t=>{var e;let i=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const r=this._get("publishingInfo");if(r)return r;const s=new o5t;return this._checkPublishingStatus(s),s}_checkPublishingStatus(r){let o=0;const a=async c=>{let u;r.updating=!0;try{u=await this.fetchPublishingStatus()}catch{u="unavailable"}u!=="published"&&u!=="unavailable"||(r.status==="publishing"&&this.refresh(),l.remove()),r.status=u,r.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.addHandles(l)}};return e=a5t,h([f({readOnly:!0,clonable:!1})],i.prototype,"publishingInfo",null),i=h([I("esri.layers.mixins.PublishableLayer")],i),i},Kv=new tt,MI=new WeakMap;function c5t(t){h5t(t)&&Kv.push(new WeakRef(t))}function u5t(t){const e=Kv.find(i=>i.deref()===t);e&&Kv.remove(e)}function h5t(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function lke(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:lke(e,t%e):0}let c9=0,g4=0;function d5t(){const t=Date.now();let e=!1;for(const i of Kv){const r=i.deref();r?r.refreshInterval&&t-(MI.get(r)??0)+5>=6e4*r.refreshInterval&&(MI.set(r,t),r.refresh(t)):e=!0}if(e)for(let i=Kv.length-1;i>=0;i--)Kv.at(i).deref()||Kv.removeAt(i)}z1e(()=>{const t=Date.now();let e=0;for(const i of Kv){const r=i.deref();r&&(e=lke(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?MI.get(r)||MI.set(r,t):MI.delete(r))}if(e!==g4){if(g4=e,clearInterval(c9),g4===0)return void(c9=0);c9=setInterval(d5t,g4)}});function Xsi(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const ive=.1,p5t=t=>{let e=class extends t{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=eB(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||c5t(this)},()=>{})}destroy(){u5t(this)}castRefreshInterval(i){return i>=ive?i:i<=0?0:ive}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){OI(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{ie.getLogger(this).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}get test(){}};return h([f({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:Ea}}}}})],e.prototype,"refreshInterval",void 0),h([Li("refreshInterval")],e.prototype,"castRefreshInterval",null),h([f({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),h([f({readOnly:!0})],e.prototype,"refreshParameters",null),e=h([I("esri.layers.mixins.RefreshableLayer")],e),e},cke=Bl()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let w$=class extends Kr(ye){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return wEe(this.value,this.unit,"milliseconds")}};h([ct(cke,{nonNullable:!0})],w$.prototype,"unit",void 0),h([f({type:Number,json:{write:!0},nonNullable:!0})],w$.prototype,"value",void 0),w$=h([I("esri.TimeInterval")],w$);const UV=w$;function rve(t,e){return UV.fromJSON({value:t,unit:e})}let Na=class extends Kr(ye){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(e,i){return i.timeExtent&&Array.isArray(i.timeExtent)&&i.timeExtent.length===2?Sg.fromArray(i.timeExtent):null}writeFullTimeExtent(e,i){(e==null?void 0:e.start)!=null&&e.end!=null?i.timeExtent=e.toArray():i.timeExtent=null}readInterval(e,i){return i.timeInterval&&i.timeIntervalUnits?rve(i.timeInterval,i.timeIntervalUnits):i.defaultTimeInterval&&i.defaultTimeIntervalUnits?rve(i.defaultTimeInterval,i.defaultTimeIntervalUnits):null}writeInterval(e,i){i.timeInterval=(e==null?void 0:e.toJSON().value)??null,i.timeIntervalUnits=(e==null?void 0:e.toJSON().unit)??null}};h([f({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],Na.prototype,"cumulative",void 0),h([f({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],Na.prototype,"endField",void 0),h([f({type:Sg,json:{write:{enabled:!0,allowNull:!0}}})],Na.prototype,"fullTimeExtent",void 0),h([Ce("fullTimeExtent",["timeExtent"])],Na.prototype,"readFullTimeExtent",null),h([Ve("fullTimeExtent")],Na.prototype,"writeFullTimeExtent",null),h([f({type:Boolean,json:{write:!0}})],Na.prototype,"hasLiveData",void 0),h([f({type:UV,json:{write:{enabled:!0,allowNull:!0}}})],Na.prototype,"interval",void 0),h([Ce("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Na.prototype,"readInterval",null),h([Ve("interval")],Na.prototype,"writeInterval",null),h([f({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],Na.prototype,"startField",void 0),h([f(VU("timeReference",!0))],Na.prototype,"timeZone",void 0),h([f({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Na.prototype,"trackIdField",void 0),h([f({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],Na.prototype,"useTime",void 0),h([f({type:[Date],json:{read:!1}})],Na.prototype,"stops",void 0),Na=h([I("esri.layers.support.TimeInfo")],Na);const uke=Na,f5t={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:Ea}}},m5t=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const s=r.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=cke.fromJSON(s.timeOffsetUnits);return n&&o?new UV({value:n,unit:o}):null}set timeInfo(i){REe(i,this.fieldsIndex),this._set("timeInfo",i)}};return h([f({type:Sg,json:{write:!1}})],e.prototype,"timeExtent",void 0),h([f({type:UV})],e.prototype,"timeOffset",void 0),h([Ce("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),h([f({value:null,type:uke,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),h([f(f5t)],e.prototype,"useViewTime",void 0),e=h([I("esri.layers.mixins.TemporalLayer")],e),e},sve=new qi({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let vv=class extends Kr(ye){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};h([f({json:{write:!0}})],vv.prototype,"name",void 0),h([f({json:{write:!0}})],vv.prototype,"description",void 0),h([f({json:{read:sve.read,write:sve.write}})],vv.prototype,"drawingTool",void 0),h([f({json:{write:!0}})],vv.prototype,"prototype",void 0),h([f({json:{write:!0}})],vv.prototype,"thumbnail",void 0),vv=h([I("esri.layers.support.FeatureTemplate")],vv);const Wne=vv;let zy=class extends Kr(ye){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const i={};for(const r of Object.keys(e))i[r]=hG(e[r]);return i}writeDomains(e,i){var s;const r={};for(const n of Object.keys(e))e[n]&&(r[n]=(s=e[n])==null?void 0:s.toJSON());i.domains=r}};h([f({json:{write:!0}})],zy.prototype,"id",void 0),h([f({json:{write:!0}})],zy.prototype,"name",void 0),h([f({json:{write:!0}})],zy.prototype,"domains",void 0),h([Ce("domains")],zy.prototype,"readDomains",null),h([Ve("domains")],zy.prototype,"writeDomains",null),h([f({type:[Wne],json:{write:!0}})],zy.prototype,"templates",void 0),zy=h([I("esri.layers.support.FeatureType")],zy);const hke=zy;function dke(){return{fields:{type:[dG],value:null,set:function(t){if(t&&re("big-integer-warning-enabled")){const e=t.filter(i=>i.type==="big-integer"||i.type==="oid"&&(i.length||0)>=8);if(e.length){const i=e.map(r=>`'${r.name}'`).join(", ");ie.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${i}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",t)}},fieldsIndex:{readOnly:!0,get(){return kne.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){var e;const t=this._userOutFields;if(!(t!=null&&t.length))return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const i of t)((e=this.fieldsIndex)==null?void 0:e.has(i))||ie.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${i} found in outFields`,{layer:this,outFields:t});return sG(this.fieldsIndex,t)}}}}const u9=()=>ie.getLogger("esri.layers.support.labelingInfo"),g5t=/\[([^[\]]+)\]/gi;function h9(t,e,i){return t?t.map(r=>{var n;const s=new Nj;if(s.read(r,i),s.labelExpression){const o=e.fields||((n=e.layerDefinition)==null?void 0:n.fields)||this.fields;s.labelExpression=s.labelExpression.replaceAll(g5t,(a,l)=>`[${y5t(l,o)}]`)}return s}):null}function y5t(t,e){if(!e)return t;const i=t.toLowerCase();for(let r=0;r<e.length;r++){const s=e[r].name;if(s.toLowerCase()===i)return s}return t}const _5t={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along","above-along","below-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};function tni(t,e){const i=[];for(const r of t){const s=r.labelPlacement,n=_5t[e];if(!r.symbol)return u9().warn("No ILabelClass symbol specified."),[];if(!n)return u9().error(new V("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),[];if(n.includes(s))i.push(r);else{const o=n[0];s&&u9().warn(`Found invalid label placement type ${s} for ${e}. Defaulting to ${o}`);const a=r.clone();a.labelPlacement=o,i.push(a)}}return i}const qE=[];function v5t(t,e){if(HCe(t.url??""))return!0;const{wkid:i}=e;for(const r of qE){if((t.version??0)>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}qE.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=23301;e<=23333;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102934;e<=102955;e++)t.add(e);return t}]),qE.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),qE.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),qE.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),qE.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]);async function b5t(t,e,i){const r=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const s=await Vd(r.populateFromStyle());if(Et(i),s.ok===!1){const n=s.error;e!=null&&e.messages&&e.messages.push(new Sf("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:e})),t.clear("renderer",e==null?void 0:e.origin)}}}var mK;let WE=mK=class extends ye{constructor(t){super(t),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new mK({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};h([f({type:[String],json:{write:!0}})],WE.prototype,"groupByFields",void 0),h([f({type:Number,json:{write:!0}})],WE.prototype,"topCount",void 0),h([f({type:[String],json:{write:!0}})],WE.prototype,"orderByFields",void 0),WE=mK=h([I("esri.rest.support.TopFilter")],WE);const w5t=WE;var gK;const nve=new qi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),ove=new qi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Gs=gK=class extends ye{constructor(t){super(t),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new gK(Q({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};h([f({type:Boolean,json:{write:!0}})],Gs.prototype,"cacheHint",void 0),h([f({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],Gs.prototype,"distance",void 0),h([f({types:fT,json:{read:C1,write:!0}})],Gs.prototype,"geometry",void 0),h([f({type:Number,json:{write:!0}})],Gs.prototype,"geometryPrecision",void 0),h([f({type:Number,json:{write:!0}})],Gs.prototype,"maxAllowableOffset",void 0),h([f({type:Number,json:{read:{source:"resultRecordCount"}}})],Gs.prototype,"num",void 0),h([f({json:{write:!0}})],Gs.prototype,"objectIds",void 0),h([f({type:[String],json:{write:!0}})],Gs.prototype,"orderByFields",void 0),h([f({type:[String],json:{write:!0}})],Gs.prototype,"outFields",void 0),h([f({type:We,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Gs.prototype,"outSpatialReference",void 0),h([f({type:String,json:{write:!0}})],Gs.prototype,"resultType",void 0),h([f({json:{write:!0}})],Gs.prototype,"returnGeometry",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Gs.prototype,"returnM",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Gs.prototype,"returnZ",void 0),h([f({type:Number,json:{read:{source:"resultOffset"}}})],Gs.prototype,"start",void 0),h([Ve("start"),Ve("num")],Gs.prototype,"writeStart",null),h([f({type:String,json:{read:{source:"spatialRel",reader:nve.read},write:{target:"spatialRel",writer:nve.write}}})],Gs.prototype,"spatialRelationship",void 0),h([f({type:Sg,json:{write:!0}})],Gs.prototype,"timeExtent",void 0),h([f({type:w5t,json:{write:!0}})],Gs.prototype,"topFilter",void 0),h([f({type:String,json:{read:ove.read,write:{writer:ove.write,overridePolicy(t){return{enabled:t!=null&&this.distance!=null&&this.distance>0}}}}})],Gs.prototype,"units",void 0),h([f({type:String,json:{write:!0}})],Gs.prototype,"where",void 0),Gs=gK=h([I("esri.rest.support.TopFeaturesQuery")],Gs),Gs.from=Ln(Gs);const y4=Gs;function pke({displayField:t,editFieldsInfo:e,fields:i,objectIdField:r,title:s},n){if(!i)return null;const o=E5t({editFieldsInfo:e,fields:i,objectIdField:r},n);if(!o.length)return null;const a=A5t({titleBase:s,fields:i,displayField:t}),l=M5t();return new GA({title:a,content:l,fieldInfos:o})}const x5t=(t,e)=>e.visibleFieldNames?e.visibleFieldNames.has(t.name):_Qe(t,e);function S5t(t,e){const i=t;return e&&(t=t.filter(r=>!e.includes(r.type))),t===i&&(t=t.slice()),t.sort(T5t),t}function T5t(t,e){return t.type==="oid"?-1:e.type==="oid"?1:ave(t)?-1:ave(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function E5t(t,e){const i=e==null?void 0:e.visibleFieldNames;return S5t(t.fields??[],(e==null?void 0:e.ignoreFieldTypes)||P5t).map(r=>new Fte({fieldName:r.name,isEditable:yQe(r,t),label:r.alias,format:C5t(r),visible:x5t(r,{...t,visibleFieldNames:i})}))}function C5t(t){switch(t.type){case"small-integer":case"integer":case"single":return new K4({digitSeparator:!0,places:0});case"double":return new K4({digitSeparator:!0,places:2});case"string":return BQe(t.name)?new K4({digitSeparator:!0,places:0}):void 0;default:return}}function M5t(){return[new QI,new JI]}function A5t(t){const e=oQe(t),{titleBase:i}=t;return e?`${i}: {${e.trim()}}`:i??""}function ave(t){var i;return(t.name&&t.name.toLowerCase())==="name"?!0:((i=t.alias)==null?void 0:i.toLowerCase())==="name"}const P5t=["geometry","blob","raster","guid","xml"];var AC;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})(AC||(AC={}));const ic="FeatureLayer";function _4(t,e){return new V("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function lve(t){return t&&t instanceof tt}const d9=dke();function p9(t,e,i){const r=!!(i!=null&&i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let Ct=class extends z4t(t5t(XFt(l5t(qFt(_ne(n5t(m5t(Aj(p5t(wne(Tne(Ene(Pj(xne(bne(Kr(uL))))))))))))))))){constructor(...t){super(...t),this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.resourceInfo=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=We.WGS84,this.subtypeCode=null,this.supportedSourceTypes=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0,this._debouncedSaveOperations=eB(async(e,i,r)=>{const{save:s,saveAs:n}=await fe(()=>import("./featureLayerUtils-yJceHOl4.js"),__vite__mapDeps([215,216,74]));switch(e){case AC.SAVE:return s(this,i);case AC.SAVE_AS:return n(this,r,i)}})}destroy(){var t;(t=this.source)==null||t.destroy()}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}load(t){var r;const e=t!=null?t.signal:null;if((r=this.portalItem)!=null&&r.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(e).then(s=>this.initLayerProperties(s))),Promise.resolve(this);const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]},t).catch(Pn).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const s=await this._fetchFirstValidLayerId(e);s!=null&&(this.layerId=s)}if(!this.url&&!this._hasMemorySource())throw new V("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(e))}).then(()=>v4t(this,"load",t));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(t,e){return e=e.layerDefinition||e,K5e(e,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){var t;return!(this.loaded&&!((t=this.capabilities)!=null&&t.operations.supportsEditing))&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(t){this._overrideIfSome("editingEnabled",t)}readEditingEnabled(t,e){return this._readEditingEnabled(e,!1)}readEditingEnabledFromWebMap(t,e,i){return this._readEditingEnabled(e,!0,i)}writeEditingEnabled(t,e){this._writeEditingEnabled(t,e,!1)}writeEditingEnabledToWebMap(t,e,i,r){this._writeEditingEnabled(t,e,!0,r)}get effectiveEditingEnabled(){return b4t(this)}readIsTable(t,e){return(e=(e==null?void 0:e.layerDefinition)??e).type==="Table"||!e.geometryType}writeIsTable(t,e,i,r){r!=null&&r.writeLayerSchema&&kl(i,t?"Table":"Feature Layer",e)}readGlobalIdField(t,e){return X5e(e.layerDefinition||e)}readObjectIdField(t,e){return J5e(e.layerDefinition||e)}get parsedUrl(){const t=Ns(this.url);return t!=null&&(this.dynamicDataSource!=null?t.path=zl(t.path,"dynamicLayer"):this.layerId!=null&&(t.path=zl(t.path,this.layerId.toString()))),t}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(t){Rce(t,this.fieldsIndex),this._set("renderer",t)}readRenderer(t,e,i){var s;e=e.layerDefinition||e;const r=(s=e.drawingInfo)==null?void 0:s.renderer;if(r){const n=$3(r,e,i)??void 0;return n||ie.getLogger(this).error("Failed to create renderer",{rendererDefinition:e.drawingInfo.renderer,layer:this,context:i}),n}return Hne(e,i)}set source(t){const e=this._get("source");e!==t&&(lve(e)&&this._resetMemorySource(e),lve(t)&&this._initMemorySource(t),this._set("source",t))}castSource(t){return t?Array.isArray(t)||t instanceof tt?new Wy({layer:this,items:t}):t:null}readSource(t,e){const i=H5e.fromJSON(e.featureSet);return new Wy({layer:this,items:(i==null?void 0:i.features)??[]})}readTemplates(t,e){const i=e.editFieldsInfo,r=i==null?void 0:i.creatorField,s=i==null?void 0:i.editorField;return t=t==null?void 0:t.map(n=>Wne.fromJSON(n)),this._fixTemplates(t,r),this._fixTemplates(t,s),t}readTitle(t,e){var s,n,o;const i=((s=e.layerDefinition)==null?void 0:s.name)??e.name,r=e.title||((n=e.layerDefinition)==null?void 0:n.title);if(i){const a=(o=this.portalItem)==null?void 0:o.title;if(this.sublayerTitleMode==="item-title")return this.url?jCe(this.url,i):i;let l=i;if(!l&&this.url){const c=B0(this.url);c!=null&&(l=c.title)}return l?(this.sublayerTitleMode==="item-title-and-service-name"&&a&&a!==l&&(l=a+" - "+l),pG(l)):void 0}if(this.sublayerTitleMode==="item-title"&&r)return r}readTitleFromWebMap(t,e){var i;return e.title||((i=e.layerDefinition)==null?void 0:i.name)}readTypeIdField(t,e){let i=(e=e.layerDefinition||e).typeIdField;if(i&&e.fields){i=i.toLowerCase();const r=e.fields.find(s=>s.name.toLowerCase()===i);r&&(i=r.name)}return i}readTypes(t,e){t=(e=e.layerDefinition||e).types;const i=e.editFieldsInfo,r=i==null?void 0:i.creatorField,s=i==null?void 0:i.editorField;return t==null?void 0:t.map(n=>(n=hke.fromJSON(n),this._fixTemplates(n.templates,r),this._fixTemplates(n.templates,s),n))}readVisible(t,e){var i;return((i=e.layerDefinition)==null?void 0:i.defaultVisibility)!=null?!!e.layerDefinition.defaultVisibility:e.visibility!=null?!!e.visibility:void 0}async addAttachment(t,e){return i4t(this,t,e,ic)}async updateAttachment(t,e,i){return r4t(this,t,e,i,ic)}async applyEdits(t,e){return s4t(this,t,e)}async uploadAssets(t,e){return n4t(this,t,e)}on(t,e){return super.on(t,e)}createPopupTemplate(t){return pke(this,t)}async createGraphicsSource(t){if(this._hasMemorySource()&&this.source)return this.source.load({signal:t});const{default:e}=await $1e(fe(()=>import("./FeatureLayerSource-EP8K7DDn.js"),__vite__mapDeps([217,102,103,101,214,18,19,25,22,218,219,34,32,33,67,220])),t);return new e({layer:this,supportedSourceTypes:this.supportedSourceTypes}).load({signal:t})}createQuery(){const t=m4t(this);t.dynamicDataSource=this.dynamicDataSource;const e=this.subtypeCode!=null?`${this.subtypeField} = ${this.subtypeCode}`:null,i=GJe(this.definitionExpression,e);return t.where=i||"1=1",t}async deleteAttachments(t,e){return o4t(this,t,e,ic)}async fetchRecomputedExtents(t){return a4t(this,t,ic)}getFeatureType(t){return S4t(this.types,this.typeIdField,t)}getFieldDomain(t,e){var n;const i=e==null?void 0:e.feature,r=y4t(this,i);if(r){const o=(n=r.domains)==null?void 0:n[t];return(o==null?void 0:o.type)==="inherited"?this._getLayerDomain(t):o}const s=this.getFeatureType(i);if(s){const o=s.domains&&s.domains[t];if(o&&o.type!=="inherited")return o}return this._getLayerDomain(t)}getField(t){return this.fieldsIndex.get(t)}async queryAttachments(t,e){return l4t(this,t,e,ic)}async queryFeatures(t,e){const i=await this.load(),r=await i.source.queryFeatures(Pf.from(t)??i.createQuery(),e);if(r!=null&&r.features)for(const s of r.features)s.layer=s.sourceLayer=i;return r}async queryObjectIds(t,e){return c4t(this,t,e,ic)}async queryFeatureCount(t,e){return u4t(this,t,e,ic)}async queryExtent(t,e){return h4t(this,t,e,ic)}async queryRelatedFeatures(t,e){return d4t(this,t,e,ic)}async queryRelatedFeaturesCount(t,e){return p4t(this,t,e,ic)}async queryTopFeatures(t,e){var n;const{source:i,capabilities:r}=await this.load();if(!i.queryTopFeatures||!((n=r==null?void 0:r.query)!=null&&n.supportsTopFeaturesQuery))throw new V(ic,"Layer source does not support queryTopFeatures capability");const s=await i.queryTopFeatures(y4.from(t),e);if(s!=null&&s.features)for(const o of s.features)o.layer=o.sourceLayer=this;return s}async queryTopObjectIds(t,e){const{source:i,capabilities:r}=await this.load();if(!i.queryTopObjectIds||!(r!=null&&r.query.supportsTopFeaturesQuery))throw new V(ic,"Layer source does not support queryTopObjectIds capability");return i.queryTopObjectIds(y4.from(t),e)}async queryTopFeaturesExtent(t,e){var s;const{source:i,capabilities:r}=await this.load();if(!i.queryTopExtents||!((s=r==null?void 0:r.query)!=null&&s.supportsTopFeaturesQuery))throw new V(ic,"Layer source does not support queryTopExtents capability");return i.queryTopExtents(y4.from(t),e)}async queryTopFeatureCount(t,e){var s;const{source:i,capabilities:r}=await this.load();if(!i.queryTopCount||!((s=r==null?void 0:r.query)!=null&&s.supportsTopFeaturesQuery))throw new V(ic,"Layer source does not support queryFeatureCount capability");return i.queryTopCount(y4.from(t),e)}read(t,e){const i=t.featureCollection;if((i||t.type==="Feature Collection")&&(this.resourceInfo=t),i){const r=i.layers;r&&r.length===1&&(super.read(r[0],e),i.showLegend!=null&&super.read({showLegend:i.showLegend},e))}super.read(t,e),e&&e.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo","dateFieldsTimeZone"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(t,e){e={...e,origin:(e==null?void 0:e.origin)??void 0,writeLayerSchema:(e==null?void 0:e.writeLayerSchema)??this._hasMemorySource()};const{origin:i,layerContainerType:r,messages:s}=e;if(this.dynamicDataSource)return s==null||s.push(_4(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if((i==="web-map"||i==="web-scene")&&r!=="tables")return s==null||s.push(_4(this,`a table source can only be written to tables, not ${r}`)),null;if(this._hasMemorySource())return s==null||s.push(_4(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&(i==="web-map"||i==="web-scene")&&r==="tables")return s==null||s.push(_4(this,"using a non-table source cannot be written to tables in web maps or web scenes")),null;return super.write(t,e)}clone(){if(this._hasMemorySource())throw new V(ic,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(t){var e;return!!this.loaded&&(((e=this.source)==null?void 0:e.type)==="memory"||v5t(this,t))}async save(t){return this._debouncedSaveOperations(AC.SAVE,t)}async saveAs(t,e){return this._debouncedSaveOperations(AC.SAVE_AS,e,t)}_readEditingEnabled(t,e,i){var s;let r=(s=t.layerDefinition)==null?void 0:s.capabilities;return r?this._hasEditingCapability(r):(r=t.capabilities,e&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&r?this._hasEditingCapability(r):void 0)}_hasEditingCapability(t){return t.toLowerCase().split(",").map(e=>e.trim()).includes("editing")}_writeEditingEnabled(t,e,i,r){var s,n;if(!t){const o=(n=(s=this.capabilities)==null?void 0:s.operations)!=null&&n.supportsSync?"Query,Sync":"Query";kl("layerDefinition.capabilities",o,e),i&&!(r!=null&&r.writeLayerSchema)&&(e.capabilities=o)}}_getLayerDomain(t){const e=this.fieldsIndex.get(t);return e?e.domain:null}_fetchFirstValidLayerId(t){return Yt(this.url??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:t}).then(e=>{const i=e.data;if(i)return this.findFirstValidLayerId(i)})}async initLayerProperties(t){var e;return this._set("source",t),t.sourceJSON&&(this.sourceJSON=t.sourceJSON,this.read(t.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:(e=this.portalItem)==null?void 0:e.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),Rce(this.renderer,this.fieldsIndex),REe(this.timeInfo,this.fieldsIndex),b5t(this,{origin:"service"})}async hasDataChanged(){return f4t(this)}async fetchPublishingStatus(){const t=this.source;return t!=null&&t.fetchPublishingStatus?t.fetchPublishingStatus():"unavailable"}_verifyFields(){var e,i;const t=((e=this.parsedUrl)==null?void 0:e.path)??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+t+")"),this.isTable||this._hasMemorySource()||t.search(/\/FeatureServer\//i)!==-1||(i=this.fields)!=null&&i.some(r=>r.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+t+")")}_fixTemplates(t,e){t&&t.forEach(i=>{var s;const r=(s=i.prototype)==null?void 0:s.attributes;r&&e&&delete r[e]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new V("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new V("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(t){t.forEach(e=>{e.layer=this,e.sourceLayer=this}),this.addHandles([t.on("after-add",e=>{e.item.layer=this,e.item.sourceLayer=this}),t.on("after-remove",e=>{e.item.layer=null,e.item.sourceLayer=null})],"fl-source")}_resetMemorySource(t){t.forEach(e=>{e.layer=null,e.sourceLayer=null}),this.removeHandles("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}findFirstValidLayerId(t){return Array.isArray(t.layers)&&t.layers.length>0?t.layers[0].id:Array.isArray(t.tables)&&t.tables.length>0?t.tables[0].id:void 0}};h([Ce("service","capabilities")],Ct.prototype,"readCapabilities",null),h([f({json:{origins:{"web-scene":{write:!1}},write:!0}})],Ct.prototype,"charts",void 0),h([f({readOnly:!0})],Ct.prototype,"createQueryVersion",null),h([f({json:{read:{source:"layerDefinition.copyrightText"}}})],Ct.prototype,"copyright",void 0),h([f({json:{read:{source:"layerDefinition.displayField"}}})],Ct.prototype,"displayField",void 0),h([f({types:bS,readOnly:!0})],Ct.prototype,"defaultSymbol",void 0),h([f({type:Vp})],Ct.prototype,"dynamicDataSource",void 0),h([f({type:Boolean})],Ct.prototype,"editingEnabled",null),h([Ce(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Ct.prototype,"readEditingEnabled",null),h([Ce("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Ct.prototype,"readEditingEnabledFromWebMap",null),h([Ve(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Ct.prototype,"writeEditingEnabled",null),h([Ve("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Ct.prototype,"writeEditingEnabledToWebMap",null),h([f({readOnly:!0})],Ct.prototype,"effectiveEditingEnabled",null),h([f({...d9.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:p9}}}}})],Ct.prototype,"fields",void 0),h([f(d9.fieldsIndex)],Ct.prototype,"fieldsIndex",void 0),h([f({type:kFt,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Ct.prototype,"formTemplate",void 0),h([f({json:{read:{source:"layerDefinition.extent"}}})],Ct.prototype,"fullExtent",void 0),h([f({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:p9,writer(t,e,i){const r=t?oK.toJSON(t):null;r&&kl(i,r,e)}}}},read:{source:"layerDefinition.geometryType",reader:oK.read}}})],Ct.prototype,"geometryType",void 0),h([f({json:{read:{source:"layerDefinition.hasM"}}})],Ct.prototype,"hasM",void 0),h([f({json:{read:{source:"layerDefinition.hasZ"}}})],Ct.prototype,"hasZ",void 0),h([f(j4e)],Ct.prototype,"id",void 0),h([f({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Ct.prototype,"infoFor3D",void 0),h([f({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Ct.prototype,"isTable",void 0),h([Ce("service","isTable",["type","geometryType"]),Ce("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Ct.prototype,"readIsTable",null),h([Ve("web-map","isTable")],Ct.prototype,"writeIsTable",null),h([f(Sne)],Ct.prototype,"labelsVisible",void 0),h([f({type:[Nj],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:h9,write:!1},"web-scene":{name:"layerDefinition.drawingInfo.labelingInfo",read:h9,write:{enabled:!0,layerContainerTypes:Ea}}},name:"layerDefinition.drawingInfo.labelingInfo",read:h9,write:!0}})],Ct.prototype,"labelingInfo",void 0),h([f((()=>{const t=Q(_Dt);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,i,r){kl(r,tG(e),i)}}},t})())],Ct.prototype,"opacity",void 0),h([f(V4e)],Ct.prototype,"legendEnabled",void 0),h([f({type:["show","hide"],json:(()=>{const t=Q(H4e.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],Ct.prototype,"listMode",void 0),h([Ce("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],Ct.prototype,"readGlobalIdField",null),h([f({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:p9}}}}})],Ct.prototype,"objectIdField",void 0),h([Ce("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],Ct.prototype,"readObjectIdField",null),h([f({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Ct.prototype,"operationalLayerType",void 0),h([f(d9.outFields)],Ct.prototype,"outFields",void 0),h([f({readOnly:!0})],Ct.prototype,"parsedUrl",null),h([f({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Ct.prototype,"path",void 0),h([f(Oj)],Ct.prototype,"popupEnabled",void 0),h([f({type:GA,json:{name:"popupInfo",write:!0}})],Ct.prototype,"popupTemplate",void 0),h([f({readOnly:!0})],Ct.prototype,"defaultPopupTemplate",null),h([f({types:Dj,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:k5e,name:"layerDefinition.drawingInfo.renderer",write:{layerContainerTypes:Ea,overridePolicy:(t,e,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}})],Ct.prototype,"renderer",null),h([Ce("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Ce("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Ct.prototype,"readRenderer",null),h([f()],Ct.prototype,"resourceInfo",void 0),h([f((()=>{const t=Q(yDt);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],Ct.prototype,"screenSizePerspectiveEnabled",void 0),h([f({clonable:!1})],Ct.prototype,"source",null),h([Li("source")],Ct.prototype,"castSource",null),h([Ce("portal-item","source",["featureSet"]),Ce("web-map","source",["featureSet"])],Ct.prototype,"readSource",null),h([f({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],Ct.prototype,"spatialReference",void 0),h([f({type:Number})],Ct.prototype,"subtypeCode",void 0),h([f({type:[Wne]})],Ct.prototype,"templates",void 0),h([Ce("templates",["editFieldsInfo","creatorField","editorField","templates"])],Ct.prototype,"readTemplates",null),h([f({type:uke})],Ct.prototype,"timeInfo",void 0),h([f()],Ct.prototype,"title",void 0),h([Ce("service","title",["name"]),Ce("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Ct.prototype,"readTitle",null),h([Ce("web-map","title",["layerDefinition.name","title"])],Ct.prototype,"readTitleFromWebMap",null),h([f({type:String})],Ct.prototype,"sublayerTitleMode",void 0),h([f({json:{read:!1}})],Ct.prototype,"type",void 0),h([f({type:String})],Ct.prototype,"typeIdField",void 0),h([Ce("service","typeIdField"),Ce("typeIdField",["layerDefinition.typeIdField"])],Ct.prototype,"readTypeIdField",null),h([f({type:[hke]})],Ct.prototype,"types",void 0),h([Ce("service","types",["types"]),Ce("types",["layerDefinition.types"])],Ct.prototype,"readTypes",null),h([f({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Ct.prototype,"visible",void 0),h([Ce("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Ct.prototype,"readVisible",null),Ct=h([I("esri.layers.FeatureLayer")],Ct);const Yne=Ct,ini=Object.freeze(Object.defineProperty({__proto__:null,default:Yne},Symbol.toStringTag,{value:"Module"}));let Xu=class extends rG(WJ){constructor(e){super(e),this.title="",this.id=-1,this.modelName=null,this.isEmpty=null,this.legendEnabled=!0,this.visible=!0,this.opacity=1}readTitle(e,i){return typeof i.alias=="string"?i.alias:typeof i.name=="string"?i.name:""}readIdOnlyOnce(e){return this.id!==-1?this.id:typeof e=="number"?e:-1}};h([f({type:String,json:{origins:{"web-scene":{write:!0},"portal-item":{write:!0}}}})],Xu.prototype,"title",void 0),h([Ce("service","title",["alias","name"])],Xu.prototype,"readTitle",null),h([f()],Xu.prototype,"layer",void 0),h([f({type:Qr,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],Xu.prototype,"id",void 0),h([Ce("service","id")],Xu.prototype,"readIdOnlyOnce",null),h([f(ZJ(String))],Xu.prototype,"modelName",void 0),h([f(ZJ(Boolean))],Xu.prototype,"isEmpty",void 0),h([f({type:Boolean,nonNullable:!0})],Xu.prototype,"legendEnabled",void 0),h([f({type:Boolean,json:{name:"visibility",write:!0}})],Xu.prototype,"visible",void 0),h([f({type:Number,json:{write:!0}})],Xu.prototype,"opacity",void 0),Xu=h([I("esri.layers.buildingSublayers.BuildingSublayer")],Xu);const fke=Xu,O5t={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsAsyncApplyEdits:!1,zDefault:void 0},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};async function mke(t,e,i,r,s,n,o){let a=null;if(i!=null){const d=`${t}/nodepages/`,p=d+Math.floor(i.rootIndex/i.nodesPerPage);try{return{type:"page",rootPage:(await Yt(p,{query:{f:"json",...r,token:s},responseType:"json",signal:o})).data,rootIndex:i.rootIndex,pageSize:i.nodesPerPage,lodMetric:i.lodSelectionMetricType,urlPrefix:d}}catch(m){n!=null&&n.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",p,m),a=m}}if(!e)return null;const l=e==null?void 0:e.split("/").pop(),c=`${t}/nodes/`,u=c+l;try{return{type:"node",rootNode:(await Yt(u,{query:{f:"json",...r,token:s},responseType:"json",signal:o})).data,urlPrefix:c}}catch(d){throw new V("sceneservice:root-node-missing","Root node missing.",{pageError:a,nodeError:d,url:u})}}let YE=class extends ye{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};h([f({type:Number})],YE.prototype,"nodesPerPage",void 0),h([f({type:Number})],YE.prototype,"rootIndex",void 0),h([f({type:String})],YE.prototype,"lodSelectionMetricType",void 0),YE=h([I("esri.layers.support.I3SLayerDefinitions.I3SNodePageDefinition")],YE);let a0=class extends ye{constructor(){super(...arguments),this.factor=1}};h([f({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],a0.prototype,"id",void 0),h([f({type:Number})],a0.prototype,"factor",void 0),a0=h([I("esri.layers.support.I3SLayerDefinitions.I3SMaterialTexture")],a0);let bv=class extends ye{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};h([f({type:[Number]})],bv.prototype,"baseColorFactor",void 0),h([f({type:a0})],bv.prototype,"baseColorTexture",void 0),h([f({type:a0})],bv.prototype,"metallicRoughnessTexture",void 0),h([f({type:Number})],bv.prototype,"metallicFactor",void 0),h([f({type:Number})],bv.prototype,"roughnessFactor",void 0),bv=h([I("esri.layers.support.I3SLayerDefinitions.I3SMaterialPBRMetallicRoughness")],bv);let nd=class extends ye{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};h([ct({opaque:"opaque",mask:"mask",blend:"blend"})],nd.prototype,"alphaMode",void 0),h([f({type:Number})],nd.prototype,"alphaCutoff",void 0),h([f({type:Boolean})],nd.prototype,"doubleSided",void 0),h([ct({none:"none",back:"back",front:"front"})],nd.prototype,"cullFace",void 0),h([f({type:a0})],nd.prototype,"normalTexture",void 0),h([f({type:a0})],nd.prototype,"occlusionTexture",void 0),h([f({type:a0})],nd.prototype,"emissiveTexture",void 0),h([f({type:[Number]})],nd.prototype,"emissiveFactor",void 0),h([f({type:bv})],nd.prototype,"pbrMetallicRoughness",void 0),nd=h([I("esri.layers.support.I3SLayerDefinitions.I3SMaterialDefinition")],nd);let x$=class extends ye{};h([f({type:String,json:{read:{source:["name","index"],reader:(t,e)=>t??`${e.index}`}}})],x$.prototype,"name",void 0),h([ct({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],x$.prototype,"format",void 0),x$=h([I("esri.layers.support.I3SLayerDefinitions.I3STextureFormat")],x$);let S$=class extends ye{constructor(){super(...arguments),this.atlas=!1}};h([f({type:[x$]})],S$.prototype,"formats",void 0),h([f({type:Boolean})],S$.prototype,"atlas",void 0),S$=h([I("esri.layers.support.I3SLayerDefinitions.I3STextureSetDefinition")],S$);let Wp=class extends ye{};h([ct({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],Wp.prototype,"type",void 0),h([f({type:Number})],Wp.prototype,"component",void 0),Wp=h([I("esri.layers.support.I3SLayerDefinitions.I3SGeometryAttribute")],Wp);let T$=class extends ye{};h([ct({draco:"draco"})],T$.prototype,"encoding",void 0),h([f({type:[String]})],T$.prototype,"attributes",void 0),T$=h([I("esri.layers.support.I3SLayerDefinitions.I3SGeometryCompressedAttributes")],T$);let _p=class extends ye{constructor(){super(...arguments),this.offset=0}};h([f({type:Number})],_p.prototype,"offset",void 0),h([f({type:Wp})],_p.prototype,"position",void 0),h([f({type:Wp})],_p.prototype,"normal",void 0),h([f({type:Wp})],_p.prototype,"uv0",void 0),h([f({type:Wp})],_p.prototype,"color",void 0),h([f({type:Wp})],_p.prototype,"uvRegion",void 0),h([f({type:Wp})],_p.prototype,"featureId",void 0),h([f({type:Wp})],_p.prototype,"faceRange",void 0),h([f({type:T$})],_p.prototype,"compressedAttributes",void 0),_p=h([I("esri.layers.support.I3SLayerDefinitions.I3SGeometryBuffer")],_p);let E$=class extends ye{};h([ct({triangle:"triangle"})],E$.prototype,"topology",void 0),h([f()],E$.prototype,"geometryBuffers",void 0),E$=h([I("esri.layers.support.I3SLayerDefinitions.I3SGeometryDefinition")],E$);const sn=!0,rS={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function Zne(t,e,i){return{identifier:String.fromCharCode.apply(null,new Uint8Array(t,i+rS.identifierOffset,rS.identifierLength)),version:e.getUint16(i+rS.versionOffset,sn),checksum:e.getUint32(i+rS.checksumOffset,sn)}}const Gc={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function R5t(t,e){return{sizeLo:t.getUint32(e+Gc.sizeLo,sn),sizeHi:t.getUint32(e+Gc.sizeHi,sn),minX:t.getFloat64(e+Gc.minX,sn),minY:t.getFloat64(e+Gc.minY,sn),minZ:t.getFloat64(e+Gc.minZ,sn),maxX:t.getFloat64(e+Gc.maxX,sn),maxY:t.getFloat64(e+Gc.maxY,sn),maxZ:t.getFloat64(e+Gc.maxZ,sn),errorX:t.getFloat64(e+Gc.errorX,sn),errorY:t.getFloat64(e+Gc.errorY,sn),errorZ:t.getFloat64(e+Gc.errorZ,sn),count:t.getUint32(e+Gc.count,sn),reserved:t.getUint32(e+Gc.reserved,sn)}}function fni(t){const e=new DataView(t,0);let i=0;const{identifier:r,version:s}=Zne(t,e,i);if(i+=rS.byteCount,r!=="LEPCC     ")throw new V("lepcc-decode-error","Bad identifier");if(s>1)throw new V("lepcc-decode-error","Unknown version");const n=R5t(e,i);if(i+=Gc.byteCount,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new V("lepcc-decode-error","Bad size");const o=new Float64Array(3*n.count),a=[],l=[],c=[],u=[];if(i=v4(t,i,a),i=v4(t,i,l),i=v4(t,i,c),i=v4(t,i,u),i!==t.byteLength)throw new V("lepcc-decode-error","Bad length");let d=0,p=0;for(let m=0;m<a.length;m++){p+=a[m];let g=0;for(let y=0;y<l[m];y++){g+=c[d];const v=u[d];o[3*d]=Math.min(n.maxX,n.minX+2*n.errorX*g),o[3*d+1]=Math.min(n.maxY,n.minY+2*n.errorY*p),o[3*d+2]=Math.min(n.maxZ,n.minZ+2*n.errorZ*v),d++}}return{errorX:n.errorX,errorY:n.errorY,errorZ:n.errorZ,result:o}}function v4(t,e,i){const r=[];e=yK(t,e,r);const s=[];for(let n=0;n<r.length;n++){s.length=0,e=yK(t,e,s);for(let o=0;o<s.length;o++)i.push(s[o]+r[n])}return e}function yK(t,e,i){const r=new DataView(t,e),s=r.getUint8(0),n=31&s,o=!!(32&s),a=(192&s)>>6;let l=0;if(a===0)l=r.getUint32(1,sn),e+=5;else if(a===1)l=r.getUint16(1,sn),e+=3;else{if(a!==2)throw new V("lepcc-decode-error","Bad count type");l=r.getUint8(1),e+=2}if(o)throw new V("lepcc-decode-error","LUT not implemented");const c=Math.ceil(l*n/8),u=new Uint8Array(t,e,c);let d=0,p=0,m=0;const g=-1>>>32-n;for(let y=0;y<l;y++){for(;p<n;)d|=u[m]<<p,p+=8,m+=1;i[y]=d&g,d>>>=n,p-=n,p+n>32&&(d|=u[m-1]>>8-p)}return e+m}const wx={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function $5t(t,e){return{sizeLo:t.getUint32(e+wx.sizeLo,sn),sizeHi:t.getUint32(e+wx.sizeHi,sn),count:t.getUint32(e+wx.count,sn),colorMapCount:t.getUint16(e+wx.colorMapCount,sn),lookupMethod:t.getUint8(e+wx.lookupMethod),compressionMethod:t.getUint8(e+wx.compressionMethod)}}function I5t(t){const e=new DataView(t,0);let i=0;const{identifier:r,version:s}=Zne(t,e,i);if(i+=rS.byteCount,r!=="ClusterRGB")throw new V("lepcc-decode-error","Bad identifier");if(s>1)throw new V("lepcc-decode-error","Unknown version");const n=$5t(e,i);if(i+=wx.byteCount,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new V("lepcc-decode-error","Bad size");if((n.lookupMethod===2||n.lookupMethod===1)&&n.compressionMethod===0){if(3*n.colorMapCount+n.count+i!==t.byteLength||n.colorMapCount>256)throw new V("lepcc-decode-error","Bad count");const o=new Uint8Array(t,i,3*n.colorMapCount),a=new Uint8Array(t,i+3*n.colorMapCount,n.count),l=new Uint8Array(3*n.count);for(let c=0;c<n.count;c++){const u=a[c];l[3*c]=o[3*u],l[3*c+1]=o[3*u+1],l[3*c+2]=o[3*u+2]}return l}if(n.lookupMethod===0&&n.compressionMethod===0){if(3*n.count+i!==t.byteLength||n.colorMapCount!==0)throw new V("lepcc-decode-error","Bad count");return new Uint8Array(t,i).slice()}if(n.lookupMethod<=2&&n.compressionMethod===1){if(i+3!==t.byteLength||n.colorMapCount!==1)throw new V("lepcc-decode-error","Bad count");const o=e.getUint8(i),a=e.getUint8(i+1),l=e.getUint8(i+2),c=new Uint8Array(3*n.count);for(let u=0;u<n.count;u++)c[3*u]=o,c[3*u+1]=a,c[3*u+2]=l;return c}throw new V("lepcc-decode-error","Bad method "+n.lookupMethod+","+n.compressionMethod)}const xx={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function L5t(t,e){return{sizeLo:t.getUint32(e+xx.sizeLo,sn),sizeHi:t.getUint32(e+xx.sizeHi,sn),count:t.getUint32(e+xx.count,sn),scaleFactor:t.getUint16(e+xx.scaleFactor,sn),bitsPerPoint:t.getUint8(e+xx.bitsPerPoint),reserved:t.getUint8(e+xx.reserved)}}function D5t(t){const e=new DataView(t,0);let i=0;const{identifier:r,version:s}=Zne(t,e,i);if(i+=rS.byteCount,r!=="Intensity ")throw new V("lepcc-decode-error","Bad identifier");if(s>1)throw new V("lepcc-decode-error","Unknown version");const n=L5t(e,i);if(i+=xx.byteCount,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new V("lepcc-decode-error","Bad size");const o=new Uint16Array(n.count);if(n.bitsPerPoint===8){if(n.count+i!==t.byteLength)throw new V("lepcc-decode-error","Bad size");const a=new Uint8Array(t,i,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else if(n.bitsPerPoint===16){if(2*n.count+i!==t.byteLength)throw new V("lepcc-decode-error","Bad size");const a=new Uint16Array(t,i,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else{const a=[];if(yK(t,i,a)!==t.byteLength)throw new V("lepcc-decode-error","Bad size");for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}return o}const _K=()=>ie.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function N5t(t,e,i){let r="",s=0;for(;s<i;){const n=t[e+s];if(n<128)r+=String.fromCharCode(n),s++;else if(n>=192&&n<224){if(s+1>=i)throw new V("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const o=(31&n)<<6|63&t[e+s+1];r+=String.fromCharCode(o),s+=2}else if(n>=224&&n<240){if(s+2>=i)throw new V("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(15&n)<<12|(63&t[e+s+1])<<6|63&t[e+s+2];r+=String.fromCharCode(o),s+=3}else{if(!(n>=240&&n<248))throw new V("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(s+3>=i)throw new V("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(7&n)<<18|(63&t[e+s+1])<<12|(63&t[e+s+2])<<6|63&t[e+s+3];if(o>=65536){const a=55296+(o-65536>>10),l=56320+(1023&o);r+=String.fromCharCode(a,l)}else r+=String.fromCharCode(o);s+=4}}}return r}function gke(t,e){const i={byteOffset:0,byteCount:0,fields:Object.create(null)};let r=0;for(let s=0;s<e.length;s++){const n=e[s],o=n.valueType||n.type,a=H5t[o];i.fields[n.property]=a(t,r),r+=kj[o].BYTES_PER_ELEMENT}return i.byteCount=r,i}function F5t(t,e,i){return yke(t,e,i).map(r=>{const s=r?Date.parse(r):null;return s==null||Number.isNaN(s)?null:s})}function yke(t,e,i){const r=[];let s,n,o=0;for(n=0;n<t;n+=1){if(s=e[n],s>0){if(r.push(N5t(i,o,s-1)),i[o+s-1]!==0)throw new V("string-array-error","Invalid string array: missing null termination.")}else r.push(null);o+=s}return r}function cve(t,e){return new kj[e.valueType](t,e.byteOffset,e.count*e.valuesPerElement)}function k5t(t,e){return new Uint8Array(t,e.byteOffset,e.byteCount)}function U5t(t,e,i){const r=e.header!=null?gke(t,e.header):{byteOffset:0,byteCount:0,fields:{count:i}},s={header:r,byteOffset:r.byteCount,byteCount:0,entries:Object.create(null)};let n=r.byteCount;for(let o=0;o<e.ordering.length;o++){const a=e.ordering[o],l=Q(e[a]);if(l.count=r.fields.count??0,l.valueType==="String"){if(l.byteOffset=n,l.byteCount=r.fields[a+"ByteCount"],l.encoding!=="UTF-8")throw new V("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding});if(l.timeEncoding&&l.timeEncoding!=="ECMA_ISO8601")throw new V("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:l.timeEncoding})}else{if(!vke(l.valueType))throw new V("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const c=qk(l.valueType);n+=n%c!=0?c-n%c:0,l.byteOffset=n,l.byteCount=c*l.valuesPerElement*l.count}}n+=l.byteCount??0,s.entries[a]=l}return s.byteCount=n-s.byteOffset,s}function _ke(t,e,i){if(e!==t&&_K().error(`Invalid ${i} buffer size
 expected: ${t}, actual: ${e})`),e<t)throw new V("buffer-too-small","Binary buffer is too small",{expectedSize:t,actualSize:e})}function z5t(t){return{isDraco:!1,isLegacy:!1,color:t.color!=null,normal:t.normal!=null,uv0:t.uv0!=null,uvRegion:t.uvRegion!=null,featureIndex:t.faceRange!=null&&t.featureId!=null}}function mni(t,e){const i=gke(t,e&&e.header);let r=i.byteCount;const s={isDraco:!1,header:i,byteOffset:i.byteCount,byteCount:0,vertexAttributes:{}},n=i.fields,o=n.vertexCount!=null?n.vertexCount:n.count;for(const c of e.ordering){if(!e.vertexAttributes[c])continue;const u={...e.vertexAttributes[c],byteOffset:r,count:o},d=G5t[c]||"_"+c;s.vertexAttributes[d]=u,r+=qk(u.valueType)*u.valuesPerElement*o}const a=n.faceCount;if(e.faces&&a){s.faces={};for(const c of e.ordering){if(!e.faces[c])continue;const u={...e.faces[c],byteOffset:r,count:a};s.faces[c]=u,r+=qk(u.valueType)*u.valuesPerElement*a}}const l=n.featureCount;if(e.featureAttributes&&e.featureAttributeOrder&&l){s.featureAttributes={};for(const c of e.featureAttributeOrder){if(!e.featureAttributes[c])continue;const u={...e.featureAttributes[c],byteOffset:r,count:l};s.featureAttributes[c]=u,r+=(u.valueType==="UInt64"?8:qk(u.valueType))*u.valuesPerElement*l}}return _ke(r,t.byteLength,"geometry"),s.byteCount=r-s.byteOffset,s}function gni(t,e){return!t||!t.compressedAttributes||t.compressedAttributes.encoding!=="draco"?t?z5t(t):V5t(e):B5t(t.compressedAttributes.attributes)}function V5t(t){const e={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const i of t.ordering)if(t.vertexAttributes[i])switch(i){case"position":break;case"normal":e.normal=!0;break;case"color":e.color=!0;break;case"uv0":e.uv0=!0;break;case"region":e.uvRegion=!0}return t.featureAttributes&&t.featureAttributeOrder&&(e.featureIndex=!0),e}function B5t(t){const e={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const i of t)switch(i){case"position":break;case"normal":e.normal=!0;break;case"uv0":e.uv0=!0;break;case"color":e.color=!0;break;case"uv-region":e.uvRegion=!0;break;case"feature-index":e.featureIndex=!0}return e}const G5t={position:R.POSITION,normal:R.NORMAL,color:R.COLOR,uv0:R.UV0,region:R.UVREGION};function j5t(t,e,i){if(t.encoding==="lepcc-rgb")return I5t(e);if(t.encoding==="lepcc-intensity")return D5t(e);if(t.encoding!=null&&t.encoding!=="")throw new V("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");t["attributeByteCounts "]&&!t.attributeByteCounts&&(_K().warn("Warning: Trailing space in 'attributeByteCounts '."),t.attributeByteCounts=t["attributeByteCounts "]),t.ordering[0]==="ObjectIds"&&t.hasOwnProperty("objectIds")&&(_K().warn("Warning: Case error in objectIds"),t.ordering[0]="objectIds");const r=U5t(e,t,i);_ke(r.byteOffset+r.byteCount,e.byteLength,"attribute");const s=r.entries.attributeValues||r.entries.objectIds;if(s){if(s.valueType==="String"){const n=r.entries.attributeByteCounts,o=cve(e,n),a=k5t(e,s);return s.timeEncoding?F5t(n.count,o,a):yke(n.count,o,a)}return cve(e,s)}throw new V("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const kj={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},H5t={Float32:(t,e)=>new DataView(t,0).getFloat32(e,!0),Float64:(t,e)=>new DataView(t,0).getFloat64(e,!0),UInt8:(t,e)=>new DataView(t,0).getUint8(e),Int8:(t,e)=>new DataView(t,0).getInt8(e),UInt16:(t,e)=>new DataView(t,0).getUint16(e,!0),Int16:(t,e)=>new DataView(t,0).getInt16(e,!0),UInt32:(t,e)=>new DataView(t,0).getUint32(e,!0),Int32:(t,e)=>new DataView(t,0).getInt32(e,!0)};function vke(t){return kj.hasOwnProperty(t)}function qk(t){return vke(t)?kj[t].BYTES_PER_ELEMENT:0}function q5t(t,e,i,r,s){const n=i==="east-north-up"?Xs(t):W5t(t,e,r),o=Ee();return mu(r,n,o,s),o}const bke=1,uve=5-bke;function W5t(t,e,i){const r=E(),s=t[3],n=2**(Math.ceil(Math.log(s)*Math.LOG2E/uve)*uve+bke);if(i.isGeographic){const l=n/ur(i).radius*180/Math.PI,c=Math.round(t[1]/l),u=Math.max(-90,Math.min(90,c*l)),d=l/Math.cos((Math.abs(u)-l/2)/180*Math.PI),p=Math.round(t[0]/d)*d;r[0]=p,r[1]=u}else{const l=Math.round(t[0]/n),c=Math.round(t[1]/n);r[0]=l*n,r[1]=c*n}const o=t[2]+e,a=Math.round(o/n);return r[2]=a*n,r}function wke(t){return t?parseInt(t.substring(t.lastIndexOf("/")+1,t.length),10):void 0}function yni(t){var e;if(re("disable-feature:i3s-draco")||!t)return!1;for(const i of t)for(const r of i.geometryBuffers)if(((e=r.compressedAttributes)==null?void 0:e.encoding)==="draco")return!0;return!1}function _ni(t,e,i,r){i.traverse(e,s=>{const n=s.serviceMbsInIndexSR;return(n!=null&&Y5t(t,n))!==sS.OUTSIDE&&(r(s),!0)})}function vni(t,e,i){let r=0,s=0;for(let n=0;n<e.length&&r<t.length;n++)t[r]===e[n]&&(i(n)&&(t[s]=t[r],s++),r++);t.length=s}function bni(t,e,i){let r=0,s=0;for(;r<i.length;)VUe(t,i[r])>=0===e&&(i[s]=i[r],s++),r++;i.length=s}const vO=Ht();function wni(t,e){if(e.rotationScale[1]===0&&e.rotationScale[2]===0&&e.rotationScale[3]===0&&e.rotationScale[5]===0&&e.rotationScale[6]===0&&e.rotationScale[7]===0)return vO[0]=(t[0]-e.position[0])/e.rotationScale[0],vO[1]=(t[1]-e.position[1])/e.rotationScale[4],vO[2]=(t[2]-e.position[0])/e.rotationScale[0],vO[3]=(t[3]-e.position[1])/e.rotationScale[4],vO}var sS;function Y5t(t,e){const i=e[0],r=e[1],s=e[3],n=t[0]-i,o=i-t[2],a=t[1]-r,l=r-t[3],c=Math.max(n,o,0),u=Math.max(a,l,0),d=c*c+u*u;return d>s*s?sS.OUTSIDE:d>0?sS.INTERSECTS_CENTER_OUTSIDE:-Math.max(n,o,a,l)>s?sS.INSIDE:sS.INTERSECTS_CENTER_INSIDE}function Z5t(t,e,i){const r=[],s=i==null?void 0:i.missingFields,n=i==null?void 0:i.originalFields;for(const o of t){const a=o.toLowerCase();let l=!1;for(const c of e)if(a===c.name.toLowerCase()){r.push(c.name),l=!0,n&&n.push(o);break}!l&&s&&s.push(o)}return r}async function xni(t,e,i,r,s,n){if(e.length===0)return[];const o=t.attributeStorageInfo;if(t.associatedLayer!=null)try{return await J5t(t.associatedLayer,e,i,r,n)}catch(a){if(t.associatedLayer.loaded)throw a}if(o){const a=X5t(e,i,s);if(a==null)throw new V("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const l=t.parsedUrl.path;return(await Promise.all(a.map(c=>Q5t(l,o,c.node,c.indices,r,t.apiKey,t.customParameters,n).then(u=>{for(let d=0;d<c.graphics.length;d++){const p=c.graphics[d],m=u[d];if(p.attributes)for(const g in p.attributes)g in m||(m[g]=p.attributes[g]);p.attributes=m}return c.graphics})))).flat()}throw new V("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function X5t(t,e,i){const r=new Map,s=[],n=i();for(const o of t){const a=o.attributes[e];for(let l=0;l<n.length;l++){const c=n[l],u=c.featureIds.indexOf(a);if(u>=0){let d=r.get(c.node);d||(d={node:c.node,indices:[],graphics:[]},s.push(d),r.set(c.node,d)),d.indices.push(u),d.graphics.push(o);for(let p=l;p>0;p--)n[p]=n[p-1];n[0]=c;break}}}return s}async function J5t(t,e,i,r,s){e.sort((c,u)=>c.attributes[i]-u.attributes[i]);const n=e.map(c=>c.attributes[i]),o=[],a=Z5t(r,t.fields,{originalFields:o}),l=await xke(t,n,a,s);for(let c=0;c<e.length;c++){const u=e[c],d=l[c],p={};if(u.attributes)for(const m in u.attributes)p[m]=u.attributes[m];for(let m=0;m<o.length;m++)p[o[m]]=d[a[m]];u.attributes=p}return e}function xke(t,e,i,r){const s=t.capabilities.query.maxRecordCount;if(s!=null&&e.length>s){const o=zUe(e,s);return Promise.all(o.map(a=>xke(t,a,i,r))).then(a=>a.flat())}const n=new Pf({objectIds:e,outFields:i,orderByFields:[t.objectIdField]});return t.queryFeatures(n,r).then(o=>{if(o&&o.features&&o.features.length===e.length)return o.features.map(a=>a.attributes);throw new V("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function Q5t(t,e,i,r,s,n,o,a){return Ske(t,e,i.resources.attributes,r,s,n,o,a)}async function Ske(t,e,i,r,s,n,o,a){const l=[];for(const d of e)if(d&&s.includes(d.name)){const p=`${t}/nodes/${i}/attributes/${d.key}/0`;l.push({url:p,storageInfo:d})}const c=await Promise.allSettled(l.map(d=>Yt(d.url,{responseType:"array-buffer",query:{...o,token:n},signal:a==null?void 0:a.signal}).then(p=>j5t(d.storageInfo,p.data)))),u=[];for(const d of r){const p={};for(let m=0;m<c.length;m++){const g=c[m];if(g.status==="fulfilled"){const y=g.value;p[l[m].storageInfo.name]=tkt(y,d)}}u.push(p)}return u}(function(t){t[t.OUTSIDE=0]="OUTSIDE",t[t.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",t[t.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",t[t.INSIDE=3]="INSIDE"})(sS||(sS={}));const K5t=-32768,ekt=-(2**31);function tkt(t,e){if(!t)return null;const i=t[e];return jV(t)?i===K5t?null:i:qV(t)?i===ekt?null:i:i!=i?null:i}function ikt(t){const e=t.store,i=e.indexCRS||e.geographicCRS,r=i===void 0?e.indexWKT:void 0;if(r){if(!t.spatialReference)throw new V("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indexWKT in the scene layer store but no layer spatial reference",{});if(r!==t.spatialReference.wkt)throw new V("layerview:store-spatial-reference-wkt-index-incompatible","The indexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const s=i?new We(wke(i)):t.spatialReference;return s.equals(t.spatialReference)?t.spatialReference:s}function rkt(t){const e=t.store,i=e.vertexCRS||e.projectedCRS,r=i===void 0?e.vertexWKT:void 0;if(r){if(!t.spatialReference)throw new V("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(r!==t.spatialReference.wkt)throw new V("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const s=i?new We(wke(i)):t.spatialReference;return s.equals(t.spatialReference)?t.spatialReference:s}function Sni(t,e){return e==null?"@null":e===xu(e)?"@ECEF":t.equals(e)?"":e.wkid!=null?"@"+e.wkid:null}function vK(t,e,i){if(!Ac(t,e))throw new V("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(i==="local"&&!skt(t,e))throw new V("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function Tni(t,e,i){var r,s,n,o;if(((r=t.serviceUpdateTimeStamp)==null?void 0:r.lastUpdate)!==((s=e.serviceUpdateTimeStamp)==null?void 0:s.lastUpdate)||!i.isEmpty||((n=t.associatedLayer)==null?void 0:n.url)!==((o=e.associatedLayer)==null?void 0:o.url))throw new V("layerview:recycle-failed")}function skt(t,e){return t.equals(e)||t.isWGS84&&e.isWebMercator||t.isWebMercator&&e.isWGS84}function nkt(t,e,i){const r=ikt(t),s=rkt(t);vK(r,e,i),vK(s,e,i)}function okt(t){var e;return(t.geometryType==null||t.geometryType==="triangles")&&(t.topology==null||t.topology==="PerAttributeArray")&&((e=t.vertexAttributes)==null?void 0:e.position)!=null}function Eni(t){var e;if(((e=t.store)==null?void 0:e.defaultGeometrySchema)==null||!okt(t.store.defaultGeometrySchema))throw new V("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:t.parsedUrl.path})}function Cni(t,e){nkt(t,e.spatialReference,e.viewingMode)}function akt(t){var e;return t.geometryType!=null&&t.geometryType==="points"&&(t.topology==null||t.topology==="PerAttributeArray")&&(t.encoding==null||t.encoding===""||t.encoding==="lepcc-xyz")&&((e=t.vertexAttributes)==null?void 0:e.position)!=null}function Mni(t){var e;if(((e=t.store)==null?void 0:e.defaultGeometrySchema)==null||!akt(t.store.defaultGeometrySchema))throw new V("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function Ani(t,e){vK(t.spatialReference,e.spatialReference,e.viewingMode)}function lkt(t){return t.type==="simple"||t.type==="class-breaks"||t.type==="unique-value"}function ckt(t){return t.type==="mesh-3d"}function Pni(t){var i;if(t==null||!lkt(t)||(t.type==="unique-value"||t.type==="class-breaks")&&t.defaultSymbol==null)return!0;const e=t.getSymbols();if(e.length===0)return!0;for(const r of e){if(!ckt(r)||r.symbolLayers.length===0)return!0;for(const s of r.symbolLayers.items)if(s.type!=="fill"||((i=s.material)==null?void 0:i.color)==null||s.material.colorMixMode!=="replace")return!0}return!1}const Oni=mRe({color:[0,0,0,0],opacity:0});class ukt{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function Rni(t){const e=new ukt;let i=!1,r=!1;for(const s of t.symbolLayers.items)if(s.type==="fill"&&s.enabled){const n=s.material,o=s.edges;if(n!=null&&!i){const a=n.color,l=uRe(n.colorMixMode);e.material=a!=null?{color:[a.r/255,a.g/255,a.b/255],alpha:a.a,colorMixMode:l}:{color:[1,1,1],alpha:1,colorMixMode:yn.Multiply},e.castShadows=s.castShadows,i=!0}o==null||r||(e.edgeMaterial=fRe(o,{}),r=!0)}return e.material||(e.material={color:[1,1,1],alpha:1,colorMixMode:yn.Multiply}),e}function $ni(t,e){return(0|t)+(0|e)|0}function Ini(t,e,i,r,s,n,o){if(!n||n.length===0||e==null||!t.serviceMbsInIndexSR)return null;const a=q5t(t.serviceMbsInIndexSR,s,"none",i,e);In(w4,a);let l=null;const c=()=>{if(!l)if(l=hkt,Mc(b4),t.serviceObbInIndexSR!=null){t.serviceObbInIndexSR.transform(hve,i,e,s,o),hve.getCorners(l);for(const g of l)He(g,g,w4),DC(b4,g)}else{const g=t.serviceMbsInIndexSR;if(!g)return;const y=g[3];Zn(g,i,Vs,e),He(Vs,Vs,w4),Vs[2]+=s;for(let v=0;v<8;++v){const b=1&v?y:-y,w=2&v?y:-y,x=4&v?y:-y,T=l[v];ce(T,[Vs[0]+b,Vs[1]+w,Vs[2]+x]),DC(b4,T)}}};let u=1/0,d=-1/0;const p=g=>{if(g.type!=="replace")return;const y=g.geometry;if(!(y!=null&&y.hasZ))return;Mc(f9);const v=y.spatialReference||r,b=y.rings.reduce((w,x)=>x.reduce((T,C)=>(ne(Vs,C[0],C[1],C[2]),Zn(Vs,v,Vs,e),He(Vs,Vs,w4),DC(f9,Vs),Math.min(Vs[2],T)),w),1/0);c(),X3(b4,f9)&&(u=Math.min(u,b),d=Math.max(d,b))};if(n.forEach(g=>p(g)),u===1/0)return null;const m=(g,y,v)=>{He(Vs,v,a),g[y]=Vs[0],g[y+1]=Vs[1],g[y+2]=Vs[2],y+=24,v[2]=u,He(Vs,v,a),g[y]=Vs[0],g[y+1]=Vs[1],g[y+2]=Vs[2],y+=24,v[2]=d,He(Vs,v,a),g[y]=Vs[0],g[y+1]=Vs[1],g[y+2]=Vs[2]};for(let g=0;g<8;++g)m(dve.data,3*g,l[g]);return p2e(dve)}function Lni(t){return t[3]>=0}function Dni(t){t!=null&&(t[3]=-1)}const hkt=[E(),E(),E(),E(),E(),E(),E(),E()],f9=Ht(),b4=Ht(),hve=new gte,Vs=E(),dve={data:new Array(72),size:3,exclusive:!0,stride:3},w4=Ee();async function dkt(t,e=t.popupTemplate){var u,d;if(e==null)return[];const i=await e.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:r}=e,{objectIdField:s,typeIdField:n,globalIdField:o,relationships:a}=t;if(i.includes("*"))return["*"];const l=r?hQe(t):[],c=sG(t.fieldsIndex,[...i,...l]);return n&&c.push(n),c&&s&&((u=t.fieldsIndex)!=null&&u.has(s))&&!c.includes(s)&&c.push(s),c&&o&&((d=t.fieldsIndex)!=null&&d.has(o))&&!c.includes(o)&&c.push(o),a&&a.forEach(p=>{var g;const{keyField:m}=p;c&&m&&((g=t.fieldsIndex)!=null&&g.has(m))&&!c.includes(m)&&c.push(m)}),c}function Tke(t,e){return t.popupTemplate?t.popupTemplate:e!=null&&e.defaultPopupTemplateEnabled&&t.defaultPopupTemplate!=null?t.defaultPopupTemplate:null}function Nni(t,e){return Tke(t,{defaultPopupTemplateEnabled:e})!=null}const pve=dke();let Ui=class extends Mf.LoadableMixin(BA(fke)){constructor(t){super(t),this.type="building-component",this.nodePages=null,this.materialDefinitions=[],this.textureSetDefinitions=[],this.geometryDefinitions=[],this.indexInfo=null,this.serviceUpdateTimeStamp=null,this.store=null,this.attributeStorageInfo=[],this.fields=[],this.associatedLayer=null,this.outFields=null,this.listMode="show",this.renderer=null,this.definitionExpression=null,this.popupEnabled=!0,this.popupTemplate=null,this.layerType="3d-object"}get parsedUrl(){var t,e;return this.layer?{path:`${(t=this.layer.parsedUrl)==null?void 0:t.path}/sublayers/${this.id}`,query:(e=this.layer.parsedUrl)==null?void 0:e.query}:{path:""}}get fieldsIndex(){return new kne(this.fields)}readAssociatedLayer(t,e){const i=this.layer.associatedFeatureServiceItem,r=e.associatedLayerID;return i!=null&&typeof r=="number"?new Yne({portalItem:i,customParameters:this.customParameters,layerId:r}):null}get objectIdField(){if(this.fields!=null){for(const t of this.fields)if(t.type==="oid")return t.name}return null}get displayField(){return this.associatedLayer!=null?this.associatedLayer.displayField:void 0}get apiKey(){return this.layer.apiKey}get customParameters(){return this.layer.customParameters}get fullExtent(){return this.layer.fullExtent}get spatialReference(){return this.layer.spatialReference}get version(){return this.layer.version}get elevationInfo(){return this.layer.elevationInfo}get minScale(){return this.layer.minScale}get maxScale(){return this.layer.maxScale}get effectiveScaleRange(){return this.layer.effectiveScaleRange}get defaultPopupTemplate(){return this.createPopupTemplate()}load(t){const e=t!=null?t.signal:null,i=this._fetchService(e).then(()=>{this.indexInfo=mke(this.parsedUrl.path,this.rootNode,this.nodePages,this.customParameters,this.apiKey,ie.getLogger(this),e)});return this.addResolvingPromise(i),Promise.resolve(this)}createPopupTemplate(t){return pke(this,t)}async _fetchService(t){const e=(await Yt(this.parsedUrl.path,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:t})).data;this.read(e,{origin:"service",url:this.parsedUrl})}getField(t){return this.fieldsIndex.get(t)}getFieldDomain(t,e){var r,s,n;const i=(s=(r=this.getFeatureType(e==null?void 0:e.feature))==null?void 0:r.domains)==null?void 0:s[t];return i&&i.type!=="inherited"?i:((n=this.getField(t))==null?void 0:n.domain)??null}getFeatureType(t){return t&&this.associatedLayer!=null?this.associatedLayer.getFeatureType(t):null}get types(){return this.associatedLayer!=null?this.associatedLayer.types??[]:[]}get typeIdField(){return this.associatedLayer!=null?this.associatedLayer.typeIdField:null}get geometryType(){return this.layerType==="3d-object"?"mesh":"point"}get profile(){return this.layerType==="3d-object"?"mesh-pyramids":"points"}get capabilities(){const t=this.associatedLayer!=null&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:O5t,{query:e,data:{supportsZ:i,supportsM:r,isVersioned:s}}=t;return{query:e,data:{supportsZ:i,supportsM:r,isVersioned:s}}}createQuery(){const t=new Pf;return this.geometryType!=="mesh"&&(t.returnGeometry=!0,t.returnZ=!0),t.where=this.definitionExpression||"1=1",t.sqlFormat="standard",t}queryExtent(t,e){return this._getAssociatedLayerForQuery().then(i=>i.queryExtent(t||this.createQuery(),e))}queryFeatureCount(t,e){return this._getAssociatedLayerForQuery().then(i=>i.queryFeatureCount(t||this.createQuery(),e))}queryFeatures(t,e){return this._getAssociatedLayerForQuery().then(i=>i.queryFeatures(t||this.createQuery(),e)).then(i=>{if(i!=null&&i.features)for(const r of i.features)r.layer=this.layer,r.sourceLayer=this;return i})}queryObjectIds(t,e){return this._getAssociatedLayerForQuery().then(i=>i.queryObjectIds(t||this.createQuery(),e))}async queryCachedAttributes(t,e){const i=nQe(this.fieldsIndex,await dkt(this,Tke(this)));return Ske(this.parsedUrl.path,this.attributeStorageInfo,t,e,i,this.apiKey,this.customParameters)}async queryCachedFeature(t,e){const i=await this.queryCachedAttributes(t,[e]);if(!i||i.length===0)throw new V("scenelayer:feature-not-in-cached-data","Feature not found in cached data");return new Su({attributes:i[0],layer:this,sourceLayer:this})}getFieldUsageInfo(t){return this.fieldsIndex.has(t)?{supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1}:{supportsLabelingInfo:!1,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:this.associatedLayer!=null}}_getAssociatedLayerForQuery(){const t=this.associatedLayer;return t!=null&&t.loaded?Promise.resolve(t):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),this.associatedLayer==null)throw new V("buildingscenelayer:query-not-available","BuildingSceneLayer component layer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(t){throw new V("buildingscenelayer:query-not-available","BuildingSceneLayer associated feature layer could not be loaded",{layer:this,error:t})}return this.associatedLayer}};h([f({readOnly:!0})],Ui.prototype,"parsedUrl",null),h([f({type:YE,readOnly:!0})],Ui.prototype,"nodePages",void 0),h([f({type:[nd],readOnly:!0})],Ui.prototype,"materialDefinitions",void 0),h([f({type:[S$],readOnly:!0})],Ui.prototype,"textureSetDefinitions",void 0),h([f({type:[E$],readOnly:!0})],Ui.prototype,"geometryDefinitions",void 0),h([f({readOnly:!0})],Ui.prototype,"serviceUpdateTimeStamp",void 0),h([f({readOnly:!0})],Ui.prototype,"store",void 0),h([f({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],Ui.prototype,"rootNode",void 0),h([f({readOnly:!0})],Ui.prototype,"attributeStorageInfo",void 0),h([f(pve.fields)],Ui.prototype,"fields",void 0),h([f({readOnly:!0})],Ui.prototype,"fieldsIndex",null),h([f({readOnly:!0,type:Yne})],Ui.prototype,"associatedLayer",void 0),h([Ce("service","associatedLayer",["associatedLayerID"])],Ui.prototype,"readAssociatedLayer",null),h([f(pve.outFields)],Ui.prototype,"outFields",void 0),h([f({type:String,readOnly:!0})],Ui.prototype,"objectIdField",null),h([f({readOnly:!0,type:String,json:{read:!1}})],Ui.prototype,"displayField",null),h([f({readOnly:!0,type:String})],Ui.prototype,"apiKey",null),h([f({readOnly:!0,type:String})],Ui.prototype,"customParameters",null),h([f({readOnly:!0,type:gi})],Ui.prototype,"fullExtent",null),h([f({readOnly:!0,type:We})],Ui.prototype,"spatialReference",null),h([f({readOnly:!0})],Ui.prototype,"version",null),h([f({readOnly:!0,type:vne})],Ui.prototype,"elevationInfo",null),h([f({readOnly:!0,type:Number})],Ui.prototype,"minScale",null),h([f({readOnly:!0,type:Number})],Ui.prototype,"maxScale",null),h([f({readOnly:!0,type:Number})],Ui.prototype,"effectiveScaleRange",null),h([f({type:["hide","show"],json:{write:!0}})],Ui.prototype,"listMode",void 0),h([f({types:k5e,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],Ui.prototype,"renderer",void 0),h([f({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Ui.prototype,"definitionExpression",void 0),h([f(Oj)],Ui.prototype,"popupEnabled",void 0),h([f({type:GA,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Ui.prototype,"popupTemplate",void 0),h([f({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],Ui.prototype,"normalReferenceFrame",void 0),h([f({readOnly:!0,json:{read:!1}})],Ui.prototype,"defaultPopupTemplate",null),h([f()],Ui.prototype,"types",null),h([f()],Ui.prototype,"typeIdField",null),h([f({json:{write:!1}}),ct(new qi({"3DObject":"3d-object",Point:"point"}))],Ui.prototype,"layerType",void 0),h([f()],Ui.prototype,"geometryType",null),h([f()],Ui.prototype,"profile",null),h([f({readOnly:!0,json:{read:!1}})],Ui.prototype,"capabilities",null),h([f({readOnly:!0})],Ui.prototype,"statisticsInfo",void 0),Ui=h([I("esri.layers.buildingSublayers.BuildingComponentSublayer")],Ui);const bK=Ui;var wK;const fve={type:tt,readOnly:!0,json:{origins:{service:{read:{source:"sublayers",reader:Eke}}},read:!1}};function Eke(t,e,i){if(t&&Array.isArray(t))return new tt(t.map(r=>{const s=pkt(r);if(s){const n=new s;return n.read(r,i),n}return i!=null&&i.messages&&r&&i.messages.push(new Sf("building-scene-layer:unsupported-sublayer-type","Building scene sublayer of type '"+(r.type||"unknown")+"' are not supported",{definition:r,context:i})),null}))}let Iv=wK=class extends fke{constructor(t){super(t),this.type="building-group",this.listMode="show",this.sublayers=null}loadAll(){return sEe(this,t=>wK.forEachSublayer(this.sublayers,e=>{e.type!=="building-group"&&t(e)}))}};function pkt(t){return t.layerType==="group"?Iv:bK}h([f({type:["hide","show","hide-children"],json:{write:!0}})],Iv.prototype,"listMode",void 0),h([f(fve)],Iv.prototype,"sublayers",void 0),Iv=wK=h([I("esri.layers.buildingSublayers.BuildingGroupSublayer")],Iv),function(t){function e(i,r){i.forEach(s=>{r(s),s.type==="building-group"&&e(s.sublayers,r)})}t.sublayersProperty=fve,t.readSublayers=Eke,t.forEachSublayer=e}(Iv||(Iv={}));const ZE=Iv;function fkt(t){return t&&"getAtOrigin"in t&&"originOf"in t}function mve(t){t!=null&&t.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:i,newOrigin:r})=>{fkt(e)&&r&&e.originOf(i)!==r&&e.updateOrigin(i,r)})}let mkt=null;function gkt(){return mkt}async function ykt(t,e={},i){await t.load(i);const r=zl(t.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="resource"}=e,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:t.apiKey},signal:i==null?void 0:i.signal},c=await t.portal.request(r,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:u,size:d,resource:p})=>({created:new Date(u),size:d,resource:t.resourceFromPath(p)}))}}async function _kt(t,e,i,r){const s=new Map;for(const{resource:o,content:a,compress:l,access:c}of e){if(!o.hasPath())throw new V(`portal-item-resource-${i}:invalid-path`,"Resource does not have a valid path");const[u,d]=Cke(o.path),p=`${u}/${l??""}/${c??""}`;s.has(p)||s.set(p,{prefix:u,compress:l,access:c,files:[]}),s.get(p).files.push({fileName:d,content:a})}await t.load(r);const n=zl(t.userItemUrl,i==="add"?"addResources":"updateResources");for(const{prefix:o,compress:a,access:l,files:c}of s.values())for(let d=0;d<c.length;d+=25){const p=c.slice(d,d+25),m=new FormData;o&&o!=="."&&m.append("resourcesPrefix",o),a&&m.append("compress","true"),l&&m.append("access",l);let g=0;for(const{fileName:y,content:v}of p)m.append("file"+ ++g,v,y);m.append("f","json"),await t.portal.request(n,{method:"post",body:m,signal:r==null?void 0:r.signal})}}async function vkt(t,e,i){if(!e.hasPath())throw new V("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(i);const r=zl(t.userItemUrl,"removeResources");await t.portal.request(r,{method:"post",query:{resource:e.path},signal:i==null?void 0:i.signal}),e.portalItem=null}async function bkt(t,e){await t.load(e);const i=zl(t.userItemUrl,"removeResources");return t.portal.request(i,{method:"post",query:{deleteAll:!0},signal:e==null?void 0:e.signal})}function Cke(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function Xne(t){const[e,i]=wkt(t),[r,s]=Cke(e);return[r,s,i]}function wkt(t){const e=iGe(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function Wk(t){return t.type==="blob"?t.blob:t.type==="json"?new Blob([t.jsonString],{type:"application/json"}):(await Yt(t.url,{responseType:"blob"})).data}function xkt(t,e){if(!t.hasPath())return null;const[i,,r]=Xne(t.path);return t.portalItem.resourceFromPath(zl(i,e+r))}function Mke(t,e){if(!t.hasPath())return null;const[i,,r]=Xne(t.path);return t.portalItem.resourceFromPath(zl(i,e+r))}const PC=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResources:_kt,contentToBlob:Wk,fetchResources:ykt,getSiblingOfSameType:xkt,getSiblingOfSameTypeI:Mke,removeAllResources:bkt,removeResource:vkt,splitPrefixFileNameAndExtension:Xne},Symbol.toStringTag,{value:"Module"}));async function Skt(t,e,i){const r=await Ake(t,e,i);await Pke(r,e,i)}async function Tkt(t,e,i,r,s){const n=await Ake(i,r,s);await t.update({data:e}),await Pke(n,r,s)}async function Ake(t,e,i){if(!(e!=null&&e.resources))return;const r=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const s=new Set(e.resources.toKeep.map(d=>d.resource.path)),n=new Set,o=[];s.forEach(d=>{r.delete(d),t.paths.push(d)});const a=[],l=[],c=[];for(const d of e.resources.toUpdate)if(r.delete(d.resource.path),s.has(d.resource.path)||n.has(d.resource.path)){const{resource:p,content:m,finish:g}=d,y=Mke(p,qL());t.paths.push(y.path),a.push({resource:y,content:await Wk(m),compress:d.compress}),g&&c.push(()=>g(y))}else{t.paths.push(d.resource.path),l.push({resource:d.resource,content:await Wk(d.content),compress:d.compress});const p=d.finish;p&&c.push(()=>p(d.resource)),n.add(d.resource.path)}for(const d of e.resources.toAdd)if(t.paths.push(d.resource.path),r.has(d.resource.path))r.delete(d.resource.path);else{a.push({resource:d.resource,content:await Wk(d.content),compress:d.compress});const p=d.finish;p&&c.push(()=>p(d.resource))}if(a.length||l.length){const{addOrUpdateResources:d}=await fe(()=>Promise.resolve().then(()=>PC),void 0);await d(e.portalItem,a,"add",i),await d(e.portalItem,l,"update",i)}if(c.forEach(d=>d()),o.length===0)return r;const u=await Nze(o);if(Et(i),u.length>0)throw new V("save:resources","Failed to save one or more resources",{errors:u});return r}async function Pke(t,e,i){if(!t||!e.portalItem)return;const r=[];for(const s of t){const n=e.portalItem.resourceFromPath(s);r.push(n.portalItem.removeResource(n,i))}await KV(r)}function gve(t){if(lr.apiKey&&pee(t.portal.url))throw new V("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${t.portal.url} when using an api key`)}async function Fni(t){const e=[];for(const i of t.allLayers)if("beforeSave"in i&&typeof i.beforeSave=="function"){const r=i.beforeSave();r&&e.push(r)}await Promise.allSettled(e)}const Ekt=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function Ckt(t,e,i){let r=(t.messages??[]).filter(({type:s})=>s==="error").map(({name:s,message:n,details:o})=>new V(s,n,o));if(t.blockedRelativeUrls&&(r=r.concat(t.blockedRelativeUrls.map(s=>new V("url:unsupported",`Relative url '${s}' is not supported`)))),i){const{ignoreUnsupported:s,supplementalUnsupportedErrors:n=[],requiredPropertyChecksDisabled:o}=i;s&&(r=r.filter(({name:a})=>!(Ekt.has(a)||n.includes(a)))),o&&(r=r.filter(a=>a.name!=="web-document-write:property-required"))}if(r.length>0)throw new V(e.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}const Mkt=t=>{let e=class extends t{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=eB(async(i,r,s)=>{switch(i){case AA.SAVE:return this._save(r);case AA.SAVE_AS:return this._saveAs(s,r)}})}readSpatialReference(i,r){return g9(r)}readFullExtent(i,r,s){if(i!=null&&typeof i=="object"){const a=i.spatialReference==null?{...i,spatialReference:g9(r)}:i;return gi.fromJSON(a,s)}const n=r.store,o=g9(r);return o==null||(n==null?void 0:n.extent)==null||!Array.isArray(n.extent)||n.extent.some(a=>a<m9)?null:new gi({xmin:n.extent[0],ymin:n.extent[1],xmax:n.extent[2],ymax:n.extent[3],spatialReference:o})}parseVersionString(i){const r={major:Number.NaN,minor:Number.NaN,versionString:i},s=i.split(".");return s.length>=2&&(r.major=parseInt(s[0],10),r.minor=parseInt(s[1],10)),r}readVersion(i,r){const s=r.store,n=s.version!=null?s.version.toString():"";return this.parseVersionString(n)}readTitlePortalItem(i){return this.sublayerTitleMode!=="item-title"?void 0:i}readTitleService(i,r){var o;const s=(o=this.portalItem)==null?void 0:o.title;if(this.sublayerTitleMode==="item-title")return this.url?jCe(this.url,r.name):r.name;let n=r.name;if(!n&&this.url){const a=B0(this.url);a!=null&&(n=a.title)}return this.sublayerTitleMode==="item-title-and-service-name"&&s&&(n=s+" - "+n),pG(n)}set url(i){if(i==null)return void this._set("url",i);const r=qCe({layer:this,url:i,nonStandardUrlAllowed:!1,logger:ie.getLogger(this)});this._set("url",r.url),r.layerId!=null&&this._set("layerId",r.layerId)}writeUrl(i,r,s,n){WCe(this,i,"layers",r,n)}get parsedUrl(){const i=this._get("url"),r=Ns(i);return r&&this.layerId!=null&&(r.path=`${r.path}/layers/${this.layerId}`),r}async _fetchIndexAndUpdateExtent(i,r){var s;this.indexInfo=mke(((s=this.parsedUrl)==null?void 0:s.path)??"",this.rootNode,i,this.customParameters,this.apiKey,ie.getLogger(this),r),this.fullExtent==null||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(i){var r,s,n,o;if((i==null?void 0:i.type)==="page"){const a=i.rootIndex%i.pageSize,l=(s=(r=i.rootPage)==null?void 0:r.nodes)==null?void 0:s[a];if(((n=l==null?void 0:l.obb)==null?void 0:n.center)==null||l.obb.halfSize==null)throw new V("sceneservice:invalid-node-page","Invalid node page.");if(l.obb.center[0]<m9||this.fullExtent==null||this.fullExtent.hasZ)return;const c=l.obb.halfSize,u=l.obb.center[2],d=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);this.fullExtent.zmin=u-d,this.fullExtent.zmax=u+d}else if((i==null?void 0:i.type)==="node"){const a=(o=i.rootNode)==null?void 0:o.mbs;if(!Array.isArray(a)||a.length!==4||a[0]<m9)return;const l=a[2],c=a[3],{fullExtent:u}=this;u&&(u.zmin=l-c,u.zmax=l+c)}}async _fetchService(i){if(this.url==null)throw new V("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(this.layerId==null&&/SceneServer\/*$/i.test(this.url)){const r=await this._fetchFirstLayerId(i);r!=null&&(this.layerId=r)}return this._fetchServiceLayer(i)}async _fetchFirstLayerId(i){const r=await Yt(this.url??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:i});if(r.data&&Array.isArray(r.data.layers)&&r.data.layers.length>0)return r.data.layers[0].id}async _fetchServiceLayer(i){var o;const r=await Yt(((o=this.parsedUrl)==null?void 0:o.path)??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:i});r.ssl&&this.url&&(this.url=this.url.replace(/^http:/i,"https:"));let s=!1;if(r.data.layerType&&r.data.layerType==="Voxel"&&(s=!0),s)return this._fetchVoxelServiceLayer();const n=r.data;this.read(n,this._getServiceContext()),this.validateLayer(n)}async _fetchVoxelServiceLayer(i){var s;const r=(await Yt(((s=this.parsedUrl)==null?void 0:s.path)+"/layer",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:i})).data;this.read(r,this._getServiceContext()),this.validateLayer(r)}_getServiceContext(){var i;return{origin:"service",portalItem:this.portalItem,portal:(i=this.portalItem)==null?void 0:i.portal,url:this.parsedUrl}}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&typeof this.beforeSave=="function"&&await this.beforeSave()}validateLayer(i){}async _saveAs(i,r){var c;const s={..._ve,...r};let n=l1.from(i);if(!n)throw new V("sceneservice:portal-item-required","_saveAs() requires a portal item to save to");gve(n),n.id&&(n=n.clone(),n.id=null);const o=n.portal||No.getDefault();await this._ensureLoadBeforeSave(),n.type=y9,n.portal=o;const a=d_e(n,"portal-item",!0),l={layers:[this.write({},a)]};return await Promise.all(a.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(l,a,s),this.url&&(n.url=this.url),n.title||(n.title=this.title),yve(n,s,I3.newItem),await o.signIn(),await((c=o.user)==null?void 0:c.addItem({item:n,folder:s==null?void 0:s.folder,data:l})),await Skt(this.resourceReferences,a),this.portalItem=n,mve(a),a.portalItem=n,n}async _save(i){const r={..._ve,...i};if(!this.portalItem)throw new V("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if(gve(this.portalItem),this.portalItem.type!==y9)throw new V("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${y9}"`);await this._ensureLoadBeforeSave();const s=d_e(this.portalItem,"portal-item",!0),n={layers:[this.write({},s)]};return await Promise.all(s.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(n,s,r),this.url&&(this.portalItem.url=this.url),this.portalItem.title||(this.portalItem.title=this.title),yve(this.portalItem,r,I3.existingItem),await Tkt(this.portalItem,n,this.resourceReferences,s),mve(s),this.portalItem}async _validateAgainstJSONSchema(i,r,s){const n=s==null?void 0:s.validationOptions;Ckt(r,{errorName:"sceneservice:save"},{ignoreUnsupported:n==null?void 0:n.ignoreUnsupported,supplementalUnsupportedErrors:["scenemodification:unsupported"]});const o=n==null?void 0:n.enabled,a=gkt();if(o&&a){const l=(await a()).validate(i,s.portalItemLayerType);if(!l.length)return;const c=`Layer item did not validate:
${l.join(`
`)}`;if(ie.getLogger(this).error(`_validateAgainstJSONSchema(): ${c}`),n.failPolicy==="throw"){const u=l.map(d=>new V("sceneservice:schema-validation",d));throw new V("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{validationErrors:u})}}}};return h([f(j4e)],e.prototype,"id",void 0),h([f({type:We})],e.prototype,"spatialReference",void 0),h([Ce("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readSpatialReference",null),h([f({type:gi})],e.prototype,"fullExtent",void 0),h([Ce("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readFullExtent",null),h([f({readOnly:!0,type:gT})],e.prototype,"heightModelInfo",void 0),h([f({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],e.prototype,"minScale",void 0),h([f({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],e.prototype,"maxScale",void 0),h([f({readOnly:!0})],e.prototype,"version",void 0),h([Ce("version",["store.version"])],e.prototype,"readVersion",null),h([f({type:String,json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",void 0),h([f({type:String,json:{read:!1}})],e.prototype,"sublayerTitleMode",void 0),h([f({type:String})],e.prototype,"title",void 0),h([Ce("portal-item","title")],e.prototype,"readTitlePortalItem",null),h([Ce("service","title",["name"])],e.prototype,"readTitleService",null),h([f({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],e.prototype,"layerId",void 0),h([f(z4e)],e.prototype,"url",null),h([Ve("url")],e.prototype,"writeUrl",null),h([f()],e.prototype,"parsedUrl",null),h([f({readOnly:!0})],e.prototype,"store",void 0),h([f({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],e.prototype,"rootNode",void 0),e=h([I("esri.layers.mixins.SceneService")],e),e},m9=-1e38;function g9(t){if(t.spatialReference!=null)return We.fromJSON(t.spatialReference);const e=t.store,i=e.indexCRS||e.geographicCRS,r=i&&parseInt(i.substring(i.lastIndexOf("/")+1,i.length),10);return r!=null?new We(r):null}function yve(t,e,i){t.typeKeywords||(t.typeKeywords=[]);const r=e.getTypeKeywords();for(const s of r)t.typeKeywords.push(s);t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter((s,n,o)=>o.indexOf(s)===n),i===I3.newItem&&(t.typeKeywords=t.typeKeywords.filter(s=>s!=="Hosted Service")))}var I3;(function(t){t[t.existingItem=0]="existingItem",t[t.newItem=1]="newItem"})(I3||(I3={}));const y9="Scene Service",_ve={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var AA;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})(AA||(AA={}));async function Akt(t,e){const i=B0(t);if(!i)throw new V("invalid-url","Invalid scene service url");const r={...e,sceneServerUrl:i.url.path,layerId:i.sublayer??void 0};if(r.sceneLayerItem??(r.sceneLayerItem=await Pkt(r)),r.sceneLayerItem==null)return vve(r.sceneServerUrl.replace("/SceneServer","/FeatureServer"),r);const s=await Rkt(r);if(!(s!=null&&s.url))throw new V("related-service-not-found","Could not find feature service through portal item relationship");r.featureServiceItem=s;const n=await vve(s.url,r);return n.portalItem=s,n}async function Pkt(t){const e=(await Oke(t)).serviceItemId;if(!e)return null;const i=new l1({id:e,apiKey:t.apiKey}),r=await Okt(t);r!=null&&(i.portal=new No({url:r}));try{return i.load({signal:t.signal})}catch(s){return Pn(s),null}}async function Oke(t){if(t.rootDocument)return t.rootDocument;const e={query:{f:"json",...t.customParameters,token:t.apiKey},responseType:"json",signal:t.signal};try{const i=await Yt(t.sceneServerUrl,e);t.rootDocument=i.data}catch{t.rootDocument={}}return t.rootDocument}async function Okt(t){const e=pi==null?void 0:pi.findServerInfo(t.sceneServerUrl);if(e!=null&&e.owningSystemUrl)return e.owningSystemUrl;const i=t.sceneServerUrl.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const r=(await Yt(i,{query:{f:"json"},responseType:"json",signal:t.signal})).data.owningSystemUrl;if(r)return r}catch(r){Pn(r)}return null}async function vve(t,e){var g,y,v;const i=B0(t);if(!i)throw new V("invalid-feature-service-url","Invalid feature service url");const r=i.url.path,s=e.layerId;if(s==null)return{serverUrl:r};const n=Oke(e),o=e.featureServiceItem?await e.featureServiceItem.fetchData("json"):null,a=(v=((g=o==null?void 0:o.layers)==null?void 0:g[0])||((y=o==null?void 0:o.tables)==null?void 0:y[0]))==null?void 0:v.customParameters,l=b=>{const w={query:{f:"json",...a},responseType:"json",authMode:b,signal:e.signal};return Yt(r,w)},c=l("anonymous").catch(()=>l("no-prompt")),[u,d]=await Promise.all([c,n]),p=d==null?void 0:d.layers,m=u.data&&u.data.layers;if(!Array.isArray(m))throw new Error("expected layers array");if(Array.isArray(p)){for(let b=0;b<Math.min(p.length,m.length);b++)if(p[b].id===s)return{serverUrl:r,layerId:m[b].id}}else if(s!=null&&s<m.length)return{serverUrl:r,layerId:m[s].id};throw new Error("could not find matching associated sublayer")}async function Rkt({sceneLayerItem:t,signal:e}){if(!t)return null;try{const i=(await t.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:e})).find(s=>s.type==="Feature Service")||null;if(!i)return null;const r=new l1({portal:i.portal,id:i.id});return await r.load(),r}catch(i){return Pn(i),null}}let Yk=class extends ye{constructor(){super(...arguments),this.type=null}};h([f({type:String,readOnly:!0,json:{write:!0}})],Yk.prototype,"type",void 0),Yk=h([I("esri.layers.support.BuildingFilterAuthoringInfo")],Yk);const Rke=Yk;var xK;let C$=xK=class extends ye{constructor(){super(...arguments),this.filterType=null,this.filterValues=null}clone(){return new xK({filterType:this.filterType,filterValues:Q(this.filterValues)})}};h([f({type:String,json:{write:!0}})],C$.prototype,"filterType",void 0),h([f({type:[String],json:{write:!0}})],C$.prototype,"filterValues",void 0),C$=xK=h([I("esri.layers.support.BuildingFilterAuthoringInfoType")],C$);const $kt=C$;var SK;const Ikt=tt.ofType($kt);let Zk=SK=class extends ye{clone(){return new SK({filterTypes:Q(this.filterTypes)})}};h([f({type:Ikt,json:{write:!0}})],Zk.prototype,"filterTypes",void 0),Zk=SK=h([I("esri.layers.support.BuildingFilterAuthoringInfoBlock")],Zk);const Lkt=Zk;var TK;const Dkt=tt.ofType(Lkt);let M$=TK=class extends Rke{constructor(){super(...arguments),this.type="checkbox"}clone(){return new TK({filterBlocks:Q(this.filterBlocks)})}};h([f({type:["checkbox"]})],M$.prototype,"type",void 0),h([f({type:Dkt,json:{write:!0}})],M$.prototype,"filterBlocks",void 0),M$=TK=h([I("esri.layers.support.BuildingFilterAuthoringInfoCheckbox")],M$);const bve=M$;let Xk=class extends ye{};h([f({readOnly:!0,json:{read:!1}})],Xk.prototype,"type",void 0),Xk=h([I("esri.layers.support.BuildingFilterMode")],Xk);const Uj=Xk;var EK;let Jk=EK=class extends Uj{constructor(){super(...arguments),this.type="solid"}clone(){return new EK}};h([f({type:["solid"],readOnly:!0,json:{write:!0}})],Jk.prototype,"type",void 0),Jk=EK=h([I("esri.layers.support.BuildingFilterModeSolid")],Jk);const CK=Jk;var MK;let A$=MK=class extends Uj{constructor(){super(...arguments),this.type="wire-frame",this.edges=null}clone(){return new MK({edges:Q(this.edges)})}};h([ct({wireFrame:"wire-frame"})],A$.prototype,"type",void 0),h([f(Bte)],A$.prototype,"edges",void 0),A$=MK=h([I("esri.layers.support.BuildingFilterModeWireFrame")],A$);const wve=A$;var AK;let Qk=AK=class extends Uj{constructor(){super(...arguments),this.type="x-ray"}clone(){return new AK}};h([f({type:["x-ray"],readOnly:!0,json:{write:!0}})],Qk.prototype,"type",void 0),Qk=AK=h([I("esri.layers.support.BuildingFilterModeXRay")],Qk);const xve=Qk;var PK;const Nkt={nonNullable:!0,types:{key:"type",base:Uj,typeMap:{solid:CK,"wire-frame":wve,"x-ray":xve}},json:{read:t=>{switch(t==null?void 0:t.type){case"solid":return CK.fromJSON(t);case"wireFrame":return wve.fromJSON(t);case"x-ray":return xve.fromJSON(t);default:return}},write:{enabled:!0,isRequired:!0}}};let XE=PK=class extends ye{constructor(){super(...arguments),this.filterExpression=null,this.filterMode=new CK,this.title=""}clone(){return new PK({filterExpression:this.filterExpression,filterMode:Q(this.filterMode),title:this.title})}};h([f({type:String,json:{write:{enabled:!0,isRequired:!0}}})],XE.prototype,"filterExpression",void 0),h([f(Nkt)],XE.prototype,"filterMode",void 0),h([f({type:String,json:{write:{enabled:!0,isRequired:!0}}})],XE.prototype,"title",void 0),XE=PK=h([I("esri.layers.support.BuildingFilterBlock")],XE);const Fkt=XE;var OK;const kkt=tt.ofType(Fkt);let wv=OK=class extends ye{constructor(){super(...arguments),this.description=null,this.filterBlocks=null,this.id=qL(),this.name=null}clone(){return new OK({description:this.description,filterBlocks:Q(this.filterBlocks),id:this.id,name:this.name,filterAuthoringInfo:Q(this.filterAuthoringInfo)})}};h([f({type:String,json:{write:!0}})],wv.prototype,"description",void 0),h([f({type:kkt,json:{write:{enabled:!0,isRequired:!0}}})],wv.prototype,"filterBlocks",void 0),h([f({types:{key:"type",base:Rke,typeMap:{checkbox:bve}},json:{read:t=>(t==null?void 0:t.type)==="checkbox"?bve.fromJSON(t):null,write:!0}})],wv.prototype,"filterAuthoringInfo",void 0),h([f({type:String,constructOnly:!0,json:{write:{enabled:!0,isRequired:!0}}})],wv.prototype,"id",void 0),h([f({type:String,json:{write:{enabled:!0,isRequired:!0}}})],wv.prototype,"name",void 0),wv=OK=h([I("esri.layers.support.BuildingFilter")],wv);const Ukt=wv;let $m=class extends ye{constructor(){super(...arguments),this.fieldName=null,this.modelName=null,this.label=null,this.min=null,this.max=null,this.mostFrequentValues=null,this.subLayerIds=null}};h([f({type:String})],$m.prototype,"fieldName",void 0),h([f({type:String})],$m.prototype,"modelName",void 0),h([f({type:String})],$m.prototype,"label",void 0),h([f({type:Number})],$m.prototype,"min",void 0),h([f({type:Number})],$m.prototype,"max",void 0),h([f({json:{read:t=>Array.isArray(t)&&(t.every(e=>typeof e=="string")||t.every(e=>typeof e=="number"))?t.slice():null}})],$m.prototype,"mostFrequentValues",void 0),h([f({type:[Number]})],$m.prototype,"subLayerIds",void 0),$m=h([I("esri.layers.support.BuildingSummaryStatistics.BuildingFieldStatistics")],$m);let P$=class extends Mf.LoadableMixin(BA(ye)){constructor(){super(...arguments),this.url=null}get fields(){return this.loaded||this.loadStatus==="loading"?this._get("fields"):(ie.getLogger(this).error("building summary statistics are not loaded"),null)}load(t){const e=t!=null?t.signal:null;return this.addResolvingPromise(this._fetchService(e)),Promise.resolve(this)}async _fetchService(t){const e=(await Yt(this.url,{query:{f:"json"},responseType:"json",signal:t})).data;this.read(e,{origin:"service"})}};h([f({constructOnly:!0,type:String})],P$.prototype,"url",void 0),h([f({readOnly:!0,type:[$m],json:{read:{source:"summary"}}})],P$.prototype,"fields",null),P$=h([I("esri.layers.support.BuildingSummaryStatistics")],P$);const $ke=P$,Ike=tt.ofType(Ukt),Lke=Q(ZE.sublayersProperty);var Dve;const _9=(Dve=Lke.json)==null?void 0:Dve.origins;_9&&(_9["web-scene"]={type:[bK],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}},_9["portal-item"]={type:[bK],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}});let Ho=class extends Mkt(wne(Tne(Ene(Aj(Pj(xne(bne(uL)))))))){constructor(t){super(t),this.operationalLayerType="BuildingSceneLayer",this.allSublayers=new ZM({getCollections:()=>[this.sublayers],getChildrenFunction:e=>e.type==="building-group"?e.sublayers:null}),this.sublayers=null,this._sublayerOverrides=null,this.filters=new Ike,this.activeFilterId=null,this.summaryStatistics=null,this.outFields=null,this.legendEnabled=!0,this.type="building-scene"}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t??{}}destroy(){this.allSublayers.destroy()}readSublayers(t,e,i){const r=ZE.readSublayers(t,e,i);return ZE.forEachSublayer(r,s=>s.layer=this),this._sublayerOverrides&&(this.applySublayerOverrides(r,this._sublayerOverrides),this._sublayerOverrides=null),r}applySublayerOverrides(t,{overrides:e,context:i}){ZE.forEachSublayer(t,r=>r.read(e.get(r.id),i))}readSublayerOverrides(t,e){var r;const i=new Map;for(const s of t)s!=null&&typeof s=="object"&&typeof s.id=="number"?i.set(s.id,s):(r=e.messages)==null||r.push(new V("building-scene-layer:invalid-sublayer-override","Invalid value for sublayer override. Not an object or no id specified.",{value:s}));return{overrides:i,context:e}}writeSublayerOverrides(t,e,i){const r=[];ZE.forEachSublayer(this.sublayers,s=>{const n=s.write({},i);Object.keys(n).length>1&&r.push(n)}),r.length>0&&(e.sublayers=r)}writeUnappliedOverrides(t,e){e.sublayers=[],t.overrides.forEach(i=>{e.sublayers.push(Q(i))})}write(t,e){return t=super.write(t,e),!e||e.origin!=="web-scene"&&e.origin!=="portal-item"||(this.sublayers?this.writeSublayerOverrides(this.sublayers,t,e):this._sublayerOverrides&&this.writeUnappliedOverrides(this._sublayerOverrides,t)),t}read(t,e){if(super.read(t,e),e&&(e.origin==="web-scene"||e.origin==="portal-item")&&t!=null&&Array.isArray(t.sublayers)){const i=this.readSublayerOverrides(t.sublayers,e);this.sublayers?this.applySublayerOverrides(this.sublayers,i):this._sublayerOverrides=i}}readSummaryStatistics(t,e){var i;if(typeof e.statisticsHRef=="string"){const r=zl((i=this.parsedUrl)==null?void 0:i.path,e.statisticsHRef);return new $ke({url:r})}return null}set elevationInfo(t){this._set("elevationInfo",t),this._validateElevationInfo()}load(t){const e=t!=null?t.signal:null,i=this.loadFromPortal({supportedTypes:["Scene Service"]},t).catch(Pn).then(()=>this._fetchService(e)).then(()=>this._fetchAssociatedFeatureService(e));return this.addResolvingPromise(i),Promise.resolve(this)}loadAll(){return Cte(this,t=>{ZE.forEachSublayer(this.sublayers,e=>{e.type!=="building-group"&&t(e)}),this.summaryStatistics&&t(this.summaryStatistics)})}async saveAs(t,e){return this._debouncedSaveOperations(AA.SAVE_AS,{...e,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"building-scene"},t)}async save(){const t={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"building-scene"};return this._debouncedSaveOperations(AA.SAVE,t)}validateLayer(t){if(!t.layerType||t.layerType!=="Building")throw new V("buildingscenelayer:layer-type-not-supported","BuildingSceneLayer does not support this layer type",{layerType:t.layerType})}_getTypeKeywords(){return["Building"]}async _fetchAssociatedFeatureService(t){try{const{portalItem:e}=await Akt(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,apiKey:this.apiKey,signal:t});this.associatedFeatureServiceItem=e}catch(e){ie.getLogger(this).warn("Associated feature service item could not be loaded",e)}}_validateElevationInfo(){const t=this.elevationInfo,e="Building scene layers";Ige(ie.getLogger(this),uEt(e,"absolute-height",t)),Ige(ie.getLogger(this),hEt(e,t))}};h([f({type:["BuildingSceneLayer"]})],Ho.prototype,"operationalLayerType",void 0),h([f({readOnly:!0})],Ho.prototype,"allSublayers",void 0),h([f(Lke)],Ho.prototype,"sublayers",void 0),h([Ce("service","sublayers")],Ho.prototype,"readSublayers",null),h([f({type:Ike,nonNullable:!0,json:{write:!0}})],Ho.prototype,"filters",void 0),h([f({type:String,json:{write:!0}})],Ho.prototype,"activeFilterId",void 0),h([f({readOnly:!0,type:$ke})],Ho.prototype,"summaryStatistics",void 0),h([Ce("summaryStatistics",["statisticsHRef"])],Ho.prototype,"readSummaryStatistics",null),h([f({type:[String],json:{read:!1}})],Ho.prototype,"outFields",void 0),h([f(vDt)],Ho.prototype,"fullExtent",void 0),h([f(V4e)],Ho.prototype,"legendEnabled",void 0),h([f({type:["show","hide","hide-children"]})],Ho.prototype,"listMode",void 0),h([f(ZJ(We))],Ho.prototype,"spatialReference",void 0),h([f(B4e)],Ho.prototype,"elevationInfo",null),h([f({json:{read:!1},readOnly:!0})],Ho.prototype,"type",void 0),h([f()],Ho.prototype,"associatedFeatureServiceItem",void 0),Ho=h([I("esri.layers.BuildingSceneLayer")],Ho);const Dke=Ho,Uni=Object.freeze(Object.defineProperty({__proto__:null,default:Dke},Symbol.toStringTag,{value:"Module"}));function zkt(t){let e;return{c(){e=ut("div"),Se(e,"class","map-container svelte-n86d70")},m(i,r){Ss(i,e,r),t[2](e)},p:el,i:el,o:el,d(i){i&&rs(e),t[2](null)}}}const Vkt="AAPKfb786cc2758148739175c3ec34911c15ZmP9fvQ4IkY-MIc7PqC8pirSsJPVFRXx68tuu71NEskmmiWOCf2EEhMHvilOFZlQ";function Bkt(t,e,i){const r="contact-map";let s,n,o,a=new aDt;lr.apiKey=Vkt;const l=new _t({longitude:11.4260974,latitude:48.7651622,z:200}),c=new _t({longitude:11.4260974,latitude:48.7651622,z:0}),u=new kf({color:[255,255,0],outline:{color:[255,255,0,.6],width:22},size:"22px",style:"circle"}),d=new Mu({color:[255,255,0,.8],width:2}),p=new Su({geometry:l,symbol:u}),m=new J3({paths:[[[c.longitude,c.latitude,c.z],[l.longitude,l.latitude,l.z]]],spatialReference:{wkid:4326}}),g=new Su({geometry:m,symbol:d}),y=async()=>{try{const b=new YC({baseLayers:[new x5e({portalItem:{id:"12d4425ccd2846e19add8e8a60eb6627"}})]}),w=new Dke({portalItem:{id:"ca0470dbbddb4db28bad74ed39949e25"}});n=new TEe({basemap:b,layers:[a,w]}),o=new rDt({container:s,map:n,camera:{position:{latitude:0,longitude:0,z:5e7},tilt:0},environment:{atmosphereEnabled:!1,starsEnabled:!0},ui:{components:[]}}),o.when(()=>{console.log("Map view is ready"),a.addMany([p,g]),console.log("Address graphic and line added to data layer"),o.goTo({center:[11.4260974,48.7651622],zoom:16,tilt:70,heading:0},{duration:5e3}).catch(function(x){x.name!=="AbortError"&&console.error("GoTo error: ",x)})})}catch(b){console.error("Error initializing map:",b)}};_1(()=>{console.log("Component mounted, initializing map"),y()}),Xke(()=>{o==null||o.destroy(),console.log("Component destroyed, map view destroyed")});function v(b){v9[b?"unshift":"push"](()=>{s=b,i(0,s)})}return[s,r,v]}let Gkt=class extends F0{constructor(e){super(),N0(this,e,Bkt,zkt,D0,{id:1})}get id(){return this.$$.ctx[1]}};function Sve(t,e,i){const r=t.slice();return r[7]=e[i],r}function Tve(t){let e,i,r,s,n,o,a,l,c,u,d,p,m,g,y,v,b,w=bg(t[2]),x=[];for(let T=0;T<w.length;T+=1)x[T]=Eve(Sve(t,w,T));return g=new Gkt({props:{id:"contact-map"}}),{c(){e=ut("div"),i=ut("div"),r=ut("h1"),s=Jo(t[1]),o=Dr(),a=ut("hr"),l=Dr(),c=ut("div"),u=ut("h1");for(let T=0;T<x.length;T+=1)x[T].c();p=Dr(),m=ut("div"),Yp(g.$$.fragment),y=Dr(),v=ut("div"),Se(r,"class","fw-bold text-primary"),Se(i,"class","text-center mb-3"),Se(u,"class","text-primary text-center"),Se(m,"class","map-container mt-4 svelte-7gp01d"),Se(v,"class","col-md-12"),Se(e,"class","container")},m(T,C){Ss(T,e,C),Fe(e,i),Fe(i,r),Fe(r,s),Fe(e,o),Fe(e,a),Fe(e,l),Fe(e,c),Fe(c,u);for(let M=0;M<x.length;M+=1)x[M]&&x[M].m(u,null);Fe(e,p),Fe(e,m),_d(g,m,null),Fe(e,y),Fe(e,v),b=!0},p(T,C){if((!b||C&2)&&pu(s,T[1]),C&4){w=bg(T[2]);let M;for(M=0;M<w.length;M+=1){const O=Sve(T,w,M);x[M]?x[M].p(O,C):(x[M]=Eve(O),x[M].c(),x[M].m(u,null))}for(;M<x.length;M+=1)x[M].d(1);x.length=w.length}},i(T){b||(T&&(n||wc(()=>{n=ff(i,LK,{duration:1e3}),n.start()})),T&&(d||wc(()=>{d=ff(c,v1,{delay:500,duration:1e3}),d.start()})),$s(g.$$.fragment,T),b=!0)},o(T){Ha(g.$$.fragment,T),b=!1},d(T){T&&rs(e),D3(x,T),vd(g)}}}function Eve(t){let e,i,r,s,n;return{c(){e=ut("a"),i=ut("i"),s=Dr(),Se(i,"class",r="h3 "+t[7][1]+" svelte-7gp01d"),Se(e,"class","btn shadow-sm mx-1 social-icon svelte-7gp01d"),Se(e,"href",n=t[7][2]),Se(e,"role","button")},m(o,a){Ss(o,e,a),Fe(e,i),Fe(e,s)},p(o,a){a&4&&r!==(r="h3 "+o[7][1]+" svelte-7gp01d")&&Se(i,"class",r),a&4&&n!==(n=o[7][2])&&Se(e,"href",n)},d(o){o&&rs(e)}}}function jkt(t){let e,i,r=t[3]&&Tve(t);return{c(){r&&r.c(),e=zV()},m(s,n){r&&r.m(s,n),Ss(s,e,n),i=!0},p(s,n){s[3]?r?(r.p(s,n),n&8&&$s(r,1)):(r=Tve(s),r.c(),$s(r,1),r.m(e.parentNode,e)):r&&(Zve(),Ha(r,1,1,()=>{r=null}),Xve())},i(s){i||($s(r),i=!0)},o(s){Ha(r),i=!1},d(s){s&&rs(e),r&&r.d(s)}}}function Hkt(t){let e,i,r,s;return i=new VV({props:{animation:"",$$slots:{default:[jkt]},$$scope:{ctx:t}}}),{c(){e=ut("div"),Yp(i.$$.fragment),Se(e,"class",r="bg-"+t[5]+" text-"+t[4]+" d-flex justify-content-center align-items-center min-vh-100 flex-column svelte-7gp01d"),Se(e,"id",t[0]),Ud(e,"padding-top","58px"),Ud(e,"background-color","transparent",1)},m(n,o){Ss(n,e,o),_d(i,e,null),s=!0},p(n,[o]){const a={};o&1038&&(a.$$scope={dirty:o,ctx:n}),i.$set(a),(!s||o&48&&r!==(r="bg-"+n[5]+" text-"+n[4]+" d-flex justify-content-center align-items-center min-vh-100 flex-column svelte-7gp01d"))&&Se(e,"class",r),(!s||o&1)&&Se(e,"id",n[0])},i(n){s||($s(i.$$.fragment,n),s=!0)},o(n){Ha(i.$$.fragment,n),s=!1},d(n){n&&rs(e),vd(i)}}}function qkt(t,e,i){let r=!1;_1(()=>i(3,r=!0));let{Id:s}=e,{contact_title:n}=e,{social:o}=e,{state:a}=e,l="dark",c="light";return a=="dark"&&(l="light",c="dark"),t.$$set=u=>{"Id"in u&&i(0,s=u.Id),"contact_title"in u&&i(1,n=u.contact_title),"social"in u&&i(2,o=u.social),"state"in u&&i(6,a=u.state)},[s,n,o,r,l,c,a]}class Wkt extends F0{constructor(e){super(),N0(this,e,qkt,Hkt,D0,{Id:0,contact_title:1,social:2,state:6})}}function Ykt(t){let e,i,r,s,n,o,a,l,c,u,d,p,m,g,y;return r=new lUe({props:{Id:"navbar",brand:Cve,nav_items:t[2],github:Nke,state:Y2}}),n=new bUe({props:{Id:"#",header_title_1:Zkt,header_title_2:Xkt,header_title_3:t[3],state:Y2}}),a=new CUe({props:{Id:"about",bio_title:Jkt,bio:t[5],skills_title:Qkt,skills:t[4],state:Y2}}),c=new OUe({props:{Id:"projects",projects_title:Kkt,projects:t[6],state:Y2}}),d=new Wkt({props:{Id:"contact",contact_title:eUt,social:t[7],state:Y2}}),m=new hUe({props:{Id:"footer",brand:Cve,state:Y2}}),{c(){e=ut("main"),i=ut("div"),Yp(r.$$.fragment),s=Dr(),Yp(n.$$.fragment),o=Dr(),Yp(a.$$.fragment),l=Dr(),Yp(c.$$.fragment),u=Dr(),Yp(d.$$.fragment),p=Dr(),Yp(m.$$.fragment),Se(i,"class","bg-pattern"),Se(e,"class",g="bg-"+t[1]+" text-"+t[0]+" min-vh-100")},m(v,b){Ss(v,e,b),Fe(e,i),_d(r,i,null),Fe(i,s),_d(n,i,null),Fe(i,o),_d(a,i,null),Fe(i,l),_d(c,i,null),Fe(i,u),_d(d,i,null),Fe(i,p),_d(m,i,null),y=!0},p(v,[b]){(!y||b&3&&g!==(g="bg-"+v[1]+" text-"+v[0]+" min-vh-100"))&&Se(e,"class",g)},i(v){y||($s(r.$$.fragment,v),$s(n.$$.fragment,v),$s(a.$$.fragment,v),$s(c.$$.fragment,v),$s(d.$$.fragment,v),$s(m.$$.fragment,v),y=!0)},o(v){Ha(r.$$.fragment,v),Ha(n.$$.fragment,v),Ha(a.$$.fragment,v),Ha(c.$$.fragment,v),Ha(d.$$.fragment,v),Ha(m.$$.fragment,v),y=!1},d(v){v&&rs(e),vd(r),vd(n),vd(a),vd(c),vd(d),vd(m)}}}let Cve="sputnix.me",Nke="https://github.com/Gitkubikon",Zkt="Welcome,",Xkt="I'm {Nikita} , 20",Jkt="Professional Background",Qkt="Technical Proficiencies",Kkt="Project Portfolio",eUt="Contact Information",Y2="dark";function tUt(t,e,i){let r=[["Home","#"],["About","#about"],["Projects","#projects"],["Contact","#contact"]],s=["UI Designer","Web Developer","Freelancer","Team Lead"],n={Programming:[["Python","fab fa-python",75],["Shell Script","fab fa-linux",70],["HTML/CSS","fab fa-html5",90],["JavaScript","fab fa-js-square",95],["TypeScript","fab fa-js",90]],Tools:[["Adobe Photoshop","fas fa-image",85],["Adobe Illustrator","fas fa-pencil-alt",80],["Figma","fas fa-object-group",75],["InDesign","fas fa-file-alt",70],["Blender","fas fa-blender",30]],Languages:[["German (Native)","fas fa-language",100],["Russian (Native)","fas fa-language",100],["English (C1)","fas fa-language",90],["Japanese (Basic)","fas fa-language",30]],AI:[["Midjourney","fas fa-robot",70],["ChatGPT","fas fa-comments",75]],Frameworks:[["Svelte","fas fa-code",95],["Flutter","fab fa-dev",50]],Certifications:[["DO-178C","fas fa-certificate",70],["A1/A3 Drone Pilot License","fas fa-drone",100]]},o=`
        I am Nikita Friesen, a passionate and dedicated software engineer currently pursuing a Bachelor of Science in User Experience Design at the Technical University Ingolstadt. My professional journey has encompassed diverse roles, providing me with a rich blend of experiences in user research, design thinking, and prototyping.
        
        My career highlights include substantial contributions to leading companies such as SodaStream and HIVE Systems. At HIVE Systems, I spearheaded the development of the HIVE Dashboard's frontend, ensuring the integration of advanced systems and interfaces that comply with stringent DAL-B safety standards. My role involved close collaboration with cross-functional teams to enhance operational efficiency and safety in drone fleet management.
        
        Beyond my technical prowess, I bring a strong foundation in graphic design, equipped with advanced skills in Adobe Photoshop, Illustrator, Figma, and InDesign. My multilingual abilities in German, Russian, English, and Japanese enable effective communication and collaboration in diverse environments.
        
        My objective is to leverage my extensive skills and experience to create impactful technological solutions that advance industry standards.
    `,a=[["HIVE Dashboard Development","As the lead frontend developer for HIVE Systems, I developed the HIVE Dashboard, a sophisticated management interface for drone fleet operations. The project involved implementing features for real-time monitoring of drone status, performance, and location. This system significantly enhanced operational efficiency and complied with DAL-B safety standards, ensuring high reliability and safety in drone operations.","../assets/HIVE.png","https://drive.google.com/file/d/1STnGco7368BN1H3Zdu4g3bjJ5R4mPgPM/view?usp=sharing"],["Gabrieli-Gymnasium Brand Identity","I designed the logos and school clothing for Gabrieli-Gymnasium, thereby significantly enhancing the school's brand identity. This project was a perfect blend of creativity and practicality, resulting in a more cohesive and recognizable brand. The work involved comprehensive design strategies and direct collaboration with the school's management to ensure alignment with their vision.","../assets/Schulkleidung.jpg","https://www.gabrieli-gymnasium.de/menschen/schuelervertretung/schulkleidung/"],["Aerozenith Wearable Art","At Aerozenith, I led the design of wearable technology that seamlessly integrates fashion with advanced tech. This project involved creating cyberpunk-inspired clothing that interfaces with smart devices, enhancing both functionality and aesthetic appeal. My role was pivotal in bridging the gap between design innovation and practical application.","../assets/Aerozenith.png","https://github.com/Gitkubikon/Aerozenith"],["Athena's Edge Blog","I developed Athena's Edge Blog, a platform dedicated to educating individuals on the latest advancements and use cases of Artificial Intelligence (AI). This project involved comprehensive content management, UI/UX design, and implementation of interactive features to engage the audience effectively.","../assets/AE.png","https://github.com/Gitkubikon/Athena-s-Edge"],["University STEM Map","In this project, I visualized estimated student counts and female STEM graduates' percentages for universities worldwide using Svelte, TypeScript, and Vite. The map was rendered using the ArcGIS API for JavaScript and optimized for handling large datasets efficiently. This tool aids in understanding global STEM education trends and identifying areas for improvement.","../assets/STEMGlobe.png","https://gitkubikon.github.io/STEMGlobe/"]],l=[["LinkedIn","fab fa-linkedin","https://www.linkedin.com/in/nikita-friesen"],["Email","fas fa-envelope","mailto:nikitafriesen74@gmail.com"],["Github","fab fa-github",Nke]],c="dark",u="light";return c="light",u="dark",_1(()=>{console.log("App mounted");const d=document.querySelectorAll("section"),p=new IntersectionObserver(m=>{m.forEach(g=>{g.isIntersecting?g.target.classList.add("visible"):g.target.classList.remove("visible")})});d.forEach(m=>{p.observe(m)})}),[c,u,r,s,n,o,a,l]}class iUt extends F0{constructor(e){super(),N0(this,e,tUt,Ykt,D0,{})}}new iUt({target:document.body});const rUt=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:ZC,build:TMe},Symbol.toStringTag,{value:"Module"})),sUt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:uie,build:jMe},Symbol.toStringTag,{value:"Module"})),nUt=Object.freeze(Object.defineProperty({__proto__:null,build:ZMe},Symbol.toStringTag,{value:"Module"})),oUt=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:yie,build:iAe},Symbol.toStringTag,{value:"Module"})),aUt=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:_ie,build:nAe},Symbol.toStringTag,{value:"Module"})),lUt=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:bie,build:xAe},Symbol.toStringTag,{value:"Module"})),cUt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:Sie,SimpleAtmospherePassParameters:wG,build:OAe},Symbol.toStringTag,{value:"Module"})),uUt=Object.freeze(Object.defineProperty({__proto__:null,build:tPe},Symbol.toStringTag,{value:"Module"})),hUt=Object.freeze(Object.defineProperty({__proto__:null,build:sPe},Symbol.toStringTag,{value:"Module"})),dUt=Object.freeze(Object.defineProperty({__proto__:null,build:DOe,calculateAnchorPosForRendering:d3},Symbol.toStringTag,{value:"Module"})),pUt=Object.freeze(Object.defineProperty({__proto__:null,build:FRe},Symbol.toStringTag,{value:"Module"})),fUt=Object.freeze(Object.defineProperty({__proto__:null,build:zRe,getRadius:QG},Symbol.toStringTag,{value:"Module"})),mUt=Object.freeze(Object.defineProperty({__proto__:null,build:jRe},Symbol.toStringTag,{value:"Module"})),gUt=Object.freeze(Object.defineProperty({__proto__:null,build:qRe},Symbol.toStringTag,{value:"Module"})),yUt=Object.freeze(Object.defineProperty({__proto__:null,build:c$e},Symbol.toStringTag,{value:"Module"})),_Ut=Object.freeze(Object.defineProperty({__proto__:null,build:gIe,ribbonlineNumRoundJoinSubdivisions:y3},Symbol.toStringTag,{value:"Module"})),vUt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:jre,build:H$e},Symbol.toStringTag,{value:"Module"})),bUt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:Kre,build:PIe},Symbol.toStringTag,{value:"Module"})),wUt=Object.freeze(Object.defineProperty({__proto__:null,build:W3e},Symbol.toStringTag,{value:"Module"})),xUt=Object.freeze(Object.defineProperty({__proto__:null,build:aLe},Symbol.toStringTag,{value:"Module"})),SUt=Object.freeze(Object.defineProperty({__proto__:null,build:BLe},Symbol.toStringTag,{value:"Module"})),TUt=Object.freeze(Object.defineProperty({__proto__:null,build:ZLe},Symbol.toStringTag,{value:"Module"})),EUt=Object.freeze(Object.defineProperty({__proto__:null,build:QLe},Symbol.toStringTag,{value:"Module"})),CUt=Object.freeze(Object.defineProperty({__proto__:null,build:cDe},Symbol.toStringTag,{value:"Module"})),MUt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Bse,build:sNe},Symbol.toStringTag,{value:"Module"})),AUt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Q1},build:PNe},Symbol.toStringTag,{value:"Module"})),PUt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:LNe,ColorizerStretchUniforms:INe,ColorizerUniforms:Sj,build:DNe},Symbol.toStringTag,{value:"Module"})),OUt=Object.freeze(Object.defineProperty({__proto__:null,build:WNe},Symbol.toStringTag,{value:"Module"})),RUt=Object.freeze(Object.defineProperty({__proto__:null,build:rFe},Symbol.toStringTag,{value:"Module"})),$Ut=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:tne,build:oFe},Symbol.toStringTag,{value:"Module"})),IUt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Kse,blurSize:ene,build:iFe,gridCellPixelSize:Up,outlineSize:A3},Symbol.toStringTag,{value:"Module"})),LUt=Object.freeze(Object.defineProperty({__proto__:null,build:dFe},Symbol.toStringTag,{value:"Module"})),DUt=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:rne,build:mFe},Symbol.toStringTag,{value:"Module"})),NUt=Object.freeze(Object.defineProperty({__proto__:null,build:_Fe},Symbol.toStringTag,{value:"Module"})),FUt=Object.freeze(Object.defineProperty({__proto__:null,build:wFe},Symbol.toStringTag,{value:"Module"})),kUt=Object.freeze(Object.defineProperty({__proto__:null,build:TFe},Symbol.toStringTag,{value:"Module"})),UUt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:Tj,build:MFe},Symbol.toStringTag,{value:"Module"})),zUt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:nne,build:PFe},Symbol.toStringTag,{value:"Module"})),VUt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:one,build:$Fe},Symbol.toStringTag,{value:"Module"})),BUt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:lne,build:zFe},Symbol.toStringTag,{value:"Module"})),GUt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:HL,build:UFe},Symbol.toStringTag,{value:"Module"})),jUt=Object.freeze(Object.defineProperty({__proto__:null,ViewshedPassParameters:cne,build:qFe},Symbol.toStringTag,{value:"Module"}));export{Qut as $,sr as A,ZHt as B,p1 as C,h3 as D,XHt as E,Br as F,gs as G,Zn as H,We as I,Ac as J,Af as K,ot as L,LKt as M,ge as N,ne as O,cr as P,E as Q,ZM as R,Re as S,sI as T,hFt as U,tt as V,ms as W,aWt as X,lWt as Y,uL as Z,fe as _,I as a,OEt as a$,Ni as a0,A0 as a1,Pf as a2,$9t as a3,BZt as a4,Tni as a5,Nni as a6,MXt as a7,Mt as a8,ikt as a9,VK as aA,WV as aB,OHe as aC,TB as aD,Q3 as aE,zt as aF,SV as aG,FGe as aH,ro as aI,kGe as aJ,UGe as aK,zGe as aL,Te as aM,e6t as aN,tee as aO,nVt as aP,oVt as aQ,kEe as aR,FGt as aS,kGt as aT,NVt as aU,AHe as aV,UVt as aW,kVt as aX,P1 as aY,FVt as aZ,H5e as a_,bni as aa,WFt as ab,EXt as ac,k7e as ad,zI as ae,Tke as af,nQe as ag,dkt as ah,VQe as ai,db as aj,Oe as ak,Km as al,Qte as am,mCe as an,zKe as ao,MT as ap,qA as aq,Dt as ar,Zt as as,S9 as at,Kve as au,wL as av,_t as aw,J3 as ax,$A as ay,gi as az,V as b,c0 as b$,Ll as b0,Ca as b1,Wet as b2,Et as b3,Ujt as b4,OKt as b5,a3t as b6,eri as b7,Dse as b8,Di as b9,ZXe as bA,TM as bB,XXe as bC,oke as bD,qL as bE,zl as bF,qzt as bG,iGe as bH,vGt as bI,V3 as bJ,Ol as bK,ort as bL,$e as bM,q6 as bN,Xs as bO,X6t as bP,J6t as bQ,rz as bR,Mue as bS,Pqe as bT,In as bU,Ee as bV,LSe as bW,Oh as bX,w1 as bY,Yt as bZ,EGe as b_,Xsi as ba,BA as bb,cn as bc,Ta as bd,Ii as be,JHe as bf,t1e as bg,W3 as bh,LEt as bi,Ve as bj,ye as bk,Sf as bl,xqe as bm,Q as bn,xV as bo,xTe as bp,Dni as bq,Wt as br,Z1e as bs,ZV as bt,Ate as bu,YS as bv,ZI as bw,fkt as bx,jv as by,xc as bz,Yn as c,Gn as c$,I7t as c0,wsi as c1,Tce as c2,IQe as c3,z1 as c4,_n as c5,xsi as c6,qi as c7,ct as c8,aXt as c9,Ar as cA,C4 as cB,Jn as cC,K1 as cD,ojt as cE,K7t as cF,Ht as cG,t1 as cH,Mc as cI,GJe as cJ,_Bt as cK,bU as cL,Ef as cM,IM as cN,uS as cO,Qp as cP,Kp as cQ,Lje as cR,vje as cS,xXe as cT,PS as cU,a1 as cV,Hm as cW,Bp as cX,iie as cY,Ftt as cZ,lt as c_,Vr as ca,Fzt as cb,mft as cc,ea as cd,xu as ce,mu as cf,vbt as cg,dr as ch,rL as ci,D1 as cj,X1 as ck,JX as cl,QX as cm,xbt as cn,bbt as co,Sbt as cp,wbt as cq,iLe as cr,ej as cs,sLe as ct,hae as cu,Gr as cv,il as cw,ve as cx,He as cy,hg as cz,jQt as d,cA as d$,fMe as d0,hh as d1,mni as d2,cve as d3,fni as d4,j5t as d5,kA as d6,FM as d7,ib as d8,Gl as d9,nBt as dA,pe as dB,oe as dC,me as dD,mBt as dE,N1 as dF,Zr as dG,_G as dH,Ff as dI,Ji as dJ,oTe as dK,Oo as dL,BC as dM,Rd as dN,fC as dO,gA as dP,aHt as dQ,_S as dR,Irt as dS,f8t as dT,d8t as dU,p8t as dV,R as dW,ese as dX,rBt as dY,Xmt as dZ,Jmt as d_,e7 as da,rn as db,K9 as dc,i7 as dd,AU as de,gSe as df,N7e as dg,I1 as dh,Qm as di,jd as dj,ta as dk,uo as dl,ef as dm,RVt as dn,eBt as dp,Wie as dq,vT as dr,eQt as ds,Ae as dt,ce as du,vs as dv,ySe as dw,Qi as dx,uBt as dy,nL as dz,h as e,UGt as e$,yh as e0,_ht as e1,Hz as e2,Ye as e3,HZ as e4,Wre as e5,wr as e6,ige as e7,$n as e8,yT as e9,c4e as eA,lri as eB,cri as eC,hri as eD,H3t as eE,L3t as eF,mve as eG,x9 as eH,Nri as eI,TDt as eJ,Dri as eK,EDt as eL,wBt as eM,SDt as eN,l1 as eO,d_e as eP,Ckt as eQ,gve as eR,Z_t as eS,X_t as eT,J_t as eU,Usi as eV,ksi as eW,ra as eX,z7e as eY,T1 as eZ,sri as e_,bn as ea,it as eb,nb as ec,KJt as ed,Rt as ee,pB as ef,B0 as eg,Get as eh,Yzt as ei,Ns as ej,Akt as ek,bBt as el,mDt as em,wne as en,Tne as eo,Ene as ep,Pj as eq,Pn as er,DS as es,Ce as et,gT as eu,z4e as ev,kDt as ew,b5t as ex,q4e as ey,No as ez,iSe as f,EKe as f$,H3 as f0,S0 as f1,fu as f2,KUt as f3,Eti as f4,cRt as f5,KOt as f6,QNe as f7,Mti as f8,hRt as f9,Y7t as fA,Vpt as fB,JE as fC,gte as fD,ns as fE,JY as fF,o1 as fG,Jc as fH,nu as fI,YUt as fJ,qBe as fK,SM as fL,hee as fM,NUe as fN,iL as fO,dG as fP,Iwe as fQ,Fjt as fR,mr as fS,wg as fT,kK as fU,mzt as fV,PEt as fW,REt as fX,$S as fY,pse as fZ,c5 as f_,Ist as fa,Q8t as fb,abt as fc,PU as fd,kne as fe,ret as ff,bQe as fg,NGt as fh,sft as fi,nft as fj,xee as fk,P$e as fl,W7t as fm,q7t as fn,iQe as fo,Dte as fp,dA as fq,Eu as fr,LQe as fs,VGt as ft,$Qe as fu,zGt as fv,sf as fw,cBe as fx,uh as fy,ag as fz,ue as g,Cu as g$,j3 as g0,Kr as g1,_ne as g2,p5t as g3,Aj as g4,lr as g5,j4e as g6,V4e as g7,ll as g8,Mu as g9,cS as gA,h7 as gB,kl as gC,aDt as gD,ug as gE,Sd as gF,HCe as gG,Li as gH,hT as gI,ori as gJ,dri as gK,ari as gL,C1 as gM,WUt as gN,Rqe as gO,rQt as gP,$1e as gQ,A9 as gR,zZt as gS,PI as gT,Uh as gU,jzt as gV,Jzt as gW,y4 as gX,H_e as gY,CHt as gZ,eb as g_,pL as ga,kf as gb,xne as gc,bne as gd,Ma as ge,Ybe as gf,pbe as gg,fbe as gh,Ai as gi,Ige as gj,uEt as gk,hEt as gl,B4e as gm,rU as gn,k1 as go,m5t as gp,yBt as gq,cae as gr,Sg as gs,Cte as gt,v5t as gu,VU as gv,Qr as gw,Yne as gx,r1 as gy,mqe as gz,u0 as h,k$ as h$,Rse as h0,NDe as h1,wO as h2,lS as h3,Skt as h4,eB as h5,OI as h6,Vee as h7,aqe as h8,Ps as h9,ML as hA,Qo as hB,xT as hC,Pi as hD,jM as hE,cYe as hF,fte as hG,ywe as hH,gtt as hI,pA as hJ,pPe as hK,aVt as hL,On as hM,qa as hN,E9e as hO,Za as hP,dBt as hQ,Vst as hR,Or as hS,bd as hT,IS as hU,KCt as hV,ZBt as hW,YV as hX,eEe as hY,bae as hZ,vqe as h_,se as ha,CO as hb,dS as hc,ir as hd,Xa as he,_c as hf,nHt as hg,X3 as hh,ho as hi,ws as hj,yB as hk,Rr as hl,Io as hm,T0 as hn,ls as ho,J1 as hp,bi as hq,Vd as hr,Mn as hs,c7 as ht,A6 as hu,O9t as hv,P9t as hw,XJt as hx,qU as hy,W1 as hz,ar as i,tl as i$,Zzt as i0,Mf as i1,v4t as i2,UFt as i3,Fsi as i4,GFt as i5,Nsi as i6,BFt as i7,RI as i8,fj as i9,MH as iA,G_t as iB,ex as iC,U1 as iD,n5t as iE,t5t as iF,XFt as iG,Rce as iH,REe as iI,pke as iJ,Sne as iK,Nj as iL,h9 as iM,XJ as iN,Oj as iO,GA as iP,Dj as iQ,k5e as iR,yDt as iS,Wne as iT,dke as iU,BJe as iV,VJe as iW,NJe as iX,bce as iY,Fni as iZ,AC as i_,Vp as ia,dSe as ib,Wde as ic,QE as id,A7 as ie,F7t as ig,zpt as ih,wGt as ii,L7t as ij,_h as ik,p_t as il,$X as im,IX as io,ln as ip,a7e as iq,uf as ir,iBt as is,m7e as it,RS as iu,wDe as iv,eXt as iw,Jyt as ix,GYt as iy,_C as iz,tb as j,b0 as j$,Mkt as j0,AA as j1,YE as j2,nd as j3,S$ as j4,E$ as j5,XS as j6,ijt as j7,_De as j8,uje as j9,r4t as jA,s4t as jB,o4t as jC,a4t as jD,l4t as jE,c4t as jF,u4t as jG,h4t as jH,d4t as jI,p4t as jJ,f4t as jK,uke as jL,KV as jM,_Dt as jN,Gne as jO,pi as jP,sGe as jQ,mh as jR,nkt as jS,yni as jT,xni as jU,SGt as jV,p2e as jW,YAe as jX,ije as jY,OM as jZ,z7t as j_,xae as ja,hke as jb,LC as jc,JBe as jd,zd as je,vh as jf,$3 as jg,Hne as jh,vne as ji,wDt as jj,bDt as jk,OA as jl,aP as jm,m4t as jn,kFt as jo,Q0 as jp,zne as jq,O5e as jr,A3e as js,ose as jt,M3e as ju,z4t as jv,qFt as jw,b4t as jx,jCe as jy,i4t as jz,O1 as k,K5e as k$,fEt as k0,VUe as k1,tkt as k2,cL as k3,Z5t as k4,vni as k5,EQt as k6,$Et as k7,kS as k8,j7t as k9,fr as kA,cf as kB,fs as kC,wEe as kD,pt as kE,_r as kF,GEt as kG,Ge as kH,P7e as kI,Xv as kJ,Ws as kK,_te as kL,cQt as kM,y5 as kN,ake as kO,S4t as kP,pr as kQ,Do as kR,mSe as kS,Fce as kT,wVt as kU,JM as kV,ajt as kW,Ln as kX,ezt as kY,GL as kZ,Lri as k_,lbt as ka,eHt as kb,vU as kc,fA as kd,Pg as ke,mMe as kf,r3 as kg,zwe as kh,xa as ki,yr as kj,aBt as kk,S9e as kl,vn as km,J$e as kn,vb as ko,sL as kp,YZt as kq,YX as kr,Kz as ks,Ls as kt,nze as ku,JOe as kv,BK as kw,HU as kx,Lie as ky,_e as kz,Ete as l,h0 as l$,qK as l0,JS as l1,cE as l2,t4t as l3,tni as l4,C4t as l5,M4t as l6,WJ as l7,li as l8,Qa as l9,_L as lA,po as lB,EG as lC,MG as lD,OT as lE,yYt as lF,FAe as lG,AG as lH,CG as lI,q3 as lJ,Z3 as lK,Qj as lL,ur as lM,Hte as lN,jU as lO,lqe as lP,cqe as lQ,xle as lR,JCt as lS,Lj as lT,IA as lU,Ch as lV,qVt as lW,YVt as lX,WVt as lY,Bd as lZ,iQt as l_,kjt as la,bBe as lb,g1e as lc,vi as ld,Cr as le,Nr as lf,AL as lg,hQt as lh,fri as li,zLt as lj,mri as lk,Wbe as ll,Xd as lm,aL as ln,_T as lo,rl as lp,WU as lq,Gqe as lr,ps as ls,kOt as lt,hut as lu,lo as lv,cti as lw,d0 as lx,$f as ly,nl as lz,re as m,wh as m$,sl as m0,jr as m1,gt as m2,Ft as m3,ii as m4,br as m5,jS as m6,It as m7,Sj as m8,UJ as m9,b2 as mA,I1e as mB,gzt as mC,fT as mD,O7e as mE,ZS as mF,S_t as mG,Vtt as mH,Wn as mI,Qje as mJ,QFt as mK,sG as mL,DGt as mM,IGt as mN,Noe as mO,bK as mP,z0 as mQ,z3 as mR,xm as mS,bT as mT,WHt as mU,E0 as mV,Er as mW,tte as mX,wu as mY,Wee as mZ,TSe as m_,lVt as ma,ytt as mb,que as mc,gLe as md,_Le as me,oXt as mf,dI as mg,pI as mh,tLe as mi,Bwt as mj,obt as mk,pft as ml,$$e as mm,gft as mn,gwt as mo,mbt as mp,gbt as mq,_wt as mr,pwt as ms,fwt as mt,ybt as mu,ywt as mv,fft as mw,mwt as mx,Hd as my,cM as mz,ie as n,sB as n$,KZt as n0,N as n1,eVt as n2,hDt as n3,uri as n4,nri as n5,L1 as n6,fRe as n7,yn as n8,vK as n9,YFt as nA,RGt as nB,$Gt as nC,LGt as nD,Sc as nE,BGt as nF,Upt as nG,$te as nH,A1 as nI,Rsi as nJ,sDt as nK,nDt as nL,ZFt as nM,G4t as nN,s5t as nO,f5t as nP,uTe as nQ,G9e as nR,o3t as nS,mc as nT,L7e as nU,lst as nV,U$ as nW,jtt as nX,Td as nY,_i as nZ,Nzt as n_,QUt as na,Mj as nb,Cj as nc,yne as nd,du as ne,g3t as nf,JUe as ng,nee as nh,Hzt as ni,PA as nj,PBe as nk,oB as nl,Xzt as nm,F1e as nn,xzt as no,wzt as np,X7t as nq,Z7t as nr,Zze as ns,Yze as nt,r1e as nu,WUe as nv,yVt as nw,_u as nx,U7t as ny,BOe as nz,Mce as o,FNt as o$,CGt as o0,Og as o1,Wzt as o2,R1e as o3,ZQe as o4,UV as o5,Ske as o6,x4t as o7,sQt as o8,y1 as o9,ASe as oA,XVe as oB,Y6t as oC,Hee as oD,nXt as oE,Z6t as oF,uWt as oG,Jve as oH,n6t as oI,l6t as oJ,i3 as oK,lHt as oL,cHt as oM,Yce as oN,CSe as oO,lnt as oP,kM as oQ,oHt as oR,Xue as oS,e1 as oT,o6t as oU,OGt as oV,Qzt as oW,e7e as oX,Hsi as oY,Bl as oZ,yM as o_,K_e as oa,XI as ob,O5t as oc,PHt as od,RHt as oe,mPe as of,pEt as og,dEt as oh,a6t as oi,HOe as oj,HI as ok,sHt as ol,tA as om,tht as on,ysi as oo,YNt as op,nLe as oq,nCe as or,b1 as os,_bt as ot,aB as ou,lee as ov,j0 as ow,sXt as ox,Oqe as oy,s0 as oz,vu as p,ox as p$,bS as p0,LS as p1,fBt as p2,Ko as p3,vj as p4,JU as p5,mEt as p6,Cgt as p7,pQt as p8,lEt as p9,Rwe as pA,xVt as pB,fwe as pC,mVt as pD,aje as pE,fje as pF,A$e as pG,gee as pH,dVt as pI,CIe as pJ,Igt as pK,JV as pL,aG as pM,lu as pN,UK as pO,Ml as pP,mbe as pQ,e6e as pR,Cqe as pS,ESe as pT,ft as pU,jI as pV,aTe as pW,Hle as pX,x1 as pY,Pjt as pZ,$9e as p_,mQt as pa,fQt as pb,AB as pc,vVt as pd,_Vt as pe,h6t as pf,Zce as pg,Wce as ph,QJt as pi,tQt as pj,Me as pk,jYe as pl,Bqe as pm,LYe as pn,eWt as po,H7t as pp,E$e as pq,M$e as pr,S$e as ps,qde as pt,Q7t as pu,hB as pv,P4 as pw,Qde as px,_ft as py,$7t as pz,EX as q,Eni as q$,W2 as q0,het as q1,ARe as q2,Cre as q3,Kit as q4,oLe as q5,Fbe as q6,wTe as q7,PX as q8,CXt as q9,rkt as qA,ast as qB,gDe as qC,_ni as qD,HEt as qE,Uge as qF,KFt as qG,zUe as qH,i1e as qI,DK as qJ,fPe as qK,sVt as qL,rVt as qM,hs as qN,tot as qO,ngt as qP,Gd as qQ,G1t as qR,nT as qS,qwe as qT,Jxe as qU,d1e as qV,GUe as qW,nce as qX,aQt as qY,Pni as qZ,Ase as q_,WS as qa,g7e as qb,$ni as qc,K9t as qd,XG as qe,Gz as qf,CVt as qg,gni as qh,QV as qi,fzt as qj,s3 as qk,Qt as ql,NS as qm,R1 as qn,A9t as qo,hAe as qp,Lni as qq,f2e as qr,i9e as qs,DI as qt,Zv as qu,n7e as qv,Y5t as qw,sS as qx,uAe as qy,Xm as qz,Kii as r,wIe as r$,Cni as r0,Sni as r1,TF as r2,rIe as r3,Au as r4,Ini as r5,q5t as r6,ZVt as r7,tHt as r8,fg as r9,osi as rA,lsi as rB,SJ as rC,wJ as rD,Kc as rE,RZt as rF,uc as rG,Cyt as rH,$Zt as rI,s0t as rJ,MYt as rK,Cn as rL,jge as rM,CNt as rN,x2 as rO,xxt as rP,kTt as rQ,Tpt as rR,xpt as rS,iit as rT,b7t as rU,v7t as rV,C0 as rW,rWt as rX,Po as rY,wa as rZ,vQt as r_,zM as ra,ds as rb,HA as rc,Rni as rd,ch as re,N$e as rf,F$e as rg,I9t as rh,Oni as ri,wni as rj,n1 as rk,Ba as rl,Ya as rm,AZt as rn,EKt as ro,ase as rp,PV as rq,CZt as rr,PZt as rs,P3e as rt,MZt as ru,VDt as rv,eu as rw,iu as rx,xJ as ry,AV as rz,rG as s,AKt as s$,ia as s0,Czt as s1,of as s2,ah as s3,d4 as s4,G7t as s5,Sle as s6,N7t as s7,Fht as s8,lG as s9,oP as sA,Dne as sB,ONt as sC,RNt as sD,Nne as sE,M5e as sF,kZt as sG,Pft as sH,UZt as sI,k$e as sJ,kV as sK,Ozt as sL,S5e as sM,EI as sN,fjt as sO,mjt as sP,gjt as sQ,lB as sR,mf as sS,qVe as sT,XB as sU,TGt as sV,gU as sW,nB as sX,_re as sY,Df as sZ,dKt as s_,AXt as sa,PT as sb,UTt as sc,mre as sd,an as se,t2t as sf,V1 as sg,NSe as sh,Aa as si,_Me as sj,LB as sk,qS as sl,k0 as sm,Qee as sn,s1 as so,DB as sp,nTe as sq,hBt as sr,Wtt as ss,fVt as st,NCt as su,jet as sv,LUe as sw,g6e as sx,Kzt as sy,ud as sz,ti as t,Fte as t$,PCt as t0,MS as t1,uZt as t2,vr as t3,rr as t4,Of as t5,dZt as t6,Lzt as t7,zv as t8,i$e as t9,mz as tA,wM as tB,r7e as tC,lte as tD,yMe as tE,EGt as tF,vBt as tG,AVt as tH,Htt as tI,qqe as tJ,mG as tK,S1 as tL,uBe as tM,_tt as tN,bM as tO,ZGe as tP,YGe as tQ,cVt as tR,uet as tS,xVe as tT,BQe as tU,zVt as tV,vg as tW,EBt as tX,TBt as tY,kWe as tZ,FWe as t_,hJ as ta,zm as tb,hZt as tc,I0 as td,Uv as te,Pe as tf,bMt as tg,wMt as th,VY as ti,Ott as tj,hue as tk,QS as tl,nS as tm,xO as tn,IU as to,Obe as tp,MBt as tq,bDe as tr,Lo as ts,Ztt as tt,pBt as tu,x9e as tv,yU as tw,tTe as tx,u7e as ty,Tf as tz,Le as u,$Ht as u$,Fk as u0,NZt as u1,GV as u2,HQe as u3,zet as u4,m3t as u5,jQe as u6,dz as u7,fz as u8,QI as u9,pVt as uA,bje as uB,iwe as uC,twe as uD,Jjt as uE,i6t as uF,t6t as uG,r6t as uH,nwe as uI,s6t as uJ,IHt as uK,iot as uL,Hze as uM,bzt as uN,NGe as uO,tVt as uP,iVt as uQ,y3t as uR,z1e as uS,nEt as uT,sEt as uU,lze as uV,izt as uW,oEt as uX,njt as uY,fB as uZ,aEt as u_,tzt as ua,xg as ub,yri as uc,Ble as ud,VZt as ue,FZt as uf,zte as ug,QQe as uh,KQe as ui,XLt as uj,Qii as uk,H9 as ul,BY as um,BGe as un,Lm as uo,V1t as up,z1t as uq,Bbe as ur,Vbe as us,r7 as ut,VVt as uu,swe as uv,VGe as uw,__t as ux,qYe as uy,IYe as uz,Su as v,Soe as v$,Kjt as v0,jee as v1,DZt as v2,uu as v3,cnt as v4,Mh as v5,D9e as v6,UM as v7,sot as v8,FB as v9,Hi as vA,fIt as vB,qUt as vC,c_t as vD,jYt as vE,bZt as vF,wZt as vG,yZt as vH,gZt as vI,lZt as vJ,cZt as vK,Mzt as vL,Qpe as vM,g_t as vN,PEe as vO,oht as vP,yht as vQ,vKe as vR,GS as vS,r_t as vT,tWt as vU,K8 as vV,eH as vW,mee as vX,Xpt as vY,mZt as vZ,Hfe as v_,iBe as va,Ltt as vb,Dtt as vc,Qjt as vd,JJt as ve,EZt as vf,_Zt as vg,vZt as vh,rf as vi,D_t as vj,w3e as vk,U_t as vl,x_t as vm,b_t as vn,IVt as vo,aZt as vp,IZt as vq,l_t as vr,a0t as vs,Xn as vt,Y3 as vu,Id as vv,sg as vw,fZt as vx,pZt as vy,OZt as vz,QCt as w,jte as w$,J7t as w0,p6e as w1,Msi as w2,Csi as w3,cet as w4,Vi as w5,bc as w6,Ja as w7,S as w8,gn as w9,f0 as wA,GG as wB,Nbt as wC,pie as wD,KA as wE,xG as wF,f9t as wG,ore as wH,rjt as wI,_Ke as wJ,Mz as wK,$r as wL,ljt as wM,m9t as wN,CAe as wO,ss as wP,NRe as wQ,Fr as wR,Sh as wS,Uf as wT,gb as wU,wi as wV,ao as wW,bs as wX,lPe as wY,h1 as wZ,iCe as w_,Vg as wa,mt as wb,qe as wc,nt as wd,Ug as we,G as wf,Bi as wg,Ah as wh,B as wi,Wi as wj,Yi as wk,Gt as wl,Z0 as wm,yG as wn,yb as wo,Tu as wp,BG as wq,X0 as wr,Kt as ws,Mg as wt,Z1 as wu,_b as wv,HG as ww,Ec as wx,Tse as wy,xS as wz,Nf as x,Ki as x$,Fg as x0,nQt as x1,WJt as x2,Mni as x3,Ani as x4,oJ as x5,RCe as x6,eR as x7,sTe as x8,lBt as x9,COe as xA,are as xB,sjt as xC,u6t as xD,e3 as xE,c6t as xF,tXe as xG,vte as xH,jl as xI,qI as xJ,OVt as xK,qat as xL,ite as xM,rTe as xN,W9e as xO,Qqe as xP,Mst as xQ,Ast as xR,Jd as xS,uA as xT,RRe as xU,Y9t as xV,dg as xW,W9t as xX,Fs as xY,vti as xZ,M0 as x_,cBt as xa,oBt as xb,OHt as xc,DC as xd,zi as xe,sa as xf,pb as xg,Dzt as xh,Pr as xi,C9t as xj,Yee as xk,PVt as xl,sBt as xm,Rg as xn,zee as xo,l2e as xp,Rf as xq,iA as xr,Vt as xs,Xo as xt,gu as xu,jG as xv,mb as xw,K6 as xx,yRe as xy,Ts as xz,f as y,JNe as y0,YOt as y1,mRt as y2,Rde as y3,_j as y4,idt as y5,_ti as y6,RJ as y7,$J as y8,V7t as y9,e9e as yA,XVt as yB,QVt as yC,oWt as yD,lXt as yE,TXt as yF,hsi as yG,Bsi as yH,ini as yI,Uni as yJ,bVt as ya,JUt as yb,HKt as yc,gVt as yd,B7t as ye,su as yf,hb as yg,CT as yh,pzt as yi,DNt as yj,Oa as yk,Edt as yl,Ju as ym,zg as yn,kg as yo,Lr as yp,p0 as yq,bsi as yr,RT as ys,az as yt,Ig as yu,OL as yv,hu as yw,Iie as yx,tBt as yy,aut as yz,Ul as z};
